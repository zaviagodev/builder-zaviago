(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define("ContentBuilder", [], factory);
	else if(typeof exports === 'object')
		exports["ContentBuilder"] = factory();
	else
		root["ContentBuilder"] = factory();
})(self, () => {
return /******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ 303:
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

/* global module, require */

module.exports = __webpack_require__(302)

__webpack_require__(200)
__webpack_require__(630)
__webpack_require__(16)
__webpack_require__(677)
__webpack_require__(635)
__webpack_require__(166)
__webpack_require__(140)
__webpack_require__(922)


/***/ }),

/***/ 635:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image Exif Map
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2013, Sebastian Tschan
 * https://blueimp.net
 *
 * Exif tags mapping based on
 * https://github.com/jseidelin/exif-js
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, require */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302), __webpack_require__(677)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  var ExifMapProto = loadImage.ExifMap.prototype

  ExifMapProto.tags = {
    // =================
    // TIFF tags (IFD0):
    // =================
    0x0100: 'ImageWidth',
    0x0101: 'ImageHeight',
    0x0102: 'BitsPerSample',
    0x0103: 'Compression',
    0x0106: 'PhotometricInterpretation',
    0x0112: 'Orientation',
    0x0115: 'SamplesPerPixel',
    0x011c: 'PlanarConfiguration',
    0x0212: 'YCbCrSubSampling',
    0x0213: 'YCbCrPositioning',
    0x011a: 'XResolution',
    0x011b: 'YResolution',
    0x0128: 'ResolutionUnit',
    0x0111: 'StripOffsets',
    0x0116: 'RowsPerStrip',
    0x0117: 'StripByteCounts',
    0x0201: 'JPEGInterchangeFormat',
    0x0202: 'JPEGInterchangeFormatLength',
    0x012d: 'TransferFunction',
    0x013e: 'WhitePoint',
    0x013f: 'PrimaryChromaticities',
    0x0211: 'YCbCrCoefficients',
    0x0214: 'ReferenceBlackWhite',
    0x0132: 'DateTime',
    0x010e: 'ImageDescription',
    0x010f: 'Make',
    0x0110: 'Model',
    0x0131: 'Software',
    0x013b: 'Artist',
    0x8298: 'Copyright',
    0x8769: {
      // ExifIFDPointer
      0x9000: 'ExifVersion', // EXIF version
      0xa000: 'FlashpixVersion', // Flashpix format version
      0xa001: 'ColorSpace', // Color space information tag
      0xa002: 'PixelXDimension', // Valid width of meaningful image
      0xa003: 'PixelYDimension', // Valid height of meaningful image
      0xa500: 'Gamma',
      0x9101: 'ComponentsConfiguration', // Information about channels
      0x9102: 'CompressedBitsPerPixel', // Compressed bits per pixel
      0x927c: 'MakerNote', // Any desired information written by the manufacturer
      0x9286: 'UserComment', // Comments by user
      0xa004: 'RelatedSoundFile', // Name of related sound file
      0x9003: 'DateTimeOriginal', // Date and time when the original image was generated
      0x9004: 'DateTimeDigitized', // Date and time when the image was stored digitally
      0x9010: 'OffsetTime', // Time zone when the image file was last changed
      0x9011: 'OffsetTimeOriginal', // Time zone when the image was stored digitally
      0x9012: 'OffsetTimeDigitized', // Time zone when the image was stored digitally
      0x9290: 'SubSecTime', // Fractions of seconds for DateTime
      0x9291: 'SubSecTimeOriginal', // Fractions of seconds for DateTimeOriginal
      0x9292: 'SubSecTimeDigitized', // Fractions of seconds for DateTimeDigitized
      0x829a: 'ExposureTime', // Exposure time (in seconds)
      0x829d: 'FNumber',
      0x8822: 'ExposureProgram', // Exposure program
      0x8824: 'SpectralSensitivity', // Spectral sensitivity
      0x8827: 'PhotographicSensitivity', // EXIF 2.3, ISOSpeedRatings in EXIF 2.2
      0x8828: 'OECF', // Optoelectric conversion factor
      0x8830: 'SensitivityType',
      0x8831: 'StandardOutputSensitivity',
      0x8832: 'RecommendedExposureIndex',
      0x8833: 'ISOSpeed',
      0x8834: 'ISOSpeedLatitudeyyy',
      0x8835: 'ISOSpeedLatitudezzz',
      0x9201: 'ShutterSpeedValue', // Shutter speed
      0x9202: 'ApertureValue', // Lens aperture
      0x9203: 'BrightnessValue', // Value of brightness
      0x9204: 'ExposureBias', // Exposure bias
      0x9205: 'MaxApertureValue', // Smallest F number of lens
      0x9206: 'SubjectDistance', // Distance to subject in meters
      0x9207: 'MeteringMode', // Metering mode
      0x9208: 'LightSource', // Kind of light source
      0x9209: 'Flash', // Flash status
      0x9214: 'SubjectArea', // Location and area of main subject
      0x920a: 'FocalLength', // Focal length of the lens in mm
      0xa20b: 'FlashEnergy', // Strobe energy in BCPS
      0xa20c: 'SpatialFrequencyResponse',
      0xa20e: 'FocalPlaneXResolution', // Number of pixels in width direction per FPRUnit
      0xa20f: 'FocalPlaneYResolution', // Number of pixels in height direction per FPRUnit
      0xa210: 'FocalPlaneResolutionUnit', // Unit for measuring the focal plane resolution
      0xa214: 'SubjectLocation', // Location of subject in image
      0xa215: 'ExposureIndex', // Exposure index selected on camera
      0xa217: 'SensingMethod', // Image sensor type
      0xa300: 'FileSource', // Image source (3 == DSC)
      0xa301: 'SceneType', // Scene type (1 == directly photographed)
      0xa302: 'CFAPattern', // Color filter array geometric pattern
      0xa401: 'CustomRendered', // Special processing
      0xa402: 'ExposureMode', // Exposure mode
      0xa403: 'WhiteBalance', // 1 = auto white balance, 2 = manual
      0xa404: 'DigitalZoomRatio', // Digital zoom ratio
      0xa405: 'FocalLengthIn35mmFilm',
      0xa406: 'SceneCaptureType', // Type of scene
      0xa407: 'GainControl', // Degree of overall image gain adjustment
      0xa408: 'Contrast', // Direction of contrast processing applied by camera
      0xa409: 'Saturation', // Direction of saturation processing applied by camera
      0xa40a: 'Sharpness', // Direction of sharpness processing applied by camera
      0xa40b: 'DeviceSettingDescription',
      0xa40c: 'SubjectDistanceRange', // Distance to subject
      0xa420: 'ImageUniqueID', // Identifier assigned uniquely to each image
      0xa430: 'CameraOwnerName',
      0xa431: 'BodySerialNumber',
      0xa432: 'LensSpecification',
      0xa433: 'LensMake',
      0xa434: 'LensModel',
      0xa435: 'LensSerialNumber'
    },
    0x8825: {
      // GPSInfoIFDPointer
      0x0000: 'GPSVersionID',
      0x0001: 'GPSLatitudeRef',
      0x0002: 'GPSLatitude',
      0x0003: 'GPSLongitudeRef',
      0x0004: 'GPSLongitude',
      0x0005: 'GPSAltitudeRef',
      0x0006: 'GPSAltitude',
      0x0007: 'GPSTimeStamp',
      0x0008: 'GPSSatellites',
      0x0009: 'GPSStatus',
      0x000a: 'GPSMeasureMode',
      0x000b: 'GPSDOP',
      0x000c: 'GPSSpeedRef',
      0x000d: 'GPSSpeed',
      0x000e: 'GPSTrackRef',
      0x000f: 'GPSTrack',
      0x0010: 'GPSImgDirectionRef',
      0x0011: 'GPSImgDirection',
      0x0012: 'GPSMapDatum',
      0x0013: 'GPSDestLatitudeRef',
      0x0014: 'GPSDestLatitude',
      0x0015: 'GPSDestLongitudeRef',
      0x0016: 'GPSDestLongitude',
      0x0017: 'GPSDestBearingRef',
      0x0018: 'GPSDestBearing',
      0x0019: 'GPSDestDistanceRef',
      0x001a: 'GPSDestDistance',
      0x001b: 'GPSProcessingMethod',
      0x001c: 'GPSAreaInformation',
      0x001d: 'GPSDateStamp',
      0x001e: 'GPSDifferential',
      0x001f: 'GPSHPositioningError'
    },
    0xa005: {
      // InteroperabilityIFDPointer
      0x0001: 'InteroperabilityIndex'
    }
  }

  // IFD1 directory can contain any IFD0 tags:
  ExifMapProto.tags.ifd1 = ExifMapProto.tags

  ExifMapProto.stringValues = {
    ExposureProgram: {
      0: 'Undefined',
      1: 'Manual',
      2: 'Normal program',
      3: 'Aperture priority',
      4: 'Shutter priority',
      5: 'Creative program',
      6: 'Action program',
      7: 'Portrait mode',
      8: 'Landscape mode'
    },
    MeteringMode: {
      0: 'Unknown',
      1: 'Average',
      2: 'CenterWeightedAverage',
      3: 'Spot',
      4: 'MultiSpot',
      5: 'Pattern',
      6: 'Partial',
      255: 'Other'
    },
    LightSource: {
      0: 'Unknown',
      1: 'Daylight',
      2: 'Fluorescent',
      3: 'Tungsten (incandescent light)',
      4: 'Flash',
      9: 'Fine weather',
      10: 'Cloudy weather',
      11: 'Shade',
      12: 'Daylight fluorescent (D 5700 - 7100K)',
      13: 'Day white fluorescent (N 4600 - 5400K)',
      14: 'Cool white fluorescent (W 3900 - 4500K)',
      15: 'White fluorescent (WW 3200 - 3700K)',
      17: 'Standard light A',
      18: 'Standard light B',
      19: 'Standard light C',
      20: 'D55',
      21: 'D65',
      22: 'D75',
      23: 'D50',
      24: 'ISO studio tungsten',
      255: 'Other'
    },
    Flash: {
      0x0000: 'Flash did not fire',
      0x0001: 'Flash fired',
      0x0005: 'Strobe return light not detected',
      0x0007: 'Strobe return light detected',
      0x0009: 'Flash fired, compulsory flash mode',
      0x000d: 'Flash fired, compulsory flash mode, return light not detected',
      0x000f: 'Flash fired, compulsory flash mode, return light detected',
      0x0010: 'Flash did not fire, compulsory flash mode',
      0x0018: 'Flash did not fire, auto mode',
      0x0019: 'Flash fired, auto mode',
      0x001d: 'Flash fired, auto mode, return light not detected',
      0x001f: 'Flash fired, auto mode, return light detected',
      0x0020: 'No flash function',
      0x0041: 'Flash fired, red-eye reduction mode',
      0x0045: 'Flash fired, red-eye reduction mode, return light not detected',
      0x0047: 'Flash fired, red-eye reduction mode, return light detected',
      0x0049: 'Flash fired, compulsory flash mode, red-eye reduction mode',
      0x004d:
        'Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected',
      0x004f:
        'Flash fired, compulsory flash mode, red-eye reduction mode, return light detected',
      0x0059: 'Flash fired, auto mode, red-eye reduction mode',
      0x005d:
        'Flash fired, auto mode, return light not detected, red-eye reduction mode',
      0x005f:
        'Flash fired, auto mode, return light detected, red-eye reduction mode'
    },
    SensingMethod: {
      1: 'Undefined',
      2: 'One-chip color area sensor',
      3: 'Two-chip color area sensor',
      4: 'Three-chip color area sensor',
      5: 'Color sequential area sensor',
      7: 'Trilinear sensor',
      8: 'Color sequential linear sensor'
    },
    SceneCaptureType: {
      0: 'Standard',
      1: 'Landscape',
      2: 'Portrait',
      3: 'Night scene'
    },
    SceneType: {
      1: 'Directly photographed'
    },
    CustomRendered: {
      0: 'Normal process',
      1: 'Custom process'
    },
    WhiteBalance: {
      0: 'Auto white balance',
      1: 'Manual white balance'
    },
    GainControl: {
      0: 'None',
      1: 'Low gain up',
      2: 'High gain up',
      3: 'Low gain down',
      4: 'High gain down'
    },
    Contrast: {
      0: 'Normal',
      1: 'Soft',
      2: 'Hard'
    },
    Saturation: {
      0: 'Normal',
      1: 'Low saturation',
      2: 'High saturation'
    },
    Sharpness: {
      0: 'Normal',
      1: 'Soft',
      2: 'Hard'
    },
    SubjectDistanceRange: {
      0: 'Unknown',
      1: 'Macro',
      2: 'Close view',
      3: 'Distant view'
    },
    FileSource: {
      3: 'DSC'
    },
    ComponentsConfiguration: {
      0: '',
      1: 'Y',
      2: 'Cb',
      3: 'Cr',
      4: 'R',
      5: 'G',
      6: 'B'
    },
    Orientation: {
      1: 'Original',
      2: 'Horizontal flip',
      3: 'Rotate 180° CCW',
      4: 'Vertical flip',
      5: 'Vertical flip + Rotate 90° CW',
      6: 'Rotate 90° CW',
      7: 'Horizontal flip + Rotate 90° CW',
      8: 'Rotate 90° CCW'
    }
  }

  ExifMapProto.getText = function (name) {
    var value = this.get(name)
    switch (name) {
      case 'LightSource':
      case 'Flash':
      case 'MeteringMode':
      case 'ExposureProgram':
      case 'SensingMethod':
      case 'SceneCaptureType':
      case 'SceneType':
      case 'CustomRendered':
      case 'WhiteBalance':
      case 'GainControl':
      case 'Contrast':
      case 'Saturation':
      case 'Sharpness':
      case 'SubjectDistanceRange':
      case 'FileSource':
      case 'Orientation':
        return this.stringValues[name][value]
      case 'ExifVersion':
      case 'FlashpixVersion':
        if (!value) return
        return String.fromCharCode(value[0], value[1], value[2], value[3])
      case 'ComponentsConfiguration':
        if (!value) return
        return (
          this.stringValues[name][value[0]] +
          this.stringValues[name][value[1]] +
          this.stringValues[name][value[2]] +
          this.stringValues[name][value[3]]
        )
      case 'GPSVersionID':
        if (!value) return
        return value[0] + '.' + value[1] + '.' + value[2] + '.' + value[3]
    }
    return String(value)
  }

  ExifMapProto.getAll = function () {
    var map = {}
    var prop
    var obj
    var name
    for (prop in this) {
      if (Object.prototype.hasOwnProperty.call(this, prop)) {
        obj = this[prop]
        if (obj && obj.getAll) {
          map[this.ifds[prop].name] = obj.getAll()
        } else {
          name = this.tags[prop]
          if (name) map[name] = this.getText(name)
        }
      }
    }
    return map
  }

  ExifMapProto.getName = function (tagCode) {
    var name = this.tags[tagCode]
    if (typeof name === 'object') return this.ifds[tagCode].name
    return name
  }

  // Extend the map of tag names to tag codes:
  ;(function () {
    var tags = ExifMapProto.tags
    var prop
    var ifd
    var subTags
    // Map the tag names to tags:
    for (prop in tags) {
      if (Object.prototype.hasOwnProperty.call(tags, prop)) {
        ifd = ExifMapProto.ifds[prop]
        if (ifd) {
          subTags = tags[prop]
          for (prop in subTags) {
            if (Object.prototype.hasOwnProperty.call(subTags, prop)) {
              ifd.map[subTags[prop]] = Number(prop)
            }
          }
        } else {
          ExifMapProto.map[tags[prop]] = Number(prop)
        }
      }
    }
  })()
})


/***/ }),

/***/ 677:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image Exif Parser
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2013, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, require, DataView */

/* eslint-disable no-console */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302), __webpack_require__(630)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  /**
   * Exif tag map
   *
   * @name ExifMap
   * @class
   * @param {number|string} tagCode IFD tag code
   */
  function ExifMap(tagCode) {
    if (tagCode) {
      Object.defineProperty(this, 'map', {
        value: this.ifds[tagCode].map
      })
      Object.defineProperty(this, 'tags', {
        value: (this.tags && this.tags[tagCode]) || {}
      })
    }
  }

  ExifMap.prototype.map = {
    Orientation: 0x0112,
    Thumbnail: 'ifd1',
    Blob: 0x0201, // Alias for JPEGInterchangeFormat
    Exif: 0x8769,
    GPSInfo: 0x8825,
    Interoperability: 0xa005
  }

  ExifMap.prototype.ifds = {
    ifd1: { name: 'Thumbnail', map: ExifMap.prototype.map },
    0x8769: { name: 'Exif', map: {} },
    0x8825: { name: 'GPSInfo', map: {} },
    0xa005: { name: 'Interoperability', map: {} }
  }

  /**
   * Retrieves exif tag value
   *
   * @param {number|string} id Exif tag code or name
   * @returns {object} Exif tag value
   */
  ExifMap.prototype.get = function (id) {
    return this[id] || this[this.map[id]]
  }

  /**
   * Returns the Exif Thumbnail data as Blob.
   *
   * @param {DataView} dataView Data view interface
   * @param {number} offset Thumbnail data offset
   * @param {number} length Thumbnail data length
   * @returns {undefined|Blob} Returns the Thumbnail Blob or undefined
   */
  function getExifThumbnail(dataView, offset, length) {
    if (!length) return
    if (offset + length > dataView.byteLength) {
      console.log('Invalid Exif data: Invalid thumbnail data.')
      return
    }
    return new Blob(
      [loadImage.bufferSlice.call(dataView.buffer, offset, offset + length)],
      {
        type: 'image/jpeg'
      }
    )
  }

  var ExifTagTypes = {
    // byte, 8-bit unsigned int:
    1: {
      getValue: function (dataView, dataOffset) {
        return dataView.getUint8(dataOffset)
      },
      size: 1
    },
    // ascii, 8-bit byte:
    2: {
      getValue: function (dataView, dataOffset) {
        return String.fromCharCode(dataView.getUint8(dataOffset))
      },
      size: 1,
      ascii: true
    },
    // short, 16 bit int:
    3: {
      getValue: function (dataView, dataOffset, littleEndian) {
        return dataView.getUint16(dataOffset, littleEndian)
      },
      size: 2
    },
    // long, 32 bit int:
    4: {
      getValue: function (dataView, dataOffset, littleEndian) {
        return dataView.getUint32(dataOffset, littleEndian)
      },
      size: 4
    },
    // rational = two long values, first is numerator, second is denominator:
    5: {
      getValue: function (dataView, dataOffset, littleEndian) {
        return (
          dataView.getUint32(dataOffset, littleEndian) /
          dataView.getUint32(dataOffset + 4, littleEndian)
        )
      },
      size: 8
    },
    // slong, 32 bit signed int:
    9: {
      getValue: function (dataView, dataOffset, littleEndian) {
        return dataView.getInt32(dataOffset, littleEndian)
      },
      size: 4
    },
    // srational, two slongs, first is numerator, second is denominator:
    10: {
      getValue: function (dataView, dataOffset, littleEndian) {
        return (
          dataView.getInt32(dataOffset, littleEndian) /
          dataView.getInt32(dataOffset + 4, littleEndian)
        )
      },
      size: 8
    }
  }
  // undefined, 8-bit byte, value depending on field:
  ExifTagTypes[7] = ExifTagTypes[1]

  /**
   * Returns Exif tag value.
   *
   * @param {DataView} dataView Data view interface
   * @param {number} tiffOffset TIFF offset
   * @param {number} offset Tag offset
   * @param {number} type Tag type
   * @param {number} length Tag length
   * @param {boolean} littleEndian Little endian encoding
   * @returns {object} Tag value
   */
  function getExifValue(
    dataView,
    tiffOffset,
    offset,
    type,
    length,
    littleEndian
  ) {
    var tagType = ExifTagTypes[type]
    var tagSize
    var dataOffset
    var values
    var i
    var str
    var c
    if (!tagType) {
      console.log('Invalid Exif data: Invalid tag type.')
      return
    }
    tagSize = tagType.size * length
    // Determine if the value is contained in the dataOffset bytes,
    // or if the value at the dataOffset is a pointer to the actual data:
    dataOffset =
      tagSize > 4
        ? tiffOffset + dataView.getUint32(offset + 8, littleEndian)
        : offset + 8
    if (dataOffset + tagSize > dataView.byteLength) {
      console.log('Invalid Exif data: Invalid data offset.')
      return
    }
    if (length === 1) {
      return tagType.getValue(dataView, dataOffset, littleEndian)
    }
    values = []
    for (i = 0; i < length; i += 1) {
      values[i] = tagType.getValue(
        dataView,
        dataOffset + i * tagType.size,
        littleEndian
      )
    }
    if (tagType.ascii) {
      str = ''
      // Concatenate the chars:
      for (i = 0; i < values.length; i += 1) {
        c = values[i]
        // Ignore the terminating NULL byte(s):
        if (c === '\u0000') {
          break
        }
        str += c
      }
      return str
    }
    return values
  }

  /**
   * Determines if the given tag should be included.
   *
   * @param {object} includeTags Map of tags to include
   * @param {object} excludeTags Map of tags to exclude
   * @param {number|string} tagCode Tag code to check
   * @returns {boolean} True if the tag should be included
   */
  function shouldIncludeTag(includeTags, excludeTags, tagCode) {
    return (
      (!includeTags || includeTags[tagCode]) &&
      (!excludeTags || excludeTags[tagCode] !== true)
    )
  }

  /**
   * Parses Exif tags.
   *
   * @param {DataView} dataView Data view interface
   * @param {number} tiffOffset TIFF offset
   * @param {number} dirOffset Directory offset
   * @param {boolean} littleEndian Little endian encoding
   * @param {ExifMap} tags Map to store parsed exif tags
   * @param {ExifMap} tagOffsets Map to store parsed exif tag offsets
   * @param {object} includeTags Map of tags to include
   * @param {object} excludeTags Map of tags to exclude
   * @returns {number} Next directory offset
   */
  function parseExifTags(
    dataView,
    tiffOffset,
    dirOffset,
    littleEndian,
    tags,
    tagOffsets,
    includeTags,
    excludeTags
  ) {
    var tagsNumber, dirEndOffset, i, tagOffset, tagNumber, tagValue
    if (dirOffset + 6 > dataView.byteLength) {
      console.log('Invalid Exif data: Invalid directory offset.')
      return
    }
    tagsNumber = dataView.getUint16(dirOffset, littleEndian)
    dirEndOffset = dirOffset + 2 + 12 * tagsNumber
    if (dirEndOffset + 4 > dataView.byteLength) {
      console.log('Invalid Exif data: Invalid directory size.')
      return
    }
    for (i = 0; i < tagsNumber; i += 1) {
      tagOffset = dirOffset + 2 + 12 * i
      tagNumber = dataView.getUint16(tagOffset, littleEndian)
      if (!shouldIncludeTag(includeTags, excludeTags, tagNumber)) continue
      tagValue = getExifValue(
        dataView,
        tiffOffset,
        tagOffset,
        dataView.getUint16(tagOffset + 2, littleEndian), // tag type
        dataView.getUint32(tagOffset + 4, littleEndian), // tag length
        littleEndian
      )
      tags[tagNumber] = tagValue
      if (tagOffsets) {
        tagOffsets[tagNumber] = tagOffset
      }
    }
    // Return the offset to the next directory:
    return dataView.getUint32(dirEndOffset, littleEndian)
  }

  /**
   * Parses tags in a given IFD (Image File Directory).
   *
   * @param {object} data Data object to store exif tags and offsets
   * @param {number|string} tagCode IFD tag code
   * @param {DataView} dataView Data view interface
   * @param {number} tiffOffset TIFF offset
   * @param {boolean} littleEndian Little endian encoding
   * @param {object} includeTags Map of tags to include
   * @param {object} excludeTags Map of tags to exclude
   */
  function parseExifIFD(
    data,
    tagCode,
    dataView,
    tiffOffset,
    littleEndian,
    includeTags,
    excludeTags
  ) {
    var dirOffset = data.exif[tagCode]
    if (dirOffset) {
      data.exif[tagCode] = new ExifMap(tagCode)
      if (data.exifOffsets) {
        data.exifOffsets[tagCode] = new ExifMap(tagCode)
      }
      parseExifTags(
        dataView,
        tiffOffset,
        tiffOffset + dirOffset,
        littleEndian,
        data.exif[tagCode],
        data.exifOffsets && data.exifOffsets[tagCode],
        includeTags && includeTags[tagCode],
        excludeTags && excludeTags[tagCode]
      )
    }
  }

  loadImage.parseExifData = function (dataView, offset, length, data, options) {
    if (options.disableExif) {
      return
    }
    var includeTags = options.includeExifTags
    var excludeTags = options.excludeExifTags || {
      0x8769: {
        // ExifIFDPointer
        0x927c: true // MakerNote
      }
    }
    var tiffOffset = offset + 10
    var littleEndian
    var dirOffset
    var thumbnailIFD
    // Check for the ASCII code for "Exif" (0x45786966):
    if (dataView.getUint32(offset + 4) !== 0x45786966) {
      // No Exif data, might be XMP data instead
      return
    }
    if (tiffOffset + 8 > dataView.byteLength) {
      console.log('Invalid Exif data: Invalid segment size.')
      return
    }
    // Check for the two null bytes:
    if (dataView.getUint16(offset + 8) !== 0x0000) {
      console.log('Invalid Exif data: Missing byte alignment offset.')
      return
    }
    // Check the byte alignment:
    switch (dataView.getUint16(tiffOffset)) {
      case 0x4949:
        littleEndian = true
        break
      case 0x4d4d:
        littleEndian = false
        break
      default:
        console.log('Invalid Exif data: Invalid byte alignment marker.')
        return
    }
    // Check for the TIFF tag marker (0x002A):
    if (dataView.getUint16(tiffOffset + 2, littleEndian) !== 0x002a) {
      console.log('Invalid Exif data: Missing TIFF marker.')
      return
    }
    // Retrieve the directory offset bytes, usually 0x00000008 or 8 decimal:
    dirOffset = dataView.getUint32(tiffOffset + 4, littleEndian)
    // Create the exif object to store the tags:
    data.exif = new ExifMap()
    if (!options.disableExifOffsets) {
      data.exifOffsets = new ExifMap()
      data.exifTiffOffset = tiffOffset
      data.exifLittleEndian = littleEndian
    }
    // Parse the tags of the main image directory (IFD0) and retrieve the
    // offset to the next directory (IFD1), usually the thumbnail directory:
    dirOffset = parseExifTags(
      dataView,
      tiffOffset,
      tiffOffset + dirOffset,
      littleEndian,
      data.exif,
      data.exifOffsets,
      includeTags,
      excludeTags
    )
    if (dirOffset && shouldIncludeTag(includeTags, excludeTags, 'ifd1')) {
      data.exif.ifd1 = dirOffset
      if (data.exifOffsets) {
        data.exifOffsets.ifd1 = tiffOffset + dirOffset
      }
    }
    Object.keys(data.exif.ifds).forEach(function (tagCode) {
      parseExifIFD(
        data,
        tagCode,
        dataView,
        tiffOffset,
        littleEndian,
        includeTags,
        excludeTags
      )
    })
    thumbnailIFD = data.exif.ifd1
    // Check for JPEG Thumbnail offset and data length:
    if (thumbnailIFD && thumbnailIFD[0x0201]) {
      thumbnailIFD[0x0201] = getExifThumbnail(
        dataView,
        tiffOffset + thumbnailIFD[0x0201],
        thumbnailIFD[0x0202] // Thumbnail data length
      )
    }
  }

  // Registers the Exif parser for the APP1 JPEG metadata segment:
  loadImage.metaDataParsers.jpeg[0xffe1].push(loadImage.parseExifData)

  loadImage.exifWriters = {
    // Orientation writer:
    0x0112: function (buffer, data, value) {
      var orientationOffset = data.exifOffsets[0x0112]
      if (!orientationOffset) return buffer
      var view = new DataView(buffer, orientationOffset + 8, 2)
      view.setUint16(0, value, data.exifLittleEndian)
      return buffer
    }
  }

  loadImage.writeExifData = function (buffer, data, id, value) {
    return loadImage.exifWriters[data.exif.map[id]](buffer, data, value)
  }

  loadImage.ExifMap = ExifMap

  // Adds the following properties to the parseMetaData callback data:
  // - exif: The parsed Exif tags
  // - exifOffsets: The parsed Exif tag offsets
  // - exifTiffOffset: TIFF header offset (used for offset pointers)
  // - exifLittleEndian: little endian order if true, big endian if false

  // Adds the following options to the parseMetaData method:
  // - disableExif: Disables Exif parsing when true.
  // - disableExifOffsets: Disables storing Exif tag offsets when true.
  // - includeExifTags: A map of Exif tags to include for parsing.
  // - excludeExifTags: A map of Exif tags to exclude from parsing.
})


/***/ }),

/***/ 16:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image Fetch
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2017, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, require, Promise */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  var global = loadImage.global

  if (
    global.fetch &&
    global.Request &&
    global.Response &&
    global.Response.prototype.blob
  ) {
    loadImage.fetchBlob = function (url, callback, options) {
      /**
       * Fetch response handler.
       *
       * @param {Response} response Fetch response
       * @returns {Blob} Fetched Blob.
       */
      function responseHandler(response) {
        return response.blob()
      }
      if (global.Promise && typeof callback !== 'function') {
        return fetch(new Request(url, callback)).then(responseHandler)
      }
      fetch(new Request(url, options))
        .then(responseHandler)
        .then(callback)
        [
          // Avoid parsing error in IE<9, where catch is a reserved word.
          // eslint-disable-next-line dot-notation
          'catch'
        ](function (err) {
          callback(null, err)
        })
    }
  } else if (
    global.XMLHttpRequest &&
    // https://xhr.spec.whatwg.org/#the-responsetype-attribute
    new XMLHttpRequest().responseType === ''
  ) {
    loadImage.fetchBlob = function (url, callback, options) {
      /**
       * Promise executor
       *
       * @param {Function} resolve Resolution function
       * @param {Function} reject Rejection function
       */
      function executor(resolve, reject) {
        options = options || {} // eslint-disable-line no-param-reassign
        var req = new XMLHttpRequest()
        req.open(options.method || 'GET', url)
        if (options.headers) {
          Object.keys(options.headers).forEach(function (key) {
            req.setRequestHeader(key, options.headers[key])
          })
        }
        req.withCredentials = options.credentials === 'include'
        req.responseType = 'blob'
        req.onload = function () {
          resolve(req.response)
        }
        req.onerror =
          req.onabort =
          req.ontimeout =
            function (err) {
              if (resolve === reject) {
                // Not using Promises
                reject(null, err)
              } else {
                reject(err)
              }
            }
        req.send(options.body)
      }
      if (global.Promise && typeof callback !== 'function') {
        options = callback // eslint-disable-line no-param-reassign
        return new Promise(executor)
      }
      return executor(callback, callback)
    }
  }
})


/***/ }),

/***/ 140:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image IPTC Map
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2013, Sebastian Tschan
 * Copyright 2018, Dave Bevan
 *
 * IPTC tags mapping based on
 * https://iptc.org/standards/photo-metadata
 * https://exiftool.org/TagNames/IPTC.html
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, require */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302), __webpack_require__(166)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  var IptcMapProto = loadImage.IptcMap.prototype

  IptcMapProto.tags = {
    0: 'ApplicationRecordVersion',
    3: 'ObjectTypeReference',
    4: 'ObjectAttributeReference',
    5: 'ObjectName',
    7: 'EditStatus',
    8: 'EditorialUpdate',
    10: 'Urgency',
    12: 'SubjectReference',
    15: 'Category',
    20: 'SupplementalCategories',
    22: 'FixtureIdentifier',
    25: 'Keywords',
    26: 'ContentLocationCode',
    27: 'ContentLocationName',
    30: 'ReleaseDate',
    35: 'ReleaseTime',
    37: 'ExpirationDate',
    38: 'ExpirationTime',
    40: 'SpecialInstructions',
    42: 'ActionAdvised',
    45: 'ReferenceService',
    47: 'ReferenceDate',
    50: 'ReferenceNumber',
    55: 'DateCreated',
    60: 'TimeCreated',
    62: 'DigitalCreationDate',
    63: 'DigitalCreationTime',
    65: 'OriginatingProgram',
    70: 'ProgramVersion',
    75: 'ObjectCycle',
    80: 'Byline',
    85: 'BylineTitle',
    90: 'City',
    92: 'Sublocation',
    95: 'State',
    100: 'CountryCode',
    101: 'Country',
    103: 'OriginalTransmissionReference',
    105: 'Headline',
    110: 'Credit',
    115: 'Source',
    116: 'CopyrightNotice',
    118: 'Contact',
    120: 'Caption',
    121: 'LocalCaption',
    122: 'Writer',
    125: 'RasterizedCaption',
    130: 'ImageType',
    131: 'ImageOrientation',
    135: 'LanguageIdentifier',
    150: 'AudioType',
    151: 'AudioSamplingRate',
    152: 'AudioSamplingResolution',
    153: 'AudioDuration',
    154: 'AudioOutcue',
    184: 'JobID',
    185: 'MasterDocumentID',
    186: 'ShortDocumentID',
    187: 'UniqueDocumentID',
    188: 'OwnerID',
    200: 'ObjectPreviewFileFormat',
    201: 'ObjectPreviewFileVersion',
    202: 'ObjectPreviewData',
    221: 'Prefs',
    225: 'ClassifyState',
    228: 'SimilarityIndex',
    230: 'DocumentNotes',
    231: 'DocumentHistory',
    232: 'ExifCameraInfo',
    255: 'CatalogSets'
  }

  IptcMapProto.stringValues = {
    10: {
      0: '0 (reserved)',
      1: '1 (most urgent)',
      2: '2',
      3: '3',
      4: '4',
      5: '5 (normal urgency)',
      6: '6',
      7: '7',
      8: '8 (least urgent)',
      9: '9 (user-defined priority)'
    },
    75: {
      a: 'Morning',
      b: 'Both Morning and Evening',
      p: 'Evening'
    },
    131: {
      L: 'Landscape',
      P: 'Portrait',
      S: 'Square'
    }
  }

  IptcMapProto.getText = function (id) {
    var value = this.get(id)
    var tagCode = this.map[id]
    var stringValue = this.stringValues[tagCode]
    if (stringValue) return stringValue[value]
    return String(value)
  }

  IptcMapProto.getAll = function () {
    var map = {}
    var prop
    var name
    for (prop in this) {
      if (Object.prototype.hasOwnProperty.call(this, prop)) {
        name = this.tags[prop]
        if (name) map[name] = this.getText(name)
      }
    }
    return map
  }

  IptcMapProto.getName = function (tagCode) {
    return this.tags[tagCode]
  }

  // Extend the map of tag names to tag codes:
  ;(function () {
    var tags = IptcMapProto.tags
    var map = IptcMapProto.map || {}
    var prop
    // Map the tag names to tags:
    for (prop in tags) {
      if (Object.prototype.hasOwnProperty.call(tags, prop)) {
        map[tags[prop]] = Number(prop)
      }
    }
  })()
})


/***/ }),

/***/ 166:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image IPTC Parser
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2013, Sebastian Tschan
 * Copyright 2018, Dave Bevan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, require, DataView */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302), __webpack_require__(630)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  /**
   * IPTC tag map
   *
   * @name IptcMap
   * @class
   */
  function IptcMap() {}

  IptcMap.prototype.map = {
    ObjectName: 5
  }

  IptcMap.prototype.types = {
    0: 'Uint16', // ApplicationRecordVersion
    200: 'Uint16', // ObjectPreviewFileFormat
    201: 'Uint16', // ObjectPreviewFileVersion
    202: 'binary' // ObjectPreviewData
  }

  /**
   * Retrieves IPTC tag value
   *
   * @param {number|string} id IPTC tag code or name
   * @returns {object} IPTC tag value
   */
  IptcMap.prototype.get = function (id) {
    return this[id] || this[this.map[id]]
  }

  /**
   * Retrieves string for the given DataView and range
   *
   * @param {DataView} dataView Data view interface
   * @param {number} offset Offset start
   * @param {number} length Offset length
   * @returns {string} String value
   */
  function getStringValue(dataView, offset, length) {
    var outstr = ''
    var end = offset + length
    for (var n = offset; n < end; n += 1) {
      outstr += String.fromCharCode(dataView.getUint8(n))
    }
    return outstr
  }

  /**
   * Retrieves tag value for the given DataView and range
   *
   * @param {number} tagCode tag code
   * @param {IptcMap} map IPTC tag map
   * @param {DataView} dataView Data view interface
   * @param {number} offset Range start
   * @param {number} length Range length
   * @returns {object} Tag value
   */
  function getTagValue(tagCode, map, dataView, offset, length) {
    if (map.types[tagCode] === 'binary') {
      return new Blob([dataView.buffer.slice(offset, offset + length)])
    }
    if (map.types[tagCode] === 'Uint16') {
      return dataView.getUint16(offset)
    }
    return getStringValue(dataView, offset, length)
  }

  /**
   * Combines IPTC value with existing ones.
   *
   * @param {object} value Existing IPTC field value
   * @param {object} newValue New IPTC field value
   * @returns {object} Resulting IPTC field value
   */
  function combineTagValues(value, newValue) {
    if (value === undefined) return newValue
    if (value instanceof Array) {
      value.push(newValue)
      return value
    }
    return [value, newValue]
  }

  /**
   * Parses IPTC tags.
   *
   * @param {DataView} dataView Data view interface
   * @param {number} segmentOffset Segment offset
   * @param {number} segmentLength Segment length
   * @param {object} data Data export object
   * @param {object} includeTags Map of tags to include
   * @param {object} excludeTags Map of tags to exclude
   */
  function parseIptcTags(
    dataView,
    segmentOffset,
    segmentLength,
    data,
    includeTags,
    excludeTags
  ) {
    var value, tagSize, tagCode
    var segmentEnd = segmentOffset + segmentLength
    var offset = segmentOffset
    while (offset < segmentEnd) {
      if (
        dataView.getUint8(offset) === 0x1c && // tag marker
        dataView.getUint8(offset + 1) === 0x02 // record number, only handles v2
      ) {
        tagCode = dataView.getUint8(offset + 2)
        if (
          (!includeTags || includeTags[tagCode]) &&
          (!excludeTags || !excludeTags[tagCode])
        ) {
          tagSize = dataView.getInt16(offset + 3)
          value = getTagValue(tagCode, data.iptc, dataView, offset + 5, tagSize)
          data.iptc[tagCode] = combineTagValues(data.iptc[tagCode], value)
          if (data.iptcOffsets) {
            data.iptcOffsets[tagCode] = offset
          }
        }
      }
      offset += 1
    }
  }

  /**
   * Tests if field segment starts at offset.
   *
   * @param {DataView} dataView Data view interface
   * @param {number} offset Segment offset
   * @returns {boolean} True if '8BIM<EOT><EOT>' exists at offset
   */
  function isSegmentStart(dataView, offset) {
    return (
      dataView.getUint32(offset) === 0x3842494d && // Photoshop segment start
      dataView.getUint16(offset + 4) === 0x0404 // IPTC segment start
    )
  }

  /**
   * Returns header length.
   *
   * @param {DataView} dataView Data view interface
   * @param {number} offset Segment offset
   * @returns {number} Header length
   */
  function getHeaderLength(dataView, offset) {
    var length = dataView.getUint8(offset + 7)
    if (length % 2 !== 0) length += 1
    // Check for pre photoshop 6 format
    if (length === 0) {
      // Always 4
      length = 4
    }
    return length
  }

  loadImage.parseIptcData = function (dataView, offset, length, data, options) {
    if (options.disableIptc) {
      return
    }
    var markerLength = offset + length
    while (offset + 8 < markerLength) {
      if (isSegmentStart(dataView, offset)) {
        var headerLength = getHeaderLength(dataView, offset)
        var segmentOffset = offset + 8 + headerLength
        if (segmentOffset > markerLength) {
          // eslint-disable-next-line no-console
          console.log('Invalid IPTC data: Invalid segment offset.')
          break
        }
        var segmentLength = dataView.getUint16(offset + 6 + headerLength)
        if (offset + segmentLength > markerLength) {
          // eslint-disable-next-line no-console
          console.log('Invalid IPTC data: Invalid segment size.')
          break
        }
        // Create the iptc object to store the tags:
        data.iptc = new IptcMap()
        if (!options.disableIptcOffsets) {
          data.iptcOffsets = new IptcMap()
        }
        parseIptcTags(
          dataView,
          segmentOffset,
          segmentLength,
          data,
          options.includeIptcTags,
          options.excludeIptcTags || { 202: true } // ObjectPreviewData
        )
        return
      }
      // eslint-disable-next-line no-param-reassign
      offset += 1
    }
  }

  // Registers this IPTC parser for the APP13 JPEG metadata segment:
  loadImage.metaDataParsers.jpeg[0xffed].push(loadImage.parseIptcData)

  loadImage.IptcMap = IptcMap

  // Adds the following properties to the parseMetaData callback data:
  // - iptc: The iptc tags, parsed by the parseIptcData method

  // Adds the following options to the parseMetaData method:
  // - disableIptc: Disables IPTC parsing when true.
  // - disableIptcOffsets: Disables storing IPTC tag offsets when true.
  // - includeIptcTags: A map of IPTC tags to include for parsing.
  // - excludeIptcTags: A map of IPTC tags to exclude from parsing.
})


/***/ }),

/***/ 630:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image Meta
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2013, Sebastian Tschan
 * https://blueimp.net
 *
 * Image metadata handling implementation
 * based on the help and contribution of
 * Achim Stöhr.
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, require, Promise, DataView, Uint8Array, ArrayBuffer */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  var global = loadImage.global
  var originalTransform = loadImage.transform

  var blobSlice =
    global.Blob &&
    (Blob.prototype.slice ||
      Blob.prototype.webkitSlice ||
      Blob.prototype.mozSlice)

  var bufferSlice =
    (global.ArrayBuffer && ArrayBuffer.prototype.slice) ||
    function (begin, end) {
      // Polyfill for IE10, which does not support ArrayBuffer.slice
      // eslint-disable-next-line no-param-reassign
      end = end || this.byteLength - begin
      var arr1 = new Uint8Array(this, begin, end)
      var arr2 = new Uint8Array(end)
      arr2.set(arr1)
      return arr2.buffer
    }

  var metaDataParsers = {
    jpeg: {
      0xffe1: [], // APP1 marker
      0xffed: [] // APP13 marker
    }
  }

  /**
   * Parses image metadata and calls the callback with an object argument
   * with the following property:
   * - imageHead: The complete image head as ArrayBuffer
   * The options argument accepts an object and supports the following
   * properties:
   * - maxMetaDataSize: Defines the maximum number of bytes to parse.
   * - disableImageHead: Disables creating the imageHead property.
   *
   * @param {Blob} file Blob object
   * @param {Function} [callback] Callback function
   * @param {object} [options] Parsing options
   * @param {object} [data] Result data object
   * @returns {Promise<object>|undefined} Returns Promise if no callback given.
   */
  function parseMetaData(file, callback, options, data) {
    var that = this
    /**
     * Promise executor
     *
     * @param {Function} resolve Resolution function
     * @param {Function} reject Rejection function
     * @returns {undefined} Undefined
     */
    function executor(resolve, reject) {
      if (
        !(
          global.DataView &&
          blobSlice &&
          file &&
          file.size >= 12 &&
          file.type === 'image/jpeg'
        )
      ) {
        // Nothing to parse
        return resolve(data)
      }
      // 256 KiB should contain all EXIF/ICC/IPTC segments:
      var maxMetaDataSize = options.maxMetaDataSize || 262144
      if (
        !loadImage.readFile(
          blobSlice.call(file, 0, maxMetaDataSize),
          function (buffer) {
            // Note on endianness:
            // Since the marker and length bytes in JPEG files are always
            // stored in big endian order, we can leave the endian parameter
            // of the DataView methods undefined, defaulting to big endian.
            var dataView = new DataView(buffer)
            // Check for the JPEG marker (0xffd8):
            if (dataView.getUint16(0) !== 0xffd8) {
              return reject(
                new Error('Invalid JPEG file: Missing JPEG marker.')
              )
            }
            var offset = 2
            var maxOffset = dataView.byteLength - 4
            var headLength = offset
            var markerBytes
            var markerLength
            var parsers
            var i
            while (offset < maxOffset) {
              markerBytes = dataView.getUint16(offset)
              // Search for APPn (0xffeN) and COM (0xfffe) markers,
              // which contain application-specific metadata like
              // Exif, ICC and IPTC data and text comments:
              if (
                (markerBytes >= 0xffe0 && markerBytes <= 0xffef) ||
                markerBytes === 0xfffe
              ) {
                // The marker bytes (2) are always followed by
                // the length bytes (2), indicating the length of the
                // marker segment, which includes the length bytes,
                // but not the marker bytes, so we add 2:
                markerLength = dataView.getUint16(offset + 2) + 2
                if (offset + markerLength > dataView.byteLength) {
                  // eslint-disable-next-line no-console
                  console.log('Invalid JPEG metadata: Invalid segment size.')
                  break
                }
                parsers = metaDataParsers.jpeg[markerBytes]
                if (parsers && !options.disableMetaDataParsers) {
                  for (i = 0; i < parsers.length; i += 1) {
                    parsers[i].call(
                      that,
                      dataView,
                      offset,
                      markerLength,
                      data,
                      options
                    )
                  }
                }
                offset += markerLength
                headLength = offset
              } else {
                // Not an APPn or COM marker, probably safe to
                // assume that this is the end of the metadata
                break
              }
            }
            // Meta length must be longer than JPEG marker (2)
            // plus APPn marker (2), followed by length bytes (2):
            if (!options.disableImageHead && headLength > 6) {
              data.imageHead = bufferSlice.call(buffer, 0, headLength)
            }
            resolve(data)
          },
          reject,
          'readAsArrayBuffer'
        )
      ) {
        // No support for the FileReader interface, nothing to parse
        resolve(data)
      }
    }
    options = options || {} // eslint-disable-line no-param-reassign
    if (global.Promise && typeof callback !== 'function') {
      options = callback || {} // eslint-disable-line no-param-reassign
      data = options // eslint-disable-line no-param-reassign
      return new Promise(executor)
    }
    data = data || {} // eslint-disable-line no-param-reassign
    return executor(callback, callback)
  }

  /**
   * Replaces the head of a JPEG Blob
   *
   * @param {Blob} blob Blob object
   * @param {ArrayBuffer} oldHead Old JPEG head
   * @param {ArrayBuffer} newHead New JPEG head
   * @returns {Blob} Combined Blob
   */
  function replaceJPEGHead(blob, oldHead, newHead) {
    if (!blob || !oldHead || !newHead) return null
    return new Blob([newHead, blobSlice.call(blob, oldHead.byteLength)], {
      type: 'image/jpeg'
    })
  }

  /**
   * Replaces the image head of a JPEG blob with the given one.
   * Returns a Promise or calls the callback with the new Blob.
   *
   * @param {Blob} blob Blob object
   * @param {ArrayBuffer} head New JPEG head
   * @param {Function} [callback] Callback function
   * @returns {Promise<Blob|null>|undefined} Combined Blob
   */
  function replaceHead(blob, head, callback) {
    var options = { maxMetaDataSize: 1024, disableMetaDataParsers: true }
    if (!callback && global.Promise) {
      return parseMetaData(blob, options).then(function (data) {
        return replaceJPEGHead(blob, data.imageHead, head)
      })
    }
    parseMetaData(
      blob,
      function (data) {
        callback(replaceJPEGHead(blob, data.imageHead, head))
      },
      options
    )
  }

  loadImage.transform = function (img, options, callback, file, data) {
    if (loadImage.requiresMetaData(options)) {
      data = data || {} // eslint-disable-line no-param-reassign
      parseMetaData(
        file,
        function (result) {
          if (result !== data) {
            // eslint-disable-next-line no-console
            if (global.console) console.log(result)
            result = data // eslint-disable-line no-param-reassign
          }
          originalTransform.call(
            loadImage,
            img,
            options,
            callback,
            file,
            result
          )
        },
        options,
        data
      )
    } else {
      originalTransform.apply(loadImage, arguments)
    }
  }

  loadImage.blobSlice = blobSlice
  loadImage.bufferSlice = bufferSlice
  loadImage.replaceHead = replaceHead
  loadImage.parseMetaData = parseMetaData
  loadImage.metaDataParsers = metaDataParsers
})


/***/ }),

/***/ 922:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image Orientation
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2013, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/*
Exif orientation values to correctly display the letter F:

    1             2
  ██████        ██████
  ██                ██
  ████            ████
  ██                ██
  ██                ██

    3             4
      ██        ██
      ██        ██
    ████        ████
      ██        ██
  ██████        ██████

    5             6
██████████    ██
██  ██        ██  ██
██            ██████████

    7             8
        ██    ██████████
    ██  ██        ██  ██
██████████            ██

*/

/* global define, module, require */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302), __webpack_require__(200), __webpack_require__(630)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  var originalTransform = loadImage.transform
  var originalRequiresCanvas = loadImage.requiresCanvas
  var originalRequiresMetaData = loadImage.requiresMetaData
  var originalTransformCoordinates = loadImage.transformCoordinates
  var originalGetTransformedOptions = loadImage.getTransformedOptions

  ;(function ($) {
    // Guard for non-browser environments (e.g. server-side rendering):
    if (!$.global.document) return
    // black+white 3x2 JPEG, with the following meta information set:
    // - EXIF Orientation: 6 (Rotated 90° CCW)
    // Image data layout (B=black, F=white):
    // BFF
    // BBB
    var testImageURL =
      'data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAA' +
      'AAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA' +
      'QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQE' +
      'BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/x' +
      'ABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAA' +
      'AAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQ' +
      'voP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXw' +
      'H/9k='
    var img = document.createElement('img')
    img.onload = function () {
      // Check if the browser supports automatic image orientation:
      $.orientation = img.width === 2 && img.height === 3
      if ($.orientation) {
        var canvas = $.createCanvas(1, 1, true)
        var ctx = canvas.getContext('2d')
        ctx.drawImage(img, 1, 1, 1, 1, 0, 0, 1, 1)
        // Check if the source image coordinates (sX, sY, sWidth, sHeight) are
        // correctly applied to the auto-orientated image, which should result
        // in a white opaque pixel (e.g. in Safari).
        // Browsers that show a transparent pixel (e.g. Chromium) fail to crop
        // auto-oriented images correctly and require a workaround, e.g.
        // drawing the complete source image to an intermediate canvas first.
        // See https://bugs.chromium.org/p/chromium/issues/detail?id=1074354
        $.orientationCropBug =
          ctx.getImageData(0, 0, 1, 1).data.toString() !== '255,255,255,255'
      }
    }
    img.src = testImageURL
  })(loadImage)

  /**
   * Determines if the orientation requires a canvas element.
   *
   * @param {object} [options] Options object
   * @param {boolean} [withMetaData] Is metadata required for orientation
   * @returns {boolean} Returns true if orientation requires canvas/meta
   */
  function requiresCanvasOrientation(options, withMetaData) {
    var orientation = options && options.orientation
    return (
      // Exif orientation for browsers without automatic image orientation:
      (orientation === true && !loadImage.orientation) ||
      // Orientation reset for browsers with automatic image orientation:
      (orientation === 1 && loadImage.orientation) ||
      // Orientation to defined value, requires meta for orientation reset only:
      ((!withMetaData || loadImage.orientation) &&
        orientation > 1 &&
        orientation < 9)
    )
  }

  /**
   * Determines if the image requires an orientation change.
   *
   * @param {number} [orientation] Defined orientation value
   * @param {number} [autoOrientation] Auto-orientation based on Exif data
   * @returns {boolean} Returns true if an orientation change is required
   */
  function requiresOrientationChange(orientation, autoOrientation) {
    return (
      orientation !== autoOrientation &&
      ((orientation === 1 && autoOrientation > 1 && autoOrientation < 9) ||
        (orientation > 1 && orientation < 9))
    )
  }

  /**
   * Determines orientation combinations that require a rotation by 180°.
   *
   * The following is a list of combinations that return true:
   *
   * 2 (flip) => 5 (rot90,flip), 7 (rot90,flip), 6 (rot90), 8 (rot90)
   * 4 (flip) => 5 (rot90,flip), 7 (rot90,flip), 6 (rot90), 8 (rot90)
   *
   * 5 (rot90,flip) => 2 (flip), 4 (flip), 6 (rot90), 8 (rot90)
   * 7 (rot90,flip) => 2 (flip), 4 (flip), 6 (rot90), 8 (rot90)
   *
   * 6 (rot90) => 2 (flip), 4 (flip), 5 (rot90,flip), 7 (rot90,flip)
   * 8 (rot90) => 2 (flip), 4 (flip), 5 (rot90,flip), 7 (rot90,flip)
   *
   * @param {number} [orientation] Defined orientation value
   * @param {number} [autoOrientation] Auto-orientation based on Exif data
   * @returns {boolean} Returns true if rotation by 180° is required
   */
  function requiresRot180(orientation, autoOrientation) {
    if (autoOrientation > 1 && autoOrientation < 9) {
      switch (orientation) {
        case 2:
        case 4:
          return autoOrientation > 4
        case 5:
        case 7:
          return autoOrientation % 2 === 0
        case 6:
        case 8:
          return (
            autoOrientation === 2 ||
            autoOrientation === 4 ||
            autoOrientation === 5 ||
            autoOrientation === 7
          )
      }
    }
    return false
  }

  // Determines if the target image should be a canvas element:
  loadImage.requiresCanvas = function (options) {
    return (
      requiresCanvasOrientation(options) ||
      originalRequiresCanvas.call(loadImage, options)
    )
  }

  // Determines if metadata should be loaded automatically:
  loadImage.requiresMetaData = function (options) {
    return (
      requiresCanvasOrientation(options, true) ||
      originalRequiresMetaData.call(loadImage, options)
    )
  }

  loadImage.transform = function (img, options, callback, file, data) {
    originalTransform.call(
      loadImage,
      img,
      options,
      function (img, data) {
        if (data) {
          var autoOrientation =
            loadImage.orientation && data.exif && data.exif.get('Orientation')
          if (autoOrientation > 4 && autoOrientation < 9) {
            // Automatic image orientation switched image dimensions
            var originalWidth = data.originalWidth
            var originalHeight = data.originalHeight
            data.originalWidth = originalHeight
            data.originalHeight = originalWidth
          }
        }
        callback(img, data)
      },
      file,
      data
    )
  }

  // Transforms coordinate and dimension options
  // based on the given orientation option:
  loadImage.getTransformedOptions = function (img, opts, data) {
    var options = originalGetTransformedOptions.call(loadImage, img, opts)
    var exifOrientation = data.exif && data.exif.get('Orientation')
    var orientation = options.orientation
    var autoOrientation = loadImage.orientation && exifOrientation
    if (orientation === true) orientation = exifOrientation
    if (!requiresOrientationChange(orientation, autoOrientation)) {
      return options
    }
    var top = options.top
    var right = options.right
    var bottom = options.bottom
    var left = options.left
    var newOptions = {}
    for (var i in options) {
      if (Object.prototype.hasOwnProperty.call(options, i)) {
        newOptions[i] = options[i]
      }
    }
    newOptions.orientation = orientation
    if (
      (orientation > 4 && !(autoOrientation > 4)) ||
      (orientation < 5 && autoOrientation > 4)
    ) {
      // Image dimensions and target dimensions are switched
      newOptions.maxWidth = options.maxHeight
      newOptions.maxHeight = options.maxWidth
      newOptions.minWidth = options.minHeight
      newOptions.minHeight = options.minWidth
      newOptions.sourceWidth = options.sourceHeight
      newOptions.sourceHeight = options.sourceWidth
    }
    if (autoOrientation > 1) {
      // Browsers which correctly apply source image coordinates to
      // auto-oriented images
      switch (autoOrientation) {
        case 2:
          // Horizontal flip
          right = options.left
          left = options.right
          break
        case 3:
          // 180° Rotate CCW
          top = options.bottom
          right = options.left
          bottom = options.top
          left = options.right
          break
        case 4:
          // Vertical flip
          top = options.bottom
          bottom = options.top
          break
        case 5:
          // Horizontal flip + 90° Rotate CCW
          top = options.left
          right = options.bottom
          bottom = options.right
          left = options.top
          break
        case 6:
          // 90° Rotate CCW
          top = options.left
          right = options.top
          bottom = options.right
          left = options.bottom
          break
        case 7:
          // Vertical flip + 90° Rotate CCW
          top = options.right
          right = options.top
          bottom = options.left
          left = options.bottom
          break
        case 8:
          // 90° Rotate CW
          top = options.right
          right = options.bottom
          bottom = options.left
          left = options.top
          break
      }
      // Some orientation combinations require additional rotation by 180°:
      if (requiresRot180(orientation, autoOrientation)) {
        var tmpTop = top
        var tmpRight = right
        top = bottom
        right = left
        bottom = tmpTop
        left = tmpRight
      }
    }
    newOptions.top = top
    newOptions.right = right
    newOptions.bottom = bottom
    newOptions.left = left
    // Account for defined browser orientation:
    switch (orientation) {
      case 2:
        // Horizontal flip
        newOptions.right = left
        newOptions.left = right
        break
      case 3:
        // 180° Rotate CCW
        newOptions.top = bottom
        newOptions.right = left
        newOptions.bottom = top
        newOptions.left = right
        break
      case 4:
        // Vertical flip
        newOptions.top = bottom
        newOptions.bottom = top
        break
      case 5:
        // Vertical flip + 90° Rotate CW
        newOptions.top = left
        newOptions.right = bottom
        newOptions.bottom = right
        newOptions.left = top
        break
      case 6:
        // 90° Rotate CW
        newOptions.top = right
        newOptions.right = bottom
        newOptions.bottom = left
        newOptions.left = top
        break
      case 7:
        // Horizontal flip + 90° Rotate CW
        newOptions.top = right
        newOptions.right = top
        newOptions.bottom = left
        newOptions.left = bottom
        break
      case 8:
        // 90° Rotate CCW
        newOptions.top = left
        newOptions.right = top
        newOptions.bottom = right
        newOptions.left = bottom
        break
    }
    return newOptions
  }

  // Transform image orientation based on the given EXIF orientation option:
  loadImage.transformCoordinates = function (canvas, options, data) {
    originalTransformCoordinates.call(loadImage, canvas, options, data)
    var orientation = options.orientation
    var autoOrientation =
      loadImage.orientation && data.exif && data.exif.get('Orientation')
    if (!requiresOrientationChange(orientation, autoOrientation)) {
      return
    }
    var ctx = canvas.getContext('2d')
    var width = canvas.width
    var height = canvas.height
    var sourceWidth = width
    var sourceHeight = height
    if (
      (orientation > 4 && !(autoOrientation > 4)) ||
      (orientation < 5 && autoOrientation > 4)
    ) {
      // Image dimensions and target dimensions are switched
      canvas.width = height
      canvas.height = width
    }
    if (orientation > 4) {
      // Destination and source dimensions are switched
      sourceWidth = height
      sourceHeight = width
    }
    // Reset automatic browser orientation:
    switch (autoOrientation) {
      case 2:
        // Horizontal flip
        ctx.translate(sourceWidth, 0)
        ctx.scale(-1, 1)
        break
      case 3:
        // 180° Rotate CCW
        ctx.translate(sourceWidth, sourceHeight)
        ctx.rotate(Math.PI)
        break
      case 4:
        // Vertical flip
        ctx.translate(0, sourceHeight)
        ctx.scale(1, -1)
        break
      case 5:
        // Horizontal flip + 90° Rotate CCW
        ctx.rotate(-0.5 * Math.PI)
        ctx.scale(-1, 1)
        break
      case 6:
        // 90° Rotate CCW
        ctx.rotate(-0.5 * Math.PI)
        ctx.translate(-sourceWidth, 0)
        break
      case 7:
        // Vertical flip + 90° Rotate CCW
        ctx.rotate(-0.5 * Math.PI)
        ctx.translate(-sourceWidth, sourceHeight)
        ctx.scale(1, -1)
        break
      case 8:
        // 90° Rotate CW
        ctx.rotate(0.5 * Math.PI)
        ctx.translate(0, -sourceHeight)
        break
    }
    // Some orientation combinations require additional rotation by 180°:
    if (requiresRot180(orientation, autoOrientation)) {
      ctx.translate(sourceWidth, sourceHeight)
      ctx.rotate(Math.PI)
    }
    switch (orientation) {
      case 2:
        // Horizontal flip
        ctx.translate(width, 0)
        ctx.scale(-1, 1)
        break
      case 3:
        // 180° Rotate CCW
        ctx.translate(width, height)
        ctx.rotate(Math.PI)
        break
      case 4:
        // Vertical flip
        ctx.translate(0, height)
        ctx.scale(1, -1)
        break
      case 5:
        // Vertical flip + 90° Rotate CW
        ctx.rotate(0.5 * Math.PI)
        ctx.scale(1, -1)
        break
      case 6:
        // 90° Rotate CW
        ctx.rotate(0.5 * Math.PI)
        ctx.translate(0, -height)
        break
      case 7:
        // Horizontal flip + 90° Rotate CW
        ctx.rotate(0.5 * Math.PI)
        ctx.translate(width, -height)
        ctx.scale(-1, 1)
        break
      case 8:
        // 90° Rotate CCW
        ctx.rotate(-0.5 * Math.PI)
        ctx.translate(-width, 0)
        break
    }
  }
})


/***/ }),

/***/ 200:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image Scaling
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, require */

;(function (factory) {
  'use strict'
  if (true) {
    // Register as an anonymous AMD module:
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(302)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})(function (loadImage) {
  'use strict'

  var originalTransform = loadImage.transform

  loadImage.createCanvas = function (width, height, offscreen) {
    if (offscreen && loadImage.global.OffscreenCanvas) {
      return new OffscreenCanvas(width, height)
    }
    var canvas = document.createElement('canvas')
    canvas.width = width
    canvas.height = height
    return canvas
  }

  loadImage.transform = function (img, options, callback, file, data) {
    originalTransform.call(
      loadImage,
      loadImage.scale(img, options, data),
      options,
      callback,
      file,
      data
    )
  }

  // Transform image coordinates, allows to override e.g.
  // the canvas orientation based on the orientation option,
  // gets canvas, options and data passed as arguments:
  loadImage.transformCoordinates = function () {}

  // Returns transformed options, allows to override e.g.
  // maxWidth, maxHeight and crop options based on the aspectRatio.
  // gets img, options, data passed as arguments:
  loadImage.getTransformedOptions = function (img, options) {
    var aspectRatio = options.aspectRatio
    var newOptions
    var i
    var width
    var height
    if (!aspectRatio) {
      return options
    }
    newOptions = {}
    for (i in options) {
      if (Object.prototype.hasOwnProperty.call(options, i)) {
        newOptions[i] = options[i]
      }
    }
    newOptions.crop = true
    width = img.naturalWidth || img.width
    height = img.naturalHeight || img.height
    if (width / height > aspectRatio) {
      newOptions.maxWidth = height * aspectRatio
      newOptions.maxHeight = height
    } else {
      newOptions.maxWidth = width
      newOptions.maxHeight = width / aspectRatio
    }
    return newOptions
  }

  // Canvas render method, allows to implement a different rendering algorithm:
  loadImage.drawImage = function (
    img,
    canvas,
    sourceX,
    sourceY,
    sourceWidth,
    sourceHeight,
    destWidth,
    destHeight,
    options
  ) {
    var ctx = canvas.getContext('2d')
    if (options.imageSmoothingEnabled === false) {
      ctx.msImageSmoothingEnabled = false
      ctx.imageSmoothingEnabled = false
    } else if (options.imageSmoothingQuality) {
      ctx.imageSmoothingQuality = options.imageSmoothingQuality
    }
    ctx.drawImage(
      img,
      sourceX,
      sourceY,
      sourceWidth,
      sourceHeight,
      0,
      0,
      destWidth,
      destHeight
    )
    return ctx
  }

  // Determines if the target image should be a canvas element:
  loadImage.requiresCanvas = function (options) {
    return options.canvas || options.crop || !!options.aspectRatio
  }

  // Scales and/or crops the given image (img or canvas HTML element)
  // using the given options:
  loadImage.scale = function (img, options, data) {
    // eslint-disable-next-line no-param-reassign
    options = options || {}
    // eslint-disable-next-line no-param-reassign
    data = data || {}
    var useCanvas =
      img.getContext ||
      (loadImage.requiresCanvas(options) &&
        !!loadImage.global.HTMLCanvasElement)
    var width = img.naturalWidth || img.width
    var height = img.naturalHeight || img.height
    var destWidth = width
    var destHeight = height
    var maxWidth
    var maxHeight
    var minWidth
    var minHeight
    var sourceWidth
    var sourceHeight
    var sourceX
    var sourceY
    var pixelRatio
    var downsamplingRatio
    var tmp
    var canvas
    /**
     * Scales up image dimensions
     */
    function scaleUp() {
      var scale = Math.max(
        (minWidth || destWidth) / destWidth,
        (minHeight || destHeight) / destHeight
      )
      if (scale > 1) {
        destWidth *= scale
        destHeight *= scale
      }
    }
    /**
     * Scales down image dimensions
     */
    function scaleDown() {
      var scale = Math.min(
        (maxWidth || destWidth) / destWidth,
        (maxHeight || destHeight) / destHeight
      )
      if (scale < 1) {
        destWidth *= scale
        destHeight *= scale
      }
    }
    if (useCanvas) {
      // eslint-disable-next-line no-param-reassign
      options = loadImage.getTransformedOptions(img, options, data)
      sourceX = options.left || 0
      sourceY = options.top || 0
      if (options.sourceWidth) {
        sourceWidth = options.sourceWidth
        if (options.right !== undefined && options.left === undefined) {
          sourceX = width - sourceWidth - options.right
        }
      } else {
        sourceWidth = width - sourceX - (options.right || 0)
      }
      if (options.sourceHeight) {
        sourceHeight = options.sourceHeight
        if (options.bottom !== undefined && options.top === undefined) {
          sourceY = height - sourceHeight - options.bottom
        }
      } else {
        sourceHeight = height - sourceY - (options.bottom || 0)
      }
      destWidth = sourceWidth
      destHeight = sourceHeight
    }
    maxWidth = options.maxWidth
    maxHeight = options.maxHeight
    minWidth = options.minWidth
    minHeight = options.minHeight
    if (useCanvas && maxWidth && maxHeight && options.crop) {
      destWidth = maxWidth
      destHeight = maxHeight
      tmp = sourceWidth / sourceHeight - maxWidth / maxHeight
      if (tmp < 0) {
        sourceHeight = (maxHeight * sourceWidth) / maxWidth
        if (options.top === undefined && options.bottom === undefined) {
          sourceY = (height - sourceHeight) / 2
        }
      } else if (tmp > 0) {
        sourceWidth = (maxWidth * sourceHeight) / maxHeight
        if (options.left === undefined && options.right === undefined) {
          sourceX = (width - sourceWidth) / 2
        }
      }
    } else {
      if (options.contain || options.cover) {
        minWidth = maxWidth = maxWidth || minWidth
        minHeight = maxHeight = maxHeight || minHeight
      }
      if (options.cover) {
        scaleDown()
        scaleUp()
      } else {
        scaleUp()
        scaleDown()
      }
    }
    if (useCanvas) {
      pixelRatio = options.pixelRatio
      if (
        pixelRatio > 1 &&
        // Check if the image has not yet had the device pixel ratio applied:
        !(
          img.style.width &&
          Math.floor(parseFloat(img.style.width, 10)) ===
            Math.floor(width / pixelRatio)
        )
      ) {
        destWidth *= pixelRatio
        destHeight *= pixelRatio
      }
      // Check if workaround for Chromium orientation crop bug is required:
      // https://bugs.chromium.org/p/chromium/issues/detail?id=1074354
      if (
        loadImage.orientationCropBug &&
        !img.getContext &&
        (sourceX || sourceY || sourceWidth !== width || sourceHeight !== height)
      ) {
        // Write the complete source image to an intermediate canvas first:
        tmp = img
        // eslint-disable-next-line no-param-reassign
        img = loadImage.createCanvas(width, height, true)
        loadImage.drawImage(
          tmp,
          img,
          0,
          0,
          width,
          height,
          width,
          height,
          options
        )
      }
      downsamplingRatio = options.downsamplingRatio
      if (
        downsamplingRatio > 0 &&
        downsamplingRatio < 1 &&
        destWidth < sourceWidth &&
        destHeight < sourceHeight
      ) {
        while (sourceWidth * downsamplingRatio > destWidth) {
          canvas = loadImage.createCanvas(
            sourceWidth * downsamplingRatio,
            sourceHeight * downsamplingRatio,
            true
          )
          loadImage.drawImage(
            img,
            canvas,
            sourceX,
            sourceY,
            sourceWidth,
            sourceHeight,
            canvas.width,
            canvas.height,
            options
          )
          sourceX = 0
          sourceY = 0
          sourceWidth = canvas.width
          sourceHeight = canvas.height
          // eslint-disable-next-line no-param-reassign
          img = canvas
        }
      }
      canvas = loadImage.createCanvas(destWidth, destHeight)
      loadImage.transformCoordinates(canvas, options, data)
      if (pixelRatio > 1) {
        canvas.style.width = canvas.width / pixelRatio + 'px'
      }
      loadImage
        .drawImage(
          img,
          canvas,
          sourceX,
          sourceY,
          sourceWidth,
          sourceHeight,
          destWidth,
          destHeight,
          options
        )
        .setTransform(1, 0, 0, 1, 0, 0) // reset to the identity matrix
      return canvas
    }
    img.width = destWidth
    img.height = destHeight
    return img
  }
})


/***/ }),

/***/ 302:
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_RESULT__;/*
 * JavaScript Load Image
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 */

/* global define, module, Promise */

;(function ($) {
  'use strict'

  var urlAPI = $.URL || $.webkitURL

  /**
   * Creates an object URL for a given File object.
   *
   * @param {Blob} blob Blob object
   * @returns {string|boolean} Returns object URL if API exists, else false.
   */
  function createObjectURL(blob) {
    return urlAPI ? urlAPI.createObjectURL(blob) : false
  }

  /**
   * Revokes a given object URL.
   *
   * @param {string} url Blob object URL
   * @returns {undefined|boolean} Returns undefined if API exists, else false.
   */
  function revokeObjectURL(url) {
    return urlAPI ? urlAPI.revokeObjectURL(url) : false
  }

  /**
   * Helper function to revoke an object URL
   *
   * @param {string} url Blob Object URL
   * @param {object} [options] Options object
   */
  function revokeHelper(url, options) {
    if (url && url.slice(0, 5) === 'blob:' && !(options && options.noRevoke)) {
      revokeObjectURL(url)
    }
  }

  /**
   * Loads a given File object via FileReader interface.
   *
   * @param {Blob} file Blob object
   * @param {Function} onload Load event callback
   * @param {Function} [onerror] Error/Abort event callback
   * @param {string} [method=readAsDataURL] FileReader method
   * @returns {FileReader|boolean} Returns FileReader if API exists, else false.
   */
  function readFile(file, onload, onerror, method) {
    if (!$.FileReader) return false
    var reader = new FileReader()
    reader.onload = function () {
      onload.call(reader, this.result)
    }
    if (onerror) {
      reader.onabort = reader.onerror = function () {
        onerror.call(reader, this.error)
      }
    }
    var readerMethod = reader[method || 'readAsDataURL']
    if (readerMethod) {
      readerMethod.call(reader, file)
      return reader
    }
  }

  /**
   * Cross-frame instanceof check.
   *
   * @param {string} type Instance type
   * @param {object} obj Object instance
   * @returns {boolean} Returns true if the object is of the given instance.
   */
  function isInstanceOf(type, obj) {
    // Cross-frame instanceof check
    return Object.prototype.toString.call(obj) === '[object ' + type + ']'
  }

  /**
   * @typedef { HTMLImageElement|HTMLCanvasElement } Result
   */

  /**
   * Loads an image for a given File object.
   *
   * @param {Blob|string} file Blob object or image URL
   * @param {Function|object} [callback] Image load event callback or options
   * @param {object} [options] Options object
   * @returns {HTMLImageElement|FileReader|Promise<Result>} Object
   */
  function loadImage(file, callback, options) {
    /**
     * Promise executor
     *
     * @param {Function} resolve Resolution function
     * @param {Function} reject Rejection function
     * @returns {HTMLImageElement|FileReader} Object
     */
    function executor(resolve, reject) {
      var img = document.createElement('img')
      var url
      /**
       * Callback for the fetchBlob call.
       *
       * @param {HTMLImageElement|HTMLCanvasElement} img Error object
       * @param {object} data Data object
       * @returns {undefined} Undefined
       */
      function resolveWrapper(img, data) {
        if (resolve === reject) {
          // Not using Promises
          if (resolve) resolve(img, data)
          return
        } else if (img instanceof Error) {
          reject(img)
          return
        }
        data = data || {} // eslint-disable-line no-param-reassign
        data.image = img
        resolve(data)
      }
      /**
       * Callback for the fetchBlob call.
       *
       * @param {Blob} blob Blob object
       * @param {Error} err Error object
       */
      function fetchBlobCallback(blob, err) {
        if (err && $.console) console.log(err) // eslint-disable-line no-console
        if (blob && isInstanceOf('Blob', blob)) {
          file = blob // eslint-disable-line no-param-reassign
          url = createObjectURL(file)
        } else {
          url = file
          if (options && options.crossOrigin) {
            img.crossOrigin = options.crossOrigin
          }
        }
        img.src = url
      }
      img.onerror = function (event) {
        revokeHelper(url, options)
        if (reject) reject.call(img, event)
      }
      img.onload = function () {
        revokeHelper(url, options)
        var data = {
          originalWidth: img.naturalWidth || img.width,
          originalHeight: img.naturalHeight || img.height
        }
        try {
          loadImage.transform(img, options, resolveWrapper, file, data)
        } catch (error) {
          if (reject) reject(error)
        }
      }
      if (typeof file === 'string') {
        if (loadImage.requiresMetaData(options)) {
          loadImage.fetchBlob(file, fetchBlobCallback, options)
        } else {
          fetchBlobCallback()
        }
        return img
      } else if (isInstanceOf('Blob', file) || isInstanceOf('File', file)) {
        url = createObjectURL(file)
        if (url) {
          img.src = url
          return img
        }
        return readFile(
          file,
          function (url) {
            img.src = url
          },
          reject
        )
      }
    }
    if ($.Promise && typeof callback !== 'function') {
      options = callback // eslint-disable-line no-param-reassign
      return new Promise(executor)
    }
    return executor(callback, callback)
  }

  // Determines if metadata should be loaded automatically.
  // Requires the load image meta extension to load metadata.
  loadImage.requiresMetaData = function (options) {
    return options && options.meta
  }

  // If the callback given to this function returns a blob, it is used as image
  // source instead of the original url and overrides the file argument used in
  // the onload and onerror event callbacks:
  loadImage.fetchBlob = function (url, callback) {
    callback()
  }

  loadImage.transform = function (img, options, callback, file, data) {
    callback(img, data)
  }

  loadImage.global = $
  loadImage.readFile = readFile
  loadImage.isInstanceOf = isInstanceOf
  loadImage.createObjectURL = createObjectURL
  loadImage.revokeObjectURL = revokeObjectURL

  if (true) {
    !(__WEBPACK_AMD_DEFINE_RESULT__ = (function () {
      return loadImage
    }).call(exports, __webpack_require__, exports, module),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
  } else {}
})((typeof window !== 'undefined' && window) || this)


/***/ }),

/***/ 129:
/***/ (function(module) {

/*!
 * Cropper.js v1.5.12
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2021-06-12T08:00:17.411Z
 */

(function (global, factory) {
   true ? module.exports = factory() :
  0;
}(this, (function () { 'use strict';

  function ownKeys(object, enumerableOnly) {
    var keys = Object.keys(object);

    if (Object.getOwnPropertySymbols) {
      var symbols = Object.getOwnPropertySymbols(object);

      if (enumerableOnly) {
        symbols = symbols.filter(function (sym) {
          return Object.getOwnPropertyDescriptor(object, sym).enumerable;
        });
      }

      keys.push.apply(keys, symbols);
    }

    return keys;
  }

  function _objectSpread2(target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i] != null ? arguments[i] : {};

      if (i % 2) {
        ownKeys(Object(source), true).forEach(function (key) {
          _defineProperty(target, key, source[key]);
        });
      } else if (Object.getOwnPropertyDescriptors) {
        Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
      } else {
        ownKeys(Object(source)).forEach(function (key) {
          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
        });
      }
    }

    return target;
  }

  function _typeof(obj) {
    "@babel/helpers - typeof";

    if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
      _typeof = function (obj) {
        return typeof obj;
      };
    } else {
      _typeof = function (obj) {
        return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
      };
    }

    return _typeof(obj);
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  function _defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
  }

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
  }

  function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
  }

  function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
  }

  function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(o);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
  }

  function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;

    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];

    return arr2;
  }

  function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }

  var IS_BROWSER = typeof window !== 'undefined' && typeof window.document !== 'undefined';
  var WINDOW = IS_BROWSER ? window : {};
  var IS_TOUCH_DEVICE = IS_BROWSER && WINDOW.document.documentElement ? 'ontouchstart' in WINDOW.document.documentElement : false;
  var HAS_POINTER_EVENT = IS_BROWSER ? 'PointerEvent' in WINDOW : false;
  var NAMESPACE = 'cropper'; // Actions

  var ACTION_ALL = 'all';
  var ACTION_CROP = 'crop';
  var ACTION_MOVE = 'move';
  var ACTION_ZOOM = 'zoom';
  var ACTION_EAST = 'e';
  var ACTION_WEST = 'w';
  var ACTION_SOUTH = 's';
  var ACTION_NORTH = 'n';
  var ACTION_NORTH_EAST = 'ne';
  var ACTION_NORTH_WEST = 'nw';
  var ACTION_SOUTH_EAST = 'se';
  var ACTION_SOUTH_WEST = 'sw'; // Classes

  var CLASS_CROP = "".concat(NAMESPACE, "-crop");
  var CLASS_DISABLED = "".concat(NAMESPACE, "-disabled");
  var CLASS_HIDDEN = "".concat(NAMESPACE, "-hidden");
  var CLASS_HIDE = "".concat(NAMESPACE, "-hide");
  var CLASS_INVISIBLE = "".concat(NAMESPACE, "-invisible");
  var CLASS_MODAL = "".concat(NAMESPACE, "-modal");
  var CLASS_MOVE = "".concat(NAMESPACE, "-move"); // Data keys

  var DATA_ACTION = "".concat(NAMESPACE, "Action");
  var DATA_PREVIEW = "".concat(NAMESPACE, "Preview"); // Drag modes

  var DRAG_MODE_CROP = 'crop';
  var DRAG_MODE_MOVE = 'move';
  var DRAG_MODE_NONE = 'none'; // Events

  var EVENT_CROP = 'crop';
  var EVENT_CROP_END = 'cropend';
  var EVENT_CROP_MOVE = 'cropmove';
  var EVENT_CROP_START = 'cropstart';
  var EVENT_DBLCLICK = 'dblclick';
  var EVENT_TOUCH_START = IS_TOUCH_DEVICE ? 'touchstart' : 'mousedown';
  var EVENT_TOUCH_MOVE = IS_TOUCH_DEVICE ? 'touchmove' : 'mousemove';
  var EVENT_TOUCH_END = IS_TOUCH_DEVICE ? 'touchend touchcancel' : 'mouseup';
  var EVENT_POINTER_DOWN = HAS_POINTER_EVENT ? 'pointerdown' : EVENT_TOUCH_START;
  var EVENT_POINTER_MOVE = HAS_POINTER_EVENT ? 'pointermove' : EVENT_TOUCH_MOVE;
  var EVENT_POINTER_UP = HAS_POINTER_EVENT ? 'pointerup pointercancel' : EVENT_TOUCH_END;
  var EVENT_READY = 'ready';
  var EVENT_RESIZE = 'resize';
  var EVENT_WHEEL = 'wheel';
  var EVENT_ZOOM = 'zoom'; // Mime types

  var MIME_TYPE_JPEG = 'image/jpeg'; // RegExps

  var REGEXP_ACTIONS = /^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/;
  var REGEXP_DATA_URL = /^data:/;
  var REGEXP_DATA_URL_JPEG = /^data:image\/jpeg;base64,/;
  var REGEXP_TAG_NAME = /^img|canvas$/i; // Misc
  // Inspired by the default width and height of a canvas element.

  var MIN_CONTAINER_WIDTH = 200;
  var MIN_CONTAINER_HEIGHT = 100;

  var DEFAULTS = {
    // Define the view mode of the cropper
    viewMode: 0,
    // 0, 1, 2, 3
    // Define the dragging mode of the cropper
    dragMode: DRAG_MODE_CROP,
    // 'crop', 'move' or 'none'
    // Define the initial aspect ratio of the crop box
    initialAspectRatio: NaN,
    // Define the aspect ratio of the crop box
    aspectRatio: NaN,
    // An object with the previous cropping result data
    data: null,
    // A selector for adding extra containers to preview
    preview: '',
    // Re-render the cropper when resize the window
    responsive: true,
    // Restore the cropped area after resize the window
    restore: true,
    // Check if the current image is a cross-origin image
    checkCrossOrigin: true,
    // Check the current image's Exif Orientation information
    checkOrientation: true,
    // Show the black modal
    modal: true,
    // Show the dashed lines for guiding
    guides: true,
    // Show the center indicator for guiding
    center: true,
    // Show the white modal to highlight the crop box
    highlight: true,
    // Show the grid background
    background: true,
    // Enable to crop the image automatically when initialize
    autoCrop: true,
    // Define the percentage of automatic cropping area when initializes
    autoCropArea: 0.8,
    // Enable to move the image
    movable: true,
    // Enable to rotate the image
    rotatable: true,
    // Enable to scale the image
    scalable: true,
    // Enable to zoom the image
    zoomable: true,
    // Enable to zoom the image by dragging touch
    zoomOnTouch: true,
    // Enable to zoom the image by wheeling mouse
    zoomOnWheel: true,
    // Define zoom ratio when zoom the image by wheeling mouse
    wheelZoomRatio: 0.1,
    // Enable to move the crop box
    cropBoxMovable: true,
    // Enable to resize the crop box
    cropBoxResizable: true,
    // Toggle drag mode between "crop" and "move" when click twice on the cropper
    toggleDragModeOnDblclick: true,
    // Size limitation
    minCanvasWidth: 0,
    minCanvasHeight: 0,
    minCropBoxWidth: 0,
    minCropBoxHeight: 0,
    minContainerWidth: MIN_CONTAINER_WIDTH,
    minContainerHeight: MIN_CONTAINER_HEIGHT,
    // Shortcuts of events
    ready: null,
    cropstart: null,
    cropmove: null,
    cropend: null,
    crop: null,
    zoom: null
  };

  var TEMPLATE = '<div class="cropper-container" touch-action="none">' + '<div class="cropper-wrap-box">' + '<div class="cropper-canvas"></div>' + '</div>' + '<div class="cropper-drag-box"></div>' + '<div class="cropper-crop-box">' + '<span class="cropper-view-box"></span>' + '<span class="cropper-dashed dashed-h"></span>' + '<span class="cropper-dashed dashed-v"></span>' + '<span class="cropper-center"></span>' + '<span class="cropper-face"></span>' + '<span class="cropper-line line-e" data-cropper-action="e"></span>' + '<span class="cropper-line line-n" data-cropper-action="n"></span>' + '<span class="cropper-line line-w" data-cropper-action="w"></span>' + '<span class="cropper-line line-s" data-cropper-action="s"></span>' + '<span class="cropper-point point-e" data-cropper-action="e"></span>' + '<span class="cropper-point point-n" data-cropper-action="n"></span>' + '<span class="cropper-point point-w" data-cropper-action="w"></span>' + '<span class="cropper-point point-s" data-cropper-action="s"></span>' + '<span class="cropper-point point-ne" data-cropper-action="ne"></span>' + '<span class="cropper-point point-nw" data-cropper-action="nw"></span>' + '<span class="cropper-point point-sw" data-cropper-action="sw"></span>' + '<span class="cropper-point point-se" data-cropper-action="se"></span>' + '</div>' + '</div>';

  /**
   * Check if the given value is not a number.
   */

  var isNaN = Number.isNaN || WINDOW.isNaN;
  /**
   * Check if the given value is a number.
   * @param {*} value - The value to check.
   * @returns {boolean} Returns `true` if the given value is a number, else `false`.
   */

  function isNumber(value) {
    return typeof value === 'number' && !isNaN(value);
  }
  /**
   * Check if the given value is a positive number.
   * @param {*} value - The value to check.
   * @returns {boolean} Returns `true` if the given value is a positive number, else `false`.
   */

  var isPositiveNumber = function isPositiveNumber(value) {
    return value > 0 && value < Infinity;
  };
  /**
   * Check if the given value is undefined.
   * @param {*} value - The value to check.
   * @returns {boolean} Returns `true` if the given value is undefined, else `false`.
   */

  function isUndefined(value) {
    return typeof value === 'undefined';
  }
  /**
   * Check if the given value is an object.
   * @param {*} value - The value to check.
   * @returns {boolean} Returns `true` if the given value is an object, else `false`.
   */

  function isObject(value) {
    return _typeof(value) === 'object' && value !== null;
  }
  var hasOwnProperty = Object.prototype.hasOwnProperty;
  /**
   * Check if the given value is a plain object.
   * @param {*} value - The value to check.
   * @returns {boolean} Returns `true` if the given value is a plain object, else `false`.
   */

  function isPlainObject(value) {
    if (!isObject(value)) {
      return false;
    }

    try {
      var _constructor = value.constructor;
      var prototype = _constructor.prototype;
      return _constructor && prototype && hasOwnProperty.call(prototype, 'isPrototypeOf');
    } catch (error) {
      return false;
    }
  }
  /**
   * Check if the given value is a function.
   * @param {*} value - The value to check.
   * @returns {boolean} Returns `true` if the given value is a function, else `false`.
   */

  function isFunction(value) {
    return typeof value === 'function';
  }
  var slice = Array.prototype.slice;
  /**
   * Convert array-like or iterable object to an array.
   * @param {*} value - The value to convert.
   * @returns {Array} Returns a new array.
   */

  function toArray(value) {
    return Array.from ? Array.from(value) : slice.call(value);
  }
  /**
   * Iterate the given data.
   * @param {*} data - The data to iterate.
   * @param {Function} callback - The process function for each element.
   * @returns {*} The original data.
   */

  function forEach(data, callback) {
    if (data && isFunction(callback)) {
      if (Array.isArray(data) || isNumber(data.length)
      /* array-like */
      ) {
          toArray(data).forEach(function (value, key) {
            callback.call(data, value, key, data);
          });
        } else if (isObject(data)) {
        Object.keys(data).forEach(function (key) {
          callback.call(data, data[key], key, data);
        });
      }
    }

    return data;
  }
  /**
   * Extend the given object.
   * @param {*} target - The target object to extend.
   * @param {*} args - The rest objects for merging to the target object.
   * @returns {Object} The extended object.
   */

  var assign = Object.assign || function assign(target) {
    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      args[_key - 1] = arguments[_key];
    }

    if (isObject(target) && args.length > 0) {
      args.forEach(function (arg) {
        if (isObject(arg)) {
          Object.keys(arg).forEach(function (key) {
            target[key] = arg[key];
          });
        }
      });
    }

    return target;
  };
  var REGEXP_DECIMALS = /\.\d*(?:0|9){12}\d*$/;
  /**
   * Normalize decimal number.
   * Check out {@link https://0.30000000000000004.com/}
   * @param {number} value - The value to normalize.
   * @param {number} [times=100000000000] - The times for normalizing.
   * @returns {number} Returns the normalized number.
   */

  function normalizeDecimalNumber(value) {
    var times = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100000000000;
    return REGEXP_DECIMALS.test(value) ? Math.round(value * times) / times : value;
  }
  var REGEXP_SUFFIX = /^width|height|left|top|marginLeft|marginTop$/;
  /**
   * Apply styles to the given element.
   * @param {Element} element - The target element.
   * @param {Object} styles - The styles for applying.
   */

  function setStyle(element, styles) {
    var style = element.style;
    forEach(styles, function (value, property) {
      if (REGEXP_SUFFIX.test(property) && isNumber(value)) {
        value = "".concat(value, "px");
      }

      style[property] = value;
    });
  }
  /**
   * Check if the given element has a special class.
   * @param {Element} element - The element to check.
   * @param {string} value - The class to search.
   * @returns {boolean} Returns `true` if the special class was found.
   */

  function hasClass(element, value) {
    return element.classList ? element.classList.contains(value) : element.className.indexOf(value) > -1;
  }
  /**
   * Add classes to the given element.
   * @param {Element} element - The target element.
   * @param {string} value - The classes to be added.
   */

  function addClass(element, value) {
    if (!value) {
      return;
    }

    if (isNumber(element.length)) {
      forEach(element, function (elem) {
        addClass(elem, value);
      });
      return;
    }

    if (element.classList) {
      element.classList.add(value);
      return;
    }

    var className = element.className.trim();

    if (!className) {
      element.className = value;
    } else if (className.indexOf(value) < 0) {
      element.className = "".concat(className, " ").concat(value);
    }
  }
  /**
   * Remove classes from the given element.
   * @param {Element} element - The target element.
   * @param {string} value - The classes to be removed.
   */

  function removeClass(element, value) {
    if (!value) {
      return;
    }

    if (isNumber(element.length)) {
      forEach(element, function (elem) {
        removeClass(elem, value);
      });
      return;
    }

    if (element.classList) {
      element.classList.remove(value);
      return;
    }

    if (element.className.indexOf(value) >= 0) {
      element.className = element.className.replace(value, '');
    }
  }
  /**
   * Add or remove classes from the given element.
   * @param {Element} element - The target element.
   * @param {string} value - The classes to be toggled.
   * @param {boolean} added - Add only.
   */

  function toggleClass(element, value, added) {
    if (!value) {
      return;
    }

    if (isNumber(element.length)) {
      forEach(element, function (elem) {
        toggleClass(elem, value, added);
      });
      return;
    } // IE10-11 doesn't support the second parameter of `classList.toggle`


    if (added) {
      addClass(element, value);
    } else {
      removeClass(element, value);
    }
  }
  var REGEXP_CAMEL_CASE = /([a-z\d])([A-Z])/g;
  /**
   * Transform the given string from camelCase to kebab-case
   * @param {string} value - The value to transform.
   * @returns {string} The transformed value.
   */

  function toParamCase(value) {
    return value.replace(REGEXP_CAMEL_CASE, '$1-$2').toLowerCase();
  }
  /**
   * Get data from the given element.
   * @param {Element} element - The target element.
   * @param {string} name - The data key to get.
   * @returns {string} The data value.
   */

  function getData(element, name) {
    if (isObject(element[name])) {
      return element[name];
    }

    if (element.dataset) {
      return element.dataset[name];
    }

    return element.getAttribute("data-".concat(toParamCase(name)));
  }
  /**
   * Set data to the given element.
   * @param {Element} element - The target element.
   * @param {string} name - The data key to set.
   * @param {string} data - The data value.
   */

  function setData(element, name, data) {
    if (isObject(data)) {
      element[name] = data;
    } else if (element.dataset) {
      element.dataset[name] = data;
    } else {
      element.setAttribute("data-".concat(toParamCase(name)), data);
    }
  }
  /**
   * Remove data from the given element.
   * @param {Element} element - The target element.
   * @param {string} name - The data key to remove.
   */

  function removeData(element, name) {
    if (isObject(element[name])) {
      try {
        delete element[name];
      } catch (error) {
        element[name] = undefined;
      }
    } else if (element.dataset) {
      // #128 Safari not allows to delete dataset property
      try {
        delete element.dataset[name];
      } catch (error) {
        element.dataset[name] = undefined;
      }
    } else {
      element.removeAttribute("data-".concat(toParamCase(name)));
    }
  }
  var REGEXP_SPACES = /\s\s*/;

  var onceSupported = function () {
    var supported = false;

    if (IS_BROWSER) {
      var once = false;

      var listener = function listener() {};

      var options = Object.defineProperty({}, 'once', {
        get: function get() {
          supported = true;
          return once;
        },

        /**
         * This setter can fix a `TypeError` in strict mode
         * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Getter_only}
         * @param {boolean} value - The value to set
         */
        set: function set(value) {
          once = value;
        }
      });
      WINDOW.addEventListener('test', listener, options);
      WINDOW.removeEventListener('test', listener, options);
    }

    return supported;
  }();
  /**
   * Remove event listener from the target element.
   * @param {Element} element - The event target.
   * @param {string} type - The event type(s).
   * @param {Function} listener - The event listener.
   * @param {Object} options - The event options.
   */


  function removeListener(element, type, listener) {
    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
    var handler = listener;
    type.trim().split(REGEXP_SPACES).forEach(function (event) {
      if (!onceSupported) {
        var listeners = element.listeners;

        if (listeners && listeners[event] && listeners[event][listener]) {
          handler = listeners[event][listener];
          delete listeners[event][listener];

          if (Object.keys(listeners[event]).length === 0) {
            delete listeners[event];
          }

          if (Object.keys(listeners).length === 0) {
            delete element.listeners;
          }
        }
      }

      element.removeEventListener(event, handler, options);
    });
  }
  /**
   * Add event listener to the target element.
   * @param {Element} element - The event target.
   * @param {string} type - The event type(s).
   * @param {Function} listener - The event listener.
   * @param {Object} options - The event options.
   */

  function addListener(element, type, listener) {
    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
    var _handler = listener;
    type.trim().split(REGEXP_SPACES).forEach(function (event) {
      if (options.once && !onceSupported) {
        var _element$listeners = element.listeners,
            listeners = _element$listeners === void 0 ? {} : _element$listeners;

        _handler = function handler() {
          delete listeners[event][listener];
          element.removeEventListener(event, _handler, options);

          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
            args[_key2] = arguments[_key2];
          }

          listener.apply(element, args);
        };

        if (!listeners[event]) {
          listeners[event] = {};
        }

        if (listeners[event][listener]) {
          element.removeEventListener(event, listeners[event][listener], options);
        }

        listeners[event][listener] = _handler;
        element.listeners = listeners;
      }

      element.addEventListener(event, _handler, options);
    });
  }
  /**
   * Dispatch event on the target element.
   * @param {Element} element - The event target.
   * @param {string} type - The event type(s).
   * @param {Object} data - The additional event data.
   * @returns {boolean} Indicate if the event is default prevented or not.
   */

  function dispatchEvent(element, type, data) {
    var event; // Event and CustomEvent on IE9-11 are global objects, not constructors

    if (isFunction(Event) && isFunction(CustomEvent)) {
      event = new CustomEvent(type, {
        detail: data,
        bubbles: true,
        cancelable: true
      });
    } else {
      event = document.createEvent('CustomEvent');
      event.initCustomEvent(type, true, true, data);
    }

    return element.dispatchEvent(event);
  }
  /**
   * Get the offset base on the document.
   * @param {Element} element - The target element.
   * @returns {Object} The offset data.
   */

  function getOffset(element) {
    var box = element.getBoundingClientRect();
    return {
      left: box.left + (window.pageXOffset - document.documentElement.clientLeft),
      top: box.top + (window.pageYOffset - document.documentElement.clientTop)
    };
  }
  var location = WINDOW.location;
  var REGEXP_ORIGINS = /^(\w+:)\/\/([^:/?#]*):?(\d*)/i;
  /**
   * Check if the given URL is a cross origin URL.
   * @param {string} url - The target URL.
   * @returns {boolean} Returns `true` if the given URL is a cross origin URL, else `false`.
   */

  function isCrossOriginURL(url) {
    var parts = url.match(REGEXP_ORIGINS);
    return parts !== null && (parts[1] !== location.protocol || parts[2] !== location.hostname || parts[3] !== location.port);
  }
  /**
   * Add timestamp to the given URL.
   * @param {string} url - The target URL.
   * @returns {string} The result URL.
   */

  function addTimestamp(url) {
    var timestamp = "timestamp=".concat(new Date().getTime());
    return url + (url.indexOf('?') === -1 ? '?' : '&') + timestamp;
  }
  /**
   * Get transforms base on the given object.
   * @param {Object} obj - The target object.
   * @returns {string} A string contains transform values.
   */

  function getTransforms(_ref) {
    var rotate = _ref.rotate,
        scaleX = _ref.scaleX,
        scaleY = _ref.scaleY,
        translateX = _ref.translateX,
        translateY = _ref.translateY;
    var values = [];

    if (isNumber(translateX) && translateX !== 0) {
      values.push("translateX(".concat(translateX, "px)"));
    }

    if (isNumber(translateY) && translateY !== 0) {
      values.push("translateY(".concat(translateY, "px)"));
    } // Rotate should come first before scale to match orientation transform


    if (isNumber(rotate) && rotate !== 0) {
      values.push("rotate(".concat(rotate, "deg)"));
    }

    if (isNumber(scaleX) && scaleX !== 1) {
      values.push("scaleX(".concat(scaleX, ")"));
    }

    if (isNumber(scaleY) && scaleY !== 1) {
      values.push("scaleY(".concat(scaleY, ")"));
    }

    var transform = values.length ? values.join(' ') : 'none';
    return {
      WebkitTransform: transform,
      msTransform: transform,
      transform: transform
    };
  }
  /**
   * Get the max ratio of a group of pointers.
   * @param {string} pointers - The target pointers.
   * @returns {number} The result ratio.
   */

  function getMaxZoomRatio(pointers) {
    var pointers2 = _objectSpread2({}, pointers);

    var maxRatio = 0;
    forEach(pointers, function (pointer, pointerId) {
      delete pointers2[pointerId];
      forEach(pointers2, function (pointer2) {
        var x1 = Math.abs(pointer.startX - pointer2.startX);
        var y1 = Math.abs(pointer.startY - pointer2.startY);
        var x2 = Math.abs(pointer.endX - pointer2.endX);
        var y2 = Math.abs(pointer.endY - pointer2.endY);
        var z1 = Math.sqrt(x1 * x1 + y1 * y1);
        var z2 = Math.sqrt(x2 * x2 + y2 * y2);
        var ratio = (z2 - z1) / z1;

        if (Math.abs(ratio) > Math.abs(maxRatio)) {
          maxRatio = ratio;
        }
      });
    });
    return maxRatio;
  }
  /**
   * Get a pointer from an event object.
   * @param {Object} event - The target event object.
   * @param {boolean} endOnly - Indicates if only returns the end point coordinate or not.
   * @returns {Object} The result pointer contains start and/or end point coordinates.
   */

  function getPointer(_ref2, endOnly) {
    var pageX = _ref2.pageX,
        pageY = _ref2.pageY;
    var end = {
      endX: pageX,
      endY: pageY
    };
    return endOnly ? end : _objectSpread2({
      startX: pageX,
      startY: pageY
    }, end);
  }
  /**
   * Get the center point coordinate of a group of pointers.
   * @param {Object} pointers - The target pointers.
   * @returns {Object} The center point coordinate.
   */

  function getPointersCenter(pointers) {
    var pageX = 0;
    var pageY = 0;
    var count = 0;
    forEach(pointers, function (_ref3) {
      var startX = _ref3.startX,
          startY = _ref3.startY;
      pageX += startX;
      pageY += startY;
      count += 1;
    });
    pageX /= count;
    pageY /= count;
    return {
      pageX: pageX,
      pageY: pageY
    };
  }
  /**
   * Get the max sizes in a rectangle under the given aspect ratio.
   * @param {Object} data - The original sizes.
   * @param {string} [type='contain'] - The adjust type.
   * @returns {Object} The result sizes.
   */

  function getAdjustedSizes(_ref4) // or 'cover'
  {
    var aspectRatio = _ref4.aspectRatio,
        height = _ref4.height,
        width = _ref4.width;
    var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'contain';
    var isValidWidth = isPositiveNumber(width);
    var isValidHeight = isPositiveNumber(height);

    if (isValidWidth && isValidHeight) {
      var adjustedWidth = height * aspectRatio;

      if (type === 'contain' && adjustedWidth > width || type === 'cover' && adjustedWidth < width) {
        height = width / aspectRatio;
      } else {
        width = height * aspectRatio;
      }
    } else if (isValidWidth) {
      height = width / aspectRatio;
    } else if (isValidHeight) {
      width = height * aspectRatio;
    }

    return {
      width: width,
      height: height
    };
  }
  /**
   * Get the new sizes of a rectangle after rotated.
   * @param {Object} data - The original sizes.
   * @returns {Object} The result sizes.
   */

  function getRotatedSizes(_ref5) {
    var width = _ref5.width,
        height = _ref5.height,
        degree = _ref5.degree;
    degree = Math.abs(degree) % 180;

    if (degree === 90) {
      return {
        width: height,
        height: width
      };
    }

    var arc = degree % 90 * Math.PI / 180;
    var sinArc = Math.sin(arc);
    var cosArc = Math.cos(arc);
    var newWidth = width * cosArc + height * sinArc;
    var newHeight = width * sinArc + height * cosArc;
    return degree > 90 ? {
      width: newHeight,
      height: newWidth
    } : {
      width: newWidth,
      height: newHeight
    };
  }
  /**
   * Get a canvas which drew the given image.
   * @param {HTMLImageElement} image - The image for drawing.
   * @param {Object} imageData - The image data.
   * @param {Object} canvasData - The canvas data.
   * @param {Object} options - The options.
   * @returns {HTMLCanvasElement} The result canvas.
   */

  function getSourceCanvas(image, _ref6, _ref7, _ref8) {
    var imageAspectRatio = _ref6.aspectRatio,
        imageNaturalWidth = _ref6.naturalWidth,
        imageNaturalHeight = _ref6.naturalHeight,
        _ref6$rotate = _ref6.rotate,
        rotate = _ref6$rotate === void 0 ? 0 : _ref6$rotate,
        _ref6$scaleX = _ref6.scaleX,
        scaleX = _ref6$scaleX === void 0 ? 1 : _ref6$scaleX,
        _ref6$scaleY = _ref6.scaleY,
        scaleY = _ref6$scaleY === void 0 ? 1 : _ref6$scaleY;
    var aspectRatio = _ref7.aspectRatio,
        naturalWidth = _ref7.naturalWidth,
        naturalHeight = _ref7.naturalHeight;
    var _ref8$fillColor = _ref8.fillColor,
        fillColor = _ref8$fillColor === void 0 ? 'transparent' : _ref8$fillColor,
        _ref8$imageSmoothingE = _ref8.imageSmoothingEnabled,
        imageSmoothingEnabled = _ref8$imageSmoothingE === void 0 ? true : _ref8$imageSmoothingE,
        _ref8$imageSmoothingQ = _ref8.imageSmoothingQuality,
        imageSmoothingQuality = _ref8$imageSmoothingQ === void 0 ? 'low' : _ref8$imageSmoothingQ,
        _ref8$maxWidth = _ref8.maxWidth,
        maxWidth = _ref8$maxWidth === void 0 ? Infinity : _ref8$maxWidth,
        _ref8$maxHeight = _ref8.maxHeight,
        maxHeight = _ref8$maxHeight === void 0 ? Infinity : _ref8$maxHeight,
        _ref8$minWidth = _ref8.minWidth,
        minWidth = _ref8$minWidth === void 0 ? 0 : _ref8$minWidth,
        _ref8$minHeight = _ref8.minHeight,
        minHeight = _ref8$minHeight === void 0 ? 0 : _ref8$minHeight;
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');
    var maxSizes = getAdjustedSizes({
      aspectRatio: aspectRatio,
      width: maxWidth,
      height: maxHeight
    });
    var minSizes = getAdjustedSizes({
      aspectRatio: aspectRatio,
      width: minWidth,
      height: minHeight
    }, 'cover');
    var width = Math.min(maxSizes.width, Math.max(minSizes.width, naturalWidth));
    var height = Math.min(maxSizes.height, Math.max(minSizes.height, naturalHeight)); // Note: should always use image's natural sizes for drawing as
    // imageData.naturalWidth === canvasData.naturalHeight when rotate % 180 === 90

    var destMaxSizes = getAdjustedSizes({
      aspectRatio: imageAspectRatio,
      width: maxWidth,
      height: maxHeight
    });
    var destMinSizes = getAdjustedSizes({
      aspectRatio: imageAspectRatio,
      width: minWidth,
      height: minHeight
    }, 'cover');
    var destWidth = Math.min(destMaxSizes.width, Math.max(destMinSizes.width, imageNaturalWidth));
    var destHeight = Math.min(destMaxSizes.height, Math.max(destMinSizes.height, imageNaturalHeight));
    var params = [-destWidth / 2, -destHeight / 2, destWidth, destHeight];
    canvas.width = normalizeDecimalNumber(width);
    canvas.height = normalizeDecimalNumber(height);
    context.fillStyle = fillColor;
    context.fillRect(0, 0, width, height);
    context.save();
    context.translate(width / 2, height / 2);
    context.rotate(rotate * Math.PI / 180);
    context.scale(scaleX, scaleY);
    context.imageSmoothingEnabled = imageSmoothingEnabled;
    context.imageSmoothingQuality = imageSmoothingQuality;
    context.drawImage.apply(context, [image].concat(_toConsumableArray(params.map(function (param) {
      return Math.floor(normalizeDecimalNumber(param));
    }))));
    context.restore();
    return canvas;
  }
  var fromCharCode = String.fromCharCode;
  /**
   * Get string from char code in data view.
   * @param {DataView} dataView - The data view for read.
   * @param {number} start - The start index.
   * @param {number} length - The read length.
   * @returns {string} The read result.
   */

  function getStringFromCharCode(dataView, start, length) {
    var str = '';
    length += start;

    for (var i = start; i < length; i += 1) {
      str += fromCharCode(dataView.getUint8(i));
    }

    return str;
  }
  var REGEXP_DATA_URL_HEAD = /^data:.*,/;
  /**
   * Transform Data URL to array buffer.
   * @param {string} dataURL - The Data URL to transform.
   * @returns {ArrayBuffer} The result array buffer.
   */

  function dataURLToArrayBuffer(dataURL) {
    var base64 = dataURL.replace(REGEXP_DATA_URL_HEAD, '');
    var binary = atob(base64);
    var arrayBuffer = new ArrayBuffer(binary.length);
    var uint8 = new Uint8Array(arrayBuffer);
    forEach(uint8, function (value, i) {
      uint8[i] = binary.charCodeAt(i);
    });
    return arrayBuffer;
  }
  /**
   * Transform array buffer to Data URL.
   * @param {ArrayBuffer} arrayBuffer - The array buffer to transform.
   * @param {string} mimeType - The mime type of the Data URL.
   * @returns {string} The result Data URL.
   */

  function arrayBufferToDataURL(arrayBuffer, mimeType) {
    var chunks = []; // Chunk Typed Array for better performance (#435)

    var chunkSize = 8192;
    var uint8 = new Uint8Array(arrayBuffer);

    while (uint8.length > 0) {
      // XXX: Babel's `toConsumableArray` helper will throw error in IE or Safari 9
      // eslint-disable-next-line prefer-spread
      chunks.push(fromCharCode.apply(null, toArray(uint8.subarray(0, chunkSize))));
      uint8 = uint8.subarray(chunkSize);
    }

    return "data:".concat(mimeType, ";base64,").concat(btoa(chunks.join('')));
  }
  /**
   * Get orientation value from given array buffer.
   * @param {ArrayBuffer} arrayBuffer - The array buffer to read.
   * @returns {number} The read orientation value.
   */

  function resetAndGetOrientation(arrayBuffer) {
    var dataView = new DataView(arrayBuffer);
    var orientation; // Ignores range error when the image does not have correct Exif information

    try {
      var littleEndian;
      var app1Start;
      var ifdStart; // Only handle JPEG image (start by 0xFFD8)

      if (dataView.getUint8(0) === 0xFF && dataView.getUint8(1) === 0xD8) {
        var length = dataView.byteLength;
        var offset = 2;

        while (offset + 1 < length) {
          if (dataView.getUint8(offset) === 0xFF && dataView.getUint8(offset + 1) === 0xE1) {
            app1Start = offset;
            break;
          }

          offset += 1;
        }
      }

      if (app1Start) {
        var exifIDCode = app1Start + 4;
        var tiffOffset = app1Start + 10;

        if (getStringFromCharCode(dataView, exifIDCode, 4) === 'Exif') {
          var endianness = dataView.getUint16(tiffOffset);
          littleEndian = endianness === 0x4949;

          if (littleEndian || endianness === 0x4D4D
          /* bigEndian */
          ) {
              if (dataView.getUint16(tiffOffset + 2, littleEndian) === 0x002A) {
                var firstIFDOffset = dataView.getUint32(tiffOffset + 4, littleEndian);

                if (firstIFDOffset >= 0x00000008) {
                  ifdStart = tiffOffset + firstIFDOffset;
                }
              }
            }
        }
      }

      if (ifdStart) {
        var _length = dataView.getUint16(ifdStart, littleEndian);

        var _offset;

        var i;

        for (i = 0; i < _length; i += 1) {
          _offset = ifdStart + i * 12 + 2;

          if (dataView.getUint16(_offset, littleEndian) === 0x0112
          /* Orientation */
          ) {
              // 8 is the offset of the current tag's value
              _offset += 8; // Get the original orientation value

              orientation = dataView.getUint16(_offset, littleEndian); // Override the orientation with its default value

              dataView.setUint16(_offset, 1, littleEndian);
              break;
            }
        }
      }
    } catch (error) {
      orientation = 1;
    }

    return orientation;
  }
  /**
   * Parse Exif Orientation value.
   * @param {number} orientation - The orientation to parse.
   * @returns {Object} The parsed result.
   */

  function parseOrientation(orientation) {
    var rotate = 0;
    var scaleX = 1;
    var scaleY = 1;

    switch (orientation) {
      // Flip horizontal
      case 2:
        scaleX = -1;
        break;
      // Rotate left 180°

      case 3:
        rotate = -180;
        break;
      // Flip vertical

      case 4:
        scaleY = -1;
        break;
      // Flip vertical and rotate right 90°

      case 5:
        rotate = 90;
        scaleY = -1;
        break;
      // Rotate right 90°

      case 6:
        rotate = 90;
        break;
      // Flip horizontal and rotate right 90°

      case 7:
        rotate = 90;
        scaleX = -1;
        break;
      // Rotate left 90°

      case 8:
        rotate = -90;
        break;
    }

    return {
      rotate: rotate,
      scaleX: scaleX,
      scaleY: scaleY
    };
  }

  var render = {
    render: function render() {
      this.initContainer();
      this.initCanvas();
      this.initCropBox();
      this.renderCanvas();

      if (this.cropped) {
        this.renderCropBox();
      }
    },
    initContainer: function initContainer() {
      var element = this.element,
          options = this.options,
          container = this.container,
          cropper = this.cropper;
      var minWidth = Number(options.minContainerWidth);
      var minHeight = Number(options.minContainerHeight);
      addClass(cropper, CLASS_HIDDEN);
      removeClass(element, CLASS_HIDDEN);
      var containerData = {
        width: Math.max(container.offsetWidth, minWidth >= 0 ? minWidth : MIN_CONTAINER_WIDTH),
        height: Math.max(container.offsetHeight, minHeight >= 0 ? minHeight : MIN_CONTAINER_HEIGHT)
      };
      this.containerData = containerData;
      setStyle(cropper, {
        width: containerData.width,
        height: containerData.height
      });
      addClass(element, CLASS_HIDDEN);
      removeClass(cropper, CLASS_HIDDEN);
    },
    // Canvas (image wrapper)
    initCanvas: function initCanvas() {
      var containerData = this.containerData,
          imageData = this.imageData;
      var viewMode = this.options.viewMode;
      var rotated = Math.abs(imageData.rotate) % 180 === 90;
      var naturalWidth = rotated ? imageData.naturalHeight : imageData.naturalWidth;
      var naturalHeight = rotated ? imageData.naturalWidth : imageData.naturalHeight;
      var aspectRatio = naturalWidth / naturalHeight;
      var canvasWidth = containerData.width;
      var canvasHeight = containerData.height;

      if (containerData.height * aspectRatio > containerData.width) {
        if (viewMode === 3) {
          canvasWidth = containerData.height * aspectRatio;
        } else {
          canvasHeight = containerData.width / aspectRatio;
        }
      } else if (viewMode === 3) {
        canvasHeight = containerData.width / aspectRatio;
      } else {
        canvasWidth = containerData.height * aspectRatio;
      }

      var canvasData = {
        aspectRatio: aspectRatio,
        naturalWidth: naturalWidth,
        naturalHeight: naturalHeight,
        width: canvasWidth,
        height: canvasHeight
      };
      this.canvasData = canvasData;
      this.limited = viewMode === 1 || viewMode === 2;
      this.limitCanvas(true, true);
      canvasData.width = Math.min(Math.max(canvasData.width, canvasData.minWidth), canvasData.maxWidth);
      canvasData.height = Math.min(Math.max(canvasData.height, canvasData.minHeight), canvasData.maxHeight);
      canvasData.left = (containerData.width - canvasData.width) / 2;
      canvasData.top = (containerData.height - canvasData.height) / 2;
      canvasData.oldLeft = canvasData.left;
      canvasData.oldTop = canvasData.top;
      this.initialCanvasData = assign({}, canvasData);
    },
    limitCanvas: function limitCanvas(sizeLimited, positionLimited) {
      var options = this.options,
          containerData = this.containerData,
          canvasData = this.canvasData,
          cropBoxData = this.cropBoxData;
      var viewMode = options.viewMode;
      var aspectRatio = canvasData.aspectRatio;
      var cropped = this.cropped && cropBoxData;

      if (sizeLimited) {
        var minCanvasWidth = Number(options.minCanvasWidth) || 0;
        var minCanvasHeight = Number(options.minCanvasHeight) || 0;

        if (viewMode > 1) {
          minCanvasWidth = Math.max(minCanvasWidth, containerData.width);
          minCanvasHeight = Math.max(minCanvasHeight, containerData.height);

          if (viewMode === 3) {
            if (minCanvasHeight * aspectRatio > minCanvasWidth) {
              minCanvasWidth = minCanvasHeight * aspectRatio;
            } else {
              minCanvasHeight = minCanvasWidth / aspectRatio;
            }
          }
        } else if (viewMode > 0) {
          if (minCanvasWidth) {
            minCanvasWidth = Math.max(minCanvasWidth, cropped ? cropBoxData.width : 0);
          } else if (minCanvasHeight) {
            minCanvasHeight = Math.max(minCanvasHeight, cropped ? cropBoxData.height : 0);
          } else if (cropped) {
            minCanvasWidth = cropBoxData.width;
            minCanvasHeight = cropBoxData.height;

            if (minCanvasHeight * aspectRatio > minCanvasWidth) {
              minCanvasWidth = minCanvasHeight * aspectRatio;
            } else {
              minCanvasHeight = minCanvasWidth / aspectRatio;
            }
          }
        }

        var _getAdjustedSizes = getAdjustedSizes({
          aspectRatio: aspectRatio,
          width: minCanvasWidth,
          height: minCanvasHeight
        });

        minCanvasWidth = _getAdjustedSizes.width;
        minCanvasHeight = _getAdjustedSizes.height;
        canvasData.minWidth = minCanvasWidth;
        canvasData.minHeight = minCanvasHeight;
        canvasData.maxWidth = Infinity;
        canvasData.maxHeight = Infinity;
      }

      if (positionLimited) {
        if (viewMode > (cropped ? 0 : 1)) {
          var newCanvasLeft = containerData.width - canvasData.width;
          var newCanvasTop = containerData.height - canvasData.height;
          canvasData.minLeft = Math.min(0, newCanvasLeft);
          canvasData.minTop = Math.min(0, newCanvasTop);
          canvasData.maxLeft = Math.max(0, newCanvasLeft);
          canvasData.maxTop = Math.max(0, newCanvasTop);

          if (cropped && this.limited) {
            canvasData.minLeft = Math.min(cropBoxData.left, cropBoxData.left + (cropBoxData.width - canvasData.width));
            canvasData.minTop = Math.min(cropBoxData.top, cropBoxData.top + (cropBoxData.height - canvasData.height));
            canvasData.maxLeft = cropBoxData.left;
            canvasData.maxTop = cropBoxData.top;

            if (viewMode === 2) {
              if (canvasData.width >= containerData.width) {
                canvasData.minLeft = Math.min(0, newCanvasLeft);
                canvasData.maxLeft = Math.max(0, newCanvasLeft);
              }

              if (canvasData.height >= containerData.height) {
                canvasData.minTop = Math.min(0, newCanvasTop);
                canvasData.maxTop = Math.max(0, newCanvasTop);
              }
            }
          }
        } else {
          canvasData.minLeft = -canvasData.width;
          canvasData.minTop = -canvasData.height;
          canvasData.maxLeft = containerData.width;
          canvasData.maxTop = containerData.height;
        }
      }
    },
    renderCanvas: function renderCanvas(changed, transformed) {
      var canvasData = this.canvasData,
          imageData = this.imageData;

      if (transformed) {
        var _getRotatedSizes = getRotatedSizes({
          width: imageData.naturalWidth * Math.abs(imageData.scaleX || 1),
          height: imageData.naturalHeight * Math.abs(imageData.scaleY || 1),
          degree: imageData.rotate || 0
        }),
            naturalWidth = _getRotatedSizes.width,
            naturalHeight = _getRotatedSizes.height;

        var width = canvasData.width * (naturalWidth / canvasData.naturalWidth);
        var height = canvasData.height * (naturalHeight / canvasData.naturalHeight);
        canvasData.left -= (width - canvasData.width) / 2;
        canvasData.top -= (height - canvasData.height) / 2;
        canvasData.width = width;
        canvasData.height = height;
        canvasData.aspectRatio = naturalWidth / naturalHeight;
        canvasData.naturalWidth = naturalWidth;
        canvasData.naturalHeight = naturalHeight;
        this.limitCanvas(true, false);
      }

      if (canvasData.width > canvasData.maxWidth || canvasData.width < canvasData.minWidth) {
        canvasData.left = canvasData.oldLeft;
      }

      if (canvasData.height > canvasData.maxHeight || canvasData.height < canvasData.minHeight) {
        canvasData.top = canvasData.oldTop;
      }

      canvasData.width = Math.min(Math.max(canvasData.width, canvasData.minWidth), canvasData.maxWidth);
      canvasData.height = Math.min(Math.max(canvasData.height, canvasData.minHeight), canvasData.maxHeight);
      this.limitCanvas(false, true);
      canvasData.left = Math.min(Math.max(canvasData.left, canvasData.minLeft), canvasData.maxLeft);
      canvasData.top = Math.min(Math.max(canvasData.top, canvasData.minTop), canvasData.maxTop);
      canvasData.oldLeft = canvasData.left;
      canvasData.oldTop = canvasData.top;
      setStyle(this.canvas, assign({
        width: canvasData.width,
        height: canvasData.height
      }, getTransforms({
        translateX: canvasData.left,
        translateY: canvasData.top
      })));
      this.renderImage(changed);

      if (this.cropped && this.limited) {
        this.limitCropBox(true, true);
      }
    },
    renderImage: function renderImage(changed) {
      var canvasData = this.canvasData,
          imageData = this.imageData;
      var width = imageData.naturalWidth * (canvasData.width / canvasData.naturalWidth);
      var height = imageData.naturalHeight * (canvasData.height / canvasData.naturalHeight);
      assign(imageData, {
        width: width,
        height: height,
        left: (canvasData.width - width) / 2,
        top: (canvasData.height - height) / 2
      });
      setStyle(this.image, assign({
        width: imageData.width,
        height: imageData.height
      }, getTransforms(assign({
        translateX: imageData.left,
        translateY: imageData.top
      }, imageData))));

      if (changed) {
        this.output();
      }
    },
    initCropBox: function initCropBox() {
      var options = this.options,
          canvasData = this.canvasData;
      var aspectRatio = options.aspectRatio || options.initialAspectRatio;
      var autoCropArea = Number(options.autoCropArea) || 0.8;
      var cropBoxData = {
        width: canvasData.width,
        height: canvasData.height
      };

      if (aspectRatio) {
        if (canvasData.height * aspectRatio > canvasData.width) {
          cropBoxData.height = cropBoxData.width / aspectRatio;
        } else {
          cropBoxData.width = cropBoxData.height * aspectRatio;
        }
      }

      this.cropBoxData = cropBoxData;
      this.limitCropBox(true, true); // Initialize auto crop area

      cropBoxData.width = Math.min(Math.max(cropBoxData.width, cropBoxData.minWidth), cropBoxData.maxWidth);
      cropBoxData.height = Math.min(Math.max(cropBoxData.height, cropBoxData.minHeight), cropBoxData.maxHeight); // The width/height of auto crop area must large than "minWidth/Height"

      cropBoxData.width = Math.max(cropBoxData.minWidth, cropBoxData.width * autoCropArea);
      cropBoxData.height = Math.max(cropBoxData.minHeight, cropBoxData.height * autoCropArea);
      cropBoxData.left = canvasData.left + (canvasData.width - cropBoxData.width) / 2;
      cropBoxData.top = canvasData.top + (canvasData.height - cropBoxData.height) / 2;
      cropBoxData.oldLeft = cropBoxData.left;
      cropBoxData.oldTop = cropBoxData.top;
      this.initialCropBoxData = assign({}, cropBoxData);
    },
    limitCropBox: function limitCropBox(sizeLimited, positionLimited) {
      var options = this.options,
          containerData = this.containerData,
          canvasData = this.canvasData,
          cropBoxData = this.cropBoxData,
          limited = this.limited;
      var aspectRatio = options.aspectRatio;

      if (sizeLimited) {
        var minCropBoxWidth = Number(options.minCropBoxWidth) || 0;
        var minCropBoxHeight = Number(options.minCropBoxHeight) || 0;
        var maxCropBoxWidth = limited ? Math.min(containerData.width, canvasData.width, canvasData.width + canvasData.left, containerData.width - canvasData.left) : containerData.width;
        var maxCropBoxHeight = limited ? Math.min(containerData.height, canvasData.height, canvasData.height + canvasData.top, containerData.height - canvasData.top) : containerData.height; // The min/maxCropBoxWidth/Height must be less than container's width/height

        minCropBoxWidth = Math.min(minCropBoxWidth, containerData.width);
        minCropBoxHeight = Math.min(minCropBoxHeight, containerData.height);

        if (aspectRatio) {
          if (minCropBoxWidth && minCropBoxHeight) {
            if (minCropBoxHeight * aspectRatio > minCropBoxWidth) {
              minCropBoxHeight = minCropBoxWidth / aspectRatio;
            } else {
              minCropBoxWidth = minCropBoxHeight * aspectRatio;
            }
          } else if (minCropBoxWidth) {
            minCropBoxHeight = minCropBoxWidth / aspectRatio;
          } else if (minCropBoxHeight) {
            minCropBoxWidth = minCropBoxHeight * aspectRatio;
          }

          if (maxCropBoxHeight * aspectRatio > maxCropBoxWidth) {
            maxCropBoxHeight = maxCropBoxWidth / aspectRatio;
          } else {
            maxCropBoxWidth = maxCropBoxHeight * aspectRatio;
          }
        } // The minWidth/Height must be less than maxWidth/Height


        cropBoxData.minWidth = Math.min(minCropBoxWidth, maxCropBoxWidth);
        cropBoxData.minHeight = Math.min(minCropBoxHeight, maxCropBoxHeight);
        cropBoxData.maxWidth = maxCropBoxWidth;
        cropBoxData.maxHeight = maxCropBoxHeight;
      }

      if (positionLimited) {
        if (limited) {
          cropBoxData.minLeft = Math.max(0, canvasData.left);
          cropBoxData.minTop = Math.max(0, canvasData.top);
          cropBoxData.maxLeft = Math.min(containerData.width, canvasData.left + canvasData.width) - cropBoxData.width;
          cropBoxData.maxTop = Math.min(containerData.height, canvasData.top + canvasData.height) - cropBoxData.height;
        } else {
          cropBoxData.minLeft = 0;
          cropBoxData.minTop = 0;
          cropBoxData.maxLeft = containerData.width - cropBoxData.width;
          cropBoxData.maxTop = containerData.height - cropBoxData.height;
        }
      }
    },
    renderCropBox: function renderCropBox() {
      var options = this.options,
          containerData = this.containerData,
          cropBoxData = this.cropBoxData;

      if (cropBoxData.width > cropBoxData.maxWidth || cropBoxData.width < cropBoxData.minWidth) {
        cropBoxData.left = cropBoxData.oldLeft;
      }

      if (cropBoxData.height > cropBoxData.maxHeight || cropBoxData.height < cropBoxData.minHeight) {
        cropBoxData.top = cropBoxData.oldTop;
      }

      cropBoxData.width = Math.min(Math.max(cropBoxData.width, cropBoxData.minWidth), cropBoxData.maxWidth);
      cropBoxData.height = Math.min(Math.max(cropBoxData.height, cropBoxData.minHeight), cropBoxData.maxHeight);
      this.limitCropBox(false, true);
      cropBoxData.left = Math.min(Math.max(cropBoxData.left, cropBoxData.minLeft), cropBoxData.maxLeft);
      cropBoxData.top = Math.min(Math.max(cropBoxData.top, cropBoxData.minTop), cropBoxData.maxTop);
      cropBoxData.oldLeft = cropBoxData.left;
      cropBoxData.oldTop = cropBoxData.top;

      if (options.movable && options.cropBoxMovable) {
        // Turn to move the canvas when the crop box is equal to the container
        setData(this.face, DATA_ACTION, cropBoxData.width >= containerData.width && cropBoxData.height >= containerData.height ? ACTION_MOVE : ACTION_ALL);
      }

      setStyle(this.cropBox, assign({
        width: cropBoxData.width,
        height: cropBoxData.height
      }, getTransforms({
        translateX: cropBoxData.left,
        translateY: cropBoxData.top
      })));

      if (this.cropped && this.limited) {
        this.limitCanvas(true, true);
      }

      if (!this.disabled) {
        this.output();
      }
    },
    output: function output() {
      this.preview();
      dispatchEvent(this.element, EVENT_CROP, this.getData());
    }
  };

  var preview = {
    initPreview: function initPreview() {
      var element = this.element,
          crossOrigin = this.crossOrigin;
      var preview = this.options.preview;
      var url = crossOrigin ? this.crossOriginUrl : this.url;
      var alt = element.alt || 'The image to preview';
      var image = document.createElement('img');

      if (crossOrigin) {
        image.crossOrigin = crossOrigin;
      }

      image.src = url;
      image.alt = alt;
      this.viewBox.appendChild(image);
      this.viewBoxImage = image;

      if (!preview) {
        return;
      }

      var previews = preview;

      if (typeof preview === 'string') {
        previews = element.ownerDocument.querySelectorAll(preview);
      } else if (preview.querySelector) {
        previews = [preview];
      }

      this.previews = previews;
      forEach(previews, function (el) {
        var img = document.createElement('img'); // Save the original size for recover

        setData(el, DATA_PREVIEW, {
          width: el.offsetWidth,
          height: el.offsetHeight,
          html: el.innerHTML
        });

        if (crossOrigin) {
          img.crossOrigin = crossOrigin;
        }

        img.src = url;
        img.alt = alt;
        /**
         * Override img element styles
         * Add `display:block` to avoid margin top issue
         * Add `height:auto` to override `height` attribute on IE8
         * (Occur only when margin-top <= -height)
         */

        img.style.cssText = 'display:block;' + 'width:100%;' + 'height:auto;' + 'min-width:0!important;' + 'min-height:0!important;' + 'max-width:none!important;' + 'max-height:none!important;' + 'image-orientation:0deg!important;"';
        el.innerHTML = '';
        el.appendChild(img);
      });
    },
    resetPreview: function resetPreview() {
      forEach(this.previews, function (element) {
        var data = getData(element, DATA_PREVIEW);
        setStyle(element, {
          width: data.width,
          height: data.height
        });
        element.innerHTML = data.html;
        removeData(element, DATA_PREVIEW);
      });
    },
    preview: function preview() {
      var imageData = this.imageData,
          canvasData = this.canvasData,
          cropBoxData = this.cropBoxData;
      var cropBoxWidth = cropBoxData.width,
          cropBoxHeight = cropBoxData.height;
      var width = imageData.width,
          height = imageData.height;
      var left = cropBoxData.left - canvasData.left - imageData.left;
      var top = cropBoxData.top - canvasData.top - imageData.top;

      if (!this.cropped || this.disabled) {
        return;
      }

      setStyle(this.viewBoxImage, assign({
        width: width,
        height: height
      }, getTransforms(assign({
        translateX: -left,
        translateY: -top
      }, imageData))));
      forEach(this.previews, function (element) {
        var data = getData(element, DATA_PREVIEW);
        var originalWidth = data.width;
        var originalHeight = data.height;
        var newWidth = originalWidth;
        var newHeight = originalHeight;
        var ratio = 1;

        if (cropBoxWidth) {
          ratio = originalWidth / cropBoxWidth;
          newHeight = cropBoxHeight * ratio;
        }

        if (cropBoxHeight && newHeight > originalHeight) {
          ratio = originalHeight / cropBoxHeight;
          newWidth = cropBoxWidth * ratio;
          newHeight = originalHeight;
        }

        setStyle(element, {
          width: newWidth,
          height: newHeight
        });
        setStyle(element.getElementsByTagName('img')[0], assign({
          width: width * ratio,
          height: height * ratio
        }, getTransforms(assign({
          translateX: -left * ratio,
          translateY: -top * ratio
        }, imageData))));
      });
    }
  };

  var events = {
    bind: function bind() {
      var element = this.element,
          options = this.options,
          cropper = this.cropper;

      if (isFunction(options.cropstart)) {
        addListener(element, EVENT_CROP_START, options.cropstart);
      }

      if (isFunction(options.cropmove)) {
        addListener(element, EVENT_CROP_MOVE, options.cropmove);
      }

      if (isFunction(options.cropend)) {
        addListener(element, EVENT_CROP_END, options.cropend);
      }

      if (isFunction(options.crop)) {
        addListener(element, EVENT_CROP, options.crop);
      }

      if (isFunction(options.zoom)) {
        addListener(element, EVENT_ZOOM, options.zoom);
      }

      addListener(cropper, EVENT_POINTER_DOWN, this.onCropStart = this.cropStart.bind(this));

      if (options.zoomable && options.zoomOnWheel) {
        addListener(cropper, EVENT_WHEEL, this.onWheel = this.wheel.bind(this), {
          passive: false,
          capture: true
        });
      }

      if (options.toggleDragModeOnDblclick) {
        addListener(cropper, EVENT_DBLCLICK, this.onDblclick = this.dblclick.bind(this));
      }

      addListener(element.ownerDocument, EVENT_POINTER_MOVE, this.onCropMove = this.cropMove.bind(this));
      addListener(element.ownerDocument, EVENT_POINTER_UP, this.onCropEnd = this.cropEnd.bind(this));

      if (options.responsive) {
        addListener(window, EVENT_RESIZE, this.onResize = this.resize.bind(this));
      }
    },
    unbind: function unbind() {
      var element = this.element,
          options = this.options,
          cropper = this.cropper;

      if (isFunction(options.cropstart)) {
        removeListener(element, EVENT_CROP_START, options.cropstart);
      }

      if (isFunction(options.cropmove)) {
        removeListener(element, EVENT_CROP_MOVE, options.cropmove);
      }

      if (isFunction(options.cropend)) {
        removeListener(element, EVENT_CROP_END, options.cropend);
      }

      if (isFunction(options.crop)) {
        removeListener(element, EVENT_CROP, options.crop);
      }

      if (isFunction(options.zoom)) {
        removeListener(element, EVENT_ZOOM, options.zoom);
      }

      removeListener(cropper, EVENT_POINTER_DOWN, this.onCropStart);

      if (options.zoomable && options.zoomOnWheel) {
        removeListener(cropper, EVENT_WHEEL, this.onWheel, {
          passive: false,
          capture: true
        });
      }

      if (options.toggleDragModeOnDblclick) {
        removeListener(cropper, EVENT_DBLCLICK, this.onDblclick);
      }

      removeListener(element.ownerDocument, EVENT_POINTER_MOVE, this.onCropMove);
      removeListener(element.ownerDocument, EVENT_POINTER_UP, this.onCropEnd);

      if (options.responsive) {
        removeListener(window, EVENT_RESIZE, this.onResize);
      }
    }
  };

  var handlers = {
    resize: function resize() {
      if (this.disabled) {
        return;
      }

      var options = this.options,
          container = this.container,
          containerData = this.containerData;
      var ratioX = container.offsetWidth / containerData.width;
      var ratioY = container.offsetHeight / containerData.height;
      var ratio = Math.abs(ratioX - 1) > Math.abs(ratioY - 1) ? ratioX : ratioY; // Resize when width changed or height changed

      if (ratio !== 1) {
        var canvasData;
        var cropBoxData;

        if (options.restore) {
          canvasData = this.getCanvasData();
          cropBoxData = this.getCropBoxData();
        }

        this.render();

        if (options.restore) {
          this.setCanvasData(forEach(canvasData, function (n, i) {
            canvasData[i] = n * ratio;
          }));
          this.setCropBoxData(forEach(cropBoxData, function (n, i) {
            cropBoxData[i] = n * ratio;
          }));
        }
      }
    },
    dblclick: function dblclick() {
      if (this.disabled || this.options.dragMode === DRAG_MODE_NONE) {
        return;
      }

      this.setDragMode(hasClass(this.dragBox, CLASS_CROP) ? DRAG_MODE_MOVE : DRAG_MODE_CROP);
    },
    wheel: function wheel(event) {
      var _this = this;

      var ratio = Number(this.options.wheelZoomRatio) || 0.1;
      var delta = 1;

      if (this.disabled) {
        return;
      }

      event.preventDefault(); // Limit wheel speed to prevent zoom too fast (#21)

      if (this.wheeling) {
        return;
      }

      this.wheeling = true;
      setTimeout(function () {
        _this.wheeling = false;
      }, 50);

      if (event.deltaY) {
        delta = event.deltaY > 0 ? 1 : -1;
      } else if (event.wheelDelta) {
        delta = -event.wheelDelta / 120;
      } else if (event.detail) {
        delta = event.detail > 0 ? 1 : -1;
      }

      this.zoom(-delta * ratio, event);
    },
    cropStart: function cropStart(event) {
      var buttons = event.buttons,
          button = event.button;

      if (this.disabled // Handle mouse event and pointer event and ignore touch event
      || (event.type === 'mousedown' || event.type === 'pointerdown' && event.pointerType === 'mouse') && ( // No primary button (Usually the left button)
      isNumber(buttons) && buttons !== 1 || isNumber(button) && button !== 0 // Open context menu
      || event.ctrlKey)) {
        return;
      }

      var options = this.options,
          pointers = this.pointers;
      var action;

      if (event.changedTouches) {
        // Handle touch event
        forEach(event.changedTouches, function (touch) {
          pointers[touch.identifier] = getPointer(touch);
        });
      } else {
        // Handle mouse event and pointer event
        pointers[event.pointerId || 0] = getPointer(event);
      }

      if (Object.keys(pointers).length > 1 && options.zoomable && options.zoomOnTouch) {
        action = ACTION_ZOOM;
      } else {
        action = getData(event.target, DATA_ACTION);
      }

      if (!REGEXP_ACTIONS.test(action)) {
        return;
      }

      if (dispatchEvent(this.element, EVENT_CROP_START, {
        originalEvent: event,
        action: action
      }) === false) {
        return;
      } // This line is required for preventing page zooming in iOS browsers


      event.preventDefault();
      this.action = action;
      this.cropping = false;

      if (action === ACTION_CROP) {
        this.cropping = true;
        addClass(this.dragBox, CLASS_MODAL);
      }
    },
    cropMove: function cropMove(event) {
      var action = this.action;

      if (this.disabled || !action) {
        return;
      }

      var pointers = this.pointers;
      event.preventDefault();

      if (dispatchEvent(this.element, EVENT_CROP_MOVE, {
        originalEvent: event,
        action: action
      }) === false) {
        return;
      }

      if (event.changedTouches) {
        forEach(event.changedTouches, function (touch) {
          // The first parameter should not be undefined (#432)
          assign(pointers[touch.identifier] || {}, getPointer(touch, true));
        });
      } else {
        assign(pointers[event.pointerId || 0] || {}, getPointer(event, true));
      }

      this.change(event);
    },
    cropEnd: function cropEnd(event) {
      if (this.disabled) {
        return;
      }

      var action = this.action,
          pointers = this.pointers;

      if (event.changedTouches) {
        forEach(event.changedTouches, function (touch) {
          delete pointers[touch.identifier];
        });
      } else {
        delete pointers[event.pointerId || 0];
      }

      if (!action) {
        return;
      }

      event.preventDefault();

      if (!Object.keys(pointers).length) {
        this.action = '';
      }

      if (this.cropping) {
        this.cropping = false;
        toggleClass(this.dragBox, CLASS_MODAL, this.cropped && this.options.modal);
      }

      dispatchEvent(this.element, EVENT_CROP_END, {
        originalEvent: event,
        action: action
      });
    }
  };

  var change = {
    change: function change(event) {
      var options = this.options,
          canvasData = this.canvasData,
          containerData = this.containerData,
          cropBoxData = this.cropBoxData,
          pointers = this.pointers;
      var action = this.action;
      var aspectRatio = options.aspectRatio;
      var left = cropBoxData.left,
          top = cropBoxData.top,
          width = cropBoxData.width,
          height = cropBoxData.height;
      var right = left + width;
      var bottom = top + height;
      var minLeft = 0;
      var minTop = 0;
      var maxWidth = containerData.width;
      var maxHeight = containerData.height;
      var renderable = true;
      var offset; // Locking aspect ratio in "free mode" by holding shift key

      if (!aspectRatio && event.shiftKey) {
        aspectRatio = width && height ? width / height : 1;
      }

      if (this.limited) {
        minLeft = cropBoxData.minLeft;
        minTop = cropBoxData.minTop;
        maxWidth = minLeft + Math.min(containerData.width, canvasData.width, canvasData.left + canvasData.width);
        maxHeight = minTop + Math.min(containerData.height, canvasData.height, canvasData.top + canvasData.height);
      }

      var pointer = pointers[Object.keys(pointers)[0]];
      var range = {
        x: pointer.endX - pointer.startX,
        y: pointer.endY - pointer.startY
      };

      var check = function check(side) {
        switch (side) {
          case ACTION_EAST:
            if (right + range.x > maxWidth) {
              range.x = maxWidth - right;
            }

            break;

          case ACTION_WEST:
            if (left + range.x < minLeft) {
              range.x = minLeft - left;
            }

            break;

          case ACTION_NORTH:
            if (top + range.y < minTop) {
              range.y = minTop - top;
            }

            break;

          case ACTION_SOUTH:
            if (bottom + range.y > maxHeight) {
              range.y = maxHeight - bottom;
            }

            break;
        }
      };

      switch (action) {
        // Move crop box
        case ACTION_ALL:
          left += range.x;
          top += range.y;
          break;
        // Resize crop box

        case ACTION_EAST:
          if (range.x >= 0 && (right >= maxWidth || aspectRatio && (top <= minTop || bottom >= maxHeight))) {
            renderable = false;
            break;
          }

          check(ACTION_EAST);
          width += range.x;

          if (width < 0) {
            action = ACTION_WEST;
            width = -width;
            left -= width;
          }

          if (aspectRatio) {
            height = width / aspectRatio;
            top += (cropBoxData.height - height) / 2;
          }

          break;

        case ACTION_NORTH:
          if (range.y <= 0 && (top <= minTop || aspectRatio && (left <= minLeft || right >= maxWidth))) {
            renderable = false;
            break;
          }

          check(ACTION_NORTH);
          height -= range.y;
          top += range.y;

          if (height < 0) {
            action = ACTION_SOUTH;
            height = -height;
            top -= height;
          }

          if (aspectRatio) {
            width = height * aspectRatio;
            left += (cropBoxData.width - width) / 2;
          }

          break;

        case ACTION_WEST:
          if (range.x <= 0 && (left <= minLeft || aspectRatio && (top <= minTop || bottom >= maxHeight))) {
            renderable = false;
            break;
          }

          check(ACTION_WEST);
          width -= range.x;
          left += range.x;

          if (width < 0) {
            action = ACTION_EAST;
            width = -width;
            left -= width;
          }

          if (aspectRatio) {
            height = width / aspectRatio;
            top += (cropBoxData.height - height) / 2;
          }

          break;

        case ACTION_SOUTH:
          if (range.y >= 0 && (bottom >= maxHeight || aspectRatio && (left <= minLeft || right >= maxWidth))) {
            renderable = false;
            break;
          }

          check(ACTION_SOUTH);
          height += range.y;

          if (height < 0) {
            action = ACTION_NORTH;
            height = -height;
            top -= height;
          }

          if (aspectRatio) {
            width = height * aspectRatio;
            left += (cropBoxData.width - width) / 2;
          }

          break;

        case ACTION_NORTH_EAST:
          if (aspectRatio) {
            if (range.y <= 0 && (top <= minTop || right >= maxWidth)) {
              renderable = false;
              break;
            }

            check(ACTION_NORTH);
            height -= range.y;
            top += range.y;
            width = height * aspectRatio;
          } else {
            check(ACTION_NORTH);
            check(ACTION_EAST);

            if (range.x >= 0) {
              if (right < maxWidth) {
                width += range.x;
              } else if (range.y <= 0 && top <= minTop) {
                renderable = false;
              }
            } else {
              width += range.x;
            }

            if (range.y <= 0) {
              if (top > minTop) {
                height -= range.y;
                top += range.y;
              }
            } else {
              height -= range.y;
              top += range.y;
            }
          }

          if (width < 0 && height < 0) {
            action = ACTION_SOUTH_WEST;
            height = -height;
            width = -width;
            top -= height;
            left -= width;
          } else if (width < 0) {
            action = ACTION_NORTH_WEST;
            width = -width;
            left -= width;
          } else if (height < 0) {
            action = ACTION_SOUTH_EAST;
            height = -height;
            top -= height;
          }

          break;

        case ACTION_NORTH_WEST:
          if (aspectRatio) {
            if (range.y <= 0 && (top <= minTop || left <= minLeft)) {
              renderable = false;
              break;
            }

            check(ACTION_NORTH);
            height -= range.y;
            top += range.y;
            width = height * aspectRatio;
            left += cropBoxData.width - width;
          } else {
            check(ACTION_NORTH);
            check(ACTION_WEST);

            if (range.x <= 0) {
              if (left > minLeft) {
                width -= range.x;
                left += range.x;
              } else if (range.y <= 0 && top <= minTop) {
                renderable = false;
              }
            } else {
              width -= range.x;
              left += range.x;
            }

            if (range.y <= 0) {
              if (top > minTop) {
                height -= range.y;
                top += range.y;
              }
            } else {
              height -= range.y;
              top += range.y;
            }
          }

          if (width < 0 && height < 0) {
            action = ACTION_SOUTH_EAST;
            height = -height;
            width = -width;
            top -= height;
            left -= width;
          } else if (width < 0) {
            action = ACTION_NORTH_EAST;
            width = -width;
            left -= width;
          } else if (height < 0) {
            action = ACTION_SOUTH_WEST;
            height = -height;
            top -= height;
          }

          break;

        case ACTION_SOUTH_WEST:
          if (aspectRatio) {
            if (range.x <= 0 && (left <= minLeft || bottom >= maxHeight)) {
              renderable = false;
              break;
            }

            check(ACTION_WEST);
            width -= range.x;
            left += range.x;
            height = width / aspectRatio;
          } else {
            check(ACTION_SOUTH);
            check(ACTION_WEST);

            if (range.x <= 0) {
              if (left > minLeft) {
                width -= range.x;
                left += range.x;
              } else if (range.y >= 0 && bottom >= maxHeight) {
                renderable = false;
              }
            } else {
              width -= range.x;
              left += range.x;
            }

            if (range.y >= 0) {
              if (bottom < maxHeight) {
                height += range.y;
              }
            } else {
              height += range.y;
            }
          }

          if (width < 0 && height < 0) {
            action = ACTION_NORTH_EAST;
            height = -height;
            width = -width;
            top -= height;
            left -= width;
          } else if (width < 0) {
            action = ACTION_SOUTH_EAST;
            width = -width;
            left -= width;
          } else if (height < 0) {
            action = ACTION_NORTH_WEST;
            height = -height;
            top -= height;
          }

          break;

        case ACTION_SOUTH_EAST:
          if (aspectRatio) {
            if (range.x >= 0 && (right >= maxWidth || bottom >= maxHeight)) {
              renderable = false;
              break;
            }

            check(ACTION_EAST);
            width += range.x;
            height = width / aspectRatio;
          } else {
            check(ACTION_SOUTH);
            check(ACTION_EAST);

            if (range.x >= 0) {
              if (right < maxWidth) {
                width += range.x;
              } else if (range.y >= 0 && bottom >= maxHeight) {
                renderable = false;
              }
            } else {
              width += range.x;
            }

            if (range.y >= 0) {
              if (bottom < maxHeight) {
                height += range.y;
              }
            } else {
              height += range.y;
            }
          }

          if (width < 0 && height < 0) {
            action = ACTION_NORTH_WEST;
            height = -height;
            width = -width;
            top -= height;
            left -= width;
          } else if (width < 0) {
            action = ACTION_SOUTH_WEST;
            width = -width;
            left -= width;
          } else if (height < 0) {
            action = ACTION_NORTH_EAST;
            height = -height;
            top -= height;
          }

          break;
        // Move canvas

        case ACTION_MOVE:
          this.move(range.x, range.y);
          renderable = false;
          break;
        // Zoom canvas

        case ACTION_ZOOM:
          this.zoom(getMaxZoomRatio(pointers), event);
          renderable = false;
          break;
        // Create crop box

        case ACTION_CROP:
          if (!range.x || !range.y) {
            renderable = false;
            break;
          }

          offset = getOffset(this.cropper);
          left = pointer.startX - offset.left;
          top = pointer.startY - offset.top;
          width = cropBoxData.minWidth;
          height = cropBoxData.minHeight;

          if (range.x > 0) {
            action = range.y > 0 ? ACTION_SOUTH_EAST : ACTION_NORTH_EAST;
          } else if (range.x < 0) {
            left -= width;
            action = range.y > 0 ? ACTION_SOUTH_WEST : ACTION_NORTH_WEST;
          }

          if (range.y < 0) {
            top -= height;
          } // Show the crop box if is hidden


          if (!this.cropped) {
            removeClass(this.cropBox, CLASS_HIDDEN);
            this.cropped = true;

            if (this.limited) {
              this.limitCropBox(true, true);
            }
          }

          break;
      }

      if (renderable) {
        cropBoxData.width = width;
        cropBoxData.height = height;
        cropBoxData.left = left;
        cropBoxData.top = top;
        this.action = action;
        this.renderCropBox();
      } // Override


      forEach(pointers, function (p) {
        p.startX = p.endX;
        p.startY = p.endY;
      });
    }
  };

  var methods = {
    // Show the crop box manually
    crop: function crop() {
      if (this.ready && !this.cropped && !this.disabled) {
        this.cropped = true;
        this.limitCropBox(true, true);

        if (this.options.modal) {
          addClass(this.dragBox, CLASS_MODAL);
        }

        removeClass(this.cropBox, CLASS_HIDDEN);
        this.setCropBoxData(this.initialCropBoxData);
      }

      return this;
    },
    // Reset the image and crop box to their initial states
    reset: function reset() {
      if (this.ready && !this.disabled) {
        this.imageData = assign({}, this.initialImageData);
        this.canvasData = assign({}, this.initialCanvasData);
        this.cropBoxData = assign({}, this.initialCropBoxData);
        this.renderCanvas();

        if (this.cropped) {
          this.renderCropBox();
        }
      }

      return this;
    },
    // Clear the crop box
    clear: function clear() {
      if (this.cropped && !this.disabled) {
        assign(this.cropBoxData, {
          left: 0,
          top: 0,
          width: 0,
          height: 0
        });
        this.cropped = false;
        this.renderCropBox();
        this.limitCanvas(true, true); // Render canvas after crop box rendered

        this.renderCanvas();
        removeClass(this.dragBox, CLASS_MODAL);
        addClass(this.cropBox, CLASS_HIDDEN);
      }

      return this;
    },

    /**
     * Replace the image's src and rebuild the cropper
     * @param {string} url - The new URL.
     * @param {boolean} [hasSameSize] - Indicate if the new image has the same size as the old one.
     * @returns {Cropper} this
     */
    replace: function replace(url) {
      var hasSameSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

      if (!this.disabled && url) {
        if (this.isImg) {
          this.element.src = url;
        }

        if (hasSameSize) {
          this.url = url;
          this.image.src = url;

          if (this.ready) {
            this.viewBoxImage.src = url;
            forEach(this.previews, function (element) {
              element.getElementsByTagName('img')[0].src = url;
            });
          }
        } else {
          if (this.isImg) {
            this.replaced = true;
          }

          this.options.data = null;
          this.uncreate();
          this.load(url);
        }
      }

      return this;
    },
    // Enable (unfreeze) the cropper
    enable: function enable() {
      if (this.ready && this.disabled) {
        this.disabled = false;
        removeClass(this.cropper, CLASS_DISABLED);
      }

      return this;
    },
    // Disable (freeze) the cropper
    disable: function disable() {
      if (this.ready && !this.disabled) {
        this.disabled = true;
        addClass(this.cropper, CLASS_DISABLED);
      }

      return this;
    },

    /**
     * Destroy the cropper and remove the instance from the image
     * @returns {Cropper} this
     */
    destroy: function destroy() {
      var element = this.element;

      if (!element[NAMESPACE]) {
        return this;
      }

      element[NAMESPACE] = undefined;

      if (this.isImg && this.replaced) {
        element.src = this.originalUrl;
      }

      this.uncreate();
      return this;
    },

    /**
     * Move the canvas with relative offsets
     * @param {number} offsetX - The relative offset distance on the x-axis.
     * @param {number} [offsetY=offsetX] - The relative offset distance on the y-axis.
     * @returns {Cropper} this
     */
    move: function move(offsetX) {
      var offsetY = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : offsetX;
      var _this$canvasData = this.canvasData,
          left = _this$canvasData.left,
          top = _this$canvasData.top;
      return this.moveTo(isUndefined(offsetX) ? offsetX : left + Number(offsetX), isUndefined(offsetY) ? offsetY : top + Number(offsetY));
    },

    /**
     * Move the canvas to an absolute point
     * @param {number} x - The x-axis coordinate.
     * @param {number} [y=x] - The y-axis coordinate.
     * @returns {Cropper} this
     */
    moveTo: function moveTo(x) {
      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : x;
      var canvasData = this.canvasData;
      var changed = false;
      x = Number(x);
      y = Number(y);

      if (this.ready && !this.disabled && this.options.movable) {
        if (isNumber(x)) {
          canvasData.left = x;
          changed = true;
        }

        if (isNumber(y)) {
          canvasData.top = y;
          changed = true;
        }

        if (changed) {
          this.renderCanvas(true);
        }
      }

      return this;
    },

    /**
     * Zoom the canvas with a relative ratio
     * @param {number} ratio - The target ratio.
     * @param {Event} _originalEvent - The original event if any.
     * @returns {Cropper} this
     */
    zoom: function zoom(ratio, _originalEvent) {
      var canvasData = this.canvasData;
      ratio = Number(ratio);

      if (ratio < 0) {
        ratio = 1 / (1 - ratio);
      } else {
        ratio = 1 + ratio;
      }

      return this.zoomTo(canvasData.width * ratio / canvasData.naturalWidth, null, _originalEvent);
    },

    /**
     * Zoom the canvas to an absolute ratio
     * @param {number} ratio - The target ratio.
     * @param {Object} pivot - The zoom pivot point coordinate.
     * @param {Event} _originalEvent - The original event if any.
     * @returns {Cropper} this
     */
    zoomTo: function zoomTo(ratio, pivot, _originalEvent) {
      var options = this.options,
          canvasData = this.canvasData;
      var width = canvasData.width,
          height = canvasData.height,
          naturalWidth = canvasData.naturalWidth,
          naturalHeight = canvasData.naturalHeight;
      ratio = Number(ratio);

      if (ratio >= 0 && this.ready && !this.disabled && options.zoomable) {
        var newWidth = naturalWidth * ratio;
        var newHeight = naturalHeight * ratio;

        if (dispatchEvent(this.element, EVENT_ZOOM, {
          ratio: ratio,
          oldRatio: width / naturalWidth,
          originalEvent: _originalEvent
        }) === false) {
          return this;
        }

        if (_originalEvent) {
          var pointers = this.pointers;
          var offset = getOffset(this.cropper);
          var center = pointers && Object.keys(pointers).length ? getPointersCenter(pointers) : {
            pageX: _originalEvent.pageX,
            pageY: _originalEvent.pageY
          }; // Zoom from the triggering point of the event

          canvasData.left -= (newWidth - width) * ((center.pageX - offset.left - canvasData.left) / width);
          canvasData.top -= (newHeight - height) * ((center.pageY - offset.top - canvasData.top) / height);
        } else if (isPlainObject(pivot) && isNumber(pivot.x) && isNumber(pivot.y)) {
          canvasData.left -= (newWidth - width) * ((pivot.x - canvasData.left) / width);
          canvasData.top -= (newHeight - height) * ((pivot.y - canvasData.top) / height);
        } else {
          // Zoom from the center of the canvas
          canvasData.left -= (newWidth - width) / 2;
          canvasData.top -= (newHeight - height) / 2;
        }

        canvasData.width = newWidth;
        canvasData.height = newHeight;
        this.renderCanvas(true);
      }

      return this;
    },

    /**
     * Rotate the canvas with a relative degree
     * @param {number} degree - The rotate degree.
     * @returns {Cropper} this
     */
    rotate: function rotate(degree) {
      return this.rotateTo((this.imageData.rotate || 0) + Number(degree));
    },

    /**
     * Rotate the canvas to an absolute degree
     * @param {number} degree - The rotate degree.
     * @returns {Cropper} this
     */
    rotateTo: function rotateTo(degree) {
      degree = Number(degree);

      if (isNumber(degree) && this.ready && !this.disabled && this.options.rotatable) {
        this.imageData.rotate = degree % 360;
        this.renderCanvas(true, true);
      }

      return this;
    },

    /**
     * Scale the image on the x-axis.
     * @param {number} scaleX - The scale ratio on the x-axis.
     * @returns {Cropper} this
     */
    scaleX: function scaleX(_scaleX) {
      var scaleY = this.imageData.scaleY;
      return this.scale(_scaleX, isNumber(scaleY) ? scaleY : 1);
    },

    /**
     * Scale the image on the y-axis.
     * @param {number} scaleY - The scale ratio on the y-axis.
     * @returns {Cropper} this
     */
    scaleY: function scaleY(_scaleY) {
      var scaleX = this.imageData.scaleX;
      return this.scale(isNumber(scaleX) ? scaleX : 1, _scaleY);
    },

    /**
     * Scale the image
     * @param {number} scaleX - The scale ratio on the x-axis.
     * @param {number} [scaleY=scaleX] - The scale ratio on the y-axis.
     * @returns {Cropper} this
     */
    scale: function scale(scaleX) {
      var scaleY = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : scaleX;
      var imageData = this.imageData;
      var transformed = false;
      scaleX = Number(scaleX);
      scaleY = Number(scaleY);

      if (this.ready && !this.disabled && this.options.scalable) {
        if (isNumber(scaleX)) {
          imageData.scaleX = scaleX;
          transformed = true;
        }

        if (isNumber(scaleY)) {
          imageData.scaleY = scaleY;
          transformed = true;
        }

        if (transformed) {
          this.renderCanvas(true, true);
        }
      }

      return this;
    },

    /**
     * Get the cropped area position and size data (base on the original image)
     * @param {boolean} [rounded=false] - Indicate if round the data values or not.
     * @returns {Object} The result cropped data.
     */
    getData: function getData() {
      var rounded = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      var options = this.options,
          imageData = this.imageData,
          canvasData = this.canvasData,
          cropBoxData = this.cropBoxData;
      var data;

      if (this.ready && this.cropped) {
        data = {
          x: cropBoxData.left - canvasData.left,
          y: cropBoxData.top - canvasData.top,
          width: cropBoxData.width,
          height: cropBoxData.height
        };
        var ratio = imageData.width / imageData.naturalWidth;
        forEach(data, function (n, i) {
          data[i] = n / ratio;
        });

        if (rounded) {
          // In case rounding off leads to extra 1px in right or bottom border
          // we should round the top-left corner and the dimension (#343).
          var bottom = Math.round(data.y + data.height);
          var right = Math.round(data.x + data.width);
          data.x = Math.round(data.x);
          data.y = Math.round(data.y);
          data.width = right - data.x;
          data.height = bottom - data.y;
        }
      } else {
        data = {
          x: 0,
          y: 0,
          width: 0,
          height: 0
        };
      }

      if (options.rotatable) {
        data.rotate = imageData.rotate || 0;
      }

      if (options.scalable) {
        data.scaleX = imageData.scaleX || 1;
        data.scaleY = imageData.scaleY || 1;
      }

      return data;
    },

    /**
     * Set the cropped area position and size with new data
     * @param {Object} data - The new data.
     * @returns {Cropper} this
     */
    setData: function setData(data) {
      var options = this.options,
          imageData = this.imageData,
          canvasData = this.canvasData;
      var cropBoxData = {};

      if (this.ready && !this.disabled && isPlainObject(data)) {
        var transformed = false;

        if (options.rotatable) {
          if (isNumber(data.rotate) && data.rotate !== imageData.rotate) {
            imageData.rotate = data.rotate;
            transformed = true;
          }
        }

        if (options.scalable) {
          if (isNumber(data.scaleX) && data.scaleX !== imageData.scaleX) {
            imageData.scaleX = data.scaleX;
            transformed = true;
          }

          if (isNumber(data.scaleY) && data.scaleY !== imageData.scaleY) {
            imageData.scaleY = data.scaleY;
            transformed = true;
          }
        }

        if (transformed) {
          this.renderCanvas(true, true);
        }

        var ratio = imageData.width / imageData.naturalWidth;

        if (isNumber(data.x)) {
          cropBoxData.left = data.x * ratio + canvasData.left;
        }

        if (isNumber(data.y)) {
          cropBoxData.top = data.y * ratio + canvasData.top;
        }

        if (isNumber(data.width)) {
          cropBoxData.width = data.width * ratio;
        }

        if (isNumber(data.height)) {
          cropBoxData.height = data.height * ratio;
        }

        this.setCropBoxData(cropBoxData);
      }

      return this;
    },

    /**
     * Get the container size data.
     * @returns {Object} The result container data.
     */
    getContainerData: function getContainerData() {
      return this.ready ? assign({}, this.containerData) : {};
    },

    /**
     * Get the image position and size data.
     * @returns {Object} The result image data.
     */
    getImageData: function getImageData() {
      return this.sized ? assign({}, this.imageData) : {};
    },

    /**
     * Get the canvas position and size data.
     * @returns {Object} The result canvas data.
     */
    getCanvasData: function getCanvasData() {
      var canvasData = this.canvasData;
      var data = {};

      if (this.ready) {
        forEach(['left', 'top', 'width', 'height', 'naturalWidth', 'naturalHeight'], function (n) {
          data[n] = canvasData[n];
        });
      }

      return data;
    },

    /**
     * Set the canvas position and size with new data.
     * @param {Object} data - The new canvas data.
     * @returns {Cropper} this
     */
    setCanvasData: function setCanvasData(data) {
      var canvasData = this.canvasData;
      var aspectRatio = canvasData.aspectRatio;

      if (this.ready && !this.disabled && isPlainObject(data)) {
        if (isNumber(data.left)) {
          canvasData.left = data.left;
        }

        if (isNumber(data.top)) {
          canvasData.top = data.top;
        }

        if (isNumber(data.width)) {
          canvasData.width = data.width;
          canvasData.height = data.width / aspectRatio;
        } else if (isNumber(data.height)) {
          canvasData.height = data.height;
          canvasData.width = data.height * aspectRatio;
        }

        this.renderCanvas(true);
      }

      return this;
    },

    /**
     * Get the crop box position and size data.
     * @returns {Object} The result crop box data.
     */
    getCropBoxData: function getCropBoxData() {
      var cropBoxData = this.cropBoxData;
      var data;

      if (this.ready && this.cropped) {
        data = {
          left: cropBoxData.left,
          top: cropBoxData.top,
          width: cropBoxData.width,
          height: cropBoxData.height
        };
      }

      return data || {};
    },

    /**
     * Set the crop box position and size with new data.
     * @param {Object} data - The new crop box data.
     * @returns {Cropper} this
     */
    setCropBoxData: function setCropBoxData(data) {
      var cropBoxData = this.cropBoxData;
      var aspectRatio = this.options.aspectRatio;
      var widthChanged;
      var heightChanged;

      if (this.ready && this.cropped && !this.disabled && isPlainObject(data)) {
        if (isNumber(data.left)) {
          cropBoxData.left = data.left;
        }

        if (isNumber(data.top)) {
          cropBoxData.top = data.top;
        }

        if (isNumber(data.width) && data.width !== cropBoxData.width) {
          widthChanged = true;
          cropBoxData.width = data.width;
        }

        if (isNumber(data.height) && data.height !== cropBoxData.height) {
          heightChanged = true;
          cropBoxData.height = data.height;
        }

        if (aspectRatio) {
          if (widthChanged) {
            cropBoxData.height = cropBoxData.width / aspectRatio;
          } else if (heightChanged) {
            cropBoxData.width = cropBoxData.height * aspectRatio;
          }
        }

        this.renderCropBox();
      }

      return this;
    },

    /**
     * Get a canvas drawn the cropped image.
     * @param {Object} [options={}] - The config options.
     * @returns {HTMLCanvasElement} - The result canvas.
     */
    getCroppedCanvas: function getCroppedCanvas() {
      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      if (!this.ready || !window.HTMLCanvasElement) {
        return null;
      }

      var canvasData = this.canvasData;
      var source = getSourceCanvas(this.image, this.imageData, canvasData, options); // Returns the source canvas if it is not cropped.

      if (!this.cropped) {
        return source;
      }

      var _this$getData = this.getData(),
          initialX = _this$getData.x,
          initialY = _this$getData.y,
          initialWidth = _this$getData.width,
          initialHeight = _this$getData.height;

      var ratio = source.width / Math.floor(canvasData.naturalWidth);

      if (ratio !== 1) {
        initialX *= ratio;
        initialY *= ratio;
        initialWidth *= ratio;
        initialHeight *= ratio;
      }

      var aspectRatio = initialWidth / initialHeight;
      var maxSizes = getAdjustedSizes({
        aspectRatio: aspectRatio,
        width: options.maxWidth || Infinity,
        height: options.maxHeight || Infinity
      });
      var minSizes = getAdjustedSizes({
        aspectRatio: aspectRatio,
        width: options.minWidth || 0,
        height: options.minHeight || 0
      }, 'cover');

      var _getAdjustedSizes = getAdjustedSizes({
        aspectRatio: aspectRatio,
        width: options.width || (ratio !== 1 ? source.width : initialWidth),
        height: options.height || (ratio !== 1 ? source.height : initialHeight)
      }),
          width = _getAdjustedSizes.width,
          height = _getAdjustedSizes.height;

      width = Math.min(maxSizes.width, Math.max(minSizes.width, width));
      height = Math.min(maxSizes.height, Math.max(minSizes.height, height));
      var canvas = document.createElement('canvas');
      var context = canvas.getContext('2d');
      canvas.width = normalizeDecimalNumber(width);
      canvas.height = normalizeDecimalNumber(height);
      context.fillStyle = options.fillColor || 'transparent';
      context.fillRect(0, 0, width, height);
      var _options$imageSmoothi = options.imageSmoothingEnabled,
          imageSmoothingEnabled = _options$imageSmoothi === void 0 ? true : _options$imageSmoothi,
          imageSmoothingQuality = options.imageSmoothingQuality;
      context.imageSmoothingEnabled = imageSmoothingEnabled;

      if (imageSmoothingQuality) {
        context.imageSmoothingQuality = imageSmoothingQuality;
      } // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D.drawImage


      var sourceWidth = source.width;
      var sourceHeight = source.height; // Source canvas parameters

      var srcX = initialX;
      var srcY = initialY;
      var srcWidth;
      var srcHeight; // Destination canvas parameters

      var dstX;
      var dstY;
      var dstWidth;
      var dstHeight;

      if (srcX <= -initialWidth || srcX > sourceWidth) {
        srcX = 0;
        srcWidth = 0;
        dstX = 0;
        dstWidth = 0;
      } else if (srcX <= 0) {
        dstX = -srcX;
        srcX = 0;
        srcWidth = Math.min(sourceWidth, initialWidth + srcX);
        dstWidth = srcWidth;
      } else if (srcX <= sourceWidth) {
        dstX = 0;
        srcWidth = Math.min(initialWidth, sourceWidth - srcX);
        dstWidth = srcWidth;
      }

      if (srcWidth <= 0 || srcY <= -initialHeight || srcY > sourceHeight) {
        srcY = 0;
        srcHeight = 0;
        dstY = 0;
        dstHeight = 0;
      } else if (srcY <= 0) {
        dstY = -srcY;
        srcY = 0;
        srcHeight = Math.min(sourceHeight, initialHeight + srcY);
        dstHeight = srcHeight;
      } else if (srcY <= sourceHeight) {
        dstY = 0;
        srcHeight = Math.min(initialHeight, sourceHeight - srcY);
        dstHeight = srcHeight;
      }

      var params = [srcX, srcY, srcWidth, srcHeight]; // Avoid "IndexSizeError"

      if (dstWidth > 0 && dstHeight > 0) {
        var scale = width / initialWidth;
        params.push(dstX * scale, dstY * scale, dstWidth * scale, dstHeight * scale);
      } // All the numerical parameters should be integer for `drawImage`
      // https://github.com/fengyuanchen/cropper/issues/476


      context.drawImage.apply(context, [source].concat(_toConsumableArray(params.map(function (param) {
        return Math.floor(normalizeDecimalNumber(param));
      }))));
      return canvas;
    },

    /**
     * Change the aspect ratio of the crop box.
     * @param {number} aspectRatio - The new aspect ratio.
     * @returns {Cropper} this
     */
    setAspectRatio: function setAspectRatio(aspectRatio) {
      var options = this.options;

      if (!this.disabled && !isUndefined(aspectRatio)) {
        // 0 -> NaN
        options.aspectRatio = Math.max(0, aspectRatio) || NaN;

        if (this.ready) {
          this.initCropBox();

          if (this.cropped) {
            this.renderCropBox();
          }
        }
      }

      return this;
    },

    /**
     * Change the drag mode.
     * @param {string} mode - The new drag mode.
     * @returns {Cropper} this
     */
    setDragMode: function setDragMode(mode) {
      var options = this.options,
          dragBox = this.dragBox,
          face = this.face;

      if (this.ready && !this.disabled) {
        var croppable = mode === DRAG_MODE_CROP;
        var movable = options.movable && mode === DRAG_MODE_MOVE;
        mode = croppable || movable ? mode : DRAG_MODE_NONE;
        options.dragMode = mode;
        setData(dragBox, DATA_ACTION, mode);
        toggleClass(dragBox, CLASS_CROP, croppable);
        toggleClass(dragBox, CLASS_MOVE, movable);

        if (!options.cropBoxMovable) {
          // Sync drag mode to crop box when it is not movable
          setData(face, DATA_ACTION, mode);
          toggleClass(face, CLASS_CROP, croppable);
          toggleClass(face, CLASS_MOVE, movable);
        }
      }

      return this;
    }
  };

  var AnotherCropper = WINDOW.Cropper;

  var Cropper = /*#__PURE__*/function () {
    /**
     * Create a new Cropper.
     * @param {Element} element - The target element for cropping.
     * @param {Object} [options={}] - The configuration options.
     */
    function Cropper(element) {
      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      _classCallCheck(this, Cropper);

      if (!element || !REGEXP_TAG_NAME.test(element.tagName)) {
        throw new Error('The first argument is required and must be an <img> or <canvas> element.');
      }

      this.element = element;
      this.options = assign({}, DEFAULTS, isPlainObject(options) && options);
      this.cropped = false;
      this.disabled = false;
      this.pointers = {};
      this.ready = false;
      this.reloading = false;
      this.replaced = false;
      this.sized = false;
      this.sizing = false;
      this.init();
    }

    _createClass(Cropper, [{
      key: "init",
      value: function init() {
        var element = this.element;
        var tagName = element.tagName.toLowerCase();
        var url;

        if (element[NAMESPACE]) {
          return;
        }

        element[NAMESPACE] = this;

        if (tagName === 'img') {
          this.isImg = true; // e.g.: "img/picture.jpg"

          url = element.getAttribute('src') || '';
          this.originalUrl = url; // Stop when it's a blank image

          if (!url) {
            return;
          } // e.g.: "https://example.com/img/picture.jpg"


          url = element.src;
        } else if (tagName === 'canvas' && window.HTMLCanvasElement) {
          url = element.toDataURL();
        }

        this.load(url);
      }
    }, {
      key: "load",
      value: function load(url) {
        var _this = this;

        if (!url) {
          return;
        }

        this.url = url;
        this.imageData = {};
        var element = this.element,
            options = this.options;

        if (!options.rotatable && !options.scalable) {
          options.checkOrientation = false;
        } // Only IE10+ supports Typed Arrays


        if (!options.checkOrientation || !window.ArrayBuffer) {
          this.clone();
          return;
        } // Detect the mime type of the image directly if it is a Data URL


        if (REGEXP_DATA_URL.test(url)) {
          // Read ArrayBuffer from Data URL of JPEG images directly for better performance
          if (REGEXP_DATA_URL_JPEG.test(url)) {
            this.read(dataURLToArrayBuffer(url));
          } else {
            // Only a JPEG image may contains Exif Orientation information,
            // the rest types of Data URLs are not necessary to check orientation at all.
            this.clone();
          }

          return;
        } // 1. Detect the mime type of the image by a XMLHttpRequest.
        // 2. Load the image as ArrayBuffer for reading orientation if its a JPEG image.


        var xhr = new XMLHttpRequest();
        var clone = this.clone.bind(this);
        this.reloading = true;
        this.xhr = xhr; // 1. Cross origin requests are only supported for protocol schemes:
        // http, https, data, chrome, chrome-extension.
        // 2. Access to XMLHttpRequest from a Data URL will be blocked by CORS policy
        // in some browsers as IE11 and Safari.

        xhr.onabort = clone;
        xhr.onerror = clone;
        xhr.ontimeout = clone;

        xhr.onprogress = function () {
          // Abort the request directly if it not a JPEG image for better performance
          if (xhr.getResponseHeader('content-type') !== MIME_TYPE_JPEG) {
            xhr.abort();
          }
        };

        xhr.onload = function () {
          _this.read(xhr.response);
        };

        xhr.onloadend = function () {
          _this.reloading = false;
          _this.xhr = null;
        }; // Bust cache when there is a "crossOrigin" property to avoid browser cache error


        if (options.checkCrossOrigin && isCrossOriginURL(url) && element.crossOrigin) {
          url = addTimestamp(url);
        } // The third parameter is required for avoiding side-effect (#682)


        xhr.open('GET', url, true);
        xhr.responseType = 'arraybuffer';
        xhr.withCredentials = element.crossOrigin === 'use-credentials';
        xhr.send();
      }
    }, {
      key: "read",
      value: function read(arrayBuffer) {
        var options = this.options,
            imageData = this.imageData; // Reset the orientation value to its default value 1
        // as some iOS browsers will render image with its orientation

        var orientation = resetAndGetOrientation(arrayBuffer);
        var rotate = 0;
        var scaleX = 1;
        var scaleY = 1;

        if (orientation > 1) {
          // Generate a new URL which has the default orientation value
          this.url = arrayBufferToDataURL(arrayBuffer, MIME_TYPE_JPEG);

          var _parseOrientation = parseOrientation(orientation);

          rotate = _parseOrientation.rotate;
          scaleX = _parseOrientation.scaleX;
          scaleY = _parseOrientation.scaleY;
        }

        if (options.rotatable) {
          imageData.rotate = rotate;
        }

        if (options.scalable) {
          imageData.scaleX = scaleX;
          imageData.scaleY = scaleY;
        }

        this.clone();
      }
    }, {
      key: "clone",
      value: function clone() {
        var element = this.element,
            url = this.url;
        var crossOrigin = element.crossOrigin;
        var crossOriginUrl = url;

        if (this.options.checkCrossOrigin && isCrossOriginURL(url)) {
          if (!crossOrigin) {
            crossOrigin = 'anonymous';
          } // Bust cache when there is not a "crossOrigin" property (#519)


          crossOriginUrl = addTimestamp(url);
        }

        this.crossOrigin = crossOrigin;
        this.crossOriginUrl = crossOriginUrl;
        var image = document.createElement('img');

        if (crossOrigin) {
          image.crossOrigin = crossOrigin;
        }

        image.src = crossOriginUrl || url;
        image.alt = element.alt || 'The image to crop';
        this.image = image;
        image.onload = this.start.bind(this);
        image.onerror = this.stop.bind(this);
        addClass(image, CLASS_HIDE);
        element.parentNode.insertBefore(image, element.nextSibling);
      }
    }, {
      key: "start",
      value: function start() {
        var _this2 = this;

        var image = this.image;
        image.onload = null;
        image.onerror = null;
        this.sizing = true; // Match all browsers that use WebKit as the layout engine in iOS devices,
        // such as Safari for iOS, Chrome for iOS, and in-app browsers.

        var isIOSWebKit = WINDOW.navigator && /(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(WINDOW.navigator.userAgent);

        var done = function done(naturalWidth, naturalHeight) {
          assign(_this2.imageData, {
            naturalWidth: naturalWidth,
            naturalHeight: naturalHeight,
            aspectRatio: naturalWidth / naturalHeight
          });
          _this2.initialImageData = assign({}, _this2.imageData);
          _this2.sizing = false;
          _this2.sized = true;

          _this2.build();
        }; // Most modern browsers (excepts iOS WebKit)


        if (image.naturalWidth && !isIOSWebKit) {
          done(image.naturalWidth, image.naturalHeight);
          return;
        }

        var sizingImage = document.createElement('img');
        var body = document.body || document.documentElement;
        this.sizingImage = sizingImage;

        sizingImage.onload = function () {
          done(sizingImage.width, sizingImage.height);

          if (!isIOSWebKit) {
            body.removeChild(sizingImage);
          }
        };

        sizingImage.src = image.src; // iOS WebKit will convert the image automatically
        // with its orientation once append it into DOM (#279)

        if (!isIOSWebKit) {
          sizingImage.style.cssText = 'left:0;' + 'max-height:none!important;' + 'max-width:none!important;' + 'min-height:0!important;' + 'min-width:0!important;' + 'opacity:0;' + 'position:absolute;' + 'top:0;' + 'z-index:-1;';
          body.appendChild(sizingImage);
        }
      }
    }, {
      key: "stop",
      value: function stop() {
        var image = this.image;
        image.onload = null;
        image.onerror = null;
        image.parentNode.removeChild(image);
        this.image = null;
      }
    }, {
      key: "build",
      value: function build() {
        if (!this.sized || this.ready) {
          return;
        }

        var element = this.element,
            options = this.options,
            image = this.image; // Create cropper elements

        var container = element.parentNode;
        var template = document.createElement('div');
        template.innerHTML = TEMPLATE;
        var cropper = template.querySelector(".".concat(NAMESPACE, "-container"));
        var canvas = cropper.querySelector(".".concat(NAMESPACE, "-canvas"));
        var dragBox = cropper.querySelector(".".concat(NAMESPACE, "-drag-box"));
        var cropBox = cropper.querySelector(".".concat(NAMESPACE, "-crop-box"));
        var face = cropBox.querySelector(".".concat(NAMESPACE, "-face"));
        this.container = container;
        this.cropper = cropper;
        this.canvas = canvas;
        this.dragBox = dragBox;
        this.cropBox = cropBox;
        this.viewBox = cropper.querySelector(".".concat(NAMESPACE, "-view-box"));
        this.face = face;
        canvas.appendChild(image); // Hide the original image

        addClass(element, CLASS_HIDDEN); // Inserts the cropper after to the current image

        container.insertBefore(cropper, element.nextSibling); // Show the image if is hidden

        if (!this.isImg) {
          removeClass(image, CLASS_HIDE);
        }

        this.initPreview();
        this.bind();
        options.initialAspectRatio = Math.max(0, options.initialAspectRatio) || NaN;
        options.aspectRatio = Math.max(0, options.aspectRatio) || NaN;
        options.viewMode = Math.max(0, Math.min(3, Math.round(options.viewMode))) || 0;
        addClass(cropBox, CLASS_HIDDEN);

        if (!options.guides) {
          addClass(cropBox.getElementsByClassName("".concat(NAMESPACE, "-dashed")), CLASS_HIDDEN);
        }

        if (!options.center) {
          addClass(cropBox.getElementsByClassName("".concat(NAMESPACE, "-center")), CLASS_HIDDEN);
        }

        if (options.background) {
          addClass(cropper, "".concat(NAMESPACE, "-bg"));
        }

        if (!options.highlight) {
          addClass(face, CLASS_INVISIBLE);
        }

        if (options.cropBoxMovable) {
          addClass(face, CLASS_MOVE);
          setData(face, DATA_ACTION, ACTION_ALL);
        }

        if (!options.cropBoxResizable) {
          addClass(cropBox.getElementsByClassName("".concat(NAMESPACE, "-line")), CLASS_HIDDEN);
          addClass(cropBox.getElementsByClassName("".concat(NAMESPACE, "-point")), CLASS_HIDDEN);
        }

        this.render();
        this.ready = true;
        this.setDragMode(options.dragMode);

        if (options.autoCrop) {
          this.crop();
        }

        this.setData(options.data);

        if (isFunction(options.ready)) {
          addListener(element, EVENT_READY, options.ready, {
            once: true
          });
        }

        dispatchEvent(element, EVENT_READY);
      }
    }, {
      key: "unbuild",
      value: function unbuild() {
        if (!this.ready) {
          return;
        }

        this.ready = false;
        this.unbind();
        this.resetPreview();
        this.cropper.parentNode.removeChild(this.cropper);
        removeClass(this.element, CLASS_HIDDEN);
      }
    }, {
      key: "uncreate",
      value: function uncreate() {
        if (this.ready) {
          this.unbuild();
          this.ready = false;
          this.cropped = false;
        } else if (this.sizing) {
          this.sizingImage.onload = null;
          this.sizing = false;
          this.sized = false;
        } else if (this.reloading) {
          this.xhr.onabort = null;
          this.xhr.abort();
        } else if (this.image) {
          this.stop();
        }
      }
      /**
       * Get the no conflict cropper class.
       * @returns {Cropper} The cropper class.
       */

    }], [{
      key: "noConflict",
      value: function noConflict() {
        window.Cropper = AnotherCropper;
        return Cropper;
      }
      /**
       * Change the default options.
       * @param {Object} options - The new default options.
       */

    }, {
      key: "setDefaults",
      value: function setDefaults(options) {
        assign(DEFAULTS, isPlainObject(options) && options);
      }
    }]);

    return Cropper;
  }();

  assign(Cropper.prototype, render, preview, events, handlers, change, methods);

  return Cropper;

})));


/***/ }),

/***/ 204:
/***/ ((module, exports, __webpack_require__) => {

"use strict";
var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*jshint node:true */
/* globals define */
/*
  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.

*/



/**
The following batches are equivalent:

var beautify_js = require('js-beautify');
var beautify_js = require('js-beautify').js;
var beautify_js = require('js-beautify').js_beautify;

var beautify_css = require('js-beautify').css;
var beautify_css = require('js-beautify').css_beautify;

var beautify_html = require('js-beautify').html;
var beautify_html = require('js-beautify').html_beautify;

All methods returned accept two arguments, the source string and an options object.
**/

function get_beautify(js_beautify, css_beautify, html_beautify) {
  // the default is js
  var beautify = function(src, config) {
    return js_beautify.js_beautify(src, config);
  };

  // short aliases
  beautify.js = js_beautify.js_beautify;
  beautify.css = css_beautify.css_beautify;
  beautify.html = html_beautify.html_beautify;

  // legacy aliases
  beautify.js_beautify = js_beautify.js_beautify;
  beautify.css_beautify = css_beautify.css_beautify;
  beautify.html_beautify = html_beautify.html_beautify;

  return beautify;
}

if (true) {
  // Add support for AMD ( https://github.com/amdjs/amdjs-api/wiki/AMD#defineamd-property- )
  !(__WEBPACK_AMD_DEFINE_ARRAY__ = [
    __webpack_require__(937),
    __webpack_require__(40),
    __webpack_require__(566)
  ], __WEBPACK_AMD_DEFINE_RESULT__ = (function(js_beautify, css_beautify, html_beautify) {
    return get_beautify(js_beautify, css_beautify, html_beautify);
  }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
} else {}

/***/ }),

/***/ 40:
/***/ ((module, exports) => {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* AUTO-GENERATED. DO NOT MODIFY. */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.


 CSS Beautifier
---------------

    Written by Harutyun Amirjanyan, (amirjanyan@gmail.com)

    Based on code initially developed by: Einar Lielmanis, <einar@beautifier.io>
        https://beautifier.io/

    Usage:
        css_beautify(source_text);
        css_beautify(source_text, options);

    The options are (default in brackets):
        indent_size (4)                         — indentation size,
        indent_char (space)                     — character to indent with,
        selector_separator_newline (true)       - separate selectors with newline or
                                                  not (e.g. "a,\nbr" or "a, br")
        end_with_newline (false)                - end with a newline
        newline_between_rules (true)            - add a new line after every css rule
        space_around_selector_separator (false) - ensure space around selector separators:
                                                  '>', '+', '~' (e.g. "a>b" -> "a > b")
    e.g

    css_beautify(css_source_text, {
      'indent_size': 1,
      'indent_char': '\t',
      'selector_separator': ' ',
      'end_with_newline': false,
      'newline_between_rules': true,
      'space_around_selector_separator': true
    });
*/

// http://www.w3.org/TR/CSS21/syndata.html#tokenization
// http://www.w3.org/TR/css3-syntax/

(function() {

/* GENERATED_BUILD_OUTPUT */
var legacy_beautify_css;
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ([
/* 0 */,
/* 1 */,
/* 2 */
/***/ (function(module) {

/*jshint node:true */
/*
  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function OutputLine(parent) {
  this.__parent = parent;
  this.__character_count = 0;
  // use indent_count as a marker for this.__lines that have preserved indentation
  this.__indent_count = -1;
  this.__alignment_count = 0;
  this.__wrap_point_index = 0;
  this.__wrap_point_character_count = 0;
  this.__wrap_point_indent_count = -1;
  this.__wrap_point_alignment_count = 0;

  this.__items = [];
}

OutputLine.prototype.clone_empty = function() {
  var line = new OutputLine(this.__parent);
  line.set_indent(this.__indent_count, this.__alignment_count);
  return line;
};

OutputLine.prototype.item = function(index) {
  if (index < 0) {
    return this.__items[this.__items.length + index];
  } else {
    return this.__items[index];
  }
};

OutputLine.prototype.has_match = function(pattern) {
  for (var lastCheckedOutput = this.__items.length - 1; lastCheckedOutput >= 0; lastCheckedOutput--) {
    if (this.__items[lastCheckedOutput].match(pattern)) {
      return true;
    }
  }
  return false;
};

OutputLine.prototype.set_indent = function(indent, alignment) {
  if (this.is_empty()) {
    this.__indent_count = indent || 0;
    this.__alignment_count = alignment || 0;
    this.__character_count = this.__parent.get_indent_size(this.__indent_count, this.__alignment_count);
  }
};

OutputLine.prototype._set_wrap_point = function() {
  if (this.__parent.wrap_line_length) {
    this.__wrap_point_index = this.__items.length;
    this.__wrap_point_character_count = this.__character_count;
    this.__wrap_point_indent_count = this.__parent.next_line.__indent_count;
    this.__wrap_point_alignment_count = this.__parent.next_line.__alignment_count;
  }
};

OutputLine.prototype._should_wrap = function() {
  return this.__wrap_point_index &&
    this.__character_count > this.__parent.wrap_line_length &&
    this.__wrap_point_character_count > this.__parent.next_line.__character_count;
};

OutputLine.prototype._allow_wrap = function() {
  if (this._should_wrap()) {
    this.__parent.add_new_line();
    var next = this.__parent.current_line;
    next.set_indent(this.__wrap_point_indent_count, this.__wrap_point_alignment_count);
    next.__items = this.__items.slice(this.__wrap_point_index);
    this.__items = this.__items.slice(0, this.__wrap_point_index);

    next.__character_count += this.__character_count - this.__wrap_point_character_count;
    this.__character_count = this.__wrap_point_character_count;

    if (next.__items[0] === " ") {
      next.__items.splice(0, 1);
      next.__character_count -= 1;
    }
    return true;
  }
  return false;
};

OutputLine.prototype.is_empty = function() {
  return this.__items.length === 0;
};

OutputLine.prototype.last = function() {
  if (!this.is_empty()) {
    return this.__items[this.__items.length - 1];
  } else {
    return null;
  }
};

OutputLine.prototype.push = function(item) {
  this.__items.push(item);
  var last_newline_index = item.lastIndexOf('\n');
  if (last_newline_index !== -1) {
    this.__character_count = item.length - last_newline_index;
  } else {
    this.__character_count += item.length;
  }
};

OutputLine.prototype.pop = function() {
  var item = null;
  if (!this.is_empty()) {
    item = this.__items.pop();
    this.__character_count -= item.length;
  }
  return item;
};


OutputLine.prototype._remove_indent = function() {
  if (this.__indent_count > 0) {
    this.__indent_count -= 1;
    this.__character_count -= this.__parent.indent_size;
  }
};

OutputLine.prototype._remove_wrap_indent = function() {
  if (this.__wrap_point_indent_count > 0) {
    this.__wrap_point_indent_count -= 1;
  }
};
OutputLine.prototype.trim = function() {
  while (this.last() === ' ') {
    this.__items.pop();
    this.__character_count -= 1;
  }
};

OutputLine.prototype.toString = function() {
  var result = '';
  if (this.is_empty()) {
    if (this.__parent.indent_empty_lines) {
      result = this.__parent.get_indent_string(this.__indent_count);
    }
  } else {
    result = this.__parent.get_indent_string(this.__indent_count, this.__alignment_count);
    result += this.__items.join('');
  }
  return result;
};

function IndentStringCache(options, baseIndentString) {
  this.__cache = [''];
  this.__indent_size = options.indent_size;
  this.__indent_string = options.indent_char;
  if (!options.indent_with_tabs) {
    this.__indent_string = new Array(options.indent_size + 1).join(options.indent_char);
  }

  // Set to null to continue support for auto detection of base indent
  baseIndentString = baseIndentString || '';
  if (options.indent_level > 0) {
    baseIndentString = new Array(options.indent_level + 1).join(this.__indent_string);
  }

  this.__base_string = baseIndentString;
  this.__base_string_length = baseIndentString.length;
}

IndentStringCache.prototype.get_indent_size = function(indent, column) {
  var result = this.__base_string_length;
  column = column || 0;
  if (indent < 0) {
    result = 0;
  }
  result += indent * this.__indent_size;
  result += column;
  return result;
};

IndentStringCache.prototype.get_indent_string = function(indent_level, column) {
  var result = this.__base_string;
  column = column || 0;
  if (indent_level < 0) {
    indent_level = 0;
    result = '';
  }
  column += indent_level * this.__indent_size;
  this.__ensure_cache(column);
  result += this.__cache[column];
  return result;
};

IndentStringCache.prototype.__ensure_cache = function(column) {
  while (column >= this.__cache.length) {
    this.__add_column();
  }
};

IndentStringCache.prototype.__add_column = function() {
  var column = this.__cache.length;
  var indent = 0;
  var result = '';
  if (this.__indent_size && column >= this.__indent_size) {
    indent = Math.floor(column / this.__indent_size);
    column -= indent * this.__indent_size;
    result = new Array(indent + 1).join(this.__indent_string);
  }
  if (column) {
    result += new Array(column + 1).join(' ');
  }

  this.__cache.push(result);
};

function Output(options, baseIndentString) {
  this.__indent_cache = new IndentStringCache(options, baseIndentString);
  this.raw = false;
  this._end_with_newline = options.end_with_newline;
  this.indent_size = options.indent_size;
  this.wrap_line_length = options.wrap_line_length;
  this.indent_empty_lines = options.indent_empty_lines;
  this.__lines = [];
  this.previous_line = null;
  this.current_line = null;
  this.next_line = new OutputLine(this);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = false;
  // initialize
  this.__add_outputline();
}

Output.prototype.__add_outputline = function() {
  this.previous_line = this.current_line;
  this.current_line = this.next_line.clone_empty();
  this.__lines.push(this.current_line);
};

Output.prototype.get_line_number = function() {
  return this.__lines.length;
};

Output.prototype.get_indent_string = function(indent, column) {
  return this.__indent_cache.get_indent_string(indent, column);
};

Output.prototype.get_indent_size = function(indent, column) {
  return this.__indent_cache.get_indent_size(indent, column);
};

Output.prototype.is_empty = function() {
  return !this.previous_line && this.current_line.is_empty();
};

Output.prototype.add_new_line = function(force_newline) {
  // never newline at the start of file
  // otherwise, newline only if we didn't just add one or we're forced
  if (this.is_empty() ||
    (!force_newline && this.just_added_newline())) {
    return false;
  }

  // if raw output is enabled, don't print additional newlines,
  // but still return True as though you had
  if (!this.raw) {
    this.__add_outputline();
  }
  return true;
};

Output.prototype.get_code = function(eol) {
  this.trim(true);

  // handle some edge cases where the last tokens
  // has text that ends with newline(s)
  var last_item = this.current_line.pop();
  if (last_item) {
    if (last_item[last_item.length - 1] === '\n') {
      last_item = last_item.replace(/\n+$/g, '');
    }
    this.current_line.push(last_item);
  }

  if (this._end_with_newline) {
    this.__add_outputline();
  }

  var sweet_code = this.__lines.join('\n');

  if (eol !== '\n') {
    sweet_code = sweet_code.replace(/[\n]/g, eol);
  }
  return sweet_code;
};

Output.prototype.set_wrap_point = function() {
  this.current_line._set_wrap_point();
};

Output.prototype.set_indent = function(indent, alignment) {
  indent = indent || 0;
  alignment = alignment || 0;

  // Next line stores alignment values
  this.next_line.set_indent(indent, alignment);

  // Never indent your first output indent at the start of the file
  if (this.__lines.length > 1) {
    this.current_line.set_indent(indent, alignment);
    return true;
  }

  this.current_line.set_indent();
  return false;
};

Output.prototype.add_raw_token = function(token) {
  for (var x = 0; x < token.newlines; x++) {
    this.__add_outputline();
  }
  this.current_line.set_indent(-1);
  this.current_line.push(token.whitespace_before);
  this.current_line.push(token.text);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = false;
};

Output.prototype.add_token = function(printable_token) {
  this.__add_space_before_token();
  this.current_line.push(printable_token);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = this.current_line._allow_wrap();
};

Output.prototype.__add_space_before_token = function() {
  if (this.space_before_token && !this.just_added_newline()) {
    if (!this.non_breaking_space) {
      this.set_wrap_point();
    }
    this.current_line.push(' ');
  }
};

Output.prototype.remove_indent = function(index) {
  var output_length = this.__lines.length;
  while (index < output_length) {
    this.__lines[index]._remove_indent();
    index++;
  }
  this.current_line._remove_wrap_indent();
};

Output.prototype.trim = function(eat_newlines) {
  eat_newlines = (eat_newlines === undefined) ? false : eat_newlines;

  this.current_line.trim();

  while (eat_newlines && this.__lines.length > 1 &&
    this.current_line.is_empty()) {
    this.__lines.pop();
    this.current_line = this.__lines[this.__lines.length - 1];
    this.current_line.trim();
  }

  this.previous_line = this.__lines.length > 1 ?
    this.__lines[this.__lines.length - 2] : null;
};

Output.prototype.just_added_newline = function() {
  return this.current_line.is_empty();
};

Output.prototype.just_added_blankline = function() {
  return this.is_empty() ||
    (this.current_line.is_empty() && this.previous_line.is_empty());
};

Output.prototype.ensure_empty_line_above = function(starts_with, ends_with) {
  var index = this.__lines.length - 2;
  while (index >= 0) {
    var potentialEmptyLine = this.__lines[index];
    if (potentialEmptyLine.is_empty()) {
      break;
    } else if (potentialEmptyLine.item(0).indexOf(starts_with) !== 0 &&
      potentialEmptyLine.item(-1) !== ends_with) {
      this.__lines.splice(index + 1, 0, new OutputLine(this));
      this.previous_line = this.__lines[this.__lines.length - 2];
      break;
    }
    index--;
  }
};

module.exports.Output = Output;


/***/ }),
/* 3 */,
/* 4 */,
/* 5 */,
/* 6 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Options(options, merge_child_field) {
  this.raw_options = _mergeOpts(options, merge_child_field);

  // Support passing the source text back with no change
  this.disabled = this._get_boolean('disabled');

  this.eol = this._get_characters('eol', 'auto');
  this.end_with_newline = this._get_boolean('end_with_newline');
  this.indent_size = this._get_number('indent_size', 4);
  this.indent_char = this._get_characters('indent_char', ' ');
  this.indent_level = this._get_number('indent_level');

  this.preserve_newlines = this._get_boolean('preserve_newlines', true);
  this.max_preserve_newlines = this._get_number('max_preserve_newlines', 32786);
  if (!this.preserve_newlines) {
    this.max_preserve_newlines = 0;
  }

  this.indent_with_tabs = this._get_boolean('indent_with_tabs', this.indent_char === '\t');
  if (this.indent_with_tabs) {
    this.indent_char = '\t';

    // indent_size behavior changed after 1.8.6
    // It used to be that indent_size would be
    // set to 1 for indent_with_tabs. That is no longer needed and
    // actually doesn't make sense - why not use spaces? Further,
    // that might produce unexpected behavior - tabs being used
    // for single-column alignment. So, when indent_with_tabs is true
    // and indent_size is 1, reset indent_size to 4.
    if (this.indent_size === 1) {
      this.indent_size = 4;
    }
  }

  // Backwards compat with 1.3.x
  this.wrap_line_length = this._get_number('wrap_line_length', this._get_number('max_char'));

  this.indent_empty_lines = this._get_boolean('indent_empty_lines');

  // valid templating languages ['django', 'erb', 'handlebars', 'php', 'smarty']
  // For now, 'auto' = all off for javascript, all on for html (and inline javascript).
  // other values ignored
  this.templating = this._get_selection_list('templating', ['auto', 'none', 'django', 'erb', 'handlebars', 'php', 'smarty'], ['auto']);
}

Options.prototype._get_array = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = default_value || [];
  if (typeof option_value === 'object') {
    if (option_value !== null && typeof option_value.concat === 'function') {
      result = option_value.concat();
    }
  } else if (typeof option_value === 'string') {
    result = option_value.split(/[^a-zA-Z0-9_\/\-]+/);
  }
  return result;
};

Options.prototype._get_boolean = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = option_value === undefined ? !!default_value : !!option_value;
  return result;
};

Options.prototype._get_characters = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = default_value || '';
  if (typeof option_value === 'string') {
    result = option_value.replace(/\\r/, '\r').replace(/\\n/, '\n').replace(/\\t/, '\t');
  }
  return result;
};

Options.prototype._get_number = function(name, default_value) {
  var option_value = this.raw_options[name];
  default_value = parseInt(default_value, 10);
  if (isNaN(default_value)) {
    default_value = 0;
  }
  var result = parseInt(option_value, 10);
  if (isNaN(result)) {
    result = default_value;
  }
  return result;
};

Options.prototype._get_selection = function(name, selection_list, default_value) {
  var result = this._get_selection_list(name, selection_list, default_value);
  if (result.length !== 1) {
    throw new Error(
      "Invalid Option Value: The option '" + name + "' can only be one of the following values:\n" +
      selection_list + "\nYou passed in: '" + this.raw_options[name] + "'");
  }

  return result[0];
};


Options.prototype._get_selection_list = function(name, selection_list, default_value) {
  if (!selection_list || selection_list.length === 0) {
    throw new Error("Selection list cannot be empty.");
  }

  default_value = default_value || [selection_list[0]];
  if (!this._is_valid_selection(default_value, selection_list)) {
    throw new Error("Invalid Default Value!");
  }

  var result = this._get_array(name, default_value);
  if (!this._is_valid_selection(result, selection_list)) {
    throw new Error(
      "Invalid Option Value: The option '" + name + "' can contain only the following values:\n" +
      selection_list + "\nYou passed in: '" + this.raw_options[name] + "'");
  }

  return result;
};

Options.prototype._is_valid_selection = function(result, selection_list) {
  return result.length && selection_list.length &&
    !result.some(function(item) { return selection_list.indexOf(item) === -1; });
};


// merges child options up with the parent options object
// Example: obj = {a: 1, b: {a: 2}}
//          mergeOpts(obj, 'b')
//
//          Returns: {a: 2}
function _mergeOpts(allOptions, childFieldName) {
  var finalOpts = {};
  allOptions = _normalizeOpts(allOptions);
  var name;

  for (name in allOptions) {
    if (name !== childFieldName) {
      finalOpts[name] = allOptions[name];
    }
  }

  //merge in the per type settings for the childFieldName
  if (childFieldName && allOptions[childFieldName]) {
    for (name in allOptions[childFieldName]) {
      finalOpts[name] = allOptions[childFieldName][name];
    }
  }
  return finalOpts;
}

function _normalizeOpts(options) {
  var convertedOpts = {};
  var key;

  for (key in options) {
    var newKey = key.replace(/-/g, "_");
    convertedOpts[newKey] = options[key];
  }
  return convertedOpts;
}

module.exports.Options = Options;
module.exports.normalizeOpts = _normalizeOpts;
module.exports.mergeOpts = _mergeOpts;


/***/ }),
/* 7 */,
/* 8 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var regexp_has_sticky = RegExp.prototype.hasOwnProperty('sticky');

function InputScanner(input_string) {
  this.__input = input_string || '';
  this.__input_length = this.__input.length;
  this.__position = 0;
}

InputScanner.prototype.restart = function() {
  this.__position = 0;
};

InputScanner.prototype.back = function() {
  if (this.__position > 0) {
    this.__position -= 1;
  }
};

InputScanner.prototype.hasNext = function() {
  return this.__position < this.__input_length;
};

InputScanner.prototype.next = function() {
  var val = null;
  if (this.hasNext()) {
    val = this.__input.charAt(this.__position);
    this.__position += 1;
  }
  return val;
};

InputScanner.prototype.peek = function(index) {
  var val = null;
  index = index || 0;
  index += this.__position;
  if (index >= 0 && index < this.__input_length) {
    val = this.__input.charAt(index);
  }
  return val;
};

// This is a JavaScript only helper function (not in python)
// Javascript doesn't have a match method
// and not all implementation support "sticky" flag.
// If they do not support sticky then both this.match() and this.test() method
// must get the match and check the index of the match.
// If sticky is supported and set, this method will use it.
// Otherwise it will check that global is set, and fall back to the slower method.
InputScanner.prototype.__match = function(pattern, index) {
  pattern.lastIndex = index;
  var pattern_match = pattern.exec(this.__input);

  if (pattern_match && !(regexp_has_sticky && pattern.sticky)) {
    if (pattern_match.index !== index) {
      pattern_match = null;
    }
  }

  return pattern_match;
};

InputScanner.prototype.test = function(pattern, index) {
  index = index || 0;
  index += this.__position;

  if (index >= 0 && index < this.__input_length) {
    return !!this.__match(pattern, index);
  } else {
    return false;
  }
};

InputScanner.prototype.testChar = function(pattern, index) {
  // test one character regex match
  var val = this.peek(index);
  pattern.lastIndex = 0;
  return val !== null && pattern.test(val);
};

InputScanner.prototype.match = function(pattern) {
  var pattern_match = this.__match(pattern, this.__position);
  if (pattern_match) {
    this.__position += pattern_match[0].length;
  } else {
    pattern_match = null;
  }
  return pattern_match;
};

InputScanner.prototype.read = function(starting_pattern, until_pattern, until_after) {
  var val = '';
  var match;
  if (starting_pattern) {
    match = this.match(starting_pattern);
    if (match) {
      val += match[0];
    }
  }
  if (until_pattern && (match || !starting_pattern)) {
    val += this.readUntil(until_pattern, until_after);
  }
  return val;
};

InputScanner.prototype.readUntil = function(pattern, until_after) {
  var val = '';
  var match_index = this.__position;
  pattern.lastIndex = this.__position;
  var pattern_match = pattern.exec(this.__input);
  if (pattern_match) {
    match_index = pattern_match.index;
    if (until_after) {
      match_index += pattern_match[0].length;
    }
  } else {
    match_index = this.__input_length;
  }

  val = this.__input.substring(this.__position, match_index);
  this.__position = match_index;
  return val;
};

InputScanner.prototype.readUntilAfter = function(pattern) {
  return this.readUntil(pattern, true);
};

InputScanner.prototype.get_regexp = function(pattern, match_from) {
  var result = null;
  var flags = 'g';
  if (match_from && regexp_has_sticky) {
    flags = 'y';
  }
  // strings are converted to regexp
  if (typeof pattern === "string" && pattern !== '') {
    // result = new RegExp(pattern.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), flags);
    result = new RegExp(pattern, flags);
  } else if (pattern) {
    result = new RegExp(pattern.source, flags);
  }
  return result;
};

InputScanner.prototype.get_literal_regexp = function(literal_string) {
  return RegExp(literal_string.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'));
};

/* css beautifier legacy helpers */
InputScanner.prototype.peekUntilAfter = function(pattern) {
  var start = this.__position;
  var val = this.readUntilAfter(pattern);
  this.__position = start;
  return val;
};

InputScanner.prototype.lookBack = function(testVal) {
  var start = this.__position - 1;
  return start >= testVal.length && this.__input.substring(start - testVal.length, start)
    .toLowerCase() === testVal;
};

module.exports.InputScanner = InputScanner;


/***/ }),
/* 9 */,
/* 10 */,
/* 11 */,
/* 12 */,
/* 13 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Directives(start_block_pattern, end_block_pattern) {
  start_block_pattern = typeof start_block_pattern === 'string' ? start_block_pattern : start_block_pattern.source;
  end_block_pattern = typeof end_block_pattern === 'string' ? end_block_pattern : end_block_pattern.source;
  this.__directives_block_pattern = new RegExp(start_block_pattern + / beautify( \w+[:]\w+)+ /.source + end_block_pattern, 'g');
  this.__directive_pattern = / (\w+)[:](\w+)/g;

  this.__directives_end_ignore_pattern = new RegExp(start_block_pattern + /\sbeautify\signore:end\s/.source + end_block_pattern, 'g');
}

Directives.prototype.get_directives = function(text) {
  if (!text.match(this.__directives_block_pattern)) {
    return null;
  }

  var directives = {};
  this.__directive_pattern.lastIndex = 0;
  var directive_match = this.__directive_pattern.exec(text);

  while (directive_match) {
    directives[directive_match[1]] = directive_match[2];
    directive_match = this.__directive_pattern.exec(text);
  }

  return directives;
};

Directives.prototype.readIgnored = function(input) {
  return input.readUntilAfter(this.__directives_end_ignore_pattern);
};


module.exports.Directives = Directives;


/***/ }),
/* 14 */,
/* 15 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_30126__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Beautifier = __nested_webpack_require_30126__(16).Beautifier,
  Options = __nested_webpack_require_30126__(17).Options;

function css_beautify(source_text, options) {
  var beautifier = new Beautifier(source_text, options);
  return beautifier.beautify();
}

module.exports = css_beautify;
module.exports.defaultOptions = function() {
  return new Options();
};


/***/ }),
/* 16 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_31750__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Options = __nested_webpack_require_31750__(17).Options;
var Output = __nested_webpack_require_31750__(2).Output;
var InputScanner = __nested_webpack_require_31750__(8).InputScanner;
var Directives = __nested_webpack_require_31750__(13).Directives;

var directives_core = new Directives(/\/\*/, /\*\//);

var lineBreak = /\r\n|[\r\n]/;
var allLineBreaks = /\r\n|[\r\n]/g;

// tokenizer
var whitespaceChar = /\s/;
var whitespacePattern = /(?:\s|\n)+/g;
var block_comment_pattern = /\/\*(?:[\s\S]*?)((?:\*\/)|$)/g;
var comment_pattern = /\/\/(?:[^\n\r\u2028\u2029]*)/g;

function Beautifier(source_text, options) {
  this._source_text = source_text || '';
  // Allow the setting of language/file-type specific options
  // with inheritance of overall settings
  this._options = new Options(options);
  this._ch = null;
  this._input = null;

  // https://developer.mozilla.org/en-US/docs/Web/CSS/At-rule
  this.NESTED_AT_RULE = {
    "@page": true,
    "@font-face": true,
    "@keyframes": true,
    // also in CONDITIONAL_GROUP_RULE below
    "@media": true,
    "@supports": true,
    "@document": true
  };
  this.CONDITIONAL_GROUP_RULE = {
    "@media": true,
    "@supports": true,
    "@document": true
  };

}

Beautifier.prototype.eatString = function(endChars) {
  var result = '';
  this._ch = this._input.next();
  while (this._ch) {
    result += this._ch;
    if (this._ch === "\\") {
      result += this._input.next();
    } else if (endChars.indexOf(this._ch) !== -1 || this._ch === "\n") {
      break;
    }
    this._ch = this._input.next();
  }
  return result;
};

// Skips any white space in the source text from the current position.
// When allowAtLeastOneNewLine is true, will output new lines for each
// newline character found; if the user has preserve_newlines off, only
// the first newline will be output
Beautifier.prototype.eatWhitespace = function(allowAtLeastOneNewLine) {
  var result = whitespaceChar.test(this._input.peek());
  var newline_count = 0;
  while (whitespaceChar.test(this._input.peek())) {
    this._ch = this._input.next();
    if (allowAtLeastOneNewLine && this._ch === '\n') {
      if (newline_count === 0 || newline_count < this._options.max_preserve_newlines) {
        newline_count++;
        this._output.add_new_line(true);
      }
    }
  }
  return result;
};

// Nested pseudo-class if we are insideRule
// and the next special character found opens
// a new block
Beautifier.prototype.foundNestedPseudoClass = function() {
  var openParen = 0;
  var i = 1;
  var ch = this._input.peek(i);
  while (ch) {
    if (ch === "{") {
      return true;
    } else if (ch === '(') {
      // pseudoclasses can contain ()
      openParen += 1;
    } else if (ch === ')') {
      if (openParen === 0) {
        return false;
      }
      openParen -= 1;
    } else if (ch === ";" || ch === "}") {
      return false;
    }
    i++;
    ch = this._input.peek(i);
  }
  return false;
};

Beautifier.prototype.print_string = function(output_string) {
  this._output.set_indent(this._indentLevel);
  this._output.non_breaking_space = true;
  this._output.add_token(output_string);
};

Beautifier.prototype.preserveSingleSpace = function(isAfterSpace) {
  if (isAfterSpace) {
    this._output.space_before_token = true;
  }
};

Beautifier.prototype.indent = function() {
  this._indentLevel++;
};

Beautifier.prototype.outdent = function() {
  if (this._indentLevel > 0) {
    this._indentLevel--;
  }
};

/*_____________________--------------------_____________________*/

Beautifier.prototype.beautify = function() {
  if (this._options.disabled) {
    return this._source_text;
  }

  var source_text = this._source_text;
  var eol = this._options.eol;
  if (eol === 'auto') {
    eol = '\n';
    if (source_text && lineBreak.test(source_text || '')) {
      eol = source_text.match(lineBreak)[0];
    }
  }


  // HACK: newline parsing inconsistent. This brute force normalizes the this._input.
  source_text = source_text.replace(allLineBreaks, '\n');

  // reset
  var baseIndentString = source_text.match(/^[\t ]*/)[0];

  this._output = new Output(this._options, baseIndentString);
  this._input = new InputScanner(source_text);
  this._indentLevel = 0;
  this._nestedLevel = 0;

  this._ch = null;
  var parenLevel = 0;

  var insideRule = false;
  // This is the value side of a property value pair (blue in the following ex)
  // label { content: blue }
  var insidePropertyValue = false;
  var enteringConditionalGroup = false;
  var insideAtExtend = false;
  var insideAtImport = false;
  var topCharacter = this._ch;
  var whitespace;
  var isAfterSpace;
  var previous_ch;

  while (true) {
    whitespace = this._input.read(whitespacePattern);
    isAfterSpace = whitespace !== '';
    previous_ch = topCharacter;
    this._ch = this._input.next();
    if (this._ch === '\\' && this._input.hasNext()) {
      this._ch += this._input.next();
    }
    topCharacter = this._ch;

    if (!this._ch) {
      break;
    } else if (this._ch === '/' && this._input.peek() === '*') {
      // /* css comment */
      // Always start block comments on a new line.
      // This handles scenarios where a block comment immediately
      // follows a property definition on the same line or where
      // minified code is being beautified.
      this._output.add_new_line();
      this._input.back();

      var comment = this._input.read(block_comment_pattern);

      // Handle ignore directive
      var directives = directives_core.get_directives(comment);
      if (directives && directives.ignore === 'start') {
        comment += directives_core.readIgnored(this._input);
      }

      this.print_string(comment);

      // Ensures any new lines following the comment are preserved
      this.eatWhitespace(true);

      // Block comments are followed by a new line so they don't
      // share a line with other properties
      this._output.add_new_line();
    } else if (this._ch === '/' && this._input.peek() === '/') {
      // // single line comment
      // Preserves the space before a comment
      // on the same line as a rule
      this._output.space_before_token = true;
      this._input.back();
      this.print_string(this._input.read(comment_pattern));

      // Ensures any new lines following the comment are preserved
      this.eatWhitespace(true);
    } else if (this._ch === '@') {
      this.preserveSingleSpace(isAfterSpace);

      // deal with less propery mixins @{...}
      if (this._input.peek() === '{') {
        this.print_string(this._ch + this.eatString('}'));
      } else {
        this.print_string(this._ch);

        // strip trailing space, if present, for hash property checks
        var variableOrRule = this._input.peekUntilAfter(/[: ,;{}()[\]\/='"]/g);

        if (variableOrRule.match(/[ :]$/)) {
          // we have a variable or pseudo-class, add it and insert one space before continuing
          variableOrRule = this.eatString(": ").replace(/\s$/, '');
          this.print_string(variableOrRule);
          this._output.space_before_token = true;
        }

        variableOrRule = variableOrRule.replace(/\s$/, '');

        if (variableOrRule === 'extend') {
          insideAtExtend = true;
        } else if (variableOrRule === 'import') {
          insideAtImport = true;
        }

        // might be a nesting at-rule
        if (variableOrRule in this.NESTED_AT_RULE) {
          this._nestedLevel += 1;
          if (variableOrRule in this.CONDITIONAL_GROUP_RULE) {
            enteringConditionalGroup = true;
          }
          // might be less variable
        } else if (!insideRule && parenLevel === 0 && variableOrRule.indexOf(':') !== -1) {
          insidePropertyValue = true;
          this.indent();
        }
      }
    } else if (this._ch === '#' && this._input.peek() === '{') {
      this.preserveSingleSpace(isAfterSpace);
      this.print_string(this._ch + this.eatString('}'));
    } else if (this._ch === '{') {
      if (insidePropertyValue) {
        insidePropertyValue = false;
        this.outdent();
      }

      // when entering conditional groups, only rulesets are allowed
      if (enteringConditionalGroup) {
        enteringConditionalGroup = false;
        insideRule = (this._indentLevel >= this._nestedLevel);
      } else {
        // otherwise, declarations are also allowed
        insideRule = (this._indentLevel >= this._nestedLevel - 1);
      }
      if (this._options.newline_between_rules && insideRule) {
        if (this._output.previous_line && this._output.previous_line.item(-1) !== '{') {
          this._output.ensure_empty_line_above('/', ',');
        }
      }

      this._output.space_before_token = true;

      // The difference in print_string and indent order is necessary to indent the '{' correctly
      if (this._options.brace_style === 'expand') {
        this._output.add_new_line();
        this.print_string(this._ch);
        this.indent();
        this._output.set_indent(this._indentLevel);
      } else {
        this.indent();
        this.print_string(this._ch);
      }

      this.eatWhitespace(true);
      this._output.add_new_line();
    } else if (this._ch === '}') {
      this.outdent();
      this._output.add_new_line();
      if (previous_ch === '{') {
        this._output.trim(true);
      }
      insideAtImport = false;
      insideAtExtend = false;
      if (insidePropertyValue) {
        this.outdent();
        insidePropertyValue = false;
      }
      this.print_string(this._ch);
      insideRule = false;
      if (this._nestedLevel) {
        this._nestedLevel--;
      }

      this.eatWhitespace(true);
      this._output.add_new_line();

      if (this._options.newline_between_rules && !this._output.just_added_blankline()) {
        if (this._input.peek() !== '}') {
          this._output.add_new_line(true);
        }
      }
    } else if (this._ch === ":") {
      if ((insideRule || enteringConditionalGroup) && !(this._input.lookBack("&") || this.foundNestedPseudoClass()) && !this._input.lookBack("(") && !insideAtExtend && parenLevel === 0) {
        // 'property: value' delimiter
        // which could be in a conditional group query
        this.print_string(':');
        if (!insidePropertyValue) {
          insidePropertyValue = true;
          this._output.space_before_token = true;
          this.eatWhitespace(true);
          this.indent();
        }
      } else {
        // sass/less parent reference don't use a space
        // sass nested pseudo-class don't use a space

        // preserve space before pseudoclasses/pseudoelements, as it means "in any child"
        if (this._input.lookBack(" ")) {
          this._output.space_before_token = true;
        }
        if (this._input.peek() === ":") {
          // pseudo-element
          this._ch = this._input.next();
          this.print_string("::");
        } else {
          // pseudo-class
          this.print_string(':');
        }
      }
    } else if (this._ch === '"' || this._ch === '\'') {
      this.preserveSingleSpace(isAfterSpace);
      this.print_string(this._ch + this.eatString(this._ch));
      this.eatWhitespace(true);
    } else if (this._ch === ';') {
      if (parenLevel === 0) {
        if (insidePropertyValue) {
          this.outdent();
          insidePropertyValue = false;
        }
        insideAtExtend = false;
        insideAtImport = false;
        this.print_string(this._ch);
        this.eatWhitespace(true);

        // This maintains single line comments on the same
        // line. Block comments are also affected, but
        // a new line is always output before one inside
        // that section
        if (this._input.peek() !== '/') {
          this._output.add_new_line();
        }
      } else {
        this.print_string(this._ch);
        this.eatWhitespace(true);
        this._output.space_before_token = true;
      }
    } else if (this._ch === '(') { // may be a url
      if (this._input.lookBack("url")) {
        this.print_string(this._ch);
        this.eatWhitespace();
        parenLevel++;
        this.indent();
        this._ch = this._input.next();
        if (this._ch === ')' || this._ch === '"' || this._ch === '\'') {
          this._input.back();
        } else if (this._ch) {
          this.print_string(this._ch + this.eatString(')'));
          if (parenLevel) {
            parenLevel--;
            this.outdent();
          }
        }
      } else {
        this.preserveSingleSpace(isAfterSpace);
        this.print_string(this._ch);
        this.eatWhitespace();
        parenLevel++;
        this.indent();
      }
    } else if (this._ch === ')') {
      if (parenLevel) {
        parenLevel--;
        this.outdent();
      }
      this.print_string(this._ch);
    } else if (this._ch === ',') {
      this.print_string(this._ch);
      this.eatWhitespace(true);
      if (this._options.selector_separator_newline && !insidePropertyValue && parenLevel === 0 && !insideAtImport && !insideAtExtend) {
        this._output.add_new_line();
      } else {
        this._output.space_before_token = true;
      }
    } else if ((this._ch === '>' || this._ch === '+' || this._ch === '~') && !insidePropertyValue && parenLevel === 0) {
      //handle combinator spacing
      if (this._options.space_around_combinator) {
        this._output.space_before_token = true;
        this.print_string(this._ch);
        this._output.space_before_token = true;
      } else {
        this.print_string(this._ch);
        this.eatWhitespace();
        // squash extra whitespace
        if (this._ch && whitespaceChar.test(this._ch)) {
          this._ch = '';
        }
      }
    } else if (this._ch === ']') {
      this.print_string(this._ch);
    } else if (this._ch === '[') {
      this.preserveSingleSpace(isAfterSpace);
      this.print_string(this._ch);
    } else if (this._ch === '=') { // no whitespace before or after
      this.eatWhitespace();
      this.print_string('=');
      if (whitespaceChar.test(this._ch)) {
        this._ch = '';
      }
    } else if (this._ch === '!' && !this._input.lookBack("\\")) { // !important
      this.print_string(' ');
      this.print_string(this._ch);
    } else {
      this.preserveSingleSpace(isAfterSpace);
      this.print_string(this._ch);
    }
  }

  var sweetCode = this._output.get_code(eol);

  return sweetCode;
};

module.exports.Beautifier = Beautifier;


/***/ }),
/* 17 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_47411__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var BaseOptions = __nested_webpack_require_47411__(6).Options;

function Options(options) {
  BaseOptions.call(this, options, 'css');

  this.selector_separator_newline = this._get_boolean('selector_separator_newline', true);
  this.newline_between_rules = this._get_boolean('newline_between_rules', true);
  var space_around_selector_separator = this._get_boolean('space_around_selector_separator');
  this.space_around_combinator = this._get_boolean('space_around_combinator') || space_around_selector_separator;

  var brace_style_split = this._get_selection_list('brace_style', ['collapse', 'expand', 'end-expand', 'none', 'preserve-inline']);
  this.brace_style = 'collapse';
  for (var bs = 0; bs < brace_style_split.length; bs++) {
    if (brace_style_split[bs] !== 'expand') {
      // default to collapse, as only collapse|expand is implemented for now
      this.brace_style = 'collapse';
    } else {
      this.brace_style = brace_style_split[bs];
    }
  }
}
Options.prototype = new BaseOptions();



module.exports.Options = Options;


/***/ })
/******/ 	]);
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __nested_webpack_require_49889__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __nested_webpack_require_49889__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __nested_webpack_exports__ = __nested_webpack_require_49889__(15);
/******/ 	legacy_beautify_css = __nested_webpack_exports__;
/******/ 	
/******/ })()
;
var css_beautify = legacy_beautify_css;
/* Footer */
if (true) {
    // Add support for AMD ( https://github.com/amdjs/amdjs-api/wiki/AMD#defineamd-property- )
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (function() {
        return {
            css_beautify: css_beautify
        };
    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
} else {}

}());


/***/ }),

/***/ 566:
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* AUTO-GENERATED. DO NOT MODIFY. */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.


 Style HTML
---------------

  Written by Nochum Sossonko, (nsossonko@hotmail.com)

  Based on code initially developed by: Einar Lielmanis, <einar@beautifier.io>
    https://beautifier.io/

  Usage:
    style_html(html_source);

    style_html(html_source, options);

  The options are:
    indent_inner_html (default false)  — indent <head> and <body> sections,
    indent_size (default 4)          — indentation size,
    indent_char (default space)      — character to indent with,
    wrap_line_length (default 250)            -  maximum amount of characters per line (0 = disable)
    brace_style (default "collapse") - "collapse" | "expand" | "end-expand" | "none"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line, or attempt to keep them where they are.
    inline (defaults to inline tags) - list of tags to be considered inline tags
    unformatted (defaults to inline tags) - list of tags, that shouldn't be reformatted
    content_unformatted (defaults to ["pre", "textarea"] tags) - list of tags, whose content shouldn't be reformatted
    indent_scripts (default normal)  - "keep"|"separate"|"normal"
    preserve_newlines (default true) - whether existing line breaks before elements should be preserved
                                        Only works before elements, not inside tags or for text.
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk
    indent_handlebars (default false) - format and indent {{#foo}} and {{/foo}}
    end_with_newline (false)          - end with a newline
    extra_liners (default [head,body,/html]) -List of tags that should have an extra newline before them.

    e.g.

    style_html(html_source, {
      'indent_inner_html': false,
      'indent_size': 2,
      'indent_char': ' ',
      'wrap_line_length': 78,
      'brace_style': 'expand',
      'preserve_newlines': true,
      'max_preserve_newlines': 5,
      'indent_handlebars': false,
      'extra_liners': ['/html']
    });
*/

(function() {

/* GENERATED_BUILD_OUTPUT */
var legacy_beautify_html;
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ([
/* 0 */,
/* 1 */,
/* 2 */
/***/ (function(module) {

/*jshint node:true */
/*
  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function OutputLine(parent) {
  this.__parent = parent;
  this.__character_count = 0;
  // use indent_count as a marker for this.__lines that have preserved indentation
  this.__indent_count = -1;
  this.__alignment_count = 0;
  this.__wrap_point_index = 0;
  this.__wrap_point_character_count = 0;
  this.__wrap_point_indent_count = -1;
  this.__wrap_point_alignment_count = 0;

  this.__items = [];
}

OutputLine.prototype.clone_empty = function() {
  var line = new OutputLine(this.__parent);
  line.set_indent(this.__indent_count, this.__alignment_count);
  return line;
};

OutputLine.prototype.item = function(index) {
  if (index < 0) {
    return this.__items[this.__items.length + index];
  } else {
    return this.__items[index];
  }
};

OutputLine.prototype.has_match = function(pattern) {
  for (var lastCheckedOutput = this.__items.length - 1; lastCheckedOutput >= 0; lastCheckedOutput--) {
    if (this.__items[lastCheckedOutput].match(pattern)) {
      return true;
    }
  }
  return false;
};

OutputLine.prototype.set_indent = function(indent, alignment) {
  if (this.is_empty()) {
    this.__indent_count = indent || 0;
    this.__alignment_count = alignment || 0;
    this.__character_count = this.__parent.get_indent_size(this.__indent_count, this.__alignment_count);
  }
};

OutputLine.prototype._set_wrap_point = function() {
  if (this.__parent.wrap_line_length) {
    this.__wrap_point_index = this.__items.length;
    this.__wrap_point_character_count = this.__character_count;
    this.__wrap_point_indent_count = this.__parent.next_line.__indent_count;
    this.__wrap_point_alignment_count = this.__parent.next_line.__alignment_count;
  }
};

OutputLine.prototype._should_wrap = function() {
  return this.__wrap_point_index &&
    this.__character_count > this.__parent.wrap_line_length &&
    this.__wrap_point_character_count > this.__parent.next_line.__character_count;
};

OutputLine.prototype._allow_wrap = function() {
  if (this._should_wrap()) {
    this.__parent.add_new_line();
    var next = this.__parent.current_line;
    next.set_indent(this.__wrap_point_indent_count, this.__wrap_point_alignment_count);
    next.__items = this.__items.slice(this.__wrap_point_index);
    this.__items = this.__items.slice(0, this.__wrap_point_index);

    next.__character_count += this.__character_count - this.__wrap_point_character_count;
    this.__character_count = this.__wrap_point_character_count;

    if (next.__items[0] === " ") {
      next.__items.splice(0, 1);
      next.__character_count -= 1;
    }
    return true;
  }
  return false;
};

OutputLine.prototype.is_empty = function() {
  return this.__items.length === 0;
};

OutputLine.prototype.last = function() {
  if (!this.is_empty()) {
    return this.__items[this.__items.length - 1];
  } else {
    return null;
  }
};

OutputLine.prototype.push = function(item) {
  this.__items.push(item);
  var last_newline_index = item.lastIndexOf('\n');
  if (last_newline_index !== -1) {
    this.__character_count = item.length - last_newline_index;
  } else {
    this.__character_count += item.length;
  }
};

OutputLine.prototype.pop = function() {
  var item = null;
  if (!this.is_empty()) {
    item = this.__items.pop();
    this.__character_count -= item.length;
  }
  return item;
};


OutputLine.prototype._remove_indent = function() {
  if (this.__indent_count > 0) {
    this.__indent_count -= 1;
    this.__character_count -= this.__parent.indent_size;
  }
};

OutputLine.prototype._remove_wrap_indent = function() {
  if (this.__wrap_point_indent_count > 0) {
    this.__wrap_point_indent_count -= 1;
  }
};
OutputLine.prototype.trim = function() {
  while (this.last() === ' ') {
    this.__items.pop();
    this.__character_count -= 1;
  }
};

OutputLine.prototype.toString = function() {
  var result = '';
  if (this.is_empty()) {
    if (this.__parent.indent_empty_lines) {
      result = this.__parent.get_indent_string(this.__indent_count);
    }
  } else {
    result = this.__parent.get_indent_string(this.__indent_count, this.__alignment_count);
    result += this.__items.join('');
  }
  return result;
};

function IndentStringCache(options, baseIndentString) {
  this.__cache = [''];
  this.__indent_size = options.indent_size;
  this.__indent_string = options.indent_char;
  if (!options.indent_with_tabs) {
    this.__indent_string = new Array(options.indent_size + 1).join(options.indent_char);
  }

  // Set to null to continue support for auto detection of base indent
  baseIndentString = baseIndentString || '';
  if (options.indent_level > 0) {
    baseIndentString = new Array(options.indent_level + 1).join(this.__indent_string);
  }

  this.__base_string = baseIndentString;
  this.__base_string_length = baseIndentString.length;
}

IndentStringCache.prototype.get_indent_size = function(indent, column) {
  var result = this.__base_string_length;
  column = column || 0;
  if (indent < 0) {
    result = 0;
  }
  result += indent * this.__indent_size;
  result += column;
  return result;
};

IndentStringCache.prototype.get_indent_string = function(indent_level, column) {
  var result = this.__base_string;
  column = column || 0;
  if (indent_level < 0) {
    indent_level = 0;
    result = '';
  }
  column += indent_level * this.__indent_size;
  this.__ensure_cache(column);
  result += this.__cache[column];
  return result;
};

IndentStringCache.prototype.__ensure_cache = function(column) {
  while (column >= this.__cache.length) {
    this.__add_column();
  }
};

IndentStringCache.prototype.__add_column = function() {
  var column = this.__cache.length;
  var indent = 0;
  var result = '';
  if (this.__indent_size && column >= this.__indent_size) {
    indent = Math.floor(column / this.__indent_size);
    column -= indent * this.__indent_size;
    result = new Array(indent + 1).join(this.__indent_string);
  }
  if (column) {
    result += new Array(column + 1).join(' ');
  }

  this.__cache.push(result);
};

function Output(options, baseIndentString) {
  this.__indent_cache = new IndentStringCache(options, baseIndentString);
  this.raw = false;
  this._end_with_newline = options.end_with_newline;
  this.indent_size = options.indent_size;
  this.wrap_line_length = options.wrap_line_length;
  this.indent_empty_lines = options.indent_empty_lines;
  this.__lines = [];
  this.previous_line = null;
  this.current_line = null;
  this.next_line = new OutputLine(this);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = false;
  // initialize
  this.__add_outputline();
}

Output.prototype.__add_outputline = function() {
  this.previous_line = this.current_line;
  this.current_line = this.next_line.clone_empty();
  this.__lines.push(this.current_line);
};

Output.prototype.get_line_number = function() {
  return this.__lines.length;
};

Output.prototype.get_indent_string = function(indent, column) {
  return this.__indent_cache.get_indent_string(indent, column);
};

Output.prototype.get_indent_size = function(indent, column) {
  return this.__indent_cache.get_indent_size(indent, column);
};

Output.prototype.is_empty = function() {
  return !this.previous_line && this.current_line.is_empty();
};

Output.prototype.add_new_line = function(force_newline) {
  // never newline at the start of file
  // otherwise, newline only if we didn't just add one or we're forced
  if (this.is_empty() ||
    (!force_newline && this.just_added_newline())) {
    return false;
  }

  // if raw output is enabled, don't print additional newlines,
  // but still return True as though you had
  if (!this.raw) {
    this.__add_outputline();
  }
  return true;
};

Output.prototype.get_code = function(eol) {
  this.trim(true);

  // handle some edge cases where the last tokens
  // has text that ends with newline(s)
  var last_item = this.current_line.pop();
  if (last_item) {
    if (last_item[last_item.length - 1] === '\n') {
      last_item = last_item.replace(/\n+$/g, '');
    }
    this.current_line.push(last_item);
  }

  if (this._end_with_newline) {
    this.__add_outputline();
  }

  var sweet_code = this.__lines.join('\n');

  if (eol !== '\n') {
    sweet_code = sweet_code.replace(/[\n]/g, eol);
  }
  return sweet_code;
};

Output.prototype.set_wrap_point = function() {
  this.current_line._set_wrap_point();
};

Output.prototype.set_indent = function(indent, alignment) {
  indent = indent || 0;
  alignment = alignment || 0;

  // Next line stores alignment values
  this.next_line.set_indent(indent, alignment);

  // Never indent your first output indent at the start of the file
  if (this.__lines.length > 1) {
    this.current_line.set_indent(indent, alignment);
    return true;
  }

  this.current_line.set_indent();
  return false;
};

Output.prototype.add_raw_token = function(token) {
  for (var x = 0; x < token.newlines; x++) {
    this.__add_outputline();
  }
  this.current_line.set_indent(-1);
  this.current_line.push(token.whitespace_before);
  this.current_line.push(token.text);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = false;
};

Output.prototype.add_token = function(printable_token) {
  this.__add_space_before_token();
  this.current_line.push(printable_token);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = this.current_line._allow_wrap();
};

Output.prototype.__add_space_before_token = function() {
  if (this.space_before_token && !this.just_added_newline()) {
    if (!this.non_breaking_space) {
      this.set_wrap_point();
    }
    this.current_line.push(' ');
  }
};

Output.prototype.remove_indent = function(index) {
  var output_length = this.__lines.length;
  while (index < output_length) {
    this.__lines[index]._remove_indent();
    index++;
  }
  this.current_line._remove_wrap_indent();
};

Output.prototype.trim = function(eat_newlines) {
  eat_newlines = (eat_newlines === undefined) ? false : eat_newlines;

  this.current_line.trim();

  while (eat_newlines && this.__lines.length > 1 &&
    this.current_line.is_empty()) {
    this.__lines.pop();
    this.current_line = this.__lines[this.__lines.length - 1];
    this.current_line.trim();
  }

  this.previous_line = this.__lines.length > 1 ?
    this.__lines[this.__lines.length - 2] : null;
};

Output.prototype.just_added_newline = function() {
  return this.current_line.is_empty();
};

Output.prototype.just_added_blankline = function() {
  return this.is_empty() ||
    (this.current_line.is_empty() && this.previous_line.is_empty());
};

Output.prototype.ensure_empty_line_above = function(starts_with, ends_with) {
  var index = this.__lines.length - 2;
  while (index >= 0) {
    var potentialEmptyLine = this.__lines[index];
    if (potentialEmptyLine.is_empty()) {
      break;
    } else if (potentialEmptyLine.item(0).indexOf(starts_with) !== 0 &&
      potentialEmptyLine.item(-1) !== ends_with) {
      this.__lines.splice(index + 1, 0, new OutputLine(this));
      this.previous_line = this.__lines[this.__lines.length - 2];
      break;
    }
    index--;
  }
};

module.exports.Output = Output;


/***/ }),
/* 3 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Token(type, text, newlines, whitespace_before) {
  this.type = type;
  this.text = text;

  // comments_before are
  // comments that have a new line before them
  // and may or may not have a newline after
  // this is a set of comments before
  this.comments_before = null; /* inline comment*/


  // this.comments_after =  new TokenStream(); // no new line before and newline after
  this.newlines = newlines || 0;
  this.whitespace_before = whitespace_before || '';
  this.parent = null;
  this.next = null;
  this.previous = null;
  this.opened = null;
  this.closed = null;
  this.directives = null;
}


module.exports.Token = Token;


/***/ }),
/* 4 */,
/* 5 */,
/* 6 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Options(options, merge_child_field) {
  this.raw_options = _mergeOpts(options, merge_child_field);

  // Support passing the source text back with no change
  this.disabled = this._get_boolean('disabled');

  this.eol = this._get_characters('eol', 'auto');
  this.end_with_newline = this._get_boolean('end_with_newline');
  this.indent_size = this._get_number('indent_size', 4);
  this.indent_char = this._get_characters('indent_char', ' ');
  this.indent_level = this._get_number('indent_level');

  this.preserve_newlines = this._get_boolean('preserve_newlines', true);
  this.max_preserve_newlines = this._get_number('max_preserve_newlines', 32786);
  if (!this.preserve_newlines) {
    this.max_preserve_newlines = 0;
  }

  this.indent_with_tabs = this._get_boolean('indent_with_tabs', this.indent_char === '\t');
  if (this.indent_with_tabs) {
    this.indent_char = '\t';

    // indent_size behavior changed after 1.8.6
    // It used to be that indent_size would be
    // set to 1 for indent_with_tabs. That is no longer needed and
    // actually doesn't make sense - why not use spaces? Further,
    // that might produce unexpected behavior - tabs being used
    // for single-column alignment. So, when indent_with_tabs is true
    // and indent_size is 1, reset indent_size to 4.
    if (this.indent_size === 1) {
      this.indent_size = 4;
    }
  }

  // Backwards compat with 1.3.x
  this.wrap_line_length = this._get_number('wrap_line_length', this._get_number('max_char'));

  this.indent_empty_lines = this._get_boolean('indent_empty_lines');

  // valid templating languages ['django', 'erb', 'handlebars', 'php', 'smarty']
  // For now, 'auto' = all off for javascript, all on for html (and inline javascript).
  // other values ignored
  this.templating = this._get_selection_list('templating', ['auto', 'none', 'django', 'erb', 'handlebars', 'php', 'smarty'], ['auto']);
}

Options.prototype._get_array = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = default_value || [];
  if (typeof option_value === 'object') {
    if (option_value !== null && typeof option_value.concat === 'function') {
      result = option_value.concat();
    }
  } else if (typeof option_value === 'string') {
    result = option_value.split(/[^a-zA-Z0-9_\/\-]+/);
  }
  return result;
};

Options.prototype._get_boolean = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = option_value === undefined ? !!default_value : !!option_value;
  return result;
};

Options.prototype._get_characters = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = default_value || '';
  if (typeof option_value === 'string') {
    result = option_value.replace(/\\r/, '\r').replace(/\\n/, '\n').replace(/\\t/, '\t');
  }
  return result;
};

Options.prototype._get_number = function(name, default_value) {
  var option_value = this.raw_options[name];
  default_value = parseInt(default_value, 10);
  if (isNaN(default_value)) {
    default_value = 0;
  }
  var result = parseInt(option_value, 10);
  if (isNaN(result)) {
    result = default_value;
  }
  return result;
};

Options.prototype._get_selection = function(name, selection_list, default_value) {
  var result = this._get_selection_list(name, selection_list, default_value);
  if (result.length !== 1) {
    throw new Error(
      "Invalid Option Value: The option '" + name + "' can only be one of the following values:\n" +
      selection_list + "\nYou passed in: '" + this.raw_options[name] + "'");
  }

  return result[0];
};


Options.prototype._get_selection_list = function(name, selection_list, default_value) {
  if (!selection_list || selection_list.length === 0) {
    throw new Error("Selection list cannot be empty.");
  }

  default_value = default_value || [selection_list[0]];
  if (!this._is_valid_selection(default_value, selection_list)) {
    throw new Error("Invalid Default Value!");
  }

  var result = this._get_array(name, default_value);
  if (!this._is_valid_selection(result, selection_list)) {
    throw new Error(
      "Invalid Option Value: The option '" + name + "' can contain only the following values:\n" +
      selection_list + "\nYou passed in: '" + this.raw_options[name] + "'");
  }

  return result;
};

Options.prototype._is_valid_selection = function(result, selection_list) {
  return result.length && selection_list.length &&
    !result.some(function(item) { return selection_list.indexOf(item) === -1; });
};


// merges child options up with the parent options object
// Example: obj = {a: 1, b: {a: 2}}
//          mergeOpts(obj, 'b')
//
//          Returns: {a: 2}
function _mergeOpts(allOptions, childFieldName) {
  var finalOpts = {};
  allOptions = _normalizeOpts(allOptions);
  var name;

  for (name in allOptions) {
    if (name !== childFieldName) {
      finalOpts[name] = allOptions[name];
    }
  }

  //merge in the per type settings for the childFieldName
  if (childFieldName && allOptions[childFieldName]) {
    for (name in allOptions[childFieldName]) {
      finalOpts[name] = allOptions[childFieldName][name];
    }
  }
  return finalOpts;
}

function _normalizeOpts(options) {
  var convertedOpts = {};
  var key;

  for (key in options) {
    var newKey = key.replace(/-/g, "_");
    convertedOpts[newKey] = options[key];
  }
  return convertedOpts;
}

module.exports.Options = Options;
module.exports.normalizeOpts = _normalizeOpts;
module.exports.mergeOpts = _mergeOpts;


/***/ }),
/* 7 */,
/* 8 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var regexp_has_sticky = RegExp.prototype.hasOwnProperty('sticky');

function InputScanner(input_string) {
  this.__input = input_string || '';
  this.__input_length = this.__input.length;
  this.__position = 0;
}

InputScanner.prototype.restart = function() {
  this.__position = 0;
};

InputScanner.prototype.back = function() {
  if (this.__position > 0) {
    this.__position -= 1;
  }
};

InputScanner.prototype.hasNext = function() {
  return this.__position < this.__input_length;
};

InputScanner.prototype.next = function() {
  var val = null;
  if (this.hasNext()) {
    val = this.__input.charAt(this.__position);
    this.__position += 1;
  }
  return val;
};

InputScanner.prototype.peek = function(index) {
  var val = null;
  index = index || 0;
  index += this.__position;
  if (index >= 0 && index < this.__input_length) {
    val = this.__input.charAt(index);
  }
  return val;
};

// This is a JavaScript only helper function (not in python)
// Javascript doesn't have a match method
// and not all implementation support "sticky" flag.
// If they do not support sticky then both this.match() and this.test() method
// must get the match and check the index of the match.
// If sticky is supported and set, this method will use it.
// Otherwise it will check that global is set, and fall back to the slower method.
InputScanner.prototype.__match = function(pattern, index) {
  pattern.lastIndex = index;
  var pattern_match = pattern.exec(this.__input);

  if (pattern_match && !(regexp_has_sticky && pattern.sticky)) {
    if (pattern_match.index !== index) {
      pattern_match = null;
    }
  }

  return pattern_match;
};

InputScanner.prototype.test = function(pattern, index) {
  index = index || 0;
  index += this.__position;

  if (index >= 0 && index < this.__input_length) {
    return !!this.__match(pattern, index);
  } else {
    return false;
  }
};

InputScanner.prototype.testChar = function(pattern, index) {
  // test one character regex match
  var val = this.peek(index);
  pattern.lastIndex = 0;
  return val !== null && pattern.test(val);
};

InputScanner.prototype.match = function(pattern) {
  var pattern_match = this.__match(pattern, this.__position);
  if (pattern_match) {
    this.__position += pattern_match[0].length;
  } else {
    pattern_match = null;
  }
  return pattern_match;
};

InputScanner.prototype.read = function(starting_pattern, until_pattern, until_after) {
  var val = '';
  var match;
  if (starting_pattern) {
    match = this.match(starting_pattern);
    if (match) {
      val += match[0];
    }
  }
  if (until_pattern && (match || !starting_pattern)) {
    val += this.readUntil(until_pattern, until_after);
  }
  return val;
};

InputScanner.prototype.readUntil = function(pattern, until_after) {
  var val = '';
  var match_index = this.__position;
  pattern.lastIndex = this.__position;
  var pattern_match = pattern.exec(this.__input);
  if (pattern_match) {
    match_index = pattern_match.index;
    if (until_after) {
      match_index += pattern_match[0].length;
    }
  } else {
    match_index = this.__input_length;
  }

  val = this.__input.substring(this.__position, match_index);
  this.__position = match_index;
  return val;
};

InputScanner.prototype.readUntilAfter = function(pattern) {
  return this.readUntil(pattern, true);
};

InputScanner.prototype.get_regexp = function(pattern, match_from) {
  var result = null;
  var flags = 'g';
  if (match_from && regexp_has_sticky) {
    flags = 'y';
  }
  // strings are converted to regexp
  if (typeof pattern === "string" && pattern !== '') {
    // result = new RegExp(pattern.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), flags);
    result = new RegExp(pattern, flags);
  } else if (pattern) {
    result = new RegExp(pattern.source, flags);
  }
  return result;
};

InputScanner.prototype.get_literal_regexp = function(literal_string) {
  return RegExp(literal_string.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'));
};

/* css beautifier legacy helpers */
InputScanner.prototype.peekUntilAfter = function(pattern) {
  var start = this.__position;
  var val = this.readUntilAfter(pattern);
  this.__position = start;
  return val;
};

InputScanner.prototype.lookBack = function(testVal) {
  var start = this.__position - 1;
  return start >= testVal.length && this.__input.substring(start - testVal.length, start)
    .toLowerCase() === testVal;
};

module.exports.InputScanner = InputScanner;


/***/ }),
/* 9 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_30287__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var InputScanner = __nested_webpack_require_30287__(8).InputScanner;
var Token = __nested_webpack_require_30287__(3).Token;
var TokenStream = __nested_webpack_require_30287__(10).TokenStream;
var WhitespacePattern = __nested_webpack_require_30287__(11).WhitespacePattern;

var TOKEN = {
  START: 'TK_START',
  RAW: 'TK_RAW',
  EOF: 'TK_EOF'
};

var Tokenizer = function(input_string, options) {
  this._input = new InputScanner(input_string);
  this._options = options || {};
  this.__tokens = null;

  this._patterns = {};
  this._patterns.whitespace = new WhitespacePattern(this._input);
};

Tokenizer.prototype.tokenize = function() {
  this._input.restart();
  this.__tokens = new TokenStream();

  this._reset();

  var current;
  var previous = new Token(TOKEN.START, '');
  var open_token = null;
  var open_stack = [];
  var comments = new TokenStream();

  while (previous.type !== TOKEN.EOF) {
    current = this._get_next_token(previous, open_token);
    while (this._is_comment(current)) {
      comments.add(current);
      current = this._get_next_token(previous, open_token);
    }

    if (!comments.isEmpty()) {
      current.comments_before = comments;
      comments = new TokenStream();
    }

    current.parent = open_token;

    if (this._is_opening(current)) {
      open_stack.push(open_token);
      open_token = current;
    } else if (open_token && this._is_closing(current, open_token)) {
      current.opened = open_token;
      open_token.closed = current;
      open_token = open_stack.pop();
      current.parent = open_token;
    }

    current.previous = previous;
    previous.next = current;

    this.__tokens.add(current);
    previous = current;
  }

  return this.__tokens;
};


Tokenizer.prototype._is_first_token = function() {
  return this.__tokens.isEmpty();
};

Tokenizer.prototype._reset = function() {};

Tokenizer.prototype._get_next_token = function(previous_token, open_token) { // jshint unused:false
  this._readWhitespace();
  var resulting_string = this._input.read(/.+/g);
  if (resulting_string) {
    return this._create_token(TOKEN.RAW, resulting_string);
  } else {
    return this._create_token(TOKEN.EOF, '');
  }
};

Tokenizer.prototype._is_comment = function(current_token) { // jshint unused:false
  return false;
};

Tokenizer.prototype._is_opening = function(current_token) { // jshint unused:false
  return false;
};

Tokenizer.prototype._is_closing = function(current_token, open_token) { // jshint unused:false
  return false;
};

Tokenizer.prototype._create_token = function(type, text) {
  var token = new Token(type, text,
    this._patterns.whitespace.newline_count,
    this._patterns.whitespace.whitespace_before_token);
  return token;
};

Tokenizer.prototype._readWhitespace = function() {
  return this._patterns.whitespace.read();
};



module.exports.Tokenizer = Tokenizer;
module.exports.TOKEN = TOKEN;


/***/ }),
/* 10 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function TokenStream(parent_token) {
  // private
  this.__tokens = [];
  this.__tokens_length = this.__tokens.length;
  this.__position = 0;
  this.__parent_token = parent_token;
}

TokenStream.prototype.restart = function() {
  this.__position = 0;
};

TokenStream.prototype.isEmpty = function() {
  return this.__tokens_length === 0;
};

TokenStream.prototype.hasNext = function() {
  return this.__position < this.__tokens_length;
};

TokenStream.prototype.next = function() {
  var val = null;
  if (this.hasNext()) {
    val = this.__tokens[this.__position];
    this.__position += 1;
  }
  return val;
};

TokenStream.prototype.peek = function(index) {
  var val = null;
  index = index || 0;
  index += this.__position;
  if (index >= 0 && index < this.__tokens_length) {
    val = this.__tokens[index];
  }
  return val;
};

TokenStream.prototype.add = function(token) {
  if (this.__parent_token) {
    token.parent = this.__parent_token;
  }
  this.__tokens.push(token);
  this.__tokens_length += 1;
};

module.exports.TokenStream = TokenStream;


/***/ }),
/* 11 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_36699__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Pattern = __nested_webpack_require_36699__(12).Pattern;

function WhitespacePattern(input_scanner, parent) {
  Pattern.call(this, input_scanner, parent);
  if (parent) {
    this._line_regexp = this._input.get_regexp(parent._line_regexp);
  } else {
    this.__set_whitespace_patterns('', '');
  }

  this.newline_count = 0;
  this.whitespace_before_token = '';
}
WhitespacePattern.prototype = new Pattern();

WhitespacePattern.prototype.__set_whitespace_patterns = function(whitespace_chars, newline_chars) {
  whitespace_chars += '\\t ';
  newline_chars += '\\n\\r';

  this._match_pattern = this._input.get_regexp(
    '[' + whitespace_chars + newline_chars + ']+', true);
  this._newline_regexp = this._input.get_regexp(
    '\\r\\n|[' + newline_chars + ']');
};

WhitespacePattern.prototype.read = function() {
  this.newline_count = 0;
  this.whitespace_before_token = '';

  var resulting_string = this._input.read(this._match_pattern);
  if (resulting_string === ' ') {
    this.whitespace_before_token = ' ';
  } else if (resulting_string) {
    var matches = this.__split(this._newline_regexp, resulting_string);
    this.newline_count = matches.length - 1;
    this.whitespace_before_token = matches[this.newline_count];
  }

  return resulting_string;
};

WhitespacePattern.prototype.matching = function(whitespace_chars, newline_chars) {
  var result = this._create();
  result.__set_whitespace_patterns(whitespace_chars, newline_chars);
  result._update();
  return result;
};

WhitespacePattern.prototype._create = function() {
  return new WhitespacePattern(this._input, this);
};

WhitespacePattern.prototype.__split = function(regexp, input_string) {
  regexp.lastIndex = 0;
  var start_index = 0;
  var result = [];
  var next_match = regexp.exec(input_string);
  while (next_match) {
    result.push(input_string.substring(start_index, next_match.index));
    start_index = next_match.index + next_match[0].length;
    next_match = regexp.exec(input_string);
  }

  if (start_index < input_string.length) {
    result.push(input_string.substring(start_index, input_string.length));
  } else {
    result.push('');
  }

  return result;
};



module.exports.WhitespacePattern = WhitespacePattern;


/***/ }),
/* 12 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Pattern(input_scanner, parent) {
  this._input = input_scanner;
  this._starting_pattern = null;
  this._match_pattern = null;
  this._until_pattern = null;
  this._until_after = false;

  if (parent) {
    this._starting_pattern = this._input.get_regexp(parent._starting_pattern, true);
    this._match_pattern = this._input.get_regexp(parent._match_pattern, true);
    this._until_pattern = this._input.get_regexp(parent._until_pattern);
    this._until_after = parent._until_after;
  }
}

Pattern.prototype.read = function() {
  var result = this._input.read(this._starting_pattern);
  if (!this._starting_pattern || result) {
    result += this._input.read(this._match_pattern, this._until_pattern, this._until_after);
  }
  return result;
};

Pattern.prototype.read_match = function() {
  return this._input.match(this._match_pattern);
};

Pattern.prototype.until_after = function(pattern) {
  var result = this._create();
  result._until_after = true;
  result._until_pattern = this._input.get_regexp(pattern);
  result._update();
  return result;
};

Pattern.prototype.until = function(pattern) {
  var result = this._create();
  result._until_after = false;
  result._until_pattern = this._input.get_regexp(pattern);
  result._update();
  return result;
};

Pattern.prototype.starting_with = function(pattern) {
  var result = this._create();
  result._starting_pattern = this._input.get_regexp(pattern, true);
  result._update();
  return result;
};

Pattern.prototype.matching = function(pattern) {
  var result = this._create();
  result._match_pattern = this._input.get_regexp(pattern, true);
  result._update();
  return result;
};

Pattern.prototype._create = function() {
  return new Pattern(this._input, this);
};

Pattern.prototype._update = function() {};

module.exports.Pattern = Pattern;


/***/ }),
/* 13 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Directives(start_block_pattern, end_block_pattern) {
  start_block_pattern = typeof start_block_pattern === 'string' ? start_block_pattern : start_block_pattern.source;
  end_block_pattern = typeof end_block_pattern === 'string' ? end_block_pattern : end_block_pattern.source;
  this.__directives_block_pattern = new RegExp(start_block_pattern + / beautify( \w+[:]\w+)+ /.source + end_block_pattern, 'g');
  this.__directive_pattern = / (\w+)[:](\w+)/g;

  this.__directives_end_ignore_pattern = new RegExp(start_block_pattern + /\sbeautify\signore:end\s/.source + end_block_pattern, 'g');
}

Directives.prototype.get_directives = function(text) {
  if (!text.match(this.__directives_block_pattern)) {
    return null;
  }

  var directives = {};
  this.__directive_pattern.lastIndex = 0;
  var directive_match = this.__directive_pattern.exec(text);

  while (directive_match) {
    directives[directive_match[1]] = directive_match[2];
    directive_match = this.__directive_pattern.exec(text);
  }

  return directives;
};

Directives.prototype.readIgnored = function(input) {
  return input.readUntilAfter(this.__directives_end_ignore_pattern);
};


module.exports.Directives = Directives;


/***/ }),
/* 14 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_45684__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Pattern = __nested_webpack_require_45684__(12).Pattern;


var template_names = {
  django: false,
  erb: false,
  handlebars: false,
  php: false,
  smarty: false
};

// This lets templates appear anywhere we would do a readUntil
// The cost is higher but it is pay to play.
function TemplatablePattern(input_scanner, parent) {
  Pattern.call(this, input_scanner, parent);
  this.__template_pattern = null;
  this._disabled = Object.assign({}, template_names);
  this._excluded = Object.assign({}, template_names);

  if (parent) {
    this.__template_pattern = this._input.get_regexp(parent.__template_pattern);
    this._excluded = Object.assign(this._excluded, parent._excluded);
    this._disabled = Object.assign(this._disabled, parent._disabled);
  }
  var pattern = new Pattern(input_scanner);
  this.__patterns = {
    handlebars_comment: pattern.starting_with(/{{!--/).until_after(/--}}/),
    handlebars_unescaped: pattern.starting_with(/{{{/).until_after(/}}}/),
    handlebars: pattern.starting_with(/{{/).until_after(/}}/),
    php: pattern.starting_with(/<\?(?:[= ]|php)/).until_after(/\?>/),
    erb: pattern.starting_with(/<%[^%]/).until_after(/[^%]%>/),
    // django coflicts with handlebars a bit.
    django: pattern.starting_with(/{%/).until_after(/%}/),
    django_value: pattern.starting_with(/{{/).until_after(/}}/),
    django_comment: pattern.starting_with(/{#/).until_after(/#}/),
    smarty: pattern.starting_with(/{(?=[^}{\s\n])/).until_after(/[^\s\n]}/),
    smarty_comment: pattern.starting_with(/{\*/).until_after(/\*}/),
    smarty_literal: pattern.starting_with(/{literal}/).until_after(/{\/literal}/)
  };
}
TemplatablePattern.prototype = new Pattern();

TemplatablePattern.prototype._create = function() {
  return new TemplatablePattern(this._input, this);
};

TemplatablePattern.prototype._update = function() {
  this.__set_templated_pattern();
};

TemplatablePattern.prototype.disable = function(language) {
  var result = this._create();
  result._disabled[language] = true;
  result._update();
  return result;
};

TemplatablePattern.prototype.read_options = function(options) {
  var result = this._create();
  for (var language in template_names) {
    result._disabled[language] = options.templating.indexOf(language) === -1;
  }
  result._update();
  return result;
};

TemplatablePattern.prototype.exclude = function(language) {
  var result = this._create();
  result._excluded[language] = true;
  result._update();
  return result;
};

TemplatablePattern.prototype.read = function() {
  var result = '';
  if (this._match_pattern) {
    result = this._input.read(this._starting_pattern);
  } else {
    result = this._input.read(this._starting_pattern, this.__template_pattern);
  }
  var next = this._read_template();
  while (next) {
    if (this._match_pattern) {
      next += this._input.read(this._match_pattern);
    } else {
      next += this._input.readUntil(this.__template_pattern);
    }
    result += next;
    next = this._read_template();
  }

  if (this._until_after) {
    result += this._input.readUntilAfter(this._until_pattern);
  }
  return result;
};

TemplatablePattern.prototype.__set_templated_pattern = function() {
  var items = [];

  if (!this._disabled.php) {
    items.push(this.__patterns.php._starting_pattern.source);
  }
  if (!this._disabled.handlebars) {
    items.push(this.__patterns.handlebars._starting_pattern.source);
  }
  if (!this._disabled.erb) {
    items.push(this.__patterns.erb._starting_pattern.source);
  }
  if (!this._disabled.django) {
    items.push(this.__patterns.django._starting_pattern.source);
    // The starting pattern for django is more complex because it has different
    // patterns for value, comment, and other sections
    items.push(this.__patterns.django_value._starting_pattern.source);
    items.push(this.__patterns.django_comment._starting_pattern.source);
  }
  if (!this._disabled.smarty) {
    items.push(this.__patterns.smarty._starting_pattern.source);
  }

  if (this._until_pattern) {
    items.push(this._until_pattern.source);
  }
  this.__template_pattern = this._input.get_regexp('(?:' + items.join('|') + ')');
};

TemplatablePattern.prototype._read_template = function() {
  var resulting_string = '';
  var c = this._input.peek();
  if (c === '<') {
    var peek1 = this._input.peek(1);
    //if we're in a comment, do something special
    // We treat all comments as literals, even more than preformatted tags
    // we just look for the appropriate close tag
    if (!this._disabled.php && !this._excluded.php && peek1 === '?') {
      resulting_string = resulting_string ||
        this.__patterns.php.read();
    }
    if (!this._disabled.erb && !this._excluded.erb && peek1 === '%') {
      resulting_string = resulting_string ||
        this.__patterns.erb.read();
    }
  } else if (c === '{') {
    if (!this._disabled.handlebars && !this._excluded.handlebars) {
      resulting_string = resulting_string ||
        this.__patterns.handlebars_comment.read();
      resulting_string = resulting_string ||
        this.__patterns.handlebars_unescaped.read();
      resulting_string = resulting_string ||
        this.__patterns.handlebars.read();
    }
    if (!this._disabled.django) {
      // django coflicts with handlebars a bit.
      if (!this._excluded.django && !this._excluded.handlebars) {
        resulting_string = resulting_string ||
          this.__patterns.django_value.read();
      }
      if (!this._excluded.django) {
        resulting_string = resulting_string ||
          this.__patterns.django_comment.read();
        resulting_string = resulting_string ||
          this.__patterns.django.read();
      }
    }
    if (!this._disabled.smarty) {
      // smarty cannot be enabled with django or handlebars enabled
      if (this._disabled.django && this._disabled.handlebars) {
        resulting_string = resulting_string ||
          this.__patterns.smarty_comment.read();
        resulting_string = resulting_string ||
          this.__patterns.smarty_literal.read();
        resulting_string = resulting_string ||
          this.__patterns.smarty.read();
      }
    }
  }
  return resulting_string;
};


module.exports.TemplatablePattern = TemplatablePattern;


/***/ }),
/* 15 */,
/* 16 */,
/* 17 */,
/* 18 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_53228__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Beautifier = __nested_webpack_require_53228__(19).Beautifier,
  Options = __nested_webpack_require_53228__(20).Options;

function style_html(html_source, options, js_beautify, css_beautify) {
  var beautifier = new Beautifier(html_source, options, js_beautify, css_beautify);
  return beautifier.beautify();
}

module.exports = style_html;
module.exports.defaultOptions = function() {
  return new Options();
};


/***/ }),
/* 19 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_54902__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Options = __nested_webpack_require_54902__(20).Options;
var Output = __nested_webpack_require_54902__(2).Output;
var Tokenizer = __nested_webpack_require_54902__(21).Tokenizer;
var TOKEN = __nested_webpack_require_54902__(21).TOKEN;

var lineBreak = /\r\n|[\r\n]/;
var allLineBreaks = /\r\n|[\r\n]/g;

var Printer = function(options, base_indent_string) { //handles input/output and some other printing functions

  this.indent_level = 0;
  this.alignment_size = 0;
  this.max_preserve_newlines = options.max_preserve_newlines;
  this.preserve_newlines = options.preserve_newlines;

  this._output = new Output(options, base_indent_string);

};

Printer.prototype.current_line_has_match = function(pattern) {
  return this._output.current_line.has_match(pattern);
};

Printer.prototype.set_space_before_token = function(value, non_breaking) {
  this._output.space_before_token = value;
  this._output.non_breaking_space = non_breaking;
};

Printer.prototype.set_wrap_point = function() {
  this._output.set_indent(this.indent_level, this.alignment_size);
  this._output.set_wrap_point();
};


Printer.prototype.add_raw_token = function(token) {
  this._output.add_raw_token(token);
};

Printer.prototype.print_preserved_newlines = function(raw_token) {
  var newlines = 0;
  if (raw_token.type !== TOKEN.TEXT && raw_token.previous.type !== TOKEN.TEXT) {
    newlines = raw_token.newlines ? 1 : 0;
  }

  if (this.preserve_newlines) {
    newlines = raw_token.newlines < this.max_preserve_newlines + 1 ? raw_token.newlines : this.max_preserve_newlines + 1;
  }
  for (var n = 0; n < newlines; n++) {
    this.print_newline(n > 0);
  }

  return newlines !== 0;
};

Printer.prototype.traverse_whitespace = function(raw_token) {
  if (raw_token.whitespace_before || raw_token.newlines) {
    if (!this.print_preserved_newlines(raw_token)) {
      this._output.space_before_token = true;
    }
    return true;
  }
  return false;
};

Printer.prototype.previous_token_wrapped = function() {
  return this._output.previous_token_wrapped;
};

Printer.prototype.print_newline = function(force) {
  this._output.add_new_line(force);
};

Printer.prototype.print_token = function(token) {
  if (token.text) {
    this._output.set_indent(this.indent_level, this.alignment_size);
    this._output.add_token(token.text);
  }
};

Printer.prototype.indent = function() {
  this.indent_level++;
};

Printer.prototype.get_full_indent = function(level) {
  level = this.indent_level + (level || 0);
  if (level < 1) {
    return '';
  }

  return this._output.get_indent_string(level);
};

var get_type_attribute = function(start_token) {
  var result = null;
  var raw_token = start_token.next;

  // Search attributes for a type attribute
  while (raw_token.type !== TOKEN.EOF && start_token.closed !== raw_token) {
    if (raw_token.type === TOKEN.ATTRIBUTE && raw_token.text === 'type') {
      if (raw_token.next && raw_token.next.type === TOKEN.EQUALS &&
        raw_token.next.next && raw_token.next.next.type === TOKEN.VALUE) {
        result = raw_token.next.next.text;
      }
      break;
    }
    raw_token = raw_token.next;
  }

  return result;
};

var get_custom_beautifier_name = function(tag_check, raw_token) {
  var typeAttribute = null;
  var result = null;

  if (!raw_token.closed) {
    return null;
  }

  if (tag_check === 'script') {
    typeAttribute = 'text/javascript';
  } else if (tag_check === 'style') {
    typeAttribute = 'text/css';
  }

  typeAttribute = get_type_attribute(raw_token) || typeAttribute;

  // For script and style tags that have a type attribute, only enable custom beautifiers for matching values
  // For those without a type attribute use default;
  if (typeAttribute.search('text/css') > -1) {
    result = 'css';
  } else if (typeAttribute.search(/module|((text|application|dojo)\/(x-)?(javascript|ecmascript|jscript|livescript|(ld\+)?json|method|aspect))/) > -1) {
    result = 'javascript';
  } else if (typeAttribute.search(/(text|application|dojo)\/(x-)?(html)/) > -1) {
    result = 'html';
  } else if (typeAttribute.search(/test\/null/) > -1) {
    // Test only mime-type for testing the beautifier when null is passed as beautifing function
    result = 'null';
  }

  return result;
};

function in_array(what, arr) {
  return arr.indexOf(what) !== -1;
}

function TagFrame(parent, parser_token, indent_level) {
  this.parent = parent || null;
  this.tag = parser_token ? parser_token.tag_name : '';
  this.indent_level = indent_level || 0;
  this.parser_token = parser_token || null;
}

function TagStack(printer) {
  this._printer = printer;
  this._current_frame = null;
}

TagStack.prototype.get_parser_token = function() {
  return this._current_frame ? this._current_frame.parser_token : null;
};

TagStack.prototype.record_tag = function(parser_token) { //function to record a tag and its parent in this.tags Object
  var new_frame = new TagFrame(this._current_frame, parser_token, this._printer.indent_level);
  this._current_frame = new_frame;
};

TagStack.prototype._try_pop_frame = function(frame) { //function to retrieve the opening tag to the corresponding closer
  var parser_token = null;

  if (frame) {
    parser_token = frame.parser_token;
    this._printer.indent_level = frame.indent_level;
    this._current_frame = frame.parent;
  }

  return parser_token;
};

TagStack.prototype._get_frame = function(tag_list, stop_list) { //function to retrieve the opening tag to the corresponding closer
  var frame = this._current_frame;

  while (frame) { //till we reach '' (the initial value);
    if (tag_list.indexOf(frame.tag) !== -1) { //if this is it use it
      break;
    } else if (stop_list && stop_list.indexOf(frame.tag) !== -1) {
      frame = null;
      break;
    }
    frame = frame.parent;
  }

  return frame;
};

TagStack.prototype.try_pop = function(tag, stop_list) { //function to retrieve the opening tag to the corresponding closer
  var frame = this._get_frame([tag], stop_list);
  return this._try_pop_frame(frame);
};

TagStack.prototype.indent_to_tag = function(tag_list) {
  var frame = this._get_frame(tag_list);
  if (frame) {
    this._printer.indent_level = frame.indent_level;
  }
};

function Beautifier(source_text, options, js_beautify, css_beautify) {
  //Wrapper function to invoke all the necessary constructors and deal with the output.
  this._source_text = source_text || '';
  options = options || {};
  this._js_beautify = js_beautify;
  this._css_beautify = css_beautify;
  this._tag_stack = null;

  // Allow the setting of language/file-type specific options
  // with inheritance of overall settings
  var optionHtml = new Options(options, 'html');

  this._options = optionHtml;

  this._is_wrap_attributes_force = this._options.wrap_attributes.substr(0, 'force'.length) === 'force';
  this._is_wrap_attributes_force_expand_multiline = (this._options.wrap_attributes === 'force-expand-multiline');
  this._is_wrap_attributes_force_aligned = (this._options.wrap_attributes === 'force-aligned');
  this._is_wrap_attributes_aligned_multiple = (this._options.wrap_attributes === 'aligned-multiple');
  this._is_wrap_attributes_preserve = this._options.wrap_attributes.substr(0, 'preserve'.length) === 'preserve';
  this._is_wrap_attributes_preserve_aligned = (this._options.wrap_attributes === 'preserve-aligned');
}

Beautifier.prototype.beautify = function() {

  // if disabled, return the input unchanged.
  if (this._options.disabled) {
    return this._source_text;
  }

  var source_text = this._source_text;
  var eol = this._options.eol;
  if (this._options.eol === 'auto') {
    eol = '\n';
    if (source_text && lineBreak.test(source_text)) {
      eol = source_text.match(lineBreak)[0];
    }
  }

  // HACK: newline parsing inconsistent. This brute force normalizes the input.
  source_text = source_text.replace(allLineBreaks, '\n');

  var baseIndentString = source_text.match(/^[\t ]*/)[0];

  var last_token = {
    text: '',
    type: ''
  };

  var last_tag_token = new TagOpenParserToken();

  var printer = new Printer(this._options, baseIndentString);
  var tokens = new Tokenizer(source_text, this._options).tokenize();

  this._tag_stack = new TagStack(printer);

  var parser_token = null;
  var raw_token = tokens.next();
  while (raw_token.type !== TOKEN.EOF) {

    if (raw_token.type === TOKEN.TAG_OPEN || raw_token.type === TOKEN.COMMENT) {
      parser_token = this._handle_tag_open(printer, raw_token, last_tag_token, last_token);
      last_tag_token = parser_token;
    } else if ((raw_token.type === TOKEN.ATTRIBUTE || raw_token.type === TOKEN.EQUALS || raw_token.type === TOKEN.VALUE) ||
      (raw_token.type === TOKEN.TEXT && !last_tag_token.tag_complete)) {
      parser_token = this._handle_inside_tag(printer, raw_token, last_tag_token, tokens);
    } else if (raw_token.type === TOKEN.TAG_CLOSE) {
      parser_token = this._handle_tag_close(printer, raw_token, last_tag_token);
    } else if (raw_token.type === TOKEN.TEXT) {
      parser_token = this._handle_text(printer, raw_token, last_tag_token);
    } else {
      // This should never happen, but if it does. Print the raw token
      printer.add_raw_token(raw_token);
    }

    last_token = parser_token;

    raw_token = tokens.next();
  }
  var sweet_code = printer._output.get_code(eol);

  return sweet_code;
};

Beautifier.prototype._handle_tag_close = function(printer, raw_token, last_tag_token) {
  var parser_token = {
    text: raw_token.text,
    type: raw_token.type
  };
  printer.alignment_size = 0;
  last_tag_token.tag_complete = true;

  printer.set_space_before_token(raw_token.newlines || raw_token.whitespace_before !== '', true);
  if (last_tag_token.is_unformatted) {
    printer.add_raw_token(raw_token);
  } else {
    if (last_tag_token.tag_start_char === '<') {
      printer.set_space_before_token(raw_token.text[0] === '/', true); // space before />, no space before >
      if (this._is_wrap_attributes_force_expand_multiline && last_tag_token.has_wrapped_attrs) {
        printer.print_newline(false);
      }
    }
    printer.print_token(raw_token);

  }

  if (last_tag_token.indent_content &&
    !(last_tag_token.is_unformatted || last_tag_token.is_content_unformatted)) {
    printer.indent();

    // only indent once per opened tag
    last_tag_token.indent_content = false;
  }

  if (!last_tag_token.is_inline_element &&
    !(last_tag_token.is_unformatted || last_tag_token.is_content_unformatted)) {
    printer.set_wrap_point();
  }

  return parser_token;
};

Beautifier.prototype._handle_inside_tag = function(printer, raw_token, last_tag_token, tokens) {
  var wrapped = last_tag_token.has_wrapped_attrs;
  var parser_token = {
    text: raw_token.text,
    type: raw_token.type
  };

  printer.set_space_before_token(raw_token.newlines || raw_token.whitespace_before !== '', true);
  if (last_tag_token.is_unformatted) {
    printer.add_raw_token(raw_token);
  } else if (last_tag_token.tag_start_char === '{' && raw_token.type === TOKEN.TEXT) {
    // For the insides of handlebars allow newlines or a single space between open and contents
    if (printer.print_preserved_newlines(raw_token)) {
      raw_token.newlines = 0;
      printer.add_raw_token(raw_token);
    } else {
      printer.print_token(raw_token);
    }
  } else {
    if (raw_token.type === TOKEN.ATTRIBUTE) {
      printer.set_space_before_token(true);
      last_tag_token.attr_count += 1;
    } else if (raw_token.type === TOKEN.EQUALS) { //no space before =
      printer.set_space_before_token(false);
    } else if (raw_token.type === TOKEN.VALUE && raw_token.previous.type === TOKEN.EQUALS) { //no space before value
      printer.set_space_before_token(false);
    }

    if (raw_token.type === TOKEN.ATTRIBUTE && last_tag_token.tag_start_char === '<') {
      if (this._is_wrap_attributes_preserve || this._is_wrap_attributes_preserve_aligned) {
        printer.traverse_whitespace(raw_token);
        wrapped = wrapped || raw_token.newlines !== 0;
      }


      if (this._is_wrap_attributes_force) {
        var force_attr_wrap = last_tag_token.attr_count > 1;
        if (this._is_wrap_attributes_force_expand_multiline && last_tag_token.attr_count === 1) {
          var is_only_attribute = true;
          var peek_index = 0;
          var peek_token;
          do {
            peek_token = tokens.peek(peek_index);
            if (peek_token.type === TOKEN.ATTRIBUTE) {
              is_only_attribute = false;
              break;
            }
            peek_index += 1;
          } while (peek_index < 4 && peek_token.type !== TOKEN.EOF && peek_token.type !== TOKEN.TAG_CLOSE);

          force_attr_wrap = !is_only_attribute;
        }

        if (force_attr_wrap) {
          printer.print_newline(false);
          wrapped = true;
        }
      }
    }
    printer.print_token(raw_token);
    wrapped = wrapped || printer.previous_token_wrapped();
    last_tag_token.has_wrapped_attrs = wrapped;
  }
  return parser_token;
};

Beautifier.prototype._handle_text = function(printer, raw_token, last_tag_token) {
  var parser_token = {
    text: raw_token.text,
    type: 'TK_CONTENT'
  };
  if (last_tag_token.custom_beautifier_name) { //check if we need to format javascript
    this._print_custom_beatifier_text(printer, raw_token, last_tag_token);
  } else if (last_tag_token.is_unformatted || last_tag_token.is_content_unformatted) {
    printer.add_raw_token(raw_token);
  } else {
    printer.traverse_whitespace(raw_token);
    printer.print_token(raw_token);
  }
  return parser_token;
};

Beautifier.prototype._print_custom_beatifier_text = function(printer, raw_token, last_tag_token) {
  var local = this;
  if (raw_token.text !== '') {

    var text = raw_token.text,
      _beautifier,
      script_indent_level = 1,
      pre = '',
      post = '';
    if (last_tag_token.custom_beautifier_name === 'javascript' && typeof this._js_beautify === 'function') {
      _beautifier = this._js_beautify;
    } else if (last_tag_token.custom_beautifier_name === 'css' && typeof this._css_beautify === 'function') {
      _beautifier = this._css_beautify;
    } else if (last_tag_token.custom_beautifier_name === 'html') {
      _beautifier = function(html_source, options) {
        var beautifier = new Beautifier(html_source, options, local._js_beautify, local._css_beautify);
        return beautifier.beautify();
      };
    }

    if (this._options.indent_scripts === "keep") {
      script_indent_level = 0;
    } else if (this._options.indent_scripts === "separate") {
      script_indent_level = -printer.indent_level;
    }

    var indentation = printer.get_full_indent(script_indent_level);

    // if there is at least one empty line at the end of this text, strip it
    // we'll be adding one back after the text but before the containing tag.
    text = text.replace(/\n[ \t]*$/, '');

    // Handle the case where content is wrapped in a comment or cdata.
    if (last_tag_token.custom_beautifier_name !== 'html' &&
      text[0] === '<' && text.match(/^(<!--|<!\[CDATA\[)/)) {
      var matched = /^(<!--[^\n]*|<!\[CDATA\[)(\n?)([ \t\n]*)([\s\S]*)(-->|]]>)$/.exec(text);

      // if we start to wrap but don't finish, print raw
      if (!matched) {
        printer.add_raw_token(raw_token);
        return;
      }

      pre = indentation + matched[1] + '\n';
      text = matched[4];
      if (matched[5]) {
        post = indentation + matched[5];
      }

      // if there is at least one empty line at the end of this text, strip it
      // we'll be adding one back after the text but before the containing tag.
      text = text.replace(/\n[ \t]*$/, '');

      if (matched[2] || matched[3].indexOf('\n') !== -1) {
        // if the first line of the non-comment text has spaces
        // use that as the basis for indenting in null case.
        matched = matched[3].match(/[ \t]+$/);
        if (matched) {
          raw_token.whitespace_before = matched[0];
        }
      }
    }

    if (text) {
      if (_beautifier) {

        // call the Beautifier if avaliable
        var Child_options = function() {
          this.eol = '\n';
        };
        Child_options.prototype = this._options.raw_options;
        var child_options = new Child_options();
        text = _beautifier(indentation + text, child_options);
      } else {
        // simply indent the string otherwise
        var white = raw_token.whitespace_before;
        if (white) {
          text = text.replace(new RegExp('\n(' + white + ')?', 'g'), '\n');
        }

        text = indentation + text.replace(/\n/g, '\n' + indentation);
      }
    }

    if (pre) {
      if (!text) {
        text = pre + post;
      } else {
        text = pre + text + '\n' + post;
      }
    }

    printer.print_newline(false);
    if (text) {
      raw_token.text = text;
      raw_token.whitespace_before = '';
      raw_token.newlines = 0;
      printer.add_raw_token(raw_token);
      printer.print_newline(true);
    }
  }
};

Beautifier.prototype._handle_tag_open = function(printer, raw_token, last_tag_token, last_token) {
  var parser_token = this._get_tag_open_token(raw_token);

  if ((last_tag_token.is_unformatted || last_tag_token.is_content_unformatted) &&
    !last_tag_token.is_empty_element &&
    raw_token.type === TOKEN.TAG_OPEN && raw_token.text.indexOf('</') === 0) {
    // End element tags for unformatted or content_unformatted elements
    // are printed raw to keep any newlines inside them exactly the same.
    printer.add_raw_token(raw_token);
    parser_token.start_tag_token = this._tag_stack.try_pop(parser_token.tag_name);
  } else {
    printer.traverse_whitespace(raw_token);
    this._set_tag_position(printer, raw_token, parser_token, last_tag_token, last_token);
    if (!parser_token.is_inline_element) {
      printer.set_wrap_point();
    }
    printer.print_token(raw_token);
  }

  //indent attributes an auto, forced, aligned or forced-align line-wrap
  if (this._is_wrap_attributes_force_aligned || this._is_wrap_attributes_aligned_multiple || this._is_wrap_attributes_preserve_aligned) {
    parser_token.alignment_size = raw_token.text.length + 1;
  }

  if (!parser_token.tag_complete && !parser_token.is_unformatted) {
    printer.alignment_size = parser_token.alignment_size;
  }

  return parser_token;
};

var TagOpenParserToken = function(parent, raw_token) {
  this.parent = parent || null;
  this.text = '';
  this.type = 'TK_TAG_OPEN';
  this.tag_name = '';
  this.is_inline_element = false;
  this.is_unformatted = false;
  this.is_content_unformatted = false;
  this.is_empty_element = false;
  this.is_start_tag = false;
  this.is_end_tag = false;
  this.indent_content = false;
  this.multiline_content = false;
  this.custom_beautifier_name = null;
  this.start_tag_token = null;
  this.attr_count = 0;
  this.has_wrapped_attrs = false;
  this.alignment_size = 0;
  this.tag_complete = false;
  this.tag_start_char = '';
  this.tag_check = '';

  if (!raw_token) {
    this.tag_complete = true;
  } else {
    var tag_check_match;

    this.tag_start_char = raw_token.text[0];
    this.text = raw_token.text;

    if (this.tag_start_char === '<') {
      tag_check_match = raw_token.text.match(/^<([^\s>]*)/);
      this.tag_check = tag_check_match ? tag_check_match[1] : '';
    } else {
      tag_check_match = raw_token.text.match(/^{{(?:[\^]|#\*?)?([^\s}]+)/);
      this.tag_check = tag_check_match ? tag_check_match[1] : '';

      // handle "{{#> myPartial}}
      if (raw_token.text === '{{#>' && this.tag_check === '>' && raw_token.next !== null) {
        this.tag_check = raw_token.next.text;
      }
    }
    this.tag_check = this.tag_check.toLowerCase();

    if (raw_token.type === TOKEN.COMMENT) {
      this.tag_complete = true;
    }

    this.is_start_tag = this.tag_check.charAt(0) !== '/';
    this.tag_name = !this.is_start_tag ? this.tag_check.substr(1) : this.tag_check;
    this.is_end_tag = !this.is_start_tag ||
      (raw_token.closed && raw_token.closed.text === '/>');

    // handlebars tags that don't start with # or ^ are single_tags, and so also start and end.
    this.is_end_tag = this.is_end_tag ||
      (this.tag_start_char === '{' && (this.text.length < 3 || (/[^#\^]/.test(this.text.charAt(2)))));
  }
};

Beautifier.prototype._get_tag_open_token = function(raw_token) { //function to get a full tag and parse its type
  var parser_token = new TagOpenParserToken(this._tag_stack.get_parser_token(), raw_token);

  parser_token.alignment_size = this._options.wrap_attributes_indent_size;

  parser_token.is_end_tag = parser_token.is_end_tag ||
    in_array(parser_token.tag_check, this._options.void_elements);

  parser_token.is_empty_element = parser_token.tag_complete ||
    (parser_token.is_start_tag && parser_token.is_end_tag);

  parser_token.is_unformatted = !parser_token.tag_complete && in_array(parser_token.tag_check, this._options.unformatted);
  parser_token.is_content_unformatted = !parser_token.is_empty_element && in_array(parser_token.tag_check, this._options.content_unformatted);
  parser_token.is_inline_element = in_array(parser_token.tag_name, this._options.inline) || parser_token.tag_start_char === '{';

  return parser_token;
};

Beautifier.prototype._set_tag_position = function(printer, raw_token, parser_token, last_tag_token, last_token) {

  if (!parser_token.is_empty_element) {
    if (parser_token.is_end_tag) { //this tag is a double tag so check for tag-ending
      parser_token.start_tag_token = this._tag_stack.try_pop(parser_token.tag_name); //remove it and all ancestors
    } else { // it's a start-tag
      // check if this tag is starting an element that has optional end element
      // and do an ending needed
      if (this._do_optional_end_element(parser_token)) {
        if (!parser_token.is_inline_element) {
          printer.print_newline(false);
        }
      }

      this._tag_stack.record_tag(parser_token); //push it on the tag stack

      if ((parser_token.tag_name === 'script' || parser_token.tag_name === 'style') &&
        !(parser_token.is_unformatted || parser_token.is_content_unformatted)) {
        parser_token.custom_beautifier_name = get_custom_beautifier_name(parser_token.tag_check, raw_token);
      }
    }
  }

  if (in_array(parser_token.tag_check, this._options.extra_liners)) { //check if this double needs an extra line
    printer.print_newline(false);
    if (!printer._output.just_added_blankline()) {
      printer.print_newline(true);
    }
  }

  if (parser_token.is_empty_element) { //if this tag name is a single tag type (either in the list or has a closing /)

    // if you hit an else case, reset the indent level if you are inside an:
    // 'if', 'unless', or 'each' block.
    if (parser_token.tag_start_char === '{' && parser_token.tag_check === 'else') {
      this._tag_stack.indent_to_tag(['if', 'unless', 'each']);
      parser_token.indent_content = true;
      // Don't add a newline if opening {{#if}} tag is on the current line
      var foundIfOnCurrentLine = printer.current_line_has_match(/{{#if/);
      if (!foundIfOnCurrentLine) {
        printer.print_newline(false);
      }
    }

    // Don't add a newline before elements that should remain where they are.
    if (parser_token.tag_name === '!--' && last_token.type === TOKEN.TAG_CLOSE &&
      last_tag_token.is_end_tag && parser_token.text.indexOf('\n') === -1) {
      //Do nothing. Leave comments on same line.
    } else {
      if (!(parser_token.is_inline_element || parser_token.is_unformatted)) {
        printer.print_newline(false);
      }
      this._calcluate_parent_multiline(printer, parser_token);
    }
  } else if (parser_token.is_end_tag) { //this tag is a double tag so check for tag-ending
    var do_end_expand = false;

    // deciding whether a block is multiline should not be this hard
    do_end_expand = parser_token.start_tag_token && parser_token.start_tag_token.multiline_content;
    do_end_expand = do_end_expand || (!parser_token.is_inline_element &&
      !(last_tag_token.is_inline_element || last_tag_token.is_unformatted) &&
      !(last_token.type === TOKEN.TAG_CLOSE && parser_token.start_tag_token === last_tag_token) &&
      last_token.type !== 'TK_CONTENT'
    );

    if (parser_token.is_content_unformatted || parser_token.is_unformatted) {
      do_end_expand = false;
    }

    if (do_end_expand) {
      printer.print_newline(false);
    }
  } else { // it's a start-tag
    parser_token.indent_content = !parser_token.custom_beautifier_name;

    if (parser_token.tag_start_char === '<') {
      if (parser_token.tag_name === 'html') {
        parser_token.indent_content = this._options.indent_inner_html;
      } else if (parser_token.tag_name === 'head') {
        parser_token.indent_content = this._options.indent_head_inner_html;
      } else if (parser_token.tag_name === 'body') {
        parser_token.indent_content = this._options.indent_body_inner_html;
      }
    }

    if (!(parser_token.is_inline_element || parser_token.is_unformatted) &&
      (last_token.type !== 'TK_CONTENT' || parser_token.is_content_unformatted)) {
      printer.print_newline(false);
    }

    this._calcluate_parent_multiline(printer, parser_token);
  }
};

Beautifier.prototype._calcluate_parent_multiline = function(printer, parser_token) {
  if (parser_token.parent && printer._output.just_added_newline() &&
    !((parser_token.is_inline_element || parser_token.is_unformatted) && parser_token.parent.is_inline_element)) {
    parser_token.parent.multiline_content = true;
  }
};

//To be used for <p> tag special case:
var p_closers = ['address', 'article', 'aside', 'blockquote', 'details', 'div', 'dl', 'fieldset', 'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'header', 'hr', 'main', 'nav', 'ol', 'p', 'pre', 'section', 'table', 'ul'];
var p_parent_excludes = ['a', 'audio', 'del', 'ins', 'map', 'noscript', 'video'];

Beautifier.prototype._do_optional_end_element = function(parser_token) {
  var result = null;
  // NOTE: cases of "if there is no more content in the parent element"
  // are handled automatically by the beautifier.
  // It assumes parent or ancestor close tag closes all children.
  // https://www.w3.org/TR/html5/syntax.html#optional-tags
  if (parser_token.is_empty_element || !parser_token.is_start_tag || !parser_token.parent) {
    return;

  }

  if (parser_token.tag_name === 'body') {
    // A head element’s end tag may be omitted if the head element is not immediately followed by a space character or a comment.
    result = result || this._tag_stack.try_pop('head');

    //} else if (parser_token.tag_name === 'body') {
    // DONE: A body element’s end tag may be omitted if the body element is not immediately followed by a comment.

  } else if (parser_token.tag_name === 'li') {
    // An li element’s end tag may be omitted if the li element is immediately followed by another li element or if there is no more content in the parent element.
    result = result || this._tag_stack.try_pop('li', ['ol', 'ul']);

  } else if (parser_token.tag_name === 'dd' || parser_token.tag_name === 'dt') {
    // A dd element’s end tag may be omitted if the dd element is immediately followed by another dd element or a dt element, or if there is no more content in the parent element.
    // A dt element’s end tag may be omitted if the dt element is immediately followed by another dt element or a dd element.
    result = result || this._tag_stack.try_pop('dt', ['dl']);
    result = result || this._tag_stack.try_pop('dd', ['dl']);


  } else if (parser_token.parent.tag_name === 'p' && p_closers.indexOf(parser_token.tag_name) !== -1) {
    // IMPORTANT: this else-if works because p_closers has no overlap with any other element we look for in this method
    // check for the parent element is an HTML element that is not an <a>, <audio>, <del>, <ins>, <map>, <noscript>, or <video> element,  or an autonomous custom element.
    // To do this right, this needs to be coded as an inclusion of the inverse of the exclusion above.
    // But to start with (if we ignore "autonomous custom elements") the exclusion would be fine.
    var p_parent = parser_token.parent.parent;
    if (!p_parent || p_parent_excludes.indexOf(p_parent.tag_name) === -1) {
      result = result || this._tag_stack.try_pop('p');
    }
  } else if (parser_token.tag_name === 'rp' || parser_token.tag_name === 'rt') {
    // An rt element’s end tag may be omitted if the rt element is immediately followed by an rt or rp element, or if there is no more content in the parent element.
    // An rp element’s end tag may be omitted if the rp element is immediately followed by an rt or rp element, or if there is no more content in the parent element.
    result = result || this._tag_stack.try_pop('rt', ['ruby', 'rtc']);
    result = result || this._tag_stack.try_pop('rp', ['ruby', 'rtc']);

  } else if (parser_token.tag_name === 'optgroup') {
    // An optgroup element’s end tag may be omitted if the optgroup element is immediately followed by another optgroup element, or if there is no more content in the parent element.
    // An option element’s end tag may be omitted if the option element is immediately followed by another option element, or if it is immediately followed by an optgroup element, or if there is no more content in the parent element.
    result = result || this._tag_stack.try_pop('optgroup', ['select']);
    //result = result || this._tag_stack.try_pop('option', ['select']);

  } else if (parser_token.tag_name === 'option') {
    // An option element’s end tag may be omitted if the option element is immediately followed by another option element, or if it is immediately followed by an optgroup element, or if there is no more content in the parent element.
    result = result || this._tag_stack.try_pop('option', ['select', 'datalist', 'optgroup']);

  } else if (parser_token.tag_name === 'colgroup') {
    // DONE: A colgroup element’s end tag may be omitted if the colgroup element is not immediately followed by a space character or a comment.
    // A caption element's end tag may be ommitted if a colgroup, thead, tfoot, tbody, or tr element is started.
    result = result || this._tag_stack.try_pop('caption', ['table']);

  } else if (parser_token.tag_name === 'thead') {
    // A colgroup element's end tag may be ommitted if a thead, tfoot, tbody, or tr element is started.
    // A caption element's end tag may be ommitted if a colgroup, thead, tfoot, tbody, or tr element is started.
    result = result || this._tag_stack.try_pop('caption', ['table']);
    result = result || this._tag_stack.try_pop('colgroup', ['table']);

    //} else if (parser_token.tag_name === 'caption') {
    // DONE: A caption element’s end tag may be omitted if the caption element is not immediately followed by a space character or a comment.

  } else if (parser_token.tag_name === 'tbody' || parser_token.tag_name === 'tfoot') {
    // A thead element’s end tag may be omitted if the thead element is immediately followed by a tbody or tfoot element.
    // A tbody element’s end tag may be omitted if the tbody element is immediately followed by a tbody or tfoot element, or if there is no more content in the parent element.
    // A colgroup element's end tag may be ommitted if a thead, tfoot, tbody, or tr element is started.
    // A caption element's end tag may be ommitted if a colgroup, thead, tfoot, tbody, or tr element is started.
    result = result || this._tag_stack.try_pop('caption', ['table']);
    result = result || this._tag_stack.try_pop('colgroup', ['table']);
    result = result || this._tag_stack.try_pop('thead', ['table']);
    result = result || this._tag_stack.try_pop('tbody', ['table']);

    //} else if (parser_token.tag_name === 'tfoot') {
    // DONE: A tfoot element’s end tag may be omitted if there is no more content in the parent element.

  } else if (parser_token.tag_name === 'tr') {
    // A tr element’s end tag may be omitted if the tr element is immediately followed by another tr element, or if there is no more content in the parent element.
    // A colgroup element's end tag may be ommitted if a thead, tfoot, tbody, or tr element is started.
    // A caption element's end tag may be ommitted if a colgroup, thead, tfoot, tbody, or tr element is started.
    result = result || this._tag_stack.try_pop('caption', ['table']);
    result = result || this._tag_stack.try_pop('colgroup', ['table']);
    result = result || this._tag_stack.try_pop('tr', ['table', 'thead', 'tbody', 'tfoot']);

  } else if (parser_token.tag_name === 'th' || parser_token.tag_name === 'td') {
    // A td element’s end tag may be omitted if the td element is immediately followed by a td or th element, or if there is no more content in the parent element.
    // A th element’s end tag may be omitted if the th element is immediately followed by a td or th element, or if there is no more content in the parent element.
    result = result || this._tag_stack.try_pop('td', ['table', 'thead', 'tbody', 'tfoot', 'tr']);
    result = result || this._tag_stack.try_pop('th', ['table', 'thead', 'tbody', 'tfoot', 'tr']);
  }

  // Start element omission not handled currently
  // A head element’s start tag may be omitted if the element is empty, or if the first thing inside the head element is an element.
  // A tbody element’s start tag may be omitted if the first thing inside the tbody element is a tr element, and if the element is not immediately preceded by a tbody, thead, or tfoot element whose end tag has been omitted. (It can’t be omitted if the element is empty.)
  // A colgroup element’s start tag may be omitted if the first thing inside the colgroup element is a col element, and if the element is not immediately preceded by another colgroup element whose end tag has been omitted. (It can’t be omitted if the element is empty.)

  // Fix up the parent of the parser token
  parser_token.parent = this._tag_stack.get_parser_token();

  return result;
};

module.exports.Beautifier = Beautifier;


/***/ }),
/* 20 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_90244__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var BaseOptions = __nested_webpack_require_90244__(6).Options;

function Options(options) {
  BaseOptions.call(this, options, 'html');
  if (this.templating.length === 1 && this.templating[0] === 'auto') {
    this.templating = ['django', 'erb', 'handlebars', 'php'];
  }

  this.indent_inner_html = this._get_boolean('indent_inner_html');
  this.indent_body_inner_html = this._get_boolean('indent_body_inner_html', true);
  this.indent_head_inner_html = this._get_boolean('indent_head_inner_html', true);

  this.indent_handlebars = this._get_boolean('indent_handlebars', true);
  this.wrap_attributes = this._get_selection('wrap_attributes',
    ['auto', 'force', 'force-aligned', 'force-expand-multiline', 'aligned-multiple', 'preserve', 'preserve-aligned']);
  this.wrap_attributes_indent_size = this._get_number('wrap_attributes_indent_size', this.indent_size);
  this.extra_liners = this._get_array('extra_liners', ['head', 'body', '/html']);

  // Block vs inline elements
  // https://developer.mozilla.org/en-US/docs/Web/HTML/Block-level_elements
  // https://developer.mozilla.org/en-US/docs/Web/HTML/Inline_elements
  // https://www.w3.org/TR/html5/dom.html#phrasing-content
  this.inline = this._get_array('inline', [
    'a', 'abbr', 'area', 'audio', 'b', 'bdi', 'bdo', 'br', 'button', 'canvas', 'cite',
    'code', 'data', 'datalist', 'del', 'dfn', 'em', 'embed', 'i', 'iframe', 'img',
    'input', 'ins', 'kbd', 'keygen', 'label', 'map', 'mark', 'math', 'meter', 'noscript',
    'object', 'output', 'progress', 'q', 'ruby', 's', 'samp', /* 'script', */ 'select', 'small',
    'span', 'strong', 'sub', 'sup', 'svg', 'template', 'textarea', 'time', 'u', 'var',
    'video', 'wbr', 'text',
    // obsolete inline tags
    'acronym', 'big', 'strike', 'tt'
  ]);
  this.void_elements = this._get_array('void_elements', [
    // HTLM void elements - aka self-closing tags - aka singletons
    // https://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements
    'area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'keygen',
    'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr',
    // NOTE: Optional tags are too complex for a simple list
    // they are hard coded in _do_optional_end_element

    // Doctype and xml elements
    '!doctype', '?xml',

    // obsolete tags
    // basefont: https://www.computerhope.com/jargon/h/html-basefont-tag.htm
    // isndex: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/isindex
    'basefont', 'isindex'
  ]);
  this.unformatted = this._get_array('unformatted', []);
  this.content_unformatted = this._get_array('content_unformatted', [
    'pre', 'textarea'
  ]);
  this.unformatted_content_delimiter = this._get_characters('unformatted_content_delimiter');
  this.indent_scripts = this._get_selection('indent_scripts', ['normal', 'keep', 'separate']);

}
Options.prototype = new BaseOptions();



module.exports.Options = Options;


/***/ }),
/* 21 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_94441__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var BaseTokenizer = __nested_webpack_require_94441__(9).Tokenizer;
var BASETOKEN = __nested_webpack_require_94441__(9).TOKEN;
var Directives = __nested_webpack_require_94441__(13).Directives;
var TemplatablePattern = __nested_webpack_require_94441__(14).TemplatablePattern;
var Pattern = __nested_webpack_require_94441__(12).Pattern;

var TOKEN = {
  TAG_OPEN: 'TK_TAG_OPEN',
  TAG_CLOSE: 'TK_TAG_CLOSE',
  ATTRIBUTE: 'TK_ATTRIBUTE',
  EQUALS: 'TK_EQUALS',
  VALUE: 'TK_VALUE',
  COMMENT: 'TK_COMMENT',
  TEXT: 'TK_TEXT',
  UNKNOWN: 'TK_UNKNOWN',
  START: BASETOKEN.START,
  RAW: BASETOKEN.RAW,
  EOF: BASETOKEN.EOF
};

var directives_core = new Directives(/<\!--/, /-->/);

var Tokenizer = function(input_string, options) {
  BaseTokenizer.call(this, input_string, options);
  this._current_tag_name = '';

  // Words end at whitespace or when a tag starts
  // if we are indenting handlebars, they are considered tags
  var templatable_reader = new TemplatablePattern(this._input).read_options(this._options);
  var pattern_reader = new Pattern(this._input);

  this.__patterns = {
    word: templatable_reader.until(/[\n\r\t <]/),
    single_quote: templatable_reader.until_after(/'/),
    double_quote: templatable_reader.until_after(/"/),
    attribute: templatable_reader.until(/[\n\r\t =>]|\/>/),
    element_name: templatable_reader.until(/[\n\r\t >\/]/),

    handlebars_comment: pattern_reader.starting_with(/{{!--/).until_after(/--}}/),
    handlebars: pattern_reader.starting_with(/{{/).until_after(/}}/),
    handlebars_open: pattern_reader.until(/[\n\r\t }]/),
    handlebars_raw_close: pattern_reader.until(/}}/),
    comment: pattern_reader.starting_with(/<!--/).until_after(/-->/),
    cdata: pattern_reader.starting_with(/<!\[CDATA\[/).until_after(/]]>/),
    // https://en.wikipedia.org/wiki/Conditional_comment
    conditional_comment: pattern_reader.starting_with(/<!\[/).until_after(/]>/),
    processing: pattern_reader.starting_with(/<\?/).until_after(/\?>/)
  };

  if (this._options.indent_handlebars) {
    this.__patterns.word = this.__patterns.word.exclude('handlebars');
  }

  this._unformatted_content_delimiter = null;

  if (this._options.unformatted_content_delimiter) {
    var literal_regexp = this._input.get_literal_regexp(this._options.unformatted_content_delimiter);
    this.__patterns.unformatted_content_delimiter =
      pattern_reader.matching(literal_regexp)
      .until_after(literal_regexp);
  }
};
Tokenizer.prototype = new BaseTokenizer();

Tokenizer.prototype._is_comment = function(current_token) { // jshint unused:false
  return false; //current_token.type === TOKEN.COMMENT || current_token.type === TOKEN.UNKNOWN;
};

Tokenizer.prototype._is_opening = function(current_token) {
  return current_token.type === TOKEN.TAG_OPEN;
};

Tokenizer.prototype._is_closing = function(current_token, open_token) {
  return current_token.type === TOKEN.TAG_CLOSE &&
    (open_token && (
      ((current_token.text === '>' || current_token.text === '/>') && open_token.text[0] === '<') ||
      (current_token.text === '}}' && open_token.text[0] === '{' && open_token.text[1] === '{')));
};

Tokenizer.prototype._reset = function() {
  this._current_tag_name = '';
};

Tokenizer.prototype._get_next_token = function(previous_token, open_token) { // jshint unused:false
  var token = null;
  this._readWhitespace();
  var c = this._input.peek();

  if (c === null) {
    return this._create_token(TOKEN.EOF, '');
  }

  token = token || this._read_open_handlebars(c, open_token);
  token = token || this._read_attribute(c, previous_token, open_token);
  token = token || this._read_close(c, open_token);
  token = token || this._read_raw_content(c, previous_token, open_token);
  token = token || this._read_content_word(c);
  token = token || this._read_comment_or_cdata(c);
  token = token || this._read_processing(c);
  token = token || this._read_open(c, open_token);
  token = token || this._create_token(TOKEN.UNKNOWN, this._input.next());

  return token;
};

Tokenizer.prototype._read_comment_or_cdata = function(c) { // jshint unused:false
  var token = null;
  var resulting_string = null;
  var directives = null;

  if (c === '<') {
    var peek1 = this._input.peek(1);
    // We treat all comments as literals, even more than preformatted tags
    // we only look for the appropriate closing marker
    if (peek1 === '!') {
      resulting_string = this.__patterns.comment.read();

      // only process directive on html comments
      if (resulting_string) {
        directives = directives_core.get_directives(resulting_string);
        if (directives && directives.ignore === 'start') {
          resulting_string += directives_core.readIgnored(this._input);
        }
      } else {
        resulting_string = this.__patterns.cdata.read();
      }
    }

    if (resulting_string) {
      token = this._create_token(TOKEN.COMMENT, resulting_string);
      token.directives = directives;
    }
  }

  return token;
};

Tokenizer.prototype._read_processing = function(c) { // jshint unused:false
  var token = null;
  var resulting_string = null;
  var directives = null;

  if (c === '<') {
    var peek1 = this._input.peek(1);
    if (peek1 === '!' || peek1 === '?') {
      resulting_string = this.__patterns.conditional_comment.read();
      resulting_string = resulting_string || this.__patterns.processing.read();
    }

    if (resulting_string) {
      token = this._create_token(TOKEN.COMMENT, resulting_string);
      token.directives = directives;
    }
  }

  return token;
};

Tokenizer.prototype._read_open = function(c, open_token) {
  var resulting_string = null;
  var token = null;
  if (!open_token) {
    if (c === '<') {

      resulting_string = this._input.next();
      if (this._input.peek() === '/') {
        resulting_string += this._input.next();
      }
      resulting_string += this.__patterns.element_name.read();
      token = this._create_token(TOKEN.TAG_OPEN, resulting_string);
    }
  }
  return token;
};

Tokenizer.prototype._read_open_handlebars = function(c, open_token) {
  var resulting_string = null;
  var token = null;
  if (!open_token) {
    if (this._options.indent_handlebars && c === '{' && this._input.peek(1) === '{') {
      if (this._input.peek(2) === '!') {
        resulting_string = this.__patterns.handlebars_comment.read();
        resulting_string = resulting_string || this.__patterns.handlebars.read();
        token = this._create_token(TOKEN.COMMENT, resulting_string);
      } else {
        resulting_string = this.__patterns.handlebars_open.read();
        token = this._create_token(TOKEN.TAG_OPEN, resulting_string);
      }
    }
  }
  return token;
};


Tokenizer.prototype._read_close = function(c, open_token) {
  var resulting_string = null;
  var token = null;
  if (open_token) {
    if (open_token.text[0] === '<' && (c === '>' || (c === '/' && this._input.peek(1) === '>'))) {
      resulting_string = this._input.next();
      if (c === '/') { //  for close tag "/>"
        resulting_string += this._input.next();
      }
      token = this._create_token(TOKEN.TAG_CLOSE, resulting_string);
    } else if (open_token.text[0] === '{' && c === '}' && this._input.peek(1) === '}') {
      this._input.next();
      this._input.next();
      token = this._create_token(TOKEN.TAG_CLOSE, '}}');
    }
  }

  return token;
};

Tokenizer.prototype._read_attribute = function(c, previous_token, open_token) {
  var token = null;
  var resulting_string = '';
  if (open_token && open_token.text[0] === '<') {

    if (c === '=') {
      token = this._create_token(TOKEN.EQUALS, this._input.next());
    } else if (c === '"' || c === "'") {
      var content = this._input.next();
      if (c === '"') {
        content += this.__patterns.double_quote.read();
      } else {
        content += this.__patterns.single_quote.read();
      }
      token = this._create_token(TOKEN.VALUE, content);
    } else {
      resulting_string = this.__patterns.attribute.read();

      if (resulting_string) {
        if (previous_token.type === TOKEN.EQUALS) {
          token = this._create_token(TOKEN.VALUE, resulting_string);
        } else {
          token = this._create_token(TOKEN.ATTRIBUTE, resulting_string);
        }
      }
    }
  }
  return token;
};

Tokenizer.prototype._is_content_unformatted = function(tag_name) {
  // void_elements have no content and so cannot have unformatted content
  // script and style tags should always be read as unformatted content
  // finally content_unformatted and unformatted element contents are unformatted
  return this._options.void_elements.indexOf(tag_name) === -1 &&
    (this._options.content_unformatted.indexOf(tag_name) !== -1 ||
      this._options.unformatted.indexOf(tag_name) !== -1);
};


Tokenizer.prototype._read_raw_content = function(c, previous_token, open_token) { // jshint unused:false
  var resulting_string = '';
  if (open_token && open_token.text[0] === '{') {
    resulting_string = this.__patterns.handlebars_raw_close.read();
  } else if (previous_token.type === TOKEN.TAG_CLOSE &&
    previous_token.opened.text[0] === '<' && previous_token.text[0] !== '/') {
    // ^^ empty tag has no content 
    var tag_name = previous_token.opened.text.substr(1).toLowerCase();
    if (tag_name === 'script' || tag_name === 'style') {
      // Script and style tags are allowed to have comments wrapping their content
      // or just have regular content.
      var token = this._read_comment_or_cdata(c);
      if (token) {
        token.type = TOKEN.TEXT;
        return token;
      }
      resulting_string = this._input.readUntil(new RegExp('</' + tag_name + '[\\n\\r\\t ]*?>', 'ig'));
    } else if (this._is_content_unformatted(tag_name)) {

      resulting_string = this._input.readUntil(new RegExp('</' + tag_name + '[\\n\\r\\t ]*?>', 'ig'));
    }
  }

  if (resulting_string) {
    return this._create_token(TOKEN.TEXT, resulting_string);
  }

  return null;
};

Tokenizer.prototype._read_content_word = function(c) {
  var resulting_string = '';
  if (this._options.unformatted_content_delimiter) {
    if (c === this._options.unformatted_content_delimiter[0]) {
      resulting_string = this.__patterns.unformatted_content_delimiter.read();
    }
  }

  if (!resulting_string) {
    resulting_string = this.__patterns.word.read();
  }
  if (resulting_string) {
    return this._create_token(TOKEN.TEXT, resulting_string);
  }
};

module.exports.Tokenizer = Tokenizer;
module.exports.TOKEN = TOKEN;


/***/ })
/******/ 	]);
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __nested_webpack_require_106325__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __nested_webpack_require_106325__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __nested_webpack_exports__ = __nested_webpack_require_106325__(18);
/******/ 	legacy_beautify_html = __nested_webpack_exports__;
/******/ 	
/******/ })()
;
var style_html = legacy_beautify_html;
/* Footer */
if (true) {
    // Add support for AMD ( https://github.com/amdjs/amdjs-api/wiki/AMD#defineamd-property- )
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, __webpack_require__(937), __webpack_require__(40)], __WEBPACK_AMD_DEFINE_RESULT__ = (function(requireamd) {
        var js_beautify = __webpack_require__(937);
        var css_beautify = __webpack_require__(40);

        return {
            html_beautify: function(html_source, options) {
                return style_html(html_source, options, js_beautify.js_beautify, css_beautify.css_beautify);
            }
        };
    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
} else { var css_beautify, js_beautify; }

}());


/***/ }),

/***/ 937:
/***/ ((module, exports) => {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* AUTO-GENERATED. DO NOT MODIFY. */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@beautifier.io>
      https://beautifier.io/

  Originally converted to javascript by Vital, <vital76@gmail.com>
  "End braces on own line" added by Chris J. Shull, <chrisjshull@gmail.com>
  Parsing improvements for brace-less statements by Liam Newman <bitwiseman@beautifier.io>


  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          - indentation size,
    indent_char (default space)      - character to indent with,
    preserve_newlines (default true) - whether existing line breaks should be preserved,
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,

    jslint_happy (default false) - if true, then jslint-stricter mode is enforced.

            jslint_happy        !jslint_happy
            ---------------------------------
            function ()         function()

            switch () {         switch() {
            case 1:               case 1:
              break;                break;
            }                   }

    space_after_anon_function (default false) - should the space before an anonymous function's parens be added, "function()" vs "function ()",
          NOTE: This option is overriden by jslint_happy (i.e. if jslint_happy is true, space_after_anon_function is true by design)

    brace_style (default "collapse") - "collapse" | "expand" | "end-expand" | "none" | any of the former + ",preserve-inline"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line, or attempt to keep them where they are.
            preserve-inline will try to preserve inline blocks of curly braces

    space_before_conditional (default true) - should the space before conditional statement be added, "if(true)" vs "if (true)",

    unescape_strings (default false) - should printable characters in strings encoded in \xNN notation be unescaped, "example" vs "\x65\x78\x61\x6d\x70\x6c\x65"

    wrap_line_length (default unlimited) - lines should wrap at next opportunity after this number of characters.
          NOTE: This is not a hard limit. Lines will continue until a point where a newline would
                be preserved if it were present.

    end_with_newline (default false)  - end output with a newline


    e.g

    js_beautify(js_source_text, {
      'indent_size': 1,
      'indent_char': '\t'
    });

*/

(function() {

/* GENERATED_BUILD_OUTPUT */
var legacy_beautify_js;
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ([
/* 0 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_3999__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Beautifier = __nested_webpack_require_3999__(1).Beautifier,
  Options = __nested_webpack_require_3999__(5).Options;

function js_beautify(js_source_text, options) {
  var beautifier = new Beautifier(js_source_text, options);
  return beautifier.beautify();
}

module.exports = js_beautify;
module.exports.defaultOptions = function() {
  return new Options();
};


/***/ }),
/* 1 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_5624__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Output = __nested_webpack_require_5624__(2).Output;
var Token = __nested_webpack_require_5624__(3).Token;
var acorn = __nested_webpack_require_5624__(4);
var Options = __nested_webpack_require_5624__(5).Options;
var Tokenizer = __nested_webpack_require_5624__(7).Tokenizer;
var line_starters = __nested_webpack_require_5624__(7).line_starters;
var positionable_operators = __nested_webpack_require_5624__(7).positionable_operators;
var TOKEN = __nested_webpack_require_5624__(7).TOKEN;


function in_array(what, arr) {
  return arr.indexOf(what) !== -1;
}

function ltrim(s) {
  return s.replace(/^\s+/g, '');
}

function generateMapFromStrings(list) {
  var result = {};
  for (var x = 0; x < list.length; x++) {
    // make the mapped names underscored instead of dash
    result[list[x].replace(/-/g, '_')] = list[x];
  }
  return result;
}

function reserved_word(token, word) {
  return token && token.type === TOKEN.RESERVED && token.text === word;
}

function reserved_array(token, words) {
  return token && token.type === TOKEN.RESERVED && in_array(token.text, words);
}
// Unsure of what they mean, but they work. Worth cleaning up in future.
var special_words = ['case', 'return', 'do', 'if', 'throw', 'else', 'await', 'break', 'continue', 'async'];

var validPositionValues = ['before-newline', 'after-newline', 'preserve-newline'];

// Generate map from array
var OPERATOR_POSITION = generateMapFromStrings(validPositionValues);

var OPERATOR_POSITION_BEFORE_OR_PRESERVE = [OPERATOR_POSITION.before_newline, OPERATOR_POSITION.preserve_newline];

var MODE = {
  BlockStatement: 'BlockStatement', // 'BLOCK'
  Statement: 'Statement', // 'STATEMENT'
  ObjectLiteral: 'ObjectLiteral', // 'OBJECT',
  ArrayLiteral: 'ArrayLiteral', //'[EXPRESSION]',
  ForInitializer: 'ForInitializer', //'(FOR-EXPRESSION)',
  Conditional: 'Conditional', //'(COND-EXPRESSION)',
  Expression: 'Expression' //'(EXPRESSION)'
};

function remove_redundant_indentation(output, frame) {
  // This implementation is effective but has some issues:
  //     - can cause line wrap to happen too soon due to indent removal
  //           after wrap points are calculated
  // These issues are minor compared to ugly indentation.

  if (frame.multiline_frame ||
    frame.mode === MODE.ForInitializer ||
    frame.mode === MODE.Conditional) {
    return;
  }

  // remove one indent from each line inside this section
  output.remove_indent(frame.start_line_index);
}

// we could use just string.split, but
// IE doesn't like returning empty strings
function split_linebreaks(s) {
  //return s.split(/\x0d\x0a|\x0a/);

  s = s.replace(acorn.allLineBreaks, '\n');
  var out = [],
    idx = s.indexOf("\n");
  while (idx !== -1) {
    out.push(s.substring(0, idx));
    s = s.substring(idx + 1);
    idx = s.indexOf("\n");
  }
  if (s.length) {
    out.push(s);
  }
  return out;
}

function is_array(mode) {
  return mode === MODE.ArrayLiteral;
}

function is_expression(mode) {
  return in_array(mode, [MODE.Expression, MODE.ForInitializer, MODE.Conditional]);
}

function all_lines_start_with(lines, c) {
  for (var i = 0; i < lines.length; i++) {
    var line = lines[i].trim();
    if (line.charAt(0) !== c) {
      return false;
    }
  }
  return true;
}

function each_line_matches_indent(lines, indent) {
  var i = 0,
    len = lines.length,
    line;
  for (; i < len; i++) {
    line = lines[i];
    // allow empty lines to pass through
    if (line && line.indexOf(indent) !== 0) {
      return false;
    }
  }
  return true;
}


function Beautifier(source_text, options) {
  options = options || {};
  this._source_text = source_text || '';

  this._output = null;
  this._tokens = null;
  this._last_last_text = null;
  this._flags = null;
  this._previous_flags = null;

  this._flag_store = null;
  this._options = new Options(options);
}

Beautifier.prototype.create_flags = function(flags_base, mode) {
  var next_indent_level = 0;
  if (flags_base) {
    next_indent_level = flags_base.indentation_level;
    if (!this._output.just_added_newline() &&
      flags_base.line_indent_level > next_indent_level) {
      next_indent_level = flags_base.line_indent_level;
    }
  }

  var next_flags = {
    mode: mode,
    parent: flags_base,
    last_token: flags_base ? flags_base.last_token : new Token(TOKEN.START_BLOCK, ''), // last token text
    last_word: flags_base ? flags_base.last_word : '', // last TOKEN.WORD passed
    declaration_statement: false,
    declaration_assignment: false,
    multiline_frame: false,
    inline_frame: false,
    if_block: false,
    else_block: false,
    do_block: false,
    do_while: false,
    import_block: false,
    in_case_statement: false, // switch(..){ INSIDE HERE }
    in_case: false, // we're on the exact line with "case 0:"
    case_body: false, // the indented case-action block
    indentation_level: next_indent_level,
    alignment: 0,
    line_indent_level: flags_base ? flags_base.line_indent_level : next_indent_level,
    start_line_index: this._output.get_line_number(),
    ternary_depth: 0
  };
  return next_flags;
};

Beautifier.prototype._reset = function(source_text) {
  var baseIndentString = source_text.match(/^[\t ]*/)[0];

  this._last_last_text = ''; // pre-last token text
  this._output = new Output(this._options, baseIndentString);

  // If testing the ignore directive, start with output disable set to true
  this._output.raw = this._options.test_output_raw;


  // Stack of parsing/formatting states, including MODE.
  // We tokenize, parse, and output in an almost purely a forward-only stream of token input
  // and formatted output.  This makes the beautifier less accurate than full parsers
  // but also far more tolerant of syntax errors.
  //
  // For example, the default mode is MODE.BlockStatement. If we see a '{' we push a new frame of type
  // MODE.BlockStatement on the the stack, even though it could be object literal.  If we later
  // encounter a ":", we'll switch to to MODE.ObjectLiteral.  If we then see a ";",
  // most full parsers would die, but the beautifier gracefully falls back to
  // MODE.BlockStatement and continues on.
  this._flag_store = [];
  this.set_mode(MODE.BlockStatement);
  var tokenizer = new Tokenizer(source_text, this._options);
  this._tokens = tokenizer.tokenize();
  return source_text;
};

Beautifier.prototype.beautify = function() {
  // if disabled, return the input unchanged.
  if (this._options.disabled) {
    return this._source_text;
  }

  var sweet_code;
  var source_text = this._reset(this._source_text);

  var eol = this._options.eol;
  if (this._options.eol === 'auto') {
    eol = '\n';
    if (source_text && acorn.lineBreak.test(source_text || '')) {
      eol = source_text.match(acorn.lineBreak)[0];
    }
  }

  var current_token = this._tokens.next();
  while (current_token) {
    this.handle_token(current_token);

    this._last_last_text = this._flags.last_token.text;
    this._flags.last_token = current_token;

    current_token = this._tokens.next();
  }

  sweet_code = this._output.get_code(eol);

  return sweet_code;
};

Beautifier.prototype.handle_token = function(current_token, preserve_statement_flags) {
  if (current_token.type === TOKEN.START_EXPR) {
    this.handle_start_expr(current_token);
  } else if (current_token.type === TOKEN.END_EXPR) {
    this.handle_end_expr(current_token);
  } else if (current_token.type === TOKEN.START_BLOCK) {
    this.handle_start_block(current_token);
  } else if (current_token.type === TOKEN.END_BLOCK) {
    this.handle_end_block(current_token);
  } else if (current_token.type === TOKEN.WORD) {
    this.handle_word(current_token);
  } else if (current_token.type === TOKEN.RESERVED) {
    this.handle_word(current_token);
  } else if (current_token.type === TOKEN.SEMICOLON) {
    this.handle_semicolon(current_token);
  } else if (current_token.type === TOKEN.STRING) {
    this.handle_string(current_token);
  } else if (current_token.type === TOKEN.EQUALS) {
    this.handle_equals(current_token);
  } else if (current_token.type === TOKEN.OPERATOR) {
    this.handle_operator(current_token);
  } else if (current_token.type === TOKEN.COMMA) {
    this.handle_comma(current_token);
  } else if (current_token.type === TOKEN.BLOCK_COMMENT) {
    this.handle_block_comment(current_token, preserve_statement_flags);
  } else if (current_token.type === TOKEN.COMMENT) {
    this.handle_comment(current_token, preserve_statement_flags);
  } else if (current_token.type === TOKEN.DOT) {
    this.handle_dot(current_token);
  } else if (current_token.type === TOKEN.EOF) {
    this.handle_eof(current_token);
  } else if (current_token.type === TOKEN.UNKNOWN) {
    this.handle_unknown(current_token, preserve_statement_flags);
  } else {
    this.handle_unknown(current_token, preserve_statement_flags);
  }
};

Beautifier.prototype.handle_whitespace_and_comments = function(current_token, preserve_statement_flags) {
  var newlines = current_token.newlines;
  var keep_whitespace = this._options.keep_array_indentation && is_array(this._flags.mode);

  if (current_token.comments_before) {
    var comment_token = current_token.comments_before.next();
    while (comment_token) {
      // The cleanest handling of inline comments is to treat them as though they aren't there.
      // Just continue formatting and the behavior should be logical.
      // Also ignore unknown tokens.  Again, this should result in better behavior.
      this.handle_whitespace_and_comments(comment_token, preserve_statement_flags);
      this.handle_token(comment_token, preserve_statement_flags);
      comment_token = current_token.comments_before.next();
    }
  }

  if (keep_whitespace) {
    for (var i = 0; i < newlines; i += 1) {
      this.print_newline(i > 0, preserve_statement_flags);
    }
  } else {
    if (this._options.max_preserve_newlines && newlines > this._options.max_preserve_newlines) {
      newlines = this._options.max_preserve_newlines;
    }

    if (this._options.preserve_newlines) {
      if (newlines > 1) {
        this.print_newline(false, preserve_statement_flags);
        for (var j = 1; j < newlines; j += 1) {
          this.print_newline(true, preserve_statement_flags);
        }
      }
    }
  }

};

var newline_restricted_tokens = ['async', 'break', 'continue', 'return', 'throw', 'yield'];

Beautifier.prototype.allow_wrap_or_preserved_newline = function(current_token, force_linewrap) {
  force_linewrap = (force_linewrap === undefined) ? false : force_linewrap;

  // Never wrap the first token on a line
  if (this._output.just_added_newline()) {
    return;
  }

  var shouldPreserveOrForce = (this._options.preserve_newlines && current_token.newlines) || force_linewrap;
  var operatorLogicApplies = in_array(this._flags.last_token.text, positionable_operators) ||
    in_array(current_token.text, positionable_operators);

  if (operatorLogicApplies) {
    var shouldPrintOperatorNewline = (
        in_array(this._flags.last_token.text, positionable_operators) &&
        in_array(this._options.operator_position, OPERATOR_POSITION_BEFORE_OR_PRESERVE)
      ) ||
      in_array(current_token.text, positionable_operators);
    shouldPreserveOrForce = shouldPreserveOrForce && shouldPrintOperatorNewline;
  }

  if (shouldPreserveOrForce) {
    this.print_newline(false, true);
  } else if (this._options.wrap_line_length) {
    if (reserved_array(this._flags.last_token, newline_restricted_tokens)) {
      // These tokens should never have a newline inserted
      // between them and the following expression.
      return;
    }
    this._output.set_wrap_point();
  }
};

Beautifier.prototype.print_newline = function(force_newline, preserve_statement_flags) {
  if (!preserve_statement_flags) {
    if (this._flags.last_token.text !== ';' && this._flags.last_token.text !== ',' && this._flags.last_token.text !== '=' && (this._flags.last_token.type !== TOKEN.OPERATOR || this._flags.last_token.text === '--' || this._flags.last_token.text === '++')) {
      var next_token = this._tokens.peek();
      while (this._flags.mode === MODE.Statement &&
        !(this._flags.if_block && reserved_word(next_token, 'else')) &&
        !this._flags.do_block) {
        this.restore_mode();
      }
    }
  }

  if (this._output.add_new_line(force_newline)) {
    this._flags.multiline_frame = true;
  }
};

Beautifier.prototype.print_token_line_indentation = function(current_token) {
  if (this._output.just_added_newline()) {
    if (this._options.keep_array_indentation &&
      current_token.newlines &&
      (current_token.text === '[' || is_array(this._flags.mode))) {
      this._output.current_line.set_indent(-1);
      this._output.current_line.push(current_token.whitespace_before);
      this._output.space_before_token = false;
    } else if (this._output.set_indent(this._flags.indentation_level, this._flags.alignment)) {
      this._flags.line_indent_level = this._flags.indentation_level;
    }
  }
};

Beautifier.prototype.print_token = function(current_token) {
  if (this._output.raw) {
    this._output.add_raw_token(current_token);
    return;
  }

  if (this._options.comma_first && current_token.previous && current_token.previous.type === TOKEN.COMMA &&
    this._output.just_added_newline()) {
    if (this._output.previous_line.last() === ',') {
      var popped = this._output.previous_line.pop();
      // if the comma was already at the start of the line,
      // pull back onto that line and reprint the indentation
      if (this._output.previous_line.is_empty()) {
        this._output.previous_line.push(popped);
        this._output.trim(true);
        this._output.current_line.pop();
        this._output.trim();
      }

      // add the comma in front of the next token
      this.print_token_line_indentation(current_token);
      this._output.add_token(',');
      this._output.space_before_token = true;
    }
  }

  this.print_token_line_indentation(current_token);
  this._output.non_breaking_space = true;
  this._output.add_token(current_token.text);
  if (this._output.previous_token_wrapped) {
    this._flags.multiline_frame = true;
  }
};

Beautifier.prototype.indent = function() {
  this._flags.indentation_level += 1;
  this._output.set_indent(this._flags.indentation_level, this._flags.alignment);
};

Beautifier.prototype.deindent = function() {
  if (this._flags.indentation_level > 0 &&
    ((!this._flags.parent) || this._flags.indentation_level > this._flags.parent.indentation_level)) {
    this._flags.indentation_level -= 1;
    this._output.set_indent(this._flags.indentation_level, this._flags.alignment);
  }
};

Beautifier.prototype.set_mode = function(mode) {
  if (this._flags) {
    this._flag_store.push(this._flags);
    this._previous_flags = this._flags;
  } else {
    this._previous_flags = this.create_flags(null, mode);
  }

  this._flags = this.create_flags(this._previous_flags, mode);
  this._output.set_indent(this._flags.indentation_level, this._flags.alignment);
};


Beautifier.prototype.restore_mode = function() {
  if (this._flag_store.length > 0) {
    this._previous_flags = this._flags;
    this._flags = this._flag_store.pop();
    if (this._previous_flags.mode === MODE.Statement) {
      remove_redundant_indentation(this._output, this._previous_flags);
    }
    this._output.set_indent(this._flags.indentation_level, this._flags.alignment);
  }
};

Beautifier.prototype.start_of_object_property = function() {
  return this._flags.parent.mode === MODE.ObjectLiteral && this._flags.mode === MODE.Statement && (
    (this._flags.last_token.text === ':' && this._flags.ternary_depth === 0) || (reserved_array(this._flags.last_token, ['get', 'set'])));
};

Beautifier.prototype.start_of_statement = function(current_token) {
  var start = false;
  start = start || reserved_array(this._flags.last_token, ['var', 'let', 'const']) && current_token.type === TOKEN.WORD;
  start = start || reserved_word(this._flags.last_token, 'do');
  start = start || (!(this._flags.parent.mode === MODE.ObjectLiteral && this._flags.mode === MODE.Statement)) && reserved_array(this._flags.last_token, newline_restricted_tokens) && !current_token.newlines;
  start = start || reserved_word(this._flags.last_token, 'else') &&
    !(reserved_word(current_token, 'if') && !current_token.comments_before);
  start = start || (this._flags.last_token.type === TOKEN.END_EXPR && (this._previous_flags.mode === MODE.ForInitializer || this._previous_flags.mode === MODE.Conditional));
  start = start || (this._flags.last_token.type === TOKEN.WORD && this._flags.mode === MODE.BlockStatement &&
    !this._flags.in_case &&
    !(current_token.text === '--' || current_token.text === '++') &&
    this._last_last_text !== 'function' &&
    current_token.type !== TOKEN.WORD && current_token.type !== TOKEN.RESERVED);
  start = start || (this._flags.mode === MODE.ObjectLiteral && (
    (this._flags.last_token.text === ':' && this._flags.ternary_depth === 0) || reserved_array(this._flags.last_token, ['get', 'set'])));

  if (start) {
    this.set_mode(MODE.Statement);
    this.indent();

    this.handle_whitespace_and_comments(current_token, true);

    // Issue #276:
    // If starting a new statement with [if, for, while, do], push to a new line.
    // if (a) if (b) if(c) d(); else e(); else f();
    if (!this.start_of_object_property()) {
      this.allow_wrap_or_preserved_newline(current_token,
        reserved_array(current_token, ['do', 'for', 'if', 'while']));
    }
    return true;
  }
  return false;
};

Beautifier.prototype.handle_start_expr = function(current_token) {
  // The conditional starts the statement if appropriate.
  if (!this.start_of_statement(current_token)) {
    this.handle_whitespace_and_comments(current_token);
  }

  var next_mode = MODE.Expression;
  if (current_token.text === '[') {

    if (this._flags.last_token.type === TOKEN.WORD || this._flags.last_token.text === ')') {
      // this is array index specifier, break immediately
      // a[x], fn()[x]
      if (reserved_array(this._flags.last_token, line_starters)) {
        this._output.space_before_token = true;
      }
      this.print_token(current_token);
      this.set_mode(next_mode);
      this.indent();
      if (this._options.space_in_paren) {
        this._output.space_before_token = true;
      }
      return;
    }

    next_mode = MODE.ArrayLiteral;
    if (is_array(this._flags.mode)) {
      if (this._flags.last_token.text === '[' ||
        (this._flags.last_token.text === ',' && (this._last_last_text === ']' || this._last_last_text === '}'))) {
        // ], [ goes to new line
        // }, [ goes to new line
        if (!this._options.keep_array_indentation) {
          this.print_newline();
        }
      }
    }

    if (!in_array(this._flags.last_token.type, [TOKEN.START_EXPR, TOKEN.END_EXPR, TOKEN.WORD, TOKEN.OPERATOR, TOKEN.DOT])) {
      this._output.space_before_token = true;
    }
  } else {
    if (this._flags.last_token.type === TOKEN.RESERVED) {
      if (this._flags.last_token.text === 'for') {
        this._output.space_before_token = this._options.space_before_conditional;
        next_mode = MODE.ForInitializer;
      } else if (in_array(this._flags.last_token.text, ['if', 'while', 'switch'])) {
        this._output.space_before_token = this._options.space_before_conditional;
        next_mode = MODE.Conditional;
      } else if (in_array(this._flags.last_word, ['await', 'async'])) {
        // Should be a space between await and an IIFE, or async and an arrow function
        this._output.space_before_token = true;
      } else if (this._flags.last_token.text === 'import' && current_token.whitespace_before === '') {
        this._output.space_before_token = false;
      } else if (in_array(this._flags.last_token.text, line_starters) || this._flags.last_token.text === 'catch') {
        this._output.space_before_token = true;
      }
    } else if (this._flags.last_token.type === TOKEN.EQUALS || this._flags.last_token.type === TOKEN.OPERATOR) {
      // Support of this kind of newline preservation.
      // a = (b &&
      //     (c || d));
      if (!this.start_of_object_property()) {
        this.allow_wrap_or_preserved_newline(current_token);
      }
    } else if (this._flags.last_token.type === TOKEN.WORD) {
      this._output.space_before_token = false;

      // function name() vs function name ()
      // function* name() vs function* name ()
      // async name() vs async name ()
      // In ES6, you can also define the method properties of an object
      // var obj = {a: function() {}}
      // It can be abbreviated
      // var obj = {a() {}}
      // var obj = { a() {}} vs var obj = { a () {}}
      // var obj = { * a() {}} vs var obj = { * a () {}}
      var peek_back_two = this._tokens.peek(-3);
      if (this._options.space_after_named_function && peek_back_two) {
        // peek starts at next character so -1 is current token
        var peek_back_three = this._tokens.peek(-4);
        if (reserved_array(peek_back_two, ['async', 'function']) ||
          (peek_back_two.text === '*' && reserved_array(peek_back_three, ['async', 'function']))) {
          this._output.space_before_token = true;
        } else if (this._flags.mode === MODE.ObjectLiteral) {
          if ((peek_back_two.text === '{' || peek_back_two.text === ',') ||
            (peek_back_two.text === '*' && (peek_back_three.text === '{' || peek_back_three.text === ','))) {
            this._output.space_before_token = true;
          }
        }
      }
    } else {
      // Support preserving wrapped arrow function expressions
      // a.b('c',
      //     () => d.e
      // )
      this.allow_wrap_or_preserved_newline(current_token);
    }

    // function() vs function ()
    // yield*() vs yield* ()
    // function*() vs function* ()
    if ((this._flags.last_token.type === TOKEN.RESERVED && (this._flags.last_word === 'function' || this._flags.last_word === 'typeof')) ||
      (this._flags.last_token.text === '*' &&
        (in_array(this._last_last_text, ['function', 'yield']) ||
          (this._flags.mode === MODE.ObjectLiteral && in_array(this._last_last_text, ['{', ',']))))) {
      this._output.space_before_token = this._options.space_after_anon_function;
    }
  }

  if (this._flags.last_token.text === ';' || this._flags.last_token.type === TOKEN.START_BLOCK) {
    this.print_newline();
  } else if (this._flags.last_token.type === TOKEN.END_EXPR || this._flags.last_token.type === TOKEN.START_EXPR || this._flags.last_token.type === TOKEN.END_BLOCK || this._flags.last_token.text === '.' || this._flags.last_token.type === TOKEN.COMMA) {
    // do nothing on (( and )( and ][ and ]( and .(
    // TODO: Consider whether forcing this is required.  Review failing tests when removed.
    this.allow_wrap_or_preserved_newline(current_token, current_token.newlines);
  }

  this.print_token(current_token);
  this.set_mode(next_mode);
  if (this._options.space_in_paren) {
    this._output.space_before_token = true;
  }

  // In all cases, if we newline while inside an expression it should be indented.
  this.indent();
};

Beautifier.prototype.handle_end_expr = function(current_token) {
  // statements inside expressions are not valid syntax, but...
  // statements must all be closed when their container closes
  while (this._flags.mode === MODE.Statement) {
    this.restore_mode();
  }

  this.handle_whitespace_and_comments(current_token);

  if (this._flags.multiline_frame) {
    this.allow_wrap_or_preserved_newline(current_token,
      current_token.text === ']' && is_array(this._flags.mode) && !this._options.keep_array_indentation);
  }

  if (this._options.space_in_paren) {
    if (this._flags.last_token.type === TOKEN.START_EXPR && !this._options.space_in_empty_paren) {
      // () [] no inner space in empty parens like these, ever, ref #320
      this._output.trim();
      this._output.space_before_token = false;
    } else {
      this._output.space_before_token = true;
    }
  }
  this.deindent();
  this.print_token(current_token);
  this.restore_mode();

  remove_redundant_indentation(this._output, this._previous_flags);

  // do {} while () // no statement required after
  if (this._flags.do_while && this._previous_flags.mode === MODE.Conditional) {
    this._previous_flags.mode = MODE.Expression;
    this._flags.do_block = false;
    this._flags.do_while = false;

  }
};

Beautifier.prototype.handle_start_block = function(current_token) {
  this.handle_whitespace_and_comments(current_token);

  // Check if this is should be treated as a ObjectLiteral
  var next_token = this._tokens.peek();
  var second_token = this._tokens.peek(1);
  if (this._flags.last_word === 'switch' && this._flags.last_token.type === TOKEN.END_EXPR) {
    this.set_mode(MODE.BlockStatement);
    this._flags.in_case_statement = true;
  } else if (this._flags.case_body) {
    this.set_mode(MODE.BlockStatement);
  } else if (second_token && (
      (in_array(second_token.text, [':', ',']) && in_array(next_token.type, [TOKEN.STRING, TOKEN.WORD, TOKEN.RESERVED])) ||
      (in_array(next_token.text, ['get', 'set', '...']) && in_array(second_token.type, [TOKEN.WORD, TOKEN.RESERVED]))
    )) {
    // We don't support TypeScript,but we didn't break it for a very long time.
    // We'll try to keep not breaking it.
    if (!in_array(this._last_last_text, ['class', 'interface'])) {
      this.set_mode(MODE.ObjectLiteral);
    } else {
      this.set_mode(MODE.BlockStatement);
    }
  } else if (this._flags.last_token.type === TOKEN.OPERATOR && this._flags.last_token.text === '=>') {
    // arrow function: (param1, paramN) => { statements }
    this.set_mode(MODE.BlockStatement);
  } else if (in_array(this._flags.last_token.type, [TOKEN.EQUALS, TOKEN.START_EXPR, TOKEN.COMMA, TOKEN.OPERATOR]) ||
    reserved_array(this._flags.last_token, ['return', 'throw', 'import', 'default'])
  ) {
    // Detecting shorthand function syntax is difficult by scanning forward,
    //     so check the surrounding context.
    // If the block is being returned, imported, export default, passed as arg,
    //     assigned with = or assigned in a nested object, treat as an ObjectLiteral.
    this.set_mode(MODE.ObjectLiteral);
  } else {
    this.set_mode(MODE.BlockStatement);
  }

  var empty_braces = !next_token.comments_before && next_token.text === '}';
  var empty_anonymous_function = empty_braces && this._flags.last_word === 'function' &&
    this._flags.last_token.type === TOKEN.END_EXPR;

  if (this._options.brace_preserve_inline) // check for inline, set inline_frame if so
  {
    // search forward for a newline wanted inside this block
    var index = 0;
    var check_token = null;
    this._flags.inline_frame = true;
    do {
      index += 1;
      check_token = this._tokens.peek(index - 1);
      if (check_token.newlines) {
        this._flags.inline_frame = false;
        break;
      }
    } while (check_token.type !== TOKEN.EOF &&
      !(check_token.type === TOKEN.END_BLOCK && check_token.opened === current_token));
  }

  if ((this._options.brace_style === "expand" ||
      (this._options.brace_style === "none" && current_token.newlines)) &&
    !this._flags.inline_frame) {
    if (this._flags.last_token.type !== TOKEN.OPERATOR &&
      (empty_anonymous_function ||
        this._flags.last_token.type === TOKEN.EQUALS ||
        (reserved_array(this._flags.last_token, special_words) && this._flags.last_token.text !== 'else'))) {
      this._output.space_before_token = true;
    } else {
      this.print_newline(false, true);
    }
  } else { // collapse || inline_frame
    if (is_array(this._previous_flags.mode) && (this._flags.last_token.type === TOKEN.START_EXPR || this._flags.last_token.type === TOKEN.COMMA)) {
      if (this._flags.last_token.type === TOKEN.COMMA || this._options.space_in_paren) {
        this._output.space_before_token = true;
      }

      if (this._flags.last_token.type === TOKEN.COMMA || (this._flags.last_token.type === TOKEN.START_EXPR && this._flags.inline_frame)) {
        this.allow_wrap_or_preserved_newline(current_token);
        this._previous_flags.multiline_frame = this._previous_flags.multiline_frame || this._flags.multiline_frame;
        this._flags.multiline_frame = false;
      }
    }
    if (this._flags.last_token.type !== TOKEN.OPERATOR && this._flags.last_token.type !== TOKEN.START_EXPR) {
      if (this._flags.last_token.type === TOKEN.START_BLOCK && !this._flags.inline_frame) {
        this.print_newline();
      } else {
        this._output.space_before_token = true;
      }
    }
  }
  this.print_token(current_token);
  this.indent();

  // Except for specific cases, open braces are followed by a new line.
  if (!empty_braces && !(this._options.brace_preserve_inline && this._flags.inline_frame)) {
    this.print_newline();
  }
};

Beautifier.prototype.handle_end_block = function(current_token) {
  // statements must all be closed when their container closes
  this.handle_whitespace_and_comments(current_token);

  while (this._flags.mode === MODE.Statement) {
    this.restore_mode();
  }

  var empty_braces = this._flags.last_token.type === TOKEN.START_BLOCK;

  if (this._flags.inline_frame && !empty_braces) { // try inline_frame (only set if this._options.braces-preserve-inline) first
    this._output.space_before_token = true;
  } else if (this._options.brace_style === "expand") {
    if (!empty_braces) {
      this.print_newline();
    }
  } else {
    // skip {}
    if (!empty_braces) {
      if (is_array(this._flags.mode) && this._options.keep_array_indentation) {
        // we REALLY need a newline here, but newliner would skip that
        this._options.keep_array_indentation = false;
        this.print_newline();
        this._options.keep_array_indentation = true;

      } else {
        this.print_newline();
      }
    }
  }
  this.restore_mode();
  this.print_token(current_token);
};

Beautifier.prototype.handle_word = function(current_token) {
  if (current_token.type === TOKEN.RESERVED) {
    if (in_array(current_token.text, ['set', 'get']) && this._flags.mode !== MODE.ObjectLiteral) {
      current_token.type = TOKEN.WORD;
    } else if (current_token.text === 'import' && this._tokens.peek().text === '(') {
      current_token.type = TOKEN.WORD;
    } else if (in_array(current_token.text, ['as', 'from']) && !this._flags.import_block) {
      current_token.type = TOKEN.WORD;
    } else if (this._flags.mode === MODE.ObjectLiteral) {
      var next_token = this._tokens.peek();
      if (next_token.text === ':') {
        current_token.type = TOKEN.WORD;
      }
    }
  }

  if (this.start_of_statement(current_token)) {
    // The conditional starts the statement if appropriate.
    if (reserved_array(this._flags.last_token, ['var', 'let', 'const']) && current_token.type === TOKEN.WORD) {
      this._flags.declaration_statement = true;
    }
  } else if (current_token.newlines && !is_expression(this._flags.mode) &&
    (this._flags.last_token.type !== TOKEN.OPERATOR || (this._flags.last_token.text === '--' || this._flags.last_token.text === '++')) &&
    this._flags.last_token.type !== TOKEN.EQUALS &&
    (this._options.preserve_newlines || !reserved_array(this._flags.last_token, ['var', 'let', 'const', 'set', 'get']))) {
    this.handle_whitespace_and_comments(current_token);
    this.print_newline();
  } else {
    this.handle_whitespace_and_comments(current_token);
  }

  if (this._flags.do_block && !this._flags.do_while) {
    if (reserved_word(current_token, 'while')) {
      // do {} ## while ()
      this._output.space_before_token = true;
      this.print_token(current_token);
      this._output.space_before_token = true;
      this._flags.do_while = true;
      return;
    } else {
      // do {} should always have while as the next word.
      // if we don't see the expected while, recover
      this.print_newline();
      this._flags.do_block = false;
    }
  }

  // if may be followed by else, or not
  // Bare/inline ifs are tricky
  // Need to unwind the modes correctly: if (a) if (b) c(); else d(); else e();
  if (this._flags.if_block) {
    if (!this._flags.else_block && reserved_word(current_token, 'else')) {
      this._flags.else_block = true;
    } else {
      while (this._flags.mode === MODE.Statement) {
        this.restore_mode();
      }
      this._flags.if_block = false;
      this._flags.else_block = false;
    }
  }

  if (this._flags.in_case_statement && reserved_array(current_token, ['case', 'default'])) {
    this.print_newline();
    if (this._flags.last_token.type !== TOKEN.END_BLOCK && (this._flags.case_body || this._options.jslint_happy)) {
      // switch cases following one another
      this.deindent();
    }
    this._flags.case_body = false;

    this.print_token(current_token);
    this._flags.in_case = true;
    return;
  }

  if (this._flags.last_token.type === TOKEN.COMMA || this._flags.last_token.type === TOKEN.START_EXPR || this._flags.last_token.type === TOKEN.EQUALS || this._flags.last_token.type === TOKEN.OPERATOR) {
    if (!this.start_of_object_property()) {
      this.allow_wrap_or_preserved_newline(current_token);
    }
  }

  if (reserved_word(current_token, 'function')) {
    if (in_array(this._flags.last_token.text, ['}', ';']) ||
      (this._output.just_added_newline() && !(in_array(this._flags.last_token.text, ['(', '[', '{', ':', '=', ',']) || this._flags.last_token.type === TOKEN.OPERATOR))) {
      // make sure there is a nice clean space of at least one blank line
      // before a new function definition
      if (!this._output.just_added_blankline() && !current_token.comments_before) {
        this.print_newline();
        this.print_newline(true);
      }
    }
    if (this._flags.last_token.type === TOKEN.RESERVED || this._flags.last_token.type === TOKEN.WORD) {
      if (reserved_array(this._flags.last_token, ['get', 'set', 'new', 'export']) ||
        reserved_array(this._flags.last_token, newline_restricted_tokens)) {
        this._output.space_before_token = true;
      } else if (reserved_word(this._flags.last_token, 'default') && this._last_last_text === 'export') {
        this._output.space_before_token = true;
      } else if (this._flags.last_token.text === 'declare') {
        // accomodates Typescript declare function formatting
        this._output.space_before_token = true;
      } else {
        this.print_newline();
      }
    } else if (this._flags.last_token.type === TOKEN.OPERATOR || this._flags.last_token.text === '=') {
      // foo = function
      this._output.space_before_token = true;
    } else if (!this._flags.multiline_frame && (is_expression(this._flags.mode) || is_array(this._flags.mode))) {
      // (function
    } else {
      this.print_newline();
    }

    this.print_token(current_token);
    this._flags.last_word = current_token.text;
    return;
  }

  var prefix = 'NONE';

  if (this._flags.last_token.type === TOKEN.END_BLOCK) {

    if (this._previous_flags.inline_frame) {
      prefix = 'SPACE';
    } else if (!reserved_array(current_token, ['else', 'catch', 'finally', 'from'])) {
      prefix = 'NEWLINE';
    } else {
      if (this._options.brace_style === "expand" ||
        this._options.brace_style === "end-expand" ||
        (this._options.brace_style === "none" && current_token.newlines)) {
        prefix = 'NEWLINE';
      } else {
        prefix = 'SPACE';
        this._output.space_before_token = true;
      }
    }
  } else if (this._flags.last_token.type === TOKEN.SEMICOLON && this._flags.mode === MODE.BlockStatement) {
    // TODO: Should this be for STATEMENT as well?
    prefix = 'NEWLINE';
  } else if (this._flags.last_token.type === TOKEN.SEMICOLON && is_expression(this._flags.mode)) {
    prefix = 'SPACE';
  } else if (this._flags.last_token.type === TOKEN.STRING) {
    prefix = 'NEWLINE';
  } else if (this._flags.last_token.type === TOKEN.RESERVED || this._flags.last_token.type === TOKEN.WORD ||
    (this._flags.last_token.text === '*' &&
      (in_array(this._last_last_text, ['function', 'yield']) ||
        (this._flags.mode === MODE.ObjectLiteral && in_array(this._last_last_text, ['{', ',']))))) {
    prefix = 'SPACE';
  } else if (this._flags.last_token.type === TOKEN.START_BLOCK) {
    if (this._flags.inline_frame) {
      prefix = 'SPACE';
    } else {
      prefix = 'NEWLINE';
    }
  } else if (this._flags.last_token.type === TOKEN.END_EXPR) {
    this._output.space_before_token = true;
    prefix = 'NEWLINE';
  }

  if (reserved_array(current_token, line_starters) && this._flags.last_token.text !== ')') {
    if (this._flags.inline_frame || this._flags.last_token.text === 'else' || this._flags.last_token.text === 'export') {
      prefix = 'SPACE';
    } else {
      prefix = 'NEWLINE';
    }

  }

  if (reserved_array(current_token, ['else', 'catch', 'finally'])) {
    if ((!(this._flags.last_token.type === TOKEN.END_BLOCK && this._previous_flags.mode === MODE.BlockStatement) ||
        this._options.brace_style === "expand" ||
        this._options.brace_style === "end-expand" ||
        (this._options.brace_style === "none" && current_token.newlines)) &&
      !this._flags.inline_frame) {
      this.print_newline();
    } else {
      this._output.trim(true);
      var line = this._output.current_line;
      // If we trimmed and there's something other than a close block before us
      // put a newline back in.  Handles '} // comment' scenario.
      if (line.last() !== '}') {
        this.print_newline();
      }
      this._output.space_before_token = true;
    }
  } else if (prefix === 'NEWLINE') {
    if (reserved_array(this._flags.last_token, special_words)) {
      // no newline between 'return nnn'
      this._output.space_before_token = true;
    } else if (this._flags.last_token.text === 'declare' && reserved_array(current_token, ['var', 'let', 'const'])) {
      // accomodates Typescript declare formatting
      this._output.space_before_token = true;
    } else if (this._flags.last_token.type !== TOKEN.END_EXPR) {
      if ((this._flags.last_token.type !== TOKEN.START_EXPR || !reserved_array(current_token, ['var', 'let', 'const'])) && this._flags.last_token.text !== ':') {
        // no need to force newline on 'var': for (var x = 0...)
        if (reserved_word(current_token, 'if') && reserved_word(current_token.previous, 'else')) {
          // no newline for } else if {
          this._output.space_before_token = true;
        } else {
          this.print_newline();
        }
      }
    } else if (reserved_array(current_token, line_starters) && this._flags.last_token.text !== ')') {
      this.print_newline();
    }
  } else if (this._flags.multiline_frame && is_array(this._flags.mode) && this._flags.last_token.text === ',' && this._last_last_text === '}') {
    this.print_newline(); // }, in lists get a newline treatment
  } else if (prefix === 'SPACE') {
    this._output.space_before_token = true;
  }
  if (current_token.previous && (current_token.previous.type === TOKEN.WORD || current_token.previous.type === TOKEN.RESERVED)) {
    this._output.space_before_token = true;
  }
  this.print_token(current_token);
  this._flags.last_word = current_token.text;

  if (current_token.type === TOKEN.RESERVED) {
    if (current_token.text === 'do') {
      this._flags.do_block = true;
    } else if (current_token.text === 'if') {
      this._flags.if_block = true;
    } else if (current_token.text === 'import') {
      this._flags.import_block = true;
    } else if (this._flags.import_block && reserved_word(current_token, 'from')) {
      this._flags.import_block = false;
    }
  }
};

Beautifier.prototype.handle_semicolon = function(current_token) {
  if (this.start_of_statement(current_token)) {
    // The conditional starts the statement if appropriate.
    // Semicolon can be the start (and end) of a statement
    this._output.space_before_token = false;
  } else {
    this.handle_whitespace_and_comments(current_token);
  }

  var next_token = this._tokens.peek();
  while (this._flags.mode === MODE.Statement &&
    !(this._flags.if_block && reserved_word(next_token, 'else')) &&
    !this._flags.do_block) {
    this.restore_mode();
  }

  // hacky but effective for the moment
  if (this._flags.import_block) {
    this._flags.import_block = false;
  }
  this.print_token(current_token);
};

Beautifier.prototype.handle_string = function(current_token) {
  if (current_token.text.startsWith("`") && current_token.newlines === 0 && current_token.whitespace_before === '' && (current_token.previous.text === ')' || this._flags.last_token.type === TOKEN.WORD)) {
    //Conditional for detectign backtick strings
  } else if (this.start_of_statement(current_token)) {
    // The conditional starts the statement if appropriate.
    // One difference - strings want at least a space before
    this._output.space_before_token = true;
  } else {
    this.handle_whitespace_and_comments(current_token);
    if (this._flags.last_token.type === TOKEN.RESERVED || this._flags.last_token.type === TOKEN.WORD || this._flags.inline_frame) {
      this._output.space_before_token = true;
    } else if (this._flags.last_token.type === TOKEN.COMMA || this._flags.last_token.type === TOKEN.START_EXPR || this._flags.last_token.type === TOKEN.EQUALS || this._flags.last_token.type === TOKEN.OPERATOR) {
      if (!this.start_of_object_property()) {
        this.allow_wrap_or_preserved_newline(current_token);
      }
    } else if ((current_token.text.startsWith("`") && this._flags.last_token.type === TOKEN.END_EXPR && (current_token.previous.text === ']' || current_token.previous.text === ')') && current_token.newlines === 0)) {
      this._output.space_before_token = true;
    } else {
      this.print_newline();
    }
  }
  this.print_token(current_token);
};

Beautifier.prototype.handle_equals = function(current_token) {
  if (this.start_of_statement(current_token)) {
    // The conditional starts the statement if appropriate.
  } else {
    this.handle_whitespace_and_comments(current_token);
  }

  if (this._flags.declaration_statement) {
    // just got an '=' in a var-line, different formatting/line-breaking, etc will now be done
    this._flags.declaration_assignment = true;
  }
  this._output.space_before_token = true;
  this.print_token(current_token);
  this._output.space_before_token = true;
};

Beautifier.prototype.handle_comma = function(current_token) {
  this.handle_whitespace_and_comments(current_token, true);

  this.print_token(current_token);
  this._output.space_before_token = true;
  if (this._flags.declaration_statement) {
    if (is_expression(this._flags.parent.mode)) {
      // do not break on comma, for(var a = 1, b = 2)
      this._flags.declaration_assignment = false;
    }

    if (this._flags.declaration_assignment) {
      this._flags.declaration_assignment = false;
      this.print_newline(false, true);
    } else if (this._options.comma_first) {
      // for comma-first, we want to allow a newline before the comma
      // to turn into a newline after the comma, which we will fixup later
      this.allow_wrap_or_preserved_newline(current_token);
    }
  } else if (this._flags.mode === MODE.ObjectLiteral ||
    (this._flags.mode === MODE.Statement && this._flags.parent.mode === MODE.ObjectLiteral)) {
    if (this._flags.mode === MODE.Statement) {
      this.restore_mode();
    }

    if (!this._flags.inline_frame) {
      this.print_newline();
    }
  } else if (this._options.comma_first) {
    // EXPR or DO_BLOCK
    // for comma-first, we want to allow a newline before the comma
    // to turn into a newline after the comma, which we will fixup later
    this.allow_wrap_or_preserved_newline(current_token);
  }
};

Beautifier.prototype.handle_operator = function(current_token) {
  var isGeneratorAsterisk = current_token.text === '*' &&
    (reserved_array(this._flags.last_token, ['function', 'yield']) ||
      (in_array(this._flags.last_token.type, [TOKEN.START_BLOCK, TOKEN.COMMA, TOKEN.END_BLOCK, TOKEN.SEMICOLON]))
    );
  var isUnary = in_array(current_token.text, ['-', '+']) && (
    in_array(this._flags.last_token.type, [TOKEN.START_BLOCK, TOKEN.START_EXPR, TOKEN.EQUALS, TOKEN.OPERATOR]) ||
    in_array(this._flags.last_token.text, line_starters) ||
    this._flags.last_token.text === ','
  );

  if (this.start_of_statement(current_token)) {
    // The conditional starts the statement if appropriate.
  } else {
    var preserve_statement_flags = !isGeneratorAsterisk;
    this.handle_whitespace_and_comments(current_token, preserve_statement_flags);
  }

  if (reserved_array(this._flags.last_token, special_words)) {
    // "return" had a special handling in TK_WORD. Now we need to return the favor
    this._output.space_before_token = true;
    this.print_token(current_token);
    return;
  }

  // hack for actionscript's import .*;
  if (current_token.text === '*' && this._flags.last_token.type === TOKEN.DOT) {
    this.print_token(current_token);
    return;
  }

  if (current_token.text === '::') {
    // no spaces around exotic namespacing syntax operator
    this.print_token(current_token);
    return;
  }

  // Allow line wrapping between operators when operator_position is
  //   set to before or preserve
  if (this._flags.last_token.type === TOKEN.OPERATOR && in_array(this._options.operator_position, OPERATOR_POSITION_BEFORE_OR_PRESERVE)) {
    this.allow_wrap_or_preserved_newline(current_token);
  }

  if (current_token.text === ':' && this._flags.in_case) {
    this.print_token(current_token);

    this._flags.in_case = false;
    this._flags.case_body = true;
    if (this._tokens.peek().type !== TOKEN.START_BLOCK) {
      this.indent();
      this.print_newline();
    } else {
      this._output.space_before_token = true;
    }
    return;
  }

  var space_before = true;
  var space_after = true;
  var in_ternary = false;
  if (current_token.text === ':') {
    if (this._flags.ternary_depth === 0) {
      // Colon is invalid javascript outside of ternary and object, but do our best to guess what was meant.
      space_before = false;
    } else {
      this._flags.ternary_depth -= 1;
      in_ternary = true;
    }
  } else if (current_token.text === '?') {
    this._flags.ternary_depth += 1;
  }

  // let's handle the operator_position option prior to any conflicting logic
  if (!isUnary && !isGeneratorAsterisk && this._options.preserve_newlines && in_array(current_token.text, positionable_operators)) {
    var isColon = current_token.text === ':';
    var isTernaryColon = (isColon && in_ternary);
    var isOtherColon = (isColon && !in_ternary);

    switch (this._options.operator_position) {
      case OPERATOR_POSITION.before_newline:
        // if the current token is : and it's not a ternary statement then we set space_before to false
        this._output.space_before_token = !isOtherColon;

        this.print_token(current_token);

        if (!isColon || isTernaryColon) {
          this.allow_wrap_or_preserved_newline(current_token);
        }

        this._output.space_before_token = true;
        return;

      case OPERATOR_POSITION.after_newline:
        // if the current token is anything but colon, or (via deduction) it's a colon and in a ternary statement,
        //   then print a newline.

        this._output.space_before_token = true;

        if (!isColon || isTernaryColon) {
          if (this._tokens.peek().newlines) {
            this.print_newline(false, true);
          } else {
            this.allow_wrap_or_preserved_newline(current_token);
          }
        } else {
          this._output.space_before_token = false;
        }

        this.print_token(current_token);

        this._output.space_before_token = true;
        return;

      case OPERATOR_POSITION.preserve_newline:
        if (!isOtherColon) {
          this.allow_wrap_or_preserved_newline(current_token);
        }

        // if we just added a newline, or the current token is : and it's not a ternary statement,
        //   then we set space_before to false
        space_before = !(this._output.just_added_newline() || isOtherColon);

        this._output.space_before_token = space_before;
        this.print_token(current_token);
        this._output.space_before_token = true;
        return;
    }
  }

  if (isGeneratorAsterisk) {
    this.allow_wrap_or_preserved_newline(current_token);
    space_before = false;
    var next_token = this._tokens.peek();
    space_after = next_token && in_array(next_token.type, [TOKEN.WORD, TOKEN.RESERVED]);
  } else if (current_token.text === '...') {
    this.allow_wrap_or_preserved_newline(current_token);
    space_before = this._flags.last_token.type === TOKEN.START_BLOCK;
    space_after = false;
  } else if (in_array(current_token.text, ['--', '++', '!', '~']) || isUnary) {
    // unary operators (and binary +/- pretending to be unary) special cases
    if (this._flags.last_token.type === TOKEN.COMMA || this._flags.last_token.type === TOKEN.START_EXPR) {
      this.allow_wrap_or_preserved_newline(current_token);
    }

    space_before = false;
    space_after = false;

    // http://www.ecma-international.org/ecma-262/5.1/#sec-7.9.1
    // if there is a newline between -- or ++ and anything else we should preserve it.
    if (current_token.newlines && (current_token.text === '--' || current_token.text === '++')) {
      this.print_newline(false, true);
    }

    if (this._flags.last_token.text === ';' && is_expression(this._flags.mode)) {
      // for (;; ++i)
      //        ^^^
      space_before = true;
    }

    if (this._flags.last_token.type === TOKEN.RESERVED) {
      space_before = true;
    } else if (this._flags.last_token.type === TOKEN.END_EXPR) {
      space_before = !(this._flags.last_token.text === ']' && (current_token.text === '--' || current_token.text === '++'));
    } else if (this._flags.last_token.type === TOKEN.OPERATOR) {
      // a++ + ++b;
      // a - -b
      space_before = in_array(current_token.text, ['--', '-', '++', '+']) && in_array(this._flags.last_token.text, ['--', '-', '++', '+']);
      // + and - are not unary when preceeded by -- or ++ operator
      // a-- + b
      // a * +b
      // a - -b
      if (in_array(current_token.text, ['+', '-']) && in_array(this._flags.last_token.text, ['--', '++'])) {
        space_after = true;
      }
    }


    if (((this._flags.mode === MODE.BlockStatement && !this._flags.inline_frame) || this._flags.mode === MODE.Statement) &&
      (this._flags.last_token.text === '{' || this._flags.last_token.text === ';')) {
      // { foo; --i }
      // foo(); --bar;
      this.print_newline();
    }
  }

  this._output.space_before_token = this._output.space_before_token || space_before;
  this.print_token(current_token);
  this._output.space_before_token = space_after;
};

Beautifier.prototype.handle_block_comment = function(current_token, preserve_statement_flags) {
  if (this._output.raw) {
    this._output.add_raw_token(current_token);
    if (current_token.directives && current_token.directives.preserve === 'end') {
      // If we're testing the raw output behavior, do not allow a directive to turn it off.
      this._output.raw = this._options.test_output_raw;
    }
    return;
  }

  if (current_token.directives) {
    this.print_newline(false, preserve_statement_flags);
    this.print_token(current_token);
    if (current_token.directives.preserve === 'start') {
      this._output.raw = true;
    }
    this.print_newline(false, true);
    return;
  }

  // inline block
  if (!acorn.newline.test(current_token.text) && !current_token.newlines) {
    this._output.space_before_token = true;
    this.print_token(current_token);
    this._output.space_before_token = true;
    return;
  } else {
    this.print_block_commment(current_token, preserve_statement_flags);
  }
};

Beautifier.prototype.print_block_commment = function(current_token, preserve_statement_flags) {
  var lines = split_linebreaks(current_token.text);
  var j; // iterator for this case
  var javadoc = false;
  var starless = false;
  var lastIndent = current_token.whitespace_before;
  var lastIndentLength = lastIndent.length;

  // block comment starts with a new line
  this.print_newline(false, preserve_statement_flags);

  // first line always indented
  this.print_token_line_indentation(current_token);
  this._output.add_token(lines[0]);
  this.print_newline(false, preserve_statement_flags);


  if (lines.length > 1) {
    lines = lines.slice(1);
    javadoc = all_lines_start_with(lines, '*');
    starless = each_line_matches_indent(lines, lastIndent);

    if (javadoc) {
      this._flags.alignment = 1;
    }

    for (j = 0; j < lines.length; j++) {
      if (javadoc) {
        // javadoc: reformat and re-indent
        this.print_token_line_indentation(current_token);
        this._output.add_token(ltrim(lines[j]));
      } else if (starless && lines[j]) {
        // starless: re-indent non-empty content, avoiding trim
        this.print_token_line_indentation(current_token);
        this._output.add_token(lines[j].substring(lastIndentLength));
      } else {
        // normal comments output raw
        this._output.current_line.set_indent(-1);
        this._output.add_token(lines[j]);
      }

      // for comments on their own line or  more than one line, make sure there's a new line after
      this.print_newline(false, preserve_statement_flags);
    }

    this._flags.alignment = 0;
  }
};


Beautifier.prototype.handle_comment = function(current_token, preserve_statement_flags) {
  if (current_token.newlines) {
    this.print_newline(false, preserve_statement_flags);
  } else {
    this._output.trim(true);
  }

  this._output.space_before_token = true;
  this.print_token(current_token);
  this.print_newline(false, preserve_statement_flags);
};

Beautifier.prototype.handle_dot = function(current_token) {
  if (this.start_of_statement(current_token)) {
    // The conditional starts the statement if appropriate.
  } else {
    this.handle_whitespace_and_comments(current_token, true);
  }

  if (reserved_array(this._flags.last_token, special_words)) {
    this._output.space_before_token = false;
  } else {
    // allow preserved newlines before dots in general
    // force newlines on dots after close paren when break_chained - for bar().baz()
    this.allow_wrap_or_preserved_newline(current_token,
      this._flags.last_token.text === ')' && this._options.break_chained_methods);
  }

  // Only unindent chained method dot if this dot starts a new line.
  // Otherwise the automatic extra indentation removal will handle the over indent
  if (this._options.unindent_chained_methods && this._output.just_added_newline()) {
    this.deindent();
  }

  this.print_token(current_token);
};

Beautifier.prototype.handle_unknown = function(current_token, preserve_statement_flags) {
  this.print_token(current_token);

  if (current_token.text[current_token.text.length - 1] === '\n') {
    this.print_newline(false, preserve_statement_flags);
  }
};

Beautifier.prototype.handle_eof = function(current_token) {
  // Unwind any open statements
  while (this._flags.mode === MODE.Statement) {
    this.restore_mode();
  }
  this.handle_whitespace_and_comments(current_token);
};

module.exports.Beautifier = Beautifier;


/***/ }),
/* 2 */
/***/ (function(module) {

/*jshint node:true */
/*
  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function OutputLine(parent) {
  this.__parent = parent;
  this.__character_count = 0;
  // use indent_count as a marker for this.__lines that have preserved indentation
  this.__indent_count = -1;
  this.__alignment_count = 0;
  this.__wrap_point_index = 0;
  this.__wrap_point_character_count = 0;
  this.__wrap_point_indent_count = -1;
  this.__wrap_point_alignment_count = 0;

  this.__items = [];
}

OutputLine.prototype.clone_empty = function() {
  var line = new OutputLine(this.__parent);
  line.set_indent(this.__indent_count, this.__alignment_count);
  return line;
};

OutputLine.prototype.item = function(index) {
  if (index < 0) {
    return this.__items[this.__items.length + index];
  } else {
    return this.__items[index];
  }
};

OutputLine.prototype.has_match = function(pattern) {
  for (var lastCheckedOutput = this.__items.length - 1; lastCheckedOutput >= 0; lastCheckedOutput--) {
    if (this.__items[lastCheckedOutput].match(pattern)) {
      return true;
    }
  }
  return false;
};

OutputLine.prototype.set_indent = function(indent, alignment) {
  if (this.is_empty()) {
    this.__indent_count = indent || 0;
    this.__alignment_count = alignment || 0;
    this.__character_count = this.__parent.get_indent_size(this.__indent_count, this.__alignment_count);
  }
};

OutputLine.prototype._set_wrap_point = function() {
  if (this.__parent.wrap_line_length) {
    this.__wrap_point_index = this.__items.length;
    this.__wrap_point_character_count = this.__character_count;
    this.__wrap_point_indent_count = this.__parent.next_line.__indent_count;
    this.__wrap_point_alignment_count = this.__parent.next_line.__alignment_count;
  }
};

OutputLine.prototype._should_wrap = function() {
  return this.__wrap_point_index &&
    this.__character_count > this.__parent.wrap_line_length &&
    this.__wrap_point_character_count > this.__parent.next_line.__character_count;
};

OutputLine.prototype._allow_wrap = function() {
  if (this._should_wrap()) {
    this.__parent.add_new_line();
    var next = this.__parent.current_line;
    next.set_indent(this.__wrap_point_indent_count, this.__wrap_point_alignment_count);
    next.__items = this.__items.slice(this.__wrap_point_index);
    this.__items = this.__items.slice(0, this.__wrap_point_index);

    next.__character_count += this.__character_count - this.__wrap_point_character_count;
    this.__character_count = this.__wrap_point_character_count;

    if (next.__items[0] === " ") {
      next.__items.splice(0, 1);
      next.__character_count -= 1;
    }
    return true;
  }
  return false;
};

OutputLine.prototype.is_empty = function() {
  return this.__items.length === 0;
};

OutputLine.prototype.last = function() {
  if (!this.is_empty()) {
    return this.__items[this.__items.length - 1];
  } else {
    return null;
  }
};

OutputLine.prototype.push = function(item) {
  this.__items.push(item);
  var last_newline_index = item.lastIndexOf('\n');
  if (last_newline_index !== -1) {
    this.__character_count = item.length - last_newline_index;
  } else {
    this.__character_count += item.length;
  }
};

OutputLine.prototype.pop = function() {
  var item = null;
  if (!this.is_empty()) {
    item = this.__items.pop();
    this.__character_count -= item.length;
  }
  return item;
};


OutputLine.prototype._remove_indent = function() {
  if (this.__indent_count > 0) {
    this.__indent_count -= 1;
    this.__character_count -= this.__parent.indent_size;
  }
};

OutputLine.prototype._remove_wrap_indent = function() {
  if (this.__wrap_point_indent_count > 0) {
    this.__wrap_point_indent_count -= 1;
  }
};
OutputLine.prototype.trim = function() {
  while (this.last() === ' ') {
    this.__items.pop();
    this.__character_count -= 1;
  }
};

OutputLine.prototype.toString = function() {
  var result = '';
  if (this.is_empty()) {
    if (this.__parent.indent_empty_lines) {
      result = this.__parent.get_indent_string(this.__indent_count);
    }
  } else {
    result = this.__parent.get_indent_string(this.__indent_count, this.__alignment_count);
    result += this.__items.join('');
  }
  return result;
};

function IndentStringCache(options, baseIndentString) {
  this.__cache = [''];
  this.__indent_size = options.indent_size;
  this.__indent_string = options.indent_char;
  if (!options.indent_with_tabs) {
    this.__indent_string = new Array(options.indent_size + 1).join(options.indent_char);
  }

  // Set to null to continue support for auto detection of base indent
  baseIndentString = baseIndentString || '';
  if (options.indent_level > 0) {
    baseIndentString = new Array(options.indent_level + 1).join(this.__indent_string);
  }

  this.__base_string = baseIndentString;
  this.__base_string_length = baseIndentString.length;
}

IndentStringCache.prototype.get_indent_size = function(indent, column) {
  var result = this.__base_string_length;
  column = column || 0;
  if (indent < 0) {
    result = 0;
  }
  result += indent * this.__indent_size;
  result += column;
  return result;
};

IndentStringCache.prototype.get_indent_string = function(indent_level, column) {
  var result = this.__base_string;
  column = column || 0;
  if (indent_level < 0) {
    indent_level = 0;
    result = '';
  }
  column += indent_level * this.__indent_size;
  this.__ensure_cache(column);
  result += this.__cache[column];
  return result;
};

IndentStringCache.prototype.__ensure_cache = function(column) {
  while (column >= this.__cache.length) {
    this.__add_column();
  }
};

IndentStringCache.prototype.__add_column = function() {
  var column = this.__cache.length;
  var indent = 0;
  var result = '';
  if (this.__indent_size && column >= this.__indent_size) {
    indent = Math.floor(column / this.__indent_size);
    column -= indent * this.__indent_size;
    result = new Array(indent + 1).join(this.__indent_string);
  }
  if (column) {
    result += new Array(column + 1).join(' ');
  }

  this.__cache.push(result);
};

function Output(options, baseIndentString) {
  this.__indent_cache = new IndentStringCache(options, baseIndentString);
  this.raw = false;
  this._end_with_newline = options.end_with_newline;
  this.indent_size = options.indent_size;
  this.wrap_line_length = options.wrap_line_length;
  this.indent_empty_lines = options.indent_empty_lines;
  this.__lines = [];
  this.previous_line = null;
  this.current_line = null;
  this.next_line = new OutputLine(this);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = false;
  // initialize
  this.__add_outputline();
}

Output.prototype.__add_outputline = function() {
  this.previous_line = this.current_line;
  this.current_line = this.next_line.clone_empty();
  this.__lines.push(this.current_line);
};

Output.prototype.get_line_number = function() {
  return this.__lines.length;
};

Output.prototype.get_indent_string = function(indent, column) {
  return this.__indent_cache.get_indent_string(indent, column);
};

Output.prototype.get_indent_size = function(indent, column) {
  return this.__indent_cache.get_indent_size(indent, column);
};

Output.prototype.is_empty = function() {
  return !this.previous_line && this.current_line.is_empty();
};

Output.prototype.add_new_line = function(force_newline) {
  // never newline at the start of file
  // otherwise, newline only if we didn't just add one or we're forced
  if (this.is_empty() ||
    (!force_newline && this.just_added_newline())) {
    return false;
  }

  // if raw output is enabled, don't print additional newlines,
  // but still return True as though you had
  if (!this.raw) {
    this.__add_outputline();
  }
  return true;
};

Output.prototype.get_code = function(eol) {
  this.trim(true);

  // handle some edge cases where the last tokens
  // has text that ends with newline(s)
  var last_item = this.current_line.pop();
  if (last_item) {
    if (last_item[last_item.length - 1] === '\n') {
      last_item = last_item.replace(/\n+$/g, '');
    }
    this.current_line.push(last_item);
  }

  if (this._end_with_newline) {
    this.__add_outputline();
  }

  var sweet_code = this.__lines.join('\n');

  if (eol !== '\n') {
    sweet_code = sweet_code.replace(/[\n]/g, eol);
  }
  return sweet_code;
};

Output.prototype.set_wrap_point = function() {
  this.current_line._set_wrap_point();
};

Output.prototype.set_indent = function(indent, alignment) {
  indent = indent || 0;
  alignment = alignment || 0;

  // Next line stores alignment values
  this.next_line.set_indent(indent, alignment);

  // Never indent your first output indent at the start of the file
  if (this.__lines.length > 1) {
    this.current_line.set_indent(indent, alignment);
    return true;
  }

  this.current_line.set_indent();
  return false;
};

Output.prototype.add_raw_token = function(token) {
  for (var x = 0; x < token.newlines; x++) {
    this.__add_outputline();
  }
  this.current_line.set_indent(-1);
  this.current_line.push(token.whitespace_before);
  this.current_line.push(token.text);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = false;
};

Output.prototype.add_token = function(printable_token) {
  this.__add_space_before_token();
  this.current_line.push(printable_token);
  this.space_before_token = false;
  this.non_breaking_space = false;
  this.previous_token_wrapped = this.current_line._allow_wrap();
};

Output.prototype.__add_space_before_token = function() {
  if (this.space_before_token && !this.just_added_newline()) {
    if (!this.non_breaking_space) {
      this.set_wrap_point();
    }
    this.current_line.push(' ');
  }
};

Output.prototype.remove_indent = function(index) {
  var output_length = this.__lines.length;
  while (index < output_length) {
    this.__lines[index]._remove_indent();
    index++;
  }
  this.current_line._remove_wrap_indent();
};

Output.prototype.trim = function(eat_newlines) {
  eat_newlines = (eat_newlines === undefined) ? false : eat_newlines;

  this.current_line.trim();

  while (eat_newlines && this.__lines.length > 1 &&
    this.current_line.is_empty()) {
    this.__lines.pop();
    this.current_line = this.__lines[this.__lines.length - 1];
    this.current_line.trim();
  }

  this.previous_line = this.__lines.length > 1 ?
    this.__lines[this.__lines.length - 2] : null;
};

Output.prototype.just_added_newline = function() {
  return this.current_line.is_empty();
};

Output.prototype.just_added_blankline = function() {
  return this.is_empty() ||
    (this.current_line.is_empty() && this.previous_line.is_empty());
};

Output.prototype.ensure_empty_line_above = function(starts_with, ends_with) {
  var index = this.__lines.length - 2;
  while (index >= 0) {
    var potentialEmptyLine = this.__lines[index];
    if (potentialEmptyLine.is_empty()) {
      break;
    } else if (potentialEmptyLine.item(0).indexOf(starts_with) !== 0 &&
      potentialEmptyLine.item(-1) !== ends_with) {
      this.__lines.splice(index + 1, 0, new OutputLine(this));
      this.previous_line = this.__lines[this.__lines.length - 2];
      break;
    }
    index--;
  }
};

module.exports.Output = Output;


/***/ }),
/* 3 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Token(type, text, newlines, whitespace_before) {
  this.type = type;
  this.text = text;

  // comments_before are
  // comments that have a new line before them
  // and may or may not have a newline after
  // this is a set of comments before
  this.comments_before = null; /* inline comment*/


  // this.comments_after =  new TokenStream(); // no new line before and newline after
  this.newlines = newlines || 0;
  this.whitespace_before = whitespace_before || '';
  this.parent = null;
  this.next = null;
  this.previous = null;
  this.opened = null;
  this.closed = null;
  this.directives = null;
}


module.exports.Token = Token;


/***/ }),
/* 4 */
/***/ (function(__unused_webpack_module, exports) {

/* jshint node: true, curly: false */
// Parts of this section of code is taken from acorn.
//
// Acorn was written by Marijn Haverbeke and released under an MIT
// license. The Unicode regexps (for identifiers and whitespace) were
// taken from [Esprima](http://esprima.org) by Ariya Hidayat.
//
// Git repositories for Acorn are available at
//
//     http://marijnhaverbeke.nl/git/acorn
//     https://github.com/marijnh/acorn.git

// ## Character categories




// acorn used char codes to squeeze the last bit of performance out
// Beautifier is okay without that, so we're using regex
// permit # (23), $ (36), and @ (64). @ is used in ES7 decorators.
// 65 through 91 are uppercase letters.
// permit _ (95).
// 97 through 123 are lowercase letters.
var baseASCIIidentifierStartChars = "\\x23\\x24\\x40\\x41-\\x5a\\x5f\\x61-\\x7a";

// inside an identifier @ is not allowed but 0-9 are.
var baseASCIIidentifierChars = "\\x24\\x30-\\x39\\x41-\\x5a\\x5f\\x61-\\x7a";

// Big ugly regular expressions that match characters in the
// whitespace, identifier, and identifier-start categories. These
// are only applied when a character is found to actually have a
// code point above 128.
var nonASCIIidentifierStartChars = "\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc";
var nonASCIIidentifierChars = "\\u0300-\\u036f\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u0620-\\u0649\\u0672-\\u06d3\\u06e7-\\u06e8\\u06fb-\\u06fc\\u0730-\\u074a\\u0800-\\u0814\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0840-\\u0857\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962-\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09d7\\u09df-\\u09e0\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2-\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b5f-\\u0b60\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62-\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2-\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d46-\\u0d48\\u0d57\\u0d62-\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e34-\\u0e3a\\u0e40-\\u0e45\\u0e50-\\u0e59\\u0eb4-\\u0eb9\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f41-\\u0f47\\u0f71-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u1000-\\u1029\\u1040-\\u1049\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u170e-\\u1710\\u1720-\\u1730\\u1740-\\u1750\\u1772\\u1773\\u1780-\\u17b2\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u1920-\\u192b\\u1930-\\u193b\\u1951-\\u196d\\u19b0-\\u19c0\\u19c8-\\u19c9\\u19d0-\\u19d9\\u1a00-\\u1a15\\u1a20-\\u1a53\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b46-\\u1b4b\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c00-\\u1c22\\u1c40-\\u1c49\\u1c5b-\\u1c7d\\u1cd0-\\u1cd2\\u1d00-\\u1dbe\\u1e01-\\u1f15\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2d81-\\u2d96\\u2de0-\\u2dff\\u3021-\\u3028\\u3099\\u309a\\ua640-\\ua66d\\ua674-\\ua67d\\ua69f\\ua6f0-\\ua6f1\\ua7f8-\\ua800\\ua806\\ua80b\\ua823-\\ua827\\ua880-\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8f3-\\ua8f7\\ua900-\\ua909\\ua926-\\ua92d\\ua930-\\ua945\\ua980-\\ua983\\ua9b3-\\ua9c0\\uaa00-\\uaa27\\uaa40-\\uaa41\\uaa4c-\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaae0-\\uaae9\\uaaf2-\\uaaf3\\uabc0-\\uabe1\\uabec\\uabed\\uabf0-\\uabf9\\ufb20-\\ufb28\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f";
//var nonASCIIidentifierStart = new RegExp("[" + nonASCIIidentifierStartChars + "]");
//var nonASCIIidentifier = new RegExp("[" + nonASCIIidentifierStartChars + nonASCIIidentifierChars + "]");

var identifierStart = "(?:\\\\u[0-9a-fA-F]{4}|[" + baseASCIIidentifierStartChars + nonASCIIidentifierStartChars + "])";
var identifierChars = "(?:\\\\u[0-9a-fA-F]{4}|[" + baseASCIIidentifierChars + nonASCIIidentifierStartChars + nonASCIIidentifierChars + "])*";

exports.identifier = new RegExp(identifierStart + identifierChars, 'g');
exports.identifierStart = new RegExp(identifierStart);
exports.identifierMatch = new RegExp("(?:\\\\u[0-9a-fA-F]{4}|[" + baseASCIIidentifierChars + nonASCIIidentifierStartChars + nonASCIIidentifierChars + "])+");

var nonASCIIwhitespace = /[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/; // jshint ignore:line

// Whether a single character denotes a newline.

exports.newline = /[\n\r\u2028\u2029]/;

// Matches a whole line break (where CRLF is considered a single
// line break). Used to count lines.

// in javascript, these two differ
// in python they are the same, different methods are called on them
exports.lineBreak = new RegExp('\r\n|' + exports.newline.source);
exports.allLineBreaks = new RegExp(exports.lineBreak.source, 'g');


/***/ }),
/* 5 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_86494__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var BaseOptions = __nested_webpack_require_86494__(6).Options;

var validPositionValues = ['before-newline', 'after-newline', 'preserve-newline'];

function Options(options) {
  BaseOptions.call(this, options, 'js');

  // compatibility, re
  var raw_brace_style = this.raw_options.brace_style || null;
  if (raw_brace_style === "expand-strict") { //graceful handling of deprecated option
    this.raw_options.brace_style = "expand";
  } else if (raw_brace_style === "collapse-preserve-inline") { //graceful handling of deprecated option
    this.raw_options.brace_style = "collapse,preserve-inline";
  } else if (this.raw_options.braces_on_own_line !== undefined) { //graceful handling of deprecated option
    this.raw_options.brace_style = this.raw_options.braces_on_own_line ? "expand" : "collapse";
    // } else if (!raw_brace_style) { //Nothing exists to set it
    //   raw_brace_style = "collapse";
  }

  //preserve-inline in delimited string will trigger brace_preserve_inline, everything
  //else is considered a brace_style and the last one only will have an effect

  var brace_style_split = this._get_selection_list('brace_style', ['collapse', 'expand', 'end-expand', 'none', 'preserve-inline']);

  this.brace_preserve_inline = false; //Defaults in case one or other was not specified in meta-option
  this.brace_style = "collapse";

  for (var bs = 0; bs < brace_style_split.length; bs++) {
    if (brace_style_split[bs] === "preserve-inline") {
      this.brace_preserve_inline = true;
    } else {
      this.brace_style = brace_style_split[bs];
    }
  }

  this.unindent_chained_methods = this._get_boolean('unindent_chained_methods');
  this.break_chained_methods = this._get_boolean('break_chained_methods');
  this.space_in_paren = this._get_boolean('space_in_paren');
  this.space_in_empty_paren = this._get_boolean('space_in_empty_paren');
  this.jslint_happy = this._get_boolean('jslint_happy');
  this.space_after_anon_function = this._get_boolean('space_after_anon_function');
  this.space_after_named_function = this._get_boolean('space_after_named_function');
  this.keep_array_indentation = this._get_boolean('keep_array_indentation');
  this.space_before_conditional = this._get_boolean('space_before_conditional', true);
  this.unescape_strings = this._get_boolean('unescape_strings');
  this.e4x = this._get_boolean('e4x');
  this.comma_first = this._get_boolean('comma_first');
  this.operator_position = this._get_selection('operator_position', validPositionValues);

  // For testing of beautify preserve:start directive
  this.test_output_raw = this._get_boolean('test_output_raw');

  // force this._options.space_after_anon_function to true if this._options.jslint_happy
  if (this.jslint_happy) {
    this.space_after_anon_function = true;
  }

}
Options.prototype = new BaseOptions();



module.exports.Options = Options;


/***/ }),
/* 6 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Options(options, merge_child_field) {
  this.raw_options = _mergeOpts(options, merge_child_field);

  // Support passing the source text back with no change
  this.disabled = this._get_boolean('disabled');

  this.eol = this._get_characters('eol', 'auto');
  this.end_with_newline = this._get_boolean('end_with_newline');
  this.indent_size = this._get_number('indent_size', 4);
  this.indent_char = this._get_characters('indent_char', ' ');
  this.indent_level = this._get_number('indent_level');

  this.preserve_newlines = this._get_boolean('preserve_newlines', true);
  this.max_preserve_newlines = this._get_number('max_preserve_newlines', 32786);
  if (!this.preserve_newlines) {
    this.max_preserve_newlines = 0;
  }

  this.indent_with_tabs = this._get_boolean('indent_with_tabs', this.indent_char === '\t');
  if (this.indent_with_tabs) {
    this.indent_char = '\t';

    // indent_size behavior changed after 1.8.6
    // It used to be that indent_size would be
    // set to 1 for indent_with_tabs. That is no longer needed and
    // actually doesn't make sense - why not use spaces? Further,
    // that might produce unexpected behavior - tabs being used
    // for single-column alignment. So, when indent_with_tabs is true
    // and indent_size is 1, reset indent_size to 4.
    if (this.indent_size === 1) {
      this.indent_size = 4;
    }
  }

  // Backwards compat with 1.3.x
  this.wrap_line_length = this._get_number('wrap_line_length', this._get_number('max_char'));

  this.indent_empty_lines = this._get_boolean('indent_empty_lines');

  // valid templating languages ['django', 'erb', 'handlebars', 'php', 'smarty']
  // For now, 'auto' = all off for javascript, all on for html (and inline javascript).
  // other values ignored
  this.templating = this._get_selection_list('templating', ['auto', 'none', 'django', 'erb', 'handlebars', 'php', 'smarty'], ['auto']);
}

Options.prototype._get_array = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = default_value || [];
  if (typeof option_value === 'object') {
    if (option_value !== null && typeof option_value.concat === 'function') {
      result = option_value.concat();
    }
  } else if (typeof option_value === 'string') {
    result = option_value.split(/[^a-zA-Z0-9_\/\-]+/);
  }
  return result;
};

Options.prototype._get_boolean = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = option_value === undefined ? !!default_value : !!option_value;
  return result;
};

Options.prototype._get_characters = function(name, default_value) {
  var option_value = this.raw_options[name];
  var result = default_value || '';
  if (typeof option_value === 'string') {
    result = option_value.replace(/\\r/, '\r').replace(/\\n/, '\n').replace(/\\t/, '\t');
  }
  return result;
};

Options.prototype._get_number = function(name, default_value) {
  var option_value = this.raw_options[name];
  default_value = parseInt(default_value, 10);
  if (isNaN(default_value)) {
    default_value = 0;
  }
  var result = parseInt(option_value, 10);
  if (isNaN(result)) {
    result = default_value;
  }
  return result;
};

Options.prototype._get_selection = function(name, selection_list, default_value) {
  var result = this._get_selection_list(name, selection_list, default_value);
  if (result.length !== 1) {
    throw new Error(
      "Invalid Option Value: The option '" + name + "' can only be one of the following values:\n" +
      selection_list + "\nYou passed in: '" + this.raw_options[name] + "'");
  }

  return result[0];
};


Options.prototype._get_selection_list = function(name, selection_list, default_value) {
  if (!selection_list || selection_list.length === 0) {
    throw new Error("Selection list cannot be empty.");
  }

  default_value = default_value || [selection_list[0]];
  if (!this._is_valid_selection(default_value, selection_list)) {
    throw new Error("Invalid Default Value!");
  }

  var result = this._get_array(name, default_value);
  if (!this._is_valid_selection(result, selection_list)) {
    throw new Error(
      "Invalid Option Value: The option '" + name + "' can contain only the following values:\n" +
      selection_list + "\nYou passed in: '" + this.raw_options[name] + "'");
  }

  return result;
};

Options.prototype._is_valid_selection = function(result, selection_list) {
  return result.length && selection_list.length &&
    !result.some(function(item) { return selection_list.indexOf(item) === -1; });
};


// merges child options up with the parent options object
// Example: obj = {a: 1, b: {a: 2}}
//          mergeOpts(obj, 'b')
//
//          Returns: {a: 2}
function _mergeOpts(allOptions, childFieldName) {
  var finalOpts = {};
  allOptions = _normalizeOpts(allOptions);
  var name;

  for (name in allOptions) {
    if (name !== childFieldName) {
      finalOpts[name] = allOptions[name];
    }
  }

  //merge in the per type settings for the childFieldName
  if (childFieldName && allOptions[childFieldName]) {
    for (name in allOptions[childFieldName]) {
      finalOpts[name] = allOptions[childFieldName][name];
    }
  }
  return finalOpts;
}

function _normalizeOpts(options) {
  var convertedOpts = {};
  var key;

  for (key in options) {
    var newKey = key.replace(/-/g, "_");
    convertedOpts[newKey] = options[key];
  }
  return convertedOpts;
}

module.exports.Options = Options;
module.exports.normalizeOpts = _normalizeOpts;
module.exports.mergeOpts = _mergeOpts;


/***/ }),
/* 7 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_97388__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var InputScanner = __nested_webpack_require_97388__(8).InputScanner;
var BaseTokenizer = __nested_webpack_require_97388__(9).Tokenizer;
var BASETOKEN = __nested_webpack_require_97388__(9).TOKEN;
var Directives = __nested_webpack_require_97388__(13).Directives;
var acorn = __nested_webpack_require_97388__(4);
var Pattern = __nested_webpack_require_97388__(12).Pattern;
var TemplatablePattern = __nested_webpack_require_97388__(14).TemplatablePattern;


function in_array(what, arr) {
  return arr.indexOf(what) !== -1;
}


var TOKEN = {
  START_EXPR: 'TK_START_EXPR',
  END_EXPR: 'TK_END_EXPR',
  START_BLOCK: 'TK_START_BLOCK',
  END_BLOCK: 'TK_END_BLOCK',
  WORD: 'TK_WORD',
  RESERVED: 'TK_RESERVED',
  SEMICOLON: 'TK_SEMICOLON',
  STRING: 'TK_STRING',
  EQUALS: 'TK_EQUALS',
  OPERATOR: 'TK_OPERATOR',
  COMMA: 'TK_COMMA',
  BLOCK_COMMENT: 'TK_BLOCK_COMMENT',
  COMMENT: 'TK_COMMENT',
  DOT: 'TK_DOT',
  UNKNOWN: 'TK_UNKNOWN',
  START: BASETOKEN.START,
  RAW: BASETOKEN.RAW,
  EOF: BASETOKEN.EOF
};


var directives_core = new Directives(/\/\*/, /\*\//);

var number_pattern = /0[xX][0123456789abcdefABCDEF_]*n?|0[oO][01234567_]*n?|0[bB][01_]*n?|\d[\d_]*n|(?:\.\d[\d_]*|\d[\d_]*\.?[\d_]*)(?:[eE][+-]?[\d_]+)?/;

var digit = /[0-9]/;

// Dot "." must be distinguished from "..." and decimal
var dot_pattern = /[^\d\.]/;

var positionable_operators = (
  ">>> === !== " +
  "<< && >= ** != == <= >> || ?? |> " +
  "< / - + > : & % ? ^ | *").split(' ');

// IMPORTANT: this must be sorted longest to shortest or tokenizing many not work.
// Also, you must update possitionable operators separately from punct
var punct =
  ">>>= " +
  "... >>= <<= === >>> !== **= " +
  "=> ^= :: /= << <= == && -= >= >> != -- += ** || ?? ++ %= &= *= |= |> " +
  "= ! ? > < : / ^ - + * & % ~ |";

punct = punct.replace(/[-[\]{}()*+?.,\\^$|#]/g, "\\$&");
// ?. but not if followed by a number 
punct = '\\?\\.(?!\\d) ' + punct;
punct = punct.replace(/ /g, '|');

var punct_pattern = new RegExp(punct);

// words which should always start on new line.
var line_starters = 'continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,import,export'.split(',');
var reserved_words = line_starters.concat(['do', 'in', 'of', 'else', 'get', 'set', 'new', 'catch', 'finally', 'typeof', 'yield', 'async', 'await', 'from', 'as']);
var reserved_word_pattern = new RegExp('^(?:' + reserved_words.join('|') + ')$');

// var template_pattern = /(?:(?:<\?php|<\?=)[\s\S]*?\?>)|(?:<%[\s\S]*?%>)/g;

var in_html_comment;

var Tokenizer = function(input_string, options) {
  BaseTokenizer.call(this, input_string, options);

  this._patterns.whitespace = this._patterns.whitespace.matching(
    /\u00A0\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff/.source,
    /\u2028\u2029/.source);

  var pattern_reader = new Pattern(this._input);
  var templatable = new TemplatablePattern(this._input)
    .read_options(this._options);

  this.__patterns = {
    template: templatable,
    identifier: templatable.starting_with(acorn.identifier).matching(acorn.identifierMatch),
    number: pattern_reader.matching(number_pattern),
    punct: pattern_reader.matching(punct_pattern),
    // comment ends just before nearest linefeed or end of file
    comment: pattern_reader.starting_with(/\/\//).until(/[\n\r\u2028\u2029]/),
    //  /* ... */ comment ends with nearest */ or end of file
    block_comment: pattern_reader.starting_with(/\/\*/).until_after(/\*\//),
    html_comment_start: pattern_reader.matching(/<!--/),
    html_comment_end: pattern_reader.matching(/-->/),
    include: pattern_reader.starting_with(/#include/).until_after(acorn.lineBreak),
    shebang: pattern_reader.starting_with(/#!/).until_after(acorn.lineBreak),
    xml: pattern_reader.matching(/[\s\S]*?<(\/?)([-a-zA-Z:0-9_.]+|{[\s\S]+?}|!\[CDATA\[[\s\S]*?\]\]|)(\s+{[\s\S]+?}|\s+[-a-zA-Z:0-9_.]+|\s+[-a-zA-Z:0-9_.]+\s*=\s*('[^']*'|"[^"]*"|{[\s\S]+?}))*\s*(\/?)\s*>/),
    single_quote: templatable.until(/['\\\n\r\u2028\u2029]/),
    double_quote: templatable.until(/["\\\n\r\u2028\u2029]/),
    template_text: templatable.until(/[`\\$]/),
    template_expression: templatable.until(/[`}\\]/)
  };

};
Tokenizer.prototype = new BaseTokenizer();

Tokenizer.prototype._is_comment = function(current_token) {
  return current_token.type === TOKEN.COMMENT || current_token.type === TOKEN.BLOCK_COMMENT || current_token.type === TOKEN.UNKNOWN;
};

Tokenizer.prototype._is_opening = function(current_token) {
  return current_token.type === TOKEN.START_BLOCK || current_token.type === TOKEN.START_EXPR;
};

Tokenizer.prototype._is_closing = function(current_token, open_token) {
  return (current_token.type === TOKEN.END_BLOCK || current_token.type === TOKEN.END_EXPR) &&
    (open_token && (
      (current_token.text === ']' && open_token.text === '[') ||
      (current_token.text === ')' && open_token.text === '(') ||
      (current_token.text === '}' && open_token.text === '{')));
};

Tokenizer.prototype._reset = function() {
  in_html_comment = false;
};

Tokenizer.prototype._get_next_token = function(previous_token, open_token) { // jshint unused:false
  var token = null;
  this._readWhitespace();
  var c = this._input.peek();

  if (c === null) {
    return this._create_token(TOKEN.EOF, '');
  }

  token = token || this._read_non_javascript(c);
  token = token || this._read_string(c);
  token = token || this._read_word(previous_token);
  token = token || this._read_singles(c);
  token = token || this._read_comment(c);
  token = token || this._read_regexp(c, previous_token);
  token = token || this._read_xml(c, previous_token);
  token = token || this._read_punctuation();
  token = token || this._create_token(TOKEN.UNKNOWN, this._input.next());

  return token;
};

Tokenizer.prototype._read_word = function(previous_token) {
  var resulting_string;
  resulting_string = this.__patterns.identifier.read();
  if (resulting_string !== '') {
    resulting_string = resulting_string.replace(acorn.allLineBreaks, '\n');
    if (!(previous_token.type === TOKEN.DOT ||
        (previous_token.type === TOKEN.RESERVED && (previous_token.text === 'set' || previous_token.text === 'get'))) &&
      reserved_word_pattern.test(resulting_string)) {
      if (resulting_string === 'in' || resulting_string === 'of') { // hack for 'in' and 'of' operators
        return this._create_token(TOKEN.OPERATOR, resulting_string);
      }
      return this._create_token(TOKEN.RESERVED, resulting_string);
    }
    return this._create_token(TOKEN.WORD, resulting_string);
  }

  resulting_string = this.__patterns.number.read();
  if (resulting_string !== '') {
    return this._create_token(TOKEN.WORD, resulting_string);
  }
};

Tokenizer.prototype._read_singles = function(c) {
  var token = null;
  if (c === '(' || c === '[') {
    token = this._create_token(TOKEN.START_EXPR, c);
  } else if (c === ')' || c === ']') {
    token = this._create_token(TOKEN.END_EXPR, c);
  } else if (c === '{') {
    token = this._create_token(TOKEN.START_BLOCK, c);
  } else if (c === '}') {
    token = this._create_token(TOKEN.END_BLOCK, c);
  } else if (c === ';') {
    token = this._create_token(TOKEN.SEMICOLON, c);
  } else if (c === '.' && dot_pattern.test(this._input.peek(1))) {
    token = this._create_token(TOKEN.DOT, c);
  } else if (c === ',') {
    token = this._create_token(TOKEN.COMMA, c);
  }

  if (token) {
    this._input.next();
  }
  return token;
};

Tokenizer.prototype._read_punctuation = function() {
  var resulting_string = this.__patterns.punct.read();

  if (resulting_string !== '') {
    if (resulting_string === '=') {
      return this._create_token(TOKEN.EQUALS, resulting_string);
    } else if (resulting_string === '?.') {
      return this._create_token(TOKEN.DOT, resulting_string);
    } else {
      return this._create_token(TOKEN.OPERATOR, resulting_string);
    }
  }
};

Tokenizer.prototype._read_non_javascript = function(c) {
  var resulting_string = '';

  if (c === '#') {
    if (this._is_first_token()) {
      resulting_string = this.__patterns.shebang.read();

      if (resulting_string) {
        return this._create_token(TOKEN.UNKNOWN, resulting_string.trim() + '\n');
      }
    }

    // handles extendscript #includes
    resulting_string = this.__patterns.include.read();

    if (resulting_string) {
      return this._create_token(TOKEN.UNKNOWN, resulting_string.trim() + '\n');
    }

    c = this._input.next();

    // Spidermonkey-specific sharp variables for circular references. Considered obsolete.
    var sharp = '#';
    if (this._input.hasNext() && this._input.testChar(digit)) {
      do {
        c = this._input.next();
        sharp += c;
      } while (this._input.hasNext() && c !== '#' && c !== '=');
      if (c === '#') {
        //
      } else if (this._input.peek() === '[' && this._input.peek(1) === ']') {
        sharp += '[]';
        this._input.next();
        this._input.next();
      } else if (this._input.peek() === '{' && this._input.peek(1) === '}') {
        sharp += '{}';
        this._input.next();
        this._input.next();
      }
      return this._create_token(TOKEN.WORD, sharp);
    }

    this._input.back();

  } else if (c === '<' && this._is_first_token()) {
    resulting_string = this.__patterns.html_comment_start.read();
    if (resulting_string) {
      while (this._input.hasNext() && !this._input.testChar(acorn.newline)) {
        resulting_string += this._input.next();
      }
      in_html_comment = true;
      return this._create_token(TOKEN.COMMENT, resulting_string);
    }
  } else if (in_html_comment && c === '-') {
    resulting_string = this.__patterns.html_comment_end.read();
    if (resulting_string) {
      in_html_comment = false;
      return this._create_token(TOKEN.COMMENT, resulting_string);
    }
  }

  return null;
};

Tokenizer.prototype._read_comment = function(c) {
  var token = null;
  if (c === '/') {
    var comment = '';
    if (this._input.peek(1) === '*') {
      // peek for comment /* ... */
      comment = this.__patterns.block_comment.read();
      var directives = directives_core.get_directives(comment);
      if (directives && directives.ignore === 'start') {
        comment += directives_core.readIgnored(this._input);
      }
      comment = comment.replace(acorn.allLineBreaks, '\n');
      token = this._create_token(TOKEN.BLOCK_COMMENT, comment);
      token.directives = directives;
    } else if (this._input.peek(1) === '/') {
      // peek for comment // ...
      comment = this.__patterns.comment.read();
      token = this._create_token(TOKEN.COMMENT, comment);
    }
  }
  return token;
};

Tokenizer.prototype._read_string = function(c) {
  if (c === '`' || c === "'" || c === '"') {
    var resulting_string = this._input.next();
    this.has_char_escapes = false;

    if (c === '`') {
      resulting_string += this._read_string_recursive('`', true, '${');
    } else {
      resulting_string += this._read_string_recursive(c);
    }

    if (this.has_char_escapes && this._options.unescape_strings) {
      resulting_string = unescape_string(resulting_string);
    }

    if (this._input.peek() === c) {
      resulting_string += this._input.next();
    }

    resulting_string = resulting_string.replace(acorn.allLineBreaks, '\n');

    return this._create_token(TOKEN.STRING, resulting_string);
  }

  return null;
};

Tokenizer.prototype._allow_regexp_or_xml = function(previous_token) {
  // regex and xml can only appear in specific locations during parsing
  return (previous_token.type === TOKEN.RESERVED && in_array(previous_token.text, ['return', 'case', 'throw', 'else', 'do', 'typeof', 'yield'])) ||
    (previous_token.type === TOKEN.END_EXPR && previous_token.text === ')' &&
      previous_token.opened.previous.type === TOKEN.RESERVED && in_array(previous_token.opened.previous.text, ['if', 'while', 'for'])) ||
    (in_array(previous_token.type, [TOKEN.COMMENT, TOKEN.START_EXPR, TOKEN.START_BLOCK, TOKEN.START,
      TOKEN.END_BLOCK, TOKEN.OPERATOR, TOKEN.EQUALS, TOKEN.EOF, TOKEN.SEMICOLON, TOKEN.COMMA
    ]));
};

Tokenizer.prototype._read_regexp = function(c, previous_token) {

  if (c === '/' && this._allow_regexp_or_xml(previous_token)) {
    // handle regexp
    //
    var resulting_string = this._input.next();
    var esc = false;

    var in_char_class = false;
    while (this._input.hasNext() &&
      ((esc || in_char_class || this._input.peek() !== c) &&
        !this._input.testChar(acorn.newline))) {
      resulting_string += this._input.peek();
      if (!esc) {
        esc = this._input.peek() === '\\';
        if (this._input.peek() === '[') {
          in_char_class = true;
        } else if (this._input.peek() === ']') {
          in_char_class = false;
        }
      } else {
        esc = false;
      }
      this._input.next();
    }

    if (this._input.peek() === c) {
      resulting_string += this._input.next();

      // regexps may have modifiers /regexp/MOD , so fetch those, too
      // Only [gim] are valid, but if the user puts in garbage, do what we can to take it.
      resulting_string += this._input.read(acorn.identifier);
    }
    return this._create_token(TOKEN.STRING, resulting_string);
  }
  return null;
};

Tokenizer.prototype._read_xml = function(c, previous_token) {

  if (this._options.e4x && c === "<" && this._allow_regexp_or_xml(previous_token)) {
    var xmlStr = '';
    var match = this.__patterns.xml.read_match();
    // handle e4x xml literals
    //
    if (match) {
      // Trim root tag to attempt to
      var rootTag = match[2].replace(/^{\s+/, '{').replace(/\s+}$/, '}');
      var isCurlyRoot = rootTag.indexOf('{') === 0;
      var depth = 0;
      while (match) {
        var isEndTag = !!match[1];
        var tagName = match[2];
        var isSingletonTag = (!!match[match.length - 1]) || (tagName.slice(0, 8) === "![CDATA[");
        if (!isSingletonTag &&
          (tagName === rootTag || (isCurlyRoot && tagName.replace(/^{\s+/, '{').replace(/\s+}$/, '}')))) {
          if (isEndTag) {
            --depth;
          } else {
            ++depth;
          }
        }
        xmlStr += match[0];
        if (depth <= 0) {
          break;
        }
        match = this.__patterns.xml.read_match();
      }
      // if we didn't close correctly, keep unformatted.
      if (!match) {
        xmlStr += this._input.match(/[\s\S]*/g)[0];
      }
      xmlStr = xmlStr.replace(acorn.allLineBreaks, '\n');
      return this._create_token(TOKEN.STRING, xmlStr);
    }
  }

  return null;
};

function unescape_string(s) {
  // You think that a regex would work for this
  // return s.replace(/\\x([0-9a-f]{2})/gi, function(match, val) {
  //         return String.fromCharCode(parseInt(val, 16));
  //     })
  // However, dealing with '\xff', '\\xff', '\\\xff' makes this more fun.
  var out = '',
    escaped = 0;

  var input_scan = new InputScanner(s);
  var matched = null;

  while (input_scan.hasNext()) {
    // Keep any whitespace, non-slash characters
    // also keep slash pairs.
    matched = input_scan.match(/([\s]|[^\\]|\\\\)+/g);

    if (matched) {
      out += matched[0];
    }

    if (input_scan.peek() === '\\') {
      input_scan.next();
      if (input_scan.peek() === 'x') {
        matched = input_scan.match(/x([0-9A-Fa-f]{2})/g);
      } else if (input_scan.peek() === 'u') {
        matched = input_scan.match(/u([0-9A-Fa-f]{4})/g);
      } else {
        out += '\\';
        if (input_scan.hasNext()) {
          out += input_scan.next();
        }
        continue;
      }

      // If there's some error decoding, return the original string
      if (!matched) {
        return s;
      }

      escaped = parseInt(matched[1], 16);

      if (escaped > 0x7e && escaped <= 0xff && matched[0].indexOf('x') === 0) {
        // we bail out on \x7f..\xff,
        // leaving whole string escaped,
        // as it's probably completely binary
        return s;
      } else if (escaped >= 0x00 && escaped < 0x20) {
        // leave 0x00...0x1f escaped
        out += '\\' + matched[0];
        continue;
      } else if (escaped === 0x22 || escaped === 0x27 || escaped === 0x5c) {
        // single-quote, apostrophe, backslash - escape these
        out += '\\' + String.fromCharCode(escaped);
      } else {
        out += String.fromCharCode(escaped);
      }
    }
  }

  return out;
}

// handle string
//
Tokenizer.prototype._read_string_recursive = function(delimiter, allow_unescaped_newlines, start_sub) {
  var current_char;
  var pattern;
  if (delimiter === '\'') {
    pattern = this.__patterns.single_quote;
  } else if (delimiter === '"') {
    pattern = this.__patterns.double_quote;
  } else if (delimiter === '`') {
    pattern = this.__patterns.template_text;
  } else if (delimiter === '}') {
    pattern = this.__patterns.template_expression;
  }

  var resulting_string = pattern.read();
  var next = '';
  while (this._input.hasNext()) {
    next = this._input.next();
    if (next === delimiter ||
      (!allow_unescaped_newlines && acorn.newline.test(next))) {
      this._input.back();
      break;
    } else if (next === '\\' && this._input.hasNext()) {
      current_char = this._input.peek();

      if (current_char === 'x' || current_char === 'u') {
        this.has_char_escapes = true;
      } else if (current_char === '\r' && this._input.peek(1) === '\n') {
        this._input.next();
      }
      next += this._input.next();
    } else if (start_sub) {
      if (start_sub === '${' && next === '$' && this._input.peek() === '{') {
        next += this._input.next();
      }

      if (start_sub === next) {
        if (delimiter === '`') {
          next += this._read_string_recursive('}', allow_unescaped_newlines, '`');
        } else {
          next += this._read_string_recursive('`', allow_unescaped_newlines, '${');
        }
        if (this._input.hasNext()) {
          next += this._input.next();
        }
      }
    }
    next += pattern.read();
    resulting_string += next;
  }

  return resulting_string;
};

module.exports.Tokenizer = Tokenizer;
module.exports.TOKEN = TOKEN;
module.exports.positionable_operators = positionable_operators.slice();
module.exports.line_starters = line_starters.slice();


/***/ }),
/* 8 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var regexp_has_sticky = RegExp.prototype.hasOwnProperty('sticky');

function InputScanner(input_string) {
  this.__input = input_string || '';
  this.__input_length = this.__input.length;
  this.__position = 0;
}

InputScanner.prototype.restart = function() {
  this.__position = 0;
};

InputScanner.prototype.back = function() {
  if (this.__position > 0) {
    this.__position -= 1;
  }
};

InputScanner.prototype.hasNext = function() {
  return this.__position < this.__input_length;
};

InputScanner.prototype.next = function() {
  var val = null;
  if (this.hasNext()) {
    val = this.__input.charAt(this.__position);
    this.__position += 1;
  }
  return val;
};

InputScanner.prototype.peek = function(index) {
  var val = null;
  index = index || 0;
  index += this.__position;
  if (index >= 0 && index < this.__input_length) {
    val = this.__input.charAt(index);
  }
  return val;
};

// This is a JavaScript only helper function (not in python)
// Javascript doesn't have a match method
// and not all implementation support "sticky" flag.
// If they do not support sticky then both this.match() and this.test() method
// must get the match and check the index of the match.
// If sticky is supported and set, this method will use it.
// Otherwise it will check that global is set, and fall back to the slower method.
InputScanner.prototype.__match = function(pattern, index) {
  pattern.lastIndex = index;
  var pattern_match = pattern.exec(this.__input);

  if (pattern_match && !(regexp_has_sticky && pattern.sticky)) {
    if (pattern_match.index !== index) {
      pattern_match = null;
    }
  }

  return pattern_match;
};

InputScanner.prototype.test = function(pattern, index) {
  index = index || 0;
  index += this.__position;

  if (index >= 0 && index < this.__input_length) {
    return !!this.__match(pattern, index);
  } else {
    return false;
  }
};

InputScanner.prototype.testChar = function(pattern, index) {
  // test one character regex match
  var val = this.peek(index);
  pattern.lastIndex = 0;
  return val !== null && pattern.test(val);
};

InputScanner.prototype.match = function(pattern) {
  var pattern_match = this.__match(pattern, this.__position);
  if (pattern_match) {
    this.__position += pattern_match[0].length;
  } else {
    pattern_match = null;
  }
  return pattern_match;
};

InputScanner.prototype.read = function(starting_pattern, until_pattern, until_after) {
  var val = '';
  var match;
  if (starting_pattern) {
    match = this.match(starting_pattern);
    if (match) {
      val += match[0];
    }
  }
  if (until_pattern && (match || !starting_pattern)) {
    val += this.readUntil(until_pattern, until_after);
  }
  return val;
};

InputScanner.prototype.readUntil = function(pattern, until_after) {
  var val = '';
  var match_index = this.__position;
  pattern.lastIndex = this.__position;
  var pattern_match = pattern.exec(this.__input);
  if (pattern_match) {
    match_index = pattern_match.index;
    if (until_after) {
      match_index += pattern_match[0].length;
    }
  } else {
    match_index = this.__input_length;
  }

  val = this.__input.substring(this.__position, match_index);
  this.__position = match_index;
  return val;
};

InputScanner.prototype.readUntilAfter = function(pattern) {
  return this.readUntil(pattern, true);
};

InputScanner.prototype.get_regexp = function(pattern, match_from) {
  var result = null;
  var flags = 'g';
  if (match_from && regexp_has_sticky) {
    flags = 'y';
  }
  // strings are converted to regexp
  if (typeof pattern === "string" && pattern !== '') {
    // result = new RegExp(pattern.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), flags);
    result = new RegExp(pattern, flags);
  } else if (pattern) {
    result = new RegExp(pattern.source, flags);
  }
  return result;
};

InputScanner.prototype.get_literal_regexp = function(literal_string) {
  return RegExp(literal_string.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'));
};

/* css beautifier legacy helpers */
InputScanner.prototype.peekUntilAfter = function(pattern) {
  var start = this.__position;
  var val = this.readUntilAfter(pattern);
  this.__position = start;
  return val;
};

InputScanner.prototype.lookBack = function(testVal) {
  var start = this.__position - 1;
  return start >= testVal.length && this.__input.substring(start - testVal.length, start)
    .toLowerCase() === testVal;
};

module.exports.InputScanner = InputScanner;


/***/ }),
/* 9 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_122492__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var InputScanner = __nested_webpack_require_122492__(8).InputScanner;
var Token = __nested_webpack_require_122492__(3).Token;
var TokenStream = __nested_webpack_require_122492__(10).TokenStream;
var WhitespacePattern = __nested_webpack_require_122492__(11).WhitespacePattern;

var TOKEN = {
  START: 'TK_START',
  RAW: 'TK_RAW',
  EOF: 'TK_EOF'
};

var Tokenizer = function(input_string, options) {
  this._input = new InputScanner(input_string);
  this._options = options || {};
  this.__tokens = null;

  this._patterns = {};
  this._patterns.whitespace = new WhitespacePattern(this._input);
};

Tokenizer.prototype.tokenize = function() {
  this._input.restart();
  this.__tokens = new TokenStream();

  this._reset();

  var current;
  var previous = new Token(TOKEN.START, '');
  var open_token = null;
  var open_stack = [];
  var comments = new TokenStream();

  while (previous.type !== TOKEN.EOF) {
    current = this._get_next_token(previous, open_token);
    while (this._is_comment(current)) {
      comments.add(current);
      current = this._get_next_token(previous, open_token);
    }

    if (!comments.isEmpty()) {
      current.comments_before = comments;
      comments = new TokenStream();
    }

    current.parent = open_token;

    if (this._is_opening(current)) {
      open_stack.push(open_token);
      open_token = current;
    } else if (open_token && this._is_closing(current, open_token)) {
      current.opened = open_token;
      open_token.closed = current;
      open_token = open_stack.pop();
      current.parent = open_token;
    }

    current.previous = previous;
    previous.next = current;

    this.__tokens.add(current);
    previous = current;
  }

  return this.__tokens;
};


Tokenizer.prototype._is_first_token = function() {
  return this.__tokens.isEmpty();
};

Tokenizer.prototype._reset = function() {};

Tokenizer.prototype._get_next_token = function(previous_token, open_token) { // jshint unused:false
  this._readWhitespace();
  var resulting_string = this._input.read(/.+/g);
  if (resulting_string) {
    return this._create_token(TOKEN.RAW, resulting_string);
  } else {
    return this._create_token(TOKEN.EOF, '');
  }
};

Tokenizer.prototype._is_comment = function(current_token) { // jshint unused:false
  return false;
};

Tokenizer.prototype._is_opening = function(current_token) { // jshint unused:false
  return false;
};

Tokenizer.prototype._is_closing = function(current_token, open_token) { // jshint unused:false
  return false;
};

Tokenizer.prototype._create_token = function(type, text) {
  var token = new Token(type, text,
    this._patterns.whitespace.newline_count,
    this._patterns.whitespace.whitespace_before_token);
  return token;
};

Tokenizer.prototype._readWhitespace = function() {
  return this._patterns.whitespace.read();
};



module.exports.Tokenizer = Tokenizer;
module.exports.TOKEN = TOKEN;


/***/ }),
/* 10 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function TokenStream(parent_token) {
  // private
  this.__tokens = [];
  this.__tokens_length = this.__tokens.length;
  this.__position = 0;
  this.__parent_token = parent_token;
}

TokenStream.prototype.restart = function() {
  this.__position = 0;
};

TokenStream.prototype.isEmpty = function() {
  return this.__tokens_length === 0;
};

TokenStream.prototype.hasNext = function() {
  return this.__position < this.__tokens_length;
};

TokenStream.prototype.next = function() {
  var val = null;
  if (this.hasNext()) {
    val = this.__tokens[this.__position];
    this.__position += 1;
  }
  return val;
};

TokenStream.prototype.peek = function(index) {
  var val = null;
  index = index || 0;
  index += this.__position;
  if (index >= 0 && index < this.__tokens_length) {
    val = this.__tokens[index];
  }
  return val;
};

TokenStream.prototype.add = function(token) {
  if (this.__parent_token) {
    token.parent = this.__parent_token;
  }
  this.__tokens.push(token);
  this.__tokens_length += 1;
};

module.exports.TokenStream = TokenStream;


/***/ }),
/* 11 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_128904__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Pattern = __nested_webpack_require_128904__(12).Pattern;

function WhitespacePattern(input_scanner, parent) {
  Pattern.call(this, input_scanner, parent);
  if (parent) {
    this._line_regexp = this._input.get_regexp(parent._line_regexp);
  } else {
    this.__set_whitespace_patterns('', '');
  }

  this.newline_count = 0;
  this.whitespace_before_token = '';
}
WhitespacePattern.prototype = new Pattern();

WhitespacePattern.prototype.__set_whitespace_patterns = function(whitespace_chars, newline_chars) {
  whitespace_chars += '\\t ';
  newline_chars += '\\n\\r';

  this._match_pattern = this._input.get_regexp(
    '[' + whitespace_chars + newline_chars + ']+', true);
  this._newline_regexp = this._input.get_regexp(
    '\\r\\n|[' + newline_chars + ']');
};

WhitespacePattern.prototype.read = function() {
  this.newline_count = 0;
  this.whitespace_before_token = '';

  var resulting_string = this._input.read(this._match_pattern);
  if (resulting_string === ' ') {
    this.whitespace_before_token = ' ';
  } else if (resulting_string) {
    var matches = this.__split(this._newline_regexp, resulting_string);
    this.newline_count = matches.length - 1;
    this.whitespace_before_token = matches[this.newline_count];
  }

  return resulting_string;
};

WhitespacePattern.prototype.matching = function(whitespace_chars, newline_chars) {
  var result = this._create();
  result.__set_whitespace_patterns(whitespace_chars, newline_chars);
  result._update();
  return result;
};

WhitespacePattern.prototype._create = function() {
  return new WhitespacePattern(this._input, this);
};

WhitespacePattern.prototype.__split = function(regexp, input_string) {
  regexp.lastIndex = 0;
  var start_index = 0;
  var result = [];
  var next_match = regexp.exec(input_string);
  while (next_match) {
    result.push(input_string.substring(start_index, next_match.index));
    start_index = next_match.index + next_match[0].length;
    next_match = regexp.exec(input_string);
  }

  if (start_index < input_string.length) {
    result.push(input_string.substring(start_index, input_string.length));
  } else {
    result.push('');
  }

  return result;
};



module.exports.WhitespacePattern = WhitespacePattern;


/***/ }),
/* 12 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Pattern(input_scanner, parent) {
  this._input = input_scanner;
  this._starting_pattern = null;
  this._match_pattern = null;
  this._until_pattern = null;
  this._until_after = false;

  if (parent) {
    this._starting_pattern = this._input.get_regexp(parent._starting_pattern, true);
    this._match_pattern = this._input.get_regexp(parent._match_pattern, true);
    this._until_pattern = this._input.get_regexp(parent._until_pattern);
    this._until_after = parent._until_after;
  }
}

Pattern.prototype.read = function() {
  var result = this._input.read(this._starting_pattern);
  if (!this._starting_pattern || result) {
    result += this._input.read(this._match_pattern, this._until_pattern, this._until_after);
  }
  return result;
};

Pattern.prototype.read_match = function() {
  return this._input.match(this._match_pattern);
};

Pattern.prototype.until_after = function(pattern) {
  var result = this._create();
  result._until_after = true;
  result._until_pattern = this._input.get_regexp(pattern);
  result._update();
  return result;
};

Pattern.prototype.until = function(pattern) {
  var result = this._create();
  result._until_after = false;
  result._until_pattern = this._input.get_regexp(pattern);
  result._update();
  return result;
};

Pattern.prototype.starting_with = function(pattern) {
  var result = this._create();
  result._starting_pattern = this._input.get_regexp(pattern, true);
  result._update();
  return result;
};

Pattern.prototype.matching = function(pattern) {
  var result = this._create();
  result._match_pattern = this._input.get_regexp(pattern, true);
  result._update();
  return result;
};

Pattern.prototype._create = function() {
  return new Pattern(this._input, this);
};

Pattern.prototype._update = function() {};

module.exports.Pattern = Pattern;


/***/ }),
/* 13 */
/***/ (function(module) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



function Directives(start_block_pattern, end_block_pattern) {
  start_block_pattern = typeof start_block_pattern === 'string' ? start_block_pattern : start_block_pattern.source;
  end_block_pattern = typeof end_block_pattern === 'string' ? end_block_pattern : end_block_pattern.source;
  this.__directives_block_pattern = new RegExp(start_block_pattern + / beautify( \w+[:]\w+)+ /.source + end_block_pattern, 'g');
  this.__directive_pattern = / (\w+)[:](\w+)/g;

  this.__directives_end_ignore_pattern = new RegExp(start_block_pattern + /\sbeautify\signore:end\s/.source + end_block_pattern, 'g');
}

Directives.prototype.get_directives = function(text) {
  if (!text.match(this.__directives_block_pattern)) {
    return null;
  }

  var directives = {};
  this.__directive_pattern.lastIndex = 0;
  var directive_match = this.__directive_pattern.exec(text);

  while (directive_match) {
    directives[directive_match[1]] = directive_match[2];
    directive_match = this.__directive_pattern.exec(text);
  }

  return directives;
};

Directives.prototype.readIgnored = function(input) {
  return input.readUntilAfter(this.__directives_end_ignore_pattern);
};


module.exports.Directives = Directives;


/***/ }),
/* 14 */
/***/ (function(module, __unused_webpack_exports, __nested_webpack_require_137889__) {

/*jshint node:true */
/*

  The MIT License (MIT)

  Copyright (c) 2007-2018 Einar Lielmanis, Liam Newman, and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.
*/



var Pattern = __nested_webpack_require_137889__(12).Pattern;


var template_names = {
  django: false,
  erb: false,
  handlebars: false,
  php: false,
  smarty: false
};

// This lets templates appear anywhere we would do a readUntil
// The cost is higher but it is pay to play.
function TemplatablePattern(input_scanner, parent) {
  Pattern.call(this, input_scanner, parent);
  this.__template_pattern = null;
  this._disabled = Object.assign({}, template_names);
  this._excluded = Object.assign({}, template_names);

  if (parent) {
    this.__template_pattern = this._input.get_regexp(parent.__template_pattern);
    this._excluded = Object.assign(this._excluded, parent._excluded);
    this._disabled = Object.assign(this._disabled, parent._disabled);
  }
  var pattern = new Pattern(input_scanner);
  this.__patterns = {
    handlebars_comment: pattern.starting_with(/{{!--/).until_after(/--}}/),
    handlebars_unescaped: pattern.starting_with(/{{{/).until_after(/}}}/),
    handlebars: pattern.starting_with(/{{/).until_after(/}}/),
    php: pattern.starting_with(/<\?(?:[= ]|php)/).until_after(/\?>/),
    erb: pattern.starting_with(/<%[^%]/).until_after(/[^%]%>/),
    // django coflicts with handlebars a bit.
    django: pattern.starting_with(/{%/).until_after(/%}/),
    django_value: pattern.starting_with(/{{/).until_after(/}}/),
    django_comment: pattern.starting_with(/{#/).until_after(/#}/),
    smarty: pattern.starting_with(/{(?=[^}{\s\n])/).until_after(/[^\s\n]}/),
    smarty_comment: pattern.starting_with(/{\*/).until_after(/\*}/),
    smarty_literal: pattern.starting_with(/{literal}/).until_after(/{\/literal}/)
  };
}
TemplatablePattern.prototype = new Pattern();

TemplatablePattern.prototype._create = function() {
  return new TemplatablePattern(this._input, this);
};

TemplatablePattern.prototype._update = function() {
  this.__set_templated_pattern();
};

TemplatablePattern.prototype.disable = function(language) {
  var result = this._create();
  result._disabled[language] = true;
  result._update();
  return result;
};

TemplatablePattern.prototype.read_options = function(options) {
  var result = this._create();
  for (var language in template_names) {
    result._disabled[language] = options.templating.indexOf(language) === -1;
  }
  result._update();
  return result;
};

TemplatablePattern.prototype.exclude = function(language) {
  var result = this._create();
  result._excluded[language] = true;
  result._update();
  return result;
};

TemplatablePattern.prototype.read = function() {
  var result = '';
  if (this._match_pattern) {
    result = this._input.read(this._starting_pattern);
  } else {
    result = this._input.read(this._starting_pattern, this.__template_pattern);
  }
  var next = this._read_template();
  while (next) {
    if (this._match_pattern) {
      next += this._input.read(this._match_pattern);
    } else {
      next += this._input.readUntil(this.__template_pattern);
    }
    result += next;
    next = this._read_template();
  }

  if (this._until_after) {
    result += this._input.readUntilAfter(this._until_pattern);
  }
  return result;
};

TemplatablePattern.prototype.__set_templated_pattern = function() {
  var items = [];

  if (!this._disabled.php) {
    items.push(this.__patterns.php._starting_pattern.source);
  }
  if (!this._disabled.handlebars) {
    items.push(this.__patterns.handlebars._starting_pattern.source);
  }
  if (!this._disabled.erb) {
    items.push(this.__patterns.erb._starting_pattern.source);
  }
  if (!this._disabled.django) {
    items.push(this.__patterns.django._starting_pattern.source);
    // The starting pattern for django is more complex because it has different
    // patterns for value, comment, and other sections
    items.push(this.__patterns.django_value._starting_pattern.source);
    items.push(this.__patterns.django_comment._starting_pattern.source);
  }
  if (!this._disabled.smarty) {
    items.push(this.__patterns.smarty._starting_pattern.source);
  }

  if (this._until_pattern) {
    items.push(this._until_pattern.source);
  }
  this.__template_pattern = this._input.get_regexp('(?:' + items.join('|') + ')');
};

TemplatablePattern.prototype._read_template = function() {
  var resulting_string = '';
  var c = this._input.peek();
  if (c === '<') {
    var peek1 = this._input.peek(1);
    //if we're in a comment, do something special
    // We treat all comments as literals, even more than preformatted tags
    // we just look for the appropriate close tag
    if (!this._disabled.php && !this._excluded.php && peek1 === '?') {
      resulting_string = resulting_string ||
        this.__patterns.php.read();
    }
    if (!this._disabled.erb && !this._excluded.erb && peek1 === '%') {
      resulting_string = resulting_string ||
        this.__patterns.erb.read();
    }
  } else if (c === '{') {
    if (!this._disabled.handlebars && !this._excluded.handlebars) {
      resulting_string = resulting_string ||
        this.__patterns.handlebars_comment.read();
      resulting_string = resulting_string ||
        this.__patterns.handlebars_unescaped.read();
      resulting_string = resulting_string ||
        this.__patterns.handlebars.read();
    }
    if (!this._disabled.django) {
      // django coflicts with handlebars a bit.
      if (!this._excluded.django && !this._excluded.handlebars) {
        resulting_string = resulting_string ||
          this.__patterns.django_value.read();
      }
      if (!this._excluded.django) {
        resulting_string = resulting_string ||
          this.__patterns.django_comment.read();
        resulting_string = resulting_string ||
          this.__patterns.django.read();
      }
    }
    if (!this._disabled.smarty) {
      // smarty cannot be enabled with django or handlebars enabled
      if (this._disabled.django && this._disabled.handlebars) {
        resulting_string = resulting_string ||
          this.__patterns.smarty_comment.read();
        resulting_string = resulting_string ||
          this.__patterns.smarty_literal.read();
        resulting_string = resulting_string ||
          this.__patterns.smarty.read();
      }
    }
  }
  return resulting_string;
};


module.exports.TemplatablePattern = TemplatablePattern;


/***/ })
/******/ 	]);
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __nested_webpack_require_145562__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __nested_webpack_require_145562__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __nested_webpack_exports__ = __nested_webpack_require_145562__(0);
/******/ 	legacy_beautify_js = __nested_webpack_exports__;
/******/ 	
/******/ })()
;
var js_beautify = legacy_beautify_js;
/* Footer */
if (true) {
    // Add support for AMD ( https://github.com/amdjs/amdjs-api/wiki/AMD#defineamd-property- )
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (function() {
        return { js_beautify: js_beautify };
    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
} else {}

}());



/***/ }),

/***/ 289:
/***/ ((__unused_webpack_module, exports) => {

"use strict";
var __webpack_unused_export__;

__webpack_unused_export__ = ({ value: true });
exports.Ku = void 0;
/* global exports, Map */
/**
 * Calculate similarity between two strings
 * @param {string} str1 First string to match
 * @param {string} str2 Second string to match
 * @param {number} [substringLength=2] Optional. Length of substring to be used in calculating similarity. Default 2.
 * @param {boolean} [caseSensitive=false] Optional. Whether you want to consider case in string matching. Default false;
 * @returns Number between 0 and 1, with 0 being a low match score.
 */
var stringSimilarity = function (str1, str2, substringLength, caseSensitive) {
    if (substringLength === void 0) { substringLength = 2; }
    if (caseSensitive === void 0) { caseSensitive = false; }
    if (!caseSensitive) {
        str1 = str1.toLowerCase();
        str2 = str2.toLowerCase();
    }
    if (str1.length < substringLength || str2.length < substringLength)
        return 0;
    var map = new Map();
    for (var i = 0; i < str1.length - (substringLength - 1); i++) {
        var substr1 = str1.substr(i, substringLength);
        map.set(substr1, map.has(substr1) ? map.get(substr1) + 1 : 1);
    }
    var match = 0;
    for (var j = 0; j < str2.length - (substringLength - 1); j++) {
        var substr2 = str2.substr(j, substringLength);
        var count = map.has(substr2) ? map.get(substr2) : 0;
        if (count > 0) {
            map.set(substr2, count - 1);
            match++;
        }
    }
    return (match * 2) / (str1.length + str2.length - ((substringLength - 1) * 2));
};
exports.Ku = stringSimilarity;
__webpack_unused_export__ = exports.Ku;
//# sourceMappingURL=string-similarity.js.map

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ contentbuilder)
});

;// CONCATENATED MODULE: ./src/contentbuilder/snippets.js
function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Snippets = /*#__PURE__*/function () {
  function Snippets(builder) {
    _classCallCheck(this, Snippets);
    this.builder = builder;
    var util = this.builder.util;
    this.util = util;
  }
  _createClass(Snippets, [{
    key: "getSnippetsHtml",
    value: function getSnippetsHtml() {
      var util = this.util;
      var snippetUrl = this.builder.opts.snippetUrl;
      var snippetPath = this.builder.opts.snippetPath;
      var snippetCategoriesString = '[';
      for (var i = 0; i < this.builder.opts.snippetCategories.length; i++) {
        snippetCategoriesString += "[".concat(this.builder.opts.snippetCategories[i][0], ",'").concat(util.out(this.builder.opts.snippetCategories[i][1]), "'],");
      }
      snippetCategoriesString += ']';
      var defaultSnippetCategory = this.builder.opts.defaultSnippetCategory;
      var html = "\n        <!DOCTYPE HTML>\n        <html>\n        \n        <head>\n            <meta charset=\"utf-8\">\n            <title></title>\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n            <meta name=\"description\" content=\"\">\n            <script src=\"".concat(snippetUrl, "\"></script>\n            <style>\n                body {\n                    // background: #fff;\n                    background: ").concat(this.builder.styleSnippetBackground, ";\n                    margin: 0;\n                }\n\n                .is-pop-close {\n                    display: flex;\n                    justify-content: center;\n                    align-items: center;\n                    border: none;\n                    background: transparent;\n                    z-index:10;width:30px;height:30px;position:absolute;\n                    top:2px;right:2px;box-sizing:border-box;padding:0;line-height:40px;font-size: 12px;text-align:center;cursor:pointer;\n                }\n                .is-pop-close:focus-visible {\n                    outline:  ").concat(this.builder.styleOutlineColor, " 2px solid;\n                }\n\n                /*\n                body.dark {\n                    background: #111;\n                }\n                .dark .is-categories {\n                    background: #333;\n                }\n                .dark .is-category-list a {\n                    background: #333;\n                    color: #fff;\n                }\n                .dark .is-category-list a.active {\n                    background: #525252;\n                    color: #fff;\n                }\n                .dark .is-category-list a:hover {\n                    color: #fff;\n                }\n                .dark .is-design-list>li img {\n                    opacity: 0.93;\n                }\n                .dark .is-more-categories {\n                    background: #333;\n                }\n                .dark .is-more-categories a {\n                    background: #333;\n                    color: #fff;\n                }\n                .dark .is-more-categories a:hover,\n                .dark .is-more-categories a:focus {\n                    background: #4c4c4c;\n                }\n                .dark .is-more-categories a.active {\n                    background: #4c4c4c;\n                }\n                */\n\n                \n                .dark .is-design-list>li {\n                    outline: transparent 1px solid;\n                }\n\n                \n                        \n                /* Scrollbar for modal */\n\n                /* Darker color, because background for snippet thumbnails is always light. */\n                .dark * {\n                    scrollbar-width: thin;\n                    scrollbar-color: rgb(78 78 78 / 62%) auto;\n                }\n                .dark *::-webkit-scrollbar {\n                    width: 12px;\n                }\n                .dark *::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n                .dark *::-webkit-scrollbar-thumb {\n                    background-color:rgb(78 78 78 / 62%);\n                } \n\n                .colored-dark * {\n                    scrollbar-width: thin;\n                    scrollbar-color: rgb(100, 100, 100) auto;\n                }\n                .colored-dark *::-webkit-scrollbar {\n                    width: 12px;\n                }\n                .colored-dark *::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n                .colored-dark *::-webkit-scrollbar-thumb {\n                    background-color:rgb(100, 100, 100);\n                } \n\n                .colored * {\n                    scrollbar-width: thin;\n                    scrollbar-color: rgba(0, 0, 0, 0.4) auto;\n                }\n                .colored *::-webkit-scrollbar {\n                    width: 12px;\n                }\n                .colored *::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n                .colored *::-webkit-scrollbar-thumb {\n                    background-color: rgba(0, 0, 0, 0.4);\n                } \n\n                .light * {\n                    scrollbar-width: thin;\n                    scrollbar-color: rgba(0, 0, 0, 0.4) auto;\n                }\n                .light *::-webkit-scrollbar {\n                    width: 12px;\n                }\n                .light *::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n                .light *::-webkit-scrollbar-thumb {\n                    background-color: rgba(0, 0, 0, 0.4);\n                } \n        \n                svg {\n                    fill: ").concat(this.builder.styleSnippetColor, ";\n                }\n\n                .is-design-list {\n                    position: fixed;\n                    top: 0px;\n                    left: 0px;\n                    border-top: transparent 68px solid;\n                    width: 100%;\n                    height: 100%;\n                    overflow-y: auto;\n                    padding: 0px 0px 30px 30px;\n                    box-sizing: border-box;\n                    overflow: auto;\n                    list-style: none;\n                    margin: 0;\n                }\n        \n                .is-design-list>li {\n                    width: 250px;\n                    min-height:120px;\n                    position:relative;\n                    background: #fff;\n                    // background: ").concat(this.builder.styleToolBackground, ";\n                    overflow: hidden;\n                    margin: 32px 40px 0 0;\n                    cursor: pointer;\n                    display: inline-block;\n                    outline: #ececec 1px solid;\n                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);\n                    border-radius: 2px;\n                }\n\n                .is-design-list>li:focus-visible {\n                    outline:  ").concat(this.builder.styleOutlineColor, " 2px solid;\n                }\n\n                .is-design-list>li img {\n                    box-shadow: none;\n                    opacity: 1;\n                    display: block;\n                    box-sizing: border-box;\n                    transition: all 0.2s ease-in-out;\n                    max-width: 400px;\n                    width: 100%\n                }\n        \n                // .is-design-list>li:hover img {\n                //     opacity: 0.95;\n                // }\n                \n                // .is-design-list>li:hover {\n                //     background: #999;\n                // }\n                .is-overlay {\n                    position:absolute;left:0px;top:0px;width:100%;height:100%;\n                }\n                .is-design-list>li .is-overlay:after {\n                    background: rgba(0, 0, 0, 0.02);\n                    position: absolute;\n                    content: \"\";\n                    display: block;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    transition: all 0.3s ease-in-out;\n                    opacity: 0;\n                }\n                .is-design-list>li:hover .is-overlay:after,\n                .is-design-list>li:focus .is-overlay:after {\n                    opacity: 0.9;\n                }\n                .dark .is-design-list>li .is-overlay:after {\n                    background: rgb(78 78 78 / 13%);\n                }\n        \n                .is-category-list {\n                    position: relative;\n                    top: 0px;\n                    left: 0px;\n                    width: 100%;\n                    height: 80px;\n                    box-sizing: border-box;\n                    z-index: 1;\n                }\n        \n                .is-category-list>div {\n                    white-space: nowrap;\n                    padding: 0 30px;\n                    box-sizing: border-box;\n                    font-family: sans-serif;\n                    font-size: 10px;\n                    text-transform: uppercase;\n                    letter-spacing: 2px;\n                    // background: #f5f5f5;\n                    background: ").concat(this.builder.styleSnippetTabsBackground, ";\n                    // box-shadow: 0 5px 8px rgb(0 0 0 / 4%);\n                }\n        \n                .is-category-list a {\n                    display: inline-block;\n                    padding: 10px 20px;\n                    // background: #fefefe;\n                    // color: #000;\n                    background: ").concat(this.builder.styleSnippetTabItemBackground, ";\n                    color: ").concat(this.builder.styleSnippetTabItemColor, ";\n                    border-radius: 50px;\n        \n                    margin: 0 12px 0 0;\n                    text-decoration: none;\n                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);\n                    transition: box-shadow ease 0.3s;\n                }\n        \n                .is-category-list a:hover {\n                    /*background: #fafafa;*/\n                    background: ").concat(this.builder.styleSnippetTabItemBackgroundHover, ";\n                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.06);\n                    // color: #000;\n                    color: ").concat(this.builder.styleSnippetTabItemColor, ";\n                }\n        \n                .is-category-list a.active {\n                    // background: #f5f5f5;\n                    background: ").concat(this.builder.styleSnippetTabItemBackgroundActive, ";\n                    // color: #000;\n                    color: ").concat(this.builder.styleSnippetTabItemColor, ";\n                    box-shadow: none;\n                    cursor: default;\n                }\n\n                .is-category-list a:focus-visible {\n                    outline:  ").concat(this.builder.styleOutlineColor, " 2px solid;\n                }\n        \n                .is-more-categories {\n                    display: none;\n                    position: absolute;\n                    width: 400px;\n                    box-sizing: border-box;\n                    padding: 0;\n                    z-index: 1;\n                    font-family: sans-serif;\n                    font-size: 10px;\n                    text-transform: uppercase;\n                    letter-spacing: 2px;\n                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);\n                    // background: #fff;\n                    background: ").concat(this.builder.styleSnippetMoreItemBackground, ";\n                }\n        \n                .is-more-categories a {\n                    width: 200px;\n                    float: left;\n                    display: block;\n                    box-sizing: border-box;\n                    padding: 12px 20px;\n                    // background: #fff;\n                    background: ").concat(this.builder.styleSnippetMoreItemBackground, ";\n                    text-decoration: none;\n                    // color: #000;\n                    color: ").concat(this.builder.styleSnippetMoreItemColor, ";\n                    line-height: 1.6;\n                    outline: none;\n                }\n        \n                .is-more-categories a:hover,\n                .is-more-categories a:focus {\n                    // background: #eee;\n                    background: ").concat(this.builder.styleSnippetMoreItemBackgroundHover, ";\n                }\n        \n                .is-more-categories a.active {\n                    // background: #eee;\n                    background: ").concat(this.builder.styleSnippetMoreItemBackgroundActive, ";\n                }\n        \n                .is-more-categories.active {\n                    display: block;\n                }\n        \n                /* First Loading */\n                /* .is-category-list {\n                    display: none;\n                }\n        \n                .is-design-list {\n                    display: none;\n                }\n        \n                .pace {\n                    -webkit-pointer-events: none;\n                    pointer-events: none;\n                    -webkit-user-select: none;\n                    -moz-user-select: none;\n                    user-select: none;\n                }\n        \n                .pace-inactive {\n                    display: none;\n                }\n        \n                .pace .pace-progress {\n                    background: #000000;\n                    position: fixed;\n                    z-index: 2000;\n                    top: 0;\n                    right: 100%;\n                    width: 100%;\n                    height: 2px;\n                } */\n        \n                .is-more-categories>a:nth-child(0) {\n                    display: none\n                }\n        \n                .is-more-categories>a:nth-child(1) {\n                    display: none\n                }\n        \n                .is-more-categories>a:nth-child(2) {\n                    display: none\n                }\n        \n                .is-more-categories>a:nth-child(3) {\n                    display: none\n                }\n        \n                .is-more-categories>a:nth-child(4) {\n                    display: none\n                }\n        \n                .is-more-categories>a:nth-child(5) {\n                    display: none\n                }\n        \n                .is-more-categories>a:nth-child(6) {\n                    display: none\n                }\n        \n                .is-more-categories>a:nth-child(7) {\n                    display: none\n                }\n        \n                @media all and (max-width: 1212px) {\n                    .is-categories>a:nth-child(7):not(.more-snippets) {\n                        display: none\n                    }\n        \n                    .is-more-categories>a:nth-child(7) {\n                        display: block\n                    }\n                }\n        \n                @media all and (max-width: 1070px) {\n                    .is-categories>a:nth-child(6):not(.more-snippets) {\n                        display: none\n                    }\n        \n                    .is-more-categories>a:nth-child(6) {\n                        display: block\n                    }\n                }\n        \n                @media all and (max-width: 940px) {\n                    .is-categories>a:nth-child(5):not(.more-snippets) {\n                        display: none\n                    }\n        \n                    .is-more-categories>a:nth-child(5) {\n                        display: block\n                    }\n                }\n        \n                @media all and (max-width: 700px) {\n                    .is-categories>a:nth-child(4):not(.more-snippets) {\n                        display: none\n                    }\n        \n                    .is-more-categories>a:nth-child(4) {\n                        display: block\n                    }\n                }\n        \n                @media all and (max-width: 555px) {\n                    .is-categories>a:nth-child(3):not(.more-snippets) {\n                        display: none\n                    }\n        \n                    .is-more-categories>a:nth-child(3) {\n                        display: block\n                    }\n                }\n        \n                @media all and (max-width: 415px) {\n                    .is-categories>a:nth-child(2):not(.more-snippets) {\n                        display: none\n                    }\n        \n                    .is-more-categories>a:nth-child(2) {\n                        display: block\n                    }\n                }\n        \n                @media all and (max-width: 640px) {\n                    .is-more-categories a {\n                        width: 150px;\n                        padding: 10px 5px 10px 15px;\n                        font-size: 10px;\n                    }\n        \n                    .is-more-categories {\n                        left: 0 !important;\n                        width: 100% !important;\n                    }\n                }\n\n\n                * {\n                    scrollbar-width: thin;\n                    scrollbar-color: rgba(0, 0, 0, 0.2) auto;\n                }\n                *::-webkit-scrollbar {\n                    width: 12px;\n                }\n                *::-webkit-scrollbar-track {\n                    background: rgba(200, 200, 200, 0.2);\n                }\n                *::-webkit-scrollbar-thumb {\n                    background-color:rgba(0, 0, 0, 0.2); \n                }\n            </style>\n        </head>\n        \n        <body").concat(this.builder.styleDark ? ' class="dark"' : '').concat(this.builder.styleColored ? ' class="colored"' : '').concat(this.builder.styleColoredDark ? ' class="colored-dark"' : '').concat(this.builder.styleLight ? ' class="light"' : '', ">\n\n            <svg style=\"display:none\">\n                <defs>\n                    <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-close-empty\">\n                        <path d=\"M340.2 160l-84.4 84.3-84-83.9-11.8 11.8 84 83.8-84 83.9 11.8 11.7 84-83.8 84.4 84.2 11.8-11.7-84.4-84.3 84.4-84.2z\"></path>\n                    </symbol>\n                </defs>\n            </svg>\n        \n            <button class=\"is-pop-close\" tabindex=\"-1\">\n                <svg class=\"is-icon-flex\" style=\"width:30px;height:30px;\">\n                    <use xlink:href=\"#ion-ios-close-empty\"></use>\n                </svg>\n            </button>\n        \n            <div class=\"is-category-list\">\n                <div class=\"is-categories\" style=\"position:fixed;top:0;left:0;right:0;height:68px;padding-top:17px;box-sizing:border-box;\">\n                </div>\n            </div>\n\n            <div class=\"is-more-categories\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            </div>\n        \n            <ul class=\"is-design-list\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            </ul>\n        \n            <script").concat(this.builder.nonce ? " nonce=\"".concat(this.builder.nonce, "\"") : '', ">\n        \n                var snippetPath = '").concat(snippetPath, "';\n                var snippetCategories = ").concat(snippetCategoriesString, ";\n                var defaultSnippetCategory = ").concat(defaultSnippetCategory, ";\n\n                ").concat(typeof this.builder.slider !== 'undefined' && this.builder.slider !== null ? "\n                var slider='".concat(this.builder.slider, "';") : 'var slider=null;', ";\n        \n                var numOfCat = snippetCategories.length;\n                if (numOfCat <= 7) {\n                    document.querySelector('.is-more-categories').style.width = '200px';\n                }\n        \n                var categorytabs = document.querySelector('.is-categories');\n                categorytabs.innerHTML = '';\n                let html_catselect = '';\n                for (var i = 0; i < numOfCat; i++) {\n                    if (i < 7) {\n                        html_catselect += '<a href=\"\" data-cat=\"' + snippetCategories[i][0] + '\">' + parent._cb.out(snippetCategories[i][1]) + '</a>';\n                    }\n                }\n                html_catselect += '<a href=\"\" class=\"more-snippets\">' + parent._cb.out('More') + '</a>';\n                categorytabs.innerHTML = html_catselect;\n        \n                var categorymore = document.querySelector('.is-more-categories');\n                html_catselect = '';\n                for (var i = 0; i < numOfCat; i++) {\n                    html_catselect += '<a href=\"\" data-cat=\"' + snippetCategories[i][0] + '\">' + parent._cb.out(snippetCategories[i][1]) + '</a>';\n                }\n                categorymore.innerHTML = html_catselect;\n        \n                // Show/hide \"More\" button\n                if (numOfCat <= 7) {\n                    var bHasMore = false;\n        \n                    const childNodes = categorymore.childNodes;\n                    let i = childNodes.length;\n                    while (i--) {\n                        if(childNodes[i].style.display === 'block') {\n                            bHasMore = true;\n                        }\n                    }\n                    var more = document.querySelector('.more-snippets');\n                    if (!bHasMore) more.style.display = 'none';\n                    else more.style.display = '';\n                }\n        \n                var elms = categorytabs.querySelectorAll('a[data-cat=\"' + defaultSnippetCategory + '\"]'); //.classList.add('active');\n                Array.prototype.forEach.call(elms, function(elm){\n                    elm.classList.add('active');\n                });\n                elms = categorymore.querySelectorAll('a[data-cat=\"' + defaultSnippetCategory + '\"]'); //.classList.add('active');\n                Array.prototype.forEach.call(elms, function(elm){\n                    elm.classList.add('active');\n                });\n\n\n                document.addEventListener('keydown', function(e){\n                    if(e.keyCode === 27) { // escape key\n                        const moreCategories = document.querySelector('.is-more-categories');\n                        if(moreCategories.classList.contains('active')) {\n                            moreCategories.classList.remove('active');\n                            const activeTab = categorylist.querySelector('.more-snippets');\n                            activeTab.classList.remove('active');\n                            activeTab.focus();\n                        } else {\n                            const modal = parent.document.querySelector('.is-modal.snippets');\n                            removeClass(modal, 'active');\n                        }\n                    }\n                });\n\n\n                let categorylist = document.querySelector('.is-category-list');\n                let designlist = document.querySelector('.is-design-list');\n\n                const select = (elm) => {\n\n                    if(elm.classList.contains('active')) {\n                        return false;\n                    }\n    \n                    var cat = elm.getAttribute('data-cat');\n                    if (cat) if(designlist.querySelectorAll('[data-cat=\"' + cat + '\"]').length === 0) {\n\n                        for (let i = 0; i <snippets.length; i++) {\n                    \n                            var thumb = snippets[i].thumbnail;\n                            \n                            thumb = snippetPath + thumb;    \n    \n                            if (snippets[i].category === cat) {\n                                designlist.insertAdjacentHTML('beforeend', '<li role=\"button\" tabindex=\"0\" data-id=\"' + snippets[i].id + '\" data-cat=\"' + snippets[i].category + '\"><img src=\"' + thumb + '\"><span class=\"is-overlay\"></span></li>');\n                            \n                                var newitem = designlist.querySelector('[data-id=\"' + snippets[i].id + '\"]');\n                                newitem.addEventListener('click', function(e){\n                                    \n                                    var snippetid = e.target.parentNode.getAttribute('data-id');\n                                    addSnippet(snippetid);\n    \n                                });\n\n                                newitem.addEventListener('keydown', (e)=>{\n                                    if ((e.which === 9 && !e.shiftKey)) { // tab\n                                        let last = false;\n                                        if(e.target.nextElementSibling) {\n                                            if(!e.target.nextElementSibling.classList.contains('active')) {\n                                                last = true;\n                                            }\n                                        } else {\n                                            last = true;\n                                        }\n                                        if(last) {\n                                            e.preventDefault();\n                                            let activeTab = categorylist.querySelector('.active');\n                                            if(activeTab) activeTab.focus();\n                                            else {\n                                                activeTab = categorylist.querySelector('.more-snippets');\n                                                activeTab.focus();\n                                            }\n                                        }\n                                    }\n                                    if ((e.which === 9 && e.shiftKey)) { // shift + tab\n                                        let first = false;\n                                        if(e.target.previousElementSibling) {\n                                            if(!e.target.previousElementSibling.classList.contains('active')) {\n                                                first = true;\n                                            }\n                                        } else {\n                                            first = true;\n                                        }\n                                        if(first) {\n                                            e.preventDefault();\n                                            let activeTab = categorylist.querySelector('.active');\n                                            if(activeTab) activeTab.focus();\n                                            else {\n                                                activeTab = categorylist.querySelector('.more-snippets');\n                                                activeTab.focus();\n                                            }\n                                        }\n                                    }\n                                });\n\n                            }\n    \n                        }    \n                    }\n    \n                    if (cat) {\n                        // Hide all, show items from selected category\n                        var categorylist_items = categorylist.querySelectorAll('a');    \n                        Array.prototype.forEach.call(categorylist_items, function(elm){\n                            elm.className = elm.className.replace('active', '');\n                        });\n                        categorymore.className = categorymore.className.replace('active', ''); \n                        var categorymore_items = categorymore.querySelectorAll('a');\n                        Array.prototype.forEach.call(categorymore_items, function(elm){\n                            elm.className = elm.className.replace('active', '');\n                        });\n    \n                        var items = designlist.querySelectorAll('li');\n                        Array.prototype.forEach.call(items, function(elm){\n                            elm.style.display = 'none';\n                            elm.classList.remove('active');\n                        });\n                        Array.prototype.forEach.call(items, function(elm){\n                            var catSplit = elm.getAttribute('data-cat').split(',');\n                            for (var j = 0; j < catSplit.length; j++) {\n                                if (catSplit[j] == cat) {\n                                    elm.style.display = ''; // TODO: hide & show snippets => animated\n                                    elm.classList.add('active');\n                                }\n                            }\n                        });\n                        \n                    } else {\n                        // show dropdown\n                        var more = document.querySelector('.more-snippets');\n                        var moreCategories = document.querySelector('.is-more-categories');\n    \n                        var _width = moreCategories.offsetWidth;\n                        more.classList.add('active');\n                        moreCategories.classList.add('active');\n                        var top = more.getBoundingClientRect().top;\n                        var left = more.getBoundingClientRect().left;\n                        top = top + 50;\n                        moreCategories.style.top = top + 'px';\n                        moreCategories.style.left = left + 'px';\n                    }\n                    elm.classList.add('active');\n    \n                };\n\n                let tabs = document.querySelectorAll('.is-categories a');\n                Array.prototype.forEach.call(tabs, (tab) => {\n        \n                    tab.addEventListener('keydown', (e)=>{\n                        e.preventDefault();\n        \n                        if ((e.which === 39 && e.target.nextElementSibling)) { // arrow right key pressed\n                            e.target.nextElementSibling.focus();\n                        } else if ((e.which === 37 && e.target.previousElementSibling)) { // arrow left key pressed\n                            e.target.previousElementSibling.focus();\n                        } else if(e.keyCode === 13 || e.keyCode === 32) { // enter or spacebar key\n                            select(e.target);\n                        } else if ((e.which === 9 && !e.shiftKey)) { // tab key pressed\n        \n                            let moreCategories = document.querySelector('.is-more-categories');\n                            if(moreCategories.classList.contains('active')) {\n                 \n                                // Redirect to dropdown list\n                                let firstItem;\n                                let activeItem;\n                                let moreCategories = document.querySelector('.is-more-categories');\n                                let items = moreCategories.querySelectorAll('a');\n                                items.forEach(item=>{\n                                    let display = window.getComputedStyle(item).getPropertyValue('display');\n                                    if(display==='block') {\n                                        item.classList.add('show');\n                                        if(item.classList.contains('active')) {\n                                            activeItem=item;\n                                        }\n                                    } else {\n                                        item.classList.remove('show');\n                                    }\n                                });\n                                firstItem = moreCategories.querySelector('.show');\n                                if(activeItem) {\n                                    activeItem.focus();\n                                } else {\n                                    firstItem.focus();\n                                }\n                                return;\n\n                            }\n\n                            // Redirect to tab content\n                            let inputs = [];\n                            let controls = designlist.querySelectorAll('.active');\n                            controls.forEach(control=>{\n                                inputs.push(control);\n                            });\n        \n                            if(inputs.length===0) return;\n        \n                            let firstInput = inputs[0];\n        \n                            firstInput.focus();\n                        } else if(e.which === 40 && e.target.classList.contains('more-snippets')) { // down\n                 \n                            // Redirect to dropdown list\n                            let firstItem;\n                            let activeItem;\n                            let moreCategories = document.querySelector('.is-more-categories');\n                            let items = moreCategories.querySelectorAll('a');\n                            items.forEach(item=>{\n                                let display = window.getComputedStyle(item).getPropertyValue('display');\n                                if(display==='block') {\n                                    item.classList.add('show');\n                                    if(item.classList.contains('active')) {\n                                        activeItem=item;\n                                    }\n                                } else {\n                                    item.classList.remove('show');\n                                }\n                            });\n                            firstItem = moreCategories.querySelector('.show');\n                            if(activeItem) {\n                                activeItem.focus();\n                            } else {\n                                firstItem.focus();\n                            }\n\n                        } \n\n                        \n                    });\n        \n                    tab.addEventListener('click', (e)=>{\n                        e.preventDefault();\n\n                        e.target.focus();\n        \n                        select(e.target);\n                    });\n        \n                });\n\n                let dropdownItems = document.querySelectorAll('.is-more-categories a');\n                Array.prototype.forEach.call(dropdownItems, (item) => {\n\n                    item.addEventListener('keydown', (e)=>{\n                        e.preventDefault();\n                        if(e.keyCode === 38 && e.target.previousElementSibling && window.getComputedStyle(e.target.previousElementSibling).getPropertyValue('display')==='block') { // up\n                            e.target.previousElementSibling.focus();\n                        } else if(e.keyCode === 40 && e.target.nextElementSibling && window.getComputedStyle(e.target.nextElementSibling).getPropertyValue('display')==='block') { // down\n                            e.target.nextElementSibling.focus();\n                        } else if(e.keyCode === 13 || e.keyCode === 32) { // enter or spacebar key\n                            select(e.target);\n                        } else if ((e.which === 9 && !e.shiftKey)) { // tab key pressed\n        \n                            // Redirect to tab content\n                            let inputs = [];\n                            let controls = designlist.querySelectorAll('.active');\n                            controls.forEach(control=>{\n                                inputs.push(control);\n                            });\n        \n                            if(inputs.length===0) return;\n        \n                            let firstInput = inputs[0];\n        \n                            firstInput.focus();\n                        } \n                        \n                    });\n        \n                    item.addEventListener('click', (e)=>{\n                        e.preventDefault();\n\n                        e.target.focus();\n        \n                        select(e.target);\n                    });\n                });\n\n\n        \n                var snippets = data_basic.snippets; //DATA\n\n                if (slider !== null){\n                    if(slider==='slick') {\n                        //remove glide\n                        const predicate = (item) => (item.type!=='glide');\n                        snippets = snippets.filter(predicate);\n                    } else if(slider==='glide') {\n                        //remove slick\n                        const predicate = (item) => (item.type!=='slick');\n                        snippets = snippets.filter(predicate);\n                    } else if(slider==='all') {\n                        // Do Nothing\n                    } else {\n                        // remove all slider (if incorrect settings)\n                        const predicate = (item) => (item.type!=='glide' && item.type!=='slick');\n                        snippets = snippets.filter(predicate);\n                    }\n\n                    // for (let i = 0; i < snippets.length; i++) {\n                    //     console.log(snippets[i].type)\n                    // }\n\n                } else {\n                    // Backward compatible OR if slider param not set\n\n                    // Hide slider snippet if slick is not included\n                    var bHideSliderSnippet = true;\n                    if(parent._cb.win.jQuery) {\n                        if(parent._cb.win.jQuery.fn.slick) {\n                            bHideSliderSnippet = false;\n                        }\n                    }\n                    if(bHideSliderSnippet){\n                        const result = snippets.filter((item)=>{\n                            return item.type !== 'slick';\n                        });\n                        snippets = [...result];\n                    } \n\n                    if(!(parent._cb.win.Glide)){\n                        const result = snippets.filter((item)=>{\n                            return !(item.glide || item.type === 'glide');\n                        });\n                        snippets = [...result];\n                    }\n\n                    // for (let i = 0; i < snippets.length; i++) {\n                    //     console.log(snippets[i].type)\n                    // }\n\n                }\n                \n\n                for (let i = 0; i <snippets.length; i++) {\n                    \n                    snippets[i].id = i+1;\n                    var thumb = snippets[i].thumbnail;\n        \n                    thumb = snippetPath + thumb;\n        \n                    if (snippets[i].category === defaultSnippetCategory + '') {\n                        designlist.insertAdjacentHTML('beforeend', '<li class=\"active\" role=\"button\" tabindex=\"0\" data-id=\"' + snippets[i].id + '\" data-cat=\"' + snippets[i].category + '\"><img src=\"' + thumb + '\"><span class=\"is-overlay\"></span></li>');\n                    \n                        var newitem = designlist.querySelector('[data-id=\"' + snippets[i].id + '\"]');\n                        newitem.addEventListener('click', function(e){\n        \n                            var snippetid = e.target.parentNode.getAttribute('data-id');\n                            addSnippet(snippetid);\n        \n                        });\n        \n                        newitem.addEventListener('keydown', (e)=>{\n\n                            if ((e.which === 9 && !e.shiftKey)) { // tab\n                                let last = false;\n                                if(e.target.nextElementSibling) {\n                                    if(!e.target.nextElementSibling.classList.contains('active')) {\n                                        last = true;\n                                    }\n                                } else {\n                                    last = true;\n                                }\n                                if(last) {\n                                    e.preventDefault();\n                                    let activeTab = categorylist.querySelector('.active');\n                                    if(activeTab) activeTab.focus();\n                                    else {\n                                        activeTab = categorylist.querySelector('.more-snippets');\n                                        activeTab.focus();\n                                    }\n                                }\n                            }\n                            if ((e.which === 9 && e.shiftKey)) { // shift + tab\n                                let first = false;\n                                if(e.target.previousElementSibling) {\n                                    if(!e.target.previousElementSibling.classList.contains('active')) {\n                                        first = true;\n                                    }\n                                } else {\n                                    first = true;\n                                }\n                                if(first) {\n                                    e.preventDefault();\n                                    let activeTab = categorylist.querySelector('.active');\n                                    if(activeTab) activeTab.focus();\n                                    else {\n                                        activeTab = categorylist.querySelector('.more-snippets');\n                                        activeTab.focus();\n                                    }\n                                }\n                            }\n                        });\n\n                    }\n\n                }\n        \n\n\n\n                /*\n                elms = categorymore.querySelectorAll('a');\n                Array.prototype.forEach.call(elms, function(elm){\n        \n                    elm.addEventListener('click', function(e){\n                        \n                        var cat = elm.getAttribute('data-cat');\n                        if(designlist.querySelectorAll('[data-cat=\"' + cat + '\"]').length === 0) {\n        \n                            for (let i = 0; i <snippets.length; i++) {\n                        \n                                var thumb = snippets[i].thumbnail;\n                                \n                                thumb = snippetPath + thumb;\n        \n                                if (snippets[i].category === cat) {\n                      \n                                    designlist.insertAdjacentHTML('beforeend', '<li role=\"button\" tabindex=\"0\" data-id=\"' + snippets[i].id + '\" data-cat=\"' + snippets[i].category + '\"><img src=\"' + thumb + '\"><span class=\"is-overlay\"></span></li>');\n                                \n                                    var newitem = designlist.querySelector('[data-id=\"' + snippets[i].id + '\"]');\n                                    newitem.addEventListener('click', function(e){\n                                        \n                                        var snippetid = e.target.parentNode.getAttribute('data-id');\n                                        addSnippet(snippetid);\n        \n                                    });\n                                }\n        \n                            }    \n                        }\n        \n                        // Hide all, show items from selected category\n                        Array.prototype.forEach.call(elms, function(elm){\n                            elm.className = elm.className.replace('active', '');\n                        });\n                        categorymore.className = categorymore.className.replace('active', ''); // hide popup\n                        //var categorymore_items = categorymore.querySelectorAll('a');\n                        \n                        var categorylist = document.querySelector('.is-category-list');\n                        var categorylist_items = categorylist.querySelectorAll('a');                \n                        Array.prototype.forEach.call(categorylist_items, function(elm){\n                            elm.className = elm.className.replace('active', '');\n                        });\n                            \n                        var more = document.querySelector('.more-snippets');\n                        more.className = more.className.replace('active', '');\n        \n                        var items = designlist.querySelectorAll('div');\n                        Array.prototype.forEach.call(items, function(elm){\n                            elm.style.display = 'none';\n                            elm.classList.remove('active');\n                        });\n                        Array.prototype.forEach.call(items, function(elm){\n                            var catSplit = elm.getAttribute('data-cat').split(',');\n                            for (var j = 0; j < catSplit.length; j++) {\n                                if (catSplit[j] == cat) {\n                                    elm.style.display = '';\n                                    elm.classList.add('active');\n                                }\n                            }\n                        });\n        \n                        elm.classList.add('active');\n        \n                        e.preventDefault();\n                    });\n        \n                });\n                */\n        \n                var close = document.querySelector('.is-pop-close');\n                close.addEventListener('click', function(e){\n                    var modal = parent.document.querySelector('.is-modal.snippets');\n                    removeClass(modal, 'active');\n                });\n        \n                // Add document Click event\n                document.addEventListener('click', function(e){\n                    e = e || window.event;\n                    var target = e.target || e.srcElement;  \n        \n                    if(parentsHasClass(target, 'more-snippets')) return;\n                    if(hasClass(target, 'more-snippets')) return;\n                    \n                    var more = document.querySelector('.more-snippets');\n                    var moreCategories = document.querySelector('.is-more-categories');\n                    \n                    more.className = more.className.replace('active', '');\n                    moreCategories.className = moreCategories.className.replace('active', '');\n                });\n        \n                parent.document.addEventListener('click', function(e){\n                    var more = document.querySelector('.more-snippets');\n                    var moreCategories = document.querySelector('.is-more-categories');\n                    \n                    more.className = more.className.replace('active', '');\n                    moreCategories.className = moreCategories.className.replace('active', '');\n                });\n        \n                function addSnippet(snippetid) {\n                    \n                    // TODO: var framework = parent._cb.opts.framework;\n                    var snippetPathReplace = parent._cb.opts.snippetPathReplace;\n                    var emailMode = parent._cb.opts.emailMode;\n                    \n                    // \n                    for (let i = 0; i <snippets.length; i++) {\n                        if(snippets[i].id + ''=== snippetid) {\n                            \n                            var html = snippets[i].html;\n                            var noedit = snippets[i].noedit;\n                            break;\n                        }\n                    }\n        \n                    var bSnippet;\n                    if (html.indexOf('\"row') === -1) {\n                        bSnippet = true; // Just snippet (without row/column grid)\n                    } else {\n                        bSnippet = false; // Snippet is wrapped in row/colum\n                    }\n                    if (emailMode) bSnippet = false;\n\n                    if(bSnippet) {\n                        var quickadd = parent._cb.builderStuff.querySelector('.quickadd');\n                        var mode = quickadd.getAttribute('data-mode');\n                        if(!mode) {\n                            // in case of using viewSnippets() to open the dialog (mode=null) => change to non snippet.\n                            html = '<div class=\"row\">' +\n                                '<div class=\"column full\">' +\n                                html +\n                                '</div>' +\n                            '</div>';\n                            bSnippet=false;\n                        }\n                    }\n         \n                    // Convert snippet into your defined 12 columns grid   \n                    var rowClass = parent._cb.opts.row; //row\n                    var colClass = parent._cb.opts.cols; //['col s1', 'col s2', 'col s3', 'col s4', 'col s5', 'col s6', 'col s7', 'col s8', 'col s9', 'col s10', 'col s11', 'col s12']\n                    if(rowClass!=='' && colClass.length===12){\n\n                        //html = html.replace(new RegExp('row clearfix', 'g'), rowClass);\n                        html = html.replace(new RegExp('row clearfix', 'g'), 'row'); // backward\n                        html = html.replace(new RegExp('\"row', 'g'), '\"' + rowClass);\n                        \n                        html = html.replace(new RegExp('column full', 'g'), colClass[11]);\n                        html = html.replace(new RegExp('column half', 'g'), colClass[5]);\n                        html = html.replace(new RegExp('column third', 'g'), colClass[3]);\n                        html = html.replace(new RegExp('column fourth', 'g'), colClass[2]);\n                        html = html.replace(new RegExp('column fifth', 'g'), colClass[1]);\n                        html = html.replace(new RegExp('column sixth', 'g'), colClass[1]);\n                        html = html.replace(new RegExp('column two-third', 'g'), colClass[7]);\n                        html = html.replace(new RegExp('column two-fourth', 'g'), colClass[8]);\n                        html = html.replace(new RegExp('column two-fifth', 'g'), colClass[9]);\n                        html = html.replace(new RegExp('column two-sixth', 'g'), colClass[9]);\n                    }\n                    \n                    html = html.replace(/{id}/g, makeid()); // Replace {id} with auto generated id (for custom code snippet)\n                    \n                    if(parent._cb.opts.onAdd){\n                        html = parent._cb.opts.onAdd(html);\n                    }\n\n                    if(snippetPathReplace.length>0) {\n                        if (snippetPathReplace[0] != '') {\n                            var regex = new RegExp(snippetPathReplace[0], 'g');\n                            html = html.replace(regex, snippetPathReplace[1]);\n\n                            /* for encoded replace, change / to %2F  */\n                            var slash = new RegExp('/', 'g');\n                            var snippetPathReplace_0 = snippetPathReplace[0].replace(slash, '%2F');\n                            var snippetPathReplace_1 = snippetPathReplace[1].replace(slash, '%2F');\n                            regex = new RegExp(snippetPathReplace_0, 'g');\n                            html = html.replace(regex, snippetPathReplace_1);\n                        }\n                    }\n                    \n                    parent._cb.addSnippet(html, bSnippet, noedit);\n        \n                    var modal = parent.document.querySelector('.is-modal.snippets');\n                    removeClass(modal, 'active');\n        \n                }\n        \n                function hasClass(element, classname) {\n                    if(!element) return false;\n                    return element.classList ? element.classList.contains(classname) : new RegExp('\\b'+ classname+'\\b').test(element.className);\n                }\n        \n                function removeClass(element, classname) {\n                    if(!element) return;\n                    if(element.classList.length>0) {\n                        element.className = element.className.replace(classname, '');\n                    }\n                }\n                \n                function parentsHasClass(element, classname) {\n                    while (element) {\n                        if(element.tagName === 'BODY' || element.tagName === 'HTML') return false;\n                        if(!element.classList) return false;\n                        if (element.classList.contains(classname)) {\n                            return true;\n                        }\n                        element = element.parentNode;\n                    }\n                }\n        \n                function makeid() {//http://stackoverflow.com/questions/1349404/generate-a-string-of-5-random-characters-in-javascript\n                    var text = \"\";\n                    var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n                    for (var i = 0; i < 2; i++)\n                        text += possible.charAt(Math.floor(Math.random() * possible.length));\n        \n                    var text2 = \"\";\n                    var possible2 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n                    for (var i = 0; i < 5; i++)\n                        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));\n        \n                    return text + text2;\n                }\n        \n            </script>\n        \n        </textarea>\n        </body>\n        \n        </html>\n        ");
      return html;
    }
  }]);
  return Snippets;
}();
/* harmony default export */ const contentbuilder_snippets = (Snippets);
;// CONCATENATED MODULE: ./src/contentbuilder/quickadd.js

var renderQuickAdd = function renderQuickAdd(builder) {
  var util = builder.util;
  var builderStuff = builder.builderStuff;
  var dom = builder.dom;
  var quickadd = builderStuff.querySelector('.quickadd');
  if (!quickadd) {
    var html = "<div class=\"is-pop quickadd arrow-right\" style=\"z-index:10003;\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n        <div class=\"is-pop-close\" style=\"display:none;z-index:1;width:40px;height:40px;position:absolute;top:0px;right:0px;box-sizing:border-box;padding:0;line-height:40px;font-size: 12px;color:#777;text-align:center;cursor:pointer;\"><svg class=\"is-icon-flex\" style=\"width:40px;height:40px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></div>\n        <div class=\"is-pop-tabs\">\n            <div class=\"is-pop-tab-item\" data-value=\"left\">".concat(util.out('Add to Left'), "</div>\n            <div class=\"is-pop-tab-item active\" data-value=\"right\">").concat(util.out('Add to Right'), "</div>\n        </div>\n        <div style=\"padding:12px;display:flex;flex-direction:row;flex-flow: wrap;justify-content: center;align-items: center;\">\n            <button title=\"").concat(util.out('Paragraph'), "\" class=\"add-paragraph\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#icon-align-full\"></use></svg></span>").concat(util.out('Paragraph'), "</button>\n            <button title=\"").concat(util.out('Headline'), "\" class=\"add-headline\"><span style=\"font-family:serif;display:block;margin:0 0 8px;font-size:11px;\">H</span>").concat(util.out('Headline'), "</button>\n            <button title=\"").concat(util.out('Image'), "\" class=\"add-image\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex ion-image\" style=\"width:14px;height:14px;\"><use xlink:href=\"#ion-image\"></use></svg></span>").concat(util.out('Image'), "</button>\n            <button title=\"").concat(util.out('List'), "\" class=\"add-list\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-list-bullet\"></use></svg></span>").concat(util.out('List'), "</button>\n            <button title=\"").concat(util.out('Heading 1'), "\" class=\"add-heading1\"><span style=\"font-family:serif;display:block;margin:0 0 8px;\">H1</span>").concat(util.out('Heading 1'), "</button>\n            <button title=\"").concat(util.out('Heading 2'), "\" class=\"add-heading2\"><span style=\"font-family:serif;display:block;margin:0 0 8px;\">H2</span>").concat(util.out('Heading 2'), "</button>\n            <button title=\"").concat(util.out('Heading 3'), "\" class=\"add-heading3\"><span style=\"font-family:serif;display:block;margin:0 0 8px;\">H3</span>").concat(util.out('Heading 3'), "</button>\n            <button title=\"").concat(util.out('Heading 4'), "\" class=\"add-heading4\"><span style=\"font-family:serif;display:block;margin:0 0 8px;\">H4</span>").concat(util.out('Heading 4'), "</button>\n            <button title=\"").concat(util.out('Quote'), "\" class=\"add-quote\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-quote\"></use></svg></span>").concat(util.out('Quote'), "</button>\n            <button style=\"display:none\" title=\"").concat(util.out('Preformatted'), "\" class=\"add-preformatted\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-code\"></use></svg></span>").concat(util.out('Preformatted'), "</button>\n            ").concat(builder.opts.emailMode ? '' : "<button title=\"".concat(util.out('Button'), "\" class=\"add-button\"><span style=\"display:block;margin:0 0 8px;\"><span style=\"display:inline-block;border:#a1a1a1 1px solid;background:#f3f3f3;width:10px;height:4px;\"></span></span>").concat(util.out('Button'), "</button>"), "\n            ").concat(builder.opts.emailMode ? '' : "<button title=\"".concat(util.out('Two Button'), "\" class=\"add-twobutton\"><span style=\"display:block;margin:0 0 8px;\"><span style=\"display:inline-block;border:#a1a1a1 1px solid;background:#f3f3f3;width:10px;height:4px;\"></span></span>").concat(util.out('Two Button'), "</button>"), "\n            <button title=\"").concat(util.out('Map'), "\" class=\"add-map\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-location\"></use></svg></use></svg></svg></span>").concat(util.out('Map'), "</button>\n            <button title=\"").concat(util.out('Youtube'), "\" class=\"add-youtube\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-social-youtube-outline\"></use></svg></use></svg></svg></span>").concat(util.out('Youtube'), "</button>\n            <button title=\"").concat(util.out('Video'), "\" class=\"add-video\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-ios-play\"></use></svg></use></svg></svg></span>").concat(util.out('Video'), "</button>\n            <button style=\"display:none\" title=\"").concat(util.out('Audio'), "\" class=\"add-audio\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-volume-medium\"></use></svg></use></svg></svg></span>").concat(util.out('Audio'), "</button>\n            <button title=\"").concat(util.out('Icon'), "\" class=\"add-icon\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-android-happy\"></use></svg></use></svg></svg></span>").concat(util.out('Icon'), "</button>\n            <button title=\"").concat(util.out('SVG'), "\" class=\"add-svg\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-5px\"><use xlink:href=\"#icon-svg\"></use></svg></use></svg></svg></span>").concat(util.out('SVG'), "</button>\n            <button title=\"").concat(util.out('Table'), "\" class=\"add-table\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#icon-table\"></use></svg></use></svg></svg></span>").concat(util.out('Table'), "</button>\n            <button title=\"").concat(util.out('Social Links'), "\" class=\"add-social\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-social-twitter\"></use></svg></use></svg></svg></span>").concat(util.out('Social Links'), "</button>\n            <button title=\"").concat(util.out('HTML/JS'), "\" class=\"add-code\"><span style=\"display:block;margin:0 0 8px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-code\"></use></svg></use></svg></svg></span>").concat(util.out('HTML/JS'), "</button>\n            <button title=\"").concat(util.out('Spacer'), "\" class=\"add-spacer\"><span style=\"display:block;margin:0 0 8px;\"><span style=\"display:inline-block;background:#eee;width:30px;height:5px;\"></span></span>").concat(util.out('Spacer'), "</button>\n            <button style=\"display:none\" title=\"").concat(util.out('Line'), "\" class=\"add-line\"><span style=\"display:block;margin:0 0 8px;\"><span style=\"display:inline-block;background:#ddd;width:30px;height:2px;\"></span></span>").concat(util.out('Line'), "</button>\n            <div class=\"pop-separator\"></div>\n            <button title=\"").concat(util.out('More...'), "\" class=\"add-more\" style=\"flex-direction:initial;\">").concat(util.out('More...'), "</button>\n        </div>\n        </div>\n        ");
    dom.appendHtml(builderStuff, html);
    quickadd = builderStuff.querySelector('.quickadd');
    var tabs = quickadd.querySelectorAll('.is-pop-tab-item');
    Array.prototype.forEach.call(tabs, function (tab) {
      dom.addEventListener(tab, 'click', function (e) {
        var elms = quickadd.querySelectorAll('.is-pop-tab-item');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.removeClass(elm, 'active');
        });
        dom.addClass(e.target, 'active');
        var val = quickadd.querySelector('.active').getAttribute('data-value');
        if (val === 'left') {
          quickadd.setAttribute('data-mode', 'cell-left');
        } else {
          quickadd.setAttribute('data-mode', 'cell-right');
        }
      });
    });
    var elm = quickadd.querySelector('.add-paragraph');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. \n            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, \n            when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-headline');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div class=\"display\">\n                <h1>Headline Goes Here</h1>\n                <p>Lorem Ipsum is simply dummy text</p>\n            </div>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-image');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<img src=\"".concat(builder.opts.snippetPath, "example.png\" alt=\"\" />");
      if (builder.opts.snippetSampleImage) {
        html = "<img src=\"".concat(builder.opts.snippetSampleImage, "\" alt=\"\" />");
      }
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-heading1');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = '<h1>Heading 1 here</h1>';
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-heading2');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = '<h2>Heading 2 here</h2>';
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-heading3');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = '<h3>Heading 3 here</h3>';
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-heading4');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = '<h4>Heading 4 here</h4>';
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-preformatted');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<pre>Lorem Ipsum is simply dummy text of the printing and typesetting industry. \n            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, \n            when an unknown printer took a galley of type and scrambled it to make a type specimen book.</pre>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-list');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<ul>\n                <li>Lorem Ipsum is simply dummy text</li>\n                <li>Lorem Ipsum is simply dummy text</li>\n            </ul>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-quote');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');

      // const html = '<blockquote>Lorem Ipsum is simply dummy text</blockquote>';
      var html = "\n            <div class=\"text-left\">\n                <i class=\"icon ion-quote size-28\"></i>\n            </div>\n            <p class=\"size-21 leading-14\">It's easy to use, customizable, and user-friendly. A truly amazing features.</p>\n            ";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-button');
    if (elm) dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 text-black leading-14 rounded border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Read More</a>\n            </div>";
      if (builder.opts.emailMode) {
        html = '<div><a href="#" role="button" style="margin-top: ;margin-right: ;margin-bottom: ;margin-left: ;display: inline-block; text-decoration: none; transition: all 0.16s ease 0s; border-style: solid; cursor: pointer; background-color: rgb(220, 220, 220); color: rgb(0, 0, 0); border-color: rgb(220, 220, 220); border-width: 2px; border-radius: 0px; padding: 13px 28px; line-height: 21px; text-transform: uppercase; font-weight: 400; font-size: 14px; letter-spacing: 3px;">Read More</a></div>';
      }
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-twobutton');
    if (elm) dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 text-black leading-14 rounded border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Read More</a>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 border-current hover:border-current font-normal leading-14 rounded tracking-wide\">Get Started</a>\n            </div>";
      if (builder.opts.emailMode) {
        html = "<div>\n                <a href=\"#\" role=\"button\" style=\"margin-top: ;margin-right: ;margin-bottom: ;margin-left: ;display: inline-block; text-decoration: none; transition: all 0.16s ease 0s; border-style: solid; cursor: pointer; background-color: rgb(220, 220, 220); color: rgb(0, 0, 0); border-color: rgb(220, 220, 220); border-width: 2px; border-radius: 0px; padding: 13px 28px; line-height: 21px; text-transform: uppercase; font-weight: 400; font-size: 14px; letter-spacing: 3px;\">Read More</a> &nbsp;\n                <a href=\"#\" role=\"button\" style=\"display: inline-block; text-decoration: none; transition: all 0.16s ease 0s; border-style: solid; cursor: pointer; background-color: rgba(0, 0, 0, 0); border-color: rgb(53, 53, 53); border-width: 2px; border-radius: 0px; padding: 13px 28px; line-height: 21px; text-transform: uppercase; font-weight: 600; font-size: 14px; letter-spacing: 3px; color: rgb(53, 53, 53);\">Get Started</a>\n            </div>";
      }
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-spacer');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = '<div class="spacer height-80"></div>';

      // util.addContent(html, mode, 'data-noedit');
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-line');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = '<hr>';

      // util.addContent(html, mode, 'data-noedit');
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-code');
    dom.addEventListener(elm, 'click', function () {
      // const mode = quickadd.getAttribute('data-mode');

      var html = '<div class="row">' + '<div class="column full" data-noedit data-html="' + encodeURIComponent('<h1 id="{id}">Lorem ipsum</h1>' + '<p>This is a code block. You can edit this block using the source dialog.</p>' + '<scr' + 'ipt>' + 'var docReady = function (fn) {' + 'var stateCheck = setInterval(function () {' + 'if (document.readyState !== "complete") return;' + 'clearInterval(stateCheck);' + 'try{fn()}catch(e){}' + '}, 1);' + '};' + 'docReady(function() {' + 'document.querySelector(\'#{id}\').innerHTML =\'<b>Hello World..!</b>\';' + '});' + '</scr' + 'ipt>') + '">' + '</div>' + '</div>';
      var noedit = true;
      var bSnippet = false;
      var snippetPathReplace = builder.opts.snippetPathReplace;

      // Convert snippet into your defined 12 columns grid   
      var rowClass = builder.opts.row; //row
      var colClass = builder.opts.cols; //['col s1', 'col s2', 'col s3', 'col s4', 'col s5', 'col s6', 'col s7', 'col s8', 'col s9', 'col s10', 'col s11', 'col s12']
      if (rowClass !== '' && colClass.length === 12) {
        // html = html.replace(new RegExp('row clearfix', 'g'), rowClass);
        html = html.replace(new RegExp('row clearfix', 'g'), 'row'); // backward
        html = html.replace(new RegExp('"row', 'g'), '"' + rowClass);
        html = html.replace(new RegExp('column full', 'g'), colClass[11]);
        html = html.replace(new RegExp('column half', 'g'), colClass[5]);
        html = html.replace(new RegExp('column third', 'g'), colClass[3]);
        html = html.replace(new RegExp('column fourth', 'g'), colClass[2]);
        html = html.replace(new RegExp('column fifth', 'g'), colClass[1]);
        html = html.replace(new RegExp('column sixth', 'g'), colClass[1]);
        html = html.replace(new RegExp('column two-third', 'g'), colClass[7]);
        html = html.replace(new RegExp('column two-fourth', 'g'), colClass[8]);
        html = html.replace(new RegExp('column two-fifth', 'g'), colClass[9]);
        html = html.replace(new RegExp('column two-sixth', 'g'), colClass[9]);
      }
      html = html.replace(/{id}/g, util.makeId()); // Replace {id} with auto generated id (for custom code snippet)

      if (builder.opts.onAdd) {
        html = builder.opts.onAdd(html);
      }
      if (snippetPathReplace.length > 0) {
        if (snippetPathReplace[0] !== '') {
          var regex = new RegExp(snippetPathReplace[0], 'g');
          html = html.replace(regex, snippetPathReplace[1]);
        }
      }
      builder.addSnippet(html, bSnippet, noedit);
    });
    elm = quickadd.querySelector('.add-table');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<table class=\"default\" style=\"border-collapse:collapse;width:100%;\">\n                <thead>\n                <tr>\n                    <td style=\"vertical-align:top;\"><br></td>\n                    <td style=\"vertical-align:top;\"><br></td>\n                </tr>\n                </thead>\n                <tr>\n                    <td style=\"vertical-align:top;\"><br></td>\n                    <td style=\"vertical-align:top;\"><br></td>\n                </tr>\n            </table>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-icon');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div style=\"text-align: center;\">\n            <i class=\"icon ion-android-alarm-clock size-80\"></i>\n            </div>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-svg');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div style=\"text-align: center;\">\n                            <svg viewBox=\"0 0 259.25 969.39\" xmlns=\"http://www.w3.org/2000/svg\" style=\"fill: rgb(100 177 45); width: 150px; height: 150px;\">\n                    <g>\n                        <path d=\"M184,17.61S101.39,318.78,98.85,334,69.62,463.64,67.08,517s-16.52,141,19.06,202,86.41,110.56,151.21,75S320,675.85,320,675.85s16.52-179.17-58.45-414.26S184,17.61,184,17.61Z\" transform=\"translate(-62.25 -17.61)\"></path>\n                        <path d=\"M190.34,179l-7.63,319s-28-17.79-30.49-24.15-20.34-26.68-20.34-26.68,15.25,36.85,20.34,40.66,26.68,34.31,26.68,34.31l-1.27,181.72,1.27,274.47s11.44,17.79,14,2.54,3.81-305,3.81-305,34.31-78.79,41.94-95.3,12.7-39.4,12.7-39.4-45.74,87.68-50.83,94-6.35-231.28-6.35-231.28,11.44,6.36,22.87-33,7.63-52.1,7.63-52.1-14,45.74-20.33,55.91S190.34,179,190.34,179Z\" transform=\"translate(-62.25 -17.61)\" style=\"fill:#ededed\"></path>\n                    </g>\n                </svg>\n            </div>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-social');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "\n            <div class=\"is-social text-left\">\n                <a href=\"https://twitter.com/\"><i class=\"bi bi-twitter-x\"></i></a>\n                <a href=\"https://www.facebook.com/\"><i class=\"bi bi-facebook\"></i></a>\n                <a href=\"https://www.instagram.com/\" title=\"\"><i class=\"icon bi bi-instagram\"></i></a>\n            </div>\n            ";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-map');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div class=\"embed-responsive embed-responsive-16by9\">\n            <iframe width=\"100%\" height=\"400\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\" class=\"mg1\" src=\"https://maps.google.com/maps?q=Melbourne,+Victoria,+Australia&amp;hl=en&amp;sll=-7.981898,112.626504&amp;sspn=0.009084,0.016512&amp;oq=melbourne&amp;hnear=Melbourne+Victoria,+Australia&amp;t=m&amp;z=10&amp;output=embed\"></iframe>\n            </div>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-youtube');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div class=\"embed-responsive embed-responsive-16by9\">\n                <iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/P5yHEKqx86U?rel=0\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\"></iframe>\n            </div>";
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-video');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<video style=\"width: 100%;\" loop=\"\" autoplay=\"\">\n                <source src=\"".concat(builder.opts.snippetPath, "example.mp4\" type=\"video/mp4\"></video>");
      if (builder.opts.snippetSampleVideo) {
        html = "<video style=\"width: 100%;\" loop=\"\" autoplay=\"\">\n                    <source src=\"".concat(builder.opts.snippetSampleVideo, "\" type=\"video/mp4\"></video>");
      }
      util.addContent(html, mode);
    });
    elm = quickadd.querySelector('.add-audio');
    dom.addEventListener(elm, 'click', function () {
      var mode = quickadd.getAttribute('data-mode');
      var html = "<div style=\"display:flex;width:100%;position:relative;margin:15px 0;background:transparent;\">\n                        <audio controls=\"\" style=\"width:100%\">\n                            <source src=\"".concat(builder.opts.snippetPath, "example.mp3\" type=\"audio/mpeg\">\n                            Your browser does not support the audio element.\n                        </audio>\n                    </div>");
      if (builder.opts.snippetSampleAudio) {
        html = "<div style=\"display:flex;width:100%;position:relative;margin:15px 0;background:transparent;\">\n                            <audio controls=\"\" style=\"width:100%\">\n                                <source src=\"".concat(builder.opts.snippetSampleAudio, "\" type=\"audio/mpeg\">\n                                Your browser does not support the audio element.\n                            </audio>\n                    </div>");
      }
      util.addContent(html, mode);
    });
    var snippets = new contentbuilder_snippets(builder);
    elm = quickadd.querySelector('.add-more');
    dom.addEventListener(elm, 'click', function () {
      var modal = builderStuff.querySelector('.snippets');
      util.showModal(modal, false, null, false);

      // let iframe = modal.querySelector('iframe');
      // if(iframe.src==='about:blank') {
      //     iframe.src = builder.opts.snippetData;
      // }
      var ifr = modal.querySelector('iframe');
      var doc = ifr.contentWindow.document;
      if (doc.body.innerHTML === '') {
        // doc.open();
        // doc.write(snippets.getSnippetsHtml());
        // doc.close();
        ifr.srcdoc = snippets.getSnippetsHtml();
      }

      // quickadd.style.display = '';
      util.hidePop(quickadd);
    });
  }
  return quickadd;
};
/* harmony default export */ const contentbuilder_quickadd = (renderQuickAdd);
;// CONCATENATED MODULE: ./src/contentbuilder/util.js
function util_typeof(obj) { "@babel/helpers - typeof"; return util_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, util_typeof(obj); }
function util_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function util_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, util_toPropertyKey(descriptor.key), descriptor); } }
function util_createClass(Constructor, protoProps, staticProps) { if (protoProps) util_defineProperties(Constructor.prototype, protoProps); if (staticProps) util_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function util_toPropertyKey(arg) { var key = util_toPrimitive(arg, "string"); return util_typeof(key) === "symbol" ? key : String(key); }
function util_toPrimitive(input, hint) { if (util_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (util_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var Util = /*#__PURE__*/function () {
  function Util(builder) {
    util_classCallCheck(this, Util);
    this.builder = builder;
    this.dom = this.builder.dom;
  }
  util_createClass(Util, [{
    key: "cellSelected",
    value: function cellSelected() {
      return this.builder.doc.querySelector('.cell-active');
    }
  }, {
    key: "rowSelected",
    value: function rowSelected() {
      return this.builder.doc.querySelector('.row-active');
    }
  }, {
    key: "builderStuff",
    value: function builderStuff() {
      return document.querySelector('#_cbhtml');
    }
  }, {
    key: "cellNext",
    value: function cellNext(cell) {
      var dom = this.dom;
      var c = cell.nextElementSibling;
      if (c) {
        if (!dom.hasClass(c, 'is-row-tool') && !dom.hasClass(c, 'is-col-tool') && !dom.hasClass(c, 'is-rowadd-tool') && !dom.hasClass(c, 'is-row-overlay')) {
          return c;
        } else {
          return null;
        }
      }
      return null;
    }
  }, {
    key: "out",
    value: function out(s) {
      if (this.builder) {
        var val = this.builder.opts.lang[s];
        if (val) return val;else {
          if (this.builder.checkLang) console.log(s);
          return s;
        }
      } else {
        return s;
      }
    }
  }, {
    key: "showMessage",
    value: function showMessage(message, focusOutline, callback) {
      var _this = this;
      var dom = this.dom;
      var html = '';
      html = "<div class=\"is-modal modalmessage\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"padding-top: 15px;padding-bottom: 20px;max-width: 450px;\">\n                <div style=\"margin: 20px 0 30px;font-size: 17px;\">".concat(message, "</div>\n                <button title=\"").concat(this.out('Ok'), "\" class=\"input-ok classic\">").concat(this.out('Ok'), "</button>\n            </div>\n        </div>");
      var builderStuff = this.builder.builderStuff;
      var modalMessage = builderStuff.querySelector('.modalmessage');
      if (!modalMessage) {
        dom.appendHtml(builderStuff, html);
        modalMessage = builderStuff.querySelector('.modalmessage');
      }
      this.showModal(modalMessage, false, function () {
        modalMessage.parentNode.removeChild(modalMessage);
        if (callback) callback();
      });
      var buttonok = modalMessage.querySelector('.modalmessage .input-ok');
      dom.addEventListener(buttonok, 'click', function () {
        _this.hideModal(modalMessage);
        if (modalMessage.parentNode) modalMessage.parentNode.removeChild(modalMessage);
        if (callback) callback();
      });
      buttonok.focus();
      if (focusOutline) {
        buttonok.classList.add('focus-outline');
      }
    }
  }, {
    key: "showChoice",
    value: function showChoice(message, yestext, callback) {
      var _this2 = this;
      var dom = this.dom;
      var html = '';
      html = "<div class=\"is-modal modalmessage\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"padding-top: 15px;padding-bottom: 20px;max-width: 450px;\">\n                <div style=\"margin: 20px 0 30px;font-size: 17px;\">".concat(message, "</div>\n\n                <div style=\"display:flex;\">\n                    <button title=\"").concat(this.out('Cancel'), "\" class=\"input-cancel classic-secondary\" style=\"width:100%;margin-right:4px;\">").concat(this.out('Cancel'), "</button>\n                    <button title=\"").concat(yestext, "\" class=\"input-ok classic-primary\" style=\"width:100%\">").concat(yestext, "</button>\n                </div>\n            </div>\n        </div>");
      var builderStuff = this.builder.builderStuff;
      var modalMessage = builderStuff.querySelector('.modalmessage');
      if (!modalMessage) {
        dom.appendHtml(builderStuff, html);
        modalMessage = builderStuff.querySelector('.modalmessage');
      }
      this.showModal(modalMessage, false, function () {
        //this function runs when overlay is clicked. Remove modal.
        modalMessage.parentNode.removeChild(modalMessage);
        callback(false);
      });
      var btnCancel = modalMessage.querySelector('.modalmessage .input-cancel');
      dom.addEventListener(btnCancel, 'click', function () {
        _this2.hideModal(modalMessage);
        modalMessage.parentNode.removeChild(modalMessage); //remove modal

        callback(false);
      });
      btnCancel.focus();
      var btnOk = modalMessage.querySelector('.modalmessage .input-ok');
      dom.addEventListener(btnOk, 'click', function () {
        _this2.hideModal(modalMessage);
        modalMessage.parentNode.removeChild(modalMessage); //remove modal

        //do task
        callback(true);
      });
    }
  }, {
    key: "confirm",
    value: function confirm(message, callback, yesno, yestext, forceOpen) {
      var _this3 = this;
      if (!this.builder.deleteConfirm && !forceOpen) {
        callback(true);
        return;
      }
      var dom = this.dom;
      var html = '';
      html = "<div class=\"is-modal is-confirm\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"padding-bottom:20px;\">\n                <div style=\"margin: 20px 0 30px;font-size: 14px;\">".concat(message, "</div>\n                <button title=\"").concat(this.out('Delete'), "\" class=\"input-ok classic focus-warning\">").concat(this.out('Delete'), "</button>\n            </div>\n        </div>");
      if (yesno) {
        html = "<div class=\"is-modal is-confirm\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"padding-bottom:20px;\">\n                    <div style=\"margin: 20px 0 30px;font-size: 14px;\">".concat(message, "</div>\n                    <button title=\"").concat(this.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(this.out('Cancel'), "</button>\n                    <button title=\"").concat(yestext, "\" class=\"input-ok classic-primary\">").concat(yestext, "</button>\n                </div>\n            </div>");
      }
      var builderStuff = this.builder.builderStuff;
      var confirmmodal = builderStuff.querySelector('.is-confirm');
      if (!confirmmodal) {
        dom.appendHtml(builderStuff, html);
        confirmmodal = builderStuff.querySelector('.is-confirm');
      }
      this.showModal(confirmmodal, false, function () {
        //this function runs when overlay is clicked. Remove modal.
        confirmmodal.parentNode.removeChild(confirmmodal);

        //do task
        callback(false);
      }, true);
      var buttonok = confirmmodal.querySelector('.is-confirm .input-ok');
      dom.addEventListener(buttonok, 'click', function () {
        _this3.hideModal(confirmmodal);
        confirmmodal.parentNode.removeChild(confirmmodal); //remove modal

        //do task
        callback(true);
      });
      var buttoncancel = confirmmodal.querySelector('.is-confirm .input-cancel');
      dom.addEventListener(buttoncancel, 'click', function (e) {
        _this3.hideModal(confirmmodal);
        confirmmodal.parentNode.removeChild(confirmmodal); //remove modal

        //do task
        callback(false);
        e.preventDefault();
        e.stopImmediatePropagation();
      });
      if (buttonok) buttonok.focus();
    }
  }, {
    key: "showRtePop",
    value: function showRtePop(pop, onShow, btn) {
      var _this4 = this;
      var dom = this.dom;
      pop.style.display = 'flex';
      if (onShow) onShow();
      dom.removeClass(pop, 'deactive');
      dom.addClass(pop, 'active');
      var handleClickOut = function handleClickOut(e) {
        var inputFocused = document.activeElement.tagName.toLowerCase() === 'input';
        if (inputFocused) {
          if (pop.contains(document.activeElement)) return;
        }
        if (!pop.contains(e.target) && !btn.contains(e.target) && !e.target.closest('.pickcolormore')) {
          // click outside

          _this4.hideRtePop(pop); // hide

          pop.removeEventListener('keydown', handleKeyDown);
          document.removeEventListener('click', handleClickOut);
          if (_this4.builder.iframeDocument) {
            _this4.builder.doc.removeEventListener('click', handleClickOut);
          }
        }
      };
      var handleKeyDown = function handleKeyDown(e) {
        if (e.keyCode === 27) {
          // escape key

          _this4.hideRtePop(pop); // hide

          pop.removeEventListener('keydown', handleKeyDown);
          document.removeEventListener('click', handleClickOut);
          if (_this4.builder.iframeDocument) {
            _this4.builder.doc.removeEventListener('click', handleClickOut);
          }
        }
      };
      pop.addEventListener('keydown', handleKeyDown);
      document.addEventListener('click', handleClickOut);
      if (this.builder.iframeDocument) {
        this.builder.doc.addEventListener('click', handleClickOut);
      }
    }
  }, {
    key: "hideRtePop",
    value: function hideRtePop(pop) {
      var dom = this.dom;
      pop.style.display = '';
      dom.removeClass(pop, 'active');
      dom.addClass(pop, 'deactive');
    }
  }, {
    key: "clearAllEventListener",
    value: function clearAllEventListener(pop) {
      for (var i = 0; i < 10; i++) {
        pop.removeEventListener('keydown', this.handlePopKeyDown);
        document.removeEventListener('click', this.handlePopClickOut);
        if (this.builder.iframeDocument) {
          this.builder.doc.removeEventListener('click', this.handlePopClickOut);
        }
      }
    }
  }, {
    key: "showPop",
    value: function showPop(pop, cancelCallback, btn) {
      var _this5 = this;
      var dom = this.dom;

      // Hide other pops
      var elms = document.querySelectorAll('.is-pop.active');
      Array.prototype.forEach.call(elms, function (elm) {
        if (elm !== pop) {
          elm.style.display = '';
          dom.removeClass(elm, 'active');
          elm.setAttribute('aria-hidden', true);
        }
      });

      // if(pop.style.display === 'flex') return; 
      this.clearAllEventListener(pop); // for safety of uncleared events as a result of closing without hidePop()

      pop.style.display = 'flex';
      dom.addClass(pop, 'active');
      pop.setAttribute('aria-hidden', false);
      this.setupTabKeys(pop);
      pop.focus({
        preventScroll: true
      });
      this.handlePopClickOut = function (e) {
        if (!pop.contains(e.target) && !btn.contains(e.target)) {
          // click outside
          // hide
          _this5.hidePop(pop);

          // pop.removeEventListener('keydown', this.handlePopKeyDown);
          // document.removeEventListener('click', this.handlePopClickOut);

          if (cancelCallback) cancelCallback();
        }
      };
      this.handlePopKeyDown = function (e) {
        if (e.keyCode === 27) {
          // escape key
          // hide
          _this5.hidePop(pop);

          // pop.removeEventListener('keydown', this.handlePopKeyDown);
          // document.removeEventListener('click', this.handlePopClickOut);

          if (cancelCallback) cancelCallback();
        }
      };
      pop.addEventListener('keydown', this.handlePopKeyDown);
      document.addEventListener('click', this.handlePopClickOut);
      if (this.builder.iframeDocument) {
        this.builder.doc.addEventListener('click', this.handlePopClickOut);
      }
    }
  }, {
    key: "hidePop",
    value: function hidePop(pop) {
      var dom = this.dom;
      pop.style.display = '';
      dom.removeClass(pop, 'active');
      pop.setAttribute('aria-hidden', true);

      // pop.removeEventListener('keydown', this.handlePopKeyDown);
      // document.removeEventListener('click', this.handlePopClickOut);
      this.clearAllEventListener(pop);
    }
  }, {
    key: "setupTabKeys",
    value: function setupTabKeys(div) {
      var inputs = div.querySelectorAll('a[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]):not([tabindex="-1"]), iframe, object, embed, *[tabindex]:not([tabindex="-1"])');
      if (inputs.length === 0) return;
      var firstInput = inputs[0];
      var lastInput = inputs[inputs.length - 1];
      // firstInput.focus();

      // Redirect last tab to first input
      lastInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && !e.shiftKey) {
          e.preventDefault();

          // re-select (because controls can enabled/disapbled)
          inputs = div.querySelectorAll('a[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]):not([tabindex="-1"]), iframe, object, embed, *[tabindex]:not([tabindex="-1"])');
          firstInput = inputs[0];
          firstInput.focus();
        }
      });

      // Redirect first shift+tab to last input
      firstInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && e.shiftKey) {
          e.preventDefault();
          lastInput.focus();
        }
      });
      var iframes = div.querySelectorAll('iframe');
      iframes.forEach(function (iframe) {
        iframe.addEventListener('focus', function () {
          var doc = iframe.contentWindow.document;
          var ifrInputs = doc.querySelectorAll('a[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]):not([tabindex="-1"]), iframe, object, embed, *[tabindex]:not([tabindex="-1"])');
          if (ifrInputs.length === 0) return;
          var firstIfrInput = ifrInputs[0];
          if (firstIfrInput) firstIfrInput.focus();
        });
      });
    }

    /*
    Note:
    - hideModal will remove the modal element, so calling show modal multiple times won't attach multiple events (safe).
    */
  }, {
    key: "showModal",
    value: function showModal(modal, overlayStay, cancelCallback, animated, overflowHidden) {
      var _this6 = this;
      var dom = this.dom;
      dom.addClass(modal, 'active');
      modal.setAttribute('aria-hidden', false);
      if (overflowHidden) document.body.style.overflow = 'hidden';
      var handleKeyDown = function handleKeyDown(e) {
        if (e.keyCode === 27) {
          // escape key

          if (overflowHidden) document.body.style.overflow = '';
          if (dom.hasClass(modal, 'active')) _this6.hideModal(modal); // check first in case programmatically ESC key that already call hideModal is triggered (see _hideModal)

          modal.removeEventListener('keydown', handleKeyDown);
          var _btnClose = modal.querySelector('.is-modal-close');
          if (_btnClose) _btnClose.removeEventListener('click', close);
          if (cancelCallback) cancelCallback();
        }
      };
      modal.addEventListener('keydown', handleKeyDown);
      var content = modal.querySelector('.is-tab-content.active');
      if (content) {
        content.focus();
        this.builder.tabs.setupTabKey(content);
      } else {
        this.setupTabKeys(modal);
        modal.focus();
      }

      /* Disable Modal Animation */
      var animate = false;
      if (this.builder) {
        if (this.builder.opts.animateModal) {
          animate = true;
          if (!animated) {
            // if not set or false
            animate = false; // overide   
          }
        }
      } else {
        if (animated) {
          // if set true
          animate = true; // overide
        }
      }

      if (animate) {
        if (this.builder) {
          var buildercontainers = this.builder.doc.querySelectorAll(this.builder.opts.container);
          Array.prototype.forEach.call(buildercontainers, function (buildercontainer) {
            // buildercontainer.style.transform = 'scale(0.98)';
            // buildercontainer.style.WebkitTransform= 'scale(0.98)';
            // buildercontainer.style.MozTransform= 'scale(0.98)';
            buildercontainer.style.transform = "scale(".concat(_this6.builder.opts.zoom - 0.02, ")");
            buildercontainer.style.WebkitTransform = "scale(".concat(_this6.builder.opts.zoom - 0.02, ")");
            buildercontainer.style.MozTransform = "scale(".concat(_this6.builder.opts.zoom - 0.02, ")");
            buildercontainer.setAttribute('scaled-down', '1');
          });
        }
      }
      var ovl = modal.querySelector('.is-modal-overlay');
      if (ovl) ovl.parentNode.removeChild(ovl); // new

      if (!modal.querySelector('.is-modal-overlay')) {
        var html;
        if (overlayStay) {
          html = '<div class="is-modal-overlay overlay-stay"></div>';
        } else {
          html = '<div class="is-modal-overlay"></div>';
        }
        modal.insertAdjacentHTML('afterbegin', html);
        if (!overlayStay) {
          var overlay = modal.querySelector('.is-modal-overlay');
          dom.addEventListener(overlay, 'click', function () {
            if (overflowHidden) document.body.style.overflow = '';
            _this6.hideModal(modal);
            modal.removeEventListener('keydown', handleKeyDown);
            var btnClose = modal.querySelector('.is-modal-close');
            if (btnClose) btnClose.removeEventListener('click', close);
            if (cancelCallback) cancelCallback();
          });
        }
      }
      var close = function close() {
        if (overflowHidden) document.body.style.overflow = '';
        if (dom.hasClass(modal, 'active')) _this6.hideModal(modal); // check first in case programmatically ESC key that already call hideModal is triggered (see _hideModal)

        modal.removeEventListener('keydown', handleKeyDown);
        var btnClose = modal.querySelector('.is-modal-close');
        if (btnClose) btnClose.removeEventListener('click', close);
        if (cancelCallback) cancelCallback();
      };
      var btnClose = modal.querySelector('.is-modal-close');
      if (btnClose) dom.addEventListener(btnClose, 'click', close);
    }
  }, {
    key: "_hideModal",
    value: function _hideModal(modal) {
      var overlay = modal.querySelector('.is-modal-overlay');
      if (overlay) {
        if (overlay.classList.contains('overlay-stay')) {
          this.hideModal(modal); // just to make sure

          modal.dispatchEvent(new KeyboardEvent('keydown', {
            key: 'e',
            keyCode: 27,
            code: 'KeyE',
            which: 27,
            shiftKey: false,
            ctrlKey: false,
            metaKey: false
          })); // Programmatically call ESC so that cancelCallback can be triggered
        } else {
          overlay.click(); // so that cancelCallback can be triggered
        }
      } else {
        this.hideModal(modal); // just to make sure

        modal.dispatchEvent(new KeyboardEvent('keydown', {
          key: 'e',
          keyCode: 27,
          code: 'KeyE',
          which: 27,
          shiftKey: false,
          ctrlKey: false,
          metaKey: false
        })); // Programmatically call ESC so that cancelCallback can be triggered
      }
    }
  }, {
    key: "hideModal",
    value: function hideModal(modal) {
      var _this7 = this;
      modal.setAttribute('aria-hidden', true);

      /* Disable Modal Animation */
      if (this.builder) {
        var buildercontainers = this.builder.doc.querySelectorAll(this.builder.opts.container);
        Array.prototype.forEach.call(buildercontainers, function (buildercontainer) {
          // buildercontainer.style.transform = '';
          // buildercontainer.style.WebkitTransform= '';
          // buildercontainer.style.MozTransform= '';
          if (buildercontainer.getAttribute('scaled-down')) {
            buildercontainer.style.transform = "scale(".concat(_this7.builder.opts.zoom, ")");
            buildercontainer.style.WebkitTransform = "scale(".concat(_this7.builder.opts.zoom, ")");
            buildercontainer.style.MozTransform = "scale(".concat(_this7.builder.opts.zoom, ")");
            buildercontainer.removeAttribute('scaled-down');
          }
        });
      }
      var dom = this.dom;
      dom.removeClass(modal, 'active');
      modal.style.display = '';

      // document.body.style.overflow = '';
    }
  }, {
    key: "refreshModuleLayout",
    value: function refreshModuleLayout(col) {
      var savedHeight;
      if (col.style.height) savedHeight = col.style.height;else col.style.height = "".concat(col.offsetHeight, "px");
      col.style.opacity = 0;
      var html = decodeURIComponent(col.getAttribute('data-html'));
      html = html.replace(/{id}/g, this.builder.util.makeId());
      col.innerHTML = '';
      var range = document.createRange();
      range.setStart(col, 0);
      col.appendChild(range.createContextualFragment(html));
      var subblocks = col.querySelectorAll('[data-subblock]');
      var i = 1;
      Array.prototype.forEach.call(subblocks, function (subblock) {
        if (col.getAttribute('data-html-' + i)) {
          subblock.innerHTML = decodeURIComponent(col.getAttribute('data-html-' + i));
          subblock.contentEditable = true;
        }
        i++;
      });
      setTimeout(function () {
        if (savedHeight) {
          col.style.height = savedHeight;
        } else {
          col.style.height = '';
        }
        col.style.opacity = '';
      }, 100);
    }
  }, {
    key: "removeColClasses",
    value: function removeColClasses(cell) {
      cell.classList.remove('full');
      cell.classList.remove('two-third');
      cell.classList.remove('two-fourth');
      cell.classList.remove('two-fifth');
      cell.classList.remove('two-sixth');
      cell.classList.remove('half');
      cell.classList.remove('third');
      cell.classList.remove('fourth');
      cell.classList.remove('fifth');
      cell.classList.remove('sixth');
      cell.classList.remove('seventh');
      cell.classList.remove('eighth');
      cell.classList.remove('ninth');
      cell.classList.remove('tenth');
      cell.classList.remove('eleventh');
      cell.classList.remove('twelfth');
    }
  }, {
    key: "getAllColumns",
    value: function getAllColumns(row) {
      var arrCells = [];
      var dom = this.dom;
      var cols = dom.elementChildren(row);
      cols.forEach(function (col) {
        if (dom.hasClass(col, 'is-row-tool') || dom.hasClass(col, 'is-col-tool') || dom.hasClass(col, 'is-rowadd-tool') || dom.hasClass(col, 'is-row-overlay')) return;
        arrCells.push(col);
      });
      return arrCells;
    }
  }, {
    key: "fixLayout",
    value: function fixLayout(row) {
      var _this8 = this;
      var dom = this.dom;
      var smHidden = false;
      var mdHidden = false;
      Array.from(row.children).map(function (item) {
        if (item.classList.contains('is-row-tool')) return;
        if (item.classList.contains('is-col-tool')) return;
        if (item.classList.contains('is-rowadd-tool')) return;

        // item.style.width = '';
        // item.style.flex = '';
        if (item.getAttribute('data-html')) {
          // Don't change width on custom block
          if (!item.style.width) {
            // But if width is not set, add default 50%
            item.style.width = '50%';
            item.style.flex = '0 0 auto';
          }
          if (_this8.getAllColumns(row).length === 1) {
            // only 1 col in a row
            item.style.width = '';
            item.style.flex = '';
          }
        } else {
          item.style.width = '';
          item.style.flex = '';
        }
        if (item.classList.contains('sm-hidden')) {
          smHidden = true;
        }
        if (item.classList.contains('md-hidden')) {
          mdHidden = true;
        }
      });
      if (smHidden) {
        row.classList.add('sm-autofit');
      } else {
        row.classList.remove('sm-autofit');
      }
      if (mdHidden) {
        row.classList.add('md-autofit');
      } else {
        row.classList.remove('md-autofit');
      }
      if (this.builder.useDefaultGrid) {
        var cols = dom.elementChildren(row);
        cols.forEach(function (col) {
          if (dom.hasClass(col, 'is-row-tool') || dom.hasClass(col, 'is-col-tool') || dom.hasClass(col, 'is-rowadd-tool') || dom.hasClass(col, 'is-row-overlay')) return;
          _this8.removeColClasses(col);
        });

        // Refresh Module
        Array.from(row.children).map(function (item) {
          if (item.classList.contains('is-row-tool')) return;
          if (item.classList.contains('is-rowadd-tool')) return;
          if (item.classList.contains('is-col-tool')) return;
          if (item.getAttribute('data-module')) {
            _this8.refreshModuleLayout(item);
          }
        });
        return;
      }
      var num = 3; //is-row-tool, is-col-tool & is-rowadd-tool
      if (row.querySelector('.is-row-overlay')) {
        num = 4; //is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
      }

      var cellCount = row.childElementCount - num;
      var rowClass = this.builder.opts.row;
      var colClass = this.builder.opts.cols;
      var colEqual = this.builder.opts.colequal;
      if (colEqual.length > 0) {
        var _cols = dom.elementChildren(row);
        _cols.forEach(function (col) {
          if (dom.hasClass(col, 'is-row-tool') || dom.hasClass(col, 'is-col-tool') || dom.hasClass(col, 'is-rowadd-tool') || dom.hasClass(col, 'is-row-overlay')) return;
          for (var i = 0; i <= colClass.length - 1; i++) {
            dom.removeClass(col, colClass[i]);
          }
          for (var _i = 0; _i <= colEqual.length - 1; _i++) {
            if (colEqual[_i].length === cellCount) {
              dom.addClass(col, colEqual[_i][0]);
              break;
            }
          }
          if (cellCount === 1) {
            dom.addClass(col, colClass[colClass.length - 1]);
          }
        });

        // Refresh Module
        Array.from(row.children).map(function (item) {
          if (item.classList.contains('is-row-tool')) return;
          if (item.classList.contains('is-rowadd-tool')) return;
          if (item.classList.contains('is-col-tool')) return;
          if (item.getAttribute('data-module')) {
            _this8.refreshModuleLayout(item);
          }
        });
        return;
      }

      //others (12 columns grid)
      if (rowClass !== '' && colClass.length > 0) {
        var n = 0;
        var _cols2 = dom.elementChildren(row);
        _cols2.forEach(function (col) {
          if (dom.hasClass(col, 'is-row-tool') || dom.hasClass(col, 'is-col-tool') || dom.hasClass(col, 'is-rowadd-tool') || dom.hasClass(col, 'is-row-overlay')) return;

          // Bootstrap stuff
          if (col.className.indexOf('col-md-') !== -1) {
            // Do Nothing
          } else if (col.className.indexOf('col-sm-') !== -1) {
            colClass = ['col-sm-1', 'col-sm-2', 'col-sm-3', 'col-sm-4', 'col-sm-5', 'col-sm-6', 'col-sm-7', 'col-sm-8', 'col-sm-9', 'col-sm-10', 'col-sm-11', 'col-sm-12'];
          } else if (col.className.indexOf('col-xs-') !== -1) {
            colClass = ['col-xs-1', 'col-xs-2', 'col-xs-3', 'col-xs-4', 'col-xs-5', 'col-xs-6', 'col-xs-7', 'col-xs-8', 'col-xs-9', 'col-xs-10', 'col-xs-11', 'col-xs-12'];
          } else if (col.className.indexOf('col-lg-') !== -1) {
            colClass = ['col-lg-1', 'col-lg-2', 'col-lg-3', 'col-lg-4', 'col-lg-5', 'col-lg-6', 'col-lg-7', 'col-lg-8', 'col-lg-9', 'col-lg-10', 'col-lg-11', 'col-lg-12'];
          } else if (col.className.indexOf('col-xl-') !== -1) {
            colClass = ['col-xl-1', 'col-xl-2', 'col-xl-3', 'col-xl-4', 'col-xl-5', 'col-xl-6', 'col-xl-7', 'col-xl-8', 'col-xl-9', 'col-xl-10', 'col-xl-11', 'col-xl-12'];
          } else if (col.className.indexOf('col-xxl-') !== -1) {
            colClass = ['col-xxl-1', 'col-xxl-2', 'col-xxl-3', 'col-xxl-4', 'col-xxl-5', 'col-xxl-6', 'col-xxl-7', 'col-xxl-8', 'col-xxl-9', 'col-xxl-10', 'col-xxl-11', 'col-xxl-12'];
          }
          n++;
          for (var i = 0; i <= colClass.length - 1; i++) {
            dom.removeClass(col, colClass[i]);
          }
          if (cellCount === 1) dom.addClass(col, colClass[11]);
          if (cellCount === 2) dom.addClass(col, colClass[5]);
          if (cellCount === 3) dom.addClass(col, colClass[3]);
          if (cellCount === 4) {
            dom.addClass(col, colClass[2]);
          }
          if (cellCount === 5) {
            // 2, 2, 2, 2, 4
            if (n === 5) dom.addClass(col, colClass[3]);else dom.addClass(col, colClass[1]);
          }
          if (cellCount === 6) dom.addClass(col, colClass[1]); // 2, 2, 2, 2, 2, 2

          if (cellCount === 7) {
            // 2, 2, 2, 2, 2, 1, 1
            if (n >= 6) dom.addClass(col, colClass[0]);else dom.addClass(col, colClass[1]);
          }
          if (cellCount === 8) {
            // 2, 2, 2, 2, 1, 1, 1, 1
            if (n >= 5) dom.addClass(col, colClass[0]);else dom.addClass(col, colClass[1]);
          }
          if (cellCount === 9) {
            // 2, 2, 2, 1, 1, 1, 1, 1, 1
            if (n >= 4) dom.addClass(col, colClass[0]);else dom.addClass(col, colClass[1]);
          }
          if (cellCount === 10) {
            // 2, 2, 1, 1, 1, 1, 1, 1, 1, 1
            if (n >= 3) dom.addClass(col, colClass[0]);else dom.addClass(col, colClass[1]);
          }
          if (cellCount === 11) {
            // 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
            if (n >= 2) dom.addClass(col, colClass[0]);else dom.addClass(col, colClass[1]);
          }
          if (cellCount === 12) dom.addClass(col, colClass[0]); // 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
        });
      }

      // Refresh Module
      Array.from(row.children).map(function (item) {
        if (item.classList.contains('is-row-tool')) return;
        if (item.classList.contains('is-rowadd-tool')) return;
        if (item.classList.contains('is-col-tool')) return;
        if (item.getAttribute('data-module')) {
          _this8.refreshModuleLayout(item);
        }
      });
    }
  }, {
    key: "addContent",
    value: function addContent(html, mode, attr) {
      var dom = this.dom;
      if (this.builder.opts.onAdd) {
        html = this.builder.opts.onAdd(html);
      }
      var cell = this.cellSelected();
      var row;
      if (!cell) {
        var elm = this.builder.activeElement;
        if (elm && elm.closest('.is-block')) {// freeform
          // Do Nothing
          // Continue
        } else {
          // If no active cell, check if it is from .row-add-initial (empty info)
          row = this.builder.doc.querySelector('.row-active');
          if (!row) return;else {
            // Empty content will always use 'row' mode to insert block.
            mode = 'row';
          }
        }
      } else {
        row = cell.parentNode;
      }
      if (mode === 'cell' || mode === 'cell-left' || mode === 'cell-right') {
        var maxCols = 4;
        if (this.builder.maxColumns) {
          maxCols = this.builder.maxColumns;
        }
        //Limit up to 4 cells in a row

        var num = 3; //is-row-tool, is-col-tool & is-rowadd-tool
        if (row.querySelector('.is-row-overlay')) {
          num = 4; //is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
        }

        if (row.childElementCount >= maxCols + num) {
          //+3 => includes is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
          alert(this.out('You have reached the maximum number of columns'));
          return false;
        }
        this.builder.uo.saveForUndo();
        var cellElement;
        if (this.builder.opts.row === '') {
          // TODO: Test using in old Insite
          var s = this.builder.opts.cellFormat;
          var pos = s.indexOf('</');
          html = s.substring(0, pos) + html + s.substring(pos);
          cellElement = this.createElementFromHTML(html);
        } else {
          cellElement = cell.cloneNode(true);

          // Cleanup from module related clone
          cellElement.removeAttribute('data-noedit');
          cellElement.removeAttribute('data-protected');
          cellElement.removeAttribute('data-module');
          cellElement.removeAttribute('data-module-desc');
          cellElement.removeAttribute('data-dialog-width');
          cellElement.removeAttribute('data-html');
          cellElement.removeAttribute('data-settings');
          for (var i = 1; i <= 20; i++) {
            cellElement.removeAttribute('data-html-' + i);
          }
          cellElement.removeAttribute('data-noedit');
          dom.removeClass(cellElement, 'cell-active');
          dom.removeClass(cellElement, 'is-light-text');
          dom.removeClass(cellElement, 'is-dark-text');
          dom.removeClass(cellElement, 'padding-0');
          dom.removeClass(cellElement, 'p-0');
          cellElement.removeAttribute('data-click');
          cellElement.removeAttribute('style');
          if (attr) {
            cellElement.setAttribute(attr, '');
          }
          cellElement.innerHTML = html;
        }
        row.insertBefore(cellElement, cell);
        if (mode === 'cell' || mode === 'cell-right') {
          dom.moveAfter(cellElement, cell);
        }
        var builderActive = this.builder.doc.querySelector('.builder-active');
        if (builderActive) this.builder.applyBehaviorOn(builderActive);
        this.fixLayout(row);
        cellElement.click(); //change active block to the newly created
      }

      if (mode === 'row') {
        this.builder.uo.saveForUndo();
        var rowElement, _cellElement;
        if (this.builder.opts.row === '') {
          rowElement = this.htmlToElement(this.builder.opts.rowFormat);
          var _s = this.builder.opts.cellFormat;
          var _pos = _s.indexOf('</');
          html = _s.substring(0, _pos) + html + _s.substring(_pos);

          // go to last deeper level
          var targetrow = dom.elementChildren(rowElement);
          while (targetrow.length > 0) {
            targetrow = targetrow[0];
            if (dom.elementChildren(targetrow).length > 0) {
              targetrow = dom.elementChildren(targetrow);
            } else {
              break;
            }
          }
          targetrow.innerHTML = html;
          _cellElement = targetrow.firstChild;
          if (attr) {
            _cellElement.setAttribute(attr, '');
          }
        } else {
          _cellElement = dom.createElement('div');
          dom.addClass(_cellElement, this.builder.opts.cols[this.builder.opts.cols.length - 1]);
          _cellElement.innerHTML = html;
          if (attr) {
            _cellElement.setAttribute(attr, '');
          }
          rowElement = dom.createElement('div');
          dom.addClass(rowElement, this.builder.opts.row);
          dom.appendChild(rowElement, _cellElement);
        }
        row.parentNode.insertBefore(rowElement, row);
        dom.moveAfter(rowElement, row);
        var _builderActive = this.builder.doc.querySelector('.builder-active');
        if (_builderActive) this.builder.applyBehaviorOn(_builderActive);
        _cellElement.click(); //change active block to the newly created
      }

      if (mode === 'elm') {
        var _elm = this.builder.activeElement; // See elementtool.js line 195-196. // document.querySelector('.elm-active');
        if (!_elm) return;
        this.builder.uo.saveForUndo();
        var element = _elm;
        var newelement;
        if (!element.nextElementSibling) {
          // active element is div.display > p.
          var activeCol = this.builder.activeCol;
          var current;
          var elms = dom.elementChildren(activeCol);
          elms.forEach(function (child) {
            if (child.contains(element)) {
              current = child;
            }
          });
          if (current) {
            current.insertAdjacentHTML('afterend', html); // add new element after div.display
            newelement = current.nextElementSibling;
          }
        } else {
          element.insertAdjacentHTML('afterend', html);
          newelement = element.nextElementSibling;
        }
        var _builderActive2 = this.builder.doc.querySelector('.builder-active');
        if (_builderActive2) this.builder.applyBehaviorOn(_builderActive2);
        if (newelement.tagName.toLowerCase() === 'img') {
          var checkLoad = setInterval(function () {
            if (newelement.complete) {
              newelement.click();
              clearInterval(checkLoad);
            }
          }, 30);
        } else {
          newelement.click();
        }
        var builderStuff = this.builder.builderStuff;
        var quickadd = builderStuff.querySelector('.quickadd');
        this.hidePop(quickadd);

        // LATER: auto scroll

        // LATER: If image, then it needs time to load (resulting incorrect position), so hide element tool. 
      }

      if (this.builder.useCssClasses) {
        var _builderActive3 = this.builder.doc.querySelector('.builder-active');
        if (_builderActive3) dom.contentReformat(_builderActive3, this.builder.cssClasses);
      }

      //Trigger Change event
      this.builder.opts.onChange();

      //Trigger Render event
      this.builder.opts.onRender();
    }

    // https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro
  }, {
    key: "htmlToElement",
    value: function htmlToElement(html) {
      var template = document.createElement('template');
      html = html.trim(); // Never return a text node of whitespace as the result
      template.innerHTML = html;
      return template.content.firstChild;
    }
  }, {
    key: "addSnippet",
    value: function addSnippet(html, bSnippet, noedit) {
      var _this9 = this;
      this.builder.uo.saveForUndo();
      var dom = this.dom;
      var rowElement;
      var bAddLast = false;
      var cell;
      var cellElement;
      var builderStuff = this.builder.builderStuff;
      var quickadd = builderStuff.querySelector('.quickadd');
      var mode;
      if (quickadd) {
        mode = quickadd.getAttribute('data-mode');
      } else {
        mode = 'row';
      }
      if (bSnippet && (mode === 'cell' || mode === 'cell-left' || mode === 'cell-right')) {
        if (noedit) {
          this.addContent(html, mode, 'data-noedit');
        } else {
          this.addContent(html, mode);
        }
        return;
      } else if (bSnippet && mode === 'row') {
        /*
        Buttons, line, social, video, map (Grid layout not included).
        Can be inserted after current row, cell, element, or last row.
        */

        // NEW: See contentbuilder.js line 328
        // OLD: See contentbuilder-jquery.js addSnippet() line 16529

        // Just snippet (without row/column grid), ex. buttons, line, social, video, map.
        // Can be inserted after current row, column (cell), element, or last row.

        // html = `<div class="${this.builder.opts.row}"><div class="${this.builder.opts.cols[this.builder.opts.cols.length-1]}"${(noedit? ' data-noedit': '')}>${html}</div></div>`;
        // OR like addContent() in util.js line 245)

        cellElement = document.createElement('div');
        cellElement.className = this.builder.opts.cols[this.builder.opts.cols.length - 1];
        cellElement.innerHTML = html;
        if (noedit) {
          cellElement.setAttribute('data-noedit', '');
        }
        rowElement = document.createElement('div');
        rowElement.className = this.builder.opts.row;
        rowElement.appendChild(cellElement);

        // Add after selected row
        cell = this.builder.cellSelected();
        var row;
        if (cell) {
          row = cell.parentNode;
        } else {
          // If no active cell, check if it is from .row-add-initial (empty info)
          row = this.builder.doc.querySelector('.row-active');
          if (!row) {
            bAddLast = true;
          }
        }
        // Add after last row
        if (bAddLast) {
          var nodes = this.builder.doc.querySelectorAll('.is-builder');
          var last = nodes[nodes.length - 1];
          var rows = dom.elementChildren(last);
          var lastrow = rows[rows.length - 1];
          row = lastrow;
        }
        row.parentNode.insertBefore(rowElement, row);
        dom.moveAfter(rowElement, row);

        // checkEmpty & onRender called here
        var builderActive = this.builder.doc.querySelector('.builder-active');
        if (builderActive) this.builder.applyBehaviorOn(builderActive);else {
          builderActive = this.builder.doc.querySelector('.is-builder');
          this.builder.applyBehaviorOn(builderActive);
        }
        cellElement.click(); //change active block to the newly created

        // Change to row selection
        rowElement.className = rowElement.className.replace('row-outline', '');

        //Hide Column tool (new!)
        this.builder.util.hideColumnTool();
      } else if (bSnippet) {
        if (noedit) {
          this.addContent(html, mode, 'data-noedit');
        } else {
          this.addContent(html, mode);
        }
        return;
      } else {
        /*
        Complete with grid layout. Also may containes custom script(data-html)
        Can be inserted after current row or last row.
        */

        // NEW: See contentbuilder.js line 341 AND contentbuilder-jquery.js (addContentMore) line 11526
        // OLD: See contentbuilder-jquery.js (addContentMore) line 11526

        // Snippet is wrapped in row/colum (may contain custom code or has [data-html] attribute)
        // Can only be inserted after current row or last row (not on column or element).

        var snippet = document.createElement('div');
        snippet.innerHTML = html;
        var blocks = snippet.querySelectorAll('[data-html]');
        Array.prototype.forEach.call(blocks, function (block) {
          // Render custom code block
          html = decodeURIComponent(block.getAttribute('data-html'));
          html = html.replace(/{id}/g, _this9.makeId());
          html = html.replace(/<script>/g, "".concat(_this9.builder.nonce ? "<script nonce=\"".concat(_this9.builder.nonce, "\">") : '<script>'));
          for (var i = 1; i <= 20; i++) {
            html = html.replace('[%HTML' + i + '%]', block.getAttribute('data-html-' + i) === undefined ? '' : decodeURIComponent(block.getAttribute('data-html-' + i))); //render editable area
          }

          block.innerHTML = html;
        });

        //html = snippet.innerHTML; 

        // NEW: This allows snippets with complete row & column format (should be single row/col) can be added as a column
        if (snippet.childNodes.length === 1) if (snippet.childNodes[0].childNodes.length === 1 && (mode === 'cell' || mode === 'cell-left' || mode === 'cell-right')) {
          // this.addContent(html, mode, 'data-noedit');

          var _cell = this.cellSelected();
          var _row2 = _cell.parentNode;
          var maxCols = 4;
          if (this.builder.maxColumns) {
            maxCols = this.builder.maxColumns;
          }
          //Limit up to 4 cells in a row
          if (_row2.querySelector('.is-row-overlay')) {
            if (_row2.childElementCount >= maxCols + 4) {
              //+4 => includes is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
              alert(this.out('You have reached the maximum number of columns'));
              return false;
            }
          } else {
            if (_row2.childElementCount >= maxCols + 3) {
              //+3 => includes is-row-tool, is-col-tool & is-rowadd-tool
              alert(this.out('You have reached the maximum number of columns'));
              return false;
            }
          }
          this.builder.uo.saveForUndo();
          var _cellElement2 = snippet.childNodes[0].childNodes[0];

          // row.insertBefore(cellElement, cell);
          var range = document.createRange();
          _cell.parentNode.insertBefore(range.createContextualFragment(_cellElement2.outerHTML), _cell);
          if (mode === 'cell' || mode === 'cell-right') {
            // dom.moveAfter(cellElement, cell);
            _cell.parentNode.insertBefore(_cell.previousElementSibling, _cell);
            _cell.parentNode.insertBefore(_cell, _cell.previousElementSibling);
          }
          var _builderActive5 = this.builder.doc.querySelector('.builder-active');
          if (_builderActive5) this.builder.applyBehaviorOn(_builderActive5);else {
            _builderActive5 = this.builder.doc.querySelector('.is-builder');
            this.builder.applyBehaviorOn(_builderActive5);
          }
          this.fixLayout(_row2);

          // cellElement.click(); //change active block to the newly created
          if (mode === 'cell' || mode === 'cell-right') {
            _cell.nextElementSibling.click();
          } else {
            _cell.previousElementSibling.click();
          }

          //Trigger Change event
          this.builder.opts.onChange();

          //Trigger Render event
          this.builder.opts.onRender();
          return;
        }

        // Add after selected row
        cell = this.builder.activeCol;
        var _row;
        if (cell) {
          _row = cell.parentNode; // in email mode, cell active is also under row active (incorrect, but cell active is not needed in email mode. So this line works!)
        } else {
          // If no active cell, check if it is from .row-add-initial (empty info)
          _row = this.builder.doc.querySelector('.row-active');
          if (!_row) {
            bAddLast = true;
          }
        }
        // Add after last row
        if (bAddLast) {
          var _nodes = this.builder.doc.querySelectorAll('.is-builder');
          var _last = _nodes[_nodes.length - 1];
          var _rows = dom.elementChildren(_last);
          var _lastrow = _rows[_rows.length - 1];
          _row = _lastrow;
        }

        // Use createContextualFragment() to make embedded script executable
        // https://ghinda.net/article/script-tags/
        range = document.createRange();
        _row.parentNode.insertBefore(range.createContextualFragment(snippet.innerHTML), _row.nextSibling);
        rowElement = snippet.childNodes[0];

        // Auto scroll
        // const y = row.getBoundingClientRect().top +  row.offsetHeight + window.pageYOffset - 120;
        // window.scroll({
        //     top: y,
        //     behavior: 'smooth'
        // });
        // window.scrollTo(0, y);

        // setTimeout(()=>{
        //     row.scrollIntoView({ behavior: 'smooth', block: 'center' });
        // }, 600);

        rowElement = _row.nextElementSibling; // a must. Must be before applyBehavior to prevent element delete during fixLayout

        // checkEmpty & onRender called here
        var _builderActive4 = this.builder.doc.querySelector('.builder-active');
        if (_builderActive4) this.builder.applyBehaviorOn(_builderActive4);else {
          _builderActive4 = this.builder.doc.querySelector('.is-builder');
          this.builder.applyBehaviorOn(_builderActive4);
        }
        cellElement = rowElement.querySelector('div');
        if (cellElement) cellElement.click(); //change active block to the newly created

        // Change to row selection
        rowElement.className = rowElement.className.replace('row-outline', '');

        //Hide Column tool (new!)
        this.builder.util.hideColumnTool();
      }
      if (this.builder.useCssClasses) {
        var _builderActive6 = this.builder.doc.querySelector('.builder-active');
        if (_builderActive6) dom.contentReformat(_builderActive6, this.builder.cssClasses);
      }

      //Trigger Change event
      this.builder.opts.onChange();

      //Trigger Render event
      this.builder.opts.onRender();
    }
  }, {
    key: "clearActiveCell",
    value: function clearActiveCell() {
      // this.builder.lastActiveCol = this.cellSelected(); // get active cell before cleared (will be used by snippets dialog)

      var builderStuff = this.builder.builderStuff;
      if (!builderStuff) return; // in case the builder is destroyed

      var divs = this.builder.doc.getElementsByClassName('cell-active');
      while (divs.length) {
        divs[0].classList.remove('cell-active');
      }
      divs = this.builder.doc.getElementsByClassName('row-outline');
      while (divs.length) {
        divs[0].classList.remove('row-outline');
      }
      divs = this.builder.doc.getElementsByClassName('row-active');
      while (divs.length) {
        divs[0].classList.remove('row-active');
      }
      divs = this.builder.doc.getElementsByClassName('builder-active');
      while (divs.length) {
        divs[0].classList.remove('builder-active');
      }
      this.builder.activeCol = null;
      this.builder.dom.removeClass(this.builder.doc.body, 'content-edit');
    }
  }, {
    key: "clearAfterUndoRedo",
    value: function clearAfterUndoRedo() {
      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      var tools = builderStuff.querySelectorAll('.is-tool');
      Array.prototype.forEach.call(tools, function (tool) {
        tool.style.display = '';
        dom.removeClass(tool, 'active');
      });
      if (this.builder.iframe) {
        tools = this.builder.contentStuff.querySelectorAll('.is-tool');
        Array.prototype.forEach.call(tools, function (tool) {
          tool.style.display = '';
          dom.removeClass(tool, 'active');
        });
      }
      if (this.builder.moveable) this.builder.moveable.updateRect();
      var movControlBox = document.querySelector('.moveable-control-box');
      if (movControlBox) movControlBox.style.display = 'none';
      this.builder.activeSpacer = null;
      this.builder.activeCodeBlock = null;
      this.builder.activeLink = null;
      this.builder.activeLinkButton = null;
      this.builder.activeButton = null;
      this.builder.activeIframe = null;
      this.builder.activeTd = null;
      this.builder.activeTable = null;
      this.builder.activeModule = null;
      this.builder.doc.querySelectorAll('.icon-active').forEach(function (elm) {
        return elm.classList.remove('icon-active');
      });
      this.builder.activeIcon = null;

      // RTE
      if (!this.builder.controlPanel) {
        var rteTool = builderStuff.querySelector('.is-rte-tool');
        // rteTool.style.display = 'none';
        var rteButtons = rteTool.querySelectorAll('button');
        Array.prototype.forEach.call(rteButtons, function (rteButton) {
          dom.removeClass(rteButton, 'on');
        });
        var elementRteTool = builderStuff.querySelector('.is-elementrte-tool');
        // rteTool.style.display = 'none';
        rteButtons = elementRteTool.querySelectorAll('button');
        Array.prototype.forEach.call(rteButtons, function (rteButton) {
          dom.removeClass(rteButton, 'on');
        });
      }
      var pops = builderStuff.querySelectorAll('.is-pop');
      Array.prototype.forEach.call(pops, function (pop) {
        pop.style.display = '';
      });
    }
  }, {
    key: "hidePops",
    value: function hidePops() {
      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      var tools = builderStuff.querySelectorAll('.is-tool');
      Array.prototype.forEach.call(tools, function (tool) {
        // if(tool.classList.contains('is-row-tool')||
        // tool.classList.contains('is-column-tool')||
        // tool.classList.contains('is-element-tool')) return;

        tool.style.display = '';
        dom.removeClass(tool, 'active');
      });
      var pops = builderStuff.querySelectorAll('.is-pop.active');
      Array.prototype.forEach.call(pops, function (pop) {
        pop.style.transition = 'all 200ms ease';
        setTimeout(function () {
          pop.style.opacity = '0';
        }, 10);
        setTimeout(function () {
          pop.style.display = '';
          dom.removeClass(pop, 'active');
          pop.style.opacity = '';
          pop.style.transition = '';
        }, 200);
      });
      var movControlBox = document.querySelector('.moveable-control-box');
      var imageResizer = document.querySelector('#divImageResizer');
      if (movControlBox && imageResizer && !imageResizer.getAttribute('data-resizing')) {
        // this.builder.moveable.updateRect();
        movControlBox.style.display = 'none';
      }
    }
  }, {
    key: "hideControls",
    value: function hideControls() {
      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      var tools = builderStuff.querySelectorAll('.is-tool');
      Array.prototype.forEach.call(tools, function (tool) {
        tool.style.display = '';
        dom.removeClass(tool, 'active');
      });
      if (this.builder.iframe) {
        tools = this.builder.contentStuff.querySelectorAll('.is-tool');
        Array.prototype.forEach.call(tools, function (tool) {
          tool.style.display = '';
          dom.removeClass(tool, 'active');
        });
      }
      if (this.builder.moveable) this.builder.moveable.updateRect();
      var movControlBox = document.querySelector('.moveable-control-box');
      if (movControlBox) movControlBox.style.display = 'none';
    }
  }, {
    key: "clearActiveElement",
    value: function clearActiveElement(all) {
      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      this.builder.doc.querySelectorAll('.icon-active').forEach(function (elm) {
        return elm.classList.remove('icon-active');
      });
      this.builder.activeIcon = null;
      var elms = this.builder.doc.querySelectorAll('.elm-inspected');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'elm-inspected');
      });
      this.builder.inspectedElement = null;
      elms = this.builder.doc.querySelectorAll('.elm-active');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'elm-active');
      });
      this.builder.activeElement = null;
      var elmTool = this.builder.doc.querySelector('.is-element-tool');
      elmTool.style.display = '';
      var linkTool = this.builder.doc.querySelector('#divLinkTool');
      if (linkTool) linkTool.style.display = '';
      if (all && !this.builder.controlPanel) {
        // RTE
        var rtetool = builderStuff.querySelector('.is-rte-tool');
        if (rtetool) rtetool.style.display = 'none';
        var elementRtetool = builderStuff.querySelector('.is-elementrte-tool');
        if (elementRtetool) elementRtetool.style.display = 'flex';

        // Click ok on code view should hide these as well
        var rtetoolmore = builderStuff.querySelector('.rte-more-options');
        if (rtetoolmore) rtetoolmore.style.display = '';
        var elementRtetoolmore = builderStuff.querySelector('.elementrte-more-options');
        if (elementRtetoolmore) elementRtetoolmore.style.display = '';
        var btns = elementRtetool.querySelectorAll('button[data-align]');
        Array.prototype.forEach.call(btns, function (btn) {
          btn.style.display = 'none';
        });
        this.builder.rte.positionToolbar();
      }
    }
  }, {
    key: "clearPops",
    value: function clearPops() {
      // Simplified version of clearControls(), used only on window resize

      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      if (!builderStuff) return; // in case the builder is destroyed

      var tools = builderStuff.querySelectorAll('.is-tool');
      Array.prototype.forEach.call(tools, function (tool) {
        tool.style.display = '';
        dom.removeClass(tool, 'active');
      });
      if (this.builder.iframe) {
        tools = this.builder.contentStuff.querySelectorAll('.is-tool');
        Array.prototype.forEach.call(tools, function (tool) {
          tool.style.display = '';
          dom.removeClass(tool, 'active');
        });
      }
      if (this.builder.moveable) this.builder.moveable.updateRect();
      var movControlBox = document.querySelector('.moveable-control-box');
      if (movControlBox) movControlBox.style.display = 'none';

      // show iframe overlay to make it clickable
      var ovls = this.builder.doc.querySelectorAll('.ovl');
      Array.prototype.forEach.call(ovls, function (ovl) {
        ovl.style.display = 'block';
      });
      var pops = builderStuff.querySelectorAll('.is-pop');
      Array.prototype.forEach.call(pops, function (pop) {
        pop.style.display = '';
        dom.removeClass(pop, 'active');
        pop.setAttribute('aria-hidden', true);
      });
      this.builder.colTool.lockIndicator.style.display = '';
      if (this.builder.resize) {
        this.builder.resize.destroy(); // destroy previous instance
      }
    }
  }, {
    key: "clearControls",
    value: function clearControls() {
      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      if (!builderStuff) return; // in case the builder is destroyed

      var tools = builderStuff.querySelectorAll('.is-tool');
      Array.prototype.forEach.call(tools, function (tool) {
        tool.style.display = '';
        dom.removeClass(tool, 'active');
      });
      if (this.builder.iframe) {
        tools = this.builder.contentStuff.querySelectorAll('.is-tool');
        Array.prototype.forEach.call(tools, function (tool) {
          tool.style.display = '';
          dom.removeClass(tool, 'active');
        });
      }
      if (this.builder.moveable) this.builder.moveable.updateRect();
      var movControlBox = document.querySelector('.moveable-control-box');
      if (movControlBox) movControlBox.style.display = 'none';
      this.builder.activeSpacer = null;
      this.builder.activeCodeBlock = null;
      this.builder.activeLink = null;
      this.builder.activeLinkButton = null;
      this.builder.activeButton = null;
      this.builder.activeIframe = null;
      this.builder.activeTd = null;
      this.builder.activeTable = null;
      this.builder.activeModule = null;
      this.builder.activeImage = null;
      this.builder.doc.querySelectorAll('.icon-active').forEach(function (elm) {
        return elm.classList.remove('icon-active');
      });
      this.builder.activeIcon = null;

      // show iframe overlay to make it clickable
      var ovls = this.builder.doc.querySelectorAll('.ovl');
      Array.prototype.forEach.call(ovls, function (ovl) {
        ovl.style.display = 'block';
      });

      // Element Panel & Snippets sidebar
      var panels = builderStuff.querySelectorAll('.is-side.elementstyles');
      Array.prototype.forEach.call(panels, function (panel) {
        dom.removeClass(panel, 'active');
      });

      // Element Panel things
      var elms = this.builder.doc.querySelectorAll('[data-saveforundo]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.removeAttribute('data-saveforundo');
      });
      elms = this.builder.doc.querySelectorAll('.elm-inspected');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'elm-inspected');
      });

      // RTE
      if (!this.builder.controlPanel) {
        if (this.builder.toolbarDisplay === 'auto') {
          var rtetool = builderStuff.querySelector('.is-rte-tool');
          if (rtetool) rtetool.style.display = 'none';
          var elementRtetool = builderStuff.querySelector('.is-elementrte-tool');
          if (elementRtetool) elementRtetool.style.display = 'none';

          // Click ok on code view should hide these as well
          var rtetoolmore = builderStuff.querySelector('.rte-more-options');
          if (rtetoolmore) rtetoolmore.style.display = '';
          var elementRtetoolmore = builderStuff.querySelector('.elementrte-more-options');
          if (elementRtetoolmore) elementRtetoolmore.style.display = '';
        }
      }

      // Element
      elms = this.builder.doc.querySelectorAll('.elm-active');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'elm-active');
      });
      if (!this.builder.controlPanel) {
        var rtepops = builderStuff.querySelectorAll('.is-rte-pop');
        Array.prototype.forEach.call(rtepops, function (rtepop) {
          rtepop.style.display = '';
          dom.removeClass(rtepop, 'active');
          dom.removeClass(rtepop, 'deactive');
          // dom.addClass(rtepop, 'deactive');
        });
      }

      var pops = builderStuff.querySelectorAll('.is-pop');
      Array.prototype.forEach.call(pops, function (pop) {
        pop.style.display = '';
        dom.removeClass(pop, 'active');
        pop.setAttribute('aria-hidden', true);
      });
      this.builder.colTool.lockIndicator.style.display = '';
      if (this.builder.resize) {
        this.builder.resize.destroy(); // destroy previous instance
      }
    }

    // source: http://stackoverflow.com/questions/1349404/generate-a-string-of-5-random-characters-in-javascript
  }, {
    key: "makeId",
    value: function makeId() {
      var text = '';
      var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      for (var i = 0; i < 2; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      var text2 = '';
      var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      for (var _i2 = 0; _i2 < 5; _i2++) {
        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
      }
      return text + text2;
    }
  }, {
    key: "getSelection",
    value: function getSelection() {
      //used only by createlink (elementhyperlink.js)
      var blocks = this.builder.dom.getSelectedBlocks();
      if (blocks.length > 0) {
        this.builder.selectionMulti = true;
      } else {
        this.builder.selectionMulti = false;
        var selection = this.builder.win.getSelection();
        var container = this.builder.dom.getElm();
        if (!container) return;
        var sameSelection = container && container.innerText === selection.toString().trim();
        if (sameSelection || selection.toString().trim() === '') {
          this.builder.selectionElm = container;

          // extra
          var link = container.closest('a');
          if (link) {
            this.builder.activeLink = link;
          } else {
            this.builder.activeLink = null;
          }
        } else {
          this.builder.selectionText = selection;

          // extra
          this.builder.activeLink = null;
        }
      }
    }

    // source: http://stackoverflow.com/questions/5605401/insert-link-in-contenteditable-element 
  }, {
    key: "saveSelection",
    value: function saveSelection() {
      if (this.builder.win.getSelection) {
        var sel = this.builder.win.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
          var ranges = [];
          for (var i = 0, len = sel.rangeCount; i < len; ++i) {
            ranges.push(sel.getRangeAt(i));
          }
          this.builder.selection = ranges;
          return ranges;
        }
      } else if (this.builder.doc.selection && this.builder.doc.selection.createRange) {
        this.builder.selection = this.builder.doc.selection.createRange();
        return this.builder.doc.selection.createRange();
      }
      this.builder.selection = null;
      return null;
    }
  }, {
    key: "restoreSelection",
    value: function restoreSelection() {
      var savedSel = this.builder.selection;
      if (savedSel) {
        if (this.builder.win.getSelection) {
          var sel = this.builder.win.getSelection();
          // sel.removeAllRanges();
          if (this.builder.doc.body.createTextRange) {
            // All IE but Edge
            var range = this.builder.doc.body.createTextRange();
            range.collapse();
            range.select();
          } else if (this.builder.win.getSelection) {
            if (this.builder.win.getSelection().empty) {
              this.builder.win.getSelection().empty();
            } else if (this.builder.win.getSelection().removeAllRanges) {
              this.builder.win.getSelection().removeAllRanges();
            }
          } else if (this.builder.doc.selection) {
            this.builder.doc.selection.empty();
          }
          for (var i = 0, len = savedSel.length; i < len; ++i) {
            sel.addRange(savedSel[i]);
          }
        } else if (this.builder.doc.selection && savedSel.select) {
          savedSel.select();
        }
      }
    }

    // Clean Word. Source: 
    // http://patisserie.keensoftware.com/en/pages/remove-word-formatting-from-rich-text-editor-with-javascript
    // http://community.sitepoint.com/t/strip-unwanted-formatting-from-pasted-content/16848/3
    // http://www.1stclassmedia.co.uk/developers/clean-ms-word-formatting.php
  }, {
    key: "cleanHTML",
    value: function cleanHTML(input, cleanstyle) {
      var stringStripper = /(\n|\r| class=(")?Mso[a-zA-Z]+(")?)/g;
      var output = input.replace(stringStripper, ' ');
      var commentSripper = new RegExp('<!--(.*?)-->', 'g');
      output = output.replace(commentSripper, '');
      var tagStripper;
      if (cleanstyle) {
        tagStripper = new RegExp('<(/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>', 'gi');
      } else {
        tagStripper = new RegExp('<(/)*(meta|link|\\?xml:|st1:|o:|font)(.*?)>', 'gi');
      }
      output = output.replace(tagStripper, '');
      var badTags = ['style', 'script', 'applet', 'embed', 'noframes', 'noscript'];
      for (var i = 0; i < badTags.length; i++) {
        tagStripper = new RegExp('<' + badTags[i] + '.*?' + badTags[i] + '(.*?)>', 'gi');
        output = output.replace(tagStripper, '');
      }
      var badAttributes;
      if (cleanstyle) {
        badAttributes = ['style', 'start'];
      } else {
        badAttributes = ['start'];
      }
      for (var _i3 = 0; _i3 < badAttributes.length; _i3++) {
        var attributeStripper = new RegExp(' ' + badAttributes[_i3] + '="(.*?)"', 'gi');
        output = output.replace(attributeStripper, '');
      }

      // https://gist.github.com/sbrin/6801034
      //output = output.replace(/<!--[\s\S]+?-->/gi, ''); //done (see above)
      //output = output.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi, '');
      output = output.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s/>]))[^>]*>/gi, '');
      output = output.replace(/<(\/?)s>/gi, '<$1strike>');
      output = output.replace(/&nbsp;/gi, ' ');
      //output = output.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi, function(str, spaces) {
      //    return (spaces.length > 0) ? spaces.replace(/./, " ").slice(Math.floor(spaces.length/2)).split("").join("\u00a0") : '';
      //});

      //clean copied elm-active background-color (LATER: improve)
      output = output.replace(/background-color: rgba\(200, 200, 201, 0.11\);/gi, '');
      output = output.replace(/background-color: rgba\(200, 200, 201, 0.11\)/gi, '');
      return output;
    }
  }, {
    key: "checkEmpty",
    value: function checkEmpty() {
      var _this10 = this;
      // Get all builder areas
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        _this10.checkEmptyOn(builder);
      });
    }
  }, {
    key: "checkEmptyOn",
    value: function checkEmptyOn(builder) {
      var _this11 = this;
      var dom = this.dom;
      var rows = dom.elementChildren(builder);
      var empty = true;
      rows.forEach(function (row) {
        if (dom.hasClass(row, 'row-add-initial')) return;
        if (dom.hasClass(row, 'dummy-space')) return;
        if (row.tagName.toLowerCase() === 'link') return;
        empty = false;
      });
      if (empty) {
        var emptyinfo = builder.querySelector('.row-add-initial');
        if (!emptyinfo) {
          builder.innerHTML = "<button type=\"button\" class=\"row-add-initial\">".concat(this.out('Empty'), "<br><span class=\"block\">").concat(this.out('+ Click to add content'), "</span></div>");
          emptyinfo = builder.querySelector('.row-add-initial');
        }
        emptyinfo.addEventListener('click', function () {
          _this11.clearActiveCell();
          var builders = _this11.builder.doc.querySelectorAll(_this11.builder.opts.container);
          Array.prototype.forEach.call(builders, function (item) {
            dom.removeClass(item, 'builder-active');
          });
          dom.addClass(builder, 'builder-active');
          dom.addClass(emptyinfo, 'row-active'); // Needed for addContent(). Directly apply class in Util is fine.

          var quickadd = contentbuilder_quickadd(_this11.builder);
          // const builderStuff = this.builder.builderStuff;
          // let quickadd = builderStuff.querySelector('.quickadd'); // see quickadd.js. Directly select by class in Util is fine.

          var tabs = quickadd.querySelector('.is-pop-tabs');
          tabs.style.display = 'none';
          var viewportHeight = window.innerHeight;
          // let top = emptyinfo.getBoundingClientRect().top;
          // const left = emptyinfo.getBoundingClientRect().left + (emptyinfo.offsetWidth * this.builder.opts.zoom)/2 - 11;

          /*
          let top, left;
          if(!this.builder.iframe) {
              top = emptyinfo.getBoundingClientRect().top;
              left = emptyinfo.getBoundingClientRect().left + (emptyinfo.offsetWidth * this.builder.opts.zoom)/2 - 11;
          } else {
              let adjY = this.builder.iframe.getBoundingClientRect().top;
              let adjX = this.builder.iframe.getBoundingClientRect().left;
               top = emptyinfo.getBoundingClientRect().top + adjY;
              left = emptyinfo.getBoundingClientRect().left  + ((emptyinfo.offsetWidth * this.builder.opts.zoom)/2 - 11) + adjX;
          }
          */
          var newPos = _this11.getElementPosition(emptyinfo);
          var top = newPos.top;
          var left = newPos.left;
          var scaleX = newPos.scaleX;
          var scaleY = newPos.scaleY;
          left = left + (emptyinfo.offsetWidth * (scaleX * _this11.builder.opts.zoom) / 2 - 11);
          top = top - (emptyinfo.offsetHeight - emptyinfo.offsetHeight * scaleY);
          quickadd.style.display = 'flex';
          _this11.showPop(quickadd, false, emptyinfo);
          var w = quickadd.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
          var h = quickadd.offsetHeight;
          if (viewportHeight - top > h) {
            top = top + emptyinfo.offsetHeight * _this11.builder.opts.zoom - 19;
            quickadd.style.top = top + window.pageYOffset + 27 + 'px';
            quickadd.style.left = left - w / 2 + 7 + 'px';
            dom.removeClass(quickadd, 'arrow-bottom');
            dom.removeClass(quickadd, 'arrow-right');
            dom.removeClass(quickadd, 'arrow-left');
            dom.removeClass(quickadd, 'center');
            dom.addClass(quickadd, 'arrow-top');
            dom.addClass(quickadd, 'center');
          } else {
            quickadd.style.top = top + window.pageYOffset - h - 8 + 'px';
            quickadd.style.left = left - w / 2 + 7 + 'px';
            dom.removeClass(quickadd, 'arrow-top');
            dom.removeClass(quickadd, 'arrow-right');
            dom.removeClass(quickadd, 'arrow-left');
            dom.removeClass(quickadd, 'center');
            dom.addClass(quickadd, 'arrow-bottom');
            dom.addClass(quickadd, 'center');
          }
          quickadd.setAttribute('data-mode', 'row');
        });
      } else {
        var _emptyinfo = builder.querySelector('.row-add-initial');
        if (_emptyinfo) _emptyinfo.parentNode.removeChild(_emptyinfo);
      }
    }
  }, {
    key: "clearPreferences",
    value: function clearPreferences() {
      localStorage.removeItem('_theme'); //zoom
      localStorage.removeItem('_zoom'); //zoom
      localStorage.removeItem('_buildermode'); //builderMode
      localStorage.removeItem('_editingtoolbar'); //toolbar
      localStorage.removeItem('_editingtoolbardisplay'); //toolbarDisplay
      localStorage.removeItem('_hidecelltool'); //columnTool
      localStorage.removeItem('_rowtool'); //rowTool
      localStorage.removeItem('_hideelementtool'); //elementTool
      localStorage.removeItem('_hidesnippetaddtool'); //snippetAddTool
      localStorage.removeItem('_outlinemode'); //outlineMode
      localStorage.removeItem('_hiderowcoloutline'); //rowcolOutline
      localStorage.removeItem('_outlinestyle'); //outlineStyle
      localStorage.removeItem('_hideelementhighlight'); //elementHighlight
      localStorage.removeItem('_opensnippets'); //snippetOpen
      localStorage.removeItem('_toolstyle'); //toolStyle
      localStorage.removeItem('_snippetssidebardisplay'); //snippetsSidebarDisplay
      localStorage.removeItem('_htmlview');
      localStorage.removeItem('_pasteresult'); //DON'T HAVE PROP
      localStorage.removeItem('_livepreview');
      localStorage.removeItem('_dictation');
      localStorage.removeItem('_mic');
      localStorage.removeItem('_autosendcommand');
      localStorage.removeItem('_disclaimershown');
      localStorage.removeItem('_temp');
      localStorage.removeItem('_top_p');
      localStorage.removeItem('_autosend_delay');
      localStorage.removeItem('_auto_editblock');
      localStorage.removeItem('_command_lang');
      localStorage.removeItem('_ai_panel_open');
      localStorage.removeItem('_pagesize');

      //NOT USED
      localStorage.removeItem('_scrollableeditor');
      localStorage.removeItem('_animatedsorting');
      localStorage.removeItem('_addbuttonplace');
      localStorage.removeItem('_hiderowtool');
      localStorage.removeItem('_dragwithouthandle');
      localStorage.removeItem('_advancedhtmleditor');
      localStorage.removeItem('_hidecolhtmleditor');
      localStorage.removeItem('_hiderowhtmleditor');
      localStorage.removeItem('_sampleshown');
    }

    // source: http://stackoverflow.com/questions/6690752/insert-html-at-caret-in-a-contenteditable-div */
  }, {
    key: "pasteHtmlAtCaret",
    value: function pasteHtmlAtCaret(html, selectPastedContent) {
      this.restoreSelection();
      var sel, range;
      var elm = this.builder.dom.getElm();
      if (!elm.closest('.is-container')) return; // protection to prevent inserting ooutside the editable container

      if (this.builder.win.getSelection) {
        if (!this.builder.activeCol) return;
        sel = this.builder.win.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
          range = sel.getRangeAt(0);
          range.deleteContents();
          var el = this.builder.doc.createElement('div');
          el.innerHTML = html;
          var frag = this.builder.doc.createDocumentFragment(),
            node,
            lastNode;
          while (node = el.firstChild) {
            lastNode = frag.appendChild(node);
          }
          var firstNode = frag.firstChild;
          range.insertNode(frag);
          if (lastNode) {
            range = range.cloneRange();
            range.setStartAfter(lastNode);
            if (selectPastedContent) {
              range.setStartBefore(firstNode);
            } else {
              range.collapse(true);
            }
            sel.removeAllRanges();
            if (!this.builder.isTouchSupport) sel.addRange(range);
          }
        }
      } else if ((sel = this.builder.doc.selection) && sel.type !== 'Control') {
        if (!this.builder.activeCol) return;
        var originalRange = sel.createRange();
        originalRange.collapse(true);
        sel.createRange().pasteHTML(html);
        if (selectPastedContent) {
          range = sel.createRange();
          range.setEndPoint('StartToStart', originalRange);
          if (!this.builder.isTouchSupport) range.select();
        }
      }
    }
  }, {
    key: "refreshModule",
    value: function refreshModule() {
      var module = this.builder.activeModule;
      if (!module) return;
      var index = 1;
      var subblocks = module.querySelectorAll('[data-subblock]');
      Array.prototype.forEach.call(subblocks, function (subblock) {
        var builderhtml = subblock.innerHTML;
        module.setAttribute('data-html-' + index, encodeURIComponent(builderhtml));
        index++;
      });
      var html = decodeURIComponent(module.getAttribute('data-html'));
      html = html.replace(/{id}/g, this.makeId());
      module.innerHTML = '';
      var range = document.createRange();
      range.setStart(module, 0);
      module.appendChild(range.createContextualFragment(html));
      subblocks = module.querySelectorAll('[data-subblock]');
      var i = 1;
      Array.prototype.forEach.call(subblocks, function (subblock) {
        if (module.getAttribute('data-html-' + i)) {
          subblock.innerHTML = decodeURIComponent(module.getAttribute('data-html-' + i));
        }
        i++;
      });
      this.repositionColumnTool(true);
      if (this.builder.onRefreshTool) this.builder.onRefreshTool();
    }

    // Quick reposition column tool
  }, {
    key: "repositionColumnTool",
    value: function repositionColumnTool() {
      var _this12 = this;
      var col = this.builder.activeCol;
      if (!col) return;
      var row = col.parentNode;
      if (!col.parentNode) {
        // when column has just been deleted
        row = this.rowSelected();
      }
      this.colTool = row.querySelector('.is-col-tool');
      if (!this.colTool) return; // when drag block as a new section

      if (!col.parentNode) {
        // when column has just been deleted
        this.colTool.style.display = 'none';
      }
      this.colTool.style.left = col.offsetLeft + 'px';

      // if columnMore is opened
      var columnMore = this.builder.builderStuff.querySelector('.columnmore.active');
      if (columnMore) {
        var btnCellMore = this.colTool.querySelector('.cell-more');
        columnMore.classList.add('transition1');
        setTimeout(function () {
          var newPos = _this12.getElementPosition(btnCellMore);
          var top = newPos.top;
          var left = newPos.left;
          columnMore.style.top = top + 35 + 'px';
          columnMore.style.left = left - 7 + 'px';
          setTimeout(function () {
            columnMore.classList.remove('transition1');
          }, 300);
        }, 30);
      }
    }
  }, {
    key: "hideColumnTool",
    value: function hideColumnTool() {
      var tools = this.builder.doc.querySelectorAll('.is-col-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
    }
  }, {
    key: "isTouchSupport",
    value: function isTouchSupport() {
      /*
      if(('ontouchstart' in window) || (navigator.MaxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0)) {
          return true;
      }else {
          return false;
      }
      */

      // https://stackoverflow.com/questions/4817029/whats-the-best-way-to-detect-a-touch-screen-device-using-javascript
      if (window.matchMedia('(pointer: coarse)').matches) {
        return true;
      } else {
        return false;
      }
    }
  }, {
    key: "detectIE",
    value: function detectIE() {
      // https://stackoverflow.com/questions/49986720/how-to-detect-internet-explorer-11-and-below-versions/49986758
      if (document.documentMode) {
        return true;
      }
      return false;
    }

    // Source: https://css-tricks.com/snippets/javascript/lighten-darken-color/
  }, {
    key: "LightenDarkenColor",
    value: function LightenDarkenColor(col, amt) {
      var usePound = false;
      if (col[0] === '#') {
        col = col.slice(1);
        usePound = true;
      }
      var num = parseInt(col, 16);
      var r = (num >> 16) + amt;
      if (r > 255) r = 255;else if (r < 0) r = 0;
      var b = (num >> 8 & 0x00FF) + amt;
      if (b > 255) b = 255;else if (b < 0) b = 0;
      var g = (num & 0x0000FF) + amt;
      if (g > 255) g = 255;else if (g < 0) g = 0;

      //return (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);
      return (usePound ? '#' : '') + String('000000' + (g | b << 8 | r << 16).toString(16)).slice(-6);
    }
  }, {
    key: "getUIStyles",
    value: function getUIStyles() {
      var _this13 = this;
      var dom = this.dom;
      var html = "\n        <input type=\"text\" class=\"style-helper-input\" id=\"__style_helper_input\" style=\"display:none;\">\n        <button class=\"style-helper-button-classic classic\" style=\"display:none;\"><svg><use xlink:href=\"#ion-code-working\"></use></svg></button>\n        <select class=\"style-helper-select\" id=\"__style_helper_select\" style=\"display:none;\"><option value=\"\"></option></select>\n\n        <div class=\"style-helper modal-color\"></div>\n        <div class=\"style-helper modal-background\"></div>\n        <div class=\"style-helper button-pickcolor-border\"></div>\n        <div class=\"style-helper button-pickcolor-background\"></div>\n\n        <button class=\"style-helper base\"><svg><use xlink:href=\"#ion-code-working\"></use></svg></button>\n        <div class=\"style-helper base on\"></div>\n        <div class=\"style-helper base hover\"></div>\n\n        <div class=\"style-helper snippet-color\"></div>\n        <div class=\"style-helper snippet-background\"></div>\n        <div class=\"style-helper snippet-tabs-background\"></div>\n        <div class=\"style-helper snippet-tab-item-background\"></div>\n        <div class=\"style-helper snippet-tab-item-background-active\"></div>\n        <div class=\"style-helper snippet-tab-item-background-hover\"></div>\n        <div class=\"style-helper snippet-tab-item-color\"></div>\n\n        <div class=\"style-helper snippet-more-item-background\"></div>\n        <div class=\"style-helper snippet-more-item-background-active\"></div>\n        <div class=\"style-helper snippet-more-item-background-hover\"></div>\n        <div class=\"style-helper snippet-more-item-color\"></div>\n\n        <div class=\"style-helper tabs-background\"></div>\n        <div class=\"style-helper tab-item-active-border-bottom\"></div>\n        <div class=\"style-helper tab-item-color\"></div>\n        <div class=\"style-helper tabs-more-background\"></div>\n        <div class=\"style-helper tabs-more-border\"></div>\n        <div class=\"style-helper tabs-more-item-color\"></div>\n        <div class=\"style-helper tabs-more-item-background-hover\"></div>\n        <div class=\"style-helper separator-color\"></div>\n        <div class=\"style-helper outline-color\"></div>\n        ";
      dom.appendHtml(this.builder.builderStuff, html);

      // new method
      var getVal = function getVal(selector, rule) {
        var stuff = _this13.builder.builderStuff.querySelector('.style-helper' + selector);
        return window.getComputedStyle(stuff, null).getPropertyValue(rule);
      };
      var getSvgFill = function getSvgFill() {
        var btn = _this13.builder.builderStuff.querySelector('.style-helper.base');
        return window.getComputedStyle(btn.querySelector('svg'), null).getPropertyValue('fill');
      };
      var inp = this.builder.builderStuff.querySelector('.style-helper-input');
      var sel = this.builder.builderStuff.querySelector('.style-helper-select');
      var btnClassic = this.builder.builderStuff.querySelector('.style-helper-button-classic');
      this.builder.styleModalColor = getVal('.modal-color', 'background-color');
      this.builder.styleModalBackground = getVal('.modal-background', 'background-color');
      this.builder.styleButtonPickColorBorder = getVal('.button-pickcolor-border', 'border');
      this.builder.styleButtonPickColorBackground = getVal('.button-pickcolor-background', 'background-color');
      this.builder.styleToolBackground = getVal('.base', 'background-color');
      this.builder.styleButtonColor = getVal('.base', 'color');
      this.builder.styleButtonSvgFill = getSvgFill();
      // this.builder.styleButtonBackgroundOn = getVal('.base.on', 'background-color');
      this.builder.styleButtonBackgroundHover = getVal('.base.hover', 'background-color');
      this.builder.styleSnippetColor = getVal('.snippet-color', 'background-color');
      this.builder.styleSnippetBackground = getVal('.snippet-background', 'background-color');
      this.builder.styleSnippetTabsBackground = getVal('.snippet-tabs-background', 'background-color');
      this.builder.styleSnippetTabItemBackground = getVal('.snippet-tab-item-background', 'background-color');
      this.builder.styleSnippetTabItemBackgroundActive = getVal('.snippet-tab-item-background-active', 'background-color');
      this.builder.styleSnippetTabItemBackgroundHover = getVal('.snippet-tab-item-background-hover', 'background-color');
      this.builder.styleSnippetTabItemColor = getVal('.snippet-tab-item-color', 'background-color');
      this.builder.styleSnippetMoreItemBackground = getVal('.snippet-more-item-background', 'background-color');
      this.builder.styleSnippetMoreItemBackgroundActive = getVal('.snippet-more-item-background-active', 'background-color');
      this.builder.styleSnippetMoreItemBackgroundHover = getVal('.snippet-more-item-background-hover', 'background-color');
      this.builder.styleSnippetMoreItemColor = getVal('.snippet-more-item-color', 'background-color');

      // Normal Tabs (ex. used in 'Symbol' plugin)
      this.builder.styleTabsBackground = getVal('.tabs-background', 'background-color');
      this.builder.styleTabItemBorderBottomActive = getVal('.tab-item-active-border-bottom', 'border');
      this.builder.styleTabItemColor = getVal('.tab-item-color', 'background-color');
      this.builder.styleTabsMoreBackground = getVal('.tabs-more-background', 'background-color');
      this.builder.styleTabsMoreBorder = getVal('.tabs-more-border', 'border');
      this.builder.styleTabsMoreItemColor = getVal('.tabs-more-item-color', 'background-color');
      this.builder.styleTabsMoreBackgroundHover = getVal('.tabs-more-item-background-hover', 'background-color');
      this.builder.styleSeparatorColor = getVal('.separator-color', 'background-color');
      this.builder.styleOutlineColor = getVal('.outline-color', 'background-color');

      // Select (ex. used in 'Button Editor' plugin, 'Slider' plugin, 'Slider Content' plugin)
      this.builder.styleSelectBackground = window.getComputedStyle(sel, null).getPropertyValue('background-color');
      this.builder.styleSelectColor = window.getComputedStyle(sel, null).getPropertyValue('color');
      this.builder.styleSelectOptionBackground = window.getComputedStyle(sel.querySelector('option'), null).getPropertyValue('background-color');

      // Input (ex. used in 'Search & Replace' plugin)
      this.builder.styleInputBackground = window.getComputedStyle(inp, null).getPropertyValue('background-color');
      this.builder.styleInputBorderBottom = window.getComputedStyle(inp, null).getPropertyValue('border-bottom');
      this.builder.styleInputColor = window.getComputedStyle(inp, null).getPropertyValue('color');

      // Button Classic (ex. used in 'Search & Replace' plugin)
      this.builder.styleButtonClassicBackground = window.getComputedStyle(btnClassic, null).getPropertyValue('background-color');
      this.builder.styleButtonClassicColor = window.getComputedStyle(btnClassic, null).getPropertyValue('color');
      this.builder.styleButtonClassicBackgroundHover = this.getUIStyleValue(btnClassic, 'hover', 'background-color');
      this.builder.styleDark = false;
      this.builder.styleColored = false;
      this.builder.styleColoredDark = false;
      this.builder.styleLight = false;
      if (document.body.getAttribute('class')) {
        if (document.body.getAttribute('class').indexOf('colored-dark') !== -1) {
          this.builder.styleColoredDark = true;
        } else if (document.body.getAttribute('class').indexOf('dark') !== -1) {
          this.builder.styleDark = true;
        } else if (document.body.getAttribute('class').indexOf('colored') !== -1) {
          this.builder.styleColored = true;
        } else if (document.body.getAttribute('class').indexOf('light') !== -1) {
          this.builder.styleLight = true;
        }
      }
    }
  }, {
    key: "getUIStyleValue",
    value: function getUIStyleValue(elm, classname, prop) {
      var dom = this.dom;
      dom.addClass(elm, classname);
      var val = window.getComputedStyle(elm, null).getPropertyValue(prop);
      dom.removeClass(elm, classname);
      return val;
    }
  }, {
    key: "getPageTemplate",
    value: function getPageTemplate(framework) {
      var pageTemplate = '';
      if (framework === '') {
        pageTemplate = "\n            <!DOCTYPE html>\n            <html lang=\"en\">\n            <head>\n                <meta charset=\"utf-8\">\n                <title>Page</title>\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n                <meta name=\"description\" content=\"\">\n                <link rel=\"shortcut icon\" href=\"#\">\n                \n                <link href=\"[%PATH%]/assets/minimalist-blocks/content.css\" rel=\"stylesheet\">\n                \n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.core.css\" rel=\"stylesheet\">\n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.theme.css\" rel=\"stylesheet\">\n                <script src=\"[%PATH%]/assets/scripts/glide/glide.js\"></script>\n                \n                <style>\n                    .container {\n                        margin: 150px auto 0;\n                        max-width: 800px;\n                        width: 100%;\n                        padding: 0 20px;\n                        box-sizing: border-box;\n                    }\n                </style>\n            </head>\n            <body>\n            \n            <div class=\"container\">\n            [%CONTENT%]\n            </div>\n            \n            </body>\n            </html>\n            ";
      } else if (framework === 'tailwind') {
        pageTemplate = "\n            <!DOCTYPE html>\n            <html lang=\"en\">\n            <head>\n                <meta charset=\"utf-8\">\n                <title>Page</title>\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n                <meta name=\"description\" content=\"\">\n                <link rel=\"shortcut icon\" href=\"#\">\n                \n                <link href=\"[%PATH%]/assets/minimalist-blocks/content-tailwind.css\" rel=\"stylesheet\">\n                \n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.core.css\" rel=\"stylesheet\">\n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.theme.css\" rel=\"stylesheet\">\n                <script src=\"[%PATH%]/assets/scripts/glide/glide.js\"></script>\n                \n                <link rel=\"stylesheet\" href=\"[%PATH%]/assets/frameworks/tailwindcss/styles.css\">\n                <!-- To build your own, please see: https://tailwindcss.com/docs/installation -->\n                \n                <style>\n                    .container {\n                        margin: 150px auto 0;\n                        max-width: 800px;\n                        width: 100%;\n                        padding: 0 20px;\n                        box-sizing: border-box;\n                    }\n                </style>\n            </head>\n            <body>\n            \n            <div class=\"container\">\n            [%CONTENT%]\n            </div>\n            \n            </body>\n            </html>\n            ";
      } else if (framework === 'bootstrap') {
        pageTemplate = "\n            <!DOCTYPE html>\n            <html lang=\"en\">\n            <head>\n                <meta charset=\"utf-8\">\n                <title>Page</title>\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n                <meta name=\"description\" content=\"\">\n                <link rel=\"shortcut icon\" href=\"#\">\n\n                <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\" integrity=\"sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\" crossorigin=\"anonymous\">\n    \n                <link href=\"[%PATH%]/assets/minimalist-blocks/content.css\" rel=\"stylesheet\">\n                \n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.core.css\" rel=\"stylesheet\">\n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.theme.css\" rel=\"stylesheet\">\n                <script src=\"[%PATH%]/assets/scripts/glide/glide.js\"></script>\n                \n                <style>\n                    .container {margin: 140px auto; max-width: 800px; width:100%; padding:0 35px; box-sizing: border-box;}\n                    /* Bootstrap css adjustment to enable column drag to resize */\n                    .row > *,\n                    .column {\n                        max-width: unset !important;\n                    }\n                </style>\n            </head>\n            <body>\n            \n            <div class=\"container\">\n            [%CONTENT%]\n            </div>\n            \n            </body>\n            </html>\n            ";
      } else if (framework === 'foundation') {
        pageTemplate = "\n            <!DOCTYPE html>\n            <html lang=\"en\">\n            <head>\n                <meta charset=\"utf-8\">\n                <title>Page</title>\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n                <meta name=\"description\" content=\"\">\n                <link rel=\"shortcut icon\" href=\"#\">\n\n                <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.3/css/foundation.min.css\">\n                <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/foundation/6.5.3/css/foundation-float.min.css\">\n            \n                <link href=\"[%PATH%]/assets/minimalist-blocks/content.css\" rel=\"stylesheet\">\n                \n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.core.css\" rel=\"stylesheet\">\n                <link href=\"[%PATH%]/assets/scripts/glide/css/glide.theme.css\" rel=\"stylesheet\">\n                <script src=\"[%PATH%]/assets/scripts/glide/glide.js\"></script>\n                \n                <style>\n                    .container {\n                        margin: 150px auto 0;\n                        max-width: 800px;\n                        width: 100%;\n                        padding: 0 20px;\n                        box-sizing: border-box;\n                    }\n                </style>\n            </head>\n            <body>\n            \n            <div class=\"container\">\n            [%CONTENT%]\n            </div>\n            \n            </body>\n            </html>\n            ";
      } else {
        pageTemplate = '[%CONTENT%]';
      }
      return pageTemplate;
    }
  }, {
    key: "getElementPosition",
    value: function getElementPosition(element) {
      var iframe = this.builder.iframe;
      var top, left;
      var scaleX, scaleY;
      if (this.builder.iframe) {
        var divContentView = document.querySelector('.is-content-view');
        if (!divContentView) divContentView = iframe.parentNode;
        var divContentViewStyles = window.getComputedStyle(divContentView);
        var transform = divContentViewStyles.transform;
        if (transform !== 'none') {
          var matrixValues = transform.match(/matrix\(([0-9., -]+)\)/)[1].split(',');
          scaleX = parseFloat(matrixValues[0]);
          scaleY = parseFloat(matrixValues[3]);
        } else {
          scaleX = 1;
          scaleY = 1;
        }
        var iframeRect = iframe.getBoundingClientRect();
        top = element.getBoundingClientRect().top * scaleY + iframeRect.top;
        left = element.getBoundingClientRect().left * scaleX + iframeRect.left;
      } else {
        top = element.getBoundingClientRect().top;
        left = element.getBoundingClientRect().left;
        scaleX = 1;
        scaleY = 1;
      }
      return {
        top: top,
        left: left,
        scaleX: scaleX,
        scaleY: scaleY
      };
    }
  }]);
  return Util;
}();
var Dom = /*#__PURE__*/function () {
  function Dom(builder) {
    util_classCallCheck(this, Dom);
    this.builder = builder;
  }
  util_createClass(Dom, [{
    key: "getScale",
    value: function getScale(container) {
      var matrix = window.getComputedStyle(container).transform;
      if (matrix === 'none') return 1;
      var values = matrix.split('(')[1];
      values = values.split(')')[0];
      values = values.split(',');
      var a = values[0];
      var b = values[1];
      var scale = Math.sqrt(a * a + b * b);
      return scale;
    }
  }, {
    key: "createElement",
    value: function createElement(tag) {
      return document.createElement(tag);
    }
  }, {
    key: "appendChild",
    value: function appendChild(parent, child) {
      if (parent) parent.appendChild(child);
    }
  }, {
    key: "appendHtml",
    value: function appendHtml(parent, html) {
      if (parent) parent.insertAdjacentHTML('beforeend', html);
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(parent, type, listener) {
      if (parent) parent.addEventListener(type, listener);
    }
  }, {
    key: "addClass",
    value: function addClass(element, classname) {
      if (!element) return;
      if (this.hasClass(element, classname)) return;
      if (element.classList.length === 0) element.className = classname;else element.className = element.className + ' ' + classname;
      element.className = element.className.replace(/  +/g, ' ');
      //else element.classList.add(classname); //error if there is -
    }
  }, {
    key: "removeClass",
    value: function removeClass(element, classname) {
      if (!element) return;
      if (element.classList.length > 0) {
        // element.className = element.className.replace(new RegExp('\\b'+ classname+'\\b', 'g'), '');
        // element.className = element.className.replace(/  +/g, ' ');

        var i, j, imax, jmax;
        var classesToDel = classname.split(' ');
        for (i = 0, imax = classesToDel.length; i < imax; ++i) {
          if (!classesToDel[i]) continue;
          var classtoDel = classesToDel[i];

          // https://jsperf.com/removeclass-methods 
          var sClassName = '';
          var currentClasses = element.className.split(' ');
          for (j = 0, jmax = currentClasses.length; j < jmax; ++j) {
            if (!currentClasses[j]) continue;
            if (currentClasses[j] !== classtoDel) sClassName += currentClasses[j] + ' ';
          }
          element.className = sClassName.trim();
        }
        if (element.className === '') element.removeAttribute('class');
      }
    }
  }, {
    key: "removeClassesByPrefix",
    value: function removeClassesByPrefix(element, prefix) {
      var _this14 = this;
      if (element.classList) {
        element.classList.forEach(function (item) {
          if (item.indexOf(prefix) === 0) {
            _this14.removeClass(element, item);
          }
        });
      }
    }
  }, {
    key: "hasClass",
    value: function hasClass(element, className) {
      if (!element) return false;
      if (!element.className) return false;
      return (' ' + element.className + ' ').indexOf(' ' + className + ' ') > -1;
    }
  }, {
    key: "moveAfter",
    value: function moveAfter(element, targetElement) {
      targetElement.parentNode.insertBefore(element, targetElement);
      targetElement.parentNode.insertBefore(targetElement, targetElement.previousElementSibling);
    }

    // https://stackoverflow.com/questions/10381296/best-way-to-get-child-nodes
  }, {
    key: "elementChildren",
    value: function elementChildren(element) {
      var childNodes = element.childNodes;
      var children = [];
      var i = childNodes.length;
      while (i--) {
        if (childNodes[i].nodeType === 1 /*&& childNodes[i].tagName === 'DIV'*/) {
          children.unshift(childNodes[i]);
        }
      }
      return children;
    }
  }, {
    key: "getElementOffset",
    value: function getElementOffset(el) {
      var rect = el.getBoundingClientRect();
      return {
        top: rect.top + window.pageYOffset,
        left: rect.left + window.pageXOffset,
        width: rect.width,
        height: rect.height
      };
    }
  }, {
    key: "parentsHasClass",
    value: function parentsHasClass(element, classname) {
      while (element) {
        // if(classname==='is-side') console.log(element.nodeName); // NOTE: click on svg can still returns undefined in IE11
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        // if(!element.classList) {
        //     return false;
        // }
        if (this.hasClass(element, classname)) {
          return true;
        }
        // TODO: if(element.nodeName.toLowerCase() === 'svg') console.log(element);
        element = element.parentNode;
      }
    }
  }, {
    key: "parentsHasId",
    value: function parentsHasId(element, id) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        if (element.id === id) {
          return true;
        }
        element = element.parentNode;
      }
    }
  }, {
    key: "parentsHasTag",
    value: function parentsHasTag(element, tagname) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        if (element.tagName.toLowerCase() === tagname.toLowerCase()) {
          return true;
        }
        element = element.parentNode;
      }
    }
  }, {
    key: "parentsHasAttribute",
    value: function parentsHasAttribute(element, attrname) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        try {
          if (element.hasAttribute(attrname)) {
            // error on svg element
            return true;
          }
        } catch (e) {
          // Do Nothing
          // return false;
        }
        element = element.parentNode;
      }
    }
  }, {
    key: "getParentByTag",
    value: function getParentByTag(element, tagname) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        if (element.tagName.toLowerCase() === tagname.toLowerCase()) {
          return element;
        }
        element = element.parentNode;
      }
    }
  }, {
    key: "getParentByAttribute",
    value: function getParentByAttribute(element, attrname) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        try {
          if (element.hasAttribute(attrname)) {
            // error on svg element
            return element;
          }
        } catch (e) {
          // Do Nothing
          // return false;
        }
        element = element.parentNode;
      }
    }
  }, {
    key: "parentsHasElement",
    value: function parentsHasElement(element, tagname) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        element = element.parentNode;
        if (!element) return false;
        if (!element.tagName) return false;
        if (element.tagName.toLowerCase() === tagname) {
          return true;
        }
      }
    }
  }, {
    key: "getParentElement",
    value: function getParentElement(element, tagname) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        element = element.parentNode;
        if (!element) return false;
        if (!element.tagName) return false;
        if (element.tagName.toLowerCase() === tagname) {
          return element;
        }
      }
    }
  }, {
    key: "removeClasses",
    value: function removeClasses(elms, classname) {
      for (var i = 0; i < elms.length; i++) {
        elms[i].classList.remove(classname);
      }
    }
  }, {
    key: "removeAttributes",
    value: function removeAttributes(elms, attrname) {
      for (var i = 0; i < elms.length; i++) {
        elms[i].removeAttribute(attrname);
      }
    }
  }, {
    key: "removeElements",
    value: function removeElements(elms) {
      Array.prototype.forEach.call(elms, function (el) {
        el.parentNode.removeChild(el);
      });
    }

    // source: https://stackoverflow.com/questions/2871081/jquery-setting-cursor-position-in-contenteditable-div
  }, {
    key: "moveCursorToElement",
    value: function moveCursorToElement(element) {
      var sel, range;
      if (window.getSelection && this.builder.doc.createRange) {
        range = this.builder.doc.createRange();
        range.selectNodeContents(element);
        range.collapse(false);
        sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      } else if (this.builder.doc.body.createTextRange) {
        range = this.builder.doc.body.createTextRange();
        range.moveToElementText(element);
        range.collapse(false);
        range.select();
      }
    }

    // source: https://stackoverflow.com/questions/6139107/programmatically-select-text-in-a-contenteditable-html-element
  }, {
    key: "selectElementContents",
    value: function selectElementContents(el) {
      var range = this.builder.doc.createRange();
      range.selectNodeContents(el);
      var sel = this.builder.win.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
    }

    // Get selected text
  }, {
    key: "getSelected",
    value: function getSelected() {
      if (this.builder.win.getSelection) {
        return this.builder.win.getSelection().toString();
      } else if (this.builder.doc.getSelection) {
        return this.builder.doc.getSelection().toString();
      } else {
        var selection = this.builder.doc.selection && this.builder.doc.selection.createRange();
        if (selection.text) {
          return selection.text;
        }
        return false;
      }
    }
  }, {
    key: "checkEditable",
    value: function checkEditable() {
      try {
        var el;
        var curr;
        if (this.builder.win.getSelection) {
          curr = this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
          if (curr.nodeType === 3) {
            //ini text node
            el = curr.parentNode;
          } else {
            el = curr;
          }
        } else if (this.builder.doc.selection) {
          curr = this.builder.doc.selection.createRange();
          el = this.builder.doc.selection.createRange().parentElement();
        }
        if (this.parentsHasAttribute(el, 'contenteditable')) return true;else return false;
      } catch (e) {
        return false;
      }
    }
  }, {
    key: "textSelection",
    value: function textSelection() {
      var selection = this.getSelection();
      var anchorNode = selection.anchorNode;
      if (!anchorNode) return false;
      var container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
      return container;
    }
  }, {
    key: "getStyle",
    value: function getStyle(element, property) {
      return window.getComputedStyle ? window.getComputedStyle(element, null).getPropertyValue(property) : element.style[property.replace(/-([a-z])/g, function (g) {
        return g[1].toUpperCase();
      })];
    }

    //https://stackoverflow.com/questions/32383349/detect-input-value-change-with-mutationobserver/61975440#61975440
  }, {
    key: "observeElement",
    value: function observeElement(element, property, callback) {
      var delay = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
      var elementPrototype = Object.getPrototypeOf(element);
      if (Object.prototype.hasOwnProperty.call(elementPrototype, property)) {
        var descriptor = Object.getOwnPropertyDescriptor(elementPrototype, property);
        Object.defineProperty(element, property, {
          get: function get() {
            return descriptor.get.apply(this, arguments);
          },
          set: function set() {
            var oldValue = this[property];
            descriptor.set.apply(this, arguments);
            var newValue = this[property];
            if (typeof callback == 'function') {
              setTimeout(callback.bind(this, oldValue, newValue), delay);
            }
            // return newValue;
          }
        });
      }
    }
  }, {
    key: "baseName",
    value: function baseName(str) {
      if (typeof str !== 'string') return;
      var frags = str.split('.');
      return frags.splice(0, frags.length - 1).join('.');
    }

    /** added by Jack */
  }, {
    key: "doFunction",
    value: function doFunction(elm, fn, incChilds) {
      fn(elm);
      if (incChilds) {
        var elmns = Array.prototype.slice.call(elm.getElementsByTagName('*'));
        for (var i = 0; i < elmns.length; i++) {
          fn(elmns[i]);
        }
      }
    }
    // ---

    // execCommand replacement
  }, {
    key: "execCommand",
    value: function execCommand(action, value, callback) {
      var blocks = this.getSelectedBlocks();
      if (blocks.length > 0) {
        blocks.forEach(function (item) {
          callback(true, item);
        });
      } else {
        var selection = this.builder.win.getSelection();
        var container = this.getElm();
        if (!container) {
          if (callback) callback(false);
          return;
        }
        var sameSelection = container && container.innerText === selection.toString().trim();
        var newElement;
        if (sameSelection || selection.toString().trim() === '') {
          newElement = this.updateSelection(action, value, container);
        } else {
          newElement = this.replaceSelection(action, value, selection, container);
        }
        if (callback) callback(true, newElement);
      }
    }
  }, {
    key: "updateSelection",
    value: function updateSelection(action, value, container) {
      // container.style[action] = value; //APPLY => Use getStyleValue to check if toggle is needed.
      container.style[action] = this.getStyleValue(container, action, value);

      // Optional, better if used: check if the style is the same as its parent. If so, clear it.
      this.checkStyleIfSameAsParent(container, action);
      this.cleanChildren(action, container);
      this.cleanUnusedSpan(container); // REVIEW

      return container;
    }
  }, {
    key: "replaceSelection",
    value: function replaceSelection(action, value, selection, container) {
      var range = selection.getRangeAt(0);
      var fragment = range.extractContents();
      var span = this.createSpan(container, action, value);
      span.appendChild(fragment);
      this.cleanChildren(action, span);
      this.cleanUnusedSpan(span); // REVIEW

      range.insertNode(span);
      selection.selectAllChildren(span);

      // Optional, better if used: check if the style is the same as its parent. If so, clear it.
      this.checkStyleIfSameAsParent(span, action);
      return span;
    }
  }, {
    key: "checkStyleIfSameAsParent",
    value: function checkStyleIfSameAsParent(element, action) {
      if (element.parentNode) {
        if (element.parentNode.style[action] === element.style[action] || window.getComputedStyle(element.parentNode, null).getPropertyValue(action) === element.style[action]) {
          element.style[action] = '';
          if (element.getAttribute('style') === '' || element.style === null) {
            element.removeAttribute('style');
          }

          // REVIEW
          var unused = element.attributes.length === 0 || element.attributes.length === 1 && element.hasAttribute('data-keep');
          if (element.nodeName.toLowerCase() === 'span' && unused) {
            var text = document.createTextNode(element.textContent);
            element.parentElement.replaceChild(text, element);
          }
        }
      }
    }
  }, {
    key: "createSpan",
    value: function createSpan(container, action, value) {
      var span = document.createElement('span');

      // span.style[action] = value; //APPLY => Use getStyleValue to check if toggle is needed.
      span.style[action] = this.getStyleValue(container, action, value);
      return span;
    }
  }, {
    key: "findParentStyle",
    value: function findParentStyle(node, action) {
      if (node.nodeName.toUpperCase() === 'HTML' || node.nodeName.toUpperCase() === 'BODY') {
        return null;
      }
      if (!node.parentNode) {
        return null;
      }
      var hasStyle = node.style[action] !== null && node.style[action] !== undefined && node.style[action] !== '';
      if (hasStyle) {
        return node;
      }
      this.findParentStyle(node.parentNode, action);
    }
  }, {
    key: "getStyleValue",
    value: function getStyleValue(container, action, value) {
      if (action === 'font-weight' || action === 'font-style' || action === 'text-decoration' || action === 'text-transform') {
        // Toggle
        // let currentValue = window.getComputedStyle(container, null).getPropertyValue(action);
        var parent = this.findParentStyle(container, action);
        var currentValue;
        if (parent) {
          currentValue = parent.style[action];
        }
        if (value === currentValue) {
          //toggle here
          // value = 'initial'; // the problem with initial is that it is always refer to font-weight: 400 (won;t work for custom 300 for normal paragraph)
          // so we'll do the test first, to find the actuat initial value
          container.style[action] = ''; // test
          var initialValue = window.getComputedStyle(container, null).getPropertyValue(action); // get the actual initial value
          // console.log('initial:' +initialValue);
          container.style[action] = currentValue; //return back from test
          value = initialValue;
        }
      }
      return value;
    }
  }, {
    key: "getParentBlock",
    value: function getParentBlock(element) {
      while (element) {
        if (!element.tagName) return false;
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        if (this.getStyle(element, 'display') !== 'inline') {
          return element;
        }
        element = element.parentNode;
      }
    }

    // execCommand replacement => for general, apply class to current element
  }, {
    key: "execCommandClass",
    value: function execCommandClass(newClassName, classList) {
      var _this15 = this;
      var currentElement = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      var mode = arguments.length > 3 ? arguments[3] : undefined;
      // USed by line height & letter spacing (rte,js)
      var blocks = this.getSelectedBlocks();
      if (blocks.length > 0) {
        blocks.forEach(function (item) {
          for (var i = 0; i < Object.keys(classList).length; i++) {
            var className = Object.values(classList)[i];
            _this15.removeClass(item, className);
          }
          if (newClassName !== '') _this15.addClass(item, newClassName);
          _this15.cleanChildrenClass(item, classList);
          _this15.cleanUnusedSpan(item); // REVIEW
        });
      } else {
        var selection = this.builder.win.getSelection();
        var container = this.getElm();
        if (!container) return;
        var sameSelection = container && container.innerText === selection.toString().trim();
        if (currentElement) {
          if (mode === 'block') if (this.getStyle(container, 'display') === 'inline') {
            container = this.getParentBlock(container);
          }
          this.updateSelectionClass(newClassName, classList, container);
        } else {
          if (sameSelection || selection.toString().trim() === '') {
            if (mode === 'block') if (this.getStyle(container, 'display') === 'inline') {
              container = this.getParentBlock(container);
            }
            this.updateSelectionClass(newClassName, classList, container);
          } else {
            // Not yet needed
            // this.replaceSelectionToggle(action, value, config, selection, container);
          }
        }
      }
    }
  }, {
    key: "updateSelectionClass",
    value: function updateSelectionClass(newClassName, classList, container) {
      for (var i = 0; i < Object.keys(classList).length; i++) {
        var className = Object.values(classList)[i];
        this.removeClass(container, className);
      }
      if (newClassName !== '') this.addClass(container, newClassName);
      this.cleanChildrenClass(container, classList);
      this.cleanUnusedSpan(container); // REVIEW

      return container;
    }
  }, {
    key: "cleanChildrenClass",
    value: function cleanChildrenClass(span, classList) {
      var _this16 = this;
      if (!span.hasChildNodes()) {
        return;
      }
      Array.from(span.children).map(function (element) {
        for (var i = 0; i < Object.keys(classList).length; i++) {
          var className = Object.values(classList)[i];
          _this16.removeClass(element, className);
        }
      });

      // Deeper childrens
      var cleanChildrenChildren = Array.from(span.children).map(function (element) {
        return _this16.cleanChildrenClass(element, classList);
      });
      if (!cleanChildrenChildren || cleanChildrenChildren.length <= 0) {
        return;
      }
    }
  }, {
    key: "getSelectedBlocks",
    value: function getSelectedBlocks() {
      var multiSelectBlocks = false;
      var selection = this.builder.win.getSelection();
      var elements = [];
      if (!selection.isCollapsed) {
        var range = selection.getRangeAt(0);
        var container = range.commonAncestorContainer;
        var traverse = function traverse(node) {
          if (node.nodeType === Node.ELEMENT_NODE) {
            if (range.intersectsNode(node)) {
              elements.push(node);
            }
          }
          if (node.childNodes.length > 0) {
            for (var i = 0; i < node.childNodes.length; i++) {
              traverse(node.childNodes[i]);
            }
          }
        };
        traverse(container);

        // Remove the first item if it's the parent element
        if (elements.length > 0 && elements[0] === container) {
          elements.shift();
        }
      }
      var blocks = [];
      var blockElms = ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'div', 'pre', 'td', 'th', 'li'];
      elements.forEach(function (item) {
        var tagName = item.tagName.toLowerCase();
        if (blockElms.includes(tagName)) {
          multiSelectBlocks = true;
          blocks.push(item);
        }
      });

      /*
      If a block is double clicked to select the block, the selection goes to the next block as well.
      This seems a default behavior (tested with simple contentEditable div). So the blocks contains 2 blocks.
      To fix this, perform an extra test here:
      */
      if (blocks.length === 2) {
        // console.log(blocks[0].innerText.trim());
        // console.log(selection.toString().trim());
        if (blocks[0].innerText.trim() === selection.toString().trim()) {
          blocks.pop();
          // console.log('remove last')
        }
      }

      if (multiSelectBlocks) {
        return blocks;
      } else {
        return [];
      }
    }

    // execCommand replacement => for CLASS
  }, {
    key: "execCommandToggle",
    value: function execCommandToggle(action, value, config) {
      var _this17 = this;
      var blocks = this.getSelectedBlocks();
      if (blocks.length > 0) {
        blocks.forEach(function (item) {
          if (action === 'fontWeight') {
            var bold = false;
            if (_this17.hasClass(item, config.fontWeight.defaultBold)) {
              bold = true;
            }
            // const num = parseInt(window.getComputedStyle(item, null).getPropertyValue('font-weight'));
            // if(num>=500) bold = true;
            _this17.removeClass(item, config.fontWeight.thin);
            _this17.removeClass(item, config.fontWeight.extralight);
            _this17.removeClass(item, config.fontWeight.light);
            _this17.removeClass(item, config.fontWeight.normal);
            _this17.removeClass(item, config.fontWeight.medium);
            _this17.removeClass(item, config.fontWeight.semibold);
            _this17.removeClass(item, config.fontWeight.bold);
            _this17.removeClass(item, config.fontWeight.extrabold);
            _this17.removeClass(item, config.fontWeight.black);
            if (bold) {
              // Do Nothing (must not have parent with bold, so just remove bold class)
              // this.addClass(item, config.fontWeight.defaultNormal);
            } else {
              _this17.addClass(item, config.fontWeight.defaultBold);
            }
          }
          if (action === 'fontStyle') {
            var italic = false;
            if (_this17.hasClass(item, config.fontStyle.italic)) {
              italic = true;
            }
            _this17.removeClass(item, config.fontStyle.italic);
            _this17.removeClass(item, config.fontStyle.normal);
            if (italic) {
              // Do Nothing
              // this.addClass(item, config.fontStyle.normal);
            } else {
              _this17.addClass(item, config.fontStyle.italic);
            }
          }
          if (action === 'textUnderline') {
            var underline = false;
            if (_this17.hasClass(item, config.textDecoration.underline)) {
              underline = true;
            }
            _this17.removeClass(item, config.textDecoration.linethrough);
            _this17.removeClass(item, config.textDecoration.underline);
            _this17.removeClass(item, config.textDecoration.normal);
            if (underline) {
              // Do Nothing
              // this.addClass(item, config.textDecoration.normal);
            } else {
              _this17.addClass(item, config.textDecoration.underline);
            }
          }
          if (action === 'textLinethrough') {
            var linethrough = false;
            if (_this17.hasClass(item, config.textDecoration.linethrough)) {
              linethrough = true;
            }
            _this17.removeClass(item, config.textDecoration.underline);
            _this17.removeClass(item, config.textDecoration.linethrough);
            _this17.removeClass(item, config.textDecoration.normal);
            if (linethrough) {
              // Do Nothing
              // this.addClass(item, config.textDecoration.normal);
            } else {
              _this17.addClass(item, config.textDecoration.linethrough);
            }
          }
          /*
          if(action === 'textTransform') {
              let val = '';
              if(this.hasClass(item, config.textTransform.uppercase)) {
                  val = 'uppercase';
              } else if(this.hasClass(item, config.textTransform.lowercase)) {
                  val = 'lowercase';
              } else if(this.hasClass(item, config.textTransform.capitalize)) {
                  val = 'capitalize';
              } else if(this.hasClass(item, config.textTransform.normal)) {
                  val = 'normal';
              } 
              this.removeClass(item, config.textTransform.uppercase);
              this.removeClass(item, config.textTransform.lowercase);
              this.removeClass(item, config.textTransform.capitalize);
              this.removeClass(item, config.textTransform.normal);
              if (val === '') {
                  this.addClass(item, config.textTransform.uppercase);
              } else if (val === 'uppercase') {
                  this.addClass(item, config.textTransform.lowercase);
              } else if (val === 'lowercase') {
                  this.addClass(item, config.textTransform.capitalize);
              } else if (val === 'capitalize') {
                  // Do Nothing
                  // this.addClass(item, config.textTransform.normal);
              } else if (val === 'normal') {
                  this.addClass(item, config.textTransform.uppercase);
              } 
          }
          */

          if (action === 'textTransform') {
            var val = '';
            if (_this17.hasClass(item, config.textTransform.uppercase)) {
              val = 'uppercase';
            }
            _this17.removeClass(item, config.textTransform.uppercase);
            _this17.removeClass(item, config.textTransform.lowercase);
            _this17.removeClass(item, config.textTransform.capitalize);
            _this17.removeClass(item, config.textTransform.normal);
            if (val === '') {
              _this17.addClass(item, config.textTransform.uppercase);
            }
          }
          if (action === 'clean') {
            item.className = '';
            item.style.cssText = '';
          }
          if (action === 'extend') {
            var toggle = false;
            if (_this17.hasClass(item, config.extend[value])) {
              toggle = true;
            }
            if (toggle) {
              _this17.removeClass(item, config.extend[value]);
            } else {
              _this17.addClass(item, config.extend[value]);
            }
          }
          _this17.cleanChildrenToggle(action, value, item, config);
          _this17.cleanUnusedSpan(item); // REVIEW
        });
      } else {
        var selection = this.builder.win.getSelection();
        var container = this.getElm();
        if (!container) return;
        var sameSelection = container && container.innerText === selection.toString().trim();
        if (sameSelection || selection.toString().trim() === '') {
          this.updateSelectionToggle(action, value, config, container);
        } else {
          this.replaceSelectionToggle(action, value, config, selection, container);
        }
      }
    }
  }, {
    key: "getElm",
    value: function getElm() {
      var selection = this.builder.win.getSelection();
      if (!selection) return false;
      var anchorNode = selection.anchorNode;
      if (!anchorNode) return false;
      var container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
      return container;
    }
  }, {
    key: "updateSelectionToggle",
    value: function updateSelectionToggle(action, value, config, container) {
      // container.setAttribute('data-dummy','1');

      if (action === 'fontWeight') {
        var bold = false;
        if (this.hasClass(container, config.fontWeight.defaultBold)) {
          bold = true;
        }
        var num = parseInt(window.getComputedStyle(container, null).getPropertyValue('font-weight'));
        if (num >= 500) bold = true;
        this.removeClass(container, config.fontWeight.thin);
        this.removeClass(container, config.fontWeight.extralight);
        this.removeClass(container, config.fontWeight.light);
        this.removeClass(container, config.fontWeight.normal);
        this.removeClass(container, config.fontWeight.medium);
        this.removeClass(container, config.fontWeight.semibold);
        this.removeClass(container, config.fontWeight.bold);
        this.removeClass(container, config.fontWeight.extrabold);
        this.removeClass(container, config.fontWeight.black);
        if (bold) {
          // A must to keep selection no change, otherwise, removing class & then span makes the selection changes (to check, click B/bold 3 times to toggle. The third will not work)
          this.addClass(container, config.fontWeight.defaultNormal);
        } else {
          this.addClass(container, config.fontWeight.defaultBold);
        }
      }
      if (action === 'fontStyle') {
        var italic = false;
        if (this.hasClass(container, config.fontStyle.italic)) {
          italic = true;
        }
        this.removeClass(container, config.fontStyle.italic);
        this.removeClass(container, config.fontStyle.normal);
        if (italic) {
          this.addClass(container, config.fontStyle.normal);
        } else {
          this.addClass(container, config.fontStyle.italic);
        }
      }
      if (action === 'textUnderline') {
        var underline = false;
        if (this.hasClass(container, config.textDecoration.underline)) {
          underline = true;
        }
        this.removeClass(container, config.textDecoration.underline);
        this.removeClass(container, config.textDecoration.linethrough);
        this.removeClass(container, config.textDecoration.normal);
        if (underline) {
          this.addClass(container, config.textDecoration.normal);
        } else {
          this.addClass(container, config.textDecoration.underline);
        }
      }
      if (action === 'textLinethrough') {
        var linethrough = false;
        if (this.hasClass(container, config.textDecoration.linethrough)) {
          linethrough = true;
        }
        this.removeClass(container, config.textDecoration.underline);
        this.removeClass(container, config.textDecoration.linethrough);
        this.removeClass(container, config.textDecoration.normal);
        if (linethrough) {
          this.addClass(container, config.textDecoration.normal);
        } else {
          this.addClass(container, config.textDecoration.linethrough);
        }
      }

      /*
      if(action === 'textTransform') {
          let val = '';
          if(this.hasClass(container, config.textTransform.uppercase)) {
              val = 'uppercase';
          } else if(this.hasClass(container, config.textTransform.lowercase)) {
              val = 'lowercase';
          } else if(this.hasClass(container, config.textTransform.capitalize)) {
              val = 'capitalize';
          } else if(this.hasClass(container, config.textTransform.normal)) {
              val = 'normal';
          } 
          this.removeClass(container, config.textTransform.uppercase);
          this.removeClass(container, config.textTransform.lowercase);
          this.removeClass(container, config.textTransform.capitalize);
          this.removeClass(container, config.textTransform.normal);
          if (val === '') {
              this.addClass(container, config.textTransform.uppercase);
          } else if (val === 'uppercase') {
              this.addClass(container, config.textTransform.lowercase);
          } else if (val === 'lowercase') {
              this.addClass(container, config.textTransform.capitalize);
          } else if (val === 'capitalize') {
              this.addClass(container, config.textTransform.normal);
          } else if (val === 'normal') {
              this.addClass(container, config.textTransform.uppercase);
          } 
      }
      */
      if (action === 'textTransform') {
        var val = '';
        if (this.hasClass(container, config.textTransform.uppercase)) {
          val = 'uppercase';
        }
        this.removeClass(container, config.textTransform.uppercase);
        this.removeClass(container, config.textTransform.lowercase);
        this.removeClass(container, config.textTransform.capitalize);
        this.removeClass(container, config.textTransform.normal);
        if (val === '') {
          this.addClass(container, config.textTransform.uppercase);
        }
      }
      if (action === 'clean') {
        container.className = '';
        container.style.cssText = '';
      }
      if (action === 'extend') {
        var toggle = false;
        if (this.hasClass(container, config.extend[value])) {
          toggle = true;
        }
        if (toggle) {
          this.removeClass(container, config.extend[value]);
        } else {
          this.addClass(container, config.extend[value]);
        }
      }
      this.cleanChildrenToggle(action, value, container, config);
      this.cleanUnusedSpan(container); // REVIEW

      return container;
    }
  }, {
    key: "replaceSelectionToggle",
    value: function replaceSelectionToggle(action, value, config, selection, container) {
      var range = selection.getRangeAt(0);
      var fragment = range.extractContents();
      var span = document.createElement('span');
      if (action === 'fontWeight') {
        var bold = false;
        if (container.closest(".".concat(config.fontWeight.defaultBold))) {
          bold = true;
          if (this.hasClass(container, config.fontWeight.defaultNormal)) {
            bold = false;
          }
        }
        var num = parseInt(window.getComputedStyle(container, null).getPropertyValue('font-weight'));
        if (num >= 500) bold = true;
        if (bold) {
          this.addClass(span, config.fontWeight.defaultNormal);
        } else {
          this.addClass(span, config.fontWeight.defaultBold);
        }
      }
      if (action === 'fontStyle') {
        var italic = false;
        if (container.closest(".".concat(config.fontStyle.italic))) {
          italic = true;
          if (this.hasClass(container, config.fontStyle.normal)) {
            italic = false;
          }
        }
        if (italic) {
          this.addClass(span, config.fontStyle.normal);
        } else {
          this.addClass(span, config.fontStyle.italic);
        }
      }
      if (action === 'textUnderline') {
        var underline = false;
        if (container.closest(".".concat(config.textDecoration.underline))) {
          underline = true;
        }
        if (underline) {
          // Do Nothing (because no-underline inside underline doesn't work)
          // this.addClass(span, config.textDecoration.normal);
        } else {
          this.addClass(span, config.textDecoration.underline);
        }
      }
      if (action === 'textLinethrough') {
        var linethrough = false;
        if (container.closest(".".concat(config.textDecoration.linethrough))) {
          linethrough = true;
        }
        if (linethrough) {
          // Do Nothing
          // this.addClass(span, config.textDecoration.normal);
        } else {
          this.addClass(span, config.textDecoration.linethrough);
        }
      }
      /*
      if(action === 'textTransform') {
          let val = '';
          if(container.closest(`.${config.textTransform.uppercase}`)) {
              val = 'uppercase';
          } else if(container.closest(`.${config.textTransform.lowercase}`)) {
              val = 'lowercase';
          } else if(container.closest(`.${config.textTransform.capitalize}`)) {
              val = 'capitalize';
          } else if(container.closest(`.${config.textTransform.normal}`)) {
              val = 'normal';
          } 
          if (val === '') {
              this.addClass(span, config.textTransform.uppercase);
          } else if (val === 'uppercase') {
              this.addClass(span, config.textTransform.lowercase);
          } else if (val === 'lowercase') {
              this.addClass(span, config.textTransform.capitalize);
          } else if (val === 'capitalize') {
              this.addClass(span, config.textTransform.normal);
          } else if (val === 'normal') {
              this.addClass(span, config.textTransform.uppercase);
          } 
      }*/
      if (action === 'textTransform') {
        var val = '';
        if (container.closest(".".concat(config.textTransform.uppercase))) {
          val = 'uppercase';
        }
        this.removeClass(span, config.textTransform.uppercase);
        this.removeClass(span, config.textTransform.lowercase);
        this.removeClass(span, config.textTransform.capitalize);
        this.removeClass(span, config.textTransform.normal);
        if (val === '') {
          this.addClass(span, config.textTransform.uppercase);
        }
      }
      if (action === 'textTransform') {
        // Do Nothing
      }
      if (action === 'extend') {
        var exist = false;
        if (container.closest(".".concat(config.extend[value]))) {
          exist = true;
        }
        if (exist) {
          // Do Nothing
        } else {
          this.addClass(span, config.extend[value]);
        }
      }
      span.appendChild(fragment);
      this.cleanChildrenToggle(action, value, span, config);
      this.cleanUnusedSpan(span); // REVIEW

      range.insertNode(span);
      selection.selectAllChildren(span);
      return span;
    }
  }, {
    key: "cleanChildrenToggle",
    value: function cleanChildrenToggle(action, value, span, config) {
      var _this18 = this;
      if (!span.hasChildNodes()) {
        return;
      }
      if (action === 'fontWeight') {
        Array.from(span.children).map(function (element) {
          _this18.removeClass(element, config.fontWeight.thin);
          _this18.removeClass(element, config.fontWeight.extralight);
          _this18.removeClass(element, config.fontWeight.light);
          _this18.removeClass(element, config.fontWeight.normal);
          _this18.removeClass(element, config.fontWeight.medium);
          _this18.removeClass(element, config.fontWeight.semibold);
          _this18.removeClass(element, config.fontWeight.bold);
          _this18.removeClass(element, config.fontWeight.extrabold);
          _this18.removeClass(element, config.fontWeight.black);
        });
      }
      if (action === 'fontStyle') {
        Array.from(span.children).map(function (element) {
          _this18.removeClass(element, config.fontStyle.italic);
          _this18.removeClass(element, config.fontStyle.normal);
        });
      }
      if (action === 'textUnderline') {
        Array.from(span.children).map(function (element) {
          _this18.removeClass(element, config.textDecoration.underline);
          _this18.removeClass(element, config.textDecoration.linethrough);
          _this18.removeClass(element, config.textDecoration.normal);
        });
      }
      if (action === 'textLinethrough') {
        Array.from(span.children).map(function (element) {
          _this18.removeClass(element, config.textDecoration.underline);
          _this18.removeClass(element, config.textDecoration.linethrough);
          _this18.removeClass(element, config.textDecoration.normal);
        });
      }
      if (action === 'textTransform') {
        Array.from(span.children).map(function (element) {
          _this18.removeClass(element, config.textTransform.uppercase);
          _this18.removeClass(element, config.textTransform.lowercase);
          _this18.removeClass(element, config.textTransform.capitalize);
          _this18.removeClass(element, config.textTransform.normal);
        });
      }
      if (action === 'clean') {
        Array.from(span.children).map(function (element) {
          element.className = '';
          element.style.cssText = '';
        });
      }
      if (action === 'extend') {
        Array.from(span.children).map(function (element) {
          _this18.removeClass(element, config.extend[value]);
        });
      }

      // Deeper childrens
      var cleanChildrenChildren = Array.from(span.children).map(function (element) {
        return _this18.cleanChildrenToggle(action, value, element, config);
      });
      if (!cleanChildrenChildren || cleanChildrenChildren.length <= 0) {
        return;
      }
    }
  }, {
    key: "getSelection",
    value: function getSelection() {
      if (this.builder.win && this.builder.win.getSelection) {
        return this.builder.win.getSelection();
      } else if (this.builder.doc && this.builder.doc.getSelection) {
        return this.builder.doc.getSelection();
      } else if (this.builder.doc && this.builder.doc.selection) {
        return this.builder.doc.selection.createRange().text;
      }
      return null;
    }
  }, {
    key: "cleanChildren",
    value: function cleanChildren(action, span) {
      var _this19 = this;
      if (!span.hasChildNodes()) {
        return;
      }

      // Direct children with same style rule
      var children = Array.from(span.children).filter(function (element) {
        return element.style[action] !== undefined && element.style[action.style] !== '';
      });
      if (children && children.length > 0) {
        children.forEach(function (element) {
          element.style[action] = '';
          if (element.getAttribute('style') === '' || element.style === null) {
            element.removeAttribute('style');
          }
        });
      }

      // Deeper childrens
      var cleanChildrenChildren = Array.from(span.children).map(function (element) {
        return _this19.cleanChildren(action, element);
      });
      if (!cleanChildrenChildren || cleanChildrenChildren.length <= 0) {
        return;
      }
    }
  }, {
    key: "addCssClass",
    value: function addCssClass(elm, className, classes) {
      this.removeCssClasses(elm, classes);
      this.addClass(elm, className);
    }
  }, {
    key: "removeCssClasses",
    value: function removeCssClasses(elm, classes) {
      for (var i = 0; i < Object.keys(classes).length; i++) {
        var item = Object.values(classes)[i];
        this.removeClass(elm, item);
      }
    }

    // Clean HTML stuff
  }, {
    key: "removeEmptyStyle",
    value: function removeEmptyStyle(area) {
      var _this20 = this;
      if (!area.hasChildNodes()) {
        return;
      }
      var children = Array.from(area.children).filter(function (element) {
        return element.getAttribute('style');
      });
      if (children && children.length > 0) {
        children.forEach(function (element) {
          if (element.getAttribute('style').trim() === '' || element.style === null) {
            element.removeAttribute('style');
          }
        });
      }

      // Deeper childrens
      var removeEmptyStyleChildren = Array.from(area.children).map(function (element) {
        return _this20.removeEmptyStyle(element);
      });
      if (!removeEmptyStyleChildren || removeEmptyStyleChildren.length <= 0) {
        return;
      }
    }

    // Font Size stuff
  }, {
    key: "cleanClassSize",
    value: function cleanClassSize(span, className) {
      var _this21 = this;
      // used in rte.js 2991
      if (!span.hasChildNodes()) {
        return;
      }

      // Direct children with same style rule
      var children = Array.from(span.children).filter(function (element) {
        return _this21.hasClass(element, className);
      });
      if (children && children.length > 0) {
        children.forEach(function (element) {
          _this21.removeClass(element, className);
        });
      }

      // Deeper childrens
      var cleanClassSizeChildren = Array.from(span.children).map(function (element) {
        return _this21.cleanClassSize(element, className);
      });
      if (!cleanClassSizeChildren || cleanClassSizeChildren.length <= 0) {
        return;
      }
    }

    // Remove Format stuff
  }, {
    key: "removeFormat",
    value: function removeFormat() {
      var selection = this.getSelection();
      if (!selection) return;
      var anchorNode = selection.anchorNode;
      if (!anchorNode) return;
      var container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
      var sameSelection = container && container.innerText === selection.toString().trim();
      if (sameSelection || selection.toString().trim() === '') {
        this.cleanElement(container);
      } else {
        this.cleanSelection(selection);
      }
    }
  }, {
    key: "cleanElement",
    value: function cleanElement(elm) {
      var _this22 = this;
      elm.style.fontWeight = '';
      elm.style.fontStyle = '';
      elm.style.textDecoration = '';
      elm.style.textTransform = '';
      elm.style.fontFamily = '';
      elm.style.fontSize = '';
      elm.style.color = '';
      elm.style.backgroundColor = '';
      elm.classList.forEach(function (item) {
        if (item.indexOf('size-') !== -1) {
          _this22.removeClass(elm, item);
        }
      });
      var elms = elm.querySelectorAll('*');
      elms.forEach(function (elm) {
        elm.style.fontWeight = '';
        elm.style.fontStyle = '';
        elm.style.textDecoration = '';
        elm.style.textTransform = '';
        elm.style.fontFamily = '';
        elm.style.fontSize = '';
        elm.style.color = '';
        elm.style.backgroundColor = '';
        elm.classList.forEach(function (item) {
          if (item.indexOf('size-') !== -1) {
            _this22.removeClass(elm, item);
          }
        });
      });
      this.cleanUnusedSpan(elm); // REVIEW (causes lost selection)
    }
  }, {
    key: "cleanSelection",
    value: function cleanSelection(selection) {
      var range = selection.getRangeAt(0);
      var fragment = range.extractContents();
      var span = document.createElement('span');
      span.appendChild(fragment);
      range.insertNode(span);
      selection.selectAllChildren(span);
      this.cleanElement(span);
    }

    /*
    cleanUnusedSpan(span) {
         if (!span.hasChildNodes()) {
            return;
        }
         // Direct children with no style
        const children = Array.from(span.children).filter((element) => {
            if (element.getAttribute('style') === '' || element.style === null) {
                element.removeAttribute('style');
            }
            let unused = ( element.attributes.length === 0 || (element.attributes.length === 1 && element.hasAttribute('data-keep')));
            return (element.nodeName.toLowerCase() === 'span' && unused);
        });
         if (children && children.length > 0) {
            children.forEach((element) => { 
                const text = document.createTextNode(element.textContent);
                element.parentElement.replaceChild(text, element);
            });
            return;
        }
         // Deeper childrens
        const cleanUnusedSpanChildren = Array.from(span.children).map((element) => {
            return this.cleanUnusedSpan(element);
        });
         if (!cleanUnusedSpanChildren || cleanUnusedSpanChildren.length <= 0) {
            return;
        }
    }
    */
  }, {
    key: "cleanUnusedSpan",
    value: function cleanUnusedSpan(area) {
      // for specific element only (during execCommand), 
      // not for the entire ContentBuilder container, 
      // because there can be custom blocks

      var spans = area.querySelectorAll('span');
      var filter = Array.prototype.filter;
      var children = filter.call(spans, function (element) {
        return element.attributes.length === 0;
      });

      // Remove empty spans
      if (children && children.length > 0) {
        children.forEach(function (element) {
          element.outerHTML = element.innerHTML;
        });
      }

      // Remove spans which have empty content
      spans = area.querySelectorAll('span');
      filter.call(spans, function (element) {
        if (element.innerHTML === '') {
          element.parentNode.removeChild(element);
        }
      });

      // Recheck
      spans = area.querySelectorAll('span');
      children = filter.call(spans, function (element) {
        return element.attributes.length === 0;
      });
      if (children && children.length > 0) {
        this.cleanUnusedSpan(area);
      } else {
        return;
      }
    }
  }, {
    key: "contentReformat",
    value: function contentReformat(area, cssClasses) {
      this.replaceTag(area, 'b', cssClasses.fontWeight.defaultBold);
      this.replaceTag(area, 'i', cssClasses.fontStyle.italic);
      this.replaceTag(area, 'u', cssClasses.textDecoration.underline);
      this.replaceTag(area, 'strike', cssClasses.textDecoration.linethrough);
      this.replaceInline(area, 'font-weight', 'normal', cssClasses.fontWeight.defaultBold);
      this.replaceInline(area, 'font-weight', 'bold', cssClasses.fontWeight.defaultBold);
      this.replaceInline(area, 'font-weight', '600', cssClasses.fontWeight.semibold);
      this.replaceInline(area, 'text-align', 'left', cssClasses.textAlign.left);
      this.replaceInline(area, 'text-align', 'right', cssClasses.textAlign.right);
      this.replaceInline(area, 'text-align', 'center', cssClasses.textAlign.center);
      this.replaceInline(area, 'text-align', 'justify', cssClasses.textAlign.justify);
      this.replaceInline(area, 'display', 'flex', cssClasses.display.flex);
      this.replaceInline(area, 'justiify-content', 'flex-start', cssClasses.justifyContent.start);
      this.replaceInline(area, 'justiify-content', 'flex-end', cssClasses.justifyContent.end);
      this.replaceInline(area, 'justiify-content', 'center', cssClasses.justifyContent.center);
      this.replaceInline(area, 'justiify-content', 'space-between', cssClasses.justifyContent.between);
      this.replaceInline(area, 'flex-direction', 'column', cssClasses.flexDirection.column);
      this.replaceInline(area, 'flex-direction', 'row', cssClasses.flexDirection.row);
      this.replaceInline(area, 'align-items', 'flex-start', cssClasses.alignItems.start);
      this.replaceInline(area, 'align-items', 'flex-end', cssClasses.alignItems.end);
      this.replaceInline(area, 'align-items', 'center', cssClasses.alignItems.center);
      this.replaceInline(area, 'text-transform', 'uppercase', cssClasses.textTransform.uppercase);
      this.replaceInline(area, 'text-transform', 'lowercase', cssClasses.textTransform.lowercase);
      this.replaceInline(area, 'text-transform', 'none', cssClasses.textTransform.normal);
      this.replaceInline(area, 'line-height', '1', cssClasses.leading.leading_10);
      this.replaceInline(area, 'line-height', '1.1', cssClasses.leading.leading_11);
      this.replaceInline(area, 'line-height', '1.2', cssClasses.leading.leading_12);
      this.replaceInline(area, 'line-height', '1.25', cssClasses.leading.leading_125);
      this.replaceInline(area, 'line-height', '1.3', cssClasses.leading.leading_13);
      this.replaceInline(area, 'line-height', '1.375', cssClasses.leading.leading_1375);
      this.replaceInline(area, 'line-height', '1.4', cssClasses.leading.leading_14);
      this.replaceInline(area, 'line-height', '1.5', cssClasses.leading.leading_15);
      this.replaceInline(area, 'line-height', '1.6', cssClasses.leading.leading_16);
      this.replaceInline(area, 'line-height', '1.625', cssClasses.leading.leading_1625);
      this.replaceInline(area, 'line-height', '1.7', cssClasses.leading.leading_17);
      this.replaceInline(area, 'line-height', '1.8', cssClasses.leading.leading_18);
      this.replaceInline(area, 'line-height', '1.9', cssClasses.leading.leading_19);
      this.replaceInline(area, 'line-height', '2', cssClasses.leading.leading_20);
      this.replaceInline(area, 'line-height', '2.1', cssClasses.leading.leading_21);
      this.replaceInline(area, 'line-height', '2.2', cssClasses.leading.leading_22);
    }
  }, {
    key: "replaceTag",
    value: function replaceTag(area, tag, className) {
      var elms = area.querySelectorAll(tag);
      var filter = Array.prototype.filter;
      var children = filter.call(elms, function (element) {
        return element.attributes.length === 0;
      });
      if (children && children.length > 0) {
        children.forEach(function (element) {
          var span = document.createElement('span');
          span.setAttribute('class', className);
          span.innerHTML = element.innerHTML;
          element.outerHTML = span.outerHTML;
        });
      }
    }
  }, {
    key: "replaceInline",
    value: function replaceInline(builder, css, value, className) {
      var _this23 = this;
      var elms = builder.querySelectorAll('*');
      elms.forEach(function (elm) {
        if (css === 'justiify-content') {
          /*
          For some reason, cannot use elm.style[css] for 'justify-content'
          */
          if (elm.style.justifyContent === "".concat(value)) {
            _this23.addClass(elm, className);
            elm.style.justifyContent = '';
          }
        } else if (elm.style[css] === "".concat(value)) {
          _this23.addClass(elm, className);
          elm.style[css] = '';
        }
      });
    }
  }, {
    key: "countOccurrences",
    value: function countOccurrences(text, word) {
      // match the word globally and case insensitively
      var regex = new RegExp(word, 'gi');
      var matches = text.match(regex);
      return matches ? matches.length : 0;
    }
  }]);
  return Dom;
}();
// EXTERNAL MODULE: ./node_modules/js-beautify/js/index.js
var js = __webpack_require__(204);
var js_default = /*#__PURE__*/__webpack_require__.n(js);
;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/_virtual/_rollupPluginBabelHelpers.js
function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread2(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function _objectWithoutProperties(source, excluded) {
  if (source == null) return {};

  var target = _objectWithoutPropertiesLoose(source, excluded);

  var key, i;

  if (Object.getOwnPropertySymbols) {
    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);

    for (i = 0; i < sourceSymbolKeys.length; i++) {
      key = sourceSymbolKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
      target[key] = source[key];
    }
  }

  return target;
}

function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
}

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

function _iterableToArrayLimit(arr, i) {
  if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return;
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;

  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];

  return arr2;
}

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}



;// CONCATENATED MODULE: ./node_modules/state-local/lib/es/state-local.js
function state_local_defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function state_local_ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function state_local_objectSpread2(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      state_local_ownKeys(Object(source), true).forEach(function (key) {
        state_local_defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      state_local_ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function compose() {
  for (var _len = arguments.length, fns = new Array(_len), _key = 0; _key < _len; _key++) {
    fns[_key] = arguments[_key];
  }

  return function (x) {
    return fns.reduceRight(function (y, f) {
      return f(y);
    }, x);
  };
}

function curry(fn) {
  return function curried() {
    var _this = this;

    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }

    return args.length >= fn.length ? fn.apply(this, args) : function () {
      for (var _len3 = arguments.length, nextArgs = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
        nextArgs[_key3] = arguments[_key3];
      }

      return curried.apply(_this, [].concat(args, nextArgs));
    };
  };
}

function isObject(value) {
  return {}.toString.call(value).includes('Object');
}

function isEmpty(obj) {
  return !Object.keys(obj).length;
}

function isFunction(value) {
  return typeof value === 'function';
}

function state_local_hasOwnProperty(object, property) {
  return Object.prototype.hasOwnProperty.call(object, property);
}

function validateChanges(initial, changes) {
  if (!isObject(changes)) errorHandler('changeType');
  if (Object.keys(changes).some(function (field) {
    return !state_local_hasOwnProperty(initial, field);
  })) errorHandler('changeField');
  return changes;
}

function validateSelector(selector) {
  if (!isFunction(selector)) errorHandler('selectorType');
}

function validateHandler(handler) {
  if (!(isFunction(handler) || isObject(handler))) errorHandler('handlerType');
  if (isObject(handler) && Object.values(handler).some(function (_handler) {
    return !isFunction(_handler);
  })) errorHandler('handlersType');
}

function validateInitial(initial) {
  if (!initial) errorHandler('initialIsRequired');
  if (!isObject(initial)) errorHandler('initialType');
  if (isEmpty(initial)) errorHandler('initialContent');
}

function throwError(errorMessages, type) {
  throw new Error(errorMessages[type] || errorMessages["default"]);
}

var errorMessages = {
  initialIsRequired: 'initial state is required',
  initialType: 'initial state should be an object',
  initialContent: 'initial state shouldn\'t be an empty object',
  handlerType: 'handler should be an object or a function',
  handlersType: 'all handlers should be a functions',
  selectorType: 'selector should be a function',
  changeType: 'provided value of changes should be an object',
  changeField: 'it seams you want to change a field in the state which is not specified in the "initial" state',
  "default": 'an unknown error accured in `state-local` package'
};
var errorHandler = curry(throwError)(errorMessages);
var validators = {
  changes: validateChanges,
  selector: validateSelector,
  handler: validateHandler,
  initial: validateInitial
};

function create(initial) {
  var handler = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  validators.initial(initial);
  validators.handler(handler);
  var state = {
    current: initial
  };
  var didUpdate = curry(didStateUpdate)(state, handler);
  var update = curry(updateState)(state);
  var validate = curry(validators.changes)(initial);
  var getChanges = curry(extractChanges)(state);

  function getState() {
    var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function (state) {
      return state;
    };
    validators.selector(selector);
    return selector(state.current);
  }

  function setState(causedChanges) {
    compose(didUpdate, update, validate, getChanges)(causedChanges);
  }

  return [getState, setState];
}

function extractChanges(state, causedChanges) {
  return isFunction(causedChanges) ? causedChanges(state.current) : causedChanges;
}

function updateState(state, changes) {
  state.current = state_local_objectSpread2(state_local_objectSpread2({}, state.current), changes);
  return changes;
}

function didStateUpdate(state, handler, changes) {
  isFunction(handler) ? handler(state.current) : Object.keys(changes).forEach(function (field) {
    var _handler$field;

    return (_handler$field = handler[field]) === null || _handler$field === void 0 ? void 0 : _handler$field.call(handler, state.current[field]);
  });
  return changes;
}

var index = {
  create: create
};

/* harmony default export */ const state_local = (index);

;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/config/index.js
var config = {
  paths: {
    vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs'
  }
};

/* harmony default export */ const es_config = (config);

;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/utils/curry.js
function curry_curry(fn) {
  return function curried() {
    var _this = this;

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return args.length >= fn.length ? fn.apply(this, args) : function () {
      for (var _len2 = arguments.length, nextArgs = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        nextArgs[_key2] = arguments[_key2];
      }

      return curried.apply(_this, [].concat(args, nextArgs));
    };
  };
}

/* harmony default export */ const utils_curry = (curry_curry);

;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/utils/isObject.js
function isObject_isObject(value) {
  return {}.toString.call(value).includes('Object');
}

/* harmony default export */ const utils_isObject = (isObject_isObject);

;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/validators/index.js



/**
 * validates the configuration object and informs about deprecation
 * @param {Object} config - the configuration object 
 * @return {Object} config - the validated configuration object
 */

function validateConfig(config) {
  if (!config) validators_errorHandler('configIsRequired');
  if (!utils_isObject(config)) validators_errorHandler('configType');

  if (config.urls) {
    informAboutDeprecation();
    return {
      paths: {
        vs: config.urls.monacoBase
      }
    };
  }

  return config;
}
/**
 * logs deprecation message
 */


function informAboutDeprecation() {
  console.warn(validators_errorMessages.deprecation);
}

function validators_throwError(errorMessages, type) {
  throw new Error(errorMessages[type] || errorMessages["default"]);
}

var validators_errorMessages = {
  configIsRequired: 'the configuration object is required',
  configType: 'the configuration object should be an object',
  "default": 'an unknown error accured in `@monaco-editor/loader` package',
  deprecation: "Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "
};
var validators_errorHandler = utils_curry(validators_throwError)(validators_errorMessages);
var validators_validators = {
  config: validateConfig
};

/* harmony default export */ const es_validators = (validators_validators);


;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/utils/compose.js
var compose_compose = function compose() {
  for (var _len = arguments.length, fns = new Array(_len), _key = 0; _key < _len; _key++) {
    fns[_key] = arguments[_key];
  }

  return function (x) {
    return fns.reduceRight(function (y, f) {
      return f(y);
    }, x);
  };
};

/* harmony default export */ const utils_compose = (compose_compose);

;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/utils/deepMerge.js


function merge(target, source) {
  Object.keys(source).forEach(function (key) {
    if (source[key] instanceof Object) {
      if (target[key]) {
        Object.assign(source[key], merge(target[key], source[key]));
      }
    }
  });
  return _objectSpread2(_objectSpread2({}, target), source);
}

/* harmony default export */ const deepMerge = (merge);

;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/utils/makeCancelable.js
// The source (has been changed) is https://github.com/facebook/react/issues/5465#issuecomment-157888325
var CANCELATION_MESSAGE = {
  type: 'cancelation',
  msg: 'operation is manually canceled'
};

function makeCancelable(promise) {
  var hasCanceled_ = false;
  var wrappedPromise = new Promise(function (resolve, reject) {
    promise.then(function (val) {
      return hasCanceled_ ? reject(CANCELATION_MESSAGE) : resolve(val);
    });
    promise["catch"](reject);
  });
  return wrappedPromise.cancel = function () {
    return hasCanceled_ = true;
  }, wrappedPromise;
}

/* harmony default export */ const utils_makeCancelable = (makeCancelable);


;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/loader/index.js








/** the local state of the module */

var _state$create = state_local.create({
  config: es_config,
  isInitialized: false,
  resolve: null,
  reject: null,
  monaco: null
}),
    _state$create2 = _slicedToArray(_state$create, 2),
    getState = _state$create2[0],
    setState = _state$create2[1];
/**
 * set the loader configuration
 * @param {Object} config - the configuration object
 */


function loader_config(globalConfig) {
  var _validators$config = es_validators.config(globalConfig),
      monaco = _validators$config.monaco,
      config = _objectWithoutProperties(_validators$config, ["monaco"]);

  setState(function (state) {
    return {
      config: deepMerge(state.config, config),
      monaco: monaco
    };
  });
}
/**
 * handles the initialization of the monaco-editor
 * @return {Promise} - returns an instance of monaco (with a cancelable promise)
 */


function init() {
  var state = getState(function (_ref) {
    var monaco = _ref.monaco,
        isInitialized = _ref.isInitialized,
        resolve = _ref.resolve;
    return {
      monaco: monaco,
      isInitialized: isInitialized,
      resolve: resolve
    };
  });

  if (!state.isInitialized) {
    setState({
      isInitialized: true
    });

    if (state.monaco) {
      state.resolve(state.monaco);
      return utils_makeCancelable(wrapperPromise);
    }

    if (window.monaco && window.monaco.editor) {
      storeMonacoInstance(window.monaco);
      state.resolve(window.monaco);
      return utils_makeCancelable(wrapperPromise);
    }

    utils_compose(injectScripts, getMonacoLoaderScript)(configureLoader);
  }

  return utils_makeCancelable(wrapperPromise);
}
/**
 * injects provided scripts into the document.body
 * @param {Object} script - an HTML script element
 * @return {Object} - the injected HTML script element
 */


function injectScripts(script) {
  return document.body.appendChild(script);
}
/**
 * creates an HTML script element with/without provided src
 * @param {string} [src] - the source path of the script
 * @return {Object} - the created HTML script element
 */


function createScript(src) {
  var script = document.createElement('script');
  return src && (script.src = src), script;
}
/**
 * creates an HTML script element with the monaco loader src
 * @return {Object} - the created HTML script element
 */


function getMonacoLoaderScript(configureLoader) {
  var state = getState(function (_ref2) {
    var config = _ref2.config,
        reject = _ref2.reject;
    return {
      config: config,
      reject: reject
    };
  });
  var loaderScript = createScript("".concat(state.config.paths.vs, "/loader.js"));

  loaderScript.onload = function () {
    return configureLoader();
  };

  loaderScript.onerror = state.reject;
  return loaderScript;
}
/**
 * configures the monaco loader
 */


function configureLoader() {
  var state = getState(function (_ref3) {
    var config = _ref3.config,
        resolve = _ref3.resolve,
        reject = _ref3.reject;
    return {
      config: config,
      resolve: resolve,
      reject: reject
    };
  });
  var require = window.require;

  require.config(state.config);

  require(['vs/editor/editor.main'], function (monaco) {
    storeMonacoInstance(monaco);
    state.resolve(monaco);
  }, function (error) {
    state.reject(error);
  });
}
/**
 * store monaco instance in local state
 */


function storeMonacoInstance(monaco) {
  if (!getState().monaco) {
    setState({
      monaco: monaco
    });
  }
}
/**
 * internal helper function
 * extracts stored monaco instance
 * @return {Object|null} - the monaco instance
 */


function __getMonacoInstance() {
  return getState(function (_ref4) {
    var monaco = _ref4.monaco;
    return monaco;
  });
}

var wrapperPromise = new Promise(function (resolve, reject) {
  return setState({
    resolve: resolve,
    reject: reject
  });
});
var loader = {
  config: loader_config,
  init: init,
  __getMonacoInstance: __getMonacoInstance
};

/* harmony default export */ const es_loader = (loader);

;// CONCATENATED MODULE: ./node_modules/@monaco-editor/loader/lib/es/index.js



;// CONCATENATED MODULE: ./src/contentbuilder/html.js
function html_typeof(obj) { "@babel/helpers - typeof"; return html_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, html_typeof(obj); }
function html_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function html_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, html_toPropertyKey(descriptor.key), descriptor); } }
function html_createClass(Constructor, protoProps, staticProps) { if (protoProps) html_defineProperties(Constructor.prototype, protoProps); if (staticProps) html_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function html_toPropertyKey(arg) { var key = html_toPrimitive(arg, "string"); return html_typeof(key) === "symbol" ? key : String(key); }
function html_toPrimitive(input, hint) { if (html_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (html_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var hash = {};
var HtmlUtil = /*#__PURE__*/function () {
  function HtmlUtil(builder) {
    html_classCallCheck(this, HtmlUtil);
    this.builder = builder;
  }
  html_createClass(HtmlUtil, [{
    key: "renderPanel",
    value: function renderPanel() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var viewhtml = builderStuff.querySelector('.viewhtml');
      if (!viewhtml) {
        /*
        Note:
        - viewhtml => non syntax-highlighted. 
        - viewhtmlmonaco => syntax-highlighted.
         - viewhtmlexternal => external use.
        */
        var html = "<div class=\"is-modal viewhtml\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <textarea class=\"tabSupport\" id=\"__tabsupport\" style=\"width:100%;height:calc(100% - 50px);border:none;margin:0;box-sizing:border-box;\"></textarea>\n                    <div class=\"is-modal-footer\" style=\"border-top:1px solid ".concat(this.builder.styleSeparatorColor, ";width:100%;height:50px;position:absolute;left:0;bottom:0;overflow:hidden;text-align:right\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"is-modal viewhtmlmonaco\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"width:").concat(this.builder.blockCodeEditorWidth, ";max-width:").concat(this.builder.blockCodeEditorMaxWidth, ";padding:0\">\n                    <textarea id=\"__viewhtmlmonaco\" style=\"position:absolute;display:none;\"></textarea>\n                    <div class=\"input-code-editor\" style=\"width:100%;height:").concat(this.builder.blockCodeEditorHeight, ";\"></div>\n                    <div class=\"is-modal-footer\" style=\"display:flex;justify-content:flex-end;border-top:1px solid ").concat(this.builder.styleSeparatorColor, ";\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"is-modal viewhtmlexternal\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"width:").concat(this.builder.codeEditorWidth, ";max-width:").concat(this.builder.codeEditorMaxWidth, ";padding:0\">\n                    <div class=\"input-code-editor\" id=\"__input_code_editor\" style=\"width:100%;height:").concat(this.builder.codeEditorHeight, ";\"></div>\n                    <div class=\"is-modal-footer\" style=\"display:flex;justify-content:flex-end;border-top:1px solid ").concat(this.builder.styleSeparatorColor, ";\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n            \n            ");
        dom.appendHtml(builderStuff, html);
        viewhtml = builderStuff.querySelector('.viewhtml');
        var viewhtmlmonaco = builderStuff.querySelector('.viewhtmlmonaco');
        var viewhtmlexternal = builderStuff.querySelector('.viewhtmlexternal');
        var elm = viewhtml.querySelector('.input-ok');
        dom.addEventListener(elm, 'click', function () {
          _this.applyHtml(viewhtml);
        });
        elm = viewhtml.querySelector('.input-cancel');
        dom.addEventListener(elm, 'click', function () {
          _this.builder.hideModal(viewhtml);
        });
        elm = viewhtmlmonaco.querySelector('.input-ok');
        dom.addEventListener(elm, 'click', function () {
          _this.applyHtml(viewhtmlmonaco);
        });
        elm = viewhtmlmonaco.querySelector('.input-cancel');
        dom.addEventListener(elm, 'click', function () {
          _this.builder.hideModal(viewhtmlmonaco);
        });
        elm = viewhtmlexternal.querySelector('.input-ok');
        dom.addEventListener(elm, 'click', function () {
          var source = document.querySelector('textarea[data-source-active]');
          var selectorOk = source.getAttribute('data-source-ok');
          source.removeAttribute('data-source-active');
          source.removeAttribute('data-source-ok');
          source.removeAttribute('data-source-cancel');
          document.querySelector(selectorOk).click();
          _this.builder.hideModal(viewhtmlexternal);
        });
        elm = viewhtmlexternal.querySelector('.input-cancel');
        dom.addEventListener(elm, 'click', function () {
          var source = document.querySelector('textarea[data-source-active]');
          var selectorCancel = source.getAttribute('data-source-cancel');
          source.removeAttribute('data-source-active');
          source.removeAttribute('data-source-ok');
          source.removeAttribute('data-source-cancel');
          document.querySelector(selectorCancel).click();
          _this.builder.hideModal(viewhtmlexternal);
        });
      }
    }
  }, {
    key: "applyHtml",
    value: function applyHtml(modal) {
      var util = this.builder.util;
      var mode = this.builder.codeEditorMode;
      var area = this.builder.codeEditorArea;
      this.builder.uo.saveForUndo();
      var textarea = modal.querySelector('textarea');
      var html = textarea.value;
      if (mode === 'code') {
        var codeblock = this.builder.activeCodeBlock;

        //this.builder.renderCustomCodeBlock($block, html);
        codeblock.setAttribute('data-html', encodeURIComponent(html)); // => important
        html = html.replace(/{id}/g, util.makeId());
        for (var i = 1; i <= 20; i++) {
          html = html.replace('[%HTML' + i + '%]', codeblock.getAttribute('data-html-' + i) === undefined ? '' : decodeURIComponent(codeblock.getAttribute('data-html-' + i))); //render editable area
        }

        //codeblock.innerHTML = html;
        codeblock.innerHTML = '';
        // Use createContextualFragment() to make embedded script executable
        // https://ghinda.net/article/script-tags/
        var range = document.createRange();
        range.setStart(codeblock, 0);
        codeblock.appendChild(range.createContextualFragment(html));
        var builderActive = this.builder.doc.querySelector('.builder-active');
        if (builderActive) this.builder.applyBehaviorOn(builderActive);

        //Trigger Change event
        this.builder.opts.onChange();

        //Trigger Render event
        this.builder.opts.onRender();
        this.builder.hideModal(modal);
        util.hideControls();
        return;
      }
      html = this.fromViewToActual(html);
      if (mode === 'cell') {
        var cell = util.cellSelected();
        cell.innerHTML = html;
        var _builderActive = this.builder.doc.querySelector('.builder-active');
        if (_builderActive) this.builder.applyBehaviorOn(_builderActive);

        //Trigger Change event
        this.builder.opts.onChange();

        //Trigger Render event
        this.builder.opts.onRender();
      }
      if (mode === 'row') {
        var row;
        var _cell = util.cellSelected();
        if (_cell) {
          row = _cell.parentNode;
        } else {
          row = util.rowSelected();
        }
        if (!row) return;
        row.innerHTML = html;
        var _builderActive2 = this.builder.doc.querySelector('.builder-active');
        if (_builderActive2) this.builder.applyBehaviorOn(_builderActive2);

        //Trigger Change event
        this.builder.opts.onChange();

        //Trigger Render event
        this.builder.opts.onRender();
      }
      if (mode === 'full') {
        // freeform
        if (this.builder.docContainer) {
          this.builder.loadHTML(html);
          util.clearControls();
          this.builder.hideModal(modal);
          return;
        }

        // area.innerHTML = html;
        area.innerHTML = '';
        // Use createContextualFragment() to make embedded script executable
        // https://ghinda.net/article/script-tags/
        var _range = document.createRange();
        _range.setStart(area, 0);
        area.appendChild(_range.createContextualFragment(html));

        // let builderActive = this.builder.doc.querySelector('.builder-active');
        // if(builderActive) this.builder.applyBehaviorOn(builderActive);
        this.builder.applyBehaviorOn(area);
        /*else {
             const builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
            if(builders.length > 1) {
                const cell = util.cellSelected();
                if(!cell) {
                    // Return first instance
                    area = builders[0];
                } else {
                    // Return active instance
                    area = cell.parentNode.parentNode;
                }
            } else {
                // Single instance
                area = builders[0];
            }
            this.builder.applyBehaviorOn(area);
         }*/

        //Trigger Change event
        this.builder.opts.onChange();

        //Trigger Render event
        this.builder.opts.onRender();
        util.clearActiveCell();
      }
      util.clearControls(); // NEW

      this.builder.hideModal(modal);
    }
  }, {
    key: "viewHtmlExternal",
    value: function viewHtmlExternal() {
      var _this2 = this;
      var util = this.builder.util;
      var builderStuff = this.builder.builderStuff;
      this.renderPanel();
      var viewhtmlexternal = builderStuff.querySelector('.viewhtmlexternal');
      if (document.activeElement) this.elmFocus = document.activeElement;
      util.showModal(viewhtmlexternal, true, function () {
        if (_this2.elmFocus) _this2.elmFocus.focus();
      }, false);
      var codeEditor = viewhtmlexternal.querySelector('.input-code-editor');
      codeEditor.style.opacity = 0.01;
      this._viewHtmlExternal();
    }
  }, {
    key: "_viewHtmlExternal",
    value: function _viewHtmlExternal() {
      var _this3 = this;
      var builderStuff = this.builder.builderStuff;
      var source = document.querySelector('textarea[data-source-active]');
      var viewhtmlexternal = builderStuff.querySelector('.viewhtmlexternal');
      var codeEditor = viewhtmlexternal.querySelector('.input-code-editor');
      if (!codeEditor.querySelector('.monaco-editor')) {
        // First time code editor load

        es_loader.init().then(function (monaco) {
          _this3.builder.monaco = monaco;
          if (!codeEditor.getAttribute('data-mode-id')) _this3.builder.codeEditorExternal = monaco.editor.create(codeEditor, {
            value: '',
            minimap: {
              enabled: false
            },
            automaticLayout: true,
            contextmenu: false,
            fontSize: 13,
            wordWrap: true,
            scrollbar: {
              useShadows: false,
              vertical: 'visible',
              horizontal: 'visible',
              horizontalScrollbarSize: 12,
              verticalScrollbarSize: 12
            },
            language: 'html',
            theme: _this3.builder.styleDark || _this3.builder.styleColoredDark ? 'vs-dark' : ''
          });
          _this3.builder.codeEditorExternal.onDidChangeModelContent(function () {
            // this.builder.codeEditorExternal.onKeyUp(()=>{
            var source = document.querySelector('textarea[data-source-active]');
            source.value = _this3.builder.codeEditorExternal.getModel().getValue();
          });
        });
        setTimeout(function () {
          _this3._viewHtmlExternal();
        }, 100);
        return;
      }

      // code editor
      var model = this.builder.monaco.editor.createModel(source.value, 'html');
      this.builder.codeEditorExternal.setModel(model);
      codeEditor.style.opacity = '';
    }
  }, {
    key: "view",
    value: function view(mode, area, btn) {
      this.renderPanel();
      var util = this.builder.util;
      var builderStuff = this.builder.builderStuff;
      var viewhtml;
      if (this.builder.opts.htmlSyntaxHighlighting) {
        viewhtml = builderStuff.querySelector('.viewhtmlmonaco');
      } else {
        viewhtml = builderStuff.querySelector('.viewhtml');
      }
      var modelContent = viewhtml.querySelector('.is-modal-content');
      var codeEditor = viewhtml.querySelector('.input-code-editor');
      codeEditor.style.opacity = 0.01;
      if (mode === 'full') {
        modelContent.style.width = this.builder.codeEditorWidth;
        modelContent.style.maxWidth = this.builder.codeEditorMaxWidth;
        codeEditor.style.height = this.builder.codeEditorHeight;
      } else {
        modelContent.style.width = this.builder.blockCodeEditorWidth;
        modelContent.style.maxWidth = this.builder.blockCodeEditorMaxWidth;
        codeEditor.style.height = this.builder.blockCodeEditorHeight;
      }
      util.showModal(viewhtml, true, function () {
        if (btn) {
          btn.removeAttribute('data-focus');
          btn.focus();
        }
      });
      if (btn) btn.setAttribute('data-focus', true);
      this._view(mode, area);
    }
  }, {
    key: "_view",
    value: function _view(mode, area) {
      var _this4 = this;
      var dom = this.builder.dom;
      var util = this.builder.util;
      var builderStuff = this.builder.builderStuff;
      var viewhtml;
      if (this.builder.opts.htmlSyntaxHighlighting) {
        viewhtml = builderStuff.querySelector('.viewhtmlmonaco');
        var _codeEditor = viewhtml.querySelector('.input-code-editor');
        if (!_codeEditor.querySelector('.monaco-editor')) {
          // First time code editor load

          es_loader.init().then(function (monaco) {
            _this4.builder.monaco = monaco;
            if (!_codeEditor.getAttribute('data-mode-id')) _this4.builder.codeEditor = monaco.editor.create(_codeEditor, {
              value: '',
              minimap: {
                enabled: false
              },
              automaticLayout: true,
              contextmenu: false,
              fontSize: 13,
              wordWrap: true,
              scrollbar: {
                useShadows: false,
                vertical: 'visible',
                horizontal: 'visible',
                horizontalScrollbarSize: 12,
                verticalScrollbarSize: 12
              },
              language: 'html',
              theme: _this4.builder.styleDark || _this4.builder.styleColoredDark ? 'vs-dark' : ''
            });
            var textarea = viewhtml.querySelector('textarea');
            _this4.builder.codeEditor.onDidChangeModelContent(function () {
              // this.builder.codeEditor.onKeyUp(()=>{
              textarea.value = _this4.builder.codeEditor.getModel().getValue();
            });
          });
          setTimeout(function () {
            _this4._view(mode, area);
          }, 100);
          return;
        }
      } else {
        viewhtml = builderStuff.querySelector('.viewhtml');
      }
      var textarea = viewhtml.querySelector('textarea');

      // util.showModal(viewhtml, true);

      if (mode === 'code') {

        // Do Nothing

        // textarea already set in elementcode.js
      }
      if (mode === 'cell') {
        // old: 3550

        var cell = util.cellSelected();
        if (!cell) return;
        var _textarea = viewhtml.querySelector('textarea');
        this.builder.cleanHtmlFormatting = true;
        _textarea.value = this.readHtml(cell, true); // for view=true
        this.builder.cleanHtmlFormatting = false;
      }
      if (mode === 'row') {
        // old: 15534

        // const cell = util.cellSelected();
        // if(!cell) return;
        // const row = cell.parentNode;
        var row;
        var _cell2 = util.cellSelected();
        if (_cell2) {
          row = _cell2.parentNode;
        } else {
          row = util.rowSelected();
        }
        if (!row) return;
        var _textarea2 = viewhtml.querySelector('textarea');
        this.builder.cleanHtmlFormatting = true;
        _textarea2.value = this.readHtml(row, true); // for view=true
        this.builder.cleanHtmlFormatting = false;

        //Change to row selection
        dom.removeClass(row, 'row-outline');
      }
      if (mode === 'full') {
        // 

        if (area) {
          //return area
        } else {
          var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
          if (builders.length > 1) {
            var _cell3 = util.cellSelected();
            if (!_cell3) {
              // Return first instance
              area = builders[0];
            } else {
              // Return active instance
              area = _cell3.parentNode.parentNode;
            }
          } else {
            // Single instance
            area = builders[0];
          }
          if (this.builder.opts.page !== '') {
            var wrapper = this.builder.doc.querySelector(this.builder.opts.page);
            if (wrapper) {
              //return wrapper
              area = wrapper;
            }
          }
        }
        var _textarea3 = viewhtml.querySelector('textarea');
        this.builder.cleanHtmlFormatting = true;

        // textarea.value = this.readHtml(area, true); // for view=true
        if (this.builder.shortenHTML) {
          _textarea3.value = this.readHtml(area, true); // for view=true
        } else {
          _textarea3.value = this.readHtml(area, false); // actual
        }

        this.builder.cleanHtmlFormatting = false;
      }
      if (this.builder.opts.htmlSyntaxHighlighting) {
        // code editor
        var model = this.builder.monaco.editor.createModel(textarea.value, 'html');
        this.builder.codeEditor.setModel(model);
      }

      //Hide popup
      var columnMore = builderStuff.querySelector('.is-pop.columnmore');
      if (columnMore) columnMore.style.display = '';
      var rowMore = builderStuff.querySelector('.is-pop.rowmore');
      if (rowMore) rowMore.style.display = '';
      this.builder.codeEditorMode = mode;
      this.builder.codeEditorArea = area;
      var codeEditor = viewhtml.querySelector('.input-code-editor');
      codeEditor.style.opacity = '';
    }
  }, {
    key: "fromViewToActual",
    value: function fromViewToActual(html) {
      for (var key in hash) {
        html = html.replace(key, hash[key]);
      }
      return html;
    }
  }, {
    key: "readHtml",
    value: function readHtml(content, view, multiple, excludeCustomBlock) {
      //view = true (hide internal attributes). view = false (actual html)

      var dom = this.builder.dom;

      //Make absolute
      if (this.builder.opts.absolutePath) {
        var _links = content.querySelectorAll('a');
        Array.prototype.forEach.call(_links, function (link) {
          var href = link.href;
          link.setAttribute('href', href);
        });
        var imgs = content.querySelectorAll('img');
        Array.prototype.forEach.call(imgs, function (img) {
          var src = img.src;
          img.setAttribute('src', src);
        });
      }
      if (this.builder.cleanHtmlFormatting) {// this cleanHtmlFormatting flag only use for output, not during editing 

        /*
        if(this.builder.useCssClasses) {
             // Clean all uneeded normal classes
            let elmNormals = content.querySelectorAll(`.${this.builder.cssClasses.fontWeight.defaultNormal}`);
            // Array.prototype.forEach.call(elmNormals, (elm) => {
            //     let decor = false;
            //     if(elm.closest(`.${this.builder.cssClasses.fontWeight.defaultBold}`)) {
            //         decor = true;
            //     } 
            //     if(!decor) {
            //         dom.removeClass(elm, this.builder.cssClasses.fontWeight.defaultNormal);
            //     }
            // });
                 // elmNormals = content.querySelectorAll(`.${this.builder.cssClasses.fontStyle.normal}`);
            // Array.prototype.forEach.call(elmNormals, (elm) => {
            //     let decor = false;
            //     if(elm.closest(`.${this.builder.cssClasses.fontStyle.italic}`)) {
            //         decor = true;
            //     } 
            //     if(!decor) {
            //         dom.removeClass(elm, this.builder.cssClasses.fontStyle.normal);
            //     }
            // });
                 // elmNormals = content.querySelectorAll(`.${this.builder.cssClasses.textDecoration.normal}`);
            // Array.prototype.forEach.call(elmNormals, (elm) => {
            //     let decor = false;
            //     if(elm.closest('a')) return;
            //     if(elm.closest(`.${this.builder.cssClasses.textDecoration.underline},.${this.builder.cssClasses.textDecoration.linethrough}`)) {
            //         decor = true;
            //     } 
            //     if(!decor) {
            //         dom.removeClass(elm, this.builder.cssClasses.textDecoration.normal);
            //     }
            // });
                 // elmNormals = content.querySelectorAll(`.${this.builder.cssClasses.textTransform.normal}`);
            // Array.prototype.forEach.call(elmNormals, (elm) => {
            //     let decor = false;
            //     if(elm.closest(`.${this.builder.cssClasses.textTransform.uppercase},.${this.builder.cssClasses.textTransform.lowercase},.${this.builder.cssClasses.textTransform.capitalize}`)) {
            //         decor = true;
            //     } 
            //     if(!decor) {
            //         dom.removeClass(elm, this.builder.cssClasses.textTransform.normal);
            //     }
            // });
                 // elmNormals = content.querySelectorAll(`.${this.builder.cssClasses.extend.unset}`);
            // Array.prototype.forEach.call(elmNormals, (elm) => {
            //     dom.removeClass(elm, this.builder.cssClasses.extend.unset);
            // });
        }
        */

        // Clean unused spans
        // dom.cleanUnusedSpan(content); // REVIEW 
      }
      var util = this.builder.util;
      // const builderStuff = this.builder.builderStuff;

      // //Prepare temporary helpers: #tmp_content & #tmp_buildercontent
      // let elm = builderStuff.querySelector('#tmp_content');
      // if(elm) builderStuff.removeChild(elm);
      // elm = builderStuff.querySelector('#tmp_buildercontent');
      // if(elm) builderStuff.removeChild(elm);
      // let html = `<div id="tmp_content" style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden;visibility:hidden;"></div>
      //     <div id="tmp_buildercontent" style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden;visibility:hidden;"></div>`;
      // dom.appendHtml(builderStuff, html);
      var html;
      // let tmp = builderStuff.querySelector('#tmp_content');
      var tmp = document.createElement('div');
      tmp.innerHTML = content.innerHTML;

      //Find subblocks (previously is-builder) in custom code blocks and save them to data-html-1, data-html-2, and so on.
      var blocks = tmp.querySelectorAll('[data-html]');
      Array.prototype.forEach.call(blocks, function (block) {
        // NEW
        var index = 1;
        var subblocks = block.querySelectorAll('[data-subblock]');
        Array.prototype.forEach.call(subblocks, function (subblock) {
          if (subblock.closest('.glide__slide--clone')) return;
          var html = subblock.innerHTML;
          block.setAttribute('data-html-' + index, encodeURIComponent(html));
          index++;
        });
      });

      //Render custom code blocks (including any editable areas within)
      blocks = tmp.querySelectorAll('[data-html]');
      Array.prototype.forEach.call(blocks, function (block) {
        var blockhtml = decodeURIComponent(block.getAttribute('data-html'));
        blockhtml = blockhtml.replace(/{id}/g, util.makeId());

        /* OLD
        for(var i=1;i<=20;i++){ 
            blockhtml = blockhtml.replace('[%HTML'+i+'%]', (block.getAttribute('data-html-'+i) === undefined ? '' : decodeURIComponent(block.getAttribute('data-html-'+i))));//render editable area
        }
        block.innerHTML = blockhtml; //embedded script is not (and should not) executed here
        */

        // NEW
        block.innerHTML = blockhtml; //embedded script is not (and should not) executed here  
        var subblocks = block.querySelectorAll('[data-subblock]');
        var i = 1;
        Array.prototype.forEach.call(subblocks, function (subblock) {
          subblock.innerHTML = block.getAttribute('data-html-' + i) === undefined ? '' : decodeURIComponent(block.getAttribute('data-html-' + i));
          i++;
        });
      });

      //For Viewing, hide data-html, data-html-1.., data-settings
      if (view) {
        hash = {};
        blocks = tmp.querySelectorAll('[data-html]');
        Array.prototype.forEach.call(blocks, function (block) {
          var uniqueID = util.makeId();
          hash[uniqueID] = block.getAttribute('data-html');
          block.setAttribute('data-html', uniqueID);
          for (var i = 1; i <= 20; i++) {
            if (block.getAttribute('data-html-' + i) !== undefined) {
              uniqueID = util.makeId();
              hash[uniqueID] = block.getAttribute('data-html-' + i);
              block.getAttribute('data-html-' + i, uniqueID);
            }
          }
          if (block.getAttribute('data-settings') !== undefined) {
            uniqueID = util.makeId();
            hash[uniqueID] = block.getAttribute('data-settings');
            block.getAttribute('data-settings', uniqueID);
          }
        });
      } else {
        //console.log('for view: false')
      }

      //Make absolute (for Export/Download)
      if (this.builder.makeAbsolute) {
        var convertMediaUrl = function convertMediaUrl(imgUrl) {
          // make absolute
          var img = document.createElement('img');
          img.src = imgUrl;
          img.setAttribute('data-absoluteurl', img.src);
          imgUrl = img.getAttribute('data-absoluteurl');
          return imgUrl;
        };
        var convertBgUrl = function convertBgUrl(imgUrl) {
          // make absolute
          var img = document.createElement('img');
          img.src = imgUrl;
          img.setAttribute('data-absoluteurl', img.src);
          imgUrl = img.getAttribute('data-absoluteurl');

          // Do not use imgUrl directly, change base to [%PATH%] instead 
          // (to prevent auto converting back to relative path)

          var urlBase = window.location.href.substring(0, window.location.href.lastIndexOf('/'));
          return imgUrl.replace(urlBase, '[%PATH%]');

          // Example:
          // url = http://localhost:8080/uploads/image.jpg 
          // urlBase = http://localhost:8080
          // become: [%PATH%]/uploads/image.jpg 
        };

        var convertMedia = function convertMedia(elm, attrName) {
          if (elm.hasAttribute(attrName)) {
            if (!(elm.parentNode.tagName.toLowerCase() === 'video' || elm.parentNode.tagName.toLowerCase() === 'audio')) return;
            var imgUrl = elm.getAttribute(attrName);
            imgUrl = convertMediaUrl(imgUrl);
            elm.setAttribute(attrName, "".concat(imgUrl));
          }
        };
        var _imgs = tmp.querySelectorAll('img');
        Array.prototype.forEach.call(_imgs, function (img) {
          var src = img.src;
          img.setAttribute('src', src);
        });
        var _elms = tmp.querySelectorAll('*');
        _elms.forEach(function (elm) {
          if (elm.style.backgroundImage) {
            var s = elm.style.backgroundImage;
            if (s.indexOf('url(') !== -1) {
              var imgUrl = s.slice(4, -1).replace(/["']/g, '');
              imgUrl = convertBgUrl(imgUrl);
              elm.style.backgroundImage = "url(".concat(imgUrl, ")");
            }
          }
          convertMedia(elm, 'src');
          convertMedia(elm, 'data-default');
          convertMedia(elm, 'data-240');
          convertMedia(elm, 'data-360');
          convertMedia(elm, 'data-480');
          convertMedia(elm, 'data-540');
          convertMedia(elm, 'data-720');
          convertMedia(elm, 'data-1080');
          convertMedia(elm, 'data-1440');
          convertMedia(elm, 'data-2160');
          if (elm.hasAttribute('href')) {
            if (elm.tagName.toLowerCase() === 'link') {
              var _imgUrl = elm.getAttribute('href');
              _imgUrl = convertMediaUrl(_imgUrl);
              elm.setAttribute('href', "".concat(_imgUrl));
            }
          }
        });
      }

      //Cleaning
      var _builders = tmp.querySelectorAll('.is-builder');
      Array.prototype.forEach.call(_builders, function (_builder) {
        _builder.style.transform = '';
        _builder.style.WebkitTransform = '';
        _builder.style.MozTransform = '';
        _builder.removeAttribute('data-sort');
        dom.removeClass(_builder, 'builder-active');
        var rows = dom.elementChildren(_builder);
        rows.forEach(function (row) {
          var cols = dom.elementChildren(row);
          cols.forEach(function (col) {
            col.style.cursor = '';
          });
        });
      });

      // cleanup cursor from drag to resize columns
      var rows = dom.elementChildren(tmp);
      rows.forEach(function (row) {
        row.style.cursor = ''; //if tmp is row html, then this is a column
        var cols = dom.elementChildren(row);
        cols.forEach(function (col) {
          col.style.cursor = '';
        });
      });
      var elms;
      elms = tmp.querySelectorAll('.sortable-chosen, .sortable-ghost, .elm-active, .icon-active, .elm-inspected, .cell-active, .row-active, .row-outline, .is-builder');
      elms.forEach(function (elm) {
        elm.classList.remove('sortable-chosen');
        elm.classList.remove('sortable-ghost');
        elm.classList.remove('elm-active');
        elm.classList.remove('icon-active');
        elm.classList.remove('elm-inspected');
        elm.classList.remove('cell-active');
        elm.classList.remove('row-active');
        elm.classList.remove('row-outline');
        elm.classList.remove('is-builder');
      });
      elms = tmp.querySelectorAll('[data-click], [contenteditable], [draggridoutline], [between-blocks-left], [between-blocks-center], [hideelementhighlight], [data-module-active], [draggable]');
      elms.forEach(function (elm) {
        elm.removeAttribute('data-click');
        elm.removeAttribute('contenteditable');
        elm.removeAttribute('draggridoutline');
        elm.removeAttribute('between-blocks-left');
        elm.removeAttribute('between-blocks-center');
        elm.removeAttribute('hideelementhighlight');
        elm.removeAttribute('data-module-active');
        elm.removeAttribute('draggable');
      });
      elms = tmp.querySelectorAll('[data-animated], [data-saveforundo], [hidesnippetaddtool], [gray], [rowoutline], [hidecolumntool], [grayoutline], [hideoutline]');
      elms.forEach(function (elm) {
        elm.removeAttribute('data-animated');
        elm.removeAttribute('data-saveforundo');
        elm.removeAttribute('hidesnippetaddtool');
        elm.removeAttribute('gray');
        elm.removeAttribute('rowoutline');
        elm.removeAttribute('hidecolumntool');
        elm.removeAttribute('grayoutline');
        elm.removeAttribute('hideoutline');
      });
      elms = tmp.querySelectorAll('[leftrowtool], [minimal], [clean], [grideditor], [gridoutline]');
      elms.forEach(function (elm) {
        elm.removeAttribute('leftrowtool');
        elm.removeAttribute('minimal');
        elm.removeAttribute('clean');
        elm.removeAttribute('grideditor');
        elm.removeAttribute('gridoutline');
      });
      elms = tmp.querySelectorAll('.is-row-tool,.is-col-tool,.is-rowadd-tool,.is-canvas-tool,.is-canvasadd-tool');
      elms.forEach(function (elm) {
        if (elm.previousSibling && elm.previousSibling.nodeType === Node.TEXT_NODE) {
          elm.previousSibling.remove();
        }
        if (elm.nextSibling && elm.nextSibling.nodeType === Node.TEXT_NODE) {
          elm.nextSibling.remove();
        }
        elm.remove();
      });
      elms = tmp.querySelectorAll('.ovl,.row-add-initial');
      elms.forEach(function (elm) {
        elm.remove();
      });

      //Extra cleaning
      if (this.builder.cleanAOS) {
        elms = tmp.querySelectorAll('.aos-init, .aos-animate');
        elms.forEach(function (elm) {
          elm.classList.remove('aos-init');
          elm.classList.remove('aos-animate');
        });
      }
      elms = tmp.querySelectorAll('.skrollable, .skrollable-after, .skrollable-before, .skrollable-between, .is-inview');
      elms.forEach(function (elm) {
        elm.classList.remove('skrollable');
        elm.classList.remove('skrollable-after');
        elm.classList.remove('skrollable-before');
        elm.classList.remove('skrollable-between');
        elm.classList.remove('is-inview');
      });
      var emptyclasses = tmp.querySelectorAll('[class=""]');
      emptyclasses.forEach(function (emptyclass) {
        emptyclass.removeAttribute('class');
      });
      var unusedOverlays = tmp.querySelectorAll('.is-row-overlay');
      unusedOverlays.forEach(function (unusedOverlay) {
        if (!unusedOverlay.hasAttribute('style')) unusedOverlay.parentNode.removeChild(unusedOverlay);
      });
      dom.removeEmptyStyle(tmp);
      elms = tmp.querySelectorAll('[data-keep]');
      dom.removeAttributes(elms, 'data-keep');

      //Backward compatible: cleanup button <span contenteditable="false"><a contenteditable="true">button</a></span>
      var links = tmp.querySelectorAll('a');
      links.forEach(function (link) {
        if (link.style.display === 'inline-block') {
          if (link.parentNode.childElementCount === 1 && link.parentNode.tagName.toLowerCase() === 'span') {
            link.parentNode.outerHTML = link.parentNode.innerHTML;
          }
        }
      });
      if (excludeCustomBlock) {
        var elmCustomBlocks = tmp.querySelectorAll('[data-html]');
        elmCustomBlocks.forEach(function (elm) {
          elm.innerHTML = '';
        });
      }
      html = '';
      if (multiple) {
        //ContentBox

        // Remove dummy DIV after last section
        elms = tmp.querySelectorAll('.is-dummy');
        elms.forEach(function (elm) {
          elm.remove();
        });
        elms = tmp.querySelectorAll('[data-scroll], [data-scroll-once]');
        elms.forEach(function (elm) {
          elm.removeAttribute('data-scroll');
          elm.removeAttribute('data-scroll-once');
        });
        if (this.builder.shortenOutput) {
          elms = tmp.querySelectorAll('[data-noedit], [data-module], [data-module-desc], [data-dialog-width], [data-dialog-height], [data-html], [data-settings]');
          elms.forEach(function (elm) {
            elm.removeAttribute('data-noedit');
            elm.removeAttribute('data-module');
            elm.removeAttribute('data-module-desc');
            elm.removeAttribute('data-dialog-width');
            elm.removeAttribute('data-dialog-height');
            elm.removeAttribute('data-html');
            elm.removeAttribute('data-settings');
          });
          elms = tmp.querySelectorAll('[data-html-1], [data-html-2], [data-html-3], [data-html-4], [data-html-5], [data-html-6], [data-html-7], [data-html-8], [data-html-9], [data-html-10]');
          elms.forEach(function (elm) {
            elm.removeAttribute('data-html-1');
            elm.removeAttribute('data-html-2');
            elm.removeAttribute('data-html-3');
            elm.removeAttribute('data-html-4');
            elm.removeAttribute('data-html-5');
            elm.removeAttribute('data-html-6');
            elm.removeAttribute('data-html-7');
            elm.removeAttribute('data-html-8');
            elm.removeAttribute('data-html-9');
            elm.removeAttribute('data-html-10');
          });
        }

        // cleaning

        elms = tmp.querySelectorAll('[data-bottom-top],[data-center],[data-center-bottom],[data-100-top],[data-50-top],[data-top],[data-top-bottom],[data-center-top],[data--300-bottom],[data--150-bottom],[data--50-bottom],[data-bottom],[data-100-bottom],[data-150-bottom],[data-400-bottom],' + '[data--400-bottom],[data--200-bottom],[data--100-bottom],[data-50-bottom],[data-200-bottom],[data-300-bottom],' + '[data-in],[data-in-150],[data-in-300],' + '[data-cen--150],[data-cen],[data-cen-150],[data-out--300],[data-out--150],[data-out]' + '[data-t],[data-t-100],[data-t-200],[data-t-300],[data-t-400],' + '[data-t-500],[data-t-600],[data-t-700],[data-t-800],[data-t-900],[data-t-1000],' + '[data-t-1100],[data-t-1200],[data-t-1300],[data-t-1400],[data-t-1500],[data-t-1600],' + '[data-t-1700],[data-t-1800],[data-t-1900],[data-t-2000],[data-t-2100],[data-t-2200],' + '[data-t-2300],[data-t-2400],[data-t-2500],[data-t-2600],[data-t-2700],[data-t-2800]');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.style.transition = '';
          elm.style.transform = '';
          elm.style.opacity = '';
        });
        elms = tmp.querySelectorAll('.is-animated');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.removeClass(elm, 'animated');
          dom.removeClass(elm, 'pulse');
          dom.removeClass(elm, 'bounceIn');
          dom.removeClass(elm, 'fadeIn');
          dom.removeClass(elm, 'fadeOut'); //new
          dom.removeClass(elm, 'fadeInDown');
          dom.removeClass(elm, 'fadeInLeft');
          dom.removeClass(elm, 'fadeInRight');
          dom.removeClass(elm, 'fadeInUp');
          dom.removeClass(elm, 'flipInX');
          dom.removeClass(elm, 'flipInY');
          dom.removeClass(elm, 'slideInUp');
          dom.removeClass(elm, 'slideInDown');
          dom.removeClass(elm, 'slideInLeft');
          dom.removeClass(elm, 'slideInRight');
          dom.removeClass(elm, 'zoomIn');
          elm.style.animationDelay = '';
          elm.style.transitionDelay = '';
          elm.style.transitionDuration = '';
          elm.style.transitionTimingFunction = '';
          elm.style.transitionProperty = '';
        });
        var emptystyles = tmp.querySelectorAll('[style=""]');
        Array.prototype.forEach.call(emptystyles, function (emptystyle) {
          emptystyle.removeAttribute('style');
        });

        //Cleanup utils
        elms = tmp.querySelectorAll('.is-appeared, .box-active, .section-active, .section-select, .box-select');
        elms.forEach(function (elm) {
          elm.classList.remove('is-appeared');
          elm.classList.remove('box-active');
          elm.classList.remove('section-active');
          elm.classList.remove('section-select');
          elm.classList.remove('box-select');
        });
        elms = tmp.querySelectorAll('.is-section-tool, .is-box-tool, .is-box-info, .is-section-info');
        elms.forEach(function (elm) {
          if (elm.previousSibling && elm.previousSibling.nodeType === Node.TEXT_NODE) {
            elm.previousSibling.remove();
          }
          if (elm.nextSibling && elm.nextSibling.nodeType === Node.TEXT_NODE) {
            elm.nextSibling.remove();
          }
          elm.remove();
        });

        // freeform
        elms = tmp.querySelectorAll('.is-block .handle, .is-block .rotate-handle');
        dom.removeElements(elms);
        elms = tmp.querySelectorAll('.is-block');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.removeClass(elm, 'active');
          dom.removeClass(elm, 'multi');
          dom.removeClass(elm, 'editable');
          dom.removeClass(elm, 'fluid');
          dom.removeClass(elm, 'cloned');
          elm.removeAttribute('data-fluid-val');
          elm.removeAttribute('data-fluid');
          elm.removeAttribute('data-prev');
        });
        tmp.querySelectorAll('.is-block.clone').forEach(function (elm) {
          return elm.parentNode.removeChild(elm);
        });
        var html_content = '';
        var html_footer = '';
        var html_others = '';

        // Apply behavior on each row
        var sections = dom.elementChildren(tmp);
        sections.forEach(function (section) {
          var currentSection = section;
          if (dom.hasClass(currentSection, 'is-section')) {
            var secclass = '';
            // var secstyle = '';
            if (currentSection.getAttribute('class')) secclass = ' class="' + currentSection.getAttribute('class') + '"';
            // if (currentSection.getAttribute('style')) secstyle = ' style="' + currentSection.getAttribute('style') + '"';

            var copySection = currentSection.cloneNode(true);
            var htmlSection = copySection.outerHTML;
            html += htmlSection;

            //content & footer
            if (secclass.indexOf('is-static') === -1) {
              html_content += htmlSection + '\n\n';
            } else {
              html_footer += htmlSection + '\n\n';
            }
          } else {
            copySection = currentSection.cloneNode(true);
            htmlSection = copySection.outerHTML;
            html += htmlSection;

            //others
            html_others += htmlSection;
          }
        });

        // if (html_footer !== '') html_footer = '<!---FOOTER--->\n' + html_footer;
        // if (html_others !== '') html_others = '<!---OTHERS--->\n' + html_others;

        var contentbox = document.querySelector('[data-contentbox]');
        var disableStaticSection = false;
        if (contentbox) {
          disableStaticSection = contentbox.settings.disableStaticSection;
        }
        if (!disableStaticSection) {
          html = html_content + html_footer + html_others;
        }
        html = tmp.innerHTML.trim();
        html = html.replace(/<font/g, '<span').replace(/<\/font/g, '</span');
      } else {
        var _emptystyles = tmp.querySelectorAll('[style=""]');
        Array.prototype.forEach.call(_emptystyles, function (emptystyle) {
          emptystyle.removeAttribute('style');
        });
        if (this.builder.shortenOutput) {
          elms = tmp.querySelectorAll('[data-noedit], [data-module], [data-module-desc], [data-dialog-width], [data-dialog-height], [data-html], [data-settings]');
          elms.forEach(function (elm) {
            elm.removeAttribute('data-noedit');
            elm.removeAttribute('data-module');
            elm.removeAttribute('data-module-desc');
            elm.removeAttribute('data-dialog-width');
            elm.removeAttribute('data-dialog-height');
            elm.removeAttribute('data-html');
            elm.removeAttribute('data-settings');
          });
          elms = tmp.querySelectorAll('[data-html-1], [data-html-2], [data-html-3], [data-html-4], [data-html-5], [data-html-6], [data-html-7], [data-html-8], [data-html-9], [data-html-10]');
          elms.forEach(function (elm) {
            elm.removeAttribute('data-html-1');
            elm.removeAttribute('data-html-2');
            elm.removeAttribute('data-html-3');
            elm.removeAttribute('data-html-4');
            elm.removeAttribute('data-html-5');
            elm.removeAttribute('data-html-6');
            elm.removeAttribute('data-html-7');
            elm.removeAttribute('data-html-8');
            elm.removeAttribute('data-html-9');
            elm.removeAttribute('data-html-10');
          });
        }

        // freeform
        elms = tmp.querySelectorAll('.is-block .handle, .is-block .rotate-handle');
        dom.removeElements(elms);
        elms = tmp.querySelectorAll('.is-block');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.removeClass(elm, 'active');
          dom.removeClass(elm, 'multi');
          dom.removeClass(elm, 'editable');
          dom.removeClass(elm, 'fluid');
          dom.removeClass(elm, 'cloned');
          elm.removeAttribute('data-fluid-val');
          elm.removeAttribute('data-fluid');
          elm.removeAttribute('data-prev');
        });
        tmp.querySelectorAll('.is-block.clone').forEach(function (elm) {
          return elm.parentNode.removeChild(elm);
        });
        // tmp.querySelectorAll('.is-block.cloned').forEach(elm=>elm.classList.remove('cloned'));

        html = tmp.innerHTML.trim();
        html = html.replace(/<font/g, '<span').replace(/<\/font/g, '</span');
      }

      // elm = builderStuff.querySelector('#tmp_content');
      // if(elm) builderStuff.removeChild(elm);
      // elm = builderStuff.querySelector('#tmp_buildercontent');
      // if(elm) builderStuff.removeChild(elm);

      // return html;
      var beautify = (js_default()).html;
      html = beautify(html);
      // https://stackoverflow.com/questions/22962220/remove-multiple-line-breaks-n-in-javascript
      // html = html.replace(/(\r\n|\r|\n){2}/g, '$1').replace(/(\r\n|\r|\n){3,}/g, '$1\n')
      html = html.replace(/(\r\n|\r|\n){3,}/g, '$1\n');
      return html;
    }
  }, {
    key: "beautify",
    value: function beautify(html) {
      var beautify = (js_default()).html;
      html = beautify(html);
      html = html.replace(/(\r\n|\r|\n){3,}/g, '$1\n');
      return html;
    }
  }]);
  return HtmlUtil;
}();
/* harmony default export */ const contentbuilder_html = (HtmlUtil);
;// CONCATENATED MODULE: ./src/contentbuilder/undoredo.js
function undoredo_typeof(obj) { "@babel/helpers - typeof"; return undoredo_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, undoredo_typeof(obj); }
function undoredo_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function undoredo_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, undoredo_toPropertyKey(descriptor.key), descriptor); } }
function undoredo_createClass(Constructor, protoProps, staticProps) { if (protoProps) undoredo_defineProperties(Constructor.prototype, protoProps); if (staticProps) undoredo_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function undoredo_toPropertyKey(arg) { var key = undoredo_toPrimitive(arg, "string"); return undoredo_typeof(key) === "symbol" ? key : String(key); }
function undoredo_toPrimitive(input, hint) { if (undoredo_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (undoredo_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

// import HtmlUtil from './html.js';
var UndoRedo = /*#__PURE__*/function () {
  function UndoRedo(builder) {
    undoredo_classCallCheck(this, UndoRedo);
    this.builder = builder;
    var dom = this.builder.dom;
    this.dom = dom;
    this.undoList = [];
  }
  undoredo_createClass(UndoRedo, [{
    key: "readStyles",
    value: function readStyles() {
      if (this.builder.opts.undoContainerOnly) return '';
      var css = '';
      var i, src;
      var links = this.builder.doc.getElementsByTagName('link');
      for (i = 0; i < links.length; i++) {
        src = links[i].href.toLowerCase();
        if (src.indexOf('basetype-') !== -1) {
          css += links[i].outerHTML;
        }
      }
      links = this.builder.doc.getElementsByTagName('link');
      for (i = 0; i < links.length; i++) {
        src = links[i].href.toLowerCase();
        if (src.indexOf('basetype-') !== -1) {
          //noop
        } else if (src.indexOf('type-') !== -1) {
          css += links[i].outerHTML;
        }
      }
      return css;
    }
  }, {
    key: "writeStyles",
    value: function writeStyles(styles) {
      var dom = this.dom;
      if (this.builder.opts.undoContainerOnly) return;
      var i, src;
      var links = this.builder.doc.getElementsByTagName('link');
      for (i = 0; i < links.length; i++) {
        src = links[i].href.toLowerCase();
        if (src.indexOf('basetype-') !== -1) {
          links[i].parentNode.removeChild(links[i]);
        } else if (src.indexOf('type-') !== -1) {
          links[i].parentNode.removeChild(links[i]);
        }
      }
      var head = this.builder.doc.getElementsByTagName('head')[0];
      dom.appendHtml(head, styles);
    }
  }, {
    key: "readHtml",
    value: function readHtml() {
      // const htmlutil = new HtmlUtil(this.builder); 
      if (this.builder.opts.page !== '' && !this.builder.opts.undoContainerOnly) {
        var wrapper = this.builder.doc.querySelector(this.builder.opts.page);
        // return htmlutil.readHtml(wrapper, false);
        return wrapper.innerHTML;
      } else if (this.builder.docContainer) {
        var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
        return docContainer.innerHTML;
      } else {
        var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
        var html = '';
        Array.prototype.forEach.call(builders, function (builder) {
          // if(html==='') {
          //     html = htmlutil.readHtml(builder, false);
          // } else {
          //     html+= '####|####' + htmlutil.readHtml(builder, false);
          // }
          // html += htmlutil.readHtml(builder, false) + '####|####'; //new
          html += builder.innerHTML + '####|####'; //new
        });

        html = html.substr(0, html.length - 9); //new
        return html;
      }
    }
  }, {
    key: "cleaning",
    value: function cleaning(tmp) {
      // See html.js readHtml's cleaning
      var dom = this.dom;
      var builders = tmp.querySelectorAll('.is-builder');
      Array.prototype.forEach.call(builders, function (builder) {
        builder.removeAttribute('data-sort');
      });
      var elms = tmp.querySelectorAll('[data-click]');
      dom.removeAttributes(elms, 'data-click');
      dom.removeElements(tmp.querySelectorAll('.is-row-tool'));
      dom.removeElements(tmp.querySelectorAll('.is-rowadd-tool'));
      dom.removeElements(tmp.querySelectorAll('.is-col-tool'));
      dom.removeElements(tmp.querySelectorAll('.is-canvas-tool'));
      dom.removeElements(tmp.querySelectorAll('.is-canvasadd-tool'));
      dom.removeElements(tmp.querySelectorAll('.ovl'));
      dom.removeElements(tmp.querySelectorAll('.row-add-initial'));

      // freeform
      elms = tmp.querySelectorAll('.is-block .handle, .is-block .rotate-handle');
      dom.removeElements(elms);
      elms = tmp.querySelectorAll('.is-block');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'active');
        dom.removeClass(elm, 'multi');
        dom.removeClass(elm, 'editable');
        dom.removeClass(elm, 'fluid');
        dom.removeClass(elm, 'cloned');
        elm.removeAttribute('data-fluid-val');
        elm.removeAttribute('data-fluid');
        elm.removeAttribute('data-prev');
      });
      tmp.querySelectorAll('.is-block.clone').forEach(function (elm) {
        return elm.parentNode.removeChild(elm);
      });
      // tmp.querySelectorAll('.is-block.cloned').forEach(elm=>elm.classList.remove('cloned'));

      //ContentBox
      elms = tmp.querySelectorAll('.is-section-tool');
      dom.removeElements(elms);
    }
  }, {
    key: "writeHtml",
    value: function writeHtml(html) {
      var _this = this;
      if (this.builder.opts.page !== '' && !this.builder.opts.undoContainerOnly) {
        var wrapper = this.builder.doc.querySelector(this.builder.opts.page);

        // wrapper.innerHTML = html;

        // Use createContextualFragment() to make embedded script executable
        // https://ghinda.net/article/script-tags/
        var range = document.createRange();
        wrapper.innerHTML = '';
        wrapper.appendChild(range.createContextualFragment(html));

        // applyBehavior (in ContentBox, unUndo will call pageSetup/applyBehavior)
        this.cleaning(wrapper);
      } else if (this.builder.docContainer) {
        var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
        var _range = document.createRange();
        docContainer.innerHTML = '';
        docContainer.appendChild(_range.createContextualFragment(html));
        this.cleaning(docContainer);
      } else {
        var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
        var n = 0;
        Array.prototype.forEach.call(builders, function (builder) {
          // builder.innerHTML = html.split('####|####')[n];

          // Use createContextualFragment() to make embedded script executable
          // https://ghinda.net/article/script-tags/
          var range = document.createRange();
          builder.innerHTML = '';
          builder.appendChild(range.createContextualFragment(html.split('####|####')[n]));

          // applyBehavior
          _this.cleaning(builder);
          _this.builder.applyBehaviorOn(builder);
          n++;
        });
      }
      this.builder.opts.onRender();
    }
  }, {
    key: "saveForUndo",
    value: function saveForUndo(checkLater) {
      if (this.builder.onBeforeSaveForUndo) this.builder.onBeforeSaveForUndo();
      if (this.builder.undoRedoStyles) {
        if (this.undoList[120]) {
          var saves = this.undoList[120][0];
          var html = saves.split('###$###')[1];

          // Styles doesn't need to be checked. saveForUndoCheck is true only after colorpicker or gradient picker opened
          // (because after opened, user may not make changes, so checking for content change is needed).
          // This relates to html content, not styles. So we always check html content, not styles. 

          if (this.builder.saveForUndoCheck) {
            if (html === this.readHtml()) {
              // no change
              // console.log('no change');

              if (checkLater === true) this.builder.saveForUndoCheck = true;else this.builder.saveForUndoCheck = false;
              return;
            }
          }
        }
      } else {
        if (this.undoList[120]) {
          var _html = this.undoList[120][0];
          if (this.builder.saveForUndoCheck) {
            if (_html === this.readHtml()) {
              // no change
              // console.log('no change');

              if (checkLater === true) this.builder.saveForUndoCheck = true;else this.builder.saveForUndoCheck = false;
              return;
            }
          }
        }
      }
      if (checkLater === true) this.builder.saveForUndoCheck = true;else this.builder.saveForUndoCheck = false;

      // console.log('save');

      this.undoList[140] = this.undoList[139]; // addition
      this.undoList[139] = this.undoList[138];
      this.undoList[138] = this.undoList[137];
      this.undoList[137] = this.undoList[136];
      this.undoList[136] = this.undoList[135];
      this.undoList[135] = this.undoList[134];
      this.undoList[134] = this.undoList[133];
      this.undoList[133] = this.undoList[132];
      this.undoList[132] = this.undoList[131];
      this.undoList[131] = this.undoList[130];
      this.undoList[130] = this.undoList[129];
      this.undoList[129] = this.undoList[128];
      this.undoList[128] = this.undoList[127];
      this.undoList[127] = this.undoList[126];
      this.undoList[126] = this.undoList[125];
      this.undoList[125] = this.undoList[124];
      this.undoList[124] = this.undoList[123];
      this.undoList[123] = this.undoList[122];
      this.undoList[122] = this.undoList[121];
      this.undoList[121] = this.undoList[120];
      if (this.builder.undoRedoStyles) {
        var styles = this.readStyles();
        var _html2 = this.readHtml();
        var _saves = ' ' + styles + '###$###' + _html2;
        this.undoList[120] = [_saves, null];
      } else {
        this.undoList[120] = [this.readHtml(), null];
      }
    }
  }, {
    key: "doUndo",
    value: function doUndo() {
      var dom = this.dom;
      if (!this.undoList[120]) return;
      if (this.builder.undoRedoInProcess === true) return; // do not precess if previous operation is still running

      // console.log('undo');

      this.builder.undoRedoInProcess = true;
      this.undoList[99] = this.undoList[100];
      this.undoList[100] = this.undoList[101];
      this.undoList[101] = this.undoList[102];
      this.undoList[102] = this.undoList[103];
      this.undoList[103] = this.undoList[104];
      this.undoList[104] = this.undoList[105];
      this.undoList[105] = this.undoList[106];
      this.undoList[106] = this.undoList[107];
      this.undoList[107] = this.undoList[108];
      this.undoList[108] = this.undoList[109];
      this.undoList[109] = this.undoList[110];
      this.undoList[110] = this.undoList[111];
      this.undoList[111] = this.undoList[112];
      this.undoList[112] = this.undoList[113];
      this.undoList[113] = this.undoList[114];
      this.undoList[114] = this.undoList[115];
      this.undoList[115] = this.undoList[116];
      this.undoList[116] = this.undoList[117];
      this.undoList[117] = this.undoList[118];
      this.undoList[118] = this.undoList[119];
      if (this.builder.undoRedoStyles) {
        var styles = this.readStyles();
        var html = this.readHtml();
        var saves = ' ' + styles + '###$###' + html;
        this.undoList[119] = [saves, null];

        // -

        saves = this.undoList[120][0];
        styles = saves.split('###$###')[0].trim();
        html = saves.split('###$###')[1];
        this.writeStyles(styles);
        this.writeHtml(html);
      } else {
        this.undoList[119] = [this.readHtml(), null];
        var _html3 = this.undoList[120][0];
        this.writeHtml(_html3);
      }
      this.builder.applyBehavior();
      this.builder.applyBehaviorCanvas();
      this.builder.opts.onChange();
      this.undoList[120] = this.undoList[121];
      this.undoList[121] = this.undoList[122];
      this.undoList[122] = this.undoList[123];
      this.undoList[123] = this.undoList[124];
      this.undoList[124] = this.undoList[125];
      this.undoList[125] = this.undoList[126];
      this.undoList[126] = this.undoList[127];
      this.undoList[127] = this.undoList[128];
      this.undoList[128] = this.undoList[129];
      this.undoList[129] = this.undoList[130];
      this.undoList[130] = this.undoList[131];
      this.undoList[131] = this.undoList[132];
      this.undoList[132] = this.undoList[133];
      this.undoList[133] = this.undoList[134];
      this.undoList[134] = this.undoList[135];
      this.undoList[135] = this.undoList[136];
      this.undoList[136] = this.undoList[137];
      this.undoList[137] = this.undoList[138];
      this.undoList[138] = this.undoList[139];
      this.undoList[139] = this.undoList[140];
      this.undoList[140] = this.undoList[141];
      var util = new Util(this.builder);
      util.clearActiveCell();
      util.clearAfterUndoRedo();
      var elm = this.builder.doc.querySelector('[data-saveforundo]');
      if (elm) {
        var panel = document.querySelector('.is-side.elementstyles');
        dom.addClass(panel, 'active');
        setTimeout(function () {
          elm.click();
        }, 700);
      } else {
        var _panel = document.querySelector('.is-side.elementstyles');
        dom.removeClass(_panel, 'active');
      }
      if (this.builder.opts.onUndo) {
        this.builder.opts.onUndo();
      }
      this.builder.undoRedoInProcess = false;
    }
  }, {
    key: "doRedo",
    value: function doRedo() {
      var dom = this.dom;
      if (!this.undoList[119]) return;
      if (this.builder.undoRedoInProcess === true) return; // do not precess if previous operation is still running

      // console.log('redo');

      this.builder.undoRedoInProcess = true;
      this.undoList[141] = this.undoList[140];
      this.undoList[140] = this.undoList[139];
      this.undoList[139] = this.undoList[138];
      this.undoList[138] = this.undoList[137];
      this.undoList[137] = this.undoList[136];
      this.undoList[136] = this.undoList[135];
      this.undoList[135] = this.undoList[134];
      this.undoList[134] = this.undoList[133];
      this.undoList[133] = this.undoList[132];
      this.undoList[132] = this.undoList[131];
      this.undoList[131] = this.undoList[130];
      this.undoList[130] = this.undoList[129];
      this.undoList[129] = this.undoList[128];
      this.undoList[128] = this.undoList[127];
      this.undoList[127] = this.undoList[126];
      this.undoList[126] = this.undoList[125];
      this.undoList[125] = this.undoList[124];
      this.undoList[124] = this.undoList[123];
      this.undoList[123] = this.undoList[122];
      this.undoList[122] = this.undoList[121];
      this.undoList[121] = this.undoList[120];
      if (this.builder.undoRedoStyles) {
        var styles = this.readStyles();
        var html = this.readHtml();
        var saves = ' ' + styles + '###$###' + html;
        this.undoList[120] = [saves, null];

        // -

        saves = this.undoList[119][0];
        styles = saves.split('###$###')[0].trim();
        html = saves.split('###$###')[1];
        this.writeStyles(styles);
        this.writeHtml(html);
      } else {
        this.undoList[120] = [this.readHtml(), null];
        var _html4 = this.undoList[119][0];
        this.writeHtml(_html4);
      }
      this.builder.applyBehavior();
      this.builder.applyBehaviorCanvas();
      this.builder.opts.onChange();
      this.undoList[119] = this.undoList[118];
      this.undoList[118] = this.undoList[117];
      this.undoList[117] = this.undoList[116];
      this.undoList[116] = this.undoList[115];
      this.undoList[115] = this.undoList[114];
      this.undoList[114] = this.undoList[113];
      this.undoList[113] = this.undoList[112];
      this.undoList[112] = this.undoList[111];
      this.undoList[111] = this.undoList[110];
      this.undoList[110] = this.undoList[109];
      this.undoList[109] = this.undoList[108];
      this.undoList[108] = this.undoList[107];
      this.undoList[107] = this.undoList[106];
      this.undoList[106] = this.undoList[105];
      this.undoList[105] = this.undoList[104];
      this.undoList[104] = this.undoList[103];
      this.undoList[103] = this.undoList[102];
      this.undoList[102] = this.undoList[101];
      this.undoList[101] = this.undoList[100];
      this.undoList[100] = this.undoList[99];
      this.undoList[99] = null;
      var util = new Util(this.builder);
      util.clearActiveCell();
      util.clearAfterUndoRedo();
      var elm = this.builder.doc.querySelector('[data-saveforundo]');
      if (elm) {
        var panel = document.querySelector('.is-side.elementstyles');
        dom.addClass(panel, 'active');
        setTimeout(function () {
          elm.click();
        }, 700);
      } else {
        var _panel2 = document.querySelector('.is-side.elementstyles');
        dom.removeClass(_panel2, 'active');
      }
      if (this.builder.opts.onRedo) {
        this.builder.opts.onRedo();
      }
      this.builder.undoRedoInProcess = false;
    }
  }]);
  return UndoRedo;
}();
/* harmony default export */ const undoredo = (UndoRedo);
;// CONCATENATED MODULE: ./src/contentbuilder/svgicons.js
/*!
Ionicons
License: MIT
Copyright (c) 2015-present Ionic (http://ionic.io/)
https://ionic.io/ionicons/v1
*/

/*!
Tabler Icons
License: MIT
Copyright (c) 2020 Paweł Kuna
https://github.com/tabler/tabler-icons
*/

var prepareSvgIcons = function prepareSvgIcons(builder) {
  var html = "<svg width=\"0\" height=\"0\" style=\"position:absolute;display:none;\">\n        <defs>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-left\"><path d=\"M352 115.4L331.3 96 160 256l171.3 160 20.7-19.3L201.5 256z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-right\"><path d=\"M160 115.4L180.7 96 352 256 180.7 416 160 396.7 310.5 256z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-plus-outline\"><path d=\"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm0 398.7c-105.1 0-190.7-85.5-190.7-190.7S150.9 65.3 256 65.3 446.7 150.9 446.7 256 361.1 446.7 256 446.7z\"></path><path d=\"M264.1 128h-16.8v119.9H128v16.8h119.3V384h16.8V264.7H384v-16.8H264.1z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-image\"><path d=\"M368 224c26.5 0 48-21.5 48-48s-21.5-48-48-48-48 21.5-48 48 21.5 48 48 48z\"></path><path d=\"M452 64H60c-15.6 0-28 12.7-28 28.3v327.4c0 15.6 12.4 28.3 28 28.3h392c15.6 0 28-12.7 28-28.3V92.3c0-15.6-12.4-28.3-28-28.3zM348.9 261.7c-3-3.5-7.6-6.2-12.8-6.2-5.1 0-8.7 2.4-12.8 5.7L304.6 277c-3.9 2.8-7 4.7-11.5 4.7-4.3 0-8.2-1.6-11-4.1-1-.9-2.8-2.6-4.3-4.1L224 215.3c-4-4.6-10-7.5-16.7-7.5-6.7 0-12.9 3.3-16.8 7.8L64 368.2V107.7c1-6.8 6.3-11.7 13.1-11.7h357.7c6.9 0 12.5 5.1 12.9 12l.3 260.4-99.1-106.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-photos-outline\"><path d=\"M96 128v320h384V128H96zm368 304H112V144h352v288z\"></path><path d=\"M32 64v320h48v-16H48V80h352v32h16V64z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-settings-strong\"><path d=\"M32 376h283.35c6.186-14.112 20.281-24 36.65-24s30.465 9.888 36.65 24H480v32h-91.35c-6.186 14.112-20.281 24-36.65 24s-30.465-9.888-36.65-24H32M32 240h91.35c6.186-14.112 20.281-24 36.65-24s30.465 9.888 36.65 24H480v32H196.65c-6.186 14.112-20.281 24-36.65 24s-30.465-9.888-36.65-24H32M32 104h283.35c6.186-14.112 20.281-24 36.65-24s30.465 9.888 36.65 24H480v32h-91.35c-6.186 14.112-20.281 24-36.65 24s-30.465-9.888-36.65-24H32\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-settings\"><path d=\"M352 104c8.837 0 16 7.163 16 16s-7.163 16-16 16-16-7.163-16-16 7.163-16 16-16m0-16c-17.645 0-32 14.355-32 32s14.355 32 32 32 32-14.355 32-32-14.355-32-32-32zM352 376c8.837 0 16 7.163 16 16s-7.163 16-16 16-16-7.163-16-16 7.163-16 16-16m0-16c-17.645 0-32 14.355-32 32s14.355 32 32 32 32-14.355 32-32-14.355-32-32-32zM160 240c8.837 0 16 7.163 16 16s-7.163 16-16 16-16-7.163-16-16 7.163-16 16-16m0-16c-17.645 0-32 14.355-32 32s14.355 32 32 32 32-14.355 32-32-14.355-32-32-32zM207.32 248H480v16H207.32c.439-2.604.68-5.273.68-8s-.24-5.396-.68-8zM112 256c0 2.727.24 5.396.68 8H32v-16h80.68a47.955 47.955 0 0 0-.68 8zM399.32 384H480v16h-80.68c.439-2.604.68-5.273.68-8s-.24-5.396-.68-8zM304 392c0 2.727.24 5.396.68 8H32v-16h272.68a47.955 47.955 0 0 0-.68 8zM399.32 112H480v16h-80.68c.439-2.604.68-5.273.68-8s-.24-5.396-.68-8zM304.68 112c-.439 2.604-.68 5.273-.68 8s.24 5.396.68 8H32v-16h272.68z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-options\"><path d=\"M32 384h272v32H32zM400 384h80v32h-80zM384 447.5c0 17.949-14.327 32.5-32 32.5-17.673 0-32-14.551-32-32.5v-95c0-17.949 14.327-32.5 32-32.5 17.673 0 32 14.551 32 32.5v95z\"></path><g><path d=\"M32 240h80v32H32zM208 240h272v32H208zM192 303.5c0 17.949-14.327 32.5-32 32.5-17.673 0-32-14.551-32-32.5v-95c0-17.949 14.327-32.5 32-32.5 17.673 0 32 14.551 32 32.5v95z\"></path></g><g><path d=\"M32 96h272v32H32zM400 96h80v32h-80zM384 159.5c0 17.949-14.327 32.5-32 32.5-17.673 0-32-14.551-32-32.5v-95c0-17.949 14.327-32.5 32-32.5 17.673 0 32 14.551 32 32.5v95z\"></path></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-list-number\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-1043.45,1024 C-1039.25,946.283 -1023.18,878.648 -995.249,821.096 C-967.313,763.544 -912.806,711.242 -831.728,664.192 L-710.742,594.247 C-656.55,562.74 -618.532,535.854 -596.687,513.589 C-562.24,478.722 -545.016,438.813 -545.016,393.863 C-545.016,341.352 -560.769,299.658 -592.276,268.781 C-623.783,237.904 -665.792,222.466 -718.304,222.466 C-796.02,222.466 -849.792,251.873 -879.619,310.685 C-895.582,342.192 -904.404,385.882 -906.084,441.754 L-1021.4,441.754 C-1020.14,363.197 -1005.65,299.133 -977.92,249.562 C-928.769,162.183 -842.02,118.494 -717.673,118.494 C-614.331,118.494 -538.82,146.43 -491.139,202.302 C-443.459,258.174 -419.619,320.347 -419.619,388.822 C-419.619,461.078 -445.034,522.831 -495.865,574.082 C-525.272,603.909 -577.993,640.037 -654.03,682.466 L-740.358,730.356 C-781.527,753.041 -813.874,774.676 -837.399,795.26 C-879.408,831.808 -905.874,872.347 -916.797,916.877 L-424.03,916.877 L-424.03,1024 L-1043.45,1024 Z \"  /><path d=\"M-922.391,-764.384 L-922.391,-851.343 C-840.474,-859.324 -783.341,-872.662 -750.994,-891.356 C-718.647,-910.05 -694.492,-954.265 -678.529,-1024 L-589.049,-1024 L-589.049,-125.425 L-710.035,-125.425 L-710.035,-764.384 L-922.391,-764.384 Z \"  /><path d=\"M-198.618,-510.942 L-198.618,-667.156 L1004.57,-667.156 L1004.57,-510.942 L-198.618,-510.942 Z \"  /><path d=\"M-198.618,78.1071 L-198.618,-78.1071 L1004.57,-78.1071 L1004.57,78.1071 L-198.618,78.1071 Z \"  /><path d=\"M-179.185,649.354 L-179.185,493.14 L1024,493.14 L1024,649.354 L-179.185,649.354 Z \"  /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-list-bullet\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-379.801,-514.33 L-379.801,-670.545 L914.662,-670.545 L914.662,-514.33 L-379.801,-514.33 Z \"  /><path d=\"M-379.801,78.1071 L-379.801,-78.1071 L914.662,-78.1071 L914.662,78.1071 L-379.801,78.1071 Z \"  /><path d=\"M-379.801,670.545 L-379.801,514.33 L914.662,514.33 L914.662,670.545 L-379.801,670.545 Z \"  /><path d=\"M-929.642,-469.441 L-929.642,-715.434 L-669.092,-715.434 L-669.092,-469.441 L-929.642,-469.441 Z \"  /><path d=\"M-929.642,127.109 L-929.642,-118.885 L-669.092,-118.885 L-669.092,127.109 L-929.642,127.109 Z \"  /><path d=\"M-929.642,715.434 L-929.642,469.441 L-669.092,469.441 L-669.092,715.434 L-929.642,715.434 Z \"  /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-clean\">\n                <g transform=\"matrix(1,0,0,1,1024.0,1024.0)\">\n                    <path d=\"M75.0013,893.849 L-1030.73,900.993 L-32.1518,-880.838 L1009.54,-880.838 L75.0013,893.849 Z \" fill=\"currentColor\" />\n                    <path d=\"M-30.8571,780.685 L-845.2,787.828 L-508.893,193.749 L305.26,194.963 L-30.8571,780.685 Z \" fill=\"#ffffff\" fill-opacity=\"1.00\" />\n                </g>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-location\"><path d=\"M256 64c-65.9 0-119.3 53.7-119.3 120 0 114.6 119.3 264 119.3 264s119.3-149.4 119.3-264c0-66.3-53.4-120-119.3-120zm0 178.2c-31.2 0-56.4-25.4-56.4-56.7 0-31.3 25.3-56.8 56.4-56.8 31.2 0 56.4 25.4 56.4 56.8 0 31.3-25.2 56.7-56.4 56.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-film-outline\"><path d=\"M0 360h400v-336h-400v336zM72 40v48h-56v-48h56zM72 104v48h-56v-48h56zM72 168v48h-56v-48h56zM72 232v48h-56v-48h56zM72 296v48h-56v-48h56zM312 40v144h-224v-144h224zM312 200v144h-224v-144h224zM384 40v48h-56v-48h56zM384 104v48h-56v-48h56zM384 168v48h-56v-48\n                h56zM384 232v48h-56v-48h56zM384 296v48h-56v-48h56z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-social-youtube-outline\"><path d=\"M265 96c65.3 0 118.7 1.1 168.1 3.3h1.4c23.1 0 42 22 42 49.1v1.1l.1 1.1c2.3 34 3.4 69.3 3.4 104.9.1 35.6-1.1 70.9-3.4 104.9l-.1 1.1v1.1c0 13.8-4.7 26.6-13.4 36.1-7.8 8.6-18 13.4-28.6 13.4h-1.6c-52.9 2.5-108.8 3.8-166.4 3.8h-10.6.1-10.9c-57.8 0-113.7-1.3-166.2-3.7h-1.6c-10.6 0-20.7-4.8-28.5-13.4-8.6-9.5-13.4-22.3-13.4-36.1v-1.1l-.1-1.1c-2.4-34.1-3.5-69.4-3.3-104.7v-.2c-.1-35.3 1-70.5 3.3-104.6l.1-1.1v-1.1c0-27.2 18.8-49.3 41.9-49.3h1.4c49.5-2.3 102.9-3.3 168.2-3.3H265m0-32.2h-18c-57.6 0-114.2.8-169.6 3.3-40.8 0-73.9 36.3-73.9 81.3C1 184.4-.1 220 0 255.7c-.1 35.7.9 71.3 3.4 107 0 45 33.1 81.6 73.9 81.6 54.8 2.6 110.7 3.8 167.8 3.8h21.6c57.1 0 113-1.2 167.9-3.8 40.9 0 74-36.6 74-81.6 2.4-35.7 3.5-71.4 3.4-107.1.1-35.7-1-71.3-3.4-107.1 0-45-33.1-81.1-74-81.1C379.2 64.8 322.7 64 265 64z\"></path><path d=\"M207 353.8V157.4l145 98.2-145 98.2z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-play\"><path d=\"M128 96v320l256-160L128 96z\"></path></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-full\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /><path d=\"M-770.219,-115.563 L-770.219,-271.777 L770.219,-271.777 L770.219,-115.563 L-770.219,-115.563 Z \" /><path d=\"M-770.219,303.503 L-770.219,147.288 L770.219,147.288 L770.219,303.503 L-770.219,303.503 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-center\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-552.286,-107.697 L-552.286,-263.911 L552.286,-263.911 L552.286,-107.697 L-552.286,-107.697 Z \" /><path d=\"M-467.355,319.234 L-467.355,163.02 L466.34,163.02 L466.34,319.234 L-467.355,319.234 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-left\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /><path d=\"M-770.219,-115.563 L-770.219,-271.777 L482.839,-271.777 L482.839,-115.563 L-770.219,-115.563 Z \" /><path d=\"M-770.219,303.503 L-770.219,147.288 L122.787,147.288 L122.787,303.503 L-770.219,303.503 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-right\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /><path d=\"M-483.346,-118.081 L-483.346,-274.295 L769.712,-274.295 L769.712,-118.081 L-483.346,-118.081 Z \" /><path d=\"M-123.871,303.503 L-123.871,147.288 L769.136,147.288 L769.136,303.503 L-123.871,303.503 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-indent\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-829.04,-514.33 L-829.04,-670.545 L808.959,-670.545 L808.959,-514.33 L-829.04,-514.33 Z \" /><path d=\"M-829.04,670.545 L-829.04,514.33 L808.959,514.33 L808.959,670.545 L-829.04,670.545 Z \" /><path d=\"M-254.279,-110.244 L-254.279,-266.458 L808.959,-266.458 L808.959,-110.244 L-254.279,-110.244 Z \" /><path d=\"M-254.279,266.458 L-254.279,110.244 L808.959,110.244 L808.959,266.458 L-254.279,266.458 Z \" /><path d=\"M-829.04,-195.117 L-490.958,-1.03508e-14 L-829.04,195.117 L-829.04,-195.117 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-outdent\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-829.04,-514.33 L-829.04,-670.545 L808.959,-670.545 L808.959,-514.33 L-829.04,-514.33 Z \" /><path d=\"M-829.04,670.545 L-829.04,514.33 L808.959,514.33 L808.959,670.545 L-829.04,670.545 Z \" /><path d=\"M-829.04,-110.244 L-829.04,-266.458 L234.198,-266.458 L234.198,-110.244 L-829.04,-110.244 Z \" /><path d=\"M-829.04,266.458 L-829.04,110.244 L234.198,110.244 L234.198,266.458 L-829.04,266.458 Z \" /><path d=\"M808.959,-195.117 L470.877,-1.03508e-14 L808.959,195.117 L808.959,-195.117 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-table\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-660.783,660.783 L660.783,660.783 L660.783,-660.783 L-660.783,-660.783 L-660.783,660.783 Z \" fill=\"none\" stroke-width=\"75.82\" stroke=\"currentColor\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" /><path d=\"M-37.9645,698.933 L37.9645,698.933 L37.9645,-698.569 L-37.9645,-698.569 L-37.9645,698.933 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" stroke-width=\"0.25\" stroke=\"currentColor\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" /><path d=\"M-698.933,-37.7825 L-698.933,38.1465 L698.569,38.1465 L698.569,-37.7825 L-698.933,-37.7825 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" stroke-width=\"0.25\" stroke=\"currentColor\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" /></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-happy\"><path d=\"M256 48C140.563 48 48 141.6 48 256s92.563 208 208 208 208-93.6 208-208S370.401 48 256 48zm0 374.4c-91.518 0-166.404-74.883-166.404-166.4 0-91.518 74.887-166.4 166.404-166.4S422.404 164.482 422.404 256 347.518 422.4 256 422.4zm72.8-187.2c17.683 0 31.201-13.518 31.201-31.2s-13.519-31.2-31.201-31.2c-17.682 0-31.2 13.518-31.2 31.2s13.518 31.2 31.2 31.2zm-145.6 0c17.682 0 31.2-13.518 31.2-31.2s-13.519-31.2-31.2-31.2c-17.683 0-31.201 13.518-31.201 31.2s13.519 31.2 31.201 31.2zM256 370.4c48.883 0 89.436-30.164 106.081-72.801H149.919C166.564 340.236 207.117 370.4 256 370.4z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-create\"><path d=\"M64 368v80h80l235.727-235.729-79.999-79.998L64 368zm377.602-217.602c8.531-8.531 8.531-21.334 0-29.865l-50.135-50.135c-8.531-8.531-21.334-8.531-29.865 0l-39.468 39.469 79.999 79.998 39.469-39.467z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-minus-empty\"><path d=\"M384 265H128v-17h256v17z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-eye\"><path d=\"M256 128c-81.9 0-145.7 48.8-224 128 67.4 67.7 124 128 224 128 99.9 0 173.4-76.4 224-126.6C428.2 198.6 354.8 128 256 128zm0 219.3c-49.4 0-89.6-41-89.6-91.3 0-50.4 40.2-91.3 89.6-91.3s89.6 41 89.6 91.3c0 50.4-40.2 91.3-89.6 91.3z\"></path><path d=\"M256 224c0-7.9 2.9-15.1 7.6-20.7-2.5-.4-5-.6-7.6-.6-28.8 0-52.3 23.9-52.3 53.3s23.5 53.3 52.3 53.3 52.3-23.9 52.3-53.3c0-2.3-.2-4.6-.4-6.9-5.5 4.3-12.3 6.9-19.8 6.9-17.8 0-32.1-14.3-32.1-32z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-reply\"><path d=\"M448 400s-36.8-208-224-208v-80L64 256l160 134.4v-92.3c101.6 0 171 8.9 224 101.9z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-folder-outline\">\n                <path d=\"M457 96H215c-2.791 0-4.271-.585-6.094-2.408l-22.501-22.501-.168-.162C181.365 66.333 177.361 64 169 64H57c-13.785 0-25 10.317-25 23v336c0 13.317 11.683 25 25 25h400c12.683 0 23-11.215 23-25V119c0-13.327-9.673-23-23-23zM57 80h112c3.497 0 3.737.189 6.175 2.488l22.417 22.418c4.84 4.84 10.372 7.094 17.408 7.094h242c4.448 0 7 2.552 7 7v42.376a23.885 23.885 0 0 0-8-1.376H56c-2.805 0-5.496.488-8 1.376V87c0-4.323 4.672-7 9-7zm407 343c0 4.328-2.677 9-7 9H57c-4.458 0-9-4.542-9-9V184c0-4.411 3.589-8 8-8h400c4.411 0 8 3.589 8 8v239z\"/>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-cloud-outline\">\n                <path d=\"M399.3 232.8c0-1.2.2-2.4.2-3.6 0-64.3-52.8-117.2-116.8-117.2-46.1 0-85.8 27.9-104.4 67-8.1-4.1-17.1-6.4-26.8-6.4-29.6 0-54.1 23.7-58.9 52C57.4 236.8 32 268.8 32 308.4c0 49.8 40.1 91.6 89.6 91.6H398c45 0 82-38.9 82-84.3 0-45.6-35.4-82.8-80.7-82.9zm-1.8 150.8l-3.2.4H122.4c-40.9 0-74.2-34.9-74.2-76.1 0-31.9 20.2-58.4 50.2-68.8l8.4-3 1.5-8.8c3.6-21.6 22.1-39.3 43.9-39.3 6.9 0 13.7 1.6 19.9 4.8l13.5 6.8 6.5-13.7c16.6-34.9 52.1-58.2 90.4-58.2 55.3 0 100.9 44.1 100.9 99.7 0 13.3-.2 20.3-.2 20.3l15.2.1c36.7.5 65.6 30.5 65.6 67.4 0 36.9-29.8 68.2-66.5 68.4z\"/>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-wrench\"><path d=\"M461.9 114.9l-56.5 56.7-55.1-10-9.9-55.1 56.5-56.7c-12.7-12.7-30.8-18.5-44.2-17.8-13.5.7-42.3 8.3-64.6 32-21.6 22.8-44.3 65.3-24.2 112.5 2.4 5.7 5.1 13.2-2.9 21.2-8.1 8-215 202.8-215 202.8-19.4 16.7-18 47.6-.1 65.6 18.2 17.9 48.9 19 65.6-.3 0 0 193.2-205.8 202.7-215.1 8.5-8.3 16.1-5.5 21.2-2.9 35.6 18.4 86.3 2.4 112.6-23.9 26.3-26.3 31.1-51.7 31.9-64.7.8-12.9-3.7-30-18-44.3zM91.3 443.2c-6.3 6.2-16.5 6.2-22.7 0-6.2-6.3-6.2-16.5 0-22.7 6.3-6.2 16.5-6.2 22.7 0 6.2 6.3 6.2 16.5 0 22.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-more\"><path d=\"M113.7 304C86.2 304 64 282.6 64 256c0-26.5 22.2-48 49.7-48 27.6 0 49.8 21.5 49.8 48 0 26.6-22.2 48-49.8 48zM256 304c-27.5 0-49.8-21.4-49.8-48 0-26.5 22.3-48 49.8-48 27.5 0 49.7 21.5 49.7 48 0 26.6-22.2 48-49.7 48zM398.2 304c-27.5 0-49.8-21.4-49.8-48 0-26.5 22.2-48 49.8-48 27.5 0 49.8 21.5 49.8 48 0 26.6-22.2 48-49.8 48z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-code-working\"><circle cx=\"184.166\" cy=\"256.166\" r=\"24\"></circle><circle cx=\"256.166\" cy=\"256.166\" r=\"24\"></circle><circle cx=\"328.166\" cy=\"256.166\" r=\"24\"></circle><g><path d=\"M168 392a23.929 23.929 0 0 1-16.971-7.029l-112-112c-9.373-9.373-9.373-24.569 0-33.941l112-112c9.373-9.372 24.568-9.372 33.941 0 9.371 9.372 9.371 24.568 0 33.941L89.941 256l95.029 95.029c9.371 9.372 9.371 24.568 0 33.941A23.925 23.925 0 0 1 168 392zM344 392a23.929 23.929 0 0 0 16.971-7.029l112-112c9.373-9.373 9.373-24.569 0-33.941l-112-112c-9.373-9.372-24.568-9.372-33.941 0-9.371 9.372-9.371 24.568 0 33.941L422.059 256l-95.029 95.029c-9.371 9.372-9.371 24.568 0 33.941A23.925 23.925 0 0 0 344 392z\"></path></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-gear\"><path d=\"M416.349 256.046c-.001-21.013 13.143-38.948 31.651-46.062a196.302 196.302 0 0 0-23.664-57.139 49.423 49.423 0 0 1-20.082 4.254c-12.621 0-25.238-4.811-34.871-14.442-14.863-14.863-18.248-36.846-10.18-54.97A196.274 196.274 0 0 0 302.074 64C294.971 82.529 277.027 95.69 256 95.69c-21.025 0-38.969-13.161-46.073-31.69a196.243 196.243 0 0 0-57.128 23.688c8.068 18.122 4.683 40.104-10.181 54.97-9.631 9.631-22.25 14.443-34.871 14.443a49.429 49.429 0 0 1-20.083-4.255A196.273 196.273 0 0 0 64 209.984c18.509 7.112 31.652 25.049 31.652 46.062 0 21.008-13.132 38.936-31.63 46.054a196.318 196.318 0 0 0 23.692 57.128 49.428 49.428 0 0 1 20.032-4.232c12.622 0 25.239 4.812 34.871 14.443 14.841 14.841 18.239 36.781 10.215 54.889a196.257 196.257 0 0 0 57.13 23.673c7.128-18.479 25.046-31.596 46.038-31.596 20.992 0 38.91 13.115 46.037 31.596a196.234 196.234 0 0 0 57.132-23.675c-8.023-18.106-4.626-40.046 10.216-54.887 9.629-9.632 22.248-14.444 34.868-14.444 6.836 0 13.67 1.411 20.033 4.233a196.318 196.318 0 0 0 23.692-57.128c-18.498-7.119-31.629-25.048-31.629-46.054zM256.9 335.9c-44.3 0-80-35.9-80-80 0-44.101 35.7-80 80-80 44.299 0 80 35.899 80 80 0 44.1-35.701 80-80 80z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-arrow-expand\"><path d=\"M274 209.7l63.9-63.8L288 96h128v128l-49.9-49.9-63.8 63.9zM274 302.3l63.9 63.8L288 416h128V288l-49.9 49.9-63.8-63.9zM238 302.3l-63.9 63.8L224 416H96V288l49.9 49.9 63.8-63.9zM238 209.7l-63.9-63.8L224 96H96v128l49.9-49.9 63.8 63.9z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-expand\"><path d=\"M396.795 396.8H320V448h128V320h-51.205zM396.8 115.205V192H448V64H320v51.205zM115.205 115.2H192V64H64v128h51.205zM115.2 396.795V320H64v128h128v-51.205z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-arrow-move\"><path d=\"M480 256l-96-96v76H276V128h76l-96-96-96 96h76v108H128v-76l-96 96 96 96v-76h108v108h-76l96 96 96-96h-76.2l-.4-108.5 108.6.3V352z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-drag\"><path d=\"M0 144h512v32H0zM0 240h512v32H0zM0 336h512v32H0z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-link\"><path d=\"M74.6 256c0-38.3 31.1-69.4 69.4-69.4h88V144h-88c-61.8 0-112 50.2-112 112s50.2 112 112 112h88v-42.6h-88c-38.3 0-69.4-31.1-69.4-69.4zm85.4 22h192v-44H160v44zm208-134h-88v42.6h88c38.3 0 69.4 31.1 69.4 69.4s-31.1 69.4-69.4 69.4h-88V368h88c61.8 0 112-50.2 112-112s-50.2-112-112-112z\"/></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-contrast\"><path d=\"M256 32C132.3 32 32 132.3 32 256s100.3 224 224 224 224-100.3 224-224S379.7 32 256 32zm135.8 359.8C355.5 428 307 448 256 448V64c51 0 99.5 20 135.8 56.2C428 156.5 448 204.7 448 256c0 51.3-20 99.5-56.2 135.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-plus-empty\"><path d=\"M384 265H264v119h-17V265H128v-17h119V128h17v120h120v17z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-up\"><path d=\"M349.7 189.8c-3.1 3.1-8 3-11.3 0L264 123.4V408c0 4.4-3.6 8-8 8s-8-3.6-8-8V123.4l-74.4 66.3c-3.4 2.9-8.1 3.2-11.2.1-3.1-3.1-3.3-8.5-.1-11.4 0 0 87-79.2 88-80s2.8-2.4 5.7-2.4 4.9 1.6 5.7 2.4 88 80 88 80c1.5 1.5 2.3 3.6 2.3 5.7s-.8 4.1-2.3 5.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-down\"><path d=\"M349.7 322.2c-3.1-3.1-8-3-11.3 0L264 388.6V104c0-4.4-3.6-8-8-8s-8 3.6-8 8v284.6l-74.4-66.3c-3.4-2.9-8.1-3.2-11.2-.1-3.1 3.1-3.3 8.5-.1 11.4 0 0 87 79.2 88 80s2.8 2.4 5.7 2.4 4.9-1.6 5.7-2.4 88-80 88-80c1.5-1.5 2.3-3.6 2.3-5.7s-.8-4.1-2.3-5.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-left\"><path d=\"M189.8 349.7c3.1-3.1 3-8 0-11.3L123.4 264H408c4.4 0 8-3.6 8-8s-3.6-8-8-8H123.4l66.3-74.4c2.9-3.4 3.2-8.1.1-11.2-3.1-3.1-8.5-3.3-11.4-.1 0 0-79.2 87-80 88S96 253.1 96 256s1.6 4.9 2.4 5.7 80 88 80 88c1.5 1.5 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-right\"><path d=\"M322.2 349.7c-3.1-3.1-3-8 0-11.3l66.4-74.4H104c-4.4 0-8-3.6-8-8s3.6-8 8-8h284.6l-66.3-74.4c-2.9-3.4-3.2-8.1-.1-11.2 3.1-3.1 8.5-3.3 11.4-.1 0 0 79.2 87 80 88s2.4 2.8 2.4 5.7-1.6 4.9-2.4 5.7-80 88-80 88c-1.5 1.5-3.6 2.3-5.7 2.3s-4.1-.8-5.7-2.3z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-close-empty\"><path d=\"M340.2 160l-84.4 84.3-84-83.9-11.8 11.8 84 83.8-84 83.9 11.8 11.7 84-83.8 84.4 84.2 11.8-11.7-84.4-84.3 84.4-84.2z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-more-vertical\"><path d=\"M296 136c0-22.002-17.998-40-40-40s-40 17.998-40 40 17.998 40 40 40 40-17.998 40-40zm0 240c0-22.002-17.998-40-40-40s-40 17.998-40 40 17.998 40 40 40 40-17.998 40-40zm0-120c0-22.002-17.998-40-40-40s-40 17.998-40 40 17.998 40 40 40 40-17.998 40-40z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-quote\"><path d=\"M192 64c-40.646 0-72.483 11.229-94.627 33.373C75.229 119.517 64 151.354 64 192v256h160V192h-96c0-23.056 4.922-39.666 14.627-49.373C152.334 132.922 168.944 128 192 128M416 64c-40.646 0-72.483 11.229-94.627 33.373C299.229 119.517 288 151.354 288 192v256h160V192h-96c0-23.056 4.922-39.666 14.627-49.373C376.334 132.922 392.944 128 416 128\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-code\"><path d=\"M168 392a23.929 23.929 0 0 1-16.971-7.029l-112-112c-9.373-9.373-9.373-24.569 0-33.941l112-112c9.373-9.372 24.568-9.372 33.941 0 9.371 9.372 9.371 24.568 0 33.941L89.941 256l95.029 95.029c9.371 9.373 9.371 24.568 0 33.941A23.925 23.925 0 0 1 168 392zM344 392a23.929 23.929 0 0 0 16.971-7.029l112-112c9.373-9.373 9.373-24.569 0-33.941l-112-112c-9.373-9.372-24.568-9.372-33.941 0-9.371 9.372-9.371 24.568 0 33.941L422.059 256l-95.029 95.029c-9.371 9.373-9.371 24.568 0 33.941A23.925 23.925 0 0 0 344 392z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-camera\"><path d=\"M430.4 147h-67.5l-40.4-40.8s-.2-.2-.3-.2l-.2-.2c-6-6-14.1-9.8-23.3-9.8h-84c-9.8 0-18.5 4.2-24.6 10.9v.1l-39.5 40h-69C63 147 48 161.6 48 180.2v202.1c0 18.6 15 33.7 33.6 33.7h348.8c18.5 0 33.6-15.1 33.6-33.7V180.2c0-18.6-15.1-33.2-33.6-33.2zM256 365.5c-50.9 0-92.4-41.6-92.4-92.6 0-51.1 41.5-92.6 92.4-92.6 51 0 92.4 41.5 92.4 92.6 0 51-41.4 92.6-92.4 92.6zm168.1-165c-7.7 0-14-6.3-14-14.1s6.3-14.1 14-14.1 14 6.3 14 14.1-6.3 14.1-14 14.1z\"></path><path d=\"M256 202.9c-38.6 0-69.8 31.3-69.8 70 0 38.6 31.2 70 69.8 70 38.5 0 69.8-31.3 69.8-70s-31.3-70-69.8-70z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-move\"><path d=\"M475.9 246.2l-79.4-79.4c-5.4-5.4-14.2-5.4-19.6 0l-.2.2c-5.4 5.4-5.4 14.2 0 19.6l54.9 54.9-161.8.5.5-161.8 54.9 54.9c5.4 5.4 14.2 5.4 19.6 0l.2-.2c5.4-5.4 5.4-14.2 0-19.6l-79.4-79.4c-5.4-5.4-14.2-5.4-19.6 0l-79.4 79.4c-5.4 5.4-5.4 14.2 0 19.6l.2.2c5.4 5.4 14.2 5.4 19.6 0l54.9-54.9.5 161.8-161.8-.5 54.9-54.9c5.4-5.4 5.4-14.2 0-19.6l-.2-.2c-5.4-5.4-14.2-5.4-19.6 0l-79.4 79.4c-5.4 5.4-5.4 14.2 0 19.6l79.4 79.4c5.4 5.4 14.2 5.4 19.6 0l.2-.2c5.4-5.4 5.4-14.2 0-19.6L80 270.5l161.8-.5-.5 161.8-54.9-54.9c-5.4-5.4-14.2-5.4-19.6 0l-.2.2c-5.4 5.4-5.4 14.2 0 19.6l79.4 79.4c5.4 5.4 14.2 5.4 19.6 0l79.4-79.4c5.4-5.4 5.4-14.2 0-19.6l-.2-.2c-5.4-5.4-14.2-5.4-19.6 0l-54.9 54.9-.5-161.8 161.8.5-54.9 54.9c-5.4 5.4-5.4 14.2 0 19.6l.2.2c5.4 5.4 14.2 5.4 19.6 0l79.4-79.4c5.5-5.4 5.5-14.2 0-19.6z\"/></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-ok\">\n                <rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" />\n                <g transform=\"matrix(1,0,0,1,1024.0,1024.0)\">\n                <path d=\"M330.323,493.628 L330.323,398.406 L-330.323,398.406 L-330.323,493.628 L330.323,493.628 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                <path d=\"M230.718,468.568 L328.59,468.568 L328.59,-599.718 L230.718,-599.718 L230.718,468.568 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                <path d=\"M-300.714,376.053 L-373.748,449.088 L-68.5805,754.255 L4.45387,681.221 L-300.714,376.053 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                <path d=\"M-9.9476e-14,216.241 L-73.0344,143.207 L-378.202,448.375 L-305.168,521.409 L-9.9476e-14,216.241 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                </g>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-grid\"><path d=\"M160 153.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM288 153.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM416 153.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5z\"></path><g><path d=\"M160 281.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM288 281.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM416 281.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5z\"></path></g><g><path d=\"M160 409.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM288 409.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM416 409.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5z\"></path></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-gear-b\"><path d=\"M448 294.4v-76.8h-42.8c-3.4-14.4-8.9-28-16.1-40.5l29.8-29.7-54.3-54.3-29.1 29.1c-12.6-7.7-26.4-13.5-41.1-17.3V64h-76.8v40.9c-14.7 3.8-28.5 9.7-41.1 17.3l-29.1-29.1-54.3 54.3 29.8 29.7c-7.2 12.5-12.6 26.1-16.1 40.5H64v76.8h44.1c3.8 13.7 9.5 26.6 16.7 38.6l-31.7 31.7 54.3 54.3 32.3-32.3c11.7 6.8 24.5 11.9 37.9 15.4v46h76.8v-46c13.5-3.5 26.2-8.6 37.9-15.4l32.3 32.3 54.3-54.3-31.6-31.7c7.2-11.9 12.9-24.8 16.7-38.6h44zm-192 15.4c-29.7 0-53.7-24.1-53.7-53.8s24-53.8 53.7-53.8 53.8 24.1 53.8 53.8-24.1 53.8-53.8 53.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-grid-view-outline\"><path d=\"M448 192v-16H336V64h-16v112H192V64h-16v112H64v16h112v128H64v16h112v112h16V336h128v112h16V336h112v-16H336V192h112zM320 320H192V192h128v128z\"></path></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-increase\"><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M852.574,595.004 L852.574,507.837 L-852.574,507.837 L-852.574,595.004 L852.574,595.004 Z \" /><path d=\"M852.574,224.232 L852.574,137.066 L-852.574,137.066 L-852.574,224.232 L852.574,224.232 Z \" /><path d=\"M852.574,-134.971 L852.574,-222.138 L-852.574,-222.138 L-852.574,-134.971 L852.574,-134.971 Z \" /><path d=\"M852.574,-505.743 L852.574,-592.909 L-852.574,-592.909 L-852.574,-505.743 L852.574,-505.743 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-decrease\"><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M509.832,595.004 L509.832,507.837 L-509.832,507.837 L-509.832,595.004 L509.832,595.004 Z \" /><path d=\"M509.832,224.232 L509.832,137.066 L-509.832,137.066 L-509.832,224.232 L509.832,224.232 Z \" /><path d=\"M509.832,-136.947 L509.832,-224.113 L-509.832,-224.113 L-509.832,-136.947 L509.832,-136.947 Z \" /><path d=\"M509.832,-505.743 L509.832,-592.909 L-509.832,-592.909 L-509.832,-505.743 L509.832,-505.743 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-strike\">\n                <g transform=\"matrix(1,0,0,1,1024.0,1024.0)\">\n                <path d=\"M298.298,-653.766 C292.151,-624.873 284.005,-605.663 273.862,-596.135 C263.719,-586.607 250.656,-581.842 234.673,-581.842 C220.535,-581.842 196.253,-589.526 161.828,-604.895 C87.4454,-637.475 17.0588,-653.766 -49.3321,-653.766 C-155.68,-653.766 -243.28,-621.339 -312.129,-556.485 C-380.979,-491.631 -415.404,-414.328 -415.404,-324.578 C-415.404,-272.94 -403.724,-225.606 -380.364,-182.575 C-357.005,-139.544 -322.733,-100.201 -277.551,-64.5467 C-232.368,-28.8923 -156.295,18.903 -49.3321,78.8392 C57.631,138.775 123.1,177.964 147.074,196.406 C182.729,223.455 209.008,252.654 225.913,284.005 C242.819,315.357 251.271,346.401 251.271,377.137 C251.271,432.463 228.987,480.412 184.419,520.984 C139.851,561.556 79.1465,581.842 2.30524,581.842 C-64.0856,581.842 -125.098,567.089 -180.731,537.582 C-236.364,508.075 -277.704,471.037 -304.753,426.469 C-331.801,381.901 -353.316,314.742 -369.299,224.991 L-403.417,224.991 L-403.417,653.766 L-369.299,653.766 C-364.996,624.873 -358.388,605.817 -349.474,596.596 C-340.561,587.375 -328.42,582.764 -313.051,582.764 C-297.068,582.764 -259.109,592.446 -199.173,611.81 C-139.236,631.174 -99.74,642.393 -80.6834,645.467 C-48.7174,651 -14.5998,653.766 21.6692,653.766 C137.239,653.766 231.753,619.495 305.214,550.952 C378.674,482.41 415.404,400.804 415.404,306.136 C415.404,256.343 403.878,208.701 380.826,163.211 C357.773,117.721 324.885,78.2244 282.161,44.7216 C239.438,11.2188 159.676,-36.8838 42.8774,-99.5863 C-100.355,-176.428 -191.027,-237.901 -229.141,-284.005 C-255.574,-315.357 -268.791,-350.089 -268.791,-388.202 C-268.791,-437.995 -247.89,-482.41 -206.088,-521.445 C-164.287,-560.48 -111.42,-579.998 -47.4879,-579.998 C9.06727,-579.998 63.7783,-565.552 116.645,-536.66 C169.512,-507.767 210.238,-468.732 238.823,-419.554 C267.408,-370.375 287.233,-304.292 298.298,-221.303 L332.415,-221.303 L332.415,-653.766 L298.298,-653.766 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" /><path d=\"M-530.954,-41.4477 L-530.954,41.4477 L530.954,41.4477 L530.954,-41.4477 L-530.954,-41.4477 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" /></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-undo\"><path d=\"M447.9 368.2c0-16.8 3.6-83.1-48.7-135.7-35.2-35.4-80.3-53.4-143.3-56.2V96L64 224l192 128v-79.8c40 1.1 62.4 9.1 86.7 20 30.9 13.8 55.3 44 75.8 76.6l19.2 31.2H448c0-10.1-.1-22.9-.1-31.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-redo\"><path d=\"M64 400h10.3l19.2-31.2c20.5-32.7 44.9-62.8 75.8-76.6 24.4-10.9 46.7-18.9 86.7-20V352l192-128L256 96v80.3c-63 2.8-108.1 20.7-143.3 56.2C60.4 285.2 64 351.5 64 368.2c.1 8.9 0 21.7 0 31.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-arrow-dropdown\"><path d=\"M128 192l128 128 128-128z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-social-twitter\"><path d=\"M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6-18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6.8 15 2.5 22.1-80.5-4-151.9-42.6-199.6-101.3-8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7-16-.4-31-4.8-44-12.1v1.2c0 47 33.4 86.1 77.7 95-8.1 2.2-16.7 3.4-25.5 3.4-6.2 0-12.3-.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3-33.1 26-74.9 41.5-120.3 41.5-7.8 0-15.5-.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-.1-8.4-.3-12.5C462.6 146 479 129 492 109.5z\"></path></symbol>\n            <symbol viewBox=\"0 0 24 24\" id=\"icon-zoom-in\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <circle cx=\"10\" cy=\"10\" r=\"7\"></circle>\n                <line x1=\"7\" y1=\"10\" x2=\"13\" y2=\"10\"></line>\n                <line x1=\"10\" y1=\"7\" x2=\"10\" y2=\"13\"></line>\n                <line x1=\"21\" y1=\"21\" x2=\"15\" y2=\"15\"></line>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-contract\"><path d=\"M64 371.2h76.795V448H192V320H64v51.2zm76.795-230.4H64V192h128V64h-51.205v76.8zM320 448h51.2v-76.8H448V320H320v128zm51.2-307.2V64H320v128h128v-51.2h-76.8z\"></path></symbol>\n            \n            <symbol viewBox=\"0 0 24 24\" id=\"icon-lock-off\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n                <line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" />\n                <path d=\"M19 19a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6a2 2 0 0 1 2 -2h4m4 0h2a2 2 0 0 1 2 2v2\" />\n                <circle cx=\"12\" cy=\"16\" r=\"1\" />\n                <path d=\"M8 11v-3m.712 -3.278a4 4 0 0 1 7.288 2.278v4\" />\n            </symbol>\n            <symbol viewBox=\"0 0 24 24\" id=\"icon-lock\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n                <rect x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\" />\n                <circle cx=\"12\" cy=\"16\" r=\"1\" />\n                <path d=\"M8 11v-4a4 4 0 0 1 8 0v4\" />\n            </symbol>\n            <symbol viewBox=\"0 0 24 24\" id=\"icon-code\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\"/>\n                <polyline points=\"7 8 3 12 7 16\" />\n                <polyline points=\"17 8 21 12 17 16\" />\n                <line x1=\"14\" y1=\"4\" x2=\"10\" y2=\"20\" />\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-cloud-upload-outline\">\n                <path d=\"M193.3 260.4l-11.6-11.6 74.5-74.3 74.5 74.3-11.7 11.6-54.6-54.6v241.8h-16.5V205.8z\"/>\n                <path d=\"M399.3 183.6c0-1.2.2-2.4.2-3.6 0-64.3-52.8-116.4-116.8-116.4-46.1 0-85.8 27.1-104.4 66.3-8.1-4.1-17.1-6.4-26.8-6.4-29.6 0-54.1 23.6-58.9 52C57.4 187.6 32 222.2 32 261.8c0 49.7 40.1 90.2 89.6 90.2H213v-16h-90.6c-40.9 0-74.2-33.5-74.2-74.6 0-31.8 20.2-61.2 50.2-71.6l8.4-2.9 1.5-8.8c3.6-21.6 22.1-39.3 43.9-39.3 6.9 0 13.7 1.6 19.9 4.8l13.5 6.8 6.5-13.7c16.6-34.9 52.1-57.4 90.4-57.4 55.3 0 100.9 43.3 100.9 98.9 0 13.3-.2 20.3-.2 20.3l15.2.1c36.6.5 65.6 33.4 65.6 70.3 0 36.8-29.8 66.9-66.5 67.1H297v16h101c45 0 82-37.3 82-82.8s-35.5-85.5-80.7-85.6z\"/>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-volume-medium\">\n                <path d=\"M270 407.7V104.4L175.3 192H71v128h104.3zm56.3-52.1c20.5-27.8 32.8-62.3 32.8-99.6 0-37.4-12.3-71.8-32.8-99.6l-20.4 15.3c17.4 23.6 27.8 52.7 27.8 84.3 0 31.6-10.4 60.7-27.8 84.3l20.4 15.3zm66.5 46c30-40.7 48-91 48-145.6s-18-104.9-48-145.6l-20.4 15.3c26.9 36.4 43 81.4 43 130.3 0 48.9-16.1 93.8-43 130.3l20.4 15.3z\"/>\n            </symbol>\n\n            <symbol id=\"icon-list-search\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M15 15m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0\"></path>\n                <path d=\"M18.5 18.5l2.5 2.5\"></path>\n                <path d=\"M4 6h16\"></path>\n                <path d=\"M4 12h4\"></path>\n                <path d=\"M4 18h4\"></path>\n            </symbol>\n            <symbol id=\"icon-folder-media\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2\"></path>\n\n                <path d=\"M12 20h-5a3 3 0 0 1 -3 -3v-10a3 3 0 0 1 3 -3h10a3 3 0 0 1 3 3v5\"></path>\n                <path d=\"M4 15l4 -4c.928 -.893 2.072 -.893 3 0l4 4\"></path>\n                <path d=\"M14 14l1 -1c.617 -.593 1.328 -.793 2.009 -.598\"></path>\n            </symbol>\n\n            <symbol id=\"icon-reload\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M19.933 13.041a8 8 0 1 1 -9.925 -8.788c3.899 -1.002 7.935 1.007 9.425 4.747\"></path>\n                <path d=\"M20 4v5h-5\"></path>\n            </symbol>\n            <symbol id=\"icon-devices\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <rect x=\"13\" y=\"8\" width=\"8\" height=\"12\" rx=\"1\"></rect>\n                <path d=\"M18 8v-3a1 1 0 0 0 -1 -1h-13a1 1 0 0 0 -1 1v12a1 1 0 0 0 1 1h9\"></path>\n                <line x1=\"16\" y1=\"9\" x2=\"18\" y2=\"9\"></line>\n            </symbol>  \n            <symbol id=\"icon-device-desktop\" viewBox=\"0 0 24 24\" stroke-width=\"1.2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <rect x=\"3\" y=\"4\" width=\"18\" height=\"12\" rx=\"1\"></rect>\n                <line x1=\"7\" y1=\"20\" x2=\"17\" y2=\"20\"></line>\n                <line x1=\"9\" y1=\"16\" x2=\"9\" y2=\"20\"></line>\n                <line x1=\"15\" y1=\"16\" x2=\"15\" y2=\"20\"></line>\n            </symbol>\n            <symbol id=\"icon-device-mobile\" viewBox=\"0 0 24 24\" stroke-width=\"1.2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <rect x=\"6\" y=\"3\" width=\"12\" height=\"18\" rx=\"2\"></rect>\n                <line x1=\"11\" y1=\"4\" x2=\"13\" y2=\"4\"></line>\n                <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"17.01\"></line>\n            </symbol>\n            <symbol id=\"icon-device-laptop\" viewBox=\"0 0 24 24\" stroke-width=\"1.2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <line x1=\"3\" y1=\"19\" x2=\"21\" y2=\"19\"></line>\n                <rect x=\"5\" y=\"6\" width=\"14\" height=\"10\" rx=\"1\"></rect>\n            </symbol>\n            <symbol id=\"icon-device-tablet\" viewBox=\"0 0 24 24\" stroke-width=\"1.2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <rect x=\"5\" y=\"3\" width=\"14\" height=\"18\" rx=\"1\"></rect>\n                <circle cx=\"12\" cy=\"17\" r=\"1\"></circle>\n            </symbol>\n\n            <symbol id=\"icon-fullview\" viewBox=\"0 0 24 24\" stroke-width=\"1.2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M4 8v-2a2 2 0 0 1 2 -2h2\"></path>\n                <path d=\"M4 16v2a2 2 0 0 0 2 2h2\"></path>\n                <path d=\"M16 4h2a2 2 0 0 1 2 2v2\"></path>\n                <path d=\"M16 20h2a2 2 0 0 0 2 -2v-2\"></path>\n            </symbol>\n\n            <symbol id=\"icon-eye\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0m13 0c-2.667 4.667 -6 7 -10 7s-7.333 -2.333 -10 -7c2.667 -4.667 6 -7 10 -7s7.333 2.333 10 7\"></path>\n            </symbol>\n            <symbol id=\"icon-eye-off\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M9.88 9.878a3 3 0 1 0 4.243 4.242m.581 -3.42a3.012 3.012 0 0 0 -1.45 -1.426m-3.877 -3.913a9.469 9.469 0 0 1 2.623 -.361c4 0 7.333 2.333 10 7c-.778 1.362 -1.613 2.524 -2.504 3.489m-2.138 1.859c-1.629 1.101 -3.415 1.652 -5.358 1.652c-4 0 -7.333 -2.333 -10 -7c1.374 -2.404 2.924 -4.189 4.652 -5.354m-3.652 -3.646l18 18\"></path>\n            </symbol>\n\n            <symbol id=\"icon-download\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2\"></path>\n                <path d=\"M7 11l5 5l5 -5\"></path>\n                <path d=\"M12 4l0 12\"></path>\n            </symbol>\n\n            <symbol id=\"icon-message-search\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M8 9h8\"></path>\n                <path d=\"M8 13h5\"></path>\n                <path d=\"M12 21l-.5 -.5l-2.5 -2.5h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v4.5\"></path>\n                <path d=\"M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0\"></path>\n                <path d=\"M20.2 20.2l1.8 1.8\"></path>\n            </symbol>\n\n            <symbol id=\"icon-folder-old\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2\"></path>\n            </symbol>\n            <symbol id=\"icon-folder\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M11 19h-6a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2.5\"></path>\n                <path d=\"M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0\"></path>\n                <path d=\"M20.2 20.2l1.8 1.8\"></path>\n            </symbol>\n            <symbol id=\"icon-folder2\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M11 19h-6a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2.5\"></path>\n                <path d=\"M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0\"></path>\n                <path d=\"M20.2 20.2l1.8 1.8\"></path>\n            </symbol>\n            <symbol id=\"icon-message\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M8 9h8\"></path>\n                <path d=\"M8 13h6\"></path>\n                <path d=\"M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z\"></path>\n            </symbol>\n            \n            <symbol id=\"icon-undo\" viewBox=\"0 0 512 512\">\n                <path d=\"M447.9 368.2c0-16.8 3.6-83.1-48.7-135.7-35.2-35.4-80.3-53.4-143.3-56.2V96L64 224l192 128v-79.8c40 1.1 62.4 9.1 86.7 20 30.9 13.8 55.3 44 75.8 76.6l19.2 31.2H448c0-10.1-.1-22.9-.1-31.8z\"></path>\n            </symbol>\n            <symbol id=\"icon-redo\" viewBox=\"0 0 512 512\">\n                <path d=\"M64 400h10.3l19.2-31.2c20.5-32.7 44.9-62.8 75.8-76.6 24.4-10.9 46.7-18.9 86.7-20V352l192-128L256 96v80.3c-63 2.8-108.1 20.7-143.3 56.2C60.4 285.2 64 351.5 64 368.2c.1 8.9 0 21.7 0 31.8z\"></path>\n            </symbol>\n            \n\n            <symbol id=\"icon-undo2\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M9 14l-4 -4l4 -4\"></path>\n                <path d=\"M5 10h11a4 4 0 1 1 0 8h-1\"></path>\n            </symbol>\n            <symbol id=\"icon-redo2\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M15 14l4 -4l-4 -4\"></path>\n                <path d=\"M19 10h-11a4 4 0 1 0 0 8h1\"></path>\n            </symbol>\n            <symbol id=\"icon-save\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2\"></path>\n                <path d=\"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0\"></path>\n                <path d=\"M14 4l0 4l-6 0l0 -4\"></path>\n            </symbol>\n            <symbol id=\"icon-back\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M9 14l-4 -4l4 -4\"></path>\n                <path d=\"M5 10h11a4 4 0 1 1 0 8h-1\"></path>\n            </symbol>\n            <symbol id=\"icon-publish\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\"></path>\n                <path d=\"M9 12l2 2l4 -4\"></path>\n            </symbol>\n\n            <symbol id=\"icon-align-box-top\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n                <path d=\"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z\" />\n                <path d=\"M15 10h-7\" />\n                <path d=\"M15 7h-7\" />\n            </symbol>\n            <symbol id=\"icon-align-box-middle\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n                <path d=\"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z\" />\n                <path d=\"M15 13h-7\" />\n                <path d=\"M15 10h-7\" />\n            </symbol>\n            <symbol id=\"icon-align-box-bottom\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path d=\"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z\" />\n                <path d=\"M15 17h-7\" />\n                <path d=\"M15 14h-7\" />\n            </symbol>\n            <symbol id=\"icon-align-box-stretch\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n                <path d=\"M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z\" />\n                <path d=\"M15 17h-7\" />\n                <path d=\"M15 7h-7\" />\n            </symbol>\n\n            <symbol id=\"icon-align-box-left\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z\" /><path d=\"M9 15h-2\" /><path d=\"M13 12h-6\" /><path d=\"M11 9h-4\" />\n            </symbol>\n            <symbol id=\"icon-align-box-center\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M3 19v-14a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z\" /><path d=\"M11 15h2\" /><path d=\"M9 12h6\" /><path d=\"M10 9h4\" />\n            </symbol>\n            <symbol id=\"icon-align-box-right\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M15 15h2\" /><path d=\"M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z\" /><path d=\"M11 12h6\" /><path d=\"M13 9h4\" />\n            </symbol>\n\n            <symbol id=\"icon-stack-forward\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 5l-8 4l8 4l8 -4l-8 -4\" fill=\"currentColor\" /><path d=\"M10 12l-6 3l8 4l8 -4l-6 -3\" />\n            </symbol>\n            <symbol id=\"icon-stack-backward\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M14 12l6 -3l-8 -4l-8 4l6 3\" /><path d=\"M10 12l-6 3l8 4l8 -4l-6 -3l-2 1z\" fill=\"currentColor\" />\n            </symbol>\n            <symbol id=\"icon-arrow-down\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path d=\"M12 5l0 14\" /><path d=\"M18 13l-6 6\" /><path d=\"M6 13l6 6\" />\n            </symbol>\n            <symbol id=\"icon-arrow-up\" viewBox=\"0 0 24 24\" stroke-width=\"1.4\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path d=\"M12 5l0 14\" /><path d=\"M18 11l-6 -6\" /><path d=\"M6 11l6 -6\" />\n            </symbol>\n\n            <symbol id=\"icon-group\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16 16v2a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h2v-2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-2\" />\n            </symbol>\n            <symbol id=\"icon-ungroup\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M8 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z\" /><path d=\"M4 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z\" />\n            </symbol>\n\n            <symbol id=\"icon-group2\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M4 6v-1a1 1 0 0 1 1 -1h1m5 0h2m5 0h1a1 1 0 0 1 1 1v1m0 5v2m0 5v1a1 1 0 0 1 -1 1h-1m-5 0h-2m-5 0h-1a1 1 0 0 1 -1 -1v-1m0 -5v-2\" />\n            </symbol>\n            <symbol id=\"icon-group3\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16 16v2a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h2v-2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-2\" /><path d=\"M10 8l-2 0l0 2\" /><path d=\"M8 14l0 2l2 0\" /><path d=\"M14 8l2 0l0 2\" /><path d=\"M16 14l0 2l-2 0\" />\n            </symbol>\n            <symbol id=\"icon-group4\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M7 19a2 2 0 0 1 -2 -2\" /><path d=\"M5 13v-2\" /><path d=\"M5 7a2 2 0 0 1 2 -2\" /><path d=\"M11 5h2\" /><path d=\"M17 5a2 2 0 0 1 2 2\" /><path d=\"M19 11v2\" /><path d=\"M19 17v4\" /><path d=\"M21 19h-4\" /><path d=\"M13 19h-2\" />\n            </symbol>\n            <symbol id=\"icon-ungroup2\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M4 6c0 -.556 .227 -1.059 .593 -1.421\" /><path d=\"M9 4h1.5\" /><path d=\"M13.5 4h1.5\" /><path d=\"M18 4a2 2 0 0 1 2 2\" /><path d=\"M20 9v1.5\" /><path d=\"M20 13.5v1.5\" /><path d=\"M19.402 19.426a1.993 1.993 0 0 1 -1.402 .574\" /><path d=\"M15 20h-1.5\" /><path d=\"M10.5 20h-1.5\" /><path d=\"M6 20a2 2 0 0 1 -2 -2\" /><path d=\"M4 15v-1.5\" /><path d=\"M4 10.5v-1.5\" /><path d=\"M3 3l18 18\" />\n            </symbol>\n            <symbol id=\"icon-ungroup3\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M15 16.572v2.42a2.01 2.01 0 0 1 -2.009 2.008h-7.981a2.01 2.01 0 0 1 -2.01 -2.009v-7.981a2.01 2.01 0 0 1 2.009 -2.01h2.954\" /><path d=\"M9.167 4.511a2.04 2.04 0 0 1 2.496 -1.441l7.826 2.097a2.04 2.04 0 0 1 1.441 2.496l-2.097 7.826a2.04 2.04 0 0 1 -2.496 1.441l-7.827 -2.097a2.04 2.04 0 0 1 -1.441 -2.496l2.098 -7.827z\" />\n            </symbol>\n\n            <symbol id=\"icon-duplicate\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M15 16.572v2.42a2.01 2.01 0 0 1 -2.009 2.008h-7.981a2.01 2.01 0 0 1 -2.01 -2.009v-7.981a2.01 2.01 0 0 1 2.009 -2.01h2.954\" /><path d=\"M9.167 4.511a2.04 2.04 0 0 1 2.496 -1.441l7.826 2.097a2.04 2.04 0 0 1 1.441 2.496l-2.097 7.826a2.04 2.04 0 0 1 -2.496 1.441l-7.827 -2.097a2.04 2.04 0 0 1 -1.441 -2.496l2.098 -7.827z\" />\n            </symbol>\n            <symbol id=\"icon-duplicate2\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M7 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z\" /><path d=\"M17 17v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h2\" />\n            </symbol>\n\n            <symbol id=\"icon-trash\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M4 7l16 0\"></path>\n                <path d=\"M10 11l0 6\"></path>\n                <path d=\"M14 11l0 6\"></path>\n                <path d=\"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12\"></path>\n                <path d=\"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3\"></path>\n            </symbol>\n            <symbol id=\"icon-chevron-down\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M6 9l6 6l6 -6\"></path>\n            </symbol>\n\n\n            <symbol id=\"icon-settings\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z\"></path>\n                <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n            </symbol>\n\n            <symbol id=\"icon-microphone\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M9 2m0 3a3 3 0 0 1 3 -3h0a3 3 0 0 1 3 3v5a3 3 0 0 1 -3 3h0a3 3 0 0 1 -3 -3z\"></path>\n                <path d=\"M5 10a7 7 0 0 0 14 0\"></path>\n                <path d=\"M8 21l8 0\"></path>\n                <path d=\"M12 17l0 4\"></path>\n            </symbol>\n            <symbol id=\"icon-microphone-off\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M3 3l18 18\"></path>\n                <path d=\"M9 5a3 3 0 0 1 6 0v5a3 3 0 0 1 -.13 .874m-2 2a3 3 0 0 1 -3.87 -2.872v-1\"></path>\n                <path d=\"M5 10a7 7 0 0 0 10.846 5.85m2 -2a6.967 6.967 0 0 0 1.152 -3.85\"></path>\n                <path d=\"M8 21l8 0\"></path>\n                <path d=\"M12 17l0 4\"></path>\n            </symbol>\n            <symbol id=\"icon-eraser\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3\"></path>\n                <path d=\"M18 13.3l-6.3 -6.3\"></path>\n            </symbol>\n            <symbol id=\"icon-snippets\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M19 8h-14\" /><path d=\"M5 12h9\" /><path d=\"M11 16h-6\" /><path d=\"M15 16h6\" /><path d=\"M18 13v6\" />\n            </symbol>\n            <symbol id=\"icon-svg\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path d=\"M21 8h-2a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2v-4h-1\" /><path d=\"M7 8h-3a1 1 0 0 0 -1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-3\" /><path d=\"M10 8l1.5 8h1l1.5 -8\" />\n            </symbol>\n\n            <symbol id=\"icon-pagesize\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M6 4h11a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-11a1 1 0 0 1 -1 -1v-14a1 1 0 0 1 1 -1m3 0v18\" /><path d=\"M13 8l2 0\" /><path d=\"M13 12l2 0\" />\n            </symbol>\n            <symbol id=\"icon-print\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path d=\"M17 17h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-14a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2\" /><path d=\"M17 9v-4a2 2 0 0 0 -2 -2h-6a2 2 0 0 0 -2 2v4\" /><path d=\"M7 13m0 2a2 2 0 0 1 2 -2h6a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-6a2 2 0 0 1 -2 -2z\" />\n            </symbol>\n\n            <symbol id=\"icon-plus\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line>\n                <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line>\n            </symbol>\n            <symbol id=\"icon-plus2\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M12 5l0 14\"></path>\n                <path d=\"M5 12l14 0\"></path>\n            </symbol>\n        </svg>";
  builder.dom.appendHtml(builder.builderStuff, html);
};
/* harmony default export */ const svgicons = (prepareSvgIcons);
;// CONCATENATED MODULE: ./src/contentbuilder/grid.js
function grid_typeof(obj) { "@babel/helpers - typeof"; return grid_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, grid_typeof(obj); }
function grid_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function grid_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, grid_toPropertyKey(descriptor.key), descriptor); } }
function grid_createClass(Constructor, protoProps, staticProps) { if (protoProps) grid_defineProperties(Constructor.prototype, protoProps); if (staticProps) grid_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function grid_toPropertyKey(arg) { var key = grid_toPrimitive(arg, "string"); return grid_typeof(key) === "symbol" ? key : String(key); }
function grid_toPrimitive(input, hint) { if (grid_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (grid_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Grid = /*#__PURE__*/function () {
  function Grid(builder) {
    grid_classCallCheck(this, Grid);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
    this.rowTool = new RowTool(builder);
  }
  grid_createClass(Grid, [{
    key: "moveColumnPrevious",
    value: function moveColumnPrevious() {
      var util = this.util;
      var cell = util.cellSelected();
      if (!cell) return;
      if (cell.previousElementSibling) {
        this.builder.uo.saveForUndo();
        cell.parentElement.insertBefore(cell, cell.previousElementSibling);
        this.builder.opts.onChange();
      }
    }
  }, {
    key: "moveColumnNext",
    value: function moveColumnNext() {
      var util = this.util;
      var cell = util.cellSelected();
      if (!cell) return;
      var cellnext = util.cellNext(cell);
      if (cellnext) {
        this.builder.uo.saveForUndo();
        cell.parentElement.insertBefore(cellnext, cell);
        this.builder.opts.onChange();
      }
    }
  }, {
    key: "moveColumnUp",
    value: function moveColumnUp() {
      var builder = this.builder;
      var util = this.util;
      var cell = util.cellSelected();
      if (!cell) return;
      var row = cell.parentNode;
      var num = 3; //is-row-tool, is-col-tool & is-rowadd-tool
      if (row.querySelector('.is-row-overlay')) {
        num = 4; //is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
      }

      if (row.childElementCount - num === 1) {
        //-num => minus is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
        if (row.previousElementSibling) {
          var maxCols = 4;
          if (this.builder.maxColumns) {
            maxCols = this.builder.maxColumns;
          }
          if (row.previousElementSibling.childElementCount >= maxCols + num || row.previousElementSibling.hasAttribute('data-protected')) {
            //+2 => includes is-row-tool & is-rowaddtool

            this.builder.uo.saveForUndo();

            //Move row up
            row.parentNode.insertBefore(row, row.previousElementSibling);
            this.builder.opts.onChange();
            return;
          } else {
            this.builder.uo.saveForUndo();

            //Add inside prev row
            var tool = row.previousElementSibling.querySelector('.is-row-tool');
            row.previousElementSibling.removeChild(tool); //remove next row tool
            tool = row.previousElementSibling.querySelector('.is-rowadd-tool');
            row.previousElementSibling.removeChild(tool); //remove
            tool = row.previousElementSibling.querySelector('.is-col-tool');
            row.previousElementSibling.removeChild(tool); //remove

            row.previousElementSibling.appendChild(cell); //add

            row.parentNode.removeChild(row); //remove current (empty) row (including its overlay)

            //re-add tool
            var builderActive = this.builder.doc.querySelector('.builder-active');
            builder.applyBehaviorOn(builderActive);
            setTimeout(function () {
              cell.click(); //refresh active cell/row
            }, 30);
            this.builder.opts.onChange();
          }
        } else {
          //move outside container (move to previous container)
          return;
        }
      } else {
        this.builder.uo.saveForUndo();
        var rowElement = row.cloneNode(true);
        rowElement.innerHTML = '';
        rowElement.appendChild(cell);
        row.parentNode.insertBefore(rowElement, row);

        //re-add tool
        var _builderActive = this.builder.doc.querySelector('.builder-active');
        builder.applyBehaviorOn(_builderActive);
        setTimeout(function () {
          cell.click(); //refresh active cell/row
        }, 30);
        this.builder.opts.onChange();
      }

      //fix layout
      row = cell.parentNode; //update active row
      util.fixLayout(row);
      if (row.nextElementSibling) util.fixLayout(row.nextElementSibling);
    }
  }, {
    key: "moveColumnDown",
    value: function moveColumnDown() {
      var builder = this.builder;
      var util = this.util;
      var dom = this.dom;
      var cell = util.cellSelected();
      if (!cell) return;
      var row = cell.parentNode;
      var num = 3; //is-row-tool, is-col-tool & is-rowadd-tool
      if (row.querySelector('.is-row-overlay')) {
        num = 4; //is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
      }

      if (row.childElementCount - num === 1) {
        //-2 => minus is-row-tool & is-rowadd-tool

        if (row.nextElementSibling) {
          var maxCols = 4;
          if (this.builder.maxColumns) {
            maxCols = this.builder.maxColumns;
          }
          if (row.nextElementSibling.childElementCount >= maxCols + num || row.nextElementSibling.hasAttribute('data-protected')) {
            //+2 => includes is-row-tool & is-rowadd-tool

            this.builder.uo.saveForUndo();

            //Move row down
            row.parentNode.insertBefore(row.nextElementSibling, row);
            this.builder.opts.onChange();
            return;
          } else {
            this.builder.uo.saveForUndo();

            //Add inside next row
            var tool = row.nextElementSibling.querySelector('.is-row-tool');
            row.nextElementSibling.removeChild(tool); //remove next row tool
            tool = row.nextElementSibling.querySelector('.is-rowadd-tool');
            row.nextElementSibling.removeChild(tool); //remove
            tool = row.nextElementSibling.querySelector('.is-col-tool');
            row.nextElementSibling.removeChild(tool); //remove

            row.nextElementSibling.appendChild(cell); //add

            row.parentNode.removeChild(row); //remove current (empty) row (including its overlay)

            //re-add tool
            var builderActive = this.builder.doc.querySelector('.builder-active');
            builder.applyBehaviorOn(builderActive);
            setTimeout(function () {
              cell.click(); //refresh active cell/row
            }, 30);
            this.builder.opts.onChange();
          }
        } else {
          //move outside container (move to next container)
          return;
        }
      } else {
        this.builder.uo.saveForUndo();
        var rowElement = row.cloneNode(true);
        rowElement.innerHTML = '';
        rowElement.appendChild(cell);
        dom.moveAfter(rowElement, row);

        //re-add tool
        var _builderActive2 = this.builder.doc.querySelector('.builder-active');
        builder.applyBehaviorOn(_builderActive2);
        setTimeout(function () {
          cell.click(); //refresh active cell/row
        }, 30);
        this.builder.opts.onChange();
      }

      //fix layout
      row = cell.parentNode; //update active row
      util.fixLayout(row);
      if (row.previousElementSibling) util.fixLayout(row.previousElementSibling);
    }
  }, {
    key: "duplicateColumn",
    value: function duplicateColumn() {
      var builder = this.builder;
      var util = this.util;
      var dom = this.dom;
      var cell = util.cellSelected();
      if (!cell) return;
      this.builder.uo.saveForUndo();
      var cellElement = cell.cloneNode(true);
      dom.removeClass(cellElement, 'cell-active');
      cellElement.removeAttribute('data-click');
      if (this.builder.opts.enableDragResize) {
        cell.style.width = '';
        cell.style.flex = '';
      }
      var row = cell.parentNode;
      var num = 3;
      if (row.querySelector('.is-row-overlay')) {
        num = 4;
      }
      var maxCols = 4;
      if (this.builder.maxColumns) {
        maxCols = this.builder.maxColumns;
      }
      if (row.childElementCount >= maxCols + num) {
        alert(util.out('You have reached the maximum number of columns'));
        return false;
      }
      row.insertBefore(cellElement, cell);
      util.fixLayout(row);

      //re-add tool
      var builderActive = this.builder.doc.querySelector('.builder-active');
      builder.applyBehaviorOn(builderActive);
      setTimeout(function () {
        cell.click(); //refresh active cell/row
      }, 30);
      this.builder.opts.onChange();
    }
  }, {
    key: "removeColumn",
    value: function removeColumn() {
      var _this = this;
      var util = this.util;
      var cell = util.cellSelected();
      if (!cell) return;
      var row = cell.parentNode;
      var num = 3;
      if (row.querySelector('.is-row-overlay')) {
        num = 4;
      }
      util.confirm(util.out('Are you sure you want to delete this block?'), function (ok) {
        if (ok) {
          _this.builder.uo.saveForUndo();
          if (row.childElementCount - num === 1) {
            row.parentNode.removeChild(row);
            util.checkEmpty();
          } else {
            row.removeChild(cell);
            util.fixLayout(row);
          }
          util.clearActiveCell();
          _this.builder.opts.onChange();
        }
      });
    }
  }, {
    key: "removeColClasses",
    value: function removeColClasses(cell) {
      cell.classList.remove('full');
      cell.classList.remove('two-third');
      cell.classList.remove('two-fourth');
      cell.classList.remove('two-fifth');
      cell.classList.remove('two-sixth');
      cell.classList.remove('half');
      cell.classList.remove('third');
      cell.classList.remove('fourth');
      cell.classList.remove('fifth');
      cell.classList.remove('sixth');
      cell.classList.remove('seventh');
      cell.classList.remove('eighth');
      cell.classList.remove('ninth');
      cell.classList.remove('tenth');
      cell.classList.remove('eleventh');
      cell.classList.remove('twelfth');
    }
  }, {
    key: "getAllColumns",
    value: function getAllColumns(cell) {
      var arrCells = [];
      var dom = this.dom;
      var cols = dom.elementChildren(cell.parentNode);
      cols.forEach(function (col) {
        if (dom.hasClass(col, 'is-row-tool') || dom.hasClass(col, 'is-col-tool') || dom.hasClass(col, 'is-rowadd-tool') || dom.hasClass(col, 'is-row-overlay')) return;
        if (cell !== col) {
          arrCells.push(col);
        }
      });
      var newArray = [cell].concat(arrCells);
      return newArray;
    }
  }, {
    key: "getCellWidth",
    value: function getCellWidth(cell) {
      if (cell.classList.contains('two-third')) {
        return 66.666;
      }
      if (cell.classList.contains('two-fourth')) {
        return 75;
      }
      if (cell.classList.contains('two-fifth')) {
        return 80;
      }
      if (cell.classList.contains('two-sixth')) {
        return 83.333;
      }
      if (cell.classList.contains('half')) {
        return 50;
      }
      if (cell.classList.contains('third')) {
        return 33.333;
      }
      if (cell.classList.contains('fourth')) {
        return 25;
      }
      if (cell.classList.contains('fifth')) {
        return 20;
      }
      if (cell.classList.contains('sixth')) {
        return 16.666;
      }
      if (cell.classList.contains('seventh')) {
        return 14.2857;
      }
      if (cell.classList.contains('eighth')) {
        return 12.5;
      }
      if (cell.classList.contains('ninth')) {
        return 11.111;
      }
      if (cell.classList.contains('tenth')) {
        return 10;
      }
      if (cell.classList.contains('eleventh')) {
        return 9.09;
      }
      if (cell.classList.contains('twelfth')) {
        return 8.333;
      }
      return false;
    }
  }, {
    key: "resizeColumn",
    value: function resizeColumn(cell, increase, num) {
      var cellWidth = this.getCellWidth(cell);
      if (!cellWidth) {
        var cellW = parseFloat(window.getComputedStyle(cell).getPropertyValue('width'));
        var rowW = parseFloat(window.getComputedStyle(cell.parentNode).getPropertyValue('width'));
        cellWidth = cellW / rowW * 100;
      }
      if (increase) {
        if (num === 3) {
          if (cellWidth >= 28 && cellWidth <= 30) {
            return '33.333%';
          } else if (cellWidth > 30 && cellWidth < 38) {
            return '40%';
          }
          //max 80%
          if (cellWidth >= 68 && cellWidth <= 90) {
            return '75%';
          }
        }
        if (num === 4) {
          //max 70%
          if (cellWidth >= 48 && cellWidth <= 90) {
            return '60%';
          }
        }
        if (num === 5) {
          //max 50%
          if (cellWidth >= 38 && cellWidth <= 90) {
            return '50%';
          }
        }
        if (num === 6) {
          if (cellWidth >= 10 && cellWidth < 13) {
            return '16.666%';
          }
          //max 40%
          if (cellWidth >= 28 && cellWidth <= 90) {
            return '40%';
          }
        }
        if (num === 7) {
          //max 30%
          if (cellWidth >= 23 && cellWidth <= 90) {
            return '30%';
          }
        }
        if (num === 8) {
          //max 20%
          if (cellWidth >= 13 && cellWidth <= 90) {
            return '20%';
          }
        }
        if (cellWidth >= 78 && cellWidth <= 90) {
          return '90%';
        } else if (cellWidth >= 73 && cellWidth < 78) {
          return '80%';
        } else if (cellWidth >= 68 && cellWidth < 73) {
          return '75%';
        } else if (cellWidth >= 58 && cellWidth < 68) {
          return '70%';
        } else if (cellWidth >= 48 && cellWidth < 58) {
          return '60%';
        } else if (cellWidth >= 38 && cellWidth < 48) {
          return '50%';
        } else if (cellWidth >= 28 && cellWidth < 38) {
          return '40%';
        } else if (cellWidth >= 23 && cellWidth < 28) {
          return '30%';
        } else if (cellWidth >= 18 && cellWidth < 23) {
          return '25%';
        } else if (cellWidth >= 13 && cellWidth < 18) {
          return '20%';
        } else if (cellWidth >= 10 && cellWidth < 13) {
          return '15%';
        }
      } else {
        // decrease

        if (num === 3) {
          if (cellWidth > 35 && cellWidth <= 43) {
            return '33.333%';
          }
          if (cellWidth > 33 && cellWidth <= 35) {
            return '30%';
          }
        }
        if (num === 6) {
          if (cellWidth > 18 && cellWidth <= 23) {
            return '16.666%';
          }
        }
        if (cellWidth > 93 && cellWidth <= 100) {
          return '90%';
        } else if (cellWidth > 83 && cellWidth <= 93) {
          return '80%';
        } else if (cellWidth > 78 && cellWidth <= 83) {
          return '75%';
        } else if (cellWidth > 73 && cellWidth <= 78) {
          return '70%';
        } else if (cellWidth > 63 && cellWidth <= 73) {
          return '60%';
        } else if (cellWidth > 53 && cellWidth <= 63) {
          return '50%';
        } else if (cellWidth > 43 && cellWidth <= 53) {
          return '40%';
        } else if (cellWidth > 33 && cellWidth <= 43) {
          return '30%';
        } else if (cellWidth > 28 && cellWidth <= 33) {
          return '25%';
        } else if (cellWidth > 23 && cellWidth <= 28) {
          return '20%';
        } else if (cellWidth > 18 && cellWidth <= 23) {
          return '15%';
        } else if (cellWidth >= 10 && cellWidth <= 18) {
          return '10%';
        }
      }
      return false;
    }
  }, {
    key: "increaseColumn",
    value: function increaseColumn() {
      var builder = this.builder;
      var util = this.util;
      var dom = this.dom;
      var cell = util.cellSelected();
      if (!cell) return;
      if (this.builder.useDefaultGrid) {
        var _arrColumns = this.getAllColumns(cell);
        if (_arrColumns.length > 1 && _arrColumns.length < 9) {
          this.builder.uo.saveForUndo();
          var w = this.resizeColumn(cell, true, _arrColumns.length);
          if (w) {
            cell.style.width = w;
            cell.style.flex = '0 0 auto';
            this.removeColClasses(cell);
            for (var i = 1; i < _arrColumns.length; i++) {
              var cellNext = _arrColumns[i];
              if (cellNext !== cell) {
                // cellNext.style.width = '';
                // cellNext.style.flex = '';
                if (!cellNext.getAttribute('data-html')) {
                  cellNext.style.width = '';
                  cellNext.style.flex = '';
                } else {
                  // For module, don't change width, except if there are 2 columns only
                  if (_arrColumns.length === 2) {
                    cellNext.style.width = 100 - parseFloat(w) + '%';
                    cellNext.style.flex = '0 0 auto';
                  }
                }
                this.removeColClasses(cellNext);
              }
            }
          }
          this.builder.opts.onChange();
        }
        return;
      }
      var cellnext, cellnext2;
      var arrColumns = this.getAllColumns(cell);
      if (arrColumns[1]) cellnext = arrColumns[1];
      if (arrColumns[2]) cellnext2 = arrColumns[2];
      var rowClass = builder.opts.row;
      var colClass = builder.opts.cols;
      var colSizes = builder.opts.colsizes;
      if (rowClass !== '' && colClass.length > 0 && colSizes.length > 0) {
        if (cellnext2) {
          for (var _i = 0; _i < colSizes.length; _i++) {
            var group = colSizes[_i];
            for (var j = 0; j < group.length; j++) {
              if (group[j].length === 3) {
                if (dom.hasClass(cell, group[j][0]) && dom.hasClass(cellnext, group[j][1]) && dom.hasClass(cellnext2, group[j][2])) {
                  if (j + 1 === group.length) {
                    //cannot be increased
                  } else {
                    this.builder.uo.saveForUndo();
                    dom.removeClass(cell, group[j][0]);
                    dom.removeClass(cellnext, group[j][1]);
                    dom.removeClass(cellnext2, group[j][2]);
                    dom.addClass(cell, group[j + 1][0]);
                    dom.addClass(cellnext, group[j + 1][1]);
                    dom.addClass(cellnext2, group[j + 1][2]);
                    this.builder.opts.onChange();
                    return;
                  }
                }
              }
            }
          }
        }
        for (var _i2 = 0; _i2 < colSizes.length; _i2++) {
          var _group = colSizes[_i2];
          for (var _j = 0; _j < _group.length; _j++) {
            if (_group[_j].length === 2) {
              if (dom.hasClass(cell, _group[_j][0]) && dom.hasClass(cellnext, _group[_j][1])) {
                if (_j + 1 === _group.length) {
                  //cannot be increased
                } else {
                  this.builder.uo.saveForUndo();
                  dom.removeClass(cell, _group[_j][0]);
                  dom.removeClass(cellnext, _group[_j][1]);
                  dom.addClass(cell, _group[_j + 1][0]);
                  dom.addClass(cellnext, _group[_j + 1][1]);
                  this.builder.opts.onChange();
                  return;
                }
              }
            }
          }
        }
        return;
      }

      //others (12 columns grid)       
      if (rowClass !== '' && colClass.length > 0) {
        // Bootstrap stuff
        if (cell.className.indexOf('col-md-') !== -1) {
          // Do Nothing
        } else if (cell.className.indexOf('col-sm-') !== -1) {
          colClass = ['col-sm-1', 'col-sm-2', 'col-sm-3', 'col-sm-4', 'col-sm-5', 'col-sm-6', 'col-sm-7', 'col-sm-8', 'col-sm-9', 'col-sm-10', 'col-sm-11', 'col-sm-12'];
        } else if (cell.className.indexOf('col-xs-') !== -1) {
          colClass = ['col-xs-1', 'col-xs-2', 'col-xs-3', 'col-xs-4', 'col-xs-5', 'col-xs-6', 'col-xs-7', 'col-xs-8', 'col-xs-9', 'col-xs-10', 'col-xs-11', 'col-xs-12'];
        } else if (cell.className.indexOf('col-lg-') !== -1) {
          colClass = ['col-lg-1', 'col-lg-2', 'col-lg-3', 'col-lg-4', 'col-lg-5', 'col-lg-6', 'col-lg-7', 'col-lg-8', 'col-lg-9', 'col-lg-10', 'col-lg-11', 'col-lg-12'];
        } else if (cell.className.indexOf('col-xl-') !== -1) {
          colClass = ['col-xl-1', 'col-xl-2', 'col-xl-3', 'col-xl-4', 'col-xl-5', 'col-xl-6', 'col-xl-7', 'col-xl-8', 'col-xl-9', 'col-xl-10', 'col-xl-11', 'col-xl-12'];
        } else if (cell.className.indexOf('col-xxl-') !== -1) {
          colClass = ['col-xxl-1', 'col-xxl-2', 'col-xxl-3', 'col-xxl-4', 'col-xxl-5', 'col-xxl-6', 'col-xxl-7', 'col-xxl-8', 'col-xxl-9', 'col-xxl-10', 'col-xxl-11', 'col-xxl-12'];
        }
        if (!dom.hasClass(cell, colClass[11])) {
          //if not column full

          if (dom.hasClass(cell, colClass[11])) {
            return;
          }
          if (dom.hasClass(cellnext, colClass[0])) {
            return;
          }
          this.builder.uo.saveForUndo();
          if (dom.hasClass(cell, colClass[10])) {
            dom.removeClass(cell, colClass[10]);
            dom.addClass(cell, colClass[11]);
          } else if (dom.hasClass(cell, colClass[9])) {
            dom.removeClass(cell, colClass[9]);
            dom.addClass(cell, colClass[10]);
          } else if (dom.hasClass(cell, colClass[8])) {
            dom.removeClass(cell, colClass[8]);
            dom.addClass(cell, colClass[9]);
          } else if (dom.hasClass(cell, colClass[7])) {
            dom.removeClass(cell, colClass[7]);
            dom.addClass(cell, colClass[8]);
          } else if (dom.hasClass(cell, colClass[6])) {
            dom.removeClass(cell, colClass[6]);
            dom.addClass(cell, colClass[7]);
          } else if (dom.hasClass(cell, colClass[5])) {
            dom.removeClass(cell, colClass[5]);
            dom.addClass(cell, colClass[6]);
          } else if (dom.hasClass(cell, colClass[4])) {
            dom.removeClass(cell, colClass[4]);
            dom.addClass(cell, colClass[5]);
          } else if (dom.hasClass(cell, colClass[3])) {
            dom.removeClass(cell, colClass[3]);
            dom.addClass(cell, colClass[4]);
          } else if (dom.hasClass(cell, colClass[2])) {
            dom.removeClass(cell, colClass[2]);
            dom.addClass(cell, colClass[3]);
          } else if (dom.hasClass(cell, colClass[1])) {
            dom.removeClass(cell, colClass[1]);
            dom.addClass(cell, colClass[2]);
          } else if (dom.hasClass(cell, colClass[0])) {
            dom.removeClass(cell, colClass[0]);
            dom.addClass(cell, colClass[1]);
          }
          if (dom.hasClass(cellnext, colClass[1])) {
            dom.removeClass(cellnext, colClass[1]);
            dom.addClass(cellnext, colClass[0]);
          } else if (dom.hasClass(cellnext, colClass[2])) {
            dom.removeClass(cellnext, colClass[2]);
            dom.addClass(cellnext, colClass[1]);
          } else if (dom.hasClass(cellnext, colClass[3])) {
            dom.removeClass(cellnext, colClass[3]);
            dom.addClass(cellnext, colClass[2]);
          } else if (dom.hasClass(cellnext, colClass[4])) {
            dom.removeClass(cellnext, colClass[4]);
            dom.addClass(cellnext, colClass[3]);
          } else if (dom.hasClass(cellnext, colClass[5])) {
            dom.removeClass(cellnext, colClass[5]);
            dom.addClass(cellnext, colClass[4]);
          } else if (dom.hasClass(cellnext, colClass[6])) {
            dom.removeClass(cellnext, colClass[6]);
            dom.addClass(cellnext, colClass[5]);
          } else if (dom.hasClass(cellnext, colClass[7])) {
            dom.removeClass(cellnext, colClass[7]);
            dom.addClass(cellnext, colClass[6]);
          } else if (dom.hasClass(cellnext, colClass[8])) {
            dom.removeClass(cellnext, colClass[8]);
            dom.addClass(cellnext, colClass[7]);
          } else if (dom.hasClass(cellnext, colClass[9])) {
            dom.removeClass(cellnext, colClass[9]);
            dom.addClass(cellnext, colClass[8]);
          } else if (dom.hasClass(cellnext, colClass[10])) {
            dom.removeClass(cellnext, colClass[10]);
            dom.addClass(cellnext, colClass[9]);
          } else if (dom.hasClass(cellnext, colClass[11])) {
            dom.removeClass(cellnext, colClass[11]);
            dom.addClass(cellnext, colClass[10]);
          }
          this.builder.opts.onChange();
        }
      }
    }
  }, {
    key: "decreaseColumn",
    value: function decreaseColumn() {
      var builder = this.builder;
      var util = this.util;
      var dom = this.dom;
      var cell = util.cellSelected();
      if (!cell) return;
      if (this.builder.useDefaultGrid) {
        var _arrColumns2 = this.getAllColumns(cell);
        if (_arrColumns2.length > 1 && _arrColumns2.length < 9) {
          this.builder.uo.saveForUndo();
          var w = this.resizeColumn(cell, false, _arrColumns2.length);
          if (w) {
            cell.style.width = w;
            cell.style.flex = '0 0 auto';
            this.removeColClasses(cell);
            for (var i = 1; i < _arrColumns2.length; i++) {
              var cellNext = _arrColumns2[i];
              if (cellNext !== cell) {
                // cellNext.style.width = '';
                // cellNext.style.flex = '';
                if (!cellNext.getAttribute('data-html')) {
                  cellNext.style.width = '';
                  cellNext.style.flex = '';
                } else {
                  // For module, don't change width, except if there are 2 columns only
                  if (_arrColumns2.length === 2) {
                    cellNext.style.width = 100 - parseFloat(w) + '%';
                    cellNext.style.flex = '0 0 auto';
                  }
                }
                this.removeColClasses(cellNext);
              }
            }
          }
          this.builder.opts.onChange();
        }
        return;
      }
      var cellnext, cellnext2;
      var arrColumns = this.getAllColumns(cell);
      if (arrColumns[1]) cellnext = arrColumns[1];
      if (arrColumns[2]) cellnext2 = arrColumns[2];
      var rowClass = builder.opts.row;
      var colClass = builder.opts.cols;
      var colSizes = builder.opts.colsizes;
      if (rowClass !== '' && colClass.length > 0 && colSizes.length > 0) {
        if (cellnext2) {
          for (var _i3 = 0; _i3 < colSizes.length; _i3++) {
            var group = colSizes[_i3];
            for (var j = 0; j < group.length; j++) {
              if (group[j].length === 3) {
                if (dom.hasClass(cell, group[j][0]) && dom.hasClass(cellnext, group[j][1]) && dom.hasClass(cellnext2, group[j][2])) {
                  if (j === 0) {
                    //cannot be decreased
                  } else {
                    this.builder.uo.saveForUndo();
                    dom.removeClass(cell, group[j][0]);
                    dom.removeClass(cellnext, group[j][1]);
                    dom.removeClass(cellnext2, group[j][2]);
                    dom.addClass(cell, group[j - 1][0]);
                    dom.addClass(cellnext, group[j - 1][1]);
                    dom.addClass(cellnext2, group[j - 1][2]);
                    this.builder.opts.onChange();
                    return;
                  }
                }
              }
            }
          }
        }
        for (var _i4 = 0; _i4 < colSizes.length; _i4++) {
          var _group2 = colSizes[_i4];
          for (var _j2 = 0; _j2 < _group2.length; _j2++) {
            if (_group2[_j2].length === 2) {
              if (dom.hasClass(cell, _group2[_j2][0]) && dom.hasClass(cellnext, _group2[_j2][1])) {
                if (_j2 === 0) {
                  //cannot be decreased
                } else {
                  this.builder.uo.saveForUndo();
                  dom.removeClass(cell, _group2[_j2][0]);
                  dom.removeClass(cellnext, _group2[_j2][1]);
                  dom.addClass(cell, _group2[_j2 - 1][0]);
                  dom.addClass(cellnext, _group2[_j2 - 1][1]);
                  this.builder.opts.onChange();
                  return;
                }
              }
            }
          }
        }
        return;
      }

      //others (12 columns grid)       
      // const rowClass = builder.opts.row; //row
      // const colClass = builder.opts.cols; //['col s1', 'col s2', 'col s3', 'col s4', 'col s5', 'col s6', 'col s7', 'col s8', 'col s9', 'col s10', 'col s11', 'col s12']
      if (rowClass !== '' && colClass.length > 0) {
        // Bootstrap stuff
        if (cell.className.indexOf('col-md-') !== -1) {
          // Do Nothing
        } else if (cell.className.indexOf('col-sm-') !== -1) {
          colClass = ['col-sm-1', 'col-sm-2', 'col-sm-3', 'col-sm-4', 'col-sm-5', 'col-sm-6', 'col-sm-7', 'col-sm-8', 'col-sm-9', 'col-sm-10', 'col-sm-11', 'col-sm-12'];
        } else if (cell.className.indexOf('col-xs-') !== -1) {
          colClass = ['col-xs-1', 'col-xs-2', 'col-xs-3', 'col-xs-4', 'col-xs-5', 'col-xs-6', 'col-xs-7', 'col-xs-8', 'col-xs-9', 'col-xs-10', 'col-xs-11', 'col-xs-12'];
        } else if (cell.className.indexOf('col-lg-') !== -1) {
          colClass = ['col-lg-1', 'col-lg-2', 'col-lg-3', 'col-lg-4', 'col-lg-5', 'col-lg-6', 'col-lg-7', 'col-lg-8', 'col-lg-9', 'col-lg-10', 'col-lg-11', 'col-lg-12'];
        } else if (cell.className.indexOf('col-xl-') !== -1) {
          colClass = ['col-xl-1', 'col-xl-2', 'col-xl-3', 'col-xl-4', 'col-xl-5', 'col-xl-6', 'col-xl-7', 'col-xl-8', 'col-xl-9', 'col-xl-10', 'col-xl-11', 'col-xl-12'];
        } else if (cell.className.indexOf('col-xxl-') !== -1) {
          colClass = ['col-xxl-1', 'col-xxl-2', 'col-xxl-3', 'col-xxl-4', 'col-xxl-5', 'col-xxl-6', 'col-xxl-7', 'col-xxl-8', 'col-xxl-9', 'col-xxl-10', 'col-xxl-11', 'col-xxl-12'];
        }
        if (!dom.hasClass(cell, colClass[11])) {
          //if not column full

          if (dom.hasClass(cell, colClass[0])) {
            return;
          }
          if (dom.hasClass(cellnext, colClass[11])) {
            return;
          }
          this.builder.uo.saveForUndo();
          if (dom.hasClass(cell, colClass[11])) {
            dom.removeClass(cell, colClass[11]);
            dom.addClass(cell, colClass[10]);
          } else if (dom.hasClass(cell, colClass[10])) {
            dom.removeClass(cell, colClass[10]);
            dom.addClass(cell, colClass[9]);
          } else if (dom.hasClass(cell, colClass[9])) {
            dom.removeClass(cell, colClass[9]);
            dom.addClass(cell, colClass[8]);
          } else if (dom.hasClass(cell, colClass[8])) {
            dom.removeClass(cell, colClass[8]);
            dom.addClass(cell, colClass[7]);
          } else if (dom.hasClass(cell, colClass[7])) {
            dom.removeClass(cell, colClass[7]);
            dom.addClass(cell, colClass[6]);
          } else if (dom.hasClass(cell, colClass[6])) {
            dom.removeClass(cell, colClass[6]);
            dom.addClass(cell, colClass[5]);
          } else if (dom.hasClass(cell, colClass[5])) {
            dom.removeClass(cell, colClass[5]);
            dom.addClass(cell, colClass[4]);
          } else if (dom.hasClass(cell, colClass[4])) {
            dom.removeClass(cell, colClass[4]);
            dom.addClass(cell, colClass[3]);
          } else if (dom.hasClass(cell, colClass[3])) {
            dom.removeClass(cell, colClass[3]);
            dom.addClass(cell, colClass[2]);
          } else if (dom.hasClass(cell, colClass[2])) {
            dom.removeClass(cell, colClass[2]);
            dom.addClass(cell, colClass[1]);
          } else if (dom.hasClass(cell, colClass[1])) {
            dom.removeClass(cell, colClass[1]);
            dom.addClass(cell, colClass[0]);
          }
          if (dom.hasClass(cellnext, colClass[0])) {
            dom.removeClass(cellnext, colClass[0]);
            dom.addClass(cellnext, colClass[1]);
          } else if (dom.hasClass(cellnext, colClass[1])) {
            dom.removeClass(cellnext, colClass[1]);
            dom.addClass(cellnext, colClass[2]);
          } else if (dom.hasClass(cellnext, colClass[2])) {
            dom.removeClass(cellnext, colClass[2]);
            dom.addClass(cellnext, colClass[3]);
          } else if (dom.hasClass(cellnext, colClass[3])) {
            dom.removeClass(cellnext, colClass[3]);
            dom.addClass(cellnext, colClass[4]);
          } else if (dom.hasClass(cellnext, colClass[4])) {
            dom.removeClass(cellnext, colClass[4]);
            dom.addClass(cellnext, colClass[5]);
          } else if (dom.hasClass(cellnext, colClass[5])) {
            dom.removeClass(cellnext, colClass[5]);
            dom.addClass(cellnext, colClass[6]);
          } else if (dom.hasClass(cellnext, colClass[6])) {
            dom.removeClass(cellnext, colClass[6]);
            dom.addClass(cellnext, colClass[7]);
          } else if (dom.hasClass(cellnext, colClass[7])) {
            dom.removeClass(cellnext, colClass[7]);
            dom.addClass(cellnext, colClass[8]);
          } else if (dom.hasClass(cellnext, colClass[8])) {
            dom.removeClass(cellnext, colClass[8]);
            dom.addClass(cellnext, colClass[9]);
          } else if (dom.hasClass(cellnext, colClass[9])) {
            dom.removeClass(cellnext, colClass[9]);
            dom.addClass(cellnext, colClass[10]);
          } else if (dom.hasClass(cellnext, colClass[10])) {
            dom.removeClass(cellnext, colClass[10]);
            dom.addClass(cellnext, colClass[11]);
          }
          this.builder.opts.onChange();
        }
      }
    }

    // ROW
  }, {
    key: "removeRow",
    value: function removeRow() {
      var _this2 = this;
      // let builder = this.builder;
      var util = this.util;
      var dom = this.dom;

      // const cell = util.cellSelected();
      // if(!cell) return;
      // const row = cell.parentNode;
      var row;
      var cell = util.cellSelected();
      if (cell) {
        row = cell.parentNode;
      } else {
        row = util.rowSelected();
      }
      if (!row) return;

      //Change to row selection
      dom.removeClass(row, 'row-outline');
      util.confirm(util.out('Are you sure you want to delete this block?'), function (ok) {
        // const cell = util.cellSelected();
        // if(!cell) return;
        // const row = cell.parentNode; 
        var row;
        var cell = util.cellSelected();
        if (cell) {
          row = cell.parentNode;
        } else {
          row = util.rowSelected();
        }
        if (!row) return;
        if (ok) {
          _this2.builder.uo.saveForUndo();
          row.parentNode.removeChild(row);
          util.checkEmpty();
          util.clearActiveCell();
          _this2.builder.opts.onChange();
        }
      });
    }
  }, {
    key: "moveRowUp",
    value: function moveRowUp() {
      var _this3 = this;
      // let builder = this.builder;
      var util = this.util;
      var dom = this.dom;

      // const cell = util.cellSelected();
      // if(!cell) return;
      // let row = cell.parentNode;
      var row;
      var cell = util.cellSelected();
      if (cell) {
        row = cell.parentNode;
      } else {
        row = util.rowSelected();
      }
      if (!row) return;

      //Change to row selection
      dom.removeClass(row, 'row-outline');
      if (row.previousElementSibling) {
        this.builder.uo.saveForUndo();
        row.parentNode.insertBefore(row, row.previousElementSibling);
        this.rowTool.position(row);
        this.builder.opts.onChange();
      } else {
        // Move to previous container

        var currContainer = row.parentNode;
        var prev = null;
        var builders = document.querySelectorAll(this.builder.opts.container);
        Array.prototype.forEach.call(builders, function (builder) {
          if (builder.innerHTML === currContainer.innerHTML) {
            if (prev) {
              dom.moveAfter(row, prev.lastChild);
              _this3.rowTool.position(row);
              util.checkEmpty();
              _this3.builder.opts.onChange();
              return false;
            }
          }
          prev = builder;
        });
      }
    }
  }, {
    key: "moveRowDown",
    value: function moveRowDown() {
      var _this4 = this;
      // let builder = this.builder;
      var util = this.util;
      var dom = this.dom;

      // const cell = util.cellSelected();
      // if(!cell) return;
      // let row = cell.parentNode;
      var row;
      var cell = util.cellSelected();
      if (cell) {
        row = cell.parentNode;
      } else {
        row = util.rowSelected();
      }
      if (!row) return;

      //Change to row selection
      dom.removeClass(row, 'row-outline');
      if (row.nextElementSibling) {
        this.builder.uo.saveForUndo();
        row.parentNode.insertBefore(row.nextElementSibling, row);
        this.rowTool.position(row);
        this.builder.opts.onChange();
      } else {
        // Move to next container

        var currContainer = row.parentNode;
        var flag = false;
        var builders = document.querySelectorAll(this.builder.opts.container);
        Array.prototype.forEach.call(builders, function (builder) {
          if (flag) {
            builder.insertBefore(row, builder.firstChild);
            _this4.rowTool.position(row);
            util.checkEmpty();
            _this4.builder.opts.onChange();
            return false;
          }
          if (builder.innerHTML === currContainer.innerHTML) {
            flag = true;
          }
        });
      }
    }
  }, {
    key: "duplicateRow",
    value: function duplicateRow() {
      var builder = this.builder;
      var util = this.util;
      var dom = this.dom;

      // const cell = util.cellSelected();
      // if(!cell) return;
      // let row = cell.parentNode;
      var row;
      var cell = util.cellSelected();
      if (cell) {
        row = cell.parentNode;
      } else {
        row = util.rowSelected();
      }
      if (!row) return;

      //Change to row selection
      dom.removeClass(row, 'row-outline');
      this.builder.uo.saveForUndo();

      //Clone row & cleanup attached tool & event
      var rowElement = row.cloneNode(true);
      rowElement.removeChild(rowElement.querySelector('.is-row-tool'));
      rowElement.removeChild(rowElement.querySelector('.is-col-tool'));
      var cols = dom.elementChildren(rowElement);
      cols.forEach(function (col) {
        col.removeAttribute('data-click');
        if (col.classList.contains('cell-active')) {
          builder.activeCol = col;
        }
      });
      dom.moveAfter(rowElement, row);

      //Unselect current row
      dom.removeClass(row, 'row-active');
      dom.removeClass(row, 'row-outline');
      cols = dom.elementChildren(row);
      cols.forEach(function (col) {
        dom.removeClass(col, 'cell-active');
      });

      //re-add tool
      var builderActive = this.builder.doc.querySelector('.builder-active');
      builder.applyBehaviorOn(builderActive);
      this.rowTool.position(rowElement);
      this.builder.opts.onChange();
    }
  }]);
  return Grid;
}();
var RowTool = /*#__PURE__*/function () {
  function RowTool(builder) {
    grid_classCallCheck(this, RowTool);
    this.builder = builder;
    var dom = this.builder.dom;
    this.dom = dom;
  }
  grid_createClass(RowTool, [{
    key: "position",
    value: function position(row) {
      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      var rowTool = row.querySelector('.is-row-tool');
      var rowMore = builderStuff.querySelector('.rowmore');
      if (!rowMore) return;
      dom.addClass(rowMore, 'transition1');
      var elm = rowTool.querySelector('.row-more');

      /*
      let top, left;
      if(!this.builder.iframe) {
          top = elm.getBoundingClientRect().top + window.pageYOffset;
          left = elm.getBoundingClientRect().left + window.pageXOffset;
      } else {
          let adjY = this.builder.iframe.getBoundingClientRect().top + window.pageYOffset;
          let adjX = this.builder.iframe.getBoundingClientRect().left + window.pageXOffset;
           top = elm.getBoundingClientRect().top;
          left = elm.getBoundingClientRect().left;
          top = top + adjY;
          left = left + adjX;
      }
      */
      var newPos = this.builder.util.getElementPosition(elm);
      var top = newPos.top;
      var left = newPos.left;

      // const w = rowMore.offsetWidth; 
      rowMore.style.top = top - 8 + 'px';
      dom.removeClass(rowMore, 'arrow-bottom');
      dom.removeClass(rowMore, 'arrow-left');
      dom.removeClass(rowMore, 'arrow-right');
      dom.removeClass(rowMore, 'center');
      dom.removeClass(rowMore, 'right');
      dom.removeClass(rowMore, 'left');
      if (this.builder.opts.rowTool === 'right') {
        rowMore.style.left = left - rowMore.offsetWidth - 10 + 'px';
        dom.addClass(rowMore, 'arrow-right');
        dom.addClass(rowMore, 'left');
      } else {
        rowMore.style.left = left + 35 + 'px';
        dom.addClass(rowMore, 'arrow-left');
        dom.addClass(rowMore, 'left');
      }
      setTimeout(function () {
        dom.removeClass(rowMore, 'transition1');
      }, 300);
    }
  }]);
  return RowTool;
}();
/* harmony default export */ const contentbuilder_grid = (Grid);
;// CONCATENATED MODULE: ./src/contentbuilder/draggable.js
function draggable_typeof(obj) { "@babel/helpers - typeof"; return draggable_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, draggable_typeof(obj); }
function draggable_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function draggable_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, draggable_toPropertyKey(descriptor.key), descriptor); } }
function draggable_createClass(Constructor, protoProps, staticProps) { if (protoProps) draggable_defineProperties(Constructor.prototype, protoProps); if (staticProps) draggable_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function draggable_toPropertyKey(arg) { var key = draggable_toPrimitive(arg, "string"); return draggable_typeof(key) === "symbol" ? key : String(key); }
function draggable_toPrimitive(input, hint) { if (draggable_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (draggable_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Draggable = /*#__PURE__*/function () {
  function Draggable() {
    var _this = this;
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    draggable_classCallCheck(this, Draggable);
    this.opts = opts;
    this.dragStart = this.dragStart.bind(this);
    this.dragEnd = this.dragEnd.bind(this);
    this.drag = this.drag.bind(this);
    var elms = document.querySelectorAll(this.opts.selector);
    Array.prototype.forEach.call(elms, function (elm) {
      elm.setAttribute('draggable', '');
      elm.addEventListener('mousedown', _this.dragStart, false);
      elm.addEventListener('touchstart', _this.dragStart, {
        passive: true
      });
      elm.addEventListener('mouseup', _this.dragEnd, false);
      elm.addEventListener('touchend', _this.dragEnd, false);
    });
  }
  draggable_createClass(Draggable, [{
    key: "dragStart",
    value: function dragStart(e) {
      if (!e.target.hasAttribute('draggable')) return; //any child element (ex. close button) should not be draggable. LATER: revew.

      if (e.type === 'touchstart' && e.touches.length !== 1) {
        return; // Do nothing if more than one touch point is detected
      }

      if (e.type === 'mousedown' && e.button !== 0) {
        return; // Do nothing if the right mouse button is clicked
      }

      e.target.parentNode.style.transition = 'none';
      this.dragActive = true;
      this.activeDraggableBox = e.target.parentElement;
      var xOffset;
      var yOffset;
      if (!this.activeDraggableBox.getAttribute('data-xOffset')) {
        this.activeDraggableBox.setAttribute('data-xOffset', 0);
        xOffset = 0;
      } else {
        xOffset = this.activeDraggableBox.getAttribute('data-xOffset');
      }
      if (!this.activeDraggableBox.getAttribute('data-yOffset')) {
        this.activeDraggableBox.setAttribute('data-yOffset', 0);
        yOffset = 0;
      } else {
        yOffset = this.activeDraggableBox.getAttribute('data-yOffset');
      }
      var initialX, initialY;
      if (e.type === 'touchstart') {
        initialX = e.touches[0].clientX - xOffset;
        initialY = e.touches[0].clientY - yOffset;
      } else {
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
      }
      this.activeDraggableBox.setAttribute('data-initialX', initialX);
      this.activeDraggableBox.setAttribute('data-initialY', initialY);
      document.addEventListener('touchmove', this.drag, false);
      document.addEventListener('mousemove', this.drag, false);
    }
  }, {
    key: "dragEnd",
    value: function dragEnd(e) {
      if (!e.target.hasAttribute('draggable')) return; //any child element (ex. close button) should not be draggable. LATER: revew.

      if (!this.activeDraggableBox) return;
      e.target.parentNode.style.transition = '';

      //Update
      var currentX = this.activeDraggableBox.getAttribute('data-currentX');
      var currentY = this.activeDraggableBox.getAttribute('data-currentY');
      var initialX = currentX;
      var initialY = currentY;
      this.activeDraggableBox.setAttribute('data-initialX', initialX);
      this.activeDraggableBox.setAttribute('data-initialY', initialY);
      this.dragActive = false;
      document.removeEventListener('touchmove', this.drag);
      document.removeEventListener('mousemove', this.drag);
    }
  }, {
    key: "drag",
    value: function drag(e) {
      if (this.dragActive) {
        e.preventDefault();
        var initialX = this.activeDraggableBox.getAttribute('data-initialX');
        var initialY = this.activeDraggableBox.getAttribute('data-initialY');
        var currentX, currentY;
        if (e.type === 'touchmove') {
          currentX = e.touches[0].clientX - initialX;
          currentY = e.touches[0].clientY - initialY;
        } else {
          currentX = e.clientX - initialX;
          currentY = e.clientY - initialY;
        }
        this.activeDraggableBox.style.transform = 'translate3d(' + currentX + 'px, ' + currentY + 'px, 0)';

        //Save
        this.activeDraggableBox.setAttribute('data-currentX', currentX);
        this.activeDraggableBox.setAttribute('data-currentY', currentY);
        var xOffset = currentX;
        var yOffset = currentY;
        this.activeDraggableBox.setAttribute('data-xOffset', xOffset);
        this.activeDraggableBox.setAttribute('data-yOffset', yOffset);
      }
    }
  }]);
  return Draggable;
}();
/* harmony default export */ const contentbuilder_draggable = (Draggable);
;// CONCATENATED MODULE: ./src/contentbuilder/grideditor.js




var renderGridEditor = function renderGridEditor(builder) {
  var util = builder.util;
  var builderStuff = builder.builderStuff;
  var grid = new contentbuilder_grid(builder);
  var htmlutil = new contentbuilder_html(builder);
  var dom = builder.dom;
  var rowhtmlbutton = '';
  if (builder.opts.rowHtmlEditor) rowhtmlbutton = "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"row-html\">\n            <svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg>\n        </button>");
  var colhtmlbutton = '';
  if (builder.opts.columnHtmlEditor) colhtmlbutton = "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"cell-html\">\n            <svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg>\n        </button>");
  var html = "<div class=\"is-modal is-modal-content grideditor\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n        <div class=\"is-modal-bar is-draggable\">\n            <button class=\"is-modal-close\" tabindex=\"-1\" title=\"".concat(util.out('Close'), "\">&#10005;</button>\n        </div>\n        <div style=\"padding:13px 0 5px 18px;font-size:10px;text-transform:uppercase;letter-spacing:1px;\">").concat(util.out('Row'), "</div>\n        <div style=\"display:flex;flex-flow:wrap;\">\n            <button tabindex=\"-1\" title=\"").concat(util.out('Add'), "\" class=\"row-add\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Duplicate'), "\" class=\"row-duplicate\" style=\"display: block;\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Move Up'), "\" class=\"row-up\" style=\"display: block;\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Move Down'), "\" class=\"row-down\" style=\"display: block;\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></button>\n            ").concat(rowhtmlbutton, "\n            <button tabindex=\"-1\" title=\"").concat(util.out('Delete'), "\" class=\"row-remove\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n        </div>\n        <div style=\"padding:8px 0 5px 18px;font-size:11px;text-transform:uppercase;letter-spacing:1px;\">").concat(util.out('Column'), "</div>\n        <div style=\"display:flex;flex-flow:wrap;\">\n            <button tabindex=\"-1\" title=\"").concat(util.out('Add'), "\" class=\"cell-add\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Duplicate'), "\" class=\"cell-duplicate\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Move Up'), "\" class=\"cell-up\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Move Down'), "\" class=\"cell-down\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Move Left'), "\" class=\"cell-prev\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-left\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Move Right'), "\" class=\"cell-next\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-right\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Increase'), "\" class=\"cell-increase\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-increase\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Decrease'), "\" class=\"cell-decrease\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-decrease\"></use></svg></button>\n            ").concat(colhtmlbutton, "\n            <button tabindex=\"-1\" title=\"").concat(util.out('Delete'), "\" class=\"cell-remove\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Lock'), "\" class=\"cell-locking\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#icon-lock\"></use></svg></button>\n            <button tabindex=\"-1\" title=\"").concat(util.out('Column Settings'), "\" class=\"cell-settings\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n               \n            <div class=\"is-separator\">\n                <button tabindex=\"-1\" title=\"").concat(util.out('Outline'), "\" class=\"grid-outline\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-grid-view-outline\"></use></svg></button>\n                <!--<button tabindex=\"-1\" title=\"").concat(util.out('Element Tool'), "\" class=\"cell-elmtool\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>-->\n            </div>\n        </div>\n    </div>");

  //LATER:
  //<button title="${util.out('Element Tool')}" class="cell-elmtool"><svg class="is-icon-flex" style="width:12px;height:12px;"><use xlink:href="#ion-ios-gear"></use></svg></button>

  dom.appendHtml(builderStuff, html);
  new contentbuilder_draggable({
    selector: '.is-draggable'
  });
  var grideditor = document.querySelector('.grideditor');
  var elm = grideditor.querySelector('.is-modal-close');
  dom.addEventListener(elm, 'click', function () {
    builder._rowTool.hideGridEditor();
  });
  var btnGridOutline = grideditor.querySelector('.grid-outline');
  dom.addEventListener(btnGridOutline, 'click', function () {
    var builders = builder.doc.querySelectorAll(builder.opts.container);
    Array.prototype.forEach.call(builders, function (builder) {
      if (builder.hasAttribute('gridoutline')) {
        builder.removeAttribute('gridoutline');
        dom.removeClass(btnGridOutline, 'on');
      } else {
        builder.setAttribute('gridoutline', '');
        dom.addClass(btnGridOutline, 'on');
      }
    });
  });

  // CELL
  var btnAdd = grideditor.querySelector('.cell-add');
  dom.addEventListener(btnAdd, 'click', function () {
    var quickadd = contentbuilder_quickadd(builder);
    var tabs = quickadd.querySelector('.is-pop-tabs');
    tabs.style.display = 'flex';
    var top = btnAdd.getBoundingClientRect().top + window.pageYOffset;
    var left = btnAdd.getBoundingClientRect().left + window.pageXOffset;
    // quickadd.style.display = 'flex';
    util.showPop(quickadd, false, btnAdd);
    var w = quickadd.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
    //const h = quickadd.offsetHeight;
    quickadd.style.top = top + 'px';
    quickadd.style.left = left - w - 8 + 'px';
    dom.removeClass(quickadd, 'arrow-bottom');
    dom.removeClass(quickadd, 'arrow-left');
    dom.removeClass(quickadd, 'arrow-top');
    dom.removeClass(quickadd, 'center');
    dom.removeClass(quickadd, 'left');
    dom.addClass(quickadd, 'arrow-right');
    dom.addClass(quickadd, 'right');
    var val = quickadd.querySelector('.active').getAttribute('data-value');
    if (val === 'left') {
      quickadd.setAttribute('data-mode', 'cell-left');
    } else {
      quickadd.setAttribute('data-mode', 'cell-right');
    }

    //handleQuickAddClickOut
    var handleQuickAddClickOut = function handleQuickAddClickOut(e) {
      // console.log('handleQuickAddClickOut');
      var elm = e.target;
      if (!elm) return;
      if (!elm.closest('.quickadd') && !elm.closest('.row-add') && !elm.closest('.is-rowadd-tool') && !elm.closest('.cell-add') && !elm.closest('.elm-add') && !elm.closest('.row-add-initial')) {
        // click outside

        // hide
        var _quickadd = builderStuff.querySelector('.quickadd');
        util.hidePop(_quickadd);
        // console.log('HIDE');

        // clear events
        document.removeEventListener('click', handleQuickAddClickOut);
        if (builder.iframeDocument) {
          builder.doc.removeEventListener('click', handleQuickAddClickOut);
        }
        builder.handleQuickAddClickOut_ = false;
      }
    };
    if (!builder.handleQuickAddClickOut_) {
      document.addEventListener('click', handleQuickAddClickOut);
      if (builder.iframeDocument) {
        builder.doc.addEventListener('click', handleQuickAddClickOut);
      }
      builder.handleQuickAddClickOut_ = true;
    }
  });
  elm = grideditor.querySelector('.cell-prev');
  dom.addEventListener(elm, 'click', function () {
    grid.moveColumnPrevious();
    util.clearControls();
  });
  elm = grideditor.querySelector('.cell-next');
  dom.addEventListener(elm, 'click', function () {
    grid.moveColumnNext();
    util.clearControls();
  });
  elm = grideditor.querySelector('.cell-increase');
  dom.addEventListener(elm, 'click', function () {
    grid.increaseColumn();
    util.clearControls();
  });
  elm = grideditor.querySelector('.cell-decrease');
  dom.addEventListener(elm, 'click', function () {
    grid.decreaseColumn();
    util.clearControls();
  });
  elm = grideditor.querySelector('.cell-up');
  dom.addEventListener(elm, 'click', function () {
    grid.moveColumnUp();
    util.clearControls();
  });
  elm = grideditor.querySelector('.cell-down');
  dom.addEventListener(elm, 'click', function () {
    grid.moveColumnDown();
    util.clearControls();
  });
  elm = grideditor.querySelector('.cell-duplicate');
  dom.addEventListener(elm, 'click', function () {
    grid.duplicateColumn();
    util.clearControls();
  });
  elm = grideditor.querySelector('.cell-remove');
  dom.addEventListener(elm, 'click', function () {
    grid.removeColumn();
    util.clearControls();
  });
  var btnCellHtml = grideditor.querySelector('.cell-html');
  if (btnCellHtml) dom.addEventListener(btnCellHtml, 'click', function () {
    var cell = util.cellSelected();
    if (!cell) return;
    htmlutil.view('cell', false, btnCellHtml);
  });
  var btnCellSettings = grideditor.querySelector('.cell-settings');
  if (btnCellSettings) dom.addEventListener(btnCellSettings, 'click', function () {
    var cell = util.cellSelected();
    if (!cell) return;
    builder.colTool.renderPanel();
    builder.colTool.readCellStyles(cell);

    //save selection
    util.saveSelection();
    var cellSettings = document.querySelector('.is-modal.columnsettings');
    util.showModal(cellSettings, false, function () {
      var rtetool = builder.builderStuff.querySelector('.is-rte-tool');
      if (rtetool.style.display === 'flex') {
        // means text selection

        util.restoreSelection();

        // if(builder.activeElement) {
        //     dom.addClass(builder.activeElement, 'elm-active');
        //     builder.elmTool.repositionElementTool();
        // }

        btnCellSettings.removeAttribute('data-focus');
        btnCellSettings.focus();
      }
    });
    btnCellSettings.setAttribute('data-focus', true);
  });

  // Lock/Unlock Column
  var btnCellLocking = grideditor.querySelector('.cell-locking');
  if (btnCellLocking) dom.addEventListener(btnCellLocking, 'click', function (e) {
    var cell = util.cellSelected();
    if (!cell) return;
    if (!cell.hasAttribute('data-noedit')) {
      cell.setAttribute('data-noedit', '');
      cell.contentEditable = false;
      dom.addClass(btnCellLocking, 'on');
      util.clearActiveElement(true);
    } else {
      cell.removeAttribute('data-noedit');
      cell.contentEditable = true;
      dom.removeClass(btnCellLocking, 'on');
    }
    builder.colTool.showHideLockIndicator(cell);
    builder.element.applyBehavior(cell);
    e.preventDefault();
  });

  // ROW

  var btnRowAdd = grideditor.querySelector('.row-add');
  dom.addEventListener(btnRowAdd, 'click', function () {
    var quickadd = contentbuilder_quickadd(builder);
    var tabs = quickadd.querySelector('.is-pop-tabs');
    tabs.style.display = 'none';
    var top = btnRowAdd.getBoundingClientRect().top + window.pageYOffset;
    var left = btnRowAdd.getBoundingClientRect().left + window.pageXOffset;
    // quickadd.style.display = 'flex';
    util.showPop(quickadd, false, btnRowAdd);
    var w = quickadd.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
    //const h = quickadd.offsetHeight;
    quickadd.style.top = top + 'px';
    quickadd.style.left = left - w - 8 + 'px';
    dom.removeClass(quickadd, 'arrow-bottom');
    dom.removeClass(quickadd, 'arrow-left');
    dom.removeClass(quickadd, 'arrow-top');
    dom.removeClass(quickadd, 'center');
    dom.removeClass(quickadd, 'left');
    dom.addClass(quickadd, 'arrow-right');
    dom.addClass(quickadd, 'right');
    quickadd.setAttribute('data-mode', 'row');
  });
  elm = grideditor.querySelector('.row-up');
  dom.addEventListener(elm, 'click', function () {
    grid.moveRowUp();
    util.clearControls();
  });
  elm = grideditor.querySelector('.row-down');
  dom.addEventListener(elm, 'click', function () {
    grid.moveRowDown();
    util.clearControls();
  });
  elm = grideditor.querySelector('.row-duplicate');
  dom.addEventListener(elm, 'click', function () {
    grid.duplicateRow();
    util.clearControls();
  });
  elm = grideditor.querySelector('.row-remove');
  dom.addEventListener(elm, 'click', function () {
    grid.removeRow();
    util.clearControls();
  });
  var btnRowHtml = grideditor.querySelector('.row-html');
  if (btnRowHtml) dom.addEventListener(btnRowHtml, 'click', function () {
    var cell = util.cellSelected();
    if (!cell) return;
    htmlutil.view('row', false, btnRowHtml);
  });
};
/* harmony default export */ const grideditor = (renderGridEditor);
;// CONCATENATED MODULE: ./node_modules/sortablejs/modular/sortable.esm.js
/**!
 * Sortable 1.14.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */
function sortable_esm_ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);

    if (enumerableOnly) {
      symbols = symbols.filter(function (sym) {
        return Object.getOwnPropertyDescriptor(object, sym).enumerable;
      });
    }

    keys.push.apply(keys, symbols);
  }

  return keys;
}

function sortable_esm_objectSpread2(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      sortable_esm_ownKeys(Object(source), true).forEach(function (key) {
        sortable_esm_defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      sortable_esm_ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function sortable_esm_typeof(obj) {
  "@babel/helpers - typeof";

  if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
    sortable_esm_typeof = function (obj) {
      return typeof obj;
    };
  } else {
    sortable_esm_typeof = function (obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
    };
  }

  return sortable_esm_typeof(obj);
}

function sortable_esm_defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

function sortable_esm_objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function sortable_esm_objectWithoutProperties(source, excluded) {
  if (source == null) return {};

  var target = sortable_esm_objectWithoutPropertiesLoose(source, excluded);

  var key, i;

  if (Object.getOwnPropertySymbols) {
    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);

    for (i = 0; i < sourceSymbolKeys.length; i++) {
      key = sourceSymbolKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
      target[key] = source[key];
    }
  }

  return target;
}

function _toConsumableArray(arr) {
  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || sortable_esm_unsupportedIterableToArray(arr) || _nonIterableSpread();
}

function _arrayWithoutHoles(arr) {
  if (Array.isArray(arr)) return sortable_esm_arrayLikeToArray(arr);
}

function _iterableToArray(iter) {
  if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}

function sortable_esm_unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return sortable_esm_arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return sortable_esm_arrayLikeToArray(o, minLen);
}

function sortable_esm_arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];

  return arr2;
}

function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

var version = "1.14.0";

function userAgent(pattern) {
  if (typeof window !== 'undefined' && window.navigator) {
    return !! /*@__PURE__*/navigator.userAgent.match(pattern);
  }
}

var IE11OrLess = userAgent(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i);
var Edge = userAgent(/Edge/i);
var FireFox = userAgent(/firefox/i);
var Safari = userAgent(/safari/i) && !userAgent(/chrome/i) && !userAgent(/android/i);
var IOS = userAgent(/iP(ad|od|hone)/i);
var ChromeForAndroid = userAgent(/chrome/i) && userAgent(/android/i);

var captureMode = {
  capture: false,
  passive: false
};

function on(el, event, fn) {
  el.addEventListener(event, fn, !IE11OrLess && captureMode);
}

function off(el, event, fn) {
  el.removeEventListener(event, fn, !IE11OrLess && captureMode);
}

function matches(
/**HTMLElement*/
el,
/**String*/
selector) {
  if (!selector) return;
  selector[0] === '>' && (selector = selector.substring(1));

  if (el) {
    try {
      if (el.matches) {
        return el.matches(selector);
      } else if (el.msMatchesSelector) {
        return el.msMatchesSelector(selector);
      } else if (el.webkitMatchesSelector) {
        return el.webkitMatchesSelector(selector);
      }
    } catch (_) {
      return false;
    }
  }

  return false;
}

function getParentOrHost(el) {
  return el.host && el !== document && el.host.nodeType ? el.host : el.parentNode;
}

function closest(
/**HTMLElement*/
el,
/**String*/
selector,
/**HTMLElement*/
ctx, includeCTX) {
  if (el) {
    ctx = ctx || document;

    do {
      if (selector != null && (selector[0] === '>' ? el.parentNode === ctx && matches(el, selector) : matches(el, selector)) || includeCTX && el === ctx) {
        return el;
      }

      if (el === ctx) break;
      /* jshint boss:true */
    } while (el = getParentOrHost(el));
  }

  return null;
}

var R_SPACE = /\s+/g;

function toggleClass(el, name, state) {
  if (el && name) {
    if (el.classList) {
      el.classList[state ? 'add' : 'remove'](name);
    } else {
      var className = (' ' + el.className + ' ').replace(R_SPACE, ' ').replace(' ' + name + ' ', ' ');
      el.className = (className + (state ? ' ' + name : '')).replace(R_SPACE, ' ');
    }
  }
}

function css(el, prop, val) {
  var style = el && el.style;

  if (style) {
    if (val === void 0) {
      if (document.defaultView && document.defaultView.getComputedStyle) {
        val = document.defaultView.getComputedStyle(el, '');
      } else if (el.currentStyle) {
        val = el.currentStyle;
      }

      return prop === void 0 ? val : val[prop];
    } else {
      if (!(prop in style) && prop.indexOf('webkit') === -1) {
        prop = '-webkit-' + prop;
      }

      style[prop] = val + (typeof val === 'string' ? '' : 'px');
    }
  }
}

function matrix(el, selfOnly) {
  var appliedTransforms = '';

  if (typeof el === 'string') {
    appliedTransforms = el;
  } else {
    do {
      var transform = css(el, 'transform');

      if (transform && transform !== 'none') {
        appliedTransforms = transform + ' ' + appliedTransforms;
      }
      /* jshint boss:true */

    } while (!selfOnly && (el = el.parentNode));
  }

  var matrixFn = window.DOMMatrix || window.WebKitCSSMatrix || window.CSSMatrix || window.MSCSSMatrix;
  /*jshint -W056 */

  return matrixFn && new matrixFn(appliedTransforms);
}

function sortable_esm_find(ctx, tagName, iterator) {
  if (ctx) {
    var list = ctx.getElementsByTagName(tagName),
        i = 0,
        n = list.length;

    if (iterator) {
      for (; i < n; i++) {
        iterator(list[i], i);
      }
    }

    return list;
  }

  return [];
}

function getWindowScrollingElement() {
  var scrollingElement = document.scrollingElement;

  if (scrollingElement) {
    return scrollingElement;
  } else {
    return document.documentElement;
  }
}
/**
 * Returns the "bounding client rect" of given element
 * @param  {HTMLElement} el                       The element whose boundingClientRect is wanted
 * @param  {[Boolean]} relativeToContainingBlock  Whether the rect should be relative to the containing block of (including) the container
 * @param  {[Boolean]} relativeToNonStaticParent  Whether the rect should be relative to the relative parent of (including) the contaienr
 * @param  {[Boolean]} undoScale                  Whether the container's scale() should be undone
 * @param  {[HTMLElement]} container              The parent the element will be placed in
 * @return {Object}                               The boundingClientRect of el, with specified adjustments
 */


function getRect(el, relativeToContainingBlock, relativeToNonStaticParent, undoScale, container) {
  if (!el.getBoundingClientRect && el !== window) return;
  var elRect, top, left, bottom, right, height, width;

  if (el !== window && el.parentNode && el !== getWindowScrollingElement()) {
    elRect = el.getBoundingClientRect();
    top = elRect.top;
    left = elRect.left;
    bottom = elRect.bottom;
    right = elRect.right;
    height = elRect.height;
    width = elRect.width;
  } else {
    top = 0;
    left = 0;
    bottom = window.innerHeight;
    right = window.innerWidth;
    height = window.innerHeight;
    width = window.innerWidth;
  }

  if ((relativeToContainingBlock || relativeToNonStaticParent) && el !== window) {
    // Adjust for translate()
    container = container || el.parentNode; // solves #1123 (see: https://stackoverflow.com/a/37953806/6088312)
    // Not needed on <= IE11

    if (!IE11OrLess) {
      do {
        if (container && container.getBoundingClientRect && (css(container, 'transform') !== 'none' || relativeToNonStaticParent && css(container, 'position') !== 'static')) {
          var containerRect = container.getBoundingClientRect(); // Set relative to edges of padding box of container

          top -= containerRect.top + parseInt(css(container, 'border-top-width'));
          left -= containerRect.left + parseInt(css(container, 'border-left-width'));
          bottom = top + elRect.height;
          right = left + elRect.width;
          break;
        }
        /* jshint boss:true */

      } while (container = container.parentNode);
    }
  }

  if (undoScale && el !== window) {
    // Adjust for scale()
    var elMatrix = matrix(container || el),
        scaleX = elMatrix && elMatrix.a,
        scaleY = elMatrix && elMatrix.d;

    if (elMatrix) {
      top /= scaleY;
      left /= scaleX;
      width /= scaleX;
      height /= scaleY;
      bottom = top + height;
      right = left + width;
    }
  }

  return {
    top: top,
    left: left,
    bottom: bottom,
    right: right,
    width: width,
    height: height
  };
}
/**
 * Checks if a side of an element is scrolled past a side of its parents
 * @param  {HTMLElement}  el           The element who's side being scrolled out of view is in question
 * @param  {String}       elSide       Side of the element in question ('top', 'left', 'right', 'bottom')
 * @param  {String}       parentSide   Side of the parent in question ('top', 'left', 'right', 'bottom')
 * @return {HTMLElement}               The parent scroll element that the el's side is scrolled past, or null if there is no such element
 */


function isScrolledPast(el, elSide, parentSide) {
  var parent = getParentAutoScrollElement(el, true),
      elSideVal = getRect(el)[elSide];
  /* jshint boss:true */

  while (parent) {
    var parentSideVal = getRect(parent)[parentSide],
        visible = void 0;

    if (parentSide === 'top' || parentSide === 'left') {
      visible = elSideVal >= parentSideVal;
    } else {
      visible = elSideVal <= parentSideVal;
    }

    if (!visible) return parent;
    if (parent === getWindowScrollingElement()) break;
    parent = getParentAutoScrollElement(parent, false);
  }

  return false;
}
/**
 * Gets nth child of el, ignoring hidden children, sortable's elements (does not ignore clone if it's visible)
 * and non-draggable elements
 * @param  {HTMLElement} el       The parent element
 * @param  {Number} childNum      The index of the child
 * @param  {Object} options       Parent Sortable's options
 * @return {HTMLElement}          The child at index childNum, or null if not found
 */


function getChild(el, childNum, options, includeDragEl) {
  var currentChild = 0,
      i = 0,
      children = el.children;

  while (i < children.length) {
    if (children[i].style.display !== 'none' && children[i] !== Sortable.ghost && (includeDragEl || children[i] !== Sortable.dragged) && closest(children[i], options.draggable, el, false)) {
      if (currentChild === childNum) {
        return children[i];
      }

      currentChild++;
    }

    i++;
  }

  return null;
}
/**
 * Gets the last child in the el, ignoring ghostEl or invisible elements (clones)
 * @param  {HTMLElement} el       Parent element
 * @param  {selector} selector    Any other elements that should be ignored
 * @return {HTMLElement}          The last child, ignoring ghostEl
 */


function lastChild(el, selector) {
  var last = el.lastElementChild;

  while (last && (last === Sortable.ghost || css(last, 'display') === 'none' || selector && !matches(last, selector))) {
    last = last.previousElementSibling;
  }

  return last || null;
}
/**
 * Returns the index of an element within its parent for a selected set of
 * elements
 * @param  {HTMLElement} el
 * @param  {selector} selector
 * @return {number}
 */


function sortable_esm_index(el, selector) {
  var index = 0;

  if (!el || !el.parentNode) {
    return -1;
  }
  /* jshint boss:true */


  while (el = el.previousElementSibling) {
    if (el.nodeName.toUpperCase() !== 'TEMPLATE' && el !== Sortable.clone && (!selector || matches(el, selector))) {
      index++;
    }
  }

  return index;
}
/**
 * Returns the scroll offset of the given element, added with all the scroll offsets of parent elements.
 * The value is returned in real pixels.
 * @param  {HTMLElement} el
 * @return {Array}             Offsets in the format of [left, top]
 */


function getRelativeScrollOffset(el) {
  var offsetLeft = 0,
      offsetTop = 0,
      winScroller = getWindowScrollingElement();

  if (el) {
    do {
      var elMatrix = matrix(el),
          scaleX = elMatrix.a,
          scaleY = elMatrix.d;
      offsetLeft += el.scrollLeft * scaleX;
      offsetTop += el.scrollTop * scaleY;
    } while (el !== winScroller && (el = el.parentNode));
  }

  return [offsetLeft, offsetTop];
}
/**
 * Returns the index of the object within the given array
 * @param  {Array} arr   Array that may or may not hold the object
 * @param  {Object} obj  An object that has a key-value pair unique to and identical to a key-value pair in the object you want to find
 * @return {Number}      The index of the object in the array, or -1
 */


function indexOfObject(arr, obj) {
  for (var i in arr) {
    if (!arr.hasOwnProperty(i)) continue;

    for (var key in obj) {
      if (obj.hasOwnProperty(key) && obj[key] === arr[i][key]) return Number(i);
    }
  }

  return -1;
}

function getParentAutoScrollElement(el, includeSelf) {
  // skip to window
  if (!el || !el.getBoundingClientRect) return getWindowScrollingElement();
  var elem = el;
  var gotSelf = false;

  do {
    // we don't need to get elem css if it isn't even overflowing in the first place (performance)
    if (elem.clientWidth < elem.scrollWidth || elem.clientHeight < elem.scrollHeight) {
      var elemCSS = css(elem);

      if (elem.clientWidth < elem.scrollWidth && (elemCSS.overflowX == 'auto' || elemCSS.overflowX == 'scroll') || elem.clientHeight < elem.scrollHeight && (elemCSS.overflowY == 'auto' || elemCSS.overflowY == 'scroll')) {
        if (!elem.getBoundingClientRect || elem === document.body) return getWindowScrollingElement();
        if (gotSelf || includeSelf) return elem;
        gotSelf = true;
      }
    }
    /* jshint boss:true */

  } while (elem = elem.parentNode);

  return getWindowScrollingElement();
}

function extend(dst, src) {
  if (dst && src) {
    for (var key in src) {
      if (src.hasOwnProperty(key)) {
        dst[key] = src[key];
      }
    }
  }

  return dst;
}

function isRectEqual(rect1, rect2) {
  return Math.round(rect1.top) === Math.round(rect2.top) && Math.round(rect1.left) === Math.round(rect2.left) && Math.round(rect1.height) === Math.round(rect2.height) && Math.round(rect1.width) === Math.round(rect2.width);
}

var _throttleTimeout;

function throttle(callback, ms) {
  return function () {
    if (!_throttleTimeout) {
      var args = arguments,
          _this = this;

      if (args.length === 1) {
        callback.call(_this, args[0]);
      } else {
        callback.apply(_this, args);
      }

      _throttleTimeout = setTimeout(function () {
        _throttleTimeout = void 0;
      }, ms);
    }
  };
}

function cancelThrottle() {
  clearTimeout(_throttleTimeout);
  _throttleTimeout = void 0;
}

function scrollBy(el, x, y) {
  el.scrollLeft += x;
  el.scrollTop += y;
}

function clone(el) {
  var Polymer = window.Polymer;
  var $ = window.jQuery || window.Zepto;

  if (Polymer && Polymer.dom) {
    return Polymer.dom(el).cloneNode(true);
  } else if ($) {
    return $(el).clone(true)[0];
  } else {
    return el.cloneNode(true);
  }
}

function setRect(el, rect) {
  css(el, 'position', 'absolute');
  css(el, 'top', rect.top);
  css(el, 'left', rect.left);
  css(el, 'width', rect.width);
  css(el, 'height', rect.height);
}

function unsetRect(el) {
  css(el, 'position', '');
  css(el, 'top', '');
  css(el, 'left', '');
  css(el, 'width', '');
  css(el, 'height', '');
}

var expando = 'Sortable' + new Date().getTime();

function AnimationStateManager() {
  var animationStates = [],
      animationCallbackId;
  return {
    captureAnimationState: function captureAnimationState() {
      animationStates = [];
      if (!this.options.animation) return;
      var children = [].slice.call(this.el.children);
      children.forEach(function (child) {
        if (css(child, 'display') === 'none' || child === Sortable.ghost) return;
        animationStates.push({
          target: child,
          rect: getRect(child)
        });

        var fromRect = sortable_esm_objectSpread2({}, animationStates[animationStates.length - 1].rect); // If animating: compensate for current animation


        if (child.thisAnimationDuration) {
          var childMatrix = matrix(child, true);

          if (childMatrix) {
            fromRect.top -= childMatrix.f;
            fromRect.left -= childMatrix.e;
          }
        }

        child.fromRect = fromRect;
      });
    },
    addAnimationState: function addAnimationState(state) {
      animationStates.push(state);
    },
    removeAnimationState: function removeAnimationState(target) {
      animationStates.splice(indexOfObject(animationStates, {
        target: target
      }), 1);
    },
    animateAll: function animateAll(callback) {
      var _this = this;

      if (!this.options.animation) {
        clearTimeout(animationCallbackId);
        if (typeof callback === 'function') callback();
        return;
      }

      var animating = false,
          animationTime = 0;
      animationStates.forEach(function (state) {
        var time = 0,
            target = state.target,
            fromRect = target.fromRect,
            toRect = getRect(target),
            prevFromRect = target.prevFromRect,
            prevToRect = target.prevToRect,
            animatingRect = state.rect,
            targetMatrix = matrix(target, true);

        if (targetMatrix) {
          // Compensate for current animation
          toRect.top -= targetMatrix.f;
          toRect.left -= targetMatrix.e;
        }

        target.toRect = toRect;

        if (target.thisAnimationDuration) {
          // Could also check if animatingRect is between fromRect and toRect
          if (isRectEqual(prevFromRect, toRect) && !isRectEqual(fromRect, toRect) && // Make sure animatingRect is on line between toRect & fromRect
          (animatingRect.top - toRect.top) / (animatingRect.left - toRect.left) === (fromRect.top - toRect.top) / (fromRect.left - toRect.left)) {
            // If returning to same place as started from animation and on same axis
            time = calculateRealTime(animatingRect, prevFromRect, prevToRect, _this.options);
          }
        } // if fromRect != toRect: animate


        if (!isRectEqual(toRect, fromRect)) {
          target.prevFromRect = fromRect;
          target.prevToRect = toRect;

          if (!time) {
            time = _this.options.animation;
          }

          _this.animate(target, animatingRect, toRect, time);
        }

        if (time) {
          animating = true;
          animationTime = Math.max(animationTime, time);
          clearTimeout(target.animationResetTimer);
          target.animationResetTimer = setTimeout(function () {
            target.animationTime = 0;
            target.prevFromRect = null;
            target.fromRect = null;
            target.prevToRect = null;
            target.thisAnimationDuration = null;
          }, time);
          target.thisAnimationDuration = time;
        }
      });
      clearTimeout(animationCallbackId);

      if (!animating) {
        if (typeof callback === 'function') callback();
      } else {
        animationCallbackId = setTimeout(function () {
          if (typeof callback === 'function') callback();
        }, animationTime);
      }

      animationStates = [];
    },
    animate: function animate(target, currentRect, toRect, duration) {
      if (duration) {
        css(target, 'transition', '');
        css(target, 'transform', '');
        var elMatrix = matrix(this.el),
            scaleX = elMatrix && elMatrix.a,
            scaleY = elMatrix && elMatrix.d,
            translateX = (currentRect.left - toRect.left) / (scaleX || 1),
            translateY = (currentRect.top - toRect.top) / (scaleY || 1);
        target.animatingX = !!translateX;
        target.animatingY = !!translateY;
        css(target, 'transform', 'translate3d(' + translateX + 'px,' + translateY + 'px,0)');
        this.forRepaintDummy = repaint(target); // repaint

        css(target, 'transition', 'transform ' + duration + 'ms' + (this.options.easing ? ' ' + this.options.easing : ''));
        css(target, 'transform', 'translate3d(0,0,0)');
        typeof target.animated === 'number' && clearTimeout(target.animated);
        target.animated = setTimeout(function () {
          css(target, 'transition', '');
          css(target, 'transform', '');
          target.animated = false;
          target.animatingX = false;
          target.animatingY = false;
        }, duration);
      }
    }
  };
}

function repaint(target) {
  return target.offsetWidth;
}

function calculateRealTime(animatingRect, fromRect, toRect, options) {
  return Math.sqrt(Math.pow(fromRect.top - animatingRect.top, 2) + Math.pow(fromRect.left - animatingRect.left, 2)) / Math.sqrt(Math.pow(fromRect.top - toRect.top, 2) + Math.pow(fromRect.left - toRect.left, 2)) * options.animation;
}

var plugins = [];
var defaults = {
  initializeByDefault: true
};
var PluginManager = {
  mount: function mount(plugin) {
    // Set default static properties
    for (var option in defaults) {
      if (defaults.hasOwnProperty(option) && !(option in plugin)) {
        plugin[option] = defaults[option];
      }
    }

    plugins.forEach(function (p) {
      if (p.pluginName === plugin.pluginName) {
        throw "Sortable: Cannot mount plugin ".concat(plugin.pluginName, " more than once");
      }
    });
    plugins.push(plugin);
  },
  pluginEvent: function pluginEvent(eventName, sortable, evt) {
    var _this = this;

    this.eventCanceled = false;

    evt.cancel = function () {
      _this.eventCanceled = true;
    };

    var eventNameGlobal = eventName + 'Global';
    plugins.forEach(function (plugin) {
      if (!sortable[plugin.pluginName]) return; // Fire global events if it exists in this sortable

      if (sortable[plugin.pluginName][eventNameGlobal]) {
        sortable[plugin.pluginName][eventNameGlobal](sortable_esm_objectSpread2({
          sortable: sortable
        }, evt));
      } // Only fire plugin event if plugin is enabled in this sortable,
      // and plugin has event defined


      if (sortable.options[plugin.pluginName] && sortable[plugin.pluginName][eventName]) {
        sortable[plugin.pluginName][eventName](sortable_esm_objectSpread2({
          sortable: sortable
        }, evt));
      }
    });
  },
  initializePlugins: function initializePlugins(sortable, el, defaults, options) {
    plugins.forEach(function (plugin) {
      var pluginName = plugin.pluginName;
      if (!sortable.options[pluginName] && !plugin.initializeByDefault) return;
      var initialized = new plugin(sortable, el, sortable.options);
      initialized.sortable = sortable;
      initialized.options = sortable.options;
      sortable[pluginName] = initialized; // Add default options from plugin

      _extends(defaults, initialized.defaults);
    });

    for (var option in sortable.options) {
      if (!sortable.options.hasOwnProperty(option)) continue;
      var modified = this.modifyOption(sortable, option, sortable.options[option]);

      if (typeof modified !== 'undefined') {
        sortable.options[option] = modified;
      }
    }
  },
  getEventProperties: function getEventProperties(name, sortable) {
    var eventProperties = {};
    plugins.forEach(function (plugin) {
      if (typeof plugin.eventProperties !== 'function') return;

      _extends(eventProperties, plugin.eventProperties.call(sortable[plugin.pluginName], name));
    });
    return eventProperties;
  },
  modifyOption: function modifyOption(sortable, name, value) {
    var modifiedValue;
    plugins.forEach(function (plugin) {
      // Plugin must exist on the Sortable
      if (!sortable[plugin.pluginName]) return; // If static option listener exists for this option, call in the context of the Sortable's instance of this plugin

      if (plugin.optionListeners && typeof plugin.optionListeners[name] === 'function') {
        modifiedValue = plugin.optionListeners[name].call(sortable[plugin.pluginName], value);
      }
    });
    return modifiedValue;
  }
};

function dispatchEvent(_ref) {
  var sortable = _ref.sortable,
      rootEl = _ref.rootEl,
      name = _ref.name,
      targetEl = _ref.targetEl,
      cloneEl = _ref.cloneEl,
      toEl = _ref.toEl,
      fromEl = _ref.fromEl,
      oldIndex = _ref.oldIndex,
      newIndex = _ref.newIndex,
      oldDraggableIndex = _ref.oldDraggableIndex,
      newDraggableIndex = _ref.newDraggableIndex,
      originalEvent = _ref.originalEvent,
      putSortable = _ref.putSortable,
      extraEventProperties = _ref.extraEventProperties;
  sortable = sortable || rootEl && rootEl[expando];
  if (!sortable) return;
  var evt,
      options = sortable.options,
      onName = 'on' + name.charAt(0).toUpperCase() + name.substr(1); // Support for new CustomEvent feature

  if (window.CustomEvent && !IE11OrLess && !Edge) {
    evt = new CustomEvent(name, {
      bubbles: true,
      cancelable: true
    });
  } else {
    evt = document.createEvent('Event');
    evt.initEvent(name, true, true);
  }

  evt.to = toEl || rootEl;
  evt.from = fromEl || rootEl;
  evt.item = targetEl || rootEl;
  evt.clone = cloneEl;
  evt.oldIndex = oldIndex;
  evt.newIndex = newIndex;
  evt.oldDraggableIndex = oldDraggableIndex;
  evt.newDraggableIndex = newDraggableIndex;
  evt.originalEvent = originalEvent;
  evt.pullMode = putSortable ? putSortable.lastPutMode : undefined;

  var allEventProperties = sortable_esm_objectSpread2(sortable_esm_objectSpread2({}, extraEventProperties), PluginManager.getEventProperties(name, sortable));

  for (var option in allEventProperties) {
    evt[option] = allEventProperties[option];
  }

  if (rootEl) {
    rootEl.dispatchEvent(evt);
  }

  if (options[onName]) {
    options[onName].call(sortable, evt);
  }
}

var _excluded = ["evt"];

var pluginEvent = function pluginEvent(eventName, sortable) {
  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      originalEvent = _ref.evt,
      data = sortable_esm_objectWithoutProperties(_ref, _excluded);

  PluginManager.pluginEvent.bind(Sortable)(eventName, sortable, sortable_esm_objectSpread2({
    dragEl: dragEl,
    parentEl: parentEl,
    ghostEl: ghostEl,
    rootEl: rootEl,
    nextEl: nextEl,
    lastDownEl: lastDownEl,
    cloneEl: cloneEl,
    cloneHidden: cloneHidden,
    dragStarted: moved,
    putSortable: putSortable,
    activeSortable: Sortable.active,
    originalEvent: originalEvent,
    oldIndex: oldIndex,
    oldDraggableIndex: oldDraggableIndex,
    newIndex: newIndex,
    newDraggableIndex: newDraggableIndex,
    hideGhostForTarget: _hideGhostForTarget,
    unhideGhostForTarget: _unhideGhostForTarget,
    cloneNowHidden: function cloneNowHidden() {
      cloneHidden = true;
    },
    cloneNowShown: function cloneNowShown() {
      cloneHidden = false;
    },
    dispatchSortableEvent: function dispatchSortableEvent(name) {
      _dispatchEvent({
        sortable: sortable,
        name: name,
        originalEvent: originalEvent
      });
    }
  }, data));
};

function _dispatchEvent(info) {
  dispatchEvent(sortable_esm_objectSpread2({
    putSortable: putSortable,
    cloneEl: cloneEl,
    targetEl: dragEl,
    rootEl: rootEl,
    oldIndex: oldIndex,
    oldDraggableIndex: oldDraggableIndex,
    newIndex: newIndex,
    newDraggableIndex: newDraggableIndex
  }, info));
}

var dragEl,
    parentEl,
    ghostEl,
    rootEl,
    nextEl,
    lastDownEl,
    cloneEl,
    cloneHidden,
    oldIndex,
    newIndex,
    oldDraggableIndex,
    newDraggableIndex,
    activeGroup,
    putSortable,
    awaitingDragStarted = false,
    ignoreNextClick = false,
    sortables = [],
    tapEvt,
    touchEvt,
    lastDx,
    lastDy,
    tapDistanceLeft,
    tapDistanceTop,
    moved,
    lastTarget,
    lastDirection,
    pastFirstInvertThresh = false,
    isCircumstantialInvert = false,
    targetMoveDistance,
    // For positioning ghost absolutely
ghostRelativeParent,
    ghostRelativeParentInitialScroll = [],
    // (left, top)
_silent = false,
    savedInputChecked = [];
/** @const */

var documentExists = typeof document !== 'undefined',
    PositionGhostAbsolutely = IOS,
    CSSFloatProperty = Edge || IE11OrLess ? 'cssFloat' : 'float',
    // This will not pass for IE9, because IE9 DnD only works on anchors
supportDraggable = documentExists && !ChromeForAndroid && !IOS && 'draggable' in document.createElement('div'),
    supportCssPointerEvents = function () {
  if (!documentExists) return; // false when <= IE11

  if (IE11OrLess) {
    return false;
  }

  var el = document.createElement('x');
  el.style.cssText = 'pointer-events:auto';
  return el.style.pointerEvents === 'auto';
}(),
    _detectDirection = function _detectDirection(el, options) {
  var elCSS = css(el),
      elWidth = parseInt(elCSS.width) - parseInt(elCSS.paddingLeft) - parseInt(elCSS.paddingRight) - parseInt(elCSS.borderLeftWidth) - parseInt(elCSS.borderRightWidth),
      child1 = getChild(el, 0, options),
      child2 = getChild(el, 1, options),
      firstChildCSS = child1 && css(child1),
      secondChildCSS = child2 && css(child2),
      firstChildWidth = firstChildCSS && parseInt(firstChildCSS.marginLeft) + parseInt(firstChildCSS.marginRight) + getRect(child1).width,
      secondChildWidth = secondChildCSS && parseInt(secondChildCSS.marginLeft) + parseInt(secondChildCSS.marginRight) + getRect(child2).width;

  if (elCSS.display === 'flex') {
    return elCSS.flexDirection === 'column' || elCSS.flexDirection === 'column-reverse' ? 'vertical' : 'horizontal';
  }

  if (elCSS.display === 'grid') {
    return elCSS.gridTemplateColumns.split(' ').length <= 1 ? 'vertical' : 'horizontal';
  }

  if (child1 && firstChildCSS["float"] && firstChildCSS["float"] !== 'none') {
    var touchingSideChild2 = firstChildCSS["float"] === 'left' ? 'left' : 'right';
    return child2 && (secondChildCSS.clear === 'both' || secondChildCSS.clear === touchingSideChild2) ? 'vertical' : 'horizontal';
  }

  return child1 && (firstChildCSS.display === 'block' || firstChildCSS.display === 'flex' || firstChildCSS.display === 'table' || firstChildCSS.display === 'grid' || firstChildWidth >= elWidth && elCSS[CSSFloatProperty] === 'none' || child2 && elCSS[CSSFloatProperty] === 'none' && firstChildWidth + secondChildWidth > elWidth) ? 'vertical' : 'horizontal';
},
    _dragElInRowColumn = function _dragElInRowColumn(dragRect, targetRect, vertical) {
  var dragElS1Opp = vertical ? dragRect.left : dragRect.top,
      dragElS2Opp = vertical ? dragRect.right : dragRect.bottom,
      dragElOppLength = vertical ? dragRect.width : dragRect.height,
      targetS1Opp = vertical ? targetRect.left : targetRect.top,
      targetS2Opp = vertical ? targetRect.right : targetRect.bottom,
      targetOppLength = vertical ? targetRect.width : targetRect.height;
  return dragElS1Opp === targetS1Opp || dragElS2Opp === targetS2Opp || dragElS1Opp + dragElOppLength / 2 === targetS1Opp + targetOppLength / 2;
},

/**
 * Detects first nearest empty sortable to X and Y position using emptyInsertThreshold.
 * @param  {Number} x      X position
 * @param  {Number} y      Y position
 * @return {HTMLElement}   Element of the first found nearest Sortable
 */
_detectNearestEmptySortable = function _detectNearestEmptySortable(x, y) {
  var ret;
  sortables.some(function (sortable) {
    var threshold = sortable[expando].options.emptyInsertThreshold;
    if (!threshold || lastChild(sortable)) return;
    var rect = getRect(sortable),
        insideHorizontally = x >= rect.left - threshold && x <= rect.right + threshold,
        insideVertically = y >= rect.top - threshold && y <= rect.bottom + threshold;

    if (insideHorizontally && insideVertically) {
      return ret = sortable;
    }
  });
  return ret;
},
    _prepareGroup = function _prepareGroup(options) {
  function toFn(value, pull) {
    return function (to, from, dragEl, evt) {
      var sameGroup = to.options.group.name && from.options.group.name && to.options.group.name === from.options.group.name;

      if (value == null && (pull || sameGroup)) {
        // Default pull value
        // Default pull and put value if same group
        return true;
      } else if (value == null || value === false) {
        return false;
      } else if (pull && value === 'clone') {
        return value;
      } else if (typeof value === 'function') {
        return toFn(value(to, from, dragEl, evt), pull)(to, from, dragEl, evt);
      } else {
        var otherGroup = (pull ? to : from).options.group.name;
        return value === true || typeof value === 'string' && value === otherGroup || value.join && value.indexOf(otherGroup) > -1;
      }
    };
  }

  var group = {};
  var originalGroup = options.group;

  if (!originalGroup || sortable_esm_typeof(originalGroup) != 'object') {
    originalGroup = {
      name: originalGroup
    };
  }

  group.name = originalGroup.name;
  group.checkPull = toFn(originalGroup.pull, true);
  group.checkPut = toFn(originalGroup.put);
  group.revertClone = originalGroup.revertClone;
  options.group = group;
},
    _hideGhostForTarget = function _hideGhostForTarget() {
  if (!supportCssPointerEvents && ghostEl) {
    css(ghostEl, 'display', 'none');
  }
},
    _unhideGhostForTarget = function _unhideGhostForTarget() {
  if (!supportCssPointerEvents && ghostEl) {
    css(ghostEl, 'display', '');
  }
}; // #1184 fix - Prevent click event on fallback if dragged but item not changed position


if (documentExists) {
  document.addEventListener('click', function (evt) {
    if (ignoreNextClick) {
      evt.preventDefault();
      evt.stopPropagation && evt.stopPropagation();
      evt.stopImmediatePropagation && evt.stopImmediatePropagation();
      ignoreNextClick = false;
      return false;
    }
  }, true);
}

var nearestEmptyInsertDetectEvent = function nearestEmptyInsertDetectEvent(evt) {
  if (dragEl) {
    evt = evt.touches ? evt.touches[0] : evt;

    var nearest = _detectNearestEmptySortable(evt.clientX, evt.clientY);

    if (nearest) {
      // Create imitation event
      var event = {};

      for (var i in evt) {
        if (evt.hasOwnProperty(i)) {
          event[i] = evt[i];
        }
      }

      event.target = event.rootEl = nearest;
      event.preventDefault = void 0;
      event.stopPropagation = void 0;

      nearest[expando]._onDragOver(event);
    }
  }
};

var _checkOutsideTargetEl = function _checkOutsideTargetEl(evt) {
  if (dragEl) {
    dragEl.parentNode[expando]._isOutsideThisEl(evt.target);
  }
};
/**
 * @class  Sortable
 * @param  {HTMLElement}  el
 * @param  {Object}       [options]
 */


function Sortable(el, options) {
  if (!(el && el.nodeType && el.nodeType === 1)) {
    throw "Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(el));
  }

  this.el = el; // root element

  this.options = options = _extends({}, options); // Export instance

  el[expando] = this;
  var defaults = {
    group: null,
    sort: true,
    disabled: false,
    store: null,
    handle: null,
    draggable: /^[uo]l$/i.test(el.nodeName) ? '>li' : '>*',
    swapThreshold: 1,
    // percentage; 0 <= x <= 1
    invertSwap: false,
    // invert always
    invertedSwapThreshold: null,
    // will be set to same as swapThreshold if default
    removeCloneOnHide: true,
    direction: function direction() {
      return _detectDirection(el, this.options);
    },
    ghostClass: 'sortable-ghost',
    chosenClass: 'sortable-chosen',
    dragClass: 'sortable-drag',
    ignore: 'a, img',
    filter: null,
    preventOnFilter: true,
    animation: 0,
    easing: null,
    setData: function setData(dataTransfer, dragEl) {
      dataTransfer.setData('Text', dragEl.textContent);
    },
    dropBubble: false,
    dragoverBubble: false,
    dataIdAttr: 'data-id',
    delay: 0,
    delayOnTouchOnly: false,
    touchStartThreshold: (Number.parseInt ? Number : window).parseInt(window.devicePixelRatio, 10) || 1,
    forceFallback: false,
    fallbackClass: 'sortable-fallback',
    fallbackOnBody: false,
    fallbackTolerance: 0,
    fallbackOffset: {
      x: 0,
      y: 0
    },
    supportPointer: Sortable.supportPointer !== false && 'PointerEvent' in window && !Safari,
    emptyInsertThreshold: 5
  };
  PluginManager.initializePlugins(this, el, defaults); // Set default options

  for (var name in defaults) {
    !(name in options) && (options[name] = defaults[name]);
  }

  _prepareGroup(options); // Bind all private methods


  for (var fn in this) {
    if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {
      this[fn] = this[fn].bind(this);
    }
  } // Setup drag mode


  this.nativeDraggable = options.forceFallback ? false : supportDraggable;

  if (this.nativeDraggable) {
    // Touch start threshold cannot be greater than the native dragstart threshold
    this.options.touchStartThreshold = 1;
  } // Bind events


  if (options.supportPointer) {
    on(el, 'pointerdown', this._onTapStart);
  } else {
    on(el, 'mousedown', this._onTapStart);
    on(el, 'touchstart', this._onTapStart);
  }

  if (this.nativeDraggable) {
    on(el, 'dragover', this);
    on(el, 'dragenter', this);
  }

  sortables.push(this.el); // Restore sorting

  options.store && options.store.get && this.sort(options.store.get(this) || []); // Add animation state manager

  _extends(this, AnimationStateManager());
}

Sortable.prototype =
/** @lends Sortable.prototype */
{
  constructor: Sortable,
  _isOutsideThisEl: function _isOutsideThisEl(target) {
    if (!this.el.contains(target) && target !== this.el) {
      lastTarget = null;
    }
  },
  _getDirection: function _getDirection(evt, target) {
    return typeof this.options.direction === 'function' ? this.options.direction.call(this, evt, target, dragEl) : this.options.direction;
  },
  _onTapStart: function _onTapStart(
  /** Event|TouchEvent */
  evt) {
    if (!evt.cancelable) return;

    var _this = this,
        el = this.el,
        options = this.options,
        preventOnFilter = options.preventOnFilter,
        type = evt.type,
        touch = evt.touches && evt.touches[0] || evt.pointerType && evt.pointerType === 'touch' && evt,
        target = (touch || evt).target,
        originalTarget = evt.target.shadowRoot && (evt.path && evt.path[0] || evt.composedPath && evt.composedPath()[0]) || target,
        filter = options.filter;

    _saveInputCheckedState(el); // Don't trigger start event when an element is been dragged, otherwise the evt.oldindex always wrong when set option.group.


    if (dragEl) {
      return;
    }

    if (/mousedown|pointerdown/.test(type) && evt.button !== 0 || options.disabled) {
      return; // only left button and enabled
    } // cancel dnd if original target is content editable


    if (originalTarget.isContentEditable) {
      return;
    } // Safari ignores further event handling after mousedown


    if (!this.nativeDraggable && Safari && target && target.tagName.toUpperCase() === 'SELECT') {
      return;
    }

    target = closest(target, options.draggable, el, false);

    if (target && target.animated) {
      return;
    }

    if (lastDownEl === target) {
      // Ignoring duplicate `down`
      return;
    } // Get the index of the dragged element within its parent


    oldIndex = sortable_esm_index(target);
    oldDraggableIndex = sortable_esm_index(target, options.draggable); // Check filter

    if (typeof filter === 'function') {
      if (filter.call(this, evt, target, this)) {
        _dispatchEvent({
          sortable: _this,
          rootEl: originalTarget,
          name: 'filter',
          targetEl: target,
          toEl: el,
          fromEl: el
        });

        pluginEvent('filter', _this, {
          evt: evt
        });
        preventOnFilter && evt.cancelable && evt.preventDefault();
        return; // cancel dnd
      }
    } else if (filter) {
      filter = filter.split(',').some(function (criteria) {
        criteria = closest(originalTarget, criteria.trim(), el, false);

        if (criteria) {
          _dispatchEvent({
            sortable: _this,
            rootEl: criteria,
            name: 'filter',
            targetEl: target,
            fromEl: el,
            toEl: el
          });

          pluginEvent('filter', _this, {
            evt: evt
          });
          return true;
        }
      });

      if (filter) {
        preventOnFilter && evt.cancelable && evt.preventDefault();
        return; // cancel dnd
      }
    }

    if (options.handle && !closest(originalTarget, options.handle, el, false)) {
      return;
    } // Prepare `dragstart`


    this._prepareDragStart(evt, touch, target);
  },
  _prepareDragStart: function _prepareDragStart(
  /** Event */
  evt,
  /** Touch */
  touch,
  /** HTMLElement */
  target) {
    var _this = this,
        el = _this.el,
        options = _this.options,
        ownerDocument = el.ownerDocument,
        dragStartFn;

    if (target && !dragEl && target.parentNode === el) {
      var dragRect = getRect(target);
      rootEl = el;
      dragEl = target;
      parentEl = dragEl.parentNode;
      nextEl = dragEl.nextSibling;
      lastDownEl = target;
      activeGroup = options.group;
      Sortable.dragged = dragEl;
      tapEvt = {
        target: dragEl,
        clientX: (touch || evt).clientX,
        clientY: (touch || evt).clientY
      };
      tapDistanceLeft = tapEvt.clientX - dragRect.left;
      tapDistanceTop = tapEvt.clientY - dragRect.top;
      this._lastX = (touch || evt).clientX;
      this._lastY = (touch || evt).clientY;
      dragEl.style['will-change'] = 'all';

      dragStartFn = function dragStartFn() {
        pluginEvent('delayEnded', _this, {
          evt: evt
        });

        if (Sortable.eventCanceled) {
          _this._onDrop();

          return;
        } // Delayed drag has been triggered
        // we can re-enable the events: touchmove/mousemove


        _this._disableDelayedDragEvents();

        if (!FireFox && _this.nativeDraggable) {
          dragEl.draggable = true;
        } // Bind the events: dragstart/dragend


        _this._triggerDragStart(evt, touch); // Drag start event


        _dispatchEvent({
          sortable: _this,
          name: 'choose',
          originalEvent: evt
        }); // Chosen item


        toggleClass(dragEl, options.chosenClass, true);
      }; // Disable "draggable"


      options.ignore.split(',').forEach(function (criteria) {
        sortable_esm_find(dragEl, criteria.trim(), _disableDraggable);
      });
      on(ownerDocument, 'dragover', nearestEmptyInsertDetectEvent);
      on(ownerDocument, 'mousemove', nearestEmptyInsertDetectEvent);
      on(ownerDocument, 'touchmove', nearestEmptyInsertDetectEvent);
      on(ownerDocument, 'mouseup', _this._onDrop);
      on(ownerDocument, 'touchend', _this._onDrop);
      on(ownerDocument, 'touchcancel', _this._onDrop); // Make dragEl draggable (must be before delay for FireFox)

      if (FireFox && this.nativeDraggable) {
        this.options.touchStartThreshold = 4;
        dragEl.draggable = true;
      }

      pluginEvent('delayStart', this, {
        evt: evt
      }); // Delay is impossible for native DnD in Edge or IE

      if (options.delay && (!options.delayOnTouchOnly || touch) && (!this.nativeDraggable || !(Edge || IE11OrLess))) {
        if (Sortable.eventCanceled) {
          this._onDrop();

          return;
        } // If the user moves the pointer or let go the click or touch
        // before the delay has been reached:
        // disable the delayed drag


        on(ownerDocument, 'mouseup', _this._disableDelayedDrag);
        on(ownerDocument, 'touchend', _this._disableDelayedDrag);
        on(ownerDocument, 'touchcancel', _this._disableDelayedDrag);
        on(ownerDocument, 'mousemove', _this._delayedDragTouchMoveHandler);
        on(ownerDocument, 'touchmove', _this._delayedDragTouchMoveHandler);
        options.supportPointer && on(ownerDocument, 'pointermove', _this._delayedDragTouchMoveHandler);
        _this._dragStartTimer = setTimeout(dragStartFn, options.delay);
      } else {
        dragStartFn();
      }
    }
  },
  _delayedDragTouchMoveHandler: function _delayedDragTouchMoveHandler(
  /** TouchEvent|PointerEvent **/
  e) {
    var touch = e.touches ? e.touches[0] : e;

    if (Math.max(Math.abs(touch.clientX - this._lastX), Math.abs(touch.clientY - this._lastY)) >= Math.floor(this.options.touchStartThreshold / (this.nativeDraggable && window.devicePixelRatio || 1))) {
      this._disableDelayedDrag();
    }
  },
  _disableDelayedDrag: function _disableDelayedDrag() {
    dragEl && _disableDraggable(dragEl);
    clearTimeout(this._dragStartTimer);

    this._disableDelayedDragEvents();
  },
  _disableDelayedDragEvents: function _disableDelayedDragEvents() {
    var ownerDocument = this.el.ownerDocument;
    off(ownerDocument, 'mouseup', this._disableDelayedDrag);
    off(ownerDocument, 'touchend', this._disableDelayedDrag);
    off(ownerDocument, 'touchcancel', this._disableDelayedDrag);
    off(ownerDocument, 'mousemove', this._delayedDragTouchMoveHandler);
    off(ownerDocument, 'touchmove', this._delayedDragTouchMoveHandler);
    off(ownerDocument, 'pointermove', this._delayedDragTouchMoveHandler);
  },
  _triggerDragStart: function _triggerDragStart(
  /** Event */
  evt,
  /** Touch */
  touch) {
    touch = touch || evt.pointerType == 'touch' && evt;

    if (!this.nativeDraggable || touch) {
      if (this.options.supportPointer) {
        on(document, 'pointermove', this._onTouchMove);
      } else if (touch) {
        on(document, 'touchmove', this._onTouchMove);
      } else {
        on(document, 'mousemove', this._onTouchMove);
      }
    } else {
      on(dragEl, 'dragend', this);
      on(rootEl, 'dragstart', this._onDragStart);
    }

    try {
      if (document.selection) {
        // Timeout neccessary for IE9
        _nextTick(function () {
          document.selection.empty();
        });
      } else {
        window.getSelection().removeAllRanges();
      }
    } catch (err) {}
  },
  _dragStarted: function _dragStarted(fallback, evt) {

    awaitingDragStarted = false;

    if (rootEl && dragEl) {
      pluginEvent('dragStarted', this, {
        evt: evt
      });

      if (this.nativeDraggable) {
        on(document, 'dragover', _checkOutsideTargetEl);
      }

      var options = this.options; // Apply effect

      !fallback && toggleClass(dragEl, options.dragClass, false);
      toggleClass(dragEl, options.ghostClass, true);
      Sortable.active = this;
      fallback && this._appendGhost(); // Drag start event

      _dispatchEvent({
        sortable: this,
        name: 'start',
        originalEvent: evt
      });
    } else {
      this._nulling();
    }
  },
  _emulateDragOver: function _emulateDragOver() {
    if (touchEvt) {
      this._lastX = touchEvt.clientX;
      this._lastY = touchEvt.clientY;

      _hideGhostForTarget();

      var target = document.elementFromPoint(touchEvt.clientX, touchEvt.clientY);
      var parent = target;

      while (target && target.shadowRoot) {
        target = target.shadowRoot.elementFromPoint(touchEvt.clientX, touchEvt.clientY);
        if (target === parent) break;
        parent = target;
      }

      dragEl.parentNode[expando]._isOutsideThisEl(target);

      if (parent) {
        do {
          if (parent[expando]) {
            var inserted = void 0;
            inserted = parent[expando]._onDragOver({
              clientX: touchEvt.clientX,
              clientY: touchEvt.clientY,
              target: target,
              rootEl: parent
            });

            if (inserted && !this.options.dragoverBubble) {
              break;
            }
          }

          target = parent; // store last element
        }
        /* jshint boss:true */
        while (parent = parent.parentNode);
      }

      _unhideGhostForTarget();
    }
  },
  _onTouchMove: function _onTouchMove(
  /**TouchEvent*/
  evt) {
    if (tapEvt) {
      var options = this.options,
          fallbackTolerance = options.fallbackTolerance,
          fallbackOffset = options.fallbackOffset,
          touch = evt.touches ? evt.touches[0] : evt,
          ghostMatrix = ghostEl && matrix(ghostEl, true),
          scaleX = ghostEl && ghostMatrix && ghostMatrix.a,
          scaleY = ghostEl && ghostMatrix && ghostMatrix.d,
          relativeScrollOffset = PositionGhostAbsolutely && ghostRelativeParent && getRelativeScrollOffset(ghostRelativeParent),
          dx = (touch.clientX - tapEvt.clientX + fallbackOffset.x) / (scaleX || 1) + (relativeScrollOffset ? relativeScrollOffset[0] - ghostRelativeParentInitialScroll[0] : 0) / (scaleX || 1),
          dy = (touch.clientY - tapEvt.clientY + fallbackOffset.y) / (scaleY || 1) + (relativeScrollOffset ? relativeScrollOffset[1] - ghostRelativeParentInitialScroll[1] : 0) / (scaleY || 1); // only set the status to dragging, when we are actually dragging

      if (!Sortable.active && !awaitingDragStarted) {
        if (fallbackTolerance && Math.max(Math.abs(touch.clientX - this._lastX), Math.abs(touch.clientY - this._lastY)) < fallbackTolerance) {
          return;
        }

        this._onDragStart(evt, true);
      }

      if (ghostEl) {
        if (ghostMatrix) {
          ghostMatrix.e += dx - (lastDx || 0);
          ghostMatrix.f += dy - (lastDy || 0);
        } else {
          ghostMatrix = {
            a: 1,
            b: 0,
            c: 0,
            d: 1,
            e: dx,
            f: dy
          };
        }

        var cssMatrix = "matrix(".concat(ghostMatrix.a, ",").concat(ghostMatrix.b, ",").concat(ghostMatrix.c, ",").concat(ghostMatrix.d, ",").concat(ghostMatrix.e, ",").concat(ghostMatrix.f, ")");
        css(ghostEl, 'webkitTransform', cssMatrix);
        css(ghostEl, 'mozTransform', cssMatrix);
        css(ghostEl, 'msTransform', cssMatrix);
        css(ghostEl, 'transform', cssMatrix);
        lastDx = dx;
        lastDy = dy;
        touchEvt = touch;
      }

      evt.cancelable && evt.preventDefault();
    }
  },
  _appendGhost: function _appendGhost() {
    // Bug if using scale(): https://stackoverflow.com/questions/2637058
    // Not being adjusted for
    if (!ghostEl) {
      var container = this.options.fallbackOnBody ? document.body : rootEl,
          rect = getRect(dragEl, true, PositionGhostAbsolutely, true, container),
          options = this.options; // Position absolutely

      if (PositionGhostAbsolutely) {
        // Get relatively positioned parent
        ghostRelativeParent = container;

        while (css(ghostRelativeParent, 'position') === 'static' && css(ghostRelativeParent, 'transform') === 'none' && ghostRelativeParent !== document) {
          ghostRelativeParent = ghostRelativeParent.parentNode;
        }

        if (ghostRelativeParent !== document.body && ghostRelativeParent !== document.documentElement) {
          if (ghostRelativeParent === document) ghostRelativeParent = getWindowScrollingElement();
          rect.top += ghostRelativeParent.scrollTop;
          rect.left += ghostRelativeParent.scrollLeft;
        } else {
          ghostRelativeParent = getWindowScrollingElement();
        }

        ghostRelativeParentInitialScroll = getRelativeScrollOffset(ghostRelativeParent);
      }

      ghostEl = dragEl.cloneNode(true);
      toggleClass(ghostEl, options.ghostClass, false);
      toggleClass(ghostEl, options.fallbackClass, true);
      toggleClass(ghostEl, options.dragClass, true);
      css(ghostEl, 'transition', '');
      css(ghostEl, 'transform', '');
      css(ghostEl, 'box-sizing', 'border-box');
      css(ghostEl, 'margin', 0);
      css(ghostEl, 'top', rect.top);
      css(ghostEl, 'left', rect.left);
      css(ghostEl, 'width', rect.width);
      css(ghostEl, 'height', rect.height);
      css(ghostEl, 'opacity', '0.8');
      css(ghostEl, 'position', PositionGhostAbsolutely ? 'absolute' : 'fixed');
      css(ghostEl, 'zIndex', '100000');
      css(ghostEl, 'pointerEvents', 'none');
      Sortable.ghost = ghostEl;
      container.appendChild(ghostEl); // Set transform-origin

      css(ghostEl, 'transform-origin', tapDistanceLeft / parseInt(ghostEl.style.width) * 100 + '% ' + tapDistanceTop / parseInt(ghostEl.style.height) * 100 + '%');
    }
  },
  _onDragStart: function _onDragStart(
  /**Event*/
  evt,
  /**boolean*/
  fallback) {
    var _this = this;

    var dataTransfer = evt.dataTransfer;
    var options = _this.options;
    pluginEvent('dragStart', this, {
      evt: evt
    });

    if (Sortable.eventCanceled) {
      this._onDrop();

      return;
    }

    pluginEvent('setupClone', this);

    if (!Sortable.eventCanceled) {
      cloneEl = clone(dragEl);
      cloneEl.draggable = false;
      cloneEl.style['will-change'] = '';

      this._hideClone();

      toggleClass(cloneEl, this.options.chosenClass, false);
      Sortable.clone = cloneEl;
    } // #1143: IFrame support workaround


    _this.cloneId = _nextTick(function () {
      pluginEvent('clone', _this);
      if (Sortable.eventCanceled) return;

      if (!_this.options.removeCloneOnHide) {
        rootEl.insertBefore(cloneEl, dragEl);
      }

      _this._hideClone();

      _dispatchEvent({
        sortable: _this,
        name: 'clone'
      });
    });
    !fallback && toggleClass(dragEl, options.dragClass, true); // Set proper drop events

    if (fallback) {
      ignoreNextClick = true;
      _this._loopId = setInterval(_this._emulateDragOver, 50);
    } else {
      // Undo what was set in _prepareDragStart before drag started
      off(document, 'mouseup', _this._onDrop);
      off(document, 'touchend', _this._onDrop);
      off(document, 'touchcancel', _this._onDrop);

      if (dataTransfer) {
        dataTransfer.effectAllowed = 'move';
        options.setData && options.setData.call(_this, dataTransfer, dragEl);
      }

      on(document, 'drop', _this); // #1276 fix:

      css(dragEl, 'transform', 'translateZ(0)');
    }

    awaitingDragStarted = true;
    _this._dragStartId = _nextTick(_this._dragStarted.bind(_this, fallback, evt));
    on(document, 'selectstart', _this);
    moved = true;

    if (Safari) {
      css(document.body, 'user-select', 'none');
    }
  },
  // Returns true - if no further action is needed (either inserted or another condition)
  _onDragOver: function _onDragOver(
  /**Event*/
  evt) {
    var el = this.el,
        target = evt.target,
        dragRect,
        targetRect,
        revert,
        options = this.options,
        group = options.group,
        activeSortable = Sortable.active,
        isOwner = activeGroup === group,
        canSort = options.sort,
        fromSortable = putSortable || activeSortable,
        vertical,
        _this = this,
        completedFired = false;

    if (_silent) return;

    function dragOverEvent(name, extra) {
      pluginEvent(name, _this, sortable_esm_objectSpread2({
        evt: evt,
        isOwner: isOwner,
        axis: vertical ? 'vertical' : 'horizontal',
        revert: revert,
        dragRect: dragRect,
        targetRect: targetRect,
        canSort: canSort,
        fromSortable: fromSortable,
        target: target,
        completed: completed,
        onMove: function onMove(target, after) {
          return _onMove(rootEl, el, dragEl, dragRect, target, getRect(target), evt, after);
        },
        changed: changed
      }, extra));
    } // Capture animation state


    function capture() {
      dragOverEvent('dragOverAnimationCapture');

      _this.captureAnimationState();

      if (_this !== fromSortable) {
        fromSortable.captureAnimationState();
      }
    } // Return invocation when dragEl is inserted (or completed)


    function completed(insertion) {
      dragOverEvent('dragOverCompleted', {
        insertion: insertion
      });

      if (insertion) {
        // Clones must be hidden before folding animation to capture dragRectAbsolute properly
        if (isOwner) {
          activeSortable._hideClone();
        } else {
          activeSortable._showClone(_this);
        }

        if (_this !== fromSortable) {
          // Set ghost class to new sortable's ghost class
          toggleClass(dragEl, putSortable ? putSortable.options.ghostClass : activeSortable.options.ghostClass, false);
          toggleClass(dragEl, options.ghostClass, true);
        }

        if (putSortable !== _this && _this !== Sortable.active) {
          putSortable = _this;
        } else if (_this === Sortable.active && putSortable) {
          putSortable = null;
        } // Animation


        if (fromSortable === _this) {
          _this._ignoreWhileAnimating = target;
        }

        _this.animateAll(function () {
          dragOverEvent('dragOverAnimationComplete');
          _this._ignoreWhileAnimating = null;
        });

        if (_this !== fromSortable) {
          fromSortable.animateAll();
          fromSortable._ignoreWhileAnimating = null;
        }
      } // Null lastTarget if it is not inside a previously swapped element


      if (target === dragEl && !dragEl.animated || target === el && !target.animated) {
        lastTarget = null;
      } // no bubbling and not fallback


      if (!options.dragoverBubble && !evt.rootEl && target !== document) {
        dragEl.parentNode[expando]._isOutsideThisEl(evt.target); // Do not detect for empty insert if already inserted


        !insertion && nearestEmptyInsertDetectEvent(evt);
      }

      !options.dragoverBubble && evt.stopPropagation && evt.stopPropagation();
      return completedFired = true;
    } // Call when dragEl has been inserted


    function changed() {
      newIndex = sortable_esm_index(dragEl);
      newDraggableIndex = sortable_esm_index(dragEl, options.draggable);

      _dispatchEvent({
        sortable: _this,
        name: 'change',
        toEl: el,
        newIndex: newIndex,
        newDraggableIndex: newDraggableIndex,
        originalEvent: evt
      });
    }

    if (evt.preventDefault !== void 0) {
      evt.cancelable && evt.preventDefault();
    }

    target = closest(target, options.draggable, el, true);
    dragOverEvent('dragOver');
    if (Sortable.eventCanceled) return completedFired;

    if (dragEl.contains(evt.target) || target.animated && target.animatingX && target.animatingY || _this._ignoreWhileAnimating === target) {
      return completed(false);
    }

    ignoreNextClick = false;

    if (activeSortable && !options.disabled && (isOwner ? canSort || (revert = parentEl !== rootEl) // Reverting item into the original list
    : putSortable === this || (this.lastPutMode = activeGroup.checkPull(this, activeSortable, dragEl, evt)) && group.checkPut(this, activeSortable, dragEl, evt))) {
      vertical = this._getDirection(evt, target) === 'vertical';
      dragRect = getRect(dragEl);
      dragOverEvent('dragOverValid');
      if (Sortable.eventCanceled) return completedFired;

      if (revert) {
        parentEl = rootEl; // actualization

        capture();

        this._hideClone();

        dragOverEvent('revert');

        if (!Sortable.eventCanceled) {
          if (nextEl) {
            rootEl.insertBefore(dragEl, nextEl);
          } else {
            rootEl.appendChild(dragEl);
          }
        }

        return completed(true);
      }

      var elLastChild = lastChild(el, options.draggable);

      if (!elLastChild || _ghostIsLast(evt, vertical, this) && !elLastChild.animated) {
        // Insert to end of list
        // If already at end of list: Do not insert
        if (elLastChild === dragEl) {
          return completed(false);
        } // if there is a last element, it is the target


        if (elLastChild && el === evt.target) {
          target = elLastChild;
        }

        if (target) {
          targetRect = getRect(target);
        }

        if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, !!target) !== false) {
          capture();
          el.appendChild(dragEl);
          parentEl = el; // actualization

          changed();
          return completed(true);
        }
      } else if (elLastChild && _ghostIsFirst(evt, vertical, this)) {
        // Insert to start of list
        var firstChild = getChild(el, 0, options, true);

        if (firstChild === dragEl) {
          return completed(false);
        }

        target = firstChild;
        targetRect = getRect(target);

        if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, false) !== false) {
          capture();
          el.insertBefore(dragEl, firstChild);
          parentEl = el; // actualization

          changed();
          return completed(true);
        }
      } else if (target.parentNode === el) {
        targetRect = getRect(target);
        var direction = 0,
            targetBeforeFirstSwap,
            differentLevel = dragEl.parentNode !== el,
            differentRowCol = !_dragElInRowColumn(dragEl.animated && dragEl.toRect || dragRect, target.animated && target.toRect || targetRect, vertical),
            side1 = vertical ? 'top' : 'left',
            scrolledPastTop = isScrolledPast(target, 'top', 'top') || isScrolledPast(dragEl, 'top', 'top'),
            scrollBefore = scrolledPastTop ? scrolledPastTop.scrollTop : void 0;

        if (lastTarget !== target) {
          targetBeforeFirstSwap = targetRect[side1];
          pastFirstInvertThresh = false;
          isCircumstantialInvert = !differentRowCol && options.invertSwap || differentLevel;
        }

        direction = _getSwapDirection(evt, target, targetRect, vertical, differentRowCol ? 1 : options.swapThreshold, options.invertedSwapThreshold == null ? options.swapThreshold : options.invertedSwapThreshold, isCircumstantialInvert, lastTarget === target);
        var sibling;

        if (direction !== 0) {
          // Check if target is beside dragEl in respective direction (ignoring hidden elements)
          var dragIndex = sortable_esm_index(dragEl);

          do {
            dragIndex -= direction;
            sibling = parentEl.children[dragIndex];
          } while (sibling && (css(sibling, 'display') === 'none' || sibling === ghostEl));
        } // If dragEl is already beside target: Do not insert


        if (direction === 0 || sibling === target) {
          return completed(false);
        }

        lastTarget = target;
        lastDirection = direction;
        var nextSibling = target.nextElementSibling,
            after = false;
        after = direction === 1;

        var moveVector = _onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, after);

        if (moveVector !== false) {
          if (moveVector === 1 || moveVector === -1) {
            after = moveVector === 1;
          }

          _silent = true;
          setTimeout(_unsilent, 30);
          capture();

          if (after && !nextSibling) {
            el.appendChild(dragEl);
          } else {
            target.parentNode.insertBefore(dragEl, after ? nextSibling : target);
          } // Undo chrome's scroll adjustment (has no effect on other browsers)


          if (scrolledPastTop) {
            scrollBy(scrolledPastTop, 0, scrollBefore - scrolledPastTop.scrollTop);
          }

          parentEl = dragEl.parentNode; // actualization
          // must be done before animation

          if (targetBeforeFirstSwap !== undefined && !isCircumstantialInvert) {
            targetMoveDistance = Math.abs(targetBeforeFirstSwap - getRect(target)[side1]);
          }

          changed();
          return completed(true);
        }
      }

      if (el.contains(dragEl)) {
        return completed(false);
      }
    }

    return false;
  },
  _ignoreWhileAnimating: null,
  _offMoveEvents: function _offMoveEvents() {
    off(document, 'mousemove', this._onTouchMove);
    off(document, 'touchmove', this._onTouchMove);
    off(document, 'pointermove', this._onTouchMove);
    off(document, 'dragover', nearestEmptyInsertDetectEvent);
    off(document, 'mousemove', nearestEmptyInsertDetectEvent);
    off(document, 'touchmove', nearestEmptyInsertDetectEvent);
  },
  _offUpEvents: function _offUpEvents() {
    var ownerDocument = this.el.ownerDocument;
    off(ownerDocument, 'mouseup', this._onDrop);
    off(ownerDocument, 'touchend', this._onDrop);
    off(ownerDocument, 'pointerup', this._onDrop);
    off(ownerDocument, 'touchcancel', this._onDrop);
    off(document, 'selectstart', this);
  },
  _onDrop: function _onDrop(
  /**Event*/
  evt) {
    var el = this.el,
        options = this.options; // Get the index of the dragged element within its parent

    newIndex = sortable_esm_index(dragEl);
    newDraggableIndex = sortable_esm_index(dragEl, options.draggable);
    pluginEvent('drop', this, {
      evt: evt
    });
    parentEl = dragEl && dragEl.parentNode; // Get again after plugin event

    newIndex = sortable_esm_index(dragEl);
    newDraggableIndex = sortable_esm_index(dragEl, options.draggable);

    if (Sortable.eventCanceled) {
      this._nulling();

      return;
    }

    awaitingDragStarted = false;
    isCircumstantialInvert = false;
    pastFirstInvertThresh = false;
    clearInterval(this._loopId);
    clearTimeout(this._dragStartTimer);

    _cancelNextTick(this.cloneId);

    _cancelNextTick(this._dragStartId); // Unbind events


    if (this.nativeDraggable) {
      off(document, 'drop', this);
      off(el, 'dragstart', this._onDragStart);
    }

    this._offMoveEvents();

    this._offUpEvents();

    if (Safari) {
      css(document.body, 'user-select', '');
    }

    css(dragEl, 'transform', '');

    if (evt) {
      if (moved) {
        evt.cancelable && evt.preventDefault();
        !options.dropBubble && evt.stopPropagation();
      }

      ghostEl && ghostEl.parentNode && ghostEl.parentNode.removeChild(ghostEl);

      if (rootEl === parentEl || putSortable && putSortable.lastPutMode !== 'clone') {
        // Remove clone(s)
        cloneEl && cloneEl.parentNode && cloneEl.parentNode.removeChild(cloneEl);
      }

      if (dragEl) {
        if (this.nativeDraggable) {
          off(dragEl, 'dragend', this);
        }

        _disableDraggable(dragEl);

        dragEl.style['will-change'] = ''; // Remove classes
        // ghostClass is added in dragStarted

        if (moved && !awaitingDragStarted) {
          toggleClass(dragEl, putSortable ? putSortable.options.ghostClass : this.options.ghostClass, false);
        }

        toggleClass(dragEl, this.options.chosenClass, false); // Drag stop event

        _dispatchEvent({
          sortable: this,
          name: 'unchoose',
          toEl: parentEl,
          newIndex: null,
          newDraggableIndex: null,
          originalEvent: evt
        });

        if (rootEl !== parentEl) {
          if (newIndex >= 0) {
            // Add event
            _dispatchEvent({
              rootEl: parentEl,
              name: 'add',
              toEl: parentEl,
              fromEl: rootEl,
              originalEvent: evt
            }); // Remove event


            _dispatchEvent({
              sortable: this,
              name: 'remove',
              toEl: parentEl,
              originalEvent: evt
            }); // drag from one list and drop into another


            _dispatchEvent({
              rootEl: parentEl,
              name: 'sort',
              toEl: parentEl,
              fromEl: rootEl,
              originalEvent: evt
            });

            _dispatchEvent({
              sortable: this,
              name: 'sort',
              toEl: parentEl,
              originalEvent: evt
            });
          }

          putSortable && putSortable.save();
        } else {
          if (newIndex !== oldIndex) {
            if (newIndex >= 0) {
              // drag & drop within the same list
              _dispatchEvent({
                sortable: this,
                name: 'update',
                toEl: parentEl,
                originalEvent: evt
              });

              _dispatchEvent({
                sortable: this,
                name: 'sort',
                toEl: parentEl,
                originalEvent: evt
              });
            }
          }
        }

        if (Sortable.active) {
          /* jshint eqnull:true */
          if (newIndex == null || newIndex === -1) {
            newIndex = oldIndex;
            newDraggableIndex = oldDraggableIndex;
          }

          _dispatchEvent({
            sortable: this,
            name: 'end',
            toEl: parentEl,
            originalEvent: evt
          }); // Save sorting


          this.save();
        }
      }
    }

    this._nulling();
  },
  _nulling: function _nulling() {
    pluginEvent('nulling', this);
    rootEl = dragEl = parentEl = ghostEl = nextEl = cloneEl = lastDownEl = cloneHidden = tapEvt = touchEvt = moved = newIndex = newDraggableIndex = oldIndex = oldDraggableIndex = lastTarget = lastDirection = putSortable = activeGroup = Sortable.dragged = Sortable.ghost = Sortable.clone = Sortable.active = null;
    savedInputChecked.forEach(function (el) {
      el.checked = true;
    });
    savedInputChecked.length = lastDx = lastDy = 0;
  },
  handleEvent: function handleEvent(
  /**Event*/
  evt) {
    switch (evt.type) {
      case 'drop':
      case 'dragend':
        this._onDrop(evt);

        break;

      case 'dragenter':
      case 'dragover':
        if (dragEl) {
          this._onDragOver(evt);

          _globalDragOver(evt);
        }

        break;

      case 'selectstart':
        evt.preventDefault();
        break;
    }
  },

  /**
   * Serializes the item into an array of string.
   * @returns {String[]}
   */
  toArray: function toArray() {
    var order = [],
        el,
        children = this.el.children,
        i = 0,
        n = children.length,
        options = this.options;

    for (; i < n; i++) {
      el = children[i];

      if (closest(el, options.draggable, this.el, false)) {
        order.push(el.getAttribute(options.dataIdAttr) || _generateId(el));
      }
    }

    return order;
  },

  /**
   * Sorts the elements according to the array.
   * @param  {String[]}  order  order of the items
   */
  sort: function sort(order, useAnimation) {
    var items = {},
        rootEl = this.el;
    this.toArray().forEach(function (id, i) {
      var el = rootEl.children[i];

      if (closest(el, this.options.draggable, rootEl, false)) {
        items[id] = el;
      }
    }, this);
    useAnimation && this.captureAnimationState();
    order.forEach(function (id) {
      if (items[id]) {
        rootEl.removeChild(items[id]);
        rootEl.appendChild(items[id]);
      }
    });
    useAnimation && this.animateAll();
  },

  /**
   * Save the current sorting
   */
  save: function save() {
    var store = this.options.store;
    store && store.set && store.set(this);
  },

  /**
   * For each element in the set, get the first element that matches the selector by testing the element itself and traversing up through its ancestors in the DOM tree.
   * @param   {HTMLElement}  el
   * @param   {String}       [selector]  default: `options.draggable`
   * @returns {HTMLElement|null}
   */
  closest: function closest$1(el, selector) {
    return closest(el, selector || this.options.draggable, this.el, false);
  },

  /**
   * Set/get option
   * @param   {string} name
   * @param   {*}      [value]
   * @returns {*}
   */
  option: function option(name, value) {
    var options = this.options;

    if (value === void 0) {
      return options[name];
    } else {
      var modifiedValue = PluginManager.modifyOption(this, name, value);

      if (typeof modifiedValue !== 'undefined') {
        options[name] = modifiedValue;
      } else {
        options[name] = value;
      }

      if (name === 'group') {
        _prepareGroup(options);
      }
    }
  },

  /**
   * Destroy
   */
  destroy: function destroy() {
    pluginEvent('destroy', this);
    var el = this.el;
    el[expando] = null;
    off(el, 'mousedown', this._onTapStart);
    off(el, 'touchstart', this._onTapStart);
    off(el, 'pointerdown', this._onTapStart);

    if (this.nativeDraggable) {
      off(el, 'dragover', this);
      off(el, 'dragenter', this);
    } // Remove draggable attributes


    Array.prototype.forEach.call(el.querySelectorAll('[draggable]'), function (el) {
      el.removeAttribute('draggable');
    });

    this._onDrop();

    this._disableDelayedDragEvents();

    sortables.splice(sortables.indexOf(this.el), 1);
    this.el = el = null;
  },
  _hideClone: function _hideClone() {
    if (!cloneHidden) {
      pluginEvent('hideClone', this);
      if (Sortable.eventCanceled) return;
      css(cloneEl, 'display', 'none');

      if (this.options.removeCloneOnHide && cloneEl.parentNode) {
        cloneEl.parentNode.removeChild(cloneEl);
      }

      cloneHidden = true;
    }
  },
  _showClone: function _showClone(putSortable) {
    if (putSortable.lastPutMode !== 'clone') {
      this._hideClone();

      return;
    }

    if (cloneHidden) {
      pluginEvent('showClone', this);
      if (Sortable.eventCanceled) return; // show clone at dragEl or original position

      if (dragEl.parentNode == rootEl && !this.options.group.revertClone) {
        rootEl.insertBefore(cloneEl, dragEl);
      } else if (nextEl) {
        rootEl.insertBefore(cloneEl, nextEl);
      } else {
        rootEl.appendChild(cloneEl);
      }

      if (this.options.group.revertClone) {
        this.animate(dragEl, cloneEl);
      }

      css(cloneEl, 'display', '');
      cloneHidden = false;
    }
  }
};

function _globalDragOver(
/**Event*/
evt) {
  if (evt.dataTransfer) {
    evt.dataTransfer.dropEffect = 'move';
  }

  evt.cancelable && evt.preventDefault();
}

function _onMove(fromEl, toEl, dragEl, dragRect, targetEl, targetRect, originalEvent, willInsertAfter) {
  var evt,
      sortable = fromEl[expando],
      onMoveFn = sortable.options.onMove,
      retVal; // Support for new CustomEvent feature

  if (window.CustomEvent && !IE11OrLess && !Edge) {
    evt = new CustomEvent('move', {
      bubbles: true,
      cancelable: true
    });
  } else {
    evt = document.createEvent('Event');
    evt.initEvent('move', true, true);
  }

  evt.to = toEl;
  evt.from = fromEl;
  evt.dragged = dragEl;
  evt.draggedRect = dragRect;
  evt.related = targetEl || toEl;
  evt.relatedRect = targetRect || getRect(toEl);
  evt.willInsertAfter = willInsertAfter;
  evt.originalEvent = originalEvent;
  fromEl.dispatchEvent(evt);

  if (onMoveFn) {
    retVal = onMoveFn.call(sortable, evt, originalEvent);
  }

  return retVal;
}

function _disableDraggable(el) {
  el.draggable = false;
}

function _unsilent() {
  _silent = false;
}

function _ghostIsFirst(evt, vertical, sortable) {
  var rect = getRect(getChild(sortable.el, 0, sortable.options, true));
  var spacer = 10;
  return vertical ? evt.clientX < rect.left - spacer || evt.clientY < rect.top && evt.clientX < rect.right : evt.clientY < rect.top - spacer || evt.clientY < rect.bottom && evt.clientX < rect.left;
}

function _ghostIsLast(evt, vertical, sortable) {
  var rect = getRect(lastChild(sortable.el, sortable.options.draggable));
  var spacer = 10;
  return vertical ? evt.clientX > rect.right + spacer || evt.clientX <= rect.right && evt.clientY > rect.bottom && evt.clientX >= rect.left : evt.clientX > rect.right && evt.clientY > rect.top || evt.clientX <= rect.right && evt.clientY > rect.bottom + spacer;
}

function _getSwapDirection(evt, target, targetRect, vertical, swapThreshold, invertedSwapThreshold, invertSwap, isLastTarget) {
  var mouseOnAxis = vertical ? evt.clientY : evt.clientX,
      targetLength = vertical ? targetRect.height : targetRect.width,
      targetS1 = vertical ? targetRect.top : targetRect.left,
      targetS2 = vertical ? targetRect.bottom : targetRect.right,
      invert = false;

  if (!invertSwap) {
    // Never invert or create dragEl shadow when target movemenet causes mouse to move past the end of regular swapThreshold
    if (isLastTarget && targetMoveDistance < targetLength * swapThreshold) {
      // multiplied only by swapThreshold because mouse will already be inside target by (1 - threshold) * targetLength / 2
      // check if past first invert threshold on side opposite of lastDirection
      if (!pastFirstInvertThresh && (lastDirection === 1 ? mouseOnAxis > targetS1 + targetLength * invertedSwapThreshold / 2 : mouseOnAxis < targetS2 - targetLength * invertedSwapThreshold / 2)) {
        // past first invert threshold, do not restrict inverted threshold to dragEl shadow
        pastFirstInvertThresh = true;
      }

      if (!pastFirstInvertThresh) {
        // dragEl shadow (target move distance shadow)
        if (lastDirection === 1 ? mouseOnAxis < targetS1 + targetMoveDistance // over dragEl shadow
        : mouseOnAxis > targetS2 - targetMoveDistance) {
          return -lastDirection;
        }
      } else {
        invert = true;
      }
    } else {
      // Regular
      if (mouseOnAxis > targetS1 + targetLength * (1 - swapThreshold) / 2 && mouseOnAxis < targetS2 - targetLength * (1 - swapThreshold) / 2) {
        return _getInsertDirection(target);
      }
    }
  }

  invert = invert || invertSwap;

  if (invert) {
    // Invert of regular
    if (mouseOnAxis < targetS1 + targetLength * invertedSwapThreshold / 2 || mouseOnAxis > targetS2 - targetLength * invertedSwapThreshold / 2) {
      return mouseOnAxis > targetS1 + targetLength / 2 ? 1 : -1;
    }
  }

  return 0;
}
/**
 * Gets the direction dragEl must be swapped relative to target in order to make it
 * seem that dragEl has been "inserted" into that element's position
 * @param  {HTMLElement} target       The target whose position dragEl is being inserted at
 * @return {Number}                   Direction dragEl must be swapped
 */


function _getInsertDirection(target) {
  if (sortable_esm_index(dragEl) < sortable_esm_index(target)) {
    return 1;
  } else {
    return -1;
  }
}
/**
 * Generate id
 * @param   {HTMLElement} el
 * @returns {String}
 * @private
 */


function _generateId(el) {
  var str = el.tagName + el.className + el.src + el.href + el.textContent,
      i = str.length,
      sum = 0;

  while (i--) {
    sum += str.charCodeAt(i);
  }

  return sum.toString(36);
}

function _saveInputCheckedState(root) {
  savedInputChecked.length = 0;
  var inputs = root.getElementsByTagName('input');
  var idx = inputs.length;

  while (idx--) {
    var el = inputs[idx];
    el.checked && savedInputChecked.push(el);
  }
}

function _nextTick(fn) {
  return setTimeout(fn, 0);
}

function _cancelNextTick(id) {
  return clearTimeout(id);
} // Fixed #973:


if (documentExists) {
  on(document, 'touchmove', function (evt) {
    if ((Sortable.active || awaitingDragStarted) && evt.cancelable) {
      evt.preventDefault();
    }
  });
} // Export utils


Sortable.utils = {
  on: on,
  off: off,
  css: css,
  find: sortable_esm_find,
  is: function is(el, selector) {
    return !!closest(el, selector, el, false);
  },
  extend: extend,
  throttle: throttle,
  closest: closest,
  toggleClass: toggleClass,
  clone: clone,
  index: sortable_esm_index,
  nextTick: _nextTick,
  cancelNextTick: _cancelNextTick,
  detectDirection: _detectDirection,
  getChild: getChild
};
/**
 * Get the Sortable instance of an element
 * @param  {HTMLElement} element The element
 * @return {Sortable|undefined}         The instance of Sortable
 */

Sortable.get = function (element) {
  return element[expando];
};
/**
 * Mount a plugin to Sortable
 * @param  {...SortablePlugin|SortablePlugin[]} plugins       Plugins being mounted
 */


Sortable.mount = function () {
  for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {
    plugins[_key] = arguments[_key];
  }

  if (plugins[0].constructor === Array) plugins = plugins[0];
  plugins.forEach(function (plugin) {
    if (!plugin.prototype || !plugin.prototype.constructor) {
      throw "Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(plugin));
    }

    if (plugin.utils) Sortable.utils = sortable_esm_objectSpread2(sortable_esm_objectSpread2({}, Sortable.utils), plugin.utils);
    PluginManager.mount(plugin);
  });
};
/**
 * Create sortable instance
 * @param {HTMLElement}  el
 * @param {Object}      [options]
 */


Sortable.create = function (el, options) {
  return new Sortable(el, options);
}; // Export


Sortable.version = version;

var autoScrolls = [],
    scrollEl,
    scrollRootEl,
    scrolling = false,
    lastAutoScrollX,
    lastAutoScrollY,
    touchEvt$1,
    pointerElemChangedInterval;

function AutoScrollPlugin() {
  function AutoScroll() {
    this.defaults = {
      scroll: true,
      forceAutoScrollFallback: false,
      scrollSensitivity: 30,
      scrollSpeed: 10,
      bubbleScroll: true
    }; // Bind all private methods

    for (var fn in this) {
      if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {
        this[fn] = this[fn].bind(this);
      }
    }
  }

  AutoScroll.prototype = {
    dragStarted: function dragStarted(_ref) {
      var originalEvent = _ref.originalEvent;

      if (this.sortable.nativeDraggable) {
        on(document, 'dragover', this._handleAutoScroll);
      } else {
        if (this.options.supportPointer) {
          on(document, 'pointermove', this._handleFallbackAutoScroll);
        } else if (originalEvent.touches) {
          on(document, 'touchmove', this._handleFallbackAutoScroll);
        } else {
          on(document, 'mousemove', this._handleFallbackAutoScroll);
        }
      }
    },
    dragOverCompleted: function dragOverCompleted(_ref2) {
      var originalEvent = _ref2.originalEvent;

      // For when bubbling is canceled and using fallback (fallback 'touchmove' always reached)
      if (!this.options.dragOverBubble && !originalEvent.rootEl) {
        this._handleAutoScroll(originalEvent);
      }
    },
    drop: function drop() {
      if (this.sortable.nativeDraggable) {
        off(document, 'dragover', this._handleAutoScroll);
      } else {
        off(document, 'pointermove', this._handleFallbackAutoScroll);
        off(document, 'touchmove', this._handleFallbackAutoScroll);
        off(document, 'mousemove', this._handleFallbackAutoScroll);
      }

      clearPointerElemChangedInterval();
      clearAutoScrolls();
      cancelThrottle();
    },
    nulling: function nulling() {
      touchEvt$1 = scrollRootEl = scrollEl = scrolling = pointerElemChangedInterval = lastAutoScrollX = lastAutoScrollY = null;
      autoScrolls.length = 0;
    },
    _handleFallbackAutoScroll: function _handleFallbackAutoScroll(evt) {
      this._handleAutoScroll(evt, true);
    },
    _handleAutoScroll: function _handleAutoScroll(evt, fallback) {
      var _this = this;

      var x = (evt.touches ? evt.touches[0] : evt).clientX,
          y = (evt.touches ? evt.touches[0] : evt).clientY,
          elem = document.elementFromPoint(x, y);
      touchEvt$1 = evt; // IE does not seem to have native autoscroll,
      // Edge's autoscroll seems too conditional,
      // MACOS Safari does not have autoscroll,
      // Firefox and Chrome are good

      if (fallback || this.options.forceAutoScrollFallback || Edge || IE11OrLess || Safari) {
        autoScroll(evt, this.options, elem, fallback); // Listener for pointer element change

        var ogElemScroller = getParentAutoScrollElement(elem, true);

        if (scrolling && (!pointerElemChangedInterval || x !== lastAutoScrollX || y !== lastAutoScrollY)) {
          pointerElemChangedInterval && clearPointerElemChangedInterval(); // Detect for pointer elem change, emulating native DnD behaviour

          pointerElemChangedInterval = setInterval(function () {
            var newElem = getParentAutoScrollElement(document.elementFromPoint(x, y), true);

            if (newElem !== ogElemScroller) {
              ogElemScroller = newElem;
              clearAutoScrolls();
            }

            autoScroll(evt, _this.options, newElem, fallback);
          }, 10);
          lastAutoScrollX = x;
          lastAutoScrollY = y;
        }
      } else {
        // if DnD is enabled (and browser has good autoscrolling), first autoscroll will already scroll, so get parent autoscroll of first autoscroll
        if (!this.options.bubbleScroll || getParentAutoScrollElement(elem, true) === getWindowScrollingElement()) {
          clearAutoScrolls();
          return;
        }

        autoScroll(evt, this.options, getParentAutoScrollElement(elem, false), false);
      }
    }
  };
  return _extends(AutoScroll, {
    pluginName: 'scroll',
    initializeByDefault: true
  });
}

function clearAutoScrolls() {
  autoScrolls.forEach(function (autoScroll) {
    clearInterval(autoScroll.pid);
  });
  autoScrolls = [];
}

function clearPointerElemChangedInterval() {
  clearInterval(pointerElemChangedInterval);
}

var autoScroll = throttle(function (evt, options, rootEl, isFallback) {
  // Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=505521
  if (!options.scroll) return;
  var x = (evt.touches ? evt.touches[0] : evt).clientX,
      y = (evt.touches ? evt.touches[0] : evt).clientY,
      sens = options.scrollSensitivity,
      speed = options.scrollSpeed,
      winScroller = getWindowScrollingElement();
  var scrollThisInstance = false,
      scrollCustomFn; // New scroll root, set scrollEl

  if (scrollRootEl !== rootEl) {
    scrollRootEl = rootEl;
    clearAutoScrolls();
    scrollEl = options.scroll;
    scrollCustomFn = options.scrollFn;

    if (scrollEl === true) {
      scrollEl = getParentAutoScrollElement(rootEl, true);
    }
  }

  var layersOut = 0;
  var currentParent = scrollEl;

  do {
    var el = currentParent,
        rect = getRect(el),
        top = rect.top,
        bottom = rect.bottom,
        left = rect.left,
        right = rect.right,
        width = rect.width,
        height = rect.height,
        canScrollX = void 0,
        canScrollY = void 0,
        scrollWidth = el.scrollWidth,
        scrollHeight = el.scrollHeight,
        elCSS = css(el),
        scrollPosX = el.scrollLeft,
        scrollPosY = el.scrollTop;

    if (el === winScroller) {
      canScrollX = width < scrollWidth && (elCSS.overflowX === 'auto' || elCSS.overflowX === 'scroll' || elCSS.overflowX === 'visible');
      canScrollY = height < scrollHeight && (elCSS.overflowY === 'auto' || elCSS.overflowY === 'scroll' || elCSS.overflowY === 'visible');
    } else {
      canScrollX = width < scrollWidth && (elCSS.overflowX === 'auto' || elCSS.overflowX === 'scroll');
      canScrollY = height < scrollHeight && (elCSS.overflowY === 'auto' || elCSS.overflowY === 'scroll');
    }

    var vx = canScrollX && (Math.abs(right - x) <= sens && scrollPosX + width < scrollWidth) - (Math.abs(left - x) <= sens && !!scrollPosX);
    var vy = canScrollY && (Math.abs(bottom - y) <= sens && scrollPosY + height < scrollHeight) - (Math.abs(top - y) <= sens && !!scrollPosY);

    if (!autoScrolls[layersOut]) {
      for (var i = 0; i <= layersOut; i++) {
        if (!autoScrolls[i]) {
          autoScrolls[i] = {};
        }
      }
    }

    if (autoScrolls[layersOut].vx != vx || autoScrolls[layersOut].vy != vy || autoScrolls[layersOut].el !== el) {
      autoScrolls[layersOut].el = el;
      autoScrolls[layersOut].vx = vx;
      autoScrolls[layersOut].vy = vy;
      clearInterval(autoScrolls[layersOut].pid);

      if (vx != 0 || vy != 0) {
        scrollThisInstance = true;
        /* jshint loopfunc:true */

        autoScrolls[layersOut].pid = setInterval(function () {
          // emulate drag over during autoscroll (fallback), emulating native DnD behaviour
          if (isFallback && this.layer === 0) {
            Sortable.active._onTouchMove(touchEvt$1); // To move ghost if it is positioned absolutely

          }

          var scrollOffsetY = autoScrolls[this.layer].vy ? autoScrolls[this.layer].vy * speed : 0;
          var scrollOffsetX = autoScrolls[this.layer].vx ? autoScrolls[this.layer].vx * speed : 0;

          if (typeof scrollCustomFn === 'function') {
            if (scrollCustomFn.call(Sortable.dragged.parentNode[expando], scrollOffsetX, scrollOffsetY, evt, touchEvt$1, autoScrolls[this.layer].el) !== 'continue') {
              return;
            }
          }

          scrollBy(autoScrolls[this.layer].el, scrollOffsetX, scrollOffsetY);
        }.bind({
          layer: layersOut
        }), 24);
      }
    }

    layersOut++;
  } while (options.bubbleScroll && currentParent !== winScroller && (currentParent = getParentAutoScrollElement(currentParent, false)));

  scrolling = scrollThisInstance; // in case another function catches scrolling as false in between when it is not
}, 30);

var drop = function drop(_ref) {
  var originalEvent = _ref.originalEvent,
      putSortable = _ref.putSortable,
      dragEl = _ref.dragEl,
      activeSortable = _ref.activeSortable,
      dispatchSortableEvent = _ref.dispatchSortableEvent,
      hideGhostForTarget = _ref.hideGhostForTarget,
      unhideGhostForTarget = _ref.unhideGhostForTarget;
  if (!originalEvent) return;
  var toSortable = putSortable || activeSortable;
  hideGhostForTarget();
  var touch = originalEvent.changedTouches && originalEvent.changedTouches.length ? originalEvent.changedTouches[0] : originalEvent;
  var target = document.elementFromPoint(touch.clientX, touch.clientY);
  unhideGhostForTarget();

  if (toSortable && !toSortable.el.contains(target)) {
    dispatchSortableEvent('spill');
    this.onSpill({
      dragEl: dragEl,
      putSortable: putSortable
    });
  }
};

function Revert() {}

Revert.prototype = {
  startIndex: null,
  dragStart: function dragStart(_ref2) {
    var oldDraggableIndex = _ref2.oldDraggableIndex;
    this.startIndex = oldDraggableIndex;
  },
  onSpill: function onSpill(_ref3) {
    var dragEl = _ref3.dragEl,
        putSortable = _ref3.putSortable;
    this.sortable.captureAnimationState();

    if (putSortable) {
      putSortable.captureAnimationState();
    }

    var nextSibling = getChild(this.sortable.el, this.startIndex, this.options);

    if (nextSibling) {
      this.sortable.el.insertBefore(dragEl, nextSibling);
    } else {
      this.sortable.el.appendChild(dragEl);
    }

    this.sortable.animateAll();

    if (putSortable) {
      putSortable.animateAll();
    }
  },
  drop: drop
};

_extends(Revert, {
  pluginName: 'revertOnSpill'
});

function Remove() {}

Remove.prototype = {
  onSpill: function onSpill(_ref4) {
    var dragEl = _ref4.dragEl,
        putSortable = _ref4.putSortable;
    var parentSortable = putSortable || this.sortable;
    parentSortable.captureAnimationState();
    dragEl.parentNode && dragEl.parentNode.removeChild(dragEl);
    parentSortable.animateAll();
  },
  drop: drop
};

_extends(Remove, {
  pluginName: 'removeOnSpill'
});

var lastSwapEl;

function SwapPlugin() {
  function Swap() {
    this.defaults = {
      swapClass: 'sortable-swap-highlight'
    };
  }

  Swap.prototype = {
    dragStart: function dragStart(_ref) {
      var dragEl = _ref.dragEl;
      lastSwapEl = dragEl;
    },
    dragOverValid: function dragOverValid(_ref2) {
      var completed = _ref2.completed,
          target = _ref2.target,
          onMove = _ref2.onMove,
          activeSortable = _ref2.activeSortable,
          changed = _ref2.changed,
          cancel = _ref2.cancel;
      if (!activeSortable.options.swap) return;
      var el = this.sortable.el,
          options = this.options;

      if (target && target !== el) {
        var prevSwapEl = lastSwapEl;

        if (onMove(target) !== false) {
          toggleClass(target, options.swapClass, true);
          lastSwapEl = target;
        } else {
          lastSwapEl = null;
        }

        if (prevSwapEl && prevSwapEl !== lastSwapEl) {
          toggleClass(prevSwapEl, options.swapClass, false);
        }
      }

      changed();
      completed(true);
      cancel();
    },
    drop: function drop(_ref3) {
      var activeSortable = _ref3.activeSortable,
          putSortable = _ref3.putSortable,
          dragEl = _ref3.dragEl;
      var toSortable = putSortable || this.sortable;
      var options = this.options;
      lastSwapEl && toggleClass(lastSwapEl, options.swapClass, false);

      if (lastSwapEl && (options.swap || putSortable && putSortable.options.swap)) {
        if (dragEl !== lastSwapEl) {
          toSortable.captureAnimationState();
          if (toSortable !== activeSortable) activeSortable.captureAnimationState();
          swapNodes(dragEl, lastSwapEl);
          toSortable.animateAll();
          if (toSortable !== activeSortable) activeSortable.animateAll();
        }
      }
    },
    nulling: function nulling() {
      lastSwapEl = null;
    }
  };
  return _extends(Swap, {
    pluginName: 'swap',
    eventProperties: function eventProperties() {
      return {
        swapItem: lastSwapEl
      };
    }
  });
}

function swapNodes(n1, n2) {
  var p1 = n1.parentNode,
      p2 = n2.parentNode,
      i1,
      i2;
  if (!p1 || !p2 || p1.isEqualNode(n2) || p2.isEqualNode(n1)) return;
  i1 = sortable_esm_index(n1);
  i2 = sortable_esm_index(n2);

  if (p1.isEqualNode(p2) && i1 < i2) {
    i2++;
  }

  p1.insertBefore(n2, p1.children[i1]);
  p2.insertBefore(n1, p2.children[i2]);
}

var multiDragElements = (/* unused pure expression or super */ null && ([])),
    multiDragClones = (/* unused pure expression or super */ null && ([])),
    lastMultiDragSelect,
    // for selection with modifier key down (SHIFT)
multiDragSortable,
    initialFolding = false,
    // Initial multi-drag fold when drag started
folding = false,
    // Folding any other time
dragStarted = false,
    dragEl$1,
    clonesFromRect,
    clonesHidden;

function MultiDragPlugin() {
  function MultiDrag(sortable) {
    // Bind all private methods
    for (var fn in this) {
      if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {
        this[fn] = this[fn].bind(this);
      }
    }

    if (sortable.options.supportPointer) {
      on(document, 'pointerup', this._deselectMultiDrag);
    } else {
      on(document, 'mouseup', this._deselectMultiDrag);
      on(document, 'touchend', this._deselectMultiDrag);
    }

    on(document, 'keydown', this._checkKeyDown);
    on(document, 'keyup', this._checkKeyUp);
    this.defaults = {
      selectedClass: 'sortable-selected',
      multiDragKey: null,
      setData: function setData(dataTransfer, dragEl) {
        var data = '';

        if (multiDragElements.length && multiDragSortable === sortable) {
          multiDragElements.forEach(function (multiDragElement, i) {
            data += (!i ? '' : ', ') + multiDragElement.textContent;
          });
        } else {
          data = dragEl.textContent;
        }

        dataTransfer.setData('Text', data);
      }
    };
  }

  MultiDrag.prototype = {
    multiDragKeyDown: false,
    isMultiDrag: false,
    delayStartGlobal: function delayStartGlobal(_ref) {
      var dragged = _ref.dragEl;
      dragEl$1 = dragged;
    },
    delayEnded: function delayEnded() {
      this.isMultiDrag = ~multiDragElements.indexOf(dragEl$1);
    },
    setupClone: function setupClone(_ref2) {
      var sortable = _ref2.sortable,
          cancel = _ref2.cancel;
      if (!this.isMultiDrag) return;

      for (var i = 0; i < multiDragElements.length; i++) {
        multiDragClones.push(clone(multiDragElements[i]));
        multiDragClones[i].sortableIndex = multiDragElements[i].sortableIndex;
        multiDragClones[i].draggable = false;
        multiDragClones[i].style['will-change'] = '';
        toggleClass(multiDragClones[i], this.options.selectedClass, false);
        multiDragElements[i] === dragEl$1 && toggleClass(multiDragClones[i], this.options.chosenClass, false);
      }

      sortable._hideClone();

      cancel();
    },
    clone: function clone(_ref3) {
      var sortable = _ref3.sortable,
          rootEl = _ref3.rootEl,
          dispatchSortableEvent = _ref3.dispatchSortableEvent,
          cancel = _ref3.cancel;
      if (!this.isMultiDrag) return;

      if (!this.options.removeCloneOnHide) {
        if (multiDragElements.length && multiDragSortable === sortable) {
          insertMultiDragClones(true, rootEl);
          dispatchSortableEvent('clone');
          cancel();
        }
      }
    },
    showClone: function showClone(_ref4) {
      var cloneNowShown = _ref4.cloneNowShown,
          rootEl = _ref4.rootEl,
          cancel = _ref4.cancel;
      if (!this.isMultiDrag) return;
      insertMultiDragClones(false, rootEl);
      multiDragClones.forEach(function (clone) {
        css(clone, 'display', '');
      });
      cloneNowShown();
      clonesHidden = false;
      cancel();
    },
    hideClone: function hideClone(_ref5) {
      var _this = this;

      var sortable = _ref5.sortable,
          cloneNowHidden = _ref5.cloneNowHidden,
          cancel = _ref5.cancel;
      if (!this.isMultiDrag) return;
      multiDragClones.forEach(function (clone) {
        css(clone, 'display', 'none');

        if (_this.options.removeCloneOnHide && clone.parentNode) {
          clone.parentNode.removeChild(clone);
        }
      });
      cloneNowHidden();
      clonesHidden = true;
      cancel();
    },
    dragStartGlobal: function dragStartGlobal(_ref6) {
      var sortable = _ref6.sortable;

      if (!this.isMultiDrag && multiDragSortable) {
        multiDragSortable.multiDrag._deselectMultiDrag();
      }

      multiDragElements.forEach(function (multiDragElement) {
        multiDragElement.sortableIndex = sortable_esm_index(multiDragElement);
      }); // Sort multi-drag elements

      multiDragElements = multiDragElements.sort(function (a, b) {
        return a.sortableIndex - b.sortableIndex;
      });
      dragStarted = true;
    },
    dragStarted: function dragStarted(_ref7) {
      var _this2 = this;

      var sortable = _ref7.sortable;
      if (!this.isMultiDrag) return;

      if (this.options.sort) {
        // Capture rects,
        // hide multi drag elements (by positioning them absolute),
        // set multi drag elements rects to dragRect,
        // show multi drag elements,
        // animate to rects,
        // unset rects & remove from DOM
        sortable.captureAnimationState();

        if (this.options.animation) {
          multiDragElements.forEach(function (multiDragElement) {
            if (multiDragElement === dragEl$1) return;
            css(multiDragElement, 'position', 'absolute');
          });
          var dragRect = getRect(dragEl$1, false, true, true);
          multiDragElements.forEach(function (multiDragElement) {
            if (multiDragElement === dragEl$1) return;
            setRect(multiDragElement, dragRect);
          });
          folding = true;
          initialFolding = true;
        }
      }

      sortable.animateAll(function () {
        folding = false;
        initialFolding = false;

        if (_this2.options.animation) {
          multiDragElements.forEach(function (multiDragElement) {
            unsetRect(multiDragElement);
          });
        } // Remove all auxiliary multidrag items from el, if sorting enabled


        if (_this2.options.sort) {
          removeMultiDragElements();
        }
      });
    },
    dragOver: function dragOver(_ref8) {
      var target = _ref8.target,
          completed = _ref8.completed,
          cancel = _ref8.cancel;

      if (folding && ~multiDragElements.indexOf(target)) {
        completed(false);
        cancel();
      }
    },
    revert: function revert(_ref9) {
      var fromSortable = _ref9.fromSortable,
          rootEl = _ref9.rootEl,
          sortable = _ref9.sortable,
          dragRect = _ref9.dragRect;

      if (multiDragElements.length > 1) {
        // Setup unfold animation
        multiDragElements.forEach(function (multiDragElement) {
          sortable.addAnimationState({
            target: multiDragElement,
            rect: folding ? getRect(multiDragElement) : dragRect
          });
          unsetRect(multiDragElement);
          multiDragElement.fromRect = dragRect;
          fromSortable.removeAnimationState(multiDragElement);
        });
        folding = false;
        insertMultiDragElements(!this.options.removeCloneOnHide, rootEl);
      }
    },
    dragOverCompleted: function dragOverCompleted(_ref10) {
      var sortable = _ref10.sortable,
          isOwner = _ref10.isOwner,
          insertion = _ref10.insertion,
          activeSortable = _ref10.activeSortable,
          parentEl = _ref10.parentEl,
          putSortable = _ref10.putSortable;
      var options = this.options;

      if (insertion) {
        // Clones must be hidden before folding animation to capture dragRectAbsolute properly
        if (isOwner) {
          activeSortable._hideClone();
        }

        initialFolding = false; // If leaving sort:false root, or already folding - Fold to new location

        if (options.animation && multiDragElements.length > 1 && (folding || !isOwner && !activeSortable.options.sort && !putSortable)) {
          // Fold: Set all multi drag elements's rects to dragEl's rect when multi-drag elements are invisible
          var dragRectAbsolute = getRect(dragEl$1, false, true, true);
          multiDragElements.forEach(function (multiDragElement) {
            if (multiDragElement === dragEl$1) return;
            setRect(multiDragElement, dragRectAbsolute); // Move element(s) to end of parentEl so that it does not interfere with multi-drag clones insertion if they are inserted
            // while folding, and so that we can capture them again because old sortable will no longer be fromSortable

            parentEl.appendChild(multiDragElement);
          });
          folding = true;
        } // Clones must be shown (and check to remove multi drags) after folding when interfering multiDragElements are moved out


        if (!isOwner) {
          // Only remove if not folding (folding will remove them anyways)
          if (!folding) {
            removeMultiDragElements();
          }

          if (multiDragElements.length > 1) {
            var clonesHiddenBefore = clonesHidden;

            activeSortable._showClone(sortable); // Unfold animation for clones if showing from hidden


            if (activeSortable.options.animation && !clonesHidden && clonesHiddenBefore) {
              multiDragClones.forEach(function (clone) {
                activeSortable.addAnimationState({
                  target: clone,
                  rect: clonesFromRect
                });
                clone.fromRect = clonesFromRect;
                clone.thisAnimationDuration = null;
              });
            }
          } else {
            activeSortable._showClone(sortable);
          }
        }
      }
    },
    dragOverAnimationCapture: function dragOverAnimationCapture(_ref11) {
      var dragRect = _ref11.dragRect,
          isOwner = _ref11.isOwner,
          activeSortable = _ref11.activeSortable;
      multiDragElements.forEach(function (multiDragElement) {
        multiDragElement.thisAnimationDuration = null;
      });

      if (activeSortable.options.animation && !isOwner && activeSortable.multiDrag.isMultiDrag) {
        clonesFromRect = _extends({}, dragRect);
        var dragMatrix = matrix(dragEl$1, true);
        clonesFromRect.top -= dragMatrix.f;
        clonesFromRect.left -= dragMatrix.e;
      }
    },
    dragOverAnimationComplete: function dragOverAnimationComplete() {
      if (folding) {
        folding = false;
        removeMultiDragElements();
      }
    },
    drop: function drop(_ref12) {
      var evt = _ref12.originalEvent,
          rootEl = _ref12.rootEl,
          parentEl = _ref12.parentEl,
          sortable = _ref12.sortable,
          dispatchSortableEvent = _ref12.dispatchSortableEvent,
          oldIndex = _ref12.oldIndex,
          putSortable = _ref12.putSortable;
      var toSortable = putSortable || this.sortable;
      if (!evt) return;
      var options = this.options,
          children = parentEl.children; // Multi-drag selection

      if (!dragStarted) {
        if (options.multiDragKey && !this.multiDragKeyDown) {
          this._deselectMultiDrag();
        }

        toggleClass(dragEl$1, options.selectedClass, !~multiDragElements.indexOf(dragEl$1));

        if (!~multiDragElements.indexOf(dragEl$1)) {
          multiDragElements.push(dragEl$1);
          dispatchEvent({
            sortable: sortable,
            rootEl: rootEl,
            name: 'select',
            targetEl: dragEl$1,
            originalEvt: evt
          }); // Modifier activated, select from last to dragEl

          if (evt.shiftKey && lastMultiDragSelect && sortable.el.contains(lastMultiDragSelect)) {
            var lastIndex = sortable_esm_index(lastMultiDragSelect),
                currentIndex = sortable_esm_index(dragEl$1);

            if (~lastIndex && ~currentIndex && lastIndex !== currentIndex) {
              // Must include lastMultiDragSelect (select it), in case modified selection from no selection
              // (but previous selection existed)
              var n, i;

              if (currentIndex > lastIndex) {
                i = lastIndex;
                n = currentIndex;
              } else {
                i = currentIndex;
                n = lastIndex + 1;
              }

              for (; i < n; i++) {
                if (~multiDragElements.indexOf(children[i])) continue;
                toggleClass(children[i], options.selectedClass, true);
                multiDragElements.push(children[i]);
                dispatchEvent({
                  sortable: sortable,
                  rootEl: rootEl,
                  name: 'select',
                  targetEl: children[i],
                  originalEvt: evt
                });
              }
            }
          } else {
            lastMultiDragSelect = dragEl$1;
          }

          multiDragSortable = toSortable;
        } else {
          multiDragElements.splice(multiDragElements.indexOf(dragEl$1), 1);
          lastMultiDragSelect = null;
          dispatchEvent({
            sortable: sortable,
            rootEl: rootEl,
            name: 'deselect',
            targetEl: dragEl$1,
            originalEvt: evt
          });
        }
      } // Multi-drag drop


      if (dragStarted && this.isMultiDrag) {
        folding = false; // Do not "unfold" after around dragEl if reverted

        if ((parentEl[expando].options.sort || parentEl !== rootEl) && multiDragElements.length > 1) {
          var dragRect = getRect(dragEl$1),
              multiDragIndex = sortable_esm_index(dragEl$1, ':not(.' + this.options.selectedClass + ')');
          if (!initialFolding && options.animation) dragEl$1.thisAnimationDuration = null;
          toSortable.captureAnimationState();

          if (!initialFolding) {
            if (options.animation) {
              dragEl$1.fromRect = dragRect;
              multiDragElements.forEach(function (multiDragElement) {
                multiDragElement.thisAnimationDuration = null;

                if (multiDragElement !== dragEl$1) {
                  var rect = folding ? getRect(multiDragElement) : dragRect;
                  multiDragElement.fromRect = rect; // Prepare unfold animation

                  toSortable.addAnimationState({
                    target: multiDragElement,
                    rect: rect
                  });
                }
              });
            } // Multi drag elements are not necessarily removed from the DOM on drop, so to reinsert
            // properly they must all be removed


            removeMultiDragElements();
            multiDragElements.forEach(function (multiDragElement) {
              if (children[multiDragIndex]) {
                parentEl.insertBefore(multiDragElement, children[multiDragIndex]);
              } else {
                parentEl.appendChild(multiDragElement);
              }

              multiDragIndex++;
            }); // If initial folding is done, the elements may have changed position because they are now
            // unfolding around dragEl, even though dragEl may not have his index changed, so update event
            // must be fired here as Sortable will not.

            if (oldIndex === sortable_esm_index(dragEl$1)) {
              var update = false;
              multiDragElements.forEach(function (multiDragElement) {
                if (multiDragElement.sortableIndex !== sortable_esm_index(multiDragElement)) {
                  update = true;
                  return;
                }
              });

              if (update) {
                dispatchSortableEvent('update');
              }
            }
          } // Must be done after capturing individual rects (scroll bar)


          multiDragElements.forEach(function (multiDragElement) {
            unsetRect(multiDragElement);
          });
          toSortable.animateAll();
        }

        multiDragSortable = toSortable;
      } // Remove clones if necessary


      if (rootEl === parentEl || putSortable && putSortable.lastPutMode !== 'clone') {
        multiDragClones.forEach(function (clone) {
          clone.parentNode && clone.parentNode.removeChild(clone);
        });
      }
    },
    nullingGlobal: function nullingGlobal() {
      this.isMultiDrag = dragStarted = false;
      multiDragClones.length = 0;
    },
    destroyGlobal: function destroyGlobal() {
      this._deselectMultiDrag();

      off(document, 'pointerup', this._deselectMultiDrag);
      off(document, 'mouseup', this._deselectMultiDrag);
      off(document, 'touchend', this._deselectMultiDrag);
      off(document, 'keydown', this._checkKeyDown);
      off(document, 'keyup', this._checkKeyUp);
    },
    _deselectMultiDrag: function _deselectMultiDrag(evt) {
      if (typeof dragStarted !== "undefined" && dragStarted) return; // Only deselect if selection is in this sortable

      if (multiDragSortable !== this.sortable) return; // Only deselect if target is not item in this sortable

      if (evt && closest(evt.target, this.options.draggable, this.sortable.el, false)) return; // Only deselect if left click

      if (evt && evt.button !== 0) return;

      while (multiDragElements.length) {
        var el = multiDragElements[0];
        toggleClass(el, this.options.selectedClass, false);
        multiDragElements.shift();
        dispatchEvent({
          sortable: this.sortable,
          rootEl: this.sortable.el,
          name: 'deselect',
          targetEl: el,
          originalEvt: evt
        });
      }
    },
    _checkKeyDown: function _checkKeyDown(evt) {
      if (evt.key === this.options.multiDragKey) {
        this.multiDragKeyDown = true;
      }
    },
    _checkKeyUp: function _checkKeyUp(evt) {
      if (evt.key === this.options.multiDragKey) {
        this.multiDragKeyDown = false;
      }
    }
  };
  return _extends(MultiDrag, {
    // Static methods & properties
    pluginName: 'multiDrag',
    utils: {
      /**
       * Selects the provided multi-drag item
       * @param  {HTMLElement} el    The element to be selected
       */
      select: function select(el) {
        var sortable = el.parentNode[expando];
        if (!sortable || !sortable.options.multiDrag || ~multiDragElements.indexOf(el)) return;

        if (multiDragSortable && multiDragSortable !== sortable) {
          multiDragSortable.multiDrag._deselectMultiDrag();

          multiDragSortable = sortable;
        }

        toggleClass(el, sortable.options.selectedClass, true);
        multiDragElements.push(el);
      },

      /**
       * Deselects the provided multi-drag item
       * @param  {HTMLElement} el    The element to be deselected
       */
      deselect: function deselect(el) {
        var sortable = el.parentNode[expando],
            index = multiDragElements.indexOf(el);
        if (!sortable || !sortable.options.multiDrag || !~index) return;
        toggleClass(el, sortable.options.selectedClass, false);
        multiDragElements.splice(index, 1);
      }
    },
    eventProperties: function eventProperties() {
      var _this3 = this;

      var oldIndicies = [],
          newIndicies = [];
      multiDragElements.forEach(function (multiDragElement) {
        oldIndicies.push({
          multiDragElement: multiDragElement,
          index: multiDragElement.sortableIndex
        }); // multiDragElements will already be sorted if folding

        var newIndex;

        if (folding && multiDragElement !== dragEl$1) {
          newIndex = -1;
        } else if (folding) {
          newIndex = sortable_esm_index(multiDragElement, ':not(.' + _this3.options.selectedClass + ')');
        } else {
          newIndex = sortable_esm_index(multiDragElement);
        }

        newIndicies.push({
          multiDragElement: multiDragElement,
          index: newIndex
        });
      });
      return {
        items: _toConsumableArray(multiDragElements),
        clones: [].concat(multiDragClones),
        oldIndicies: oldIndicies,
        newIndicies: newIndicies
      };
    },
    optionListeners: {
      multiDragKey: function multiDragKey(key) {
        key = key.toLowerCase();

        if (key === 'ctrl') {
          key = 'Control';
        } else if (key.length > 1) {
          key = key.charAt(0).toUpperCase() + key.substr(1);
        }

        return key;
      }
    }
  });
}

function insertMultiDragElements(clonesInserted, rootEl) {
  multiDragElements.forEach(function (multiDragElement, i) {
    var target = rootEl.children[multiDragElement.sortableIndex + (clonesInserted ? Number(i) : 0)];

    if (target) {
      rootEl.insertBefore(multiDragElement, target);
    } else {
      rootEl.appendChild(multiDragElement);
    }
  });
}
/**
 * Insert multi-drag clones
 * @param  {[Boolean]} elementsInserted  Whether the multi-drag elements are inserted
 * @param  {HTMLElement} rootEl
 */


function insertMultiDragClones(elementsInserted, rootEl) {
  multiDragClones.forEach(function (clone, i) {
    var target = rootEl.children[clone.sortableIndex + (elementsInserted ? Number(i) : 0)];

    if (target) {
      rootEl.insertBefore(clone, target);
    } else {
      rootEl.appendChild(clone);
    }
  });
}

function removeMultiDragElements() {
  multiDragElements.forEach(function (multiDragElement) {
    if (multiDragElement === dragEl$1) return;
    multiDragElement.parentNode && multiDragElement.parentNode.removeChild(multiDragElement);
  });
}

Sortable.mount(new AutoScrollPlugin());
Sortable.mount(Remove, Revert);

/* harmony default export */ const sortable_esm = (Sortable);


;// CONCATENATED MODULE: ./src/contentbuilder/customselect.js
function customselect_typeof(obj) { "@babel/helpers - typeof"; return customselect_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, customselect_typeof(obj); }
function customselect_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? customselect_ownKeys(Object(source), !0).forEach(function (key) { customselect_defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : customselect_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function customselect_defineProperty(obj, key, value) { key = customselect_toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function customselect_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function customselect_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, customselect_toPropertyKey(descriptor.key), descriptor); } }
function customselect_createClass(Constructor, protoProps, staticProps) { if (protoProps) customselect_defineProperties(Constructor.prototype, protoProps); if (staticProps) customselect_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function customselect_toPropertyKey(arg) { var key = customselect_toPrimitive(arg, "string"); return customselect_typeof(key) === "symbol" ? key : String(key); }
function customselect_toPrimitive(input, hint) { if (customselect_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (customselect_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var CustomSelect = /*#__PURE__*/function () {
  function CustomSelect(selector) {
    var _this = this;
    var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    customselect_classCallCheck(this, CustomSelect);
    this.select = document.querySelector(selector);

    // Construct
    var template = "\n            <div class=\"select-styled\" tabindex=\"0\">\n                <span></span>\n                <span><svg><use xlink:href=\"#icon-chevron-down\"></use></svg></span>\n            </div>\n            <input type=\"text\">\n            <ul class=\"select-options\" aria-haspopup=\"listbox\">\n            </ul>\n        ";
    if (this.select.innerHTML.trim() === '') {
      this.select.innerHTML = template;
    }
    this.select.setAttribute('role', 'combobox');
    this.select.classList.add('custom-select');
    this.selectStyled = this.select.querySelector('.select-styled');
    this.selectOptions = this.select.querySelector('.select-options');
    this.selectSearch = this.select.querySelector('input');
    this.selectSearch.setAttribute('id', "__".concat(this.uniqueId()));
    var defaultConfig = {
      search: true
      // Add more default parameters here if needed in the future
    };

    // Merge default config with the provided config
    this.config = _objectSpread(_objectSpread({}, defaultConfig), config);
    if (this.config.search) this.select.classList.add('has-search');
    if (this.config.data) {
      this.selectOptions.innerHTML = ''; //clear
      this.config.data.forEach(function (choice) {
        var option = document.createElement('li');
        option.setAttribute('data-value', choice.value);
        option.innerHTML = choice.label;
        _this.selectOptions.appendChild(option);
      });
    }
    this.selectStyled.addEventListener('keydown', this.handleKeydown.bind(this));
    this.selectStyled.addEventListener('click', this.toggleOptions.bind(this));
    this.selectOptions.addEventListener('click', this.handleOptionClick.bind(this));
    this.selectSearch.addEventListener('input', this.handleFilterInput.bind(this));

    // this.selectStyled.addEventListener('mousedown', ()=>{
    //     this.select.classList.add('clicked');
    // });
  }
  customselect_createClass(CustomSelect, [{
    key: "handleKeydown",
    value: function handleKeydown(event) {
      if (!this.selectOptions.classList.contains('active')) {
        switch (event.key) {
          case 'Enter':
            this.openOptions();
            event.preventDefault();
            break;
          case ' ':
            this.openOptions();
            event.preventDefault();
            break;
        }
      }
    }
  }, {
    key: "toggleOptions",
    value: function toggleOptions() {
      if (this.selectOptions.classList.contains('active')) {
        this.closeOptions();
      } else {
        this.openOptions();
      }
    }
  }, {
    key: "openOptions",
    value: function openOptions() {
      var _this2 = this;
      this.clearFilter();
      this.selectOptions.classList.add('active');
      this.selectStyled.setAttribute('aria-expanded', 'true');
      setTimeout(function () {
        // Delay to attach only after options is opened
        // document.addEventListener('keydown', this.handleGlobalKeydown.bind(this));
        // document.addEventListener('click', this.handleGlobalClick.bind(this));

        document.addEventListener('keydown', _this2.AA = function (event) {
          _this2.handleGlobalKeydown(event);
        });
        document.addEventListener('click', _this2.BB = function (event) {
          _this2.handleGlobalClick(event);
        });
        if (_this2.config.search) _this2.selectSearch.focus(); // focus after delay so that SPACE key to open dropdown doesn't get entered into the textbox
      }, 100);
      if (this.config.search) this.selectSearch.style.display = 'block';

      // Select value
      var value = this.select.getAttribute('data-value');
      var options = this.selectOptions.querySelectorAll('li');
      options.forEach(function (option) {
        if (value === option.getAttribute('data-value')) {
          option.classList.add('selected');
          option.scrollIntoView();
        } else option.classList.remove('selected');
      });
    }
  }, {
    key: "closeOptions",
    value: function closeOptions() {
      this.selectOptions.classList.remove('active');
      this.selectStyled.setAttribute('aria-expanded', 'false');

      // document.removeEventListener('keydown', this.handleGlobalKeydown.bind(this));
      // document.removeEventListener('click', this.handleGlobalClick.bind(this));

      document.removeEventListener('keydown', this.AA);
      document.removeEventListener('click', this.BB);
      this.selectSearch.style.display = 'none';

      // this.select.classList.remove('clicked');
    }
  }, {
    key: "handleGlobalClick",
    value: function handleGlobalClick(event) {
      var target = event.target;
      var isClickInsideSelect = this.select.contains(target);
      if (!isClickInsideSelect) {
        this.closeOptions();
        this.selectStyled.blur(); // Remove focus from the select styled div
      }
    }
  }, {
    key: "handleGlobalKeydown",
    value: function handleGlobalKeydown(event) {
      if (this.selectOptions.classList.contains('active')) {
        var options = this.selectOptions.querySelectorAll('li');
        var currentIndex = Array.from(options).findIndex(function (option) {
          return option.classList.contains('selected');
        });
        var nextIndex;
        switch (event.key) {
          case 'ArrowUp':
            nextIndex = this.findPreviousVisibleIndex(options, currentIndex);
            this.highlightOption(options, nextIndex);
            event.preventDefault();
            break;
          case 'ArrowDown':
            nextIndex = this.findNextVisibleIndex(options, currentIndex);
            this.highlightOption(options, nextIndex);
            break;
          case 'Enter':
            if (currentIndex !== -1) {
              this.selectOption(options[currentIndex]);
              this.selectStyled.focus();
            }
            break;
          // case ' ':
          //     event.preventDefault(); // Prevent scrolling
          //     if (currentIndex !== -1) {
          //         this.selectOption(options[currentIndex]);
          //         this.selectStyled.focus();
          //     }
          //     break;
          case 'Escape':
            this.closeOptions();
            this.selectStyled.focus();
            break;
          case 'Tab':
            this.closeOptions();
            this.selectStyled.focus();
            break;
        }
      }
    }
  }, {
    key: "highlightOption",
    value: function highlightOption(options, index) {
      options.forEach(function (option) {
        return option.classList.remove('selected');
      });
      if (index < 0) {
        index = options.length - 1;
      } else if (index >= options.length) {
        index = 0;
      }
      options[index].classList.add('selected');
      options[index].scrollIntoView({
        block: 'nearest',
        inline: 'start'
      });
    }
  }, {
    key: "handleOptionClick",
    value: function handleOptionClick(event) {
      var options = this.selectOptions.querySelectorAll('li');
      options.forEach(function (option) {
        return option.classList.remove('selected');
      });
      var li = event.target.closest('li');
      if (li) {
        this.selectOption(li);
        this.selectStyled.focus();
        li.classList.add('selected');
      }
    }
  }, {
    key: "selectOption",
    value: function selectOption(option) {
      var _this3 = this;
      var value = option.getAttribute('data-value');
      this.select.setAttribute('data-value', value);
      var options = this.selectOptions.querySelectorAll('li');
      options.forEach(function (option) {
        if (value === option.getAttribute('data-value')) {
          var span = _this3.selectStyled.querySelector('span');
          span.innerHTML = option.innerHTML;
        }
      });
      this.closeOptions();

      // Trigger custom change event
      // const changeEvent = new Event('change');
      // this.select.dispatchEvent(changeEvent);

      if (this.config.onChange) this.config.onChange(value);
    }
  }, {
    key: "setValue",
    value: function setValue(value) {
      var _this4 = this;
      this.select.setAttribute('data-value', value);
      var options = this.selectOptions.querySelectorAll('li');
      options.forEach(function (option) {
        if (value === option.getAttribute('data-value')) {
          option.classList.add('selected');
          var span = _this4.selectStyled.querySelector('span');
          span.innerHTML = option.innerHTML;
        } else option.classList.remove('selected');
      });
    }
  }, {
    key: "getValue",
    value: function getValue() {
      return this.select.getAttribute('data-value');
    }
  }, {
    key: "clearFilter",
    value: function clearFilter() {
      this.selectSearch.value = '';
      var options = this.selectOptions.querySelectorAll('li');
      options.forEach(function (option) {
        option.style.display = 'flex';
      });
    }
  }, {
    key: "handleFilterInput",
    value: function handleFilterInput() {
      if (this.selectOptions.classList.contains('active')) {
        var filterValue = this.selectSearch.value.toLowerCase();
        var options = this.selectOptions.querySelectorAll('li');
        options.forEach(function (option) {
          return option.classList.remove('selected');
        });
        var visibleOptions = [];
        options.forEach(function (option) {
          var optionValue = option.getAttribute('data-value');
          // const startsWithFilter = optionValue.startsWith(filterValue);
          var startsWithFilter = optionValue.includes(filterValue);
          if (startsWithFilter) {
            option.style.display = 'flex';
            visibleOptions.push(option);
          } else {
            option.style.display = 'none';
          }
        });
        if (visibleOptions.length > 0) {
          this.highlightOption(visibleOptions, 0);
        } else {
          this.clearFilter();
        }
      }
    }
  }, {
    key: "findNextVisibleIndex",
    value: function findNextVisibleIndex(options, currentIndex) {
      var nextIndex = currentIndex + 1;
      while (nextIndex < options.length) {
        if (options[nextIndex].style.display !== 'none') {
          return nextIndex;
        }
        nextIndex++;
      }
      return currentIndex; // If no next visible option, stay on the current index
    }
  }, {
    key: "findPreviousVisibleIndex",
    value: function findPreviousVisibleIndex(options, currentIndex) {
      var previousIndex = currentIndex - 1;
      while (previousIndex >= 0) {
        if (options[previousIndex].style.display !== 'none') {
          return previousIndex;
        }
        previousIndex--;
      }
      return currentIndex; // If no previous visible option, stay on the current index
    }
  }, {
    key: "uniqueId",
    value: function uniqueId() {
      var text = '';
      var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      for (var i = 0; i < 2; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      var text2 = '';
      var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      for (var _i = 0; _i < 5; _i++) {
        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
      }
      return text + text2;
    }
  }]);
  return CustomSelect;
}();
/* harmony default export */ const customselect = (CustomSelect);
;// CONCATENATED MODULE: ./src/contentbuilder/snippetpanel.js
function snippetpanel_toConsumableArray(arr) { return snippetpanel_arrayWithoutHoles(arr) || snippetpanel_iterableToArray(arr) || snippetpanel_unsupportedIterableToArray(arr) || snippetpanel_nonIterableSpread(); }
function snippetpanel_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function snippetpanel_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return snippetpanel_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return snippetpanel_arrayLikeToArray(o, minLen); }
function snippetpanel_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function snippetpanel_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return snippetpanel_arrayLikeToArray(arr); }
function snippetpanel_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }


var renderSnippetPanel = function renderSnippetPanel(builder, snippetOpen) {
  var util = builder.util;
  var builderStuff = builder.builderStuff;
  var dom = builder.dom;
  var hideHandle = '';
  var sidePanel = builder.opts.sidePanel;
  if (builder.opts.snippetList === '#divSnippetList') {
    var html = "<div id=\"divSnippetList\" class=\"is-side ".concat(sidePanel === 'right' ? '' : ' fromleft', " snippetlist scroll-darker\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" title=\"").concat(util.out('Snippets'), "\">\n            </div>");
    dom.appendHtml(builderStuff, html);
    if (!builder.opts.snippetHandle) {
      hideHandle = 'display:none;';
    }
  } else {
    hideHandle = 'display:none;';
    sidePanel = 'left';
  }
  var defaultcatval = '';
  if (builder.opts.emailMode) {
    defaultcatval = builder.opts.defaultEmailSnippetCategory;
  } else {
    defaultcatval = builder.opts.defaultSnippetCategory;
  }
  var html_snippets = '' + "\n        <div style=\"position:absolute;top:0;right:0;padding: 0;width:100%;z-index:2;\">\n            <div class=\"inp-snippets\">\n            </div>\n        </div>\n\n        " + (sidePanel === 'right' ? '<div id="divSnippetScrollUp" role="button" tabindex="-1" style="top:calc(50% - 27px);right:25px;">&#9650;</div>' + '<div id="divSnippetScrollDown" role="button" tabindex="-1" style="top:calc(50% + 27px);right:25px;">&#9660;</div>' + '<div id="divSnippetHandle" role="button" tabindex="-1" title="' + util.out('Snippets') + '" data-title="' + util.out('Snippets') + '" style="' + hideHandle + '">' + '<svg class="is-icon-flex"><use xlink:href="#ion-ios-arrow-left"></use></svg>' + '</div>' : '<div id="divSnippetScrollUp" role="button" tabindex="-1" style="top:calc(50% - 27px);left:10px;">&#9650;</div>' + '<div id="divSnippetScrollDown" role="button" tabindex="-1" style="top:calc(50% + 27px);left:10px;">&#9660;</div>' + '<div id="divSnippetHandle" role="button" tabindex="-1" title="' + util.out('Snippets') + '" data-title="' + util.out('Snippets') + '" style="' + hideHandle + '">' + '<svg class="is-icon-flex"><use xlink:href="#ion-ios-arrow-right"></use></svg>' + '</div>') + '<div class="is-design-list" tabindex="0">' + '</div>';
  if (builder.opts.snippetModal) {
    builder.opts.snippetList = '#divSnippetWindow';
    var _html = "\n        <div class=\"is-modal active is-modal-content snippetwindow scroll-darker\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-bar is-draggable\">\n                <button class=\"is-modal-close\" tabindex=\"-1\" title=\"".concat(util.out('Close'), "\">&#10005;</button>\n            </div>\n            <div id=\"divSnippetWindow\">\n            </div>   \n        </div>\n        ");
    dom.appendHtml(builder.builderStuff, _html);
    builder.draggable('.snippetwindow .is-draggable');
    var snippetModal = builder.builderStuff.querySelector('.is-modal.snippetwindow');
    var btnClose = snippetModal.querySelector('.is-modal-close');
    btnClose.addEventListener('click', function () {
      snippetModal.classList.remove('active');
    });
    if (builder.snippetModalLeft) {
      snippetModal.classList.add('left');
    }
  }
  var snippetPanel = document.querySelector(builder.opts.snippetList);
  snippetPanel.innerHTML = ''; //clear
  dom.appendHtml(snippetPanel, html_snippets);
  var snippetList = [];
  builder.opts.snippetCategories.forEach(function (item) {
    var jsonItem = {};
    jsonItem.value = item[0];
    jsonItem.label = item[1];
    snippetList.push(jsonItem);
  });
  var inpSnippet = new customselect('.inp-snippets', {
    data: snippetList,
    search: false,
    onChange: function onChange(value) {
      var cat = value;
      var elms = snippetlist.querySelectorAll('.snippet-item');
      var exist = false;
      Array.prototype.forEach.call(elms, function (elm) {
        if (elm.getAttribute('data-cat') === cat) exist = true;
      });
      if (!exist) {
        builder.opts.snippetJSON.snippets.forEach(function (item) {
          if (item.category === cat) {
            dom.appendHtml(snippetlist, '<div class="snippet-item" data-id="' + item.id + '" data-cat="' + item.category + '"><img alt="' + util.out('Snippet') + '" alt="" src="' + snippetPath + item.thumbnail + '"><span class="is-overlay"></span></div>');
          }
        });
      }
      if (cat) {
        Array.prototype.forEach.call(elms, function (elm) {
          dom.addClass(elm, 'hide');
        });
        Array.prototype.forEach.call(elms, function (elm) {
          if (elm.getAttribute('data-cat') === cat) {
            elm.className = elm.className.replace(/hide/g, '');
          }
        });
      }
    }
  });
  inpSnippet.setValue(defaultcatval + '');
  inpSnippet.closeOptions();
  if (builder.opts.snippetList === '#divSnippetList') {
    snippetPanel.querySelector('.is-design-list').style.display = 'none';

    // Hide snippet panel on content click
    builder.doc.addEventListener('click', builder.doHideSnippetHandler = function (e) {
      e = e || window.event;
      var target = e.target || e.srcElement;
      if (builder.opts.snippetsSidebarDisplay === 'auto') {
        if (dom.hasClass(snippetPanel, 'active')) {
          // let a = dom.parentsHasAttribute(target, 'contenteditable');
          // let b = dom.parentsHasClass(target, 'is-builder'); // builder area
          // if(a||b) {
          //     hideSnippets(builder);
          // }
          var a = dom.parentsHasClass(target, 'is-builder'); // builder area
          if (a) {
            hideSnippets(builder);
          }
        }
      }
    }, false);
  }
  var snippetlist = document.querySelector('.is-design-list');
  var snippetPath = builder.opts.snippetPath;

  /*
  Hide slider snippets (backward compatible)
  let bHideSliderSnippet = false;
  try{
      if (typeof jQuery.fn.slick === 'undefined') {
          bHideSliderSnippet = true;
      }
  } catch(e){
      bHideSliderSnippet = true;
  }
  */

  var snippets = builder.opts.snippetJSON.snippets;
  var slider = builder.opts.slider;
  if (typeof slider !== 'undefined' && slider !== null) {
    if (slider === 'slick') {
      //remove glide
      var predicate = function predicate(item) {
        return item.type !== 'glide';
      };
      builder.opts.snippetJSON.snippets = snippets.filter(predicate);
    } else if (slider === 'glide') {
      //remove slick
      var _predicate = function _predicate(item) {
        return item.type !== 'slick';
      };
      builder.opts.snippetJSON.snippets = snippets.filter(_predicate);
    } else if (slider === 'all') {
      // Do Nothing
    } else {
      // remove all slider (if incorrect settings)
      var _predicate2 = function _predicate2(item) {
        return item.type !== 'glide' && item.type !== 'slick';
      };
      builder.opts.snippetJSON.snippets = snippets.filter(_predicate2);
    }

    // for (let i = 0; i < builder.opts.snippetJSON.snippets.length; i++) {
    //     console.log(builder.opts.snippetJSON.snippets[i].type)
    // }
  } else {
    // Backward compatible OR if slider param not set

    // Hide slider snippet if slick is not included
    var bHideSliderSnippet = true;
    if (builder.win.jQuery) {
      if (builder.win.jQuery.fn.slick) {
        bHideSliderSnippet = false;
      }
    }
    if (bHideSliderSnippet) {
      var result = snippets.filter(function (item) {
        return item.type !== 'slick';
      });
      snippets = snippetpanel_toConsumableArray(result);
    }
    if (!builder.win.Glide) {
      var _result = snippets.filter(function (item) {
        return !(item.glide || item.type === 'glide');
      });
      snippets = snippetpanel_toConsumableArray(_result);
    }

    // for (let i = 0; i < snippets.length; i++) {
    //     console.log(snippets[i].type)
    // }

    builder.opts.snippetJSON.snippets = snippetpanel_toConsumableArray(snippets);
  }
  var index = 1;
  if (builder.opts.emailMode) {
    builder.opts.snippetJSON.snippets.forEach(function (item) {
      item.id = index; //Give id to each record
      if (item.category === builder.opts.defaultEmailSnippetCategory + '') {
        dom.appendHtml(snippetlist, '<div class="snippet-item" data-id="' + item.id + '" data-cat="' + item.category + '"><img alt="' + util.out('Snippet') + '" src="' + snippetPath + item.thumbnail + '"><span class="is-overlay"></span></div>');
      }
      index++;
    });
  } else {
    builder.opts.snippetJSON.snippets.forEach(function (item) {
      item.id = index; //Give id to each record
      if (item.category === builder.opts.defaultSnippetCategory + '') {
        dom.appendHtml(snippetlist, '<div class="snippet-item" data-id="' + item.id + '" data-cat="' + item.category + '"><img alt="' + util.out('Snippet') + '" src="' + snippetPath + item.thumbnail + '"><span class="is-overlay"></span></div>');
      }
      index++;
    });
  }

  /*
  let userAgentString = navigator.userAgent; 
  let safariAgent = userAgentString.indexOf('Safari') > -1; 
  let chromeAgent = userAgentString.indexOf('Chrome') > -1; 
  if ((chromeAgent) && (safariAgent)) safariAgent = false;
  */
  // let safariAgent = false;

  var activeBuilderArea;
  var itemHeight;
  new sortable_esm(snippetlist, {
    // forceFallback: safariAgent,
    group: {
      name: 'shared',
      pull: 'clone',
      put: false // Do not allow items to be put into this list
    },

    sort: false,
    animation: 150,
    onChoose: function onChoose(evt) {
      // Adjust temmporary
      var newCss = "\n            <style id=\"css-scale\">\n                .sortable-ghost {\n                    height: 50px;\n                }\n                .sortable-ghost * {\n                    display: none\n                }\n            </style>\n            ";
      itemHeight = evt.item.offsetHeight;
      if (builder.iframe) {
        var oldCss = builder.contentStuff.querySelector('#css-scale');
        if (oldCss) oldCss.parentNode.removeChild(oldCss);
        builder.contentStuff.insertAdjacentHTML('afterbegin', newCss);
      } else {
        var _oldCss = builder.builderStuff.querySelector('#css-scale');
        if (_oldCss) _oldCss.parentNode.removeChild(_oldCss);
        builder.builderStuff.insertAdjacentHTML('afterbegin', newCss);
      }
      builder.uo.saveForUndo(true); // Must be called before sectionDropSetup() to prevent saving extra 'block-dummy' helpers.

      builder.sectionDropSetup();
      builder.util.clearPops();
      builder.hideElementTools();
    },
    onClone: function onClone(evt) {
      // fix broken image on cloned element
      var cloneEl = evt.clone;
      var img = cloneEl.querySelector('img');
      img.style.opacity = 0.0001;
      cloneEl.style.height = itemHeight + 'px';
      var timestamp = new Date().getTime();
      img.src = img.src + '?' + timestamp;
      img.style.opacity = '';
    },
    onMove: function onMove() {
      var emptyinfo = builder.doc.querySelector('.row-add-initial'); // if there is empty info, remove it during snippet drag drop
      // if(emptyinfo) emptyinfo.parentNode.removeChild(emptyinfo);
      if (emptyinfo) emptyinfo.style.display = 'none';

      // if(builder.sortableOnPage) if(evt.related.getBoundingClientRect().top<0 ||
      //     evt.related.getBoundingClientRect().top>window.innerHeight) {
      //     return false;
      // }
    },

    onSort: function onSort(evt) {
      if (!builder.canvas) return;
      var snippetX = evt.originalEvent.clientX;
      var snippetY = evt.originalEvent.clientY;
      var block = builder.doc.querySelector('[data-new-dummy]');
      if (block) {
        var docContainer = block.parentNode;
        var rectContainer = docContainer.getBoundingClientRect();
        block.offsetWidth / 2;
        var x = (snippetX - block.offsetWidth / 2 - rectContainer.left) / docContainer.offsetWidth * 100;
        var y = (snippetY - block.offsetHeight / 2 - rectContainer.top) / docContainer.offsetHeight * 100;
        block.style.top = y + '%';
        block.style.left = x + '%';
        block.removeAttribute('data-new-dummy');
      }
    },
    onStart: function onStart() {
      // Remove .builder-active during dragging (because this class makes rows have border-right/left 120px)
      activeBuilderArea = null;
      var area = builder.doc.querySelector('.builder-active');
      if (area) {
        activeBuilderArea = area;
        dom.removeClass(activeBuilderArea, 'builder-active');
      }

      // builder.uo.saveForUndo(); // Even if cancelled, saveForUndo will make sure not to save if there is no change => commented (moved to onChoose). 

      var elm = document.querySelector('.is-sidebar-overlay');
      if (elm) elm.style.display = 'none'; // LATER: ContentBox
    },

    onEnd: function onEnd() {
      var elm = document.querySelector('.is-sidebar-overlay');
      if (elm) elm.style.display = 'block'; // LATER: ContentBox
      util.checkEmpty(); // In case container is still empty (drag drop snippet cancelled)

      var emptyinfo = builder.doc.querySelector('.row-add-initial');
      if (emptyinfo) emptyinfo.style.display = '';

      // Return back the .builder-active
      if (activeBuilderArea) {
        dom.addClass(activeBuilderArea, 'builder-active');
      }

      // destroy
      if (builder.sortableOnCanvas) {
        builder.sortableOnCanvas.forEach(function (obj) {
          if (obj) {
            obj.destroy();
          }
        });
      }
      if (builder.sortableOnPage) builder.sortableOnPage.destroy();
      var dummies = builder.doc.querySelectorAll('.block-dummy');
      dummies.forEach(function (elm) {
        return elm.parentNode.removeChild(elm);
      });
    }
  });
  if (builder.opts.snippetList === '#divSnippetList') {
    var snippethandle = snippetPanel.querySelector('#divSnippetHandle');
    dom.addEventListener(snippethandle, 'click', function () {
      toggleSnippets(builder);
      util.clearActiveCell();
      util.clearControls();
    });
    var viewportWidth = window.innerWidth;
    if ((builder.opts.snippetOpen || snippetOpen) && viewportWidth >= 960) {
      snippetPanel.style.cssText = 'transition: all ease 0.8s;';
      setTimeout(function () {
        toggleSnippets(builder);
      }, 100);
      setTimeout(function () {
        snippetPanel.style.cssText = '';
      }, 1300);
    }
  }

  //Scroll helper
  var scrollup = snippetPanel.querySelector('#divSnippetScrollUp');
  var scrolldown = snippetPanel.querySelector('#divSnippetScrollDown');
  // if ((navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i)) || (navigator.userAgent.match(/iPad/i))) {

  // } else {
  //     scrollup.style.display = 'none';
  //     scrolldown.style.display = 'none';
  // }
  scrollup.style.display = 'none';
  scrolldown.style.display = 'none';

  /*
  TODO
  
  var maxScroll=100000000;       
  jQuery('#divSnippetScrollUp').css('display','none');
  jQuery('#divSnippetScrollUp').on("click touchup", function(e) { 
      jQuery(".is-design-list").animate({ scrollTop: (jQuery(".is-design-list").scrollTop() - (jQuery(".is-design-list").height()-150) ) + "px" },300, function(){
          if(jQuery(".is-design-list").scrollTop()!=0){
              jQuery('#divSnippetScrollUp').fadeIn(300);
          } else {
                  jQuery('#divSnippetScrollUp').fadeOut(300);
          }
          if(jQuery(".is-design-list").scrollTop() != maxScroll){
              jQuery('#divSnippetScrollDown').fadeIn(300);
          } else {
                  jQuery('#divSnippetScrollDown').fadeOut(300);
          }  
      });           
       e.preventDefault();
      e.stopImmediatePropagation();
      return false;
  });            
  jQuery('#divSnippetScrollDown').on("click touchup", function(e) {                         
      jQuery(".is-design-list").animate({ scrollTop: (jQuery(".is-design-list").scrollTop() + (jQuery(".is-design-list").height()-150) ) + "px" }, 300, function() {
          if(jQuery(".is-design-list").scrollTop()!=0){
              jQuery('#divSnippetScrollUp').fadeIn(300);
          } else {
              jQuery('#divSnippetScrollUp').fadeOut(300);
      
          }
          if(maxScroll===100000000){
              maxScroll = jQuery('.is-design-list').prop('scrollHeight') - jQuery('.is-design-list').height() - 30;
          }  
          
          if(jQuery(".is-design-list").scrollTop() != maxScroll){
              jQuery('#divSnippetScrollDown').fadeIn(300);
          } else {
              jQuery('#divSnippetScrollDown').fadeOut(300);
          }  
      });
       e.preventDefault();
      e.stopImmediatePropagation();
      return false;
  });
  */
};

function openSnippets(builder) {
  var snippetPanel = document.querySelector('#divSnippetList');
  var snippethandle = snippetPanel.querySelector('#divSnippetHandle');
  snippetPanel.style.cssText = 'transition: all ease 0.8s;';
  snippetPanel.querySelector('.is-design-list').style.display = 'block';
  snippetPanel.classList.add('active');
  if (builder.opts.sidePanel === 'right') {
    snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-right"></use></svg>';
  } else {
    snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-left"></use></svg>';
  }
  setTimeout(function () {
    snippetPanel.style.cssText = '';
  }, 800);
}
function toggleSnippets(builder) {
  var dom = builder.dom;
  var snippetPanel = document.querySelector('#divSnippetList');
  var snippethandle = snippetPanel.querySelector('#divSnippetHandle');
  if (dom.hasClass(snippetPanel, 'active')) {
    dom.removeClass(snippetPanel, 'active');
    if (builder.opts.sidePanel === 'right') {
      snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-left"></use></svg>';
    } else {
      snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-right"></use></svg>';
    }
    setTimeout(function () {
      snippetPanel.querySelector('.is-design-list').style.display = 'none';
    }, 300);
  } else {
    snippetPanel.querySelector('.is-design-list').style.display = 'block';
    setTimeout(function () {
      dom.addClass(snippetPanel, 'active');
      if (builder.opts.sidePanel === 'right') {
        snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-right"></use></svg>';
      } else {
        snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-left"></use></svg>';
      }
    }, 10);
  }
}
function hideSnippets(builder) {
  var dom = builder.dom;
  var snippetPanel = document.querySelector('#divSnippetList');
  var snippethandle = snippetPanel.querySelector('#divSnippetHandle');
  dom.removeClass(snippetPanel, 'active');
  if (builder.opts.sidePanel === 'right') {
    snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-left"></use></svg>';
  } else {
    snippethandle.innerHTML = '<svg class="is-icon-flex" style="width:17px;height:17px;"><use xlink:href="#ion-ios-arrow-right"></use></svg>';
  }
  setTimeout(function () {
    snippetPanel.querySelector('.is-design-list').style.display = 'none';
  }, 300);
}
/* harmony default export */ const snippetpanel = (renderSnippetPanel);
// EXTERNAL MODULE: ./node_modules/cropperjs/dist/cropper.js
var cropper = __webpack_require__(129);
var cropper_default = /*#__PURE__*/__webpack_require__.n(cropper);
;// CONCATENATED MODULE: ./node_modules/framework-utils/dist/utils.esm.js
/*
Copyright (c) 2019 Daybrush
name: framework-utils
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/framework-utils.git
version: 1.1.0
*/
function prefixNames(prefix) {
  var classNames = [];

  for (var _i = 1; _i < arguments.length; _i++) {
    classNames[_i - 1] = arguments[_i];
  }

  return classNames.map(function (className) {
    return className.split(" ").map(function (name) {
      return name ? "" + prefix + name : "";
    }).join(" ");
  }).join(" ");
}
function prefixCSS(prefix, css) {
  return css.replace(/([^}{]*){/gm, function (_, selector) {
    return selector.replace(/\.([^{,\s\d.]+)/g, "." + prefix + "$1") + "{";
  });
}
/* react */

function ref(target, name) {
  return function (e) {
    e && (target[name] = e);
  };
}
function refs(target, name, i) {
  return function (e) {
    e && (target[name][i] = e);
  };
}
/* Class Decorator */

function Properties(properties, action) {
  return function (component) {
    var prototype = component.prototype;
    properties.forEach(function (property) {
      action(prototype, property);
    });
  };
}
/* Property Decorator */

function withMethods(methods, duplicate) {
  if (duplicate === void 0) {
    duplicate = {};
  }

  return function (prototype, propertyName) {
    methods.forEach(function (name) {
      var methodName = duplicate[name] || name;

      if (methodName in prototype) {
        return;
      }

      prototype[methodName] = function () {
        var _a;

        var args = [];

        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }

        var result = (_a = this[propertyName])[name].apply(_a, args);

        if (result === this[propertyName]) {
          return this;
        } else {
          return result;
        }
      };
    });
  };
}


//# sourceMappingURL=utils.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@egjs/list-differ/dist/list-differ.esm.js
/*
Copyright (c) 2019-present NAVER Corp.
name: @egjs/list-differ
license: MIT
author: NAVER Corp.
repository: https://github.com/naver/egjs-list-differ
version: 1.0.0
*/
/*
egjs-list-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/
var PolyMap =
/*#__PURE__*/
function () {
  function PolyMap() {
    this.keys = [];
    this.values = [];
  }

  var __proto = PolyMap.prototype;

  __proto.get = function (key) {
    return this.values[this.keys.indexOf(key)];
  };

  __proto.set = function (key, value) {
    var keys = this.keys;
    var values = this.values;
    var prevIndex = keys.indexOf(key);
    var index = prevIndex === -1 ? keys.length : prevIndex;
    keys[index] = key;
    values[index] = value;
  };

  return PolyMap;
}();

/*
egjs-list-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/
var HashMap =
/*#__PURE__*/
function () {
  function HashMap() {
    this.object = {};
  }

  var __proto = HashMap.prototype;

  __proto.get = function (key) {
    return this.object[key];
  };

  __proto.set = function (key, value) {
    this.object[key] = value;
  };

  return HashMap;
}();

/*
egjs-list-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/
var SUPPORT_MAP = typeof Map === "function";

/*
egjs-list-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/
var Link =
/*#__PURE__*/
function () {
  function Link() {}

  var __proto = Link.prototype;

  __proto.connect = function (prevLink, nextLink) {
    this.prev = prevLink;
    this.next = nextLink;
    prevLink && (prevLink.next = this);
    nextLink && (nextLink.prev = this);
  };

  __proto.disconnect = function () {
    // In double linked list, diconnect the interconnected relationship.
    var prevLink = this.prev;
    var nextLink = this.next;
    prevLink && (prevLink.next = nextLink);
    nextLink && (nextLink.prev = prevLink);
  };

  __proto.getIndex = function () {
    var link = this;
    var index = -1;

    while (link) {
      link = link.prev;
      ++index;
    }

    return index;
  };

  return Link;
}();

/*
egjs-list-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/

function orderChanged(changed, fixed) {
  // It is roughly in the order of these examples.
  // 4, 6, 0, 2, 1, 3, 5, 7
  var fromLinks = []; // 0, 1, 2, 3, 4, 5, 6, 7

  var toLinks = [];
  changed.forEach(function (_a) {
    var from = _a[0],
        to = _a[1];
    var link = new Link();
    fromLinks[from] = link;
    toLinks[to] = link;
  }); // `fromLinks` are connected to each other by double linked list.

  fromLinks.forEach(function (link, i) {
    link.connect(fromLinks[i - 1]);
  });
  return changed.filter(function (_, i) {
    return !fixed[i];
  }).map(function (_a, i) {
    var from = _a[0],
        to = _a[1];

    if (from === to) {
      return [0, 0];
    }

    var fromLink = fromLinks[from];
    var toLink = toLinks[to - 1];
    var fromIndex = fromLink.getIndex(); // Disconnect the link connected to `fromLink`.

    fromLink.disconnect(); // Connect `fromLink` to the right of `toLink`.

    if (!toLink) {
      fromLink.connect(undefined, fromLinks[0]);
    } else {
      fromLink.connect(toLink, toLink.next);
    }

    var toIndex = fromLink.getIndex();
    return [fromIndex, toIndex];
  });
}

var Result =
/*#__PURE__*/
function () {
  function Result(prevList, list, added, removed, changed, maintained, changedBeforeAdded, fixed) {
    this.prevList = prevList;
    this.list = list;
    this.added = added;
    this.removed = removed;
    this.changed = changed;
    this.maintained = maintained;
    this.changedBeforeAdded = changedBeforeAdded;
    this.fixed = fixed;
  }

  var __proto = Result.prototype;
  Object.defineProperty(__proto, "ordered", {
    get: function () {
      if (!this.cacheOrdered) {
        this.caculateOrdered();
      }

      return this.cacheOrdered;
    },
    enumerable: true,
    configurable: true
  });
  Object.defineProperty(__proto, "pureChanged", {
    get: function () {
      if (!this.cachePureChanged) {
        this.caculateOrdered();
      }

      return this.cachePureChanged;
    },
    enumerable: true,
    configurable: true
  });

  __proto.caculateOrdered = function () {
    var ordered = orderChanged(this.changedBeforeAdded, this.fixed);
    var changed = this.changed;
    var pureChanged = [];
    this.cacheOrdered = ordered.filter(function (_a, i) {
      var from = _a[0],
          to = _a[1];
      var _b = changed[i],
          fromBefore = _b[0],
          toBefore = _b[1];

      if (from !== to) {
        pureChanged.push([fromBefore, toBefore]);
        return true;
      }
    });
    this.cachePureChanged = pureChanged;
  };

  return Result;
}();

/**
 *
 * @memberof eg.ListDiffer
 * @static
 * @function
 * @param - Previous List <ko> 이전 목록 </ko>
 * @param - List to Update <ko> 업데이트 할 목록 </ko>
 * @param - This callback function returns the key of the item. <ko> 아이템의 키를 반환하는 콜백 함수입니다.</ko>
 * @return - Returns the diff between `prevList` and `list` <ko> `prevList`와 `list`의 다른 점을 반환한다.</ko>
 * @example
 * import { diff } from "@egjs/list-differ";
 * // script => eg.ListDiffer.diff
 * const result = diff([0, 1, 2, 3, 4, 5], [7, 8, 0, 4, 3, 6, 2, 1], e => e);
 * // List before update
 * // [1, 2, 3, 4, 5]
 * console.log(result.prevList);
 * // Updated list
 * // [4, 3, 6, 2, 1]
 * console.log(result.list);
 * // Index array of values added to `list`
 * // [0, 1, 5]
 * console.log(result.added);
 * // Index array of values removed in `prevList`
 * // [5]
 * console.log(result.removed);
 * // An array of index pairs of `prevList` and `list` with different indexes from `prevList` and `list`
 * // [[0, 2], [4, 3], [3, 4], [2, 6], [1, 7]]
 * console.log(result.changed);
 * // The subset of `changed` and an array of index pairs that moved data directly. Indicate an array of absolute index pairs of `ordered`.(Formatted by: Array<[index of prevList, index of list]>)
 * // [[4, 3], [3, 4], [2, 6]]
 * console.log(result.pureChanged);
 * // An array of index pairs to be `ordered` that can synchronize `list` before adding data. (Formatted by: Array<[prevIndex, nextIndex]>)
 * // [[4, 1], [4, 2], [4, 3]]
 * console.log(result.ordered);
 * // An array of index pairs of `prevList` and `list` that have not been added/removed so data is preserved
 * // [[0, 2], [4, 3], [3, 4], [2, 6], [1, 7]]
 * console.log(result.maintained);
 */

function diff(prevList, list, findKeyCallback) {
  var mapClass = SUPPORT_MAP ? Map : findKeyCallback ? HashMap : PolyMap;

  var callback = findKeyCallback || function (e) {
    return e;
  };

  var added = [];
  var removed = [];
  var maintained = [];
  var prevKeys = prevList.map(callback);
  var keys = list.map(callback);
  var prevKeyMap = new mapClass();
  var keyMap = new mapClass();
  var changedBeforeAdded = [];
  var fixed = [];
  var removedMap = {};
  var changed = [];
  var addedCount = 0;
  var removedCount = 0; // Add prevKeys and keys to the hashmap.

  prevKeys.forEach(function (key, prevListIndex) {
    prevKeyMap.set(key, prevListIndex);
  });
  keys.forEach(function (key, listIndex) {
    keyMap.set(key, listIndex);
  }); // Compare `prevKeys` and `keys` and add them to `removed` if they are not in `keys`.

  prevKeys.forEach(function (key, prevListIndex) {
    var listIndex = keyMap.get(key); // In prevList, but not in list, it is removed.

    if (typeof listIndex === "undefined") {
      ++removedCount;
      removed.push(prevListIndex);
    } else {
      removedMap[listIndex] = removedCount;
    }
  }); // Compare `prevKeys` and `keys` and add them to `added` if they are not in `prevKeys`.

  keys.forEach(function (key, listIndex) {
    var prevListIndex = prevKeyMap.get(key); // In list, but not in prevList, it is added.

    if (typeof prevListIndex === "undefined") {
      added.push(listIndex);
      ++addedCount;
    } else {
      maintained.push([prevListIndex, listIndex]);
      removedCount = removedMap[listIndex] || 0;
      changedBeforeAdded.push([prevListIndex - removedCount, listIndex - addedCount]);
      fixed.push(listIndex === prevListIndex);

      if (prevListIndex !== listIndex) {
        changed.push([prevListIndex, listIndex]);
      }
    }
  }); // Sort by ascending order of 'to(list's index).

  removed.reverse();
  return new Result(prevList, list, added, removed, changed, maintained, changedBeforeAdded, fixed);
}

/**
 * A module that checks diff when values are added, removed, or changed in an array.
 * @ko 배열 또는 오브젝트에서 값이 추가되거나 삭제되거나 순서가 변경사항을 체크하는 모듈입니다.
 * @memberof eg
 */

var ListDiffer =
/*#__PURE__*/
function () {
  /**
   * @param - Initializing Data Array. <ko> 초기 설정할 데이터 배열.</ko>
   * @param - This callback function returns the key of the item. <ko> 아이템의 키를 반환하는 콜백 함수입니다.</ko>
   * @example
   * import ListDiffer from "@egjs/list-differ";
   * // script => eg.ListDiffer
   * const differ = new ListDiffer([0, 1, 2, 3, 4, 5], e => e);
   * const result = differ.update([7, 8, 0, 4, 3, 6, 2, 1]);
   * // List before update
   * // [1, 2, 3, 4, 5]
   * console.log(result.prevList);
   * // Updated list
   * // [4, 3, 6, 2, 1]
   * console.log(result.list);
   * // Index array of values added to `list`.
   * // [0, 1, 5]
   * console.log(result.added);
   * // Index array of values removed in `prevList`.
   * // [5]
   * console.log(result.removed);
   * // An array of index pairs of `prevList` and `list` with different indexes from `prevList` and `list`.
   * // [[0, 2], [4, 3], [3, 4], [2, 6], [1, 7]]
   * console.log(result.changed);
   * // The subset of `changed` and an array of index pairs that moved data directly. Indicate an array of absolute index pairs of `ordered`.(Formatted by: Array<[index of prevList, index of list]>)
   * // [[4, 3], [3, 4], [2, 6]]
   * console.log(result.pureChanged);
   * // An array of index pairs to be `ordered` that can synchronize `list` before adding data. (Formatted by: Array<[prevIndex, nextIndex]>)
   * // [[4, 1], [4, 2], [4, 3]]
   * console.log(result.ordered);
   * // An array of index pairs of `prevList` and `list` that have not been added/removed so data is preserved.
   * // [[0, 2], [4, 3], [3, 4], [2, 6], [1, 7]]
   * console.log(result.maintained);
   */
  function ListDiffer(list, findKeyCallback) {
    if (list === void 0) {
      list = [];
    }

    this.findKeyCallback = findKeyCallback;
    this.list = [].slice.call(list);
  }
  /**
   * Update list.
   * @ko 리스트를 업데이트를 합니다.
   * @param - List to update <ko> 업데이트할 리스트 </ko>
   * @return - Returns the results of an update from `prevList` to `list`.<ko> `prevList`에서 `list`로 업데이트한 결과를 반환한다. </ko>
   */


  var __proto = ListDiffer.prototype;

  __proto.update = function (list) {
    var newData = [].slice.call(list);
    var result = diff(this.list, newData, this.findKeyCallback);
    this.list = newData;
    return result;
  };

  return ListDiffer;
}();

/*
egjs-list-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/

/* harmony default export */ const list_differ_esm = (ListDiffer);

//# sourceMappingURL=list-differ.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@daybrush/utils/dist/utils.esm.js
/*
Copyright (c) 2018 Daybrush
@name: @daybrush/utils
license: MIT
author: Daybrush
repository: https://github.com/daybrush/utils
@version 1.7.1
*/
/**
* @namespace
* @name Consts
*/

/**
* get string "rgb"
* @memberof Color
* @example
import {RGB} from "@daybrush/utils";

console.log(RGB); // "rgb"
*/
var RGB = "rgb";
/**
* get string "rgba"
* @memberof Color
* @example
import {RGBA} from "@daybrush/utils";

console.log(RGBA); // "rgba"
*/

var RGBA = "rgba";
/**
* get string "hsl"
* @memberof Color
* @example
import {HSL} from "@daybrush/utils";

console.log(HSL); // "hsl"
*/

var HSL = "hsl";
/**
* get string "hsla"
* @memberof Color
* @example
import {HSLA} from "@daybrush/utils";

console.log(HSLA); // "hsla"
*/

var HSLA = "hsla";
/**
* gets an array of color models.
* @memberof Color
* @example
import {COLOR_MODELS} from "@daybrush/utils";

console.log(COLOR_MODELS); // ["rgb", "rgba", "hsl", "hsla"];
*/

var COLOR_MODELS = [RGB, RGBA, HSL, HSLA];
/**
* get string "function"
* @memberof Consts
* @example
import {FUNCTION} from "@daybrush/utils";

console.log(FUNCTION); // "function"
*/

var FUNCTION = "function";
/**
* get string "property"
* @memberof Consts
* @example
import {PROPERTY} from "@daybrush/utils";

console.log(PROPERTY); // "property"
*/

var PROPERTY = "property";
/**
* get string "array"
* @memberof Consts
* @example
import {ARRAY} from "@daybrush/utils";

console.log(ARRAY); // "array"
*/

var ARRAY = "array";
/**
* get string "object"
* @memberof Consts
* @example
import {OBJECT} from "@daybrush/utils";

console.log(OBJECT); // "object"
*/

var OBJECT = "object";
/**
* get string "string"
* @memberof Consts
* @example
import {STRING} from "@daybrush/utils";

console.log(STRING); // "string"
*/

var STRING = "string";
/**
* get string "number"
* @memberof Consts
* @example
import {NUMBER} from "@daybrush/utils";

console.log(NUMBER); // "number"
*/

var NUMBER = "number";
/**
* get string "undefined"
* @memberof Consts
* @example
import {UNDEFINED} from "@daybrush/utils";

console.log(UNDEFINED); // "undefined"
*/

var UNDEFINED = "undefined";
/**
* Check whether the environment is window or node.js.
* @memberof Consts
* @example
import {IS_WINDOW} from "@daybrush/utils";

console.log(IS_WINDOW); // false in node.js
console.log(IS_WINDOW); // true in browser
*/

var IS_WINDOW = typeof window !== UNDEFINED;
/**
* Check whether the environment is window or node.js.
* @memberof Consts
* @name document
* @example
import {IS_WINDOW} from "@daybrush/utils";

console.log(IS_WINDOW); // false in node.js
console.log(IS_WINDOW); // true in browser
*/

var doc = typeof document !== UNDEFINED && document; // FIXME: this type maybe false
var prefixes = (/* unused pure expression or super */ null && (["webkit", "ms", "moz", "o"]));
/**
 * @namespace CrossBrowser
 */

/**
* Get a CSS property with a vendor prefix that supports cross browser.
* @function
* @param {string} property - A CSS property
* @return {string} CSS property with cross-browser vendor prefix
* @memberof CrossBrowser
* @example
import {getCrossBrowserProperty} from "@daybrush/utils";

console.log(getCrossBrowserProperty("transform")); // "transform", "-ms-transform", "-webkit-transform"
console.log(getCrossBrowserProperty("filter")); // "filter", "-webkit-filter"
*/

var getCrossBrowserProperty = /*#__PURE__*/function (property) {
  if (!doc) {
    return "";
  }

  var styles = (doc.body || doc.documentElement).style;
  var length = prefixes.length;

  if (typeof styles[property] !== UNDEFINED) {
    return property;
  }

  for (var i = 0; i < length; ++i) {
    var name = "-" + prefixes[i] + "-" + property;

    if (typeof styles[name] !== UNDEFINED) {
      return name;
    }
  }

  return "";
};
/**
* get string "transfrom" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {TRANSFORM} from "@daybrush/utils";

console.log(TRANSFORM); // "transform", "-ms-transform", "-webkit-transform"
*/

var TRANSFORM = /*#__PURE__*/(/* unused pure expression or super */ null && (getCrossBrowserProperty("transform")));
/**
* get string "filter" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {FILTER} from "@daybrush/utils";

console.log(FILTER); // "filter", "-ms-filter", "-webkit-filter"
*/

var FILTER = /*#__PURE__*/(/* unused pure expression or super */ null && (getCrossBrowserProperty("filter")));
/**
* get string "animation" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {ANIMATION} from "@daybrush/utils";

console.log(ANIMATION); // "animation", "-ms-animation", "-webkit-animation"
*/

var ANIMATION = /*#__PURE__*/(/* unused pure expression or super */ null && (getCrossBrowserProperty("animation")));
/**
* get string "keyframes" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {KEYFRAMES} from "@daybrush/utils";

console.log(KEYFRAMES); // "keyframes", "-ms-keyframes", "-webkit-keyframes"
*/

var KEYFRAMES = /*#__PURE__*/(/* unused pure expression or super */ null && (ANIMATION.replace("animation", "keyframes")));
var OPEN_CLOSED_CHARACTERS = [{
  open: "(",
  close: ")"
}, {
  open: "\"",
  close: "\""
}, {
  open: "'",
  close: "'"
}, {
  open: "\\\"",
  close: "\\\""
}, {
  open: "\\'",
  close: "\\'"
}];
var TINY_NUM = 0.0000001;
var REVERSE_TINY_NUM = 1 / TINY_NUM;
var DEFAULT_UNIT_PRESETS = {
  "cm": function (pos) {
    return pos * 96 / 2.54;
  },
  "mm": function (pos) {
    return pos * 96 / 254;
  },
  "in": function (pos) {
    return pos * 96;
  },
  "pt": function (pos) {
    return pos * 96 / 72;
  },
  "pc": function (pos) {
    return pos * 96 / 6;
  },
  "%": function (pos, size) {
    return pos * size / 100;
  },
  "vw": function (pos, size) {
    if (size === void 0) {
      size = window.innerWidth;
    }

    return pos / 100 * size;
  },
  "vh": function (pos, size) {
    if (size === void 0) {
      size = window.innerHeight;
    }

    return pos / 100 * size;
  },
  "vmax": function (pos, size) {
    if (size === void 0) {
      size = Math.max(window.innerWidth, window.innerHeight);
    }

    return pos / 100 * size;
  },
  "vmin": function (pos, size) {
    if (size === void 0) {
      size = Math.min(window.innerWidth, window.innerHeight);
    }

    return pos / 100 * size;
  }
};

/**
* @namespace
* @name Utils
*/

/**
 * Returns the inner product of two numbers(`a1`, `a2`) by two criteria(`b1`, `b2`).
 * @memberof Utils
 * @param - The first number
 * @param - The second number
 * @param - The first number to base on the inner product
 * @param - The second number to base on the inner product
 * @return - Returns the inner product
import { dot } from "@daybrush/utils";

console.log(dot(0, 15, 2, 3)); // 6
console.log(dot(5, 15, 2, 3)); // 9
console.log(dot(5, 15, 1, 1)); // 10
 */

function dot(a1, a2, b1, b2) {
  return (a1 * b2 + a2 * b1) / (b1 + b2);
}
/**
* Check the type that the value is undefined.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {boolean} true if the type is correct, false otherwise
* @example
import {isUndefined} from "@daybrush/utils";

console.log(isUndefined(undefined)); // true
console.log(isUndefined("")); // false
console.log(isUndefined(1)); // false
console.log(isUndefined(null)); // false
*/

function isUndefined(value) {
  return typeof value === UNDEFINED;
}
/**
* Check the type that the value is object.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isObject} from "@daybrush/utils";

console.log(isObject({})); // true
console.log(isObject(undefined)); // false
console.log(isObject("")); // false
console.log(isObject(null)); // false
*/

function utils_esm_isObject(value) {
  return value && typeof value === OBJECT;
}
/**
* Check the type that the value is isArray.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isArray} from "@daybrush/utils";

console.log(isArray([])); // true
console.log(isArray({})); // false
console.log(isArray(undefined)); // false
console.log(isArray(null)); // false
*/

function isArray(value) {
  return Array.isArray(value);
}
/**
* Check the type that the value is string.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isString} from "@daybrush/utils";

console.log(isString("1234")); // true
console.log(isString(undefined)); // false
console.log(isString(1)); // false
console.log(isString(null)); // false
*/

function isString(value) {
  return typeof value === STRING;
}
function isNumber(value) {
  return typeof value === NUMBER;
}
/**
* Check the type that the value is function.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isFunction} from "@daybrush/utils";

console.log(isFunction(function a() {})); // true
console.log(isFunction(() => {})); // true
console.log(isFunction("1234")); // false
console.log(isFunction(1)); // false
console.log(isFunction(null)); // false
*/

function utils_esm_isFunction(value) {
  return typeof value === FUNCTION;
}

function isEqualSeparator(character, separator) {
  var isCharacterSpace = character === "" || character == " ";
  var isSeparatorSpace = separator === "" || separator == " ";
  return isSeparatorSpace && isCharacterSpace || character === separator;
}

function findOpen(openCharacter, texts, index, length, openCloseCharacters) {
  var isIgnore = findIgnore(openCharacter, texts, index);

  if (!isIgnore) {
    return findClose(openCharacter, texts, index + 1, length, openCloseCharacters);
  }

  return index;
}

function findIgnore(character, texts, index) {
  if (!character.ignore) {
    return null;
  }

  var otherText = texts.slice(Math.max(index - 3, 0), index + 3).join("");
  return new RegExp(character.ignore).exec(otherText);
}

function findClose(closeCharacter, texts, index, length, openCloseCharacters) {
  var _loop_1 = function (i) {
    var character = texts[i].trim();

    if (character === closeCharacter.close && !findIgnore(closeCharacter, texts, i)) {
      return {
        value: i
      };
    }

    var nextIndex = i; // re open

    var openCharacter = utils_esm_find(openCloseCharacters, function (_a) {
      var open = _a.open;
      return open === character;
    });

    if (openCharacter) {
      nextIndex = findOpen(openCharacter, texts, i, length, openCloseCharacters);
    }

    if (nextIndex === -1) {
      return out_i_1 = i, "break";
    }

    i = nextIndex;
    out_i_1 = i;
  };

  var out_i_1;

  for (var i = index; i < length; ++i) {
    var state_1 = _loop_1(i);

    i = out_i_1;
    if (typeof state_1 === "object") return state_1.value;
    if (state_1 === "break") break;
  }

  return -1;
}

function splitText(text, splitOptions) {
  var _a = isString(splitOptions) ? {
    separator: splitOptions
  } : splitOptions,
      _b = _a.separator,
      separator = _b === void 0 ? "," : _b,
      isSeparateFirst = _a.isSeparateFirst,
      isSeparateOnlyOpenClose = _a.isSeparateOnlyOpenClose,
      _c = _a.isSeparateOpenClose,
      isSeparateOpenClose = _c === void 0 ? isSeparateOnlyOpenClose : _c,
      _d = _a.openCloseCharacters,
      openCloseCharacters = _d === void 0 ? OPEN_CLOSED_CHARACTERS : _d;

  var openClosedText = openCloseCharacters.map(function (_a) {
    var open = _a.open,
        close = _a.close;

    if (open === close) {
      return open;
    }

    return open + "|" + close;
  }).join("|");
  var regexText = "(\\s*" + separator + "\\s*|" + openClosedText + "|\\s+)";
  var regex = new RegExp(regexText, "g");
  var texts = text.split(regex).filter(Boolean);
  var length = texts.length;
  var values = [];
  var tempValues = [];

  function resetTemp() {
    if (tempValues.length) {
      values.push(tempValues.join(""));
      tempValues = [];
      return true;
    }

    return false;
  }

  var _loop_2 = function (i) {
    var character = texts[i].trim();
    var nextIndex = i;
    var openCharacter = utils_esm_find(openCloseCharacters, function (_a) {
      var open = _a.open;
      return open === character;
    });
    var closeCharacter = utils_esm_find(openCloseCharacters, function (_a) {
      var close = _a.close;
      return close === character;
    });

    if (openCharacter) {
      nextIndex = findOpen(openCharacter, texts, i, length, openCloseCharacters);

      if (nextIndex !== -1 && isSeparateOpenClose) {
        if (resetTemp() && isSeparateFirst) {
          return out_i_2 = i, "break";
        }

        values.push(texts.slice(i, nextIndex + 1).join(""));
        i = nextIndex;

        if (isSeparateFirst) {
          return out_i_2 = i, "break";
        }

        return out_i_2 = i, "continue";
      }
    } else if (closeCharacter && !findIgnore(closeCharacter, texts, i)) {
      throw new Error("invalid format: " + closeCharacter.close);
    } else if (isEqualSeparator(character, separator) && !isSeparateOnlyOpenClose) {
      resetTemp();

      if (isSeparateFirst) {
        return out_i_2 = i, "break";
      }

      return out_i_2 = i, "continue";
    }

    if (nextIndex === -1) {
      nextIndex = length - 1;
    }

    tempValues.push(texts.slice(i, nextIndex + 1).join(""));
    i = nextIndex;
    out_i_2 = i;
  };

  var out_i_2;

  for (var i = 0; i < length; ++i) {
    var state_2 = _loop_2(i);

    i = out_i_2;
    if (state_2 === "break") break;
  }

  if (tempValues.length) {
    values.push(tempValues.join(""));
  }

  return values;
}
/**
* divide text by space.
* @memberof Utils
* @param {string} text - text to divide
* @return {Array} divided texts
* @example
import {spliceSpace} from "@daybrush/utils";

console.log(splitSpace("a b c d e f g"));
// ["a", "b", "c", "d", "e", "f", "g"]
console.log(splitSpace("'a,b' c 'd,e' f g"));
// ["'a,b'", "c", "'d,e'", "f", "g"]
*/

function splitSpace(text) {
  // divide comma(space)
  return splitText(text, "");
}
/**
* divide text by comma.
* @memberof Utils
* @param {string} text - text to divide
* @return {Array} divided texts
* @example
import {splitComma} from "@daybrush/utils";

console.log(splitComma("a,b,c,d,e,f,g"));
// ["a", "b", "c", "d", "e", "f", "g"]
console.log(splitComma("'a,b',c,'d,e',f,g"));
// ["'a,b'", "c", "'d,e'", "f", "g"]
*/

function splitComma(text) {
  // divide comma(,)
  // "[^"]*"|'[^']*'
  return splitText(text, ",");
}
/**
* divide text by bracket "(", ")".
* @memberof Utils
* @param {string} text - text to divide
* @return {object} divided texts
* @example
import {splitBracket} from "@daybrush/utils";

console.log(splitBracket("a(1, 2)"));
// {prefix: "a", value: "1, 2", suffix: ""}
console.log(splitBracket("a(1, 2)b"));
// {prefix: "a", value: "1, 2", suffix: "b"}
*/

function splitBracket(text) {
  var matches = /([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(text);

  if (!matches || matches.length < 4) {
    return {};
  } else {
    return {
      prefix: matches[1],
      value: matches[2],
      suffix: matches[3]
    };
  }
}
/**
* divide text by number and unit.
* @memberof Utils
* @param {string} text - text to divide
* @return {} divided texts
* @example
import {splitUnit} from "@daybrush/utils";

console.log(splitUnit("10px"));
// {prefix: "", value: 10, unit: "px"}
console.log(splitUnit("-10px"));
// {prefix: "", value: -10, unit: "px"}
console.log(splitUnit("a10%"));
// {prefix: "a", value: 10, unit: "%"}
*/

function splitUnit(text) {
  var matches = /^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(text);

  if (!matches) {
    return {
      prefix: "",
      unit: "",
      value: NaN
    };
  }

  var prefix = matches[1];
  var value = matches[2];
  var unit = matches[3];
  return {
    prefix: prefix,
    unit: unit,
    value: parseFloat(value)
  };
}
/**
* transform strings to camel-case
* @memberof Utils
* @param {String} text - string
* @return {String} camel-case string
* @example
import {camelize} from "@daybrush/utils";

console.log(camelize("transform-origin")); // transformOrigin
console.log(camelize("abcd_efg")); // abcdEfg
console.log(camelize("abcd efg")); // abcdEfg
*/

function camelize(str) {
  return str.replace(/[\s-_]([a-z])/g, function (all, letter) {
    return letter.toUpperCase();
  });
}
/**
* transform a camelized string into a lowercased string.
* @memberof Utils
* @param {string} text - a camel-cased string
* @param {string} [separator="-"] - a separator
* @return {string}  a lowercased string
* @example
import {decamelize} from "@daybrush/utils";

console.log(decamelize("transformOrigin")); // transform-origin
console.log(decamelize("abcdEfg", "_")); // abcd_efg
*/

function decamelize(str, separator) {
  if (separator === void 0) {
    separator = "-";
  }

  return str.replace(/([a-z])([A-Z])/g, function (all, letter, letter2) {
    return "" + letter + separator + letter2.toLowerCase();
  });
}
/**
* transforms something in an array into an array.
* @memberof Utils
* @param - Array form
* @return an array
* @example
import {toArray} from "@daybrush/utils";

const arr1 = toArray(document.querySelectorAll(".a")); // Element[]
const arr2 = toArray(document.querySelectorAll<HTMLElement>(".a")); // HTMLElement[]
*/

function toArray(value) {
  return [].slice.call(value);
}
/**
* Date.now() method
* @memberof CrossBrowser
* @return {number} milliseconds
* @example
import {now} from "@daybrush/utils";

console.log(now()); // 12121324241(milliseconds)
*/

function now() {
  return Date.now ? Date.now() : new Date().getTime();
}
/**
* Returns the index of the first element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `findIndex` was called upon.
* @param - A function to execute on each value in the array until the function returns true, indicating that the satisfying element was found.
* @param - Returns defaultIndex if not found by the function.
* @example
import { findIndex } from "@daybrush/utils";

findIndex([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // 1
*/

function findIndex(arr, callback, defaultIndex) {
  if (defaultIndex === void 0) {
    defaultIndex = -1;
  }

  var length = arr.length;

  for (var i = 0; i < length; ++i) {
    if (callback(arr[i], i, arr)) {
      return i;
    }
  }

  return defaultIndex;
}
/**
* Returns the reverse direction index of the first element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `findLastIndex` was called upon.
* @param - A function to execute on each value in the array until the function returns true, indicating that the satisfying element was found.
* @param - Returns defaultIndex if not found by the function.
* @example
import { findLastIndex } from "@daybrush/utils";

findLastIndex([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // 1
*/

function findLastIndex(arr, callback, defaultIndex) {
  if (defaultIndex === void 0) {
    defaultIndex = -1;
  }

  var length = arr.length;

  for (var i = length - 1; i >= 0; --i) {
    if (callback(arr[i], i, arr)) {
      return i;
    }
  }

  return defaultIndex;
}
/**
* Returns the value of the reverse direction element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `findLast` was called upon.
* @param - A function to execute on each value in the array,
* @param - Returns defalutValue if not found by the function.
* @example
import { find } from "@daybrush/utils";

find([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // {a: 2}
*/

function findLast(arr, callback, defalutValue) {
  var index = findLastIndex(arr, callback);
  return index > -1 ? arr[index] : defalutValue;
}
/**
* Returns the value of the first element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `find` was called upon.
* @param - A function to execute on each value in the array,
* @param - Returns defalutValue if not found by the function.
* @example
import { find } from "@daybrush/utils";

find([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // {a: 2}
*/

function utils_esm_find(arr, callback, defalutValue) {
  var index = findIndex(arr, callback);
  return index > -1 ? arr[index] : defalutValue;
}
/**
* window.requestAnimationFrame() method with cross browser.
* @function
* @memberof CrossBrowser
* @param {FrameRequestCallback} callback - The function to call when it's time to update your animation for the next repaint.
* @return {number} id
* @example
import {requestAnimationFrame} from "@daybrush/utils";

requestAnimationFrame((timestamp) => {
  console.log(timestamp);
});
*/

var utils_esm_requestAnimationFrame = /*#__PURE__*/function () {
  var firstTime = now();
  var raf = IS_WINDOW && (window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame);
  return raf ? raf.bind(window) : function (callback) {
    var currTime = now();
    var id = window.setTimeout(function () {
      callback(currTime - firstTime);
    }, 1000 / 60);
    return id;
  };
}();
/**
* window.cancelAnimationFrame() method with cross browser.
* @function
* @memberof CrossBrowser
* @param {number} handle - the id obtained through requestAnimationFrame method
* @return {void}
* @example
import { requestAnimationFrame, cancelAnimationFrame } from "@daybrush/utils";

const id = requestAnimationFrame((timestamp) => {
  console.log(timestamp);
});

cancelAnimationFrame(id);
*/

var cancelAnimationFrame = /*#__PURE__*/function () {
  var caf = IS_WINDOW && (window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.mozCancelAnimationFrame || window.msCancelAnimationFrame);
  return caf ? caf.bind(window) : function (handle) {
    clearTimeout(handle);
  };
}();
/**
* @function
* @memberof Utils
*/

function getKeys(obj) {
  if (Object.keys) {
    return Object.keys(obj);
  }

  var keys = [];

  for (var name in keys) {
    keys.push(name);
  }

  return keys;
}
/**
* @function
* @memberof Utils
*/

function sortOrders(keys, orders) {
  if (orders === void 0) {
    orders = [];
  }

  keys.sort(function (a, b) {
    var index1 = orders.indexOf(a);
    var index2 = orders.indexOf(b);

    if (index2 === -1 && index1 === -1) {
      return 0;
    }

    if (index1 === -1) {
      return 1;
    }

    if (index2 === -1) {
      return -1;
    }

    return index1 - index2;
  });
}
/**
* convert unit size to px size
* @function
* @memberof Utils
*/

function convertUnitSize(pos, size) {
  var _a = splitUnit(pos),
      value = _a.value,
      unit = _a.unit;

  if (utils_esm_isObject(size)) {
    var sizeFunction = size[unit];

    if (sizeFunction) {
      if (utils_esm_isFunction(sizeFunction)) {
        return sizeFunction(value);
      } else if (DEFAULT_UNIT_PRESETS[unit]) {
        return DEFAULT_UNIT_PRESETS[unit](value, sizeFunction);
      }
    }
  } else if (unit === "%") {
    return value * size / 100;
  }

  if (DEFAULT_UNIT_PRESETS[unit]) {
    return DEFAULT_UNIT_PRESETS[unit](value);
  }

  return value;
}
/**
* calculate between min, max
* @function
* @memberof Utils
*/

function between(value, min, max) {
  return Math.max(min, Math.min(value, max));
}
function checkBoundSize(targetSize, compareSize, isMax, ratio) {
  if (ratio === void 0) {
    ratio = targetSize[0] / targetSize[1];
  }

  return [[utils_esm_throttle(compareSize[0], TINY_NUM), utils_esm_throttle(compareSize[0] / ratio, TINY_NUM)], [utils_esm_throttle(compareSize[1] * ratio, TINY_NUM), utils_esm_throttle(compareSize[1], TINY_NUM)]].filter(function (size) {
    return size.every(function (value, i) {
      var defaultSize = compareSize[i];
      var throttledSize = utils_esm_throttle(defaultSize, TINY_NUM);
      return isMax ? value <= defaultSize || value <= throttledSize : value >= defaultSize || value >= throttledSize;
    });
  })[0] || targetSize;
}
/**
* calculate bound size
* @function
* @memberof Utils
*/

function calculateBoundSize(size, minSize, maxSize, keepRatio) {
  if (!keepRatio) {
    return size.map(function (value, i) {
      return between(value, minSize[i], maxSize[i]);
    });
  }

  var width = size[0],
      height = size[1];
  var ratio = keepRatio === true ? width / height : keepRatio; // width : height = minWidth : minHeight;

  var _a = checkBoundSize(size, minSize, false, ratio),
      minWidth = _a[0],
      minHeight = _a[1];

  var _b = checkBoundSize(size, maxSize, true, ratio),
      maxWidth = _b[0],
      maxHeight = _b[1];

  if (width < minWidth || height < minHeight) {
    width = minWidth;
    height = minHeight;
  } else if (width > maxWidth || height > maxHeight) {
    width = maxWidth;
    height = maxHeight;
  }

  return [width, height];
}
/**
* Add all the numbers.
* @function
* @memberof Utils
*/

function sum(nums) {
  var length = nums.length;
  var total = 0;

  for (var i = length - 1; i >= 0; --i) {
    total += nums[i];
  }

  return total;
}
/**
* Average all numbers.
* @function
* @memberof Utils
*/

function utils_esm_average(nums) {
  var length = nums.length;
  var total = 0;

  for (var i = length - 1; i >= 0; --i) {
    total += nums[i];
  }

  return length ? total / length : 0;
}
/**
* Get the angle of two points. (0 <= rad < 359)
* @function
* @memberof Utils
*/

function getRad(pos1, pos2) {
  var distX = pos2[0] - pos1[0];
  var distY = pos2[1] - pos1[1];
  var rad = Math.atan2(distY, distX);
  return rad >= 0 ? rad : rad + Math.PI * 2;
}
/**
* Get the average point of all points.
* @function
* @memberof Utils
*/

function getCenterPoint(points) {
  return [0, 1].map(function (i) {
    return utils_esm_average(points.map(function (pos) {
      return pos[i];
    }));
  });
}
/**
* Gets the direction of the shape.
* @function
* @memberof Utils
*/

function getShapeDirection(points) {
  var center = getCenterPoint(points);
  var pos1Rad = getRad(center, points[0]);
  var pos2Rad = getRad(center, points[1]);
  return pos1Rad < pos2Rad && pos2Rad - pos1Rad < Math.PI || pos1Rad > pos2Rad && pos2Rad - pos1Rad < -Math.PI ? 1 : -1;
}
/**
* Get the distance between two points.
* @function
* @memberof Utils
*/

function utils_esm_getDist(a, b) {
  return Math.sqrt(Math.pow((b ? b[0] : 0) - a[0], 2) + Math.pow((b ? b[1] : 0) - a[1], 2));
}
/**
* throttle number depending on the unit.
* @function
* @memberof Utils
*/

function utils_esm_throttle(num, unit) {
  if (!unit) {
    return num;
  }

  var reverseUnit = 1 / unit;
  return Math.round(num / unit) / reverseUnit;
}
/**
* throttle number array depending on the unit.
* @function
* @memberof Utils
*/

function throttleArray(nums, unit) {
  nums.forEach(function (_, i) {
    nums[i] = utils_esm_throttle(nums[i], unit);
  });
  return nums;
}
/**
* @function
* @memberof Utils
*/

function counter(num) {
  var nums = [];

  for (var i = 0; i < num; ++i) {
    nums.push(i);
  }

  return nums;
}
/**
* @function
* @memberof Utils
*/

function replaceOnce(text, fromText, toText) {
  var isOnce = false;
  return text.replace(fromText, function () {
    var args = [];

    for (var _i = 0; _i < arguments.length; _i++) {
      args[_i] = arguments[_i];
    }

    if (isOnce) {
      return args[0];
    }

    isOnce = true;
    return isString(toText) ? toText : toText.apply(void 0, args);
  });
}

/**
* @namespace
* @name Color
*/

/**
* Remove the # from the hex color.
* @memberof Color
* @param {} hex - hex color
* @return {} hex color
* @example
import {cutHex} from "@daybrush/utils";

console.log(cutHex("#000000")) // "000000"
*/

function cutHex(hex) {
  return hex.replace("#", "");
}
/**
* convert hex color to rgb color.
* @memberof Color
* @param {} hex - hex color
* @return {} rgb color
* @example
import {hexToRGBA} from "@daybrush/utils";

console.log(hexToRGBA("#00000005"));
// [0, 0, 0, 1]
console.log(hexToRGBA("#201045"));
// [32, 16, 69, 1]
*/

function hexToRGBA(hex) {
  var h = cutHex(hex);
  var r = parseInt(h.substring(0, 2), 16);
  var g = parseInt(h.substring(2, 4), 16);
  var b = parseInt(h.substring(4, 6), 16);
  var a = parseInt(h.substring(6, 8), 16) / 255;

  if (isNaN(a)) {
    a = 1;
  }

  return [r, g, b, a];
}
/**
* convert 3(or 4)-digit hex color to 6(or 8)-digit hex color.
* @memberof Color
* @param {} hex - 3(or 4)-digit hex color
* @return {} 6(or 8)-digit hex color
* @example
import {toFullHex} from "@daybrush/utils";

console.log(toFullHex("#123")); // "#112233"
console.log(toFullHex("#123a")); // "#112233aa"
*/

function toFullHex(h) {
  var r = h.charAt(1);
  var g = h.charAt(2);
  var b = h.charAt(3);
  var a = h.charAt(4);
  var arr = ["#", r, r, g, g, b, b, a, a];
  return arr.join("");
}
/**
* convert hsl color to rgba color.
* @memberof Color
* @param {} hsl - hsl color(hue: 0 ~ 360, saturation: 0 ~ 1, lightness: 0 ~ 1, alpha: 0 ~ 1)
* @return {} rgba color
* @example
import {hslToRGBA} from "@daybrush/utils";

console.log(hslToRGBA([150, 0.5, 0.4]));
// [51, 153, 102, 1]
*/

function hslToRGBA(hsl) {
  var _a;

  var h = hsl[0];
  var s = hsl[1];
  var l = hsl[2];

  if (h < 0) {
    h += Math.floor((Math.abs(h) + 360) / 360) * 360;
  }

  h %= 360;
  var c = (1 - Math.abs(2 * l - 1)) * s;
  var x = c * (1 - Math.abs(h / 60 % 2 - 1));
  var m = l - c / 2;
  var rgb;

  if (h < 60) {
    rgb = [c, x, 0];
  } else if (h < 120) {
    rgb = [x, c, 0];
  } else if (h < 180) {
    rgb = [0, c, x];
  } else if (h < 240) {
    rgb = [0, x, c];
  } else if (h < 300) {
    rgb = [x, 0, c];
  } else if (h < 360) {
    rgb = [c, 0, x];
  } else {
    rgb = [0, 0, 0];
  }

  return [Math.round((rgb[0] + m) * 255), Math.round((rgb[1] + m) * 255), Math.round((rgb[2] + m) * 255), (_a = hsl[3]) !== null && _a !== void 0 ? _a : 1];
}
/**
* convert string to rgba color.
* @memberof Color
* @param {} - 3-hex(#000), 4-hex(#0000) 6-hex(#000000), 8-hex(#00000000) or RGB(A), or HSL(A)
* @return {} rgba color
* @example
import {stringToRGBA} from "@daybrush/utils";

console.log(stringToRGBA("#000000")); // [0, 0, 0, 1]
console.log(stringToRGBA("rgb(100, 100, 100)")); // [100, 100, 100, 1]
console.log(stringToRGBA("hsl(150, 0.5, 0.4)")); // [51, 153, 102, 1]
*/

function stringToRGBA(color) {
  if (color.charAt(0) === "#") {
    if (color.length === 4 || color.length === 5) {
      return hexToRGBA(toFullHex(color));
    } else {
      return hexToRGBA(color);
    }
  } else if (color.indexOf("(") !== -1) {
    // in bracket.
    var _a = splitBracket(color),
        prefix = _a.prefix,
        value = _a.value;

    if (!prefix || !value) {
      return undefined;
    }

    var arr = splitComma(value);
    var colorArr = [0, 0, 0, 1];
    var length = arr.length;

    switch (prefix) {
      case RGB:
      case RGBA:
        for (var i = 0; i < length; ++i) {
          colorArr[i] = parseFloat(arr[i]);
        }

        return colorArr;

      case HSL:
      case HSLA:
        for (var i = 0; i < length; ++i) {
          if (arr[i].indexOf("%") !== -1) {
            colorArr[i] = parseFloat(arr[i]) / 100;
          } else {
            colorArr[i] = parseFloat(arr[i]);
          }
        } // hsl, hsla to rgba


        return hslToRGBA(colorArr);
    }
  }

  return undefined;
}

/**
 * Returns all element descendants of node that
 * match selectors.
 */

/**
 * Checks if the specified class value exists in the element's class attribute.
 * @memberof DOM
 * @param - A DOMString containing one or more selectors to match
 * @param - If multi is true, a DOMString containing one or more selectors to match against.
 * @example
import {$} from "@daybrush/utils";

console.log($("div")); // div element
console.log($("div", true)); // [div, div] elements
*/

function $(selectors, multi) {
  return multi ? doc.querySelectorAll(selectors) : doc.querySelector(selectors);
}
/**
* Checks if the specified class value exists in the element's class attribute.
* @memberof DOM
* @param element - target
* @param className - the class name to search
* @return {boolean} return false if the class is not found.
* @example
import {hasClass} from "@daybrush/utils";

console.log(hasClass(element, "start")); // true or false
*/

function hasClass(element, className) {
  if (element.classList) {
    return element.classList.contains(className);
  }

  return !!element.className.match(new RegExp("(\\s|^)" + className + "(\\s|$)"));
}
/**
* Add the specified class value. If these classe already exist in the element's class attribute they are ignored.
* @memberof DOM
* @param element - target
* @param className - the class name to add
* @example
import {addClass} from "@daybrush/utils";

addClass(element, "start");
*/

function addClass(element, className) {
  if (element.classList) {
    element.classList.add(className);
  } else {
    element.className += " " + className;
  }
}
/**
* Removes the specified class value.
* @memberof DOM
* @param element - target
* @param className - the class name to remove
* @example
import {removeClass} from "@daybrush/utils";

removeClass(element, "start");
*/

function removeClass(element, className) {
  if (element.classList) {
    element.classList.remove(className);
  } else {
    var reg = new RegExp("(\\s|^)" + className + "(\\s|$)");
    element.className = element.className.replace(reg, " ");
  }
}
/**
* Gets the CSS properties from the element.
* @memberof DOM
* @param elements - elements
* @param properites - the CSS properties
* @return returns CSS properties and values.
* @example
import {fromCSS} from "@daybrush/utils";

console.log(fromCSS(element, ["left", "opacity", "top"])); // {"left": "10px", "opacity": 1, "top": "10px"}
*/

function fromCSS(elements, properties) {
  if (!elements || !properties || !properties.length) {
    return {};
  }

  var element;

  if (elements instanceof Element) {
    element = elements;
  } else if (elements.length) {
    element = elements[0];
  } else {
    return {};
  }

  var cssObject = {};
  var styles = window.getComputedStyle(element);
  var length = properties.length;

  for (var i = 0; i < length; ++i) {
    cssObject[properties[i]] = styles[properties[i]];
  }

  return cssObject;
}
/**
* Sets up a function that will be called whenever the specified event is delivered to the target
* @memberof DOM
* @param - event target
* @param - A case-sensitive string representing the event type to listen for.
* @param - The object which receives a notification (an object that implements the Event interface) when an event of the specified type occurs
* @param - An options object that specifies characteristics about the event listener.
* @example
import {addEvent} from "@daybrush/utils";

addEvent(el, "click", e => {
  console.log(e);
});
*/

function addEvent(el, type, listener, options) {
  el.addEventListener(type, listener, options);
}
/**
* removes from the EventTarget an event listener previously registered with EventTarget.addEventListener()
* @memberof DOM
* @param - event target
* @param - A case-sensitive string representing the event type to listen for.
* @param - The EventListener function of the event handler to remove from the event target.
* @param - An options object that specifies characteristics about the event listener.
* @example
import {addEvent, removeEvent} from "@daybrush/utils";
const listener = e => {
  console.log(e);
};
addEvent(el, "click", listener);
removeEvent(el, "click", listener);
*/

function removeEvent(el, type, listener, options) {
  el.removeEventListener(type, listener, options);
}


//# sourceMappingURL=utils.esm.js.map

;// CONCATENATED MODULE: ./node_modules/react-simple-compat/dist/compat.esm.js
/*
Copyright (c) Daybrush
name: react-simple-compat
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/react-simple-compat.git
version: 1.2.2
*/



/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

/* global Reflect, Promise */
var extendStatics = function (d, b) {
  extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (d, b) {
    d.__proto__ = b;
  } || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
  };

  return extendStatics(d, b);
};

function __extends(d, b) {
  extendStatics(d, b);

  function __() {
    this.constructor = d;
  }

  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
var __assign = function () {
  __assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return __assign.apply(this, arguments);
};
function __rest(s, e) {
  var t = {};

  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];

  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}
function __spreadArrays() {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;

  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];

  return r;
}

function isDiff(a, b) {
  if (a === b) {
    return false;
  }

  for (var i in a) {
    if (!(i in b)) {
      return true;
    }
  }

  for (var i in b) {
    if (a[i] !== b[i]) {
      return true;
    }
  }

  return false;
}

function diffObject(a, b) {
  var keys1 = Object.keys(a);
  var keys2 = Object.keys(b);
  var result = diff(keys1, keys2, function (key) {
    return key;
  });
  var added = {};
  var removed = {};
  var changed = {};
  result.added.forEach(function (index) {
    var name = keys2[index];
    added[name] = b[name];
  });
  result.removed.forEach(function (index) {
    var name = keys1[index];
    removed[name] = a[name];
  });
  result.maintained.forEach(function (_a) {
    var index = _a[0];
    var name = keys1[index];
    var values = [a[name], b[name]];

    if (a[name] !== b[name]) {
      changed[name] = values;
    }
  });
  return {
    added: added,
    removed: removed,
    changed: changed
  };
}

function executeHooks(hooks) {
  hooks.forEach(function (hook) {
    hook();
  });
}

function fillKeys(keys) {
  var index = 0;
  return keys.map(function (key) {
    return key == null ? "$compat" + ++index : "" + key;
  });
}

function createProvider(el, key, index, container) {
  if (isString(el) || isNumber(el)) {
    return new TextProvider("text_" + el, key, index, container, null, {});
  }

  var providerClass = typeof el.type === "string" ? ElementProvider : el.type.prototype.render ? ComponentProvider : FunctionProvider;
  return new providerClass(el.type, key, index, container, el.ref, el.props);
}

function flat(arr) {
  var arr2 = [];
  arr.forEach(function (el) {
    arr2 = arr2.concat(isArray(el) ? flat(el) : el);
  });
  return arr2;
}

function getAttributes(props) {
  var className = props.className,
      otherProps = __rest(props, ["className"]);

  if (className != null) {
    otherProps.class = className;
  }

  delete otherProps.style;
  delete otherProps.children;
  return otherProps;
}

function fillProps(props, defaultProps) {
  if (!defaultProps) {
    return props;
  }

  for (var name in defaultProps) {
    if (isUndefined(props[name])) {
      props[name] = defaultProps[name];
    }
  }

  return props;
}

function createElement(type, props) {
  var children = [];

  for (var _i = 2; _i < arguments.length; _i++) {
    children[_i - 2] = arguments[_i];
  }

  var _a = props || {},
      key = _a.key,
      ref = _a.ref,
      otherProps = __rest(_a, ["key", "ref"]);

  return {
    type: type,
    key: key,
    ref: ref,
    props: __assign(__assign({}, otherProps), {
      children: flat(children).filter(function (child) {
        return child != null && child !== false;
      })
    })
  };
}

var Provider =
/*#__PURE__*/
function () {
  function Provider(type, key, index, container, ref, props) {
    if (props === void 0) {
      props = {};
    }

    this.type = type;
    this.key = key;
    this.index = index;
    this.container = container;
    this.ref = ref;
    this.props = props;
    this._providers = [];
  }

  var __proto = Provider.prototype;

  __proto._should = function (nextProps, nextState) {
    return true;
  };

  __proto._update = function (hooks, nextElement, nextState, isForceUpdate) {
    if (this.base && !isString(nextElement) && !isForceUpdate && !this._should(nextElement.props, nextState)) {
      return false;
    }

    this.original = nextElement;

    this._setState(nextState); // render


    var prevProps = this.props;

    if (!isString(nextElement)) {
      this.props = nextElement.props;
      this.ref = nextElement.ref;
    }

    this._render(hooks, this.base ? prevProps : {}, nextState);

    return true;
  };

  __proto._mounted = function () {
    var ref = this.ref;
    ref && ref(this.base);
  };

  __proto._setState = function (nextstate) {
    return;
  };

  __proto._updated = function () {
    var ref = this.ref;
    ref && ref(this.base);
  };

  __proto._destroy = function () {
    var ref = this.ref;
    ref && ref(null);
  };

  return Provider;
}();

function diffAttributes(attrs1, attrs2, el) {
  var _a = diffObject(attrs1, attrs2),
      added = _a.added,
      removed = _a.removed,
      changed = _a.changed;

  for (var name in added) {
    el.setAttribute(name, added[name]);
  }

  for (var name in changed) {
    el.setAttribute(name, changed[name][1]);
  }

  for (var name in removed) {
    el.removeAttribute(name);
  }
}

function diffEvents(events1, events2, provier) {
  var _a = diffObject(events1, events2),
      added = _a.added,
      removed = _a.removed,
      changed = _a.changed;

  for (var name in removed) {
    provier.removeEventListener(name);
  }

  for (var name in added) {
    provier.addEventListener(name, added[name]);
  }

  for (var name in changed) {
    provier.removeEventListener(name);
    provier.addEventListener(name, changed[name][1]);
  }

  for (var name in removed) {
    provier.removeEventListener(name);
  }
}

function diffStyle(style1, style2, el) {
  var style = el.style;

  var _a = diffObject(style1, style2),
      added = _a.added,
      removed = _a.removed,
      changed = _a.changed;

  for (var beforeName in added) {
    var name = decamelize(beforeName, "-");

    if (style.setProperty) {
      style.setProperty(name, added[beforeName]);
    } else {
      style[name] = added[beforeName];
    }
  }

  for (var beforeName in changed) {
    var name = decamelize(beforeName, "-");

    if (style.setProperty) {
      style.setProperty(name, changed[beforeName][1]);
    } else {
      style[name] = changed[beforeName][1];
    }
  }

  for (var beforeName in removed) {
    var name = decamelize(beforeName, "-");

    if (style.removeProperty) {
      style.removeProperty(name);
    } else {
      style[name] = "";
    }
  }
}

function splitProps(props) {
  var attributes = {};
  var events = {};

  for (var name in props) {
    if (name.indexOf("on") === 0) {
      events[name.replace("on", "").toLowerCase()] = props[name];
    } else {
      attributes[name] = props[name];
    }
  }

  return {
    attributes: attributes,
    events: events
  };
}

var TextProvider =
/*#__PURE__*/
function (_super) {
  __extends(TextProvider, _super);

  function TextProvider() {
    return _super !== null && _super.apply(this, arguments) || this;
  }

  var __proto = TextProvider.prototype;

  __proto._render = function (hooks) {
    var _this = this;

    var isMount = !this.base;

    if (isMount) {
      this.base = document.createTextNode(this.type.replace("text_", ""));
    }

    hooks.push(function () {
      if (isMount) {
        _this._mounted();
      } else {
        _this._updated();
      }
    });
    return true;
  };

  __proto._unmount = function () {
    this.base.parentNode.removeChild(this.base);
  };

  return TextProvider;
}(Provider);

var ElementProvider =
/*#__PURE__*/
function (_super) {
  __extends(ElementProvider, _super);

  function ElementProvider() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.events = {};
    _this._isSVG = false;
    return _this;
  }

  var __proto = ElementProvider.prototype;

  __proto.addEventListener = function (name, callback) {
    var events = this.events;

    events[name] = function (e) {
      e.nativeEvent = e;
      callback(e);
    };

    this.base.addEventListener(name, events[name]);
  };

  __proto.removeEventListener = function (name) {
    var events = this.events;
    this.base.removeEventListener(name, events[name]);
    delete events[name];
  };

  __proto._should = function (nextProps) {
    return isDiff(this.props, nextProps);
  };

  __proto._render = function (hooks, prevProps) {
    var _this = this;

    var isMount = !this.base;

    if (isMount) {
      var isSVG = this._hasSVG();

      this._isSVG = isSVG;
      var element = this.props.portalContainer;

      if (!element) {
        var type = this.type;

        if (isSVG) {
          element = document.createElementNS("http://www.w3.org/2000/svg", type);
        } else {
          element = document.createElement(type);
        }
      }

      this.base = element;
    }

    renderProviders(this, this._providers, this.props.children, hooks, null);
    var base = this.base;

    var _a = splitProps(prevProps),
        prevAttributes = _a.attributes,
        prevEvents = _a.events;

    var _b = splitProps(this.props),
        nextAttributes = _b.attributes,
        nextEvents = _b.events;

    diffAttributes(getAttributes(prevAttributes), getAttributes(nextAttributes), base);
    diffEvents(prevEvents, nextEvents, this);
    diffStyle(prevProps.style || {}, this.props.style || {}, base);
    hooks.push(function () {
      if (isMount) {
        _this._mounted();
      } else {
        _this._updated();
      }
    });
    return true;
  };

  __proto._unmount = function () {
    var events = this.events;
    var base = this.base;

    for (var name in events) {
      base.removeEventListener(name, events[name]);
    }

    this._providers.forEach(function (provider) {
      provider._unmount();
    });

    this.events = {};

    if (!this.props.portalContainer) {
      base.parentNode.removeChild(base);
    }
  };

  __proto._hasSVG = function () {
    if (this._isSVG || this.type === "svg") {
      return true;
    }

    var containerNode = findContainerNode(this.container);
    return containerNode && "ownerSVGElement" in containerNode;
  };

  return ElementProvider;
}(Provider);

function findContainerNode(provider) {
  if (!provider) {
    return null;
  }

  var base = provider.base;

  if (base instanceof Node) {
    return base;
  }

  return findContainerNode(provider.container);
}

function findDOMNode(comp) {
  if (!comp) {
    return null;
  }

  if (comp instanceof Node) {
    return comp;
  }

  var providers = comp.$_provider._providers;

  if (!providers.length) {
    return null;
  }

  return findDOMNode(providers[0].base);
}

var FunctionProvider =
/*#__PURE__*/
function (_super) {
  __extends(FunctionProvider, _super);

  function FunctionProvider() {
    return _super !== null && _super.apply(this, arguments) || this;
  }

  var __proto = FunctionProvider.prototype;

  __proto._render = function (hooks) {
    var template = this.type(this.props);
    renderProviders(this, this._providers, template ? [template] : [], hooks);
    return true;
  };

  __proto._unmount = function () {
    this._providers.forEach(function (provider) {
      provider._unmount();
    });
  };

  return FunctionProvider;
}(Provider);

var ContainerProvider =
/*#__PURE__*/
function (_super) {
  __extends(ContainerProvider, _super);

  function ContainerProvider(base) {
    var _this = _super.call(this, "container", "container", 0, null) || this;

    _this.base = base;
    return _this;
  }

  var __proto = ContainerProvider.prototype;

  __proto._render = function () {
    return true;
  };

  __proto._unmount = function () {
    return;
  };

  return ContainerProvider;
}(Provider);

var ComponentProvider =
/*#__PURE__*/
function (_super) {
  __extends(ComponentProvider, _super);

  function ComponentProvider(type, key, index, container, ref, props) {
    if (props === void 0) {
      props = {};
    }

    return _super.call(this, type, key, index, container, ref, fillProps(props, type.defaultProps)) || this;
  }

  var __proto = ComponentProvider.prototype;

  __proto._should = function (nextProps, nextState) {
    return this.base.shouldComponentUpdate(fillProps(nextProps, this.type.defaultProps), nextState || this.base.state);
  };

  __proto._render = function (hooks, prevProps, nextState) {
    var _this = this;

    this.props = fillProps(this.props, this.type.defaultProps);
    var isMount = !this.base;

    if (isMount) {
      this.base = new this.type(this.props);
      this.base.$_provider = this;
    } else {
      this.base.props = this.props;
    }

    var base = this.base;
    var prevState = base.state;
    var template = base.render();

    if (template && template.props && !template.props.children.length) {
      template.props.children = this.props.children;
    }

    renderProviders(this, this._providers, template ? [template] : [], hooks, nextState, null);
    hooks.push(function () {
      if (isMount) {
        _this._mounted();

        base.componentDidMount();
      } else {
        _this._updated();

        base.componentDidUpdate(prevProps, prevState);
      }
    });
  };

  __proto._setState = function (nextState) {
    var base = this.base;

    if (!base || !nextState) {
      return;
    }

    base.state = nextState;
  };

  __proto._unmount = function () {
    this._providers.forEach(function (provider) {
      provider._unmount();
    });

    clearTimeout(this.base.$_timer);
    this.base.componentWillUnmount();
  };

  return ComponentProvider;
}(Provider);

var Component =
/*#__PURE__*/
function () {
  function Component(props) {
    if (props === void 0) {
      props = {};
    }

    this.props = props;
    this.state = {};
    this.$_timer = 0;
    this.$_state = {};
  }

  var __proto = Component.prototype;

  __proto.shouldComponentUpdate = function (props, state) {
    return true;
  };

  __proto.render = function () {
    return null;
  };

  __proto.setState = function (state, callback, isForceUpdate) {
    var _this = this;

    if (!this.$_timer) {
      this.$_state = {};
    }

    clearTimeout(this.$_timer);
    this.$_timer = 0;
    this.$_state = __assign(__assign({}, this.$_state), state);

    if (!isForceUpdate) {
      this.$_timer = setTimeout(function () {
        _this.$_timer = 0;

        _this.$_setState(callback, isForceUpdate);
      });
    } else {
      this.$_setState(callback, isForceUpdate);
    }

    return;
  };

  __proto.forceUpdate = function (callback) {
    this.setState({}, callback, true);
  };

  __proto.componentDidMount = function () {};

  __proto.componentDidUpdate = function (prevProps, prevState) {};

  __proto.componentWillUnmount = function () {};

  __proto.$_setState = function (callback, isForceUpdate) {
    var hooks = [];
    var provider = this.$_provider;
    var isUpdate = renderProviders(provider.container, [provider], [provider.original], hooks, __assign(__assign({}, this.state), this.$_state), isForceUpdate);

    if (isUpdate) {
      if (callback) {
        hooks.push(callback);
      }

      executeHooks(hooks);
    }
  };

  return Component;
}();

var PureComponent =
/*#__PURE__*/
function (_super) {
  __extends(PureComponent, _super);

  function PureComponent() {
    return _super !== null && _super.apply(this, arguments) || this;
  }

  var __proto = PureComponent.prototype;

  __proto.shouldComponentUpdate = function (props, state) {
    return isDiff(this.props, props) || isDiff(this.state, state);
  };

  return PureComponent;
}(Component);

var _Portal =
/*#__PURE__*/
function (_super) {
  __extends(_Portal, _super);

  function _Portal() {
    return _super !== null && _super.apply(this, arguments) || this;
  }

  var __proto = _Portal.prototype;

  __proto.componentDidMount = function () {
    var _a = this.props,
        element = _a.element,
        container = _a.container;
    this._portalProvider = new ContainerProvider(container);
    renderProvider(element, container, this._portalProvider);
  };

  __proto.componentDidUpdate = function () {
    var _a = this.props,
        element = _a.element,
        container = _a.container;
    renderProvider(element, container, this._portalProvider);
  };

  __proto.componentWillUnmount = function () {
    var container = this.props.container;
    renderProvider(null, container, this._portalProvider);
    this._portalProvider = null;
  };

  return _Portal;
}(PureComponent);

function updateProvider(provider, children, nextState) {
  var hooks = [];
  renderProviders(provider, provider._providers, children, hooks, nextState);
  executeHooks(hooks);
}

function getNextSibiling(provider, childProvider) {
  var childProviders = provider._providers;
  var length = childProviders.length;

  for (var i = childProvider.index + 1; i < length; ++i) {
    var el = findDOMNode(childProviders[i].base);

    if (el) {
      return el;
    }
  }

  return null;
}

function diffProviders(containerProvider, providers, children) {
  var childrenKeys = children.map(function (p) {
    return isString(p) ? null : p.key;
  });
  var keys1 = fillKeys(providers.map(function (p) {
    return p.key;
  }));
  var keys2 = fillKeys(childrenKeys);
  var result = diff(keys1, keys2, function (key) {
    return key;
  });
  result.removed.forEach(function (index) {
    providers.splice(index, 1)[0]._unmount();
  });
  result.ordered.forEach(function (_a) {
    var from = _a[0],
        to = _a[1];
    var childrenProvider = providers.splice(from, 1)[0];
    providers.splice(to, 0, childrenProvider);
    var el = findDOMNode(childrenProvider.base);
    var next = findDOMNode(providers[to + 1] && providers[to + 1].base);

    if (el) {
      el.parentNode.insertBefore(el, next);
    }
  });
  result.added.forEach(function (index) {
    providers.splice(index, 0, createProvider(children[index], childrenKeys[index], index, containerProvider));
  });
  var changed = result.maintained.filter(function (_a) {
    var _ = _a[0],
        to = _a[1];
    var el = children[to];
    var childProvider = providers[to];
    var type = isString(el) ? "text_" + el : el.type;

    if (type !== childProvider.type) {
      childProvider._unmount();

      providers.splice(to, 1, createProvider(el, childrenKeys[to], to, containerProvider));
      return true;
    }

    childProvider.index = to;
    return false;
  });
  return __spreadArrays(result.added, changed.map(function (_a) {
    var _ = _a[0],
        to = _a[1];
    return to;
  }));
}

function renderProviders(containerProvider, providers, children, updatedHooks, nextState, isForceUpdate) {
  var result = diffProviders(containerProvider, providers, children);
  var updated = providers.filter(function (childProvider, i) {
    return childProvider._update(updatedHooks, children[i], nextState, isForceUpdate);
  });
  var containerNode = findContainerNode(containerProvider);

  if (containerNode) {
    result.reverse().forEach(function (index) {
      var childProvider = providers[index];
      var el = findDOMNode(childProvider.base);

      if (!el) {
        return;
      }

      if (containerNode !== el && !el.parentNode) {
        var nextElement = getNextSibiling(containerProvider, childProvider);
        containerNode.insertBefore(el, nextElement);
      }
    });
  }

  return updated.length > 0;
}

function renderProvider(element, container, provider) {
  if (provider === void 0) {
    provider = container.__REACT_COMPAT__;
  }

  var isProvider = !!provider;

  if (!provider) {
    provider = new ContainerProvider(container);
  }

  updateProvider(provider, element ? [element] : []);

  if (!isProvider) {
    container.__REACT_COMPAT__ = provider;
  }

  return provider;
}

function render(element, container, callback) {
  var provider = container.__REACT_COMPAT__;

  if (element && !provider) {
    container.innerHTML = "";
  }

  renderProvider(element, container, provider);
  callback && callback();
}
function createPortal(el, container) {
  return createElement(_Portal, {
    element: el,
    container: container
  });
}
var compat_esm_version = "simple-1.1.0";


//# sourceMappingURL=compat.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@egjs/agent/dist/agent.esm.js
/*
Copyright (c) 2015 NAVER Corp.
name: @egjs/agent
license: MIT
author: NAVER Corp.
repository: git+https://github.com/naver/agent.git
version: 2.4.2
*/
function some(arr, callback) {
  var length = arr.length;

  for (var i = 0; i < length; ++i) {
    if (callback(arr[i], i)) {
      return true;
    }
  }

  return false;
}
function agent_esm_find(arr, callback) {
  var length = arr.length;

  for (var i = 0; i < length; ++i) {
    if (callback(arr[i], i)) {
      return arr[i];
    }
  }

  return null;
}
function getUserAgentString(agent) {
  var userAgent = agent;

  if (typeof userAgent === "undefined") {
    if (typeof navigator === "undefined" || !navigator) {
      return "";
    }

    userAgent = navigator.userAgent || "";
  }

  return userAgent.toLowerCase();
}
function execRegExp(pattern, text) {
  try {
    return new RegExp(pattern, "g").exec(text);
  } catch (e) {
    return null;
  }
}
function hasUserAgentData() {
  if (typeof navigator === "undefined" || !navigator || !navigator.userAgentData) {
    return false;
  }

  var userAgentData = navigator.userAgentData;
  var brands = userAgentData.brands || userAgentData.uaList;
  return !!(brands && brands.length);
}
function findVersion(versionTest, userAgent) {
  var result = execRegExp("(" + versionTest + ")((?:\\/|\\s|:)([0-9|\\.|_]+))", userAgent);
  return result ? result[3] : "";
}
function convertVersion(text) {
  return text.replace(/_/g, ".");
}
function findPreset(presets, userAgent) {
  var userPreset = null;
  var version = "-1";
  some(presets, function (preset) {
    var result = execRegExp("(" + preset.test + ")((?:\\/|\\s|:)([0-9|\\.|_]+))?", userAgent);

    if (!result || preset.brand) {
      return false;
    }

    userPreset = preset;
    version = result[3] || "-1";

    if (preset.versionAlias) {
      version = preset.versionAlias;
    } else if (preset.versionTest) {
      version = findVersion(preset.versionTest.toLowerCase(), userAgent) || version;
    }

    version = convertVersion(version);
    return true;
  });
  return {
    preset: userPreset,
    version: version
  };
}
function findPresetBrand(presets, brands) {
  var brandInfo = {
    brand: "",
    version: "-1"
  };
  some(presets, function (preset) {
    var result = findBrand(brands, preset);

    if (!result) {
      return false;
    }

    brandInfo.brand = preset.id;
    brandInfo.version = preset.versionAlias || result.version;
    return brandInfo.version !== "-1";
  });
  return brandInfo;
}
function findBrand(brands, preset) {
  return agent_esm_find(brands, function (_a) {
    var brand = _a.brand;
    return execRegExp("" + preset.test, brand.toLowerCase());
  });
}

var BROWSER_PRESETS = [{
  test: "phantomjs",
  id: "phantomjs"
}, {
  test: "whale",
  id: "whale"
}, {
  test: "edgios|edge|edg",
  id: "edge"
}, {
  test: "msie|trident|windows phone",
  id: "ie",
  versionTest: "iemobile|msie|rv"
}, {
  test: "miuibrowser",
  id: "miui browser"
}, {
  test: "samsungbrowser",
  id: "samsung internet"
}, {
  test: "samsung",
  id: "samsung internet",
  versionTest: "version"
}, {
  test: "chrome|crios",
  id: "chrome"
}, {
  test: "firefox|fxios",
  id: "firefox"
}, {
  test: "android",
  id: "android browser",
  versionTest: "version"
}, {
  test: "safari|iphone|ipad|ipod",
  id: "safari",
  versionTest: "version"
}]; // chromium's engine(blink) is based on applewebkit 537.36.

var CHROMIUM_PRESETS = [{
  test: "(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",
  id: "chrome",
  versionTest: "chrome"
}, {
  test: "chromium",
  id: "chrome"
}, {
  test: "whale",
  id: "chrome",
  versionAlias: "-1",
  brand: true
}];
var WEBKIT_PRESETS = [{
  test: "applewebkit",
  id: "webkit",
  versionTest: "applewebkit|safari"
}];
var WEBVIEW_PRESETS = [{
  test: "(?=(iphone|ipad))(?!(.*version))",
  id: "webview"
}, {
  test: "(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",
  id: "webview"
}, {
  // test webview
  test: "webview",
  id: "webview"
}];
var OS_PRESETS = [{
  test: "windows phone",
  id: "windows phone"
}, {
  test: "windows 2000",
  id: "window",
  versionAlias: "5.0"
}, {
  test: "windows nt",
  id: "window"
}, {
  test: "win32|windows",
  id: "window"
}, {
  test: "iphone|ipad|ipod",
  id: "ios",
  versionTest: "iphone os|cpu os"
}, {
  test: "macos|macintel|mac os x",
  id: "mac"
}, {
  test: "android|linux armv81",
  id: "android"
}, {
  test: "tizen",
  id: "tizen"
}, {
  test: "webos|web0s",
  id: "webos"
}];

function isWebView(userAgent) {
  return !!findPreset(WEBVIEW_PRESETS, userAgent).preset;
}
function getLegacyAgent(userAgent) {
  var nextAgent = getUserAgentString(userAgent);
  var isMobile = !!/mobi/g.exec(nextAgent);
  var browser = {
    name: "unknown",
    version: "-1",
    majorVersion: -1,
    webview: isWebView(nextAgent),
    chromium: false,
    chromiumVersion: "-1",
    webkit: false,
    webkitVersion: "-1"
  };
  var os = {
    name: "unknown",
    version: "-1",
    majorVersion: -1
  };

  var _a = findPreset(BROWSER_PRESETS, nextAgent),
      browserPreset = _a.preset,
      browserVersion = _a.version;

  var _b = findPreset(OS_PRESETS, nextAgent),
      osPreset = _b.preset,
      osVersion = _b.version;

  var chromiumPreset = findPreset(CHROMIUM_PRESETS, nextAgent);
  browser.chromium = !!chromiumPreset.preset;
  browser.chromiumVersion = chromiumPreset.version;

  if (!browser.chromium) {
    var webkitPreset = findPreset(WEBKIT_PRESETS, nextAgent);
    browser.webkit = !!webkitPreset.preset;
    browser.webkitVersion = webkitPreset.version;
  }

  if (osPreset) {
    os.name = osPreset.id;
    os.version = osVersion;
    os.majorVersion = parseInt(osVersion, 10);
  }

  if (browserPreset) {
    browser.name = browserPreset.id;
    browser.version = browserVersion; // Early whale bugs

    if (browser.webview && os.name === "ios" && browser.name !== "safari") {
      browser.webview = false;
    }
  }

  browser.majorVersion = parseInt(browser.version, 10);
  return {
    browser: browser,
    os: os,
    isMobile: isMobile,
    isHints: false
  };
}

function getClientHintsAgent(osData) {
  var userAgentData = navigator.userAgentData;
  var brands = (userAgentData.uaList || userAgentData.brands).slice();
  var fullVersionList = osData && osData.fullVersionList;
  var isMobile = userAgentData.mobile || false;
  var firstBrand = brands[0];
  var platform = (osData && osData.platform || userAgentData.platform || navigator.platform).toLowerCase();
  var browser = {
    name: firstBrand.brand,
    version: firstBrand.version,
    majorVersion: -1,
    webkit: false,
    webkitVersion: "-1",
    chromium: false,
    chromiumVersion: "-1",
    webview: !!findPresetBrand(WEBVIEW_PRESETS, brands).brand || isWebView(getUserAgentString())
  };
  var os = {
    name: "unknown",
    version: "-1",
    majorVersion: -1
  };
  browser.webkit = !browser.chromium && some(WEBKIT_PRESETS, function (preset) {
    return findBrand(brands, preset);
  });
  var chromiumBrand = findPresetBrand(CHROMIUM_PRESETS, brands);
  browser.chromium = !!chromiumBrand.brand;
  browser.chromiumVersion = chromiumBrand.version;

  if (!browser.chromium) {
    var webkitBrand = findPresetBrand(WEBKIT_PRESETS, brands);
    browser.webkit = !!webkitBrand.brand;
    browser.webkitVersion = webkitBrand.version;
  }

  var platfomResult = agent_esm_find(OS_PRESETS, function (preset) {
    return new RegExp("" + preset.test, "g").exec(platform);
  });
  os.name = platfomResult ? platfomResult.id : "";

  if (osData) {
    os.version = osData.platformVersion;
  }

  if (fullVersionList && fullVersionList.length) {
    var browserBrandByFullVersionList = findPresetBrand(BROWSER_PRESETS, fullVersionList);
    browser.name = browserBrandByFullVersionList.brand || browser.name;
    browser.version = browserBrandByFullVersionList.version || browser.version;
  } else {
    var browserBrand = findPresetBrand(BROWSER_PRESETS, brands);
    browser.name = browserBrand.brand || browser.name;
    browser.version = browserBrand.brand && osData ? osData.uaFullVersion : browserBrand.version;
  }

  if (browser.webkit) {
    os.name = isMobile ? "ios" : "mac";
  }

  if (os.name === "ios" && browser.webview) {
    browser.version = "-1";
  }

  os.version = convertVersion(os.version);
  browser.version = convertVersion(browser.version);
  os.majorVersion = parseInt(os.version, 10);
  browser.majorVersion = parseInt(browser.version, 10);
  return {
    browser: browser,
    os: os,
    isMobile: isMobile,
    isHints: true
  };
}

/**
 * @namespace eg.agent
 */

/**
* Extracts accuate browser and operating system information from the user agent string or client hints.
* @ko 유저 에이전트 문자열 또는 client hints에서 정확한 브라우저와 운영체제 정보를 추출한다.
* @function eg.agent#getAccurateAgent
* @param - Callback function to get the accuate agent <ko>정확한 에이전트를 가져오기 위한 callback 함수</ko>
* @return - get the accuate agent promise. If Promise are not supported, null is returned. <ko> 정확한 에이전트 promise를 가져온다. Promise를 지원 하지 않는 경우, null을 반환한다. </ko>
* @example
import { getAccurateAgent } from "@egjs/agent";
// eg.agent.getAccurateAgent()
getAccurateAgent().then(agent => {
   const { os, browser, isMobile } = agent;
});
getAccurateAgent(agent => {
    const { os, browser, isMobile } = agent;
});
*/

function getAccurateAgent(callback) {
  if (hasUserAgentData()) {
    return navigator.userAgentData.getHighEntropyValues(["architecture", "model", "platform", "platformVersion", "uaFullVersion", "fullVersionList"]).then(function (info) {
      var agentInfo = getClientHintsAgent(info);
      callback && callback(agentInfo);
      return agentInfo;
    });
  }

  callback && callback(agent());

  if (typeof Promise === "undefined" || !Promise) {
    return null;
  }

  return Promise.resolve(agent());
}
/**
 * Extracts browser and operating system information from the user agent string.
 * @ko 유저 에이전트 문자열에서 브라우저와 운영체제 정보를 추출한다.
 * @function eg.agent#agent
 * @param - user agent string to parse <ko>파싱할 유저에이전트 문자열</ko>
 * @return - agent Info <ko> 에이전트 정보 </ko>
 * @example
import agent from "@egjs/agent";
// eg.agent();
const { os, browser, isMobile } = agent();
 */

function agent(userAgent) {
  if (typeof userAgent === "undefined" && hasUserAgentData()) {
    return getClientHintsAgent();
  } else {
    return getLegacyAgent(userAgent);
  }
}

/* harmony default export */ const agent_esm = (agent);

//# sourceMappingURL=agent.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@scena/matrix/dist/matrix.esm.js
/*
Copyright (c) 2020 Daybrush
name: @scena/matrix
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/matrix
version: 1.1.1
*/


function add(matrix, inverseMatrix, startIndex, fromIndex, n, k) {
  for (var i = 0; i < n; ++i) {
    var x = startIndex + i * n;
    var fromX = fromIndex + i * n;
    matrix[x] += matrix[fromX] * k;
    inverseMatrix[x] += inverseMatrix[fromX] * k;
  }
}

function swap(matrix, inverseMatrix, startIndex, fromIndex, n) {
  for (var i = 0; i < n; ++i) {
    var x = startIndex + i * n;
    var fromX = fromIndex + i * n;
    var v = matrix[x];
    var iv = inverseMatrix[x];
    matrix[x] = matrix[fromX];
    matrix[fromX] = v;
    inverseMatrix[x] = inverseMatrix[fromX];
    inverseMatrix[fromX] = iv;
  }
}

function divide(matrix, inverseMatrix, startIndex, n, k) {
  for (var i = 0; i < n; ++i) {
    var x = startIndex + i * n;
    matrix[x] /= k;
    inverseMatrix[x] /= k;
  }
}
/**
 *
 * @namespace Matrix
 */

/**
 * @memberof Matrix
 */


function ignoreDimension(matrix, m, n) {
  if (n === void 0) {
    n = Math.sqrt(matrix.length);
  }

  var newMatrix = matrix.slice();

  for (var i = 0; i < n; ++i) {
    newMatrix[i * n + m - 1] = 0;
    newMatrix[(m - 1) * n + i] = 0;
  }

  newMatrix[(m - 1) * (n + 1)] = 1;
  return newMatrix;
}
/**
 * @memberof Matrix
 */

function matrix_esm_invert(matrix, n) {
  if (n === void 0) {
    n = Math.sqrt(matrix.length);
  }

  var newMatrix = matrix.slice();
  var inverseMatrix = createIdentityMatrix(n);

  for (var i = 0; i < n; ++i) {
    // diagonal
    var identityIndex = n * i + i;

    if (!utils_esm_throttle(newMatrix[identityIndex], TINY_NUM)) {
      // newMatrix[identityIndex] = 0;
      for (var j = i + 1; j < n; ++j) {
        if (newMatrix[n * i + j]) {
          swap(newMatrix, inverseMatrix, i, j, n);
          break;
        }
      }
    }

    if (!utils_esm_throttle(newMatrix[identityIndex], TINY_NUM)) {
      // no inverse matrix
      return [];
    }

    divide(newMatrix, inverseMatrix, i, n, newMatrix[identityIndex]);

    for (var j = 0; j < n; ++j) {
      var targetStartIndex = j;
      var targetIndex = j + i * n;
      var target = newMatrix[targetIndex];

      if (!utils_esm_throttle(target, TINY_NUM) || i === j) {
        continue;
      }

      add(newMatrix, inverseMatrix, targetStartIndex, i, n, -target);
    }
  }

  return inverseMatrix;
}
/**
 * @memberof Matrix
 */

function transpose(matrix, n) {
  if (n === void 0) {
    n = Math.sqrt(matrix.length);
  }

  var newMatrix = [];

  for (var i = 0; i < n; ++i) {
    for (var j = 0; j < n; ++j) {
      newMatrix[j * n + i] = matrix[n * i + j];
    }
  }

  return newMatrix;
}
/**
 * @memberof Matrix
 */

function getOrigin(matrix, n) {
  if (n === void 0) {
    n = Math.sqrt(matrix.length);
  }

  var originMatrix = [];
  var w = matrix[n * n - 1];

  for (var i = 0; i < n - 1; ++i) {
    originMatrix[i] = matrix[n * (n - 1) + i] / w;
  }

  originMatrix[n - 1] = 0;
  return originMatrix;
}
/**
 * @memberof Matrix
 */

function fromTranslation(pos, n) {
  var newMatrix = createIdentityMatrix(n);

  for (var i = 0; i < n - 1; ++i) {
    newMatrix[n * (n - 1) + i] = pos[i] || 0;
  }

  return newMatrix;
}
/**
 * @memberof Matrix
 */

function convertPositionMatrix(matrix, n) {
  var newMatrix = matrix.slice();

  for (var i = matrix.length; i < n - 1; ++i) {
    newMatrix[i] = 0;
  }

  newMatrix[n - 1] = 1;
  return newMatrix;
}
/**
 * @memberof Matrix
 */

function convertDimension(matrix, n, m) {
  if (n === void 0) {
    n = Math.sqrt(matrix.length);
  } // n < m


  if (n === m) {
    return matrix;
  }

  var newMatrix = createIdentityMatrix(m);
  var length = Math.min(n, m);

  for (var i = 0; i < length - 1; ++i) {
    for (var j = 0; j < length - 1; ++j) {
      newMatrix[i * m + j] = matrix[i * n + j];
    }

    newMatrix[(i + 1) * m - 1] = matrix[(i + 1) * n - 1];
    newMatrix[(m - 1) * m + i] = matrix[(n - 1) * n + i];
  }

  newMatrix[m * m - 1] = matrix[n * n - 1];
  return newMatrix;
}
/**
 * @memberof Matrix
 */

function multiplies(n) {
  var matrixes = [];

  for (var _i = 1; _i < arguments.length; _i++) {
    matrixes[_i - 1] = arguments[_i];
  }

  var m = createIdentityMatrix(n);
  matrixes.forEach(function (matrix) {
    m = multiply(m, matrix, n);
  });
  return m;
}
/**
 * @memberof Matrix
 */

function multiply(matrix, matrix2, n) {
  if (n === void 0) {
    n = Math.sqrt(matrix.length);
  }

  var newMatrix = []; // 1 y: n
  // 1 x: m
  // 2 x: m
  // 2 y: k
  // n * m X m * k

  var m = matrix.length / n;
  var k = matrix2.length / m;

  if (!m) {
    return matrix2;
  } else if (!k) {
    return matrix;
  }

  for (var i = 0; i < n; ++i) {
    for (var j = 0; j < k; ++j) {
      newMatrix[j * n + i] = 0;

      for (var l = 0; l < m; ++l) {
        // m1 x: m(l), y: n(i)
        // m2 x: k(j):  y: m(l)
        // nw x: n(i), y: k(j)
        newMatrix[j * n + i] += matrix[l * n + i] * matrix2[j * m + l];
      }
    }
  } // n * k


  return newMatrix;
}
/**
 * @memberof Matrix
 */

function plus(pos1, pos2) {
  var length = Math.min(pos1.length, pos2.length);
  var nextPos = pos1.slice();

  for (var i = 0; i < length; ++i) {
    nextPos[i] = nextPos[i] + pos2[i];
  }

  return nextPos;
}
/**
 * @memberof Matrix
 */

function minus(pos1, pos2) {
  var length = Math.min(pos1.length, pos2.length);
  var nextPos = pos1.slice();

  for (var i = 0; i < length; ++i) {
    nextPos[i] = nextPos[i] - pos2[i];
  }

  return nextPos;
}
/**
 * @memberof Matrix
 */

function convertCSStoMatrix(a, is2d) {
  if (is2d === void 0) {
    is2d = a.length === 6;
  }

  if (is2d) {
    return [a[0], a[1], 0, a[2], a[3], 0, a[4], a[5], 1];
  }

  return a;
}
/**
 * @memberof Matrix
 */

function convertMatrixtoCSS(a, is2d) {
  if (is2d === void 0) {
    is2d = a.length === 9;
  }

  if (is2d) {
    return [a[0], a[1], a[3], a[4], a[6], a[7]];
  }

  return a;
}
/**
 * @memberof Matrix
 */

function calculate(matrix, matrix2, n) {
  if (n === void 0) {
    n = matrix2.length;
  }

  var result = multiply(matrix, matrix2, n);
  var k = result[n - 1];
  return result.map(function (v) {
    return v / k;
  });
}
/**
 * @memberof Matrix
 */

function rotateX3d(matrix, rad) {
  return multiply(matrix, [1, 0, 0, 0, 0, Math.cos(rad), Math.sin(rad), 0, 0, -Math.sin(rad), Math.cos(rad), 0, 0, 0, 0, 1], 4);
}
/**
 * @memberof Matrix
 */

function rotateY3d(matrix, rad) {
  return multiply(matrix, [Math.cos(rad), 0, -Math.sin(rad), 0, 0, 1, 0, 0, Math.sin(rad), 0, Math.cos(rad), 0, 0, 0, 0, 1], 4);
}
/**
 * @memberof Matrix
 */

function rotateZ3d(matrix, rad) {
  return multiply(matrix, createRotateMatrix(rad, 4));
}
/**
 * @memberof Matrix
 */

function scale3d(matrix, _a) {
  var _b = _a[0],
      sx = _b === void 0 ? 1 : _b,
      _c = _a[1],
      sy = _c === void 0 ? 1 : _c,
      _d = _a[2],
      sz = _d === void 0 ? 1 : _d;
  return multiply(matrix, [sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1], 4);
}
/**
 * @memberof Matrix
 */

function rotate(pos, rad) {
  return calculate(createRotateMatrix(rad, 3), convertPositionMatrix(pos, 3));
}
/**
 * @memberof Matrix
 */

function translate3d(matrix, _a) {
  var _b = _a[0],
      tx = _b === void 0 ? 0 : _b,
      _c = _a[1],
      ty = _c === void 0 ? 0 : _c,
      _d = _a[2],
      tz = _d === void 0 ? 0 : _d;
  return multiply(matrix, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tx, ty, tz, 1], 4);
}
/**
 * @memberof Matrix
 */

function matrix_esm_matrix3d(matrix1, matrix2) {
  return multiply(matrix1, matrix2, 4);
}
/**
 * @memberof Matrix
 */

function createRotateMatrix(rad, n) {
  var cos = Math.cos(rad);
  var sin = Math.sin(rad);
  var m = createIdentityMatrix(n); // cos -sin
  // sin cos

  m[0] = cos;
  m[1] = sin;
  m[n] = -sin;
  m[n + 1] = cos;
  return m;
}
/**
 * @memberof Matrix
 */

function createIdentityMatrix(n) {
  var length = n * n;
  var matrix = [];

  for (var i = 0; i < length; ++i) {
    matrix[i] = i % (n + 1) ? 0 : 1;
  }

  return matrix;
}
/**
 * @memberof Matrix
 */

function createScaleMatrix(scale, n) {
  var m = createIdentityMatrix(n);
  var length = Math.min(scale.length, n - 1);

  for (var i = 0; i < length; ++i) {
    m[(n + 1) * i] = scale[i];
  }

  return m;
}
/**
 * @memberof Matrix
 */

function createOriginMatrix(origin, n) {
  var m = createIdentityMatrix(n);
  var length = Math.min(origin.length, n - 1);

  for (var i = 0; i < length; ++i) {
    m[n * (n - 1) + i] = origin[i];
  }

  return m;
}
/**
 * @memberof Matrix
 */

function createWarpMatrix(pos0, pos1, pos2, pos3, nextPos0, nextPos1, nextPos2, nextPos3) {
  var x0 = pos0[0],
      y0 = pos0[1];
  var x1 = pos1[0],
      y1 = pos1[1];
  var x2 = pos2[0],
      y2 = pos2[1];
  var x3 = pos3[0],
      y3 = pos3[1];
  var u0 = nextPos0[0],
      v0 = nextPos0[1];
  var u1 = nextPos1[0],
      v1 = nextPos1[1];
  var u2 = nextPos2[0],
      v2 = nextPos2[1];
  var u3 = nextPos3[0],
      v3 = nextPos3[1];
  var matrix = [x0, 0, x1, 0, x2, 0, x3, 0, y0, 0, y1, 0, y2, 0, y3, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, x0, 0, x1, 0, x2, 0, x3, 0, y0, 0, y1, 0, y2, 0, y3, 0, 1, 0, 1, 0, 1, 0, 1, -u0 * x0, -v0 * x0, -u1 * x1, -v1 * x1, -u2 * x2, -v2 * x2, -u3 * x3, -v3 * x3, -u0 * y0, -v0 * y0, -u1 * y1, -v1 * y1, -u2 * y2, -v2 * y2, -u3 * y3, -v3 * y3];
  var inverseMatrix = matrix_esm_invert(matrix, 8);

  if (!inverseMatrix.length) {
    return [];
  }

  var h = multiply(inverseMatrix, [u0, v0, u1, v1, u2, v2, u3, v3], 8);
  h[8] = 1;
  return convertDimension(transpose(h), 3, 4);
}
/**
 * @memberof Matrix
 */

function getCenter(points) {
  return [0, 1].map(function (i) {
    return average(points.map(function (pos) {
      return pos[i];
    }));
  });
}


//# sourceMappingURL=matrix.esm.js.map

;// CONCATENATED MODULE: ./node_modules/css-to-mat/dist/css-to-mat.esm.js
/*
Copyright (c) 2019 Daybrush
name: css-to-mat
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/css-to-mat.git
version: 1.0.3
*/



function createMatrix() {
  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
}
function parseMat(transform) {
  return toMat(parse(transform));
}
function getElementMatrix(el) {
  return parseMat(getComputedStyle(el).transform);
}
function calculateMatrixDist(matrix, pos) {
  var res = calculate(matrix, [pos[0], pos[1] || 0, pos[2] || 0, 1], 4);
  var w = res[3] || 1;
  return [res[0] / w, res[1] / w, res[2] / w];
}
function getDistElementMatrix(el, container) {
  if (container === void 0) {
    container = document.body;
  }

  var target = el;
  var matrix = createMatrix();

  while (target) {
    var transform = getComputedStyle(target).transform;
    matrix = matrix3d(parseMat(transform), matrix);

    if (target === container) {
      break;
    }

    target = target.parentElement;
  }

  matrix = invert(matrix, 4);
  matrix[12] = 0;
  matrix[13] = 0;
  matrix[14] = 0;
  return matrix;
}
function toMat(matrixInfos) {
  var target = createMatrix();
  matrixInfos.forEach(function (info) {
    var matrixFunction = info.matrixFunction,
        functionValue = info.functionValue;

    if (!matrixFunction) {
      return;
    }

    target = matrixFunction(target, functionValue);
  });
  return target;
}
function parse(transform) {
  var transforms = isArray(transform) ? transform : splitSpace(transform);
  return transforms.map(function (t) {
    var _a = splitBracket(t),
        name = _a.prefix,
        value = _a.value;

    var matrixFunction = null;
    var functionName = name;
    var functionValue = "";

    if (name === "translate" || name === "translateX" || name === "translate3d") {
      var _b = splitComma(value).map(function (v) {
        return parseFloat(v);
      }),
          posX = _b[0],
          _c = _b[1],
          posY = _c === void 0 ? 0 : _c,
          _d = _b[2],
          posZ = _d === void 0 ? 0 : _d;

      matrixFunction = translate3d;
      functionValue = [posX, posY, posZ];
    } else if (name === "translateY") {
      var posY = parseFloat(value);
      matrixFunction = translate3d;
      functionValue = [0, posY, 0];
    } else if (name === "translateZ") {
      var posZ = parseFloat(value);
      matrixFunction = translate3d;
      functionValue = [0, 0, posZ];
    } else if (name === "scale" || name === "scale3d") {
      var _e = splitComma(value).map(function (v) {
        return parseFloat(v);
      }),
          sx = _e[0],
          _f = _e[1],
          sy = _f === void 0 ? sx : _f,
          _g = _e[2],
          sz = _g === void 0 ? 1 : _g;

      matrixFunction = scale3d;
      functionValue = [sx, sy, sz];
    } else if (name === "scaleX") {
      var sx = parseFloat(value);
      matrixFunction = scale3d;
      functionValue = [sx, 1, 1];
    } else if (name === "scaleY") {
      var sy = parseFloat(value);
      matrixFunction = scale3d;
      functionValue = [1, sy, 1];
    } else if (name === "scaleZ") {
      var sz = parseFloat(value);
      matrixFunction = scale3d;
      functionValue = [1, 1, sz];
    } else if (name === "rotate" || name === "rotateZ" || name === "rotateX" || name === "rotateY") {
      var _h = splitUnit(value),
          unit = _h.unit,
          unitValue = _h.value;

      var rad = unit === "rad" ? unitValue : unitValue * Math.PI / 180;

      if (name === "rotate" || name === "rotateZ") {
        functionName = "rotateZ";
        matrixFunction = rotateZ3d;
      } else if (name === "rotateX") {
        matrixFunction = rotateX3d;
      } else if (name === "rotateY") {
        matrixFunction = rotateY3d;
      }

      functionValue = rad;
    } else if (name === "matrix3d") {
      matrixFunction = matrix_esm_matrix3d;
      functionValue = splitComma(value).map(function (v) {
        return parseFloat(v);
      });
    } else if (name === "matrix") {
      var m = splitComma(value).map(function (v) {
        return parseFloat(v);
      });
      matrixFunction = matrix_esm_matrix3d;
      functionValue = [m[0], m[1], 0, 0, m[2], m[3], 0, 0, 0, 0, 1, 0, m[4], m[5], 0, 1];
    } else {
      functionName = "";
    }

    return {
      name: name,
      functionName: functionName,
      value: value,
      matrixFunction: matrixFunction,
      functionValue: functionValue
    };
  });
}


//# sourceMappingURL=css-to-mat.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@egjs/children-differ/dist/children-differ.esm.js
/*
Copyright (c) 2019-present NAVER Corp.
name: @egjs/children-differ
license: MIT
author: NAVER Corp.
repository: https://github.com/naver/egjs-children-differ
version: 1.0.1
*/


/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

/* global Reflect, Promise */
var children_differ_esm_extendStatics = function (d, b) {
  children_differ_esm_extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (d, b) {
    d.__proto__ = b;
  } || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
  };

  return children_differ_esm_extendStatics(d, b);
};

function children_differ_esm_extends(d, b) {
  children_differ_esm_extendStatics(d, b);

  function __() {
    this.constructor = d;
  }

  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

/*
egjs-children-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/
var findKeyCallback = typeof Map === "function" ? undefined : function () {
  var childrenCount = 0;
  return function (el) {
    return el.__DIFF_KEY__ || (el.__DIFF_KEY__ = ++childrenCount);
  };
}();

/**
 * A module that checks diff when child are added, removed, or changed .
 * @ko 자식 노드들에서 자식 노드가 추가되거나 삭제되거나 순서가 변경된 사항을 체크하는 모듈입니다.
 * @memberof eg
 * @extends eg.ListDiffer
 */

var ChildrenDiffer =
/*#__PURE__*/
function (_super) {
  children_differ_esm_extends(ChildrenDiffer, _super);
  /**
   * @param - Initializing Children <ko> 초기 설정할 자식 노드들</ko>
   */


  function ChildrenDiffer(list) {
    if (list === void 0) {
      list = [];
    }

    return _super.call(this, list, findKeyCallback) || this;
  }

  return ChildrenDiffer;
}(list_differ_esm);

/*
egjs-children-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/
/**
 *
 * @memberof eg.ChildrenDiffer
 * @static
 * @function
 * @param - Previous List <ko> 이전 목록 </ko>
 * @param - List to Update <ko> 업데이트 할 목록 </ko>
 * @return - Returns the diff between `prevList` and `list` <ko> `prevList`와 `list`의 다른 점을 반환한다.</ko>
 * @example
 * import { diff } from "@egjs/children-differ";
 * // script => eg.ChildrenDiffer.diff
 * const result = diff([0, 1, 2, 3, 4, 5], [7, 8, 0, 4, 3, 6, 2, 1]);
 * // List before update
 * // [1, 2, 3, 4, 5]
 * console.log(result.prevList);
 * // Updated list
 * // [4, 3, 6, 2, 1]
 * console.log(result.list);
 * // Index array of values added to `list`
 * // [0, 1, 5]
 * console.log(result.added);
 * // Index array of values removed in `prevList`
 * // [5]
 * console.log(result.removed);
 * // An array of index pairs of `prevList` and `list` with different indexes from `prevList` and `list`
 * // [[0, 2], [4, 3], [3, 4], [2, 6], [1, 7]]
 * console.log(result.changed);
 * // The subset of `changed` and an array of index pairs that moved data directly. Indicate an array of absolute index pairs of `ordered`.(Formatted by: Array<[index of prevList, index of list]>)
 * // [[4, 3], [3, 4], [2, 6]]
 * console.log(result.pureChanged);
 * // An array of index pairs to be `ordered` that can synchronize `list` before adding data. (Formatted by: Array<[prevIndex, nextIndex]>)
 * // [[4, 1], [4, 2], [4, 3]]
 * console.log(result.ordered);
 * // An array of index pairs of `prevList` and `list` that have not been added/removed so data is preserved
 * // [[0, 2], [4, 3], [3, 4], [2, 6], [1, 7]]
 * console.log(result.maintained);
 */

function children_differ_esm_diff(prevList, list) {
  return diff(prevList, list, findKeyCallback);
}

/*
egjs-children-differ
Copyright (c) 2019-present NAVER Corp.
MIT license
*/

/* harmony default export */ const children_differ_esm = (ChildrenDiffer);

//# sourceMappingURL=children-differ.esm.js.map

;// CONCATENATED MODULE: ./node_modules/overlap-area/dist/overlap-area.esm.js
/*
Copyright (c) 2020 Daybrush
name: overlap-area
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/overlap-area.git
version: 1.1.0
*/


/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function overlap_area_esm_spreadArrays() {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;

  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];

  return r;
}

function tinyThrottle(num) {
  return utils_esm_throttle(num, TINY_NUM);
}
function isSameConstants(linearConstants1, linearConstants2) {
  return linearConstants1.every(function (v, i) {
    return tinyThrottle(v - linearConstants2[i]) === 0;
  });
}
function isSamePoint(point1, point2) {
  return !tinyThrottle(point1[0] - point2[0]) && !tinyThrottle(point1[1] - point2[1]);
}
function overlap_area_esm_flat(arr) {
  return arr.reduce(function (prev, current) {
    prev.push.apply(prev, current);
    return prev;
  }, []);
}

/**
 * @namespace OverlapArea
 */

/**
 * Gets the size of a shape (polygon) made of points.
 * @memberof OverlapArea
 */

function getAreaSize(points) {
  if (points.length < 3) {
    return 0;
  }

  return Math.abs(sum(points.map(function (point, i) {
    var nextPoint = points[i + 1] || points[0];
    return point[0] * nextPoint[1] - nextPoint[0] * point[1];
  }))) / 2;
}
/**
 * Get points that fit the rect,
 * @memberof OverlapArea
 */

function fitPoints(points, rect) {
  var width = rect.width,
      height = rect.height,
      left = rect.left,
      top = rect.top;

  var _a = getMinMaxs(points),
      minX = _a.minX,
      minY = _a.minY,
      maxX = _a.maxX,
      maxY = _a.maxY;

  var ratioX = width / (maxX - minX);
  var ratioY = height / (maxY - minY);
  return points.map(function (point) {
    return [left + (point[0] - minX) * ratioX, top + (point[1] - minY) * ratioY];
  });
}
/**
 * Get the minimum and maximum points of the points.
 * @memberof OverlapArea
 */

function getMinMaxs(points) {
  var xs = points.map(function (point) {
    return point[0];
  });
  var ys = points.map(function (point) {
    return point[1];
  });
  return {
    minX: Math.min.apply(Math, xs),
    minY: Math.min.apply(Math, ys),
    maxX: Math.max.apply(Math, xs),
    maxY: Math.max.apply(Math, ys)
  };
}
/**
 * Whether the point is in shape
 * @param - point pos
 * @param - shape points
 * @param - whether to check except line
 * @memberof OverlapArea
 */

function isInside(pos, points, excludeLine) {
  var x = pos[0],
      y = pos[1];

  var _a = getMinMaxs(points),
      minX = _a.minX,
      maxX = _a.maxX;

  var xLine = [[minX, y], [maxX, y]];
  var xLinearConstants = getLinearConstants(xLine[0], xLine[1]);
  var lines = convertLines(points);
  var intersectionPosInfos = [];
  lines.forEach(function (line) {
    var linearConstants = getLinearConstants(line[0], line[1]);
    var standardPoint = line[0];

    if (isSameConstants(xLinearConstants, linearConstants)) {
      intersectionPosInfos.push({
        pos: pos,
        line: line,
        type: "line"
      });
    } else {
      var xPoints = getPointsOnLines(getIntersectionPointsByConstants(xLinearConstants, linearConstants), [xLine, line]);
      xPoints.forEach(function (point) {
        if (line.some(function (linePoint) {
          return isSamePoint(linePoint, point);
        })) {
          intersectionPosInfos.push({
            pos: point,
            line: line,
            type: "point"
          });
        } else if (tinyThrottle(standardPoint[1] - y) !== 0) {
          intersectionPosInfos.push({
            pos: point,
            line: line,
            type: "intersection"
          });
        }
      });
    }
  });

  if (!excludeLine) {
    // on line
    if (utils_esm_find(intersectionPosInfos, function (p) {
      return p[0] === x;
    })) {
      return true;
    }
  }

  var intersectionCount = 0;
  var xMap = {};
  intersectionPosInfos.forEach(function (_a) {
    var pos = _a.pos,
        type = _a.type,
        line = _a.line;

    if (pos[0] > x) {
      return;
    }

    if (type === "intersection") {
      ++intersectionCount;
    } else if (type === "line") {
      return;
    } else if (type === "point") {
      var point = utils_esm_find(line, function (linePoint) {
        return linePoint[1] !== y;
      });
      var prevValue = xMap[pos[0]];
      var nextValue = point[1] > y ? 1 : -1;

      if (!prevValue) {
        xMap[pos[0]] = nextValue;
      } else if (prevValue !== nextValue) {
        ++intersectionCount;
      }
    }
  });
  return intersectionCount % 2 === 1;
}
/**
 * Get distance from point to constants. [a, b, c] (ax + by + c = 0)
 * @return [a, b, c]
 * @memberof OverlapArea
 */

function getDistanceFromPointToConstants(_a, pos) {
  var a = _a[0],
      b = _a[1],
      c = _a[2];
  return (a * pos[0] + b * pos[1] + c) / (a * a + b * b);
}
/**
 * Get the coefficient of the linear function. [a, b, c] (ax + by + c = 0)
 * @return [a, b, c]
 * @memberof OverlapArea
 */

function getLinearConstants(point1, point2) {
  var x1 = point1[0],
      y1 = point1[1];
  var x2 = point2[0],
      y2 = point2[1]; // ax + by + c = 0
  // [a, b, c]

  var dx = x2 - x1;
  var dy = y2 - y1;

  if (Math.abs(dx) < TINY_NUM) {
    dx = 0;
  }

  if (Math.abs(dy) < TINY_NUM) {
    dy = 0;
  } // b > 0
  // ax + by + c = 0


  var a = 0;
  var b = 0;
  var c = 0;

  if (!dx) {
    if (dy) {
      // -x + 1 = 0
      a = -1;
      c = x1;
    }
  } else if (!dy) {
    // y - 1 = 0
    b = 1;
    c = -y1;
  } else {
    // y = -a(x - x1) + y1
    // ax + y + a * x1 - y1 = 0
    a = -dy / dx;
    b = 1;
    c = -a * x1 - y1;
  }

  return [a, b, c];
}
/**
 * Get intersection points with linear functions.
 * @memberof OverlapArea
 */

function getIntersectionPointsByConstants(linearConstants1, linearConstants2) {
  var a1 = linearConstants1[0],
      b1 = linearConstants1[1],
      c1 = linearConstants1[2];
  var a2 = linearConstants2[0],
      b2 = linearConstants2[1],
      c2 = linearConstants2[2];
  var isZeroA = a1 === 0 && a2 === 0;
  var isZeroB = b1 === 0 && b2 === 0;
  var results = [];

  if (isZeroA && isZeroB) {
    return [];
  } else if (isZeroA) {
    // b1 * y + c1 = 0
    // b2 * y + c2 = 0
    var y1 = -c1 / b1;
    var y2 = -c2 / b2;

    if (y1 !== y2) {
      return [];
    } else {
      return [[-Infinity, y1], [Infinity, y1]];
    }
  } else if (isZeroB) {
    // a1 * x + c1 = 0
    // a2 * x + c2 = 0
    var x1 = -c1 / a1;
    var x2 = -c2 / a2;

    if (x1 !== x2) {
      return [];
    } else {
      return [[x1, -Infinity], [x1, Infinity]];
    }
  } else if (a1 === 0) {
    // b1 * y + c1 = 0
    // y = - c1 / b1;
    // a2 * x + b2 * y + c2 = 0
    var y = -c1 / b1;
    var x = -(b2 * y + c2) / a2;
    results = [[x, y]];
  } else if (a2 === 0) {
    // b2 * y + c2 = 0
    // y = - c2 / b2;
    // a1 * x + b1 * y + c1 = 0
    var y = -c2 / b2;
    var x = -(b1 * y + c1) / a1;
    results = [[x, y]];
  } else if (b1 === 0) {
    // a1 * x + c1 = 0
    // x = - c1 / a1;
    // a2 * x + b2 * y + c2 = 0
    var x = -c1 / a1;
    var y = -(a2 * x + c2) / b2;
    results = [[x, y]];
  } else if (b2 === 0) {
    // a2 * x + c2 = 0
    // x = - c2 / a2;
    // a1 * x + b1 * y + c1 = 0
    var x = -c2 / a2;
    var y = -(a1 * x + c1) / b1;
    results = [[x, y]];
  } else {
    // a1 * x + b1 * y + c1 = 0
    // a2 * x + b2 * y + c2 = 0
    // b2 * a1 * x + b2 * b1 * y + b2 * c1 = 0
    // b1 * a2 * x + b1 * b2 * y + b1 * c2 = 0
    // (b2 * a1 - b1 * a2)  * x = (b1 * c2 - b2 * c1)
    var x = (b1 * c2 - b2 * c1) / (b2 * a1 - b1 * a2);
    var y = -(a1 * x + c1) / b1;
    results = [[x, y]];
  }

  return results.map(function (result) {
    return [result[0], result[1]];
  });
}
/**
 * Get intersection points to the two lines.
 * @memberof OverlapArea
 */

function getIntersectionPoints(line1, line2, isLimit) {
  var points = getIntersectionPointsByConstants(getLinearConstants(line1[0], line1[1]), getLinearConstants(line2[0], line2[1]));

  if (isLimit) {
    return getPointsOnLines(points, [line1, line2]);
  }

  return points;
}
function isPointOnLine(pos, line) {
  var linearConstants = getLinearConstants(line[0], line[1]);
  return tinyThrottle(getDistanceFromPointToConstants(linearConstants, pos)) === 0;
}
/**
 * Get the points on the lines (between two points).
 * @memberof OverlapArea
 */

function getPointsOnLines(points, lines) {
  var minMaxs = lines.map(function (line) {
    return [0, 1].map(function (order) {
      return [Math.min(line[0][order], line[1][order]), Math.max(line[0][order], line[1][order])];
    });
  });
  var results = [];

  if (points.length === 2) {
    var _a = points[0],
        x = _a[0],
        y = _a[1];

    if (!tinyThrottle(x - points[1][0])) {
      /// Math.max(minY1, minY2)
      var top = Math.max.apply(Math, minMaxs.map(function (minMax) {
        return minMax[1][0];
      })); /// Math.min(maxY1, miax2)

      var bottom = Math.min.apply(Math, minMaxs.map(function (minMax) {
        return minMax[1][1];
      }));

      if (tinyThrottle(top - bottom) > 0) {
        return [];
      }

      results = [[x, top], [x, bottom]];
    } else if (!tinyThrottle(y - points[1][1])) {
      /// Math.max(minY1, minY2)
      var left = Math.max.apply(Math, minMaxs.map(function (minMax) {
        return minMax[0][0];
      })); /// Math.min(maxY1, miax2)

      var right = Math.min.apply(Math, minMaxs.map(function (minMax) {
        return minMax[0][1];
      }));

      if (tinyThrottle(left - right) > 0) {
        return [];
      }

      results = [[left, y], [right, y]];
    }
  }

  if (!results.length) {
    results = points.filter(function (point) {
      var pointX = point[0],
          pointY = point[1];
      return minMaxs.every(function (minMax) {
        return 0 <= tinyThrottle(pointX - minMax[0][0]) && 0 <= tinyThrottle(minMax[0][1] - pointX) && 0 <= tinyThrottle(pointY - minMax[1][0]) && 0 <= tinyThrottle(minMax[1][1] - pointY);
      });
    });
  }

  return results.map(function (result) {
    return [tinyThrottle(result[0]), tinyThrottle(result[1])];
  });
}
/**
* Convert two points into lines.
* @function
* @memberof OverlapArea
*/

function convertLines(points) {
  return overlap_area_esm_spreadArrays(points.slice(1), [points[0]]).map(function (point, i) {
    return [points[i], point];
  });
}

function getOverlapPointInfos(points1, points2) {
  var targetPoints1 = points1.slice();
  var targetPoints2 = points2.slice();

  if (getShapeDirection(targetPoints1) === -1) {
    targetPoints1.reverse();
  }

  if (getShapeDirection(targetPoints2) === -1) {
    targetPoints2.reverse();
  }

  var lines1 = convertLines(targetPoints1);
  var lines2 = convertLines(targetPoints2);
  var linearConstantsList1 = lines1.map(function (line1) {
    return getLinearConstants(line1[0], line1[1]);
  });
  var linearConstantsList2 = lines2.map(function (line2) {
    return getLinearConstants(line2[0], line2[1]);
  });
  var overlapInfos = [];
  linearConstantsList1.forEach(function (linearConstants1, i) {
    var line1 = lines1[i];
    var linePointInfos = [];
    linearConstantsList2.forEach(function (linearConstants2, j) {
      var intersectionPoints = getIntersectionPointsByConstants(linearConstants1, linearConstants2);
      var points = getPointsOnLines(intersectionPoints, [line1, lines2[j]]);
      linePointInfos.push.apply(linePointInfos, points.map(function (pos) {
        return {
          index1: i,
          index2: j,
          pos: pos,
          type: "intersection"
        };
      }));
    });
    linePointInfos.sort(function (a, b) {
      return utils_esm_getDist(line1[0], a.pos) - utils_esm_getDist(line1[0], b.pos);
    });
    overlapInfos.push.apply(overlapInfos, linePointInfos);

    if (isInside(line1[1], targetPoints2)) {
      overlapInfos.push({
        index1: i,
        index2: -1,
        pos: line1[1],
        type: "inside"
      });
    }
  });
  lines2.forEach(function (line2, i) {
    if (!isInside(line2[1], targetPoints1)) {
      return;
    }

    var isNext = false;
    var index = findIndex(overlapInfos, function (_a) {
      var index2 = _a.index2;

      if (index2 === i) {
        isNext = true;
        return false;
      }

      if (isNext) {
        return true;
      }

      return false;
    });

    if (index === -1) {
      isNext = false;
      index = findIndex(overlapInfos, function (_a) {
        var index1 = _a.index1,
            index2 = _a.index2;

        if (index1 === -1 && index2 + 1 === i) {
          isNext = true;
          return false;
        }

        if (isNext) {
          return true;
        }

        return false;
      });
    }

    if (index === -1) {
      overlapInfos.push({
        index1: -1,
        index2: i,
        pos: line2[1],
        type: "inside"
      });
    } else {
      overlapInfos.splice(index, 0, {
        index1: -1,
        index2: i,
        pos: line2[1],
        type: "inside"
      });
    }
  });
  var pointMap = {};
  return overlapInfos.filter(function (_a) {
    var pos = _a.pos;
    var key = pos[0] + "x" + pos[1];

    if (pointMap[key]) {
      return false;
    }

    pointMap[key] = true;
    return true;
  });
}
/**
* Get the points of the overlapped part of two shapes.
* @function
* @memberof OverlapArea
*/


function getOverlapPoints(points1, points2) {
  var infos = getOverlapPointInfos(points1, points2);
  return infos.map(function (_a) {
    var pos = _a.pos;
    return pos;
  });
}

function isConnectedLine(line) {
  var _a = line[0],
      prevIndex1 = _a.index1,
      prevIndex2 = _a.index2,
      _b = line[1],
      nextIndex1 = _b.index1,
      nextIndex2 = _b.index2;

  if (prevIndex1 !== -1) {
    // same line
    if (prevIndex1 === nextIndex1) {
      return true;
    }

    if (prevIndex1 + 1 === nextIndex1) {
      return true;
    }
  }

  if (prevIndex2 !== -1) {
    // same line
    if (prevIndex2 === nextIndex2) {
      return true;
    }

    if (prevIndex2 + 1 === nextIndex2) {
      return true;
    }
  }

  return false;
}
/**
* Get the areas of the overlapped part of two shapes.
* @function
* @memberof OverlapArea
*/


function getOverlapAreas(points1, points2) {
  var infos = getOverlapPointInfos(points1, points2);
  var areas = [];
  var area;
  getOverlapPointInfos(points1, points2).forEach(function (info, i, arr) {
    if (i === 0 || !isConnectedLine([arr[i - 1], info])) {
      area = [info];
      areas.push(area);
    } else {
      area.push(info);
    }
  });
  return areas.map(function (area) {
    return area.map(function (_a) {
      var pos = _a.pos;
      return pos;
    });
  });
}

function findReversedAreas(points1, points2, index, areas) {
  if (index === void 0) {
    index = 0;
  }

  if (areas === void 0) {
    areas = [];
  }

  var isFirst = areas.length === 0;
  var length = points1.length;
  var nextIndex = points1[index] ? index : 0;

  var nextPoints1 = overlap_area_esm_spreadArrays(points1.slice(nextIndex), points1.slice(0, nextIndex));

  var _loop_1 = function (i) {
    var point1 = nextPoints1[i];

    if (find(points2, function (point2) {
      return point2[0] === point1[0] && point2[1] === point1[1];
    })) {
      return "continue";
    }

    if (areas.some(function (nextArea) {
      return find(nextArea, function (areaPoint) {
        return areaPoint[0] === point1[0] && areaPoint[1] === point1[1];
      });
    })) {
      if (isFirst) {
        return "continue";
      } else {
        return "break";
      }
    }

    var nextArea = void 0;

    if (isFirst) {
      nextArea = [];
      areas.push(nextArea);
    } else {
      nextArea = areas[areas.length - 1];
    }

    nextArea.push(point1);
    var line = [point1, points1[index + 1] || points1[0]];
    var nextPoint2 = points2.filter(function (point2) {
      return isPointOnLine(point2, line);
    }).sort(function (a, b) {
      return getDist(point1, a) - getDist(point1, b);
    })[0];

    if (!nextPoint2) {
      findReversedAreas(nextPoints1, points2, i + 1, areas);
      return "break";
    } else {
      var point2Index = points2.indexOf(nextPoint2);
      findReversedAreas(points2, points1, point2Index, areas);

      if (!isFirst) {
        return "break";
      }
    }
  };

  for (var i = 0; i < length; ++i) {
    var state_1 = _loop_1(i);

    if (state_1 === "break") break;
  }

  return areas;
}

function findConnectedAreas(points1, points2) {
  return findReversedAreas(points1, overlap_area_esm_spreadArrays(points2).reverse());
}
/**
* Get non-overlapping areas of two shapes based on points1.
* @memberof OverlapArea
*/

function getUnoverlapAreas(points1, points2) {
  if (!points2.length) {
    return [overlap_area_esm_spreadArrays(points1)];
  }

  var overlapAreas = getOverlapAreas(points1, points2);
  var unoverlapAreas = [points1];
  overlapAreas.forEach(function (overlapArea) {
    var nextOverlapArea = overlap_area_esm_spreadArrays(overlapArea).reverse();

    unoverlapAreas = overlap_area_esm_flat(unoverlapAreas.map(function (area) {
      var connectedAreas = findReversedAreas(area, nextOverlapArea);
      var firstConnectedArea = connectedAreas[0];

      if (connectedAreas.length === 1 && nextOverlapArea.every(function (point) {
        return firstConnectedArea.indexOf(point) === -1;
      })) {
        var lastPoint_1 = firstConnectedArea[firstConnectedArea.length - 1];

        var firstPoint = overlap_area_esm_spreadArrays(nextOverlapArea).sort(function (a, b) {
          return getDist(lastPoint_1, a) - getDist(lastPoint_1, b);
        })[0];

        var firstIndex = nextOverlapArea.indexOf(firstPoint);
        firstConnectedArea.push.apply(firstConnectedArea, overlap_area_esm_spreadArrays(nextOverlapArea.slice(firstIndex), nextOverlapArea.slice(0, firstIndex), [nextOverlapArea[firstIndex], lastPoint_1]));
      }

      return connectedAreas;
    }));
  });
  return unoverlapAreas;
}
/**
* Gets the size of the overlapped part of two shapes.
* @function
* @memberof OverlapArea
*/

function getOverlapSize(points1, points2) {
  var points = getOverlapPoints(points1, points2);
  return getAreaSize(points);
}


//# sourceMappingURL=overlap-area.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@scena/event-emitter/dist/event-emitter.esm.js
/*
Copyright (c) 2019 Daybrush
name: @scena/event-emitter
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/gesture.git
version: 1.0.5
*/


/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var event_emitter_esm_assign = function () {
  event_emitter_esm_assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return event_emitter_esm_assign.apply(this, arguments);
};
function event_emitter_esm_spreadArrays() {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;

  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];

  return r;
}

/**
 * Implement EventEmitter on object or component.
 */

var EventEmitter =
/*#__PURE__*/
function () {
  function EventEmitter() {
    this._events = {};
  }
  /**
   * Add a listener to the registered event.
   * @param - Name of the event to be added
   * @param - listener function of the event to be added
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Add listener in "a" event
   * emitter.on("a", () => {
   * });
   * // Add listeners
   * emitter.on({
   *  a: () => {},
   *  b: () => {},
   * });
   */


  var __proto = EventEmitter.prototype;

  __proto.on = function (eventName, listener) {
    if (utils_esm_isObject(eventName)) {
      for (var name in eventName) {
        this.on(name, eventName[name]);
      }
    } else {
      this._addEvent(eventName, listener, {});
    }

    return this;
  };
  /**
   * Remove listeners registered in the event target.
   * @param - Name of the event to be removed
   * @param - listener function of the event to be removed
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Remove all listeners.
   * emitter.off();
   *
   * // Remove all listeners in "A" event.
   * emitter.off("a");
   *
   *
   * // Remove "listener" listener in "a" event.
   * emitter.off("a", listener);
   */


  __proto.off = function (eventName, listener) {
    if (!eventName) {
      this._events = {};
    } else if (utils_esm_isObject(eventName)) {
      for (var name in eventName) {
        this.off(name);
      }
    } else if (!listener) {
      this._events[eventName] = [];
    } else {
      var events = this._events[eventName];

      if (events) {
        var index = findIndex(events, function (e) {
          return e.listener === listener;
        });

        if (index > -1) {
          events.splice(index, 1);
        }
      }
    }

    return this;
  };
  /**
   * Add a disposable listener and Use promise to the registered event.
   * @param - Name of the event to be added
   * @param - disposable listener function of the event to be added
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Add a disposable listener in "a" event
   * emitter.once("a", () => {
   * });
   *
   * // Use Promise
   * emitter.once("a").then(e => {
   * });
   */


  __proto.once = function (eventName, listener) {
    var _this = this;

    if (listener) {
      this._addEvent(eventName, listener, {
        once: true
      });
    }

    return new Promise(function (resolve) {
      _this._addEvent(eventName, resolve, {
        once: true
      });
    });
  };
  /**
   * Fires an event to call listeners.
   * @param - Event name
   * @param - Event parameter
   * @return If false, stop the event.
   * @example
   *
   * import EventEmitter from "@scena/event-emitter";
   *
   *
   * const emitter = new EventEmitter();
   *
   * emitter.on("a", e => {
   * });
   *
   *
   * emitter.emit("a", {
   *   a: 1,
   * });
   */


  __proto.emit = function (eventName, param) {
    var _this = this;

    if (param === void 0) {
      param = {};
    }

    var events = this._events[eventName];

    if (!eventName || !events) {
      return true;
    }

    var isStop = false;
    param.eventType = eventName;

    param.stop = function () {
      isStop = true;
    };

    param.currentTarget = this;

    event_emitter_esm_spreadArrays(events).forEach(function (info) {
      info.listener(param);

      if (info.once) {
        _this.off(eventName, info.listener);
      }
    });

    return !isStop;
  };
  /**
   * Fires an event to call listeners.
   * @param - Event name
   * @param - Event parameter
   * @return If false, stop the event.
   * @example
   *
   * import EventEmitter from "@scena/event-emitter";
   *
   *
   * const emitter = new EventEmitter();
   *
   * emitter.on("a", e => {
   * });
   *
   *
   * emitter.emit("a", {
   *   a: 1,
   * });
   */

  /**
  * Fires an event to call listeners.
  * @param - Event name
  * @param - Event parameter
  * @return If false, stop the event.
  * @example
  *
  * import EventEmitter from "@scena/event-emitter";
  *
  *
  * const emitter = new EventEmitter();
  *
  * emitter.on("a", e => {
  * });
  *
  * // emit
  * emitter.trigger("a", {
  *   a: 1,
  * });
  */


  __proto.trigger = function (eventName, param) {
    if (param === void 0) {
      param = {};
    }

    return this.emit(eventName, param);
  };

  __proto._addEvent = function (eventName, listener, options) {
    var events = this._events;
    events[eventName] = events[eventName] || [];
    var listeners = events[eventName];
    listeners.push(event_emitter_esm_assign({
      listener: listener
    }, options));
  };

  return EventEmitter;
}();

/* harmony default export */ const event_emitter_esm = (EventEmitter);
//# sourceMappingURL=event-emitter.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@scena/dragscroll/node_modules/@daybrush/utils/dist/utils.esm.js
/*
Copyright (c) 2018 Daybrush
@name: @daybrush/utils
license: MIT
author: Daybrush
repository: https://github.com/daybrush/utils
@version 1.6.0
*/
/**
* @namespace
* @name Consts
*/

/**
* get string "rgb"
* @memberof Color
* @example
import {RGB} from "@daybrush/utils";

console.log(RGB); // "rgb"
*/
var utils_esm_RGB = "rgb";
/**
* get string "rgba"
* @memberof Color
* @example
import {RGBA} from "@daybrush/utils";

console.log(RGBA); // "rgba"
*/

var utils_esm_RGBA = "rgba";
/**
* get string "hsl"
* @memberof Color
* @example
import {HSL} from "@daybrush/utils";

console.log(HSL); // "hsl"
*/

var utils_esm_HSL = "hsl";
/**
* get string "hsla"
* @memberof Color
* @example
import {HSLA} from "@daybrush/utils";

console.log(HSLA); // "hsla"
*/

var utils_esm_HSLA = "hsla";
/**
* gets an array of color models.
* @memberof Color
* @example
import {COLOR_MODELS} from "@daybrush/utils";

console.log(COLOR_MODELS); // ["rgb", "rgba", "hsl", "hsla"];
*/

var utils_esm_COLOR_MODELS = [utils_esm_RGB, utils_esm_RGBA, utils_esm_HSL, utils_esm_HSLA];
/**
* get string "function"
* @memberof Consts
* @example
import {FUNCTION} from "@daybrush/utils";

console.log(FUNCTION); // "function"
*/

var utils_esm_FUNCTION = "function";
/**
* get string "property"
* @memberof Consts
* @example
import {PROPERTY} from "@daybrush/utils";

console.log(PROPERTY); // "property"
*/

var utils_esm_PROPERTY = "property";
/**
* get string "array"
* @memberof Consts
* @example
import {ARRAY} from "@daybrush/utils";

console.log(ARRAY); // "array"
*/

var utils_esm_ARRAY = "array";
/**
* get string "object"
* @memberof Consts
* @example
import {OBJECT} from "@daybrush/utils";

console.log(OBJECT); // "object"
*/

var utils_esm_OBJECT = "object";
/**
* get string "string"
* @memberof Consts
* @example
import {STRING} from "@daybrush/utils";

console.log(STRING); // "string"
*/

var utils_esm_STRING = "string";
/**
* get string "number"
* @memberof Consts
* @example
import {NUMBER} from "@daybrush/utils";

console.log(NUMBER); // "number"
*/

var utils_esm_NUMBER = "number";
/**
* get string "undefined"
* @memberof Consts
* @example
import {UNDEFINED} from "@daybrush/utils";

console.log(UNDEFINED); // "undefined"
*/

var utils_esm_UNDEFINED = "undefined";
/**
* Check whether the environment is window or node.js.
* @memberof Consts
* @example
import {IS_WINDOW} from "@daybrush/utils";

console.log(IS_WINDOW); // false in node.js
console.log(IS_WINDOW); // true in browser
*/

var utils_esm_IS_WINDOW = typeof window !== utils_esm_UNDEFINED;
/**
* Check whether the environment is window or node.js.
* @memberof Consts
* @name document
* @example
import {IS_WINDOW} from "@daybrush/utils";

console.log(IS_WINDOW); // false in node.js
console.log(IS_WINDOW); // true in browser
*/

var utils_esm_doc = typeof document !== utils_esm_UNDEFINED && document; // FIXME: this type maybe false
var utils_esm_prefixes = (/* unused pure expression or super */ null && (["webkit", "ms", "moz", "o"]));
/**
 * @namespace CrossBrowser
 */

/**
* Get a CSS property with a vendor prefix that supports cross browser.
* @function
* @param {string} property - A CSS property
* @return {string} CSS property with cross-browser vendor prefix
* @memberof CrossBrowser
* @example
import {getCrossBrowserProperty} from "@daybrush/utils";

console.log(getCrossBrowserProperty("transform")); // "transform", "-ms-transform", "-webkit-transform"
console.log(getCrossBrowserProperty("filter")); // "filter", "-webkit-filter"
*/

var utils_esm_getCrossBrowserProperty = /*#__PURE__*/function (property) {
  if (!utils_esm_doc) {
    return "";
  }

  var styles = (utils_esm_doc.body || utils_esm_doc.documentElement).style;
  var length = utils_esm_prefixes.length;

  if (typeof styles[property] !== utils_esm_UNDEFINED) {
    return property;
  }

  for (var i = 0; i < length; ++i) {
    var name = "-" + utils_esm_prefixes[i] + "-" + property;

    if (typeof styles[name] !== utils_esm_UNDEFINED) {
      return name;
    }
  }

  return "";
};
/**
* get string "transfrom" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {TRANSFORM} from "@daybrush/utils";

console.log(TRANSFORM); // "transform", "-ms-transform", "-webkit-transform"
*/

var utils_esm_TRANSFORM = /*#__PURE__*/(/* unused pure expression or super */ null && (utils_esm_getCrossBrowserProperty("transform")));
/**
* get string "filter" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {FILTER} from "@daybrush/utils";

console.log(FILTER); // "filter", "-ms-filter", "-webkit-filter"
*/

var utils_esm_FILTER = /*#__PURE__*/(/* unused pure expression or super */ null && (utils_esm_getCrossBrowserProperty("filter")));
/**
* get string "animation" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {ANIMATION} from "@daybrush/utils";

console.log(ANIMATION); // "animation", "-ms-animation", "-webkit-animation"
*/

var utils_esm_ANIMATION = /*#__PURE__*/(/* unused pure expression or super */ null && (utils_esm_getCrossBrowserProperty("animation")));
/**
* get string "keyframes" with the vendor prefix.
* @memberof CrossBrowser
* @example
import {KEYFRAMES} from "@daybrush/utils";

console.log(KEYFRAMES); // "keyframes", "-ms-keyframes", "-webkit-keyframes"
*/

var utils_esm_KEYFRAMES = /*#__PURE__*/(/* unused pure expression or super */ null && (utils_esm_ANIMATION.replace("animation", "keyframes")));
var utils_esm_OPEN_CLOSED_CHARACTERS = [{
  open: "(",
  close: ")"
}, {
  open: "\"",
  close: "\""
}, {
  open: "'",
  close: "'"
}, {
  open: "\\\"",
  close: "\\\""
}, {
  open: "\\'",
  close: "\\'"
}];
var utils_esm_TINY_NUM = 0.0000001;
var utils_esm_DEFAULT_UNIT_PRESETS = {
  "cm": function (pos) {
    return pos * 96 / 2.54;
  },
  "mm": function (pos) {
    return pos * 96 / 254;
  },
  "in": function (pos) {
    return pos * 96;
  },
  "pt": function (pos) {
    return pos * 96 / 72;
  },
  "pc": function (pos) {
    return pos * 96 / 6;
  },
  "%": function (pos, size) {
    return pos * size / 100;
  },
  "vw": function (pos, size) {
    if (size === void 0) {
      size = window.innerWidth;
    }

    return pos / 100 * size;
  },
  "vh": function (pos, size) {
    if (size === void 0) {
      size = window.innerHeight;
    }

    return pos / 100 * size;
  },
  "vmax": function (pos, size) {
    if (size === void 0) {
      size = Math.max(window.innerWidth, window.innerHeight);
    }

    return pos / 100 * size;
  },
  "vmin": function (pos, size) {
    if (size === void 0) {
      size = Math.min(window.innerWidth, window.innerHeight);
    }

    return pos / 100 * size;
  }
};

/**
* @namespace
* @name Utils
*/

/**
 * Returns the inner product of two numbers(`a1`, `a2`) by two criteria(`b1`, `b2`).
 * @memberof Utils
 * @param - The first number
 * @param - The second number
 * @param - The first number to base on the inner product
 * @param - The second number to base on the inner product
 * @return - Returns the inner product
import { dot } from "@daybrush/utils";

console.log(dot(0, 15, 2, 3)); // 6
console.log(dot(5, 15, 2, 3)); // 9
console.log(dot(5, 15, 1, 1)); // 10
 */

function utils_esm_dot(a1, a2, b1, b2) {
  return (a1 * b2 + a2 * b1) / (b1 + b2);
}
/**
* Check the type that the value is undefined.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {boolean} true if the type is correct, false otherwise
* @example
import {isUndefined} from "@daybrush/utils";

console.log(isUndefined(undefined)); // true
console.log(isUndefined("")); // false
console.log(isUndefined(1)); // false
console.log(isUndefined(null)); // false
*/

function utils_esm_isUndefined(value) {
  return typeof value === utils_esm_UNDEFINED;
}
/**
* Check the type that the value is object.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isObject} from "@daybrush/utils";

console.log(isObject({})); // true
console.log(isObject(undefined)); // false
console.log(isObject("")); // false
console.log(isObject(null)); // false
*/

function dist_utils_esm_isObject(value) {
  return value && typeof value === utils_esm_OBJECT;
}
/**
* Check the type that the value is isArray.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isArray} from "@daybrush/utils";

console.log(isArray([])); // true
console.log(isArray({})); // false
console.log(isArray(undefined)); // false
console.log(isArray(null)); // false
*/

function utils_esm_isArray(value) {
  return Array.isArray(value);
}
/**
* Check the type that the value is string.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isString} from "@daybrush/utils";

console.log(isString("1234")); // true
console.log(isString(undefined)); // false
console.log(isString(1)); // false
console.log(isString(null)); // false
*/

function utils_esm_isString(value) {
  return typeof value === utils_esm_STRING;
}
function utils_esm_isNumber(value) {
  return typeof value === utils_esm_NUMBER;
}
/**
* Check the type that the value is function.
* @memberof Utils
* @param {string} value - Value to check the type
* @return {} true if the type is correct, false otherwise
* @example
import {isFunction} from "@daybrush/utils";

console.log(isFunction(function a() {})); // true
console.log(isFunction(() => {})); // true
console.log(isFunction("1234")); // false
console.log(isFunction(1)); // false
console.log(isFunction(null)); // false
*/

function dist_utils_esm_isFunction(value) {
  return typeof value === utils_esm_FUNCTION;
}

function utils_esm_isEqualSeparator(character, separator) {
  var isCharacterSpace = character === "" || character == " ";
  var isSeparatorSpace = separator === "" || separator == " ";
  return isSeparatorSpace && isCharacterSpace || character === separator;
}

function utils_esm_findOpen(openCharacter, texts, index, length, openCloseCharacters) {
  var isIgnore = utils_esm_findIgnore(openCharacter, texts, index);

  if (!isIgnore) {
    return utils_esm_findClose(openCharacter, texts, index + 1, length, openCloseCharacters);
  }

  return index;
}

function utils_esm_findIgnore(character, texts, index) {
  if (!character.ignore) {
    return null;
  }

  var otherText = texts.slice(Math.max(index - 3, 0), index + 3).join("");
  return new RegExp(character.ignore).exec(otherText);
}

function utils_esm_findClose(closeCharacter, texts, index, length, openCloseCharacters) {
  var _loop_1 = function (i) {
    var character = texts[i].trim();

    if (character === closeCharacter.close && !utils_esm_findIgnore(closeCharacter, texts, i)) {
      return {
        value: i
      };
    }

    var nextIndex = i; // re open

    var openCharacter = dist_utils_esm_find(openCloseCharacters, function (_a) {
      var open = _a.open;
      return open === character;
    });

    if (openCharacter) {
      nextIndex = utils_esm_findOpen(openCharacter, texts, i, length, openCloseCharacters);
    }

    if (nextIndex === -1) {
      return out_i_1 = i, "break";
    }

    i = nextIndex;
    out_i_1 = i;
  };

  var out_i_1;

  for (var i = index; i < length; ++i) {
    var state_1 = _loop_1(i);

    i = out_i_1;
    if (typeof state_1 === "object") return state_1.value;
    if (state_1 === "break") break;
  }

  return -1;
}

function utils_esm_splitText(text, splitOptions) {
  var _a = utils_esm_isString(splitOptions) ? {
    separator: splitOptions
  } : splitOptions,
      _b = _a.separator,
      separator = _b === void 0 ? "," : _b,
      isSeparateFirst = _a.isSeparateFirst,
      isSeparateOnlyOpenClose = _a.isSeparateOnlyOpenClose,
      _c = _a.isSeparateOpenClose,
      isSeparateOpenClose = _c === void 0 ? isSeparateOnlyOpenClose : _c,
      _d = _a.openCloseCharacters,
      openCloseCharacters = _d === void 0 ? utils_esm_OPEN_CLOSED_CHARACTERS : _d;

  var openClosedText = openCloseCharacters.map(function (_a) {
    var open = _a.open,
        close = _a.close;

    if (open === close) {
      return open;
    }

    return open + "|" + close;
  }).join("|");
  var regexText = "(\\s*" + separator + "\\s*|" + openClosedText + "|\\s+)";
  var regex = new RegExp(regexText, "g");
  var texts = text.split(regex).filter(Boolean);
  var length = texts.length;
  var values = [];
  var tempValues = [];

  function resetTemp() {
    if (tempValues.length) {
      values.push(tempValues.join(""));
      tempValues = [];
      return true;
    }

    return false;
  }

  var _loop_2 = function (i) {
    var character = texts[i].trim();
    var nextIndex = i;
    var openCharacter = dist_utils_esm_find(openCloseCharacters, function (_a) {
      var open = _a.open;
      return open === character;
    });
    var closeCharacter = dist_utils_esm_find(openCloseCharacters, function (_a) {
      var close = _a.close;
      return close === character;
    });

    if (openCharacter) {
      nextIndex = utils_esm_findOpen(openCharacter, texts, i, length, openCloseCharacters);

      if (nextIndex !== -1 && isSeparateOpenClose) {
        if (resetTemp() && isSeparateFirst) {
          return out_i_2 = i, "break";
        }

        values.push(texts.slice(i, nextIndex + 1).join(""));
        i = nextIndex;

        if (isSeparateFirst) {
          return out_i_2 = i, "break";
        }

        return out_i_2 = i, "continue";
      }
    } else if (closeCharacter && !utils_esm_findIgnore(closeCharacter, texts, i)) {
      throw new Error("invalid format: " + closeCharacter.close);
    } else if (utils_esm_isEqualSeparator(character, separator) && !isSeparateOnlyOpenClose) {
      resetTemp();

      if (isSeparateFirst) {
        return out_i_2 = i, "break";
      }

      return out_i_2 = i, "continue";
    }

    if (nextIndex === -1) {
      nextIndex = length - 1;
    }

    tempValues.push(texts.slice(i, nextIndex + 1).join(""));
    i = nextIndex;
    out_i_2 = i;
  };

  var out_i_2;

  for (var i = 0; i < length; ++i) {
    var state_2 = _loop_2(i);

    i = out_i_2;
    if (state_2 === "break") break;
  }

  if (tempValues.length) {
    values.push(tempValues.join(""));
  }

  return values;
}
/**
* divide text by space.
* @memberof Utils
* @param {string} text - text to divide
* @return {Array} divided texts
* @example
import {spliceSpace} from "@daybrush/utils";

console.log(splitSpace("a b c d e f g"));
// ["a", "b", "c", "d", "e", "f", "g"]
console.log(splitSpace("'a,b' c 'd,e' f g"));
// ["'a,b'", "c", "'d,e'", "f", "g"]
*/

function utils_esm_splitSpace(text) {
  // divide comma(space)
  return utils_esm_splitText(text, "");
}
/**
* divide text by comma.
* @memberof Utils
* @param {string} text - text to divide
* @return {Array} divided texts
* @example
import {splitComma} from "@daybrush/utils";

console.log(splitComma("a,b,c,d,e,f,g"));
// ["a", "b", "c", "d", "e", "f", "g"]
console.log(splitComma("'a,b',c,'d,e',f,g"));
// ["'a,b'", "c", "'d,e'", "f", "g"]
*/

function utils_esm_splitComma(text) {
  // divide comma(,)
  // "[^"]*"|'[^']*'
  return utils_esm_splitText(text, ",");
}
/**
* divide text by bracket "(", ")".
* @memberof Utils
* @param {string} text - text to divide
* @return {object} divided texts
* @example
import {splitBracket} from "@daybrush/utils";

console.log(splitBracket("a(1, 2)"));
// {prefix: "a", value: "1, 2", suffix: ""}
console.log(splitBracket("a(1, 2)b"));
// {prefix: "a", value: "1, 2", suffix: "b"}
*/

function utils_esm_splitBracket(text) {
  var matches = /([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(text);

  if (!matches || matches.length < 4) {
    return {};
  } else {
    return {
      prefix: matches[1],
      value: matches[2],
      suffix: matches[3]
    };
  }
}
/**
* divide text by number and unit.
* @memberof Utils
* @param {string} text - text to divide
* @return {} divided texts
* @example
import {splitUnit} from "@daybrush/utils";

console.log(splitUnit("10px"));
// {prefix: "", value: 10, unit: "px"}
console.log(splitUnit("-10px"));
// {prefix: "", value: -10, unit: "px"}
console.log(splitUnit("a10%"));
// {prefix: "a", value: 10, unit: "%"}
*/

function utils_esm_splitUnit(text) {
  var matches = /^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(text);

  if (!matches) {
    return {
      prefix: "",
      unit: "",
      value: NaN
    };
  }

  var prefix = matches[1];
  var value = matches[2];
  var unit = matches[3];
  return {
    prefix: prefix,
    unit: unit,
    value: parseFloat(value)
  };
}
/**
* transform strings to camel-case
* @memberof Utils
* @param {String} text - string
* @return {String} camel-case string
* @example
import {camelize} from "@daybrush/utils";

console.log(camelize("transform-origin")); // transformOrigin
console.log(camelize("abcd_efg")); // abcdEfg
console.log(camelize("abcd efg")); // abcdEfg
*/

function utils_esm_camelize(str) {
  return str.replace(/[\s-_]([a-z])/g, function (all, letter) {
    return letter.toUpperCase();
  });
}
/**
* transform a camelized string into a lowercased string.
* @memberof Utils
* @param {string} text - a camel-cased string
* @param {string} [separator="-"] - a separator
* @return {string}  a lowercased string
* @example
import {decamelize} from "@daybrush/utils";

console.log(decamelize("transformOrigin")); // transform-origin
console.log(decamelize("abcdEfg", "_")); // abcd_efg
*/

function utils_esm_decamelize(str, separator) {
  if (separator === void 0) {
    separator = "-";
  }

  return str.replace(/([a-z])([A-Z])/g, function (all, letter, letter2) {
    return "" + letter + separator + letter2.toLowerCase();
  });
}
/**
* transforms something in an array into an array.
* @memberof Utils
* @param - Array form
* @return an array
* @example
import {toArray} from "@daybrush/utils";

const arr1 = toArray(document.querySelectorAll(".a")); // Element[]
const arr2 = toArray(document.querySelectorAll<HTMLElement>(".a")); // HTMLElement[]
*/

function utils_esm_toArray(value) {
  return [].slice.call(value);
}
/**
* Date.now() method
* @memberof CrossBrowser
* @return {number} milliseconds
* @example
import {now} from "@daybrush/utils";

console.log(now()); // 12121324241(milliseconds)
*/

function utils_esm_now() {
  return Date.now ? Date.now() : new Date().getTime();
}
/**
* Returns the index of the first element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `findIndex` was called upon.
* @param - A function to execute on each value in the array until the function returns true, indicating that the satisfying element was found.
* @param - Returns defaultIndex if not found by the function.
* @example
import { findIndex } from "@daybrush/utils";

findIndex([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // 1
*/

function utils_esm_findIndex(arr, callback, defaultIndex) {
  if (defaultIndex === void 0) {
    defaultIndex = -1;
  }

  var length = arr.length;

  for (var i = 0; i < length; ++i) {
    if (callback(arr[i], i, arr)) {
      return i;
    }
  }

  return defaultIndex;
}
/**
* Returns the reverse direction index of the first element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `findLastIndex` was called upon.
* @param - A function to execute on each value in the array until the function returns true, indicating that the satisfying element was found.
* @param - Returns defaultIndex if not found by the function.
* @example
import { findLastIndex } from "@daybrush/utils";

findLastIndex([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // 1
*/

function utils_esm_findLastIndex(arr, callback, defaultIndex) {
  if (defaultIndex === void 0) {
    defaultIndex = -1;
  }

  var length = arr.length;

  for (var i = length - 1; i >= 0; --i) {
    if (callback(arr[i], i, arr)) {
      return i;
    }
  }

  return defaultIndex;
}
/**
* Returns the value of the reverse direction element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `findLast` was called upon.
* @param - A function to execute on each value in the array,
* @param - Returns defalutValue if not found by the function.
* @example
import { find } from "@daybrush/utils";

find([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // {a: 2}
*/

function utils_esm_findLast(arr, callback, defalutValue) {
  var index = utils_esm_findLastIndex(arr, callback);
  return index > -1 ? arr[index] : defalutValue;
}
/**
* Returns the value of the first element in the array that satisfies the provided testing function.
* @function
* @memberof CrossBrowser
* @param - The array `find` was called upon.
* @param - A function to execute on each value in the array,
* @param - Returns defalutValue if not found by the function.
* @example
import { find } from "@daybrush/utils";

find([{a: 1}, {a: 2}, {a: 3}, {a: 4}], ({ a }) => a === 2); // {a: 2}
*/

function dist_utils_esm_find(arr, callback, defalutValue) {
  var index = utils_esm_findIndex(arr, callback);
  return index > -1 ? arr[index] : defalutValue;
}
/**
* window.requestAnimationFrame() method with cross browser.
* @function
* @memberof CrossBrowser
* @param {FrameRequestCallback} callback - The function to call when it's time to update your animation for the next repaint.
* @return {number} id
* @example
import {requestAnimationFrame} from "@daybrush/utils";

requestAnimationFrame((timestamp) => {
  console.log(timestamp);
});
*/

var dist_utils_esm_requestAnimationFrame = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {
  var firstTime = utils_esm_now();
  var raf = utils_esm_IS_WINDOW && (window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame);
  return raf ? raf.bind(window) : function (callback) {
    var currTime = utils_esm_now();
    var id = window.setTimeout(function () {
      callback(currTime - firstTime);
    }, 1000 / 60);
    return id;
  };
}()));
/**
* window.cancelAnimationFrame() method with cross browser.
* @function
* @memberof CrossBrowser
* @param {number} handle - the id obtained through requestAnimationFrame method
* @return {void}
* @example
import { requestAnimationFrame, cancelAnimationFrame } from "@daybrush/utils";

const id = requestAnimationFrame((timestamp) => {
  console.log(timestamp);
});

cancelAnimationFrame(id);
*/

var utils_esm_cancelAnimationFrame = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {
  var caf = utils_esm_IS_WINDOW && (window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.mozCancelAnimationFrame || window.msCancelAnimationFrame);
  return caf ? caf.bind(window) : function (handle) {
    clearTimeout(handle);
  };
}()));
/**
* @function
* @memberof Utils
*/

function utils_esm_getKeys(obj) {
  if (Object.keys) {
    return Object.keys(obj);
  }

  var keys = [];

  for (var name in keys) {
    keys.push(name);
  }

  return keys;
}
/**
* @function
* @memberof Utils
*/

function utils_esm_sortOrders(keys, orders) {
  if (orders === void 0) {
    orders = [];
  }

  keys.sort(function (a, b) {
    var index1 = orders.indexOf(a);
    var index2 = orders.indexOf(b);

    if (index2 === -1 && index1 === -1) {
      return 0;
    }

    if (index1 === -1) {
      return 1;
    }

    if (index2 === -1) {
      return -1;
    }

    return index1 - index2;
  });
}
/**
* convert unit size to px size
* @function
* @memberof Utils
*/

function utils_esm_convertUnitSize(pos, size) {
  var _a = utils_esm_splitUnit(pos),
      value = _a.value,
      unit = _a.unit;

  if (dist_utils_esm_isObject(size)) {
    var sizeFunction = size[unit];

    if (sizeFunction) {
      if (dist_utils_esm_isFunction(sizeFunction)) {
        return sizeFunction(value);
      } else if (utils_esm_DEFAULT_UNIT_PRESETS[unit]) {
        return utils_esm_DEFAULT_UNIT_PRESETS[unit](value, sizeFunction);
      }
    }
  } else if (unit === "%") {
    return value * size / 100;
  }

  if (utils_esm_DEFAULT_UNIT_PRESETS[unit]) {
    return utils_esm_DEFAULT_UNIT_PRESETS[unit](value);
  }

  return value;
}
/**
* calculate between min, max
* @function
* @memberof Utils
*/

function utils_esm_between(value, min, max) {
  return Math.max(min, Math.min(value, max));
}
function utils_esm_checkBoundSize(targetSize, compareSize, isMax) {
  return [[dist_utils_esm_throttle(compareSize[0], utils_esm_TINY_NUM), dist_utils_esm_throttle(compareSize[0] * targetSize[1] / targetSize[0], utils_esm_TINY_NUM)], [dist_utils_esm_throttle(compareSize[1] * targetSize[0] / targetSize[1], utils_esm_TINY_NUM), dist_utils_esm_throttle(compareSize[1], utils_esm_TINY_NUM)]].filter(function (size) {
    return size.every(function (value, i) {
      return isMax ? value <= compareSize[i] : value >= compareSize[i];
    });
  })[0] || targetSize;
}
/**
* calculate bound size
* @function
* @memberof Utils
*/

function utils_esm_calculateBoundSize(size, minSize, maxSize, keepRatio) {
  if (!keepRatio) {
    return size.map(function (value, i) {
      return utils_esm_between(value, minSize[i], maxSize[i]);
    });
  }

  var width = size[0],
      height = size[1]; // width : height = minWidth : minHeight;

  var _a = utils_esm_checkBoundSize(size, minSize, false),
      minWidth = _a[0],
      minHeight = _a[1];

  var _b = utils_esm_checkBoundSize(size, maxSize, true),
      maxWidth = _b[0],
      maxHeight = _b[1];

  if (width < minWidth || height < minHeight) {
    width = minWidth;
    height = minHeight;
  } else if (width > maxWidth || height > maxHeight) {
    width = maxWidth;
    height = maxHeight;
  }

  return [width, height];
}
/**
* Add all the numbers.
* @function
* @memberof Utils
*/

function utils_esm_sum(nums) {
  var length = nums.length;
  var total = 0;

  for (var i = length - 1; i >= 0; --i) {
    total += nums[i];
  }

  return total;
}
/**
* Average all numbers.
* @function
* @memberof Utils
*/

function dist_utils_esm_average(nums) {
  var length = nums.length;
  var total = 0;

  for (var i = length - 1; i >= 0; --i) {
    total += nums[i];
  }

  return length ? total / length : 0;
}
/**
* Get the angle of two points. (0 <= rad < 359)
* @function
* @memberof Utils
*/

function utils_esm_getRad(pos1, pos2) {
  var distX = pos2[0] - pos1[0];
  var distY = pos2[1] - pos1[1];
  var rad = Math.atan2(distY, distX);
  return rad >= 0 ? rad : rad + Math.PI * 2;
}
/**
* Get the average point of all points.
* @function
* @memberof Utils
*/

function utils_esm_getCenterPoint(points) {
  return [0, 1].map(function (i) {
    return dist_utils_esm_average(points.map(function (pos) {
      return pos[i];
    }));
  });
}
/**
* Gets the direction of the shape.
* @function
* @memberof Utils
*/

function utils_esm_getShapeDirection(points) {
  var center = utils_esm_getCenterPoint(points);
  var pos1Rad = utils_esm_getRad(center, points[0]);
  var pos2Rad = utils_esm_getRad(center, points[1]);
  return pos1Rad < pos2Rad && pos2Rad - pos1Rad < Math.PI || pos1Rad > pos2Rad && pos2Rad - pos1Rad < -Math.PI ? 1 : -1;
}
/**
* Get the distance between two points.
* @function
* @memberof Utils
*/

function dist_utils_esm_getDist(a, b) {
  return Math.sqrt(Math.pow((b ? b[0] : 0) - a[0], 2) + Math.pow((b ? b[1] : 0) - a[1], 2));
}
/**
* throttle number depending on the unit.
* @function
* @memberof Utils
*/

function dist_utils_esm_throttle(num, unit) {
  if (!unit) {
    return num;
  }

  return Math.round(num / unit) * unit;
}
/**
* throttle number array depending on the unit.
* @function
* @memberof Utils
*/

function utils_esm_throttleArray(nums, unit) {
  nums.forEach(function (_, i) {
    nums[i] = dist_utils_esm_throttle(nums[i], unit);
  });
  return nums;
}
/**
* @function
* @memberof Utils
*/

function utils_esm_counter(num) {
  var nums = [];

  for (var i = 0; i < num; ++i) {
    nums.push(i);
  }

  return nums;
}
/**
* @function
* @memberof Utils
*/

function utils_esm_replaceOnce(text, fromText, toText) {
  var isOnce = false;
  return text.replace(fromText, function () {
    var args = [];

    for (var _i = 0; _i < arguments.length; _i++) {
      args[_i] = arguments[_i];
    }

    if (isOnce) {
      return args[0];
    }

    isOnce = true;
    return utils_esm_isString(toText) ? toText : toText.apply(void 0, args);
  });
}

/**
* @namespace
* @name Color
*/

/**
* Remove the # from the hex color.
* @memberof Color
* @param {} hex - hex color
* @return {} hex color
* @example
import {cutHex} from "@daybrush/utils";

console.log(cutHex("#000000")) // "000000"
*/

function utils_esm_cutHex(hex) {
  return hex.replace("#", "");
}
/**
* convert hex color to rgb color.
* @memberof Color
* @param {} hex - hex color
* @return {} rgb color
* @example
import {hexToRGBA} from "@daybrush/utils";

console.log(hexToRGBA("#00000005"));
// [0, 0, 0, 1]
console.log(hexToRGBA("#201045"));
// [32, 16, 69, 1]
*/

function utils_esm_hexToRGBA(hex) {
  var h = utils_esm_cutHex(hex);
  var r = parseInt(h.substring(0, 2), 16);
  var g = parseInt(h.substring(2, 4), 16);
  var b = parseInt(h.substring(4, 6), 16);
  var a = parseInt(h.substring(6, 8), 16) / 255;

  if (isNaN(a)) {
    a = 1;
  }

  return [r, g, b, a];
}
/**
* convert 3(or 4)-digit hex color to 6(or 8)-digit hex color.
* @memberof Color
* @param {} hex - 3(or 4)-digit hex color
* @return {} 6(or 8)-digit hex color
* @example
import {toFullHex} from "@daybrush/utils";

console.log(toFullHex("#123")); // "#112233"
console.log(toFullHex("#123a")); // "#112233aa"
*/

function utils_esm_toFullHex(h) {
  var r = h.charAt(1);
  var g = h.charAt(2);
  var b = h.charAt(3);
  var a = h.charAt(4);
  var arr = ["#", r, r, g, g, b, b, a, a];
  return arr.join("");
}
/**
* convert hsl color to rgba color.
* @memberof Color
* @param {} hsl - hsl color(hue: 0 ~ 360, saturation: 0 ~ 1, lightness: 0 ~ 1, alpha: 0 ~ 1)
* @return {} rgba color
* @example
import {hslToRGBA} from "@daybrush/utils";

console.log(hslToRGBA([150, 0.5, 0.4]));
// [51, 153, 102, 1]
*/

function utils_esm_hslToRGBA(hsl) {
  var _a;

  var h = hsl[0];
  var s = hsl[1];
  var l = hsl[2];

  if (h < 0) {
    h += Math.floor((Math.abs(h) + 360) / 360) * 360;
  }

  h %= 360;
  var c = (1 - Math.abs(2 * l - 1)) * s;
  var x = c * (1 - Math.abs(h / 60 % 2 - 1));
  var m = l - c / 2;
  var rgb;

  if (h < 60) {
    rgb = [c, x, 0];
  } else if (h < 120) {
    rgb = [x, c, 0];
  } else if (h < 180) {
    rgb = [0, c, x];
  } else if (h < 240) {
    rgb = [0, x, c];
  } else if (h < 300) {
    rgb = [x, 0, c];
  } else if (h < 360) {
    rgb = [c, 0, x];
  } else {
    rgb = [0, 0, 0];
  }

  return [Math.round((rgb[0] + m) * 255), Math.round((rgb[1] + m) * 255), Math.round((rgb[2] + m) * 255), (_a = hsl[3]) !== null && _a !== void 0 ? _a : 1];
}
/**
* convert string to rgba color.
* @memberof Color
* @param {} - 3-hex(#000), 4-hex(#0000) 6-hex(#000000), 8-hex(#00000000) or RGB(A), or HSL(A)
* @return {} rgba color
* @example
import {stringToRGBA} from "@daybrush/utils";

console.log(stringToRGBA("#000000")); // [0, 0, 0, 1]
console.log(stringToRGBA("rgb(100, 100, 100)")); // [100, 100, 100, 1]
console.log(stringToRGBA("hsl(150, 0.5, 0.4)")); // [51, 153, 102, 1]
*/

function utils_esm_stringToRGBA(color) {
  if (color.charAt(0) === "#") {
    if (color.length === 4 || color.length === 5) {
      return utils_esm_hexToRGBA(utils_esm_toFullHex(color));
    } else {
      return utils_esm_hexToRGBA(color);
    }
  } else if (color.indexOf("(") !== -1) {
    // in bracket.
    var _a = utils_esm_splitBracket(color),
        prefix = _a.prefix,
        value = _a.value;

    if (!prefix || !value) {
      return undefined;
    }

    var arr = utils_esm_splitComma(value);
    var colorArr = [0, 0, 0, 1];
    var length = arr.length;

    switch (prefix) {
      case utils_esm_RGB:
      case utils_esm_RGBA:
        for (var i = 0; i < length; ++i) {
          colorArr[i] = parseFloat(arr[i]);
        }

        return colorArr;

      case utils_esm_HSL:
      case utils_esm_HSLA:
        for (var i = 0; i < length; ++i) {
          if (arr[i].indexOf("%") !== -1) {
            colorArr[i] = parseFloat(arr[i]) / 100;
          } else {
            colorArr[i] = parseFloat(arr[i]);
          }
        } // hsl, hsla to rgba


        return utils_esm_hslToRGBA(colorArr);
    }
  }

  return undefined;
}

/**
 * Returns all element descendants of node that
 * match selectors.
 */

/**
 * Checks if the specified class value exists in the element's class attribute.
 * @memberof DOM
 * @param - A DOMString containing one or more selectors to match
 * @param - If multi is true, a DOMString containing one or more selectors to match against.
 * @example
import {$} from "@daybrush/utils";

console.log($("div")); // div element
console.log($("div", true)); // [div, div] elements
*/

function utils_esm_$(selectors, multi) {
  return multi ? utils_esm_doc.querySelectorAll(selectors) : utils_esm_doc.querySelector(selectors);
}
/**
* Checks if the specified class value exists in the element's class attribute.
* @memberof DOM
* @param element - target
* @param className - the class name to search
* @return {boolean} return false if the class is not found.
* @example
import {hasClass} from "@daybrush/utils";

console.log(hasClass(element, "start")); // true or false
*/

function utils_esm_hasClass(element, className) {
  if (element.classList) {
    return element.classList.contains(className);
  }

  return !!element.className.match(new RegExp("(\\s|^)" + className + "(\\s|$)"));
}
/**
* Add the specified class value. If these classe already exist in the element's class attribute they are ignored.
* @memberof DOM
* @param element - target
* @param className - the class name to add
* @example
import {addClass} from "@daybrush/utils";

addClass(element, "start");
*/

function utils_esm_addClass(element, className) {
  if (element.classList) {
    element.classList.add(className);
  } else {
    element.className += " " + className;
  }
}
/**
* Removes the specified class value.
* @memberof DOM
* @param element - target
* @param className - the class name to remove
* @example
import {removeClass} from "@daybrush/utils";

removeClass(element, "start");
*/

function utils_esm_removeClass(element, className) {
  if (element.classList) {
    element.classList.remove(className);
  } else {
    var reg = new RegExp("(\\s|^)" + className + "(\\s|$)");
    element.className = element.className.replace(reg, " ");
  }
}
/**
* Gets the CSS properties from the element.
* @memberof DOM
* @param elements - elements
* @param properites - the CSS properties
* @return returns CSS properties and values.
* @example
import {fromCSS} from "@daybrush/utils";

console.log(fromCSS(element, ["left", "opacity", "top"])); // {"left": "10px", "opacity": 1, "top": "10px"}
*/

function utils_esm_fromCSS(elements, properties) {
  if (!elements || !properties || !properties.length) {
    return {};
  }

  var element;

  if (elements instanceof Element) {
    element = elements;
  } else if (elements.length) {
    element = elements[0];
  } else {
    return {};
  }

  var cssObject = {};
  var styles = window.getComputedStyle(element);
  var length = properties.length;

  for (var i = 0; i < length; ++i) {
    cssObject[properties[i]] = styles[properties[i]];
  }

  return cssObject;
}
/**
* Sets up a function that will be called whenever the specified event is delivered to the target
* @memberof DOM
* @param - event target
* @param - A case-sensitive string representing the event type to listen for.
* @param - The object which receives a notification (an object that implements the Event interface) when an event of the specified type occurs
* @param - An options object that specifies characteristics about the event listener.
* @example
import {addEvent} from "@daybrush/utils";

addEvent(el, "click", e => {
  console.log(e);
});
*/

function utils_esm_addEvent(el, type, listener, options) {
  el.addEventListener(type, listener, options);
}
/**
* removes from the EventTarget an event listener previously registered with EventTarget.addEventListener()
* @memberof DOM
* @param - event target
* @param - A case-sensitive string representing the event type to listen for.
* @param - The EventListener function of the event handler to remove from the event target.
* @param - An options object that specifies characteristics about the event listener.
* @example
import {addEvent, removeEvent} from "@daybrush/utils";
const listener = e => {
  console.log(e);
};
addEvent(el, "click", listener);
removeEvent(el, "click", listener);
*/

function utils_esm_removeEvent(el, type, listener, options) {
  el.removeEventListener(type, listener, options);
}


//# sourceMappingURL=utils.esm.js.map

;// CONCATENATED MODULE: ./node_modules/@scena/dragscroll/dist/dragscroll.esm.js
/*
Copyright (c) 2019 Daybrush
name: @scena/dragscroll
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/dragscroll.git
version: 1.1.1
*/



/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

/* global Reflect, Promise */
var dragscroll_esm_extendStatics = function (d, b) {
  dragscroll_esm_extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (d, b) {
    d.__proto__ = b;
  } || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
  };

  return dragscroll_esm_extendStatics(d, b);
};

function dragscroll_esm_extends(d, b) {
  dragscroll_esm_extendStatics(d, b);

  function __() {
    this.constructor = d;
  }

  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
var dragscroll_esm_assign = function () {
  dragscroll_esm_assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return dragscroll_esm_assign.apply(this, arguments);
};

function getDefaultScrollPosition(e) {
  var container = e.container;

  if (container === document.body) {
    return [container.scrollLeft || document.documentElement.scrollLeft, container.scrollTop || document.documentElement.scrollTop];
  }

  return [container.scrollLeft, container.scrollTop];
}

var DragScroll =
/*#__PURE__*/
function (_super) {
  dragscroll_esm_extends(DragScroll, _super);

  function DragScroll() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this._startRect = null;
    _this._startPos = [];
    _this._prevTime = 0;
    _this._timer = 0;
    _this._prevScrollPos = [0, 0];
    _this._isWait = false;
    return _this;
  }

  var __proto = DragScroll.prototype;

  __proto.dragStart = function (e, options) {
    var container = options.container;
    var top = 0;
    var left = 0;
    var width = 0;
    var height = 0;

    if (container === document.body) {
      width = window.innerWidth;
      height = window.innerHeight;
    } else {
      var rect = container.getBoundingClientRect();
      top = rect.top;
      left = rect.left;
      width = rect.width;
      height = rect.height;
    }

    this._startPos = [e.clientX, e.clientY];
    this._startRect = {
      top: top,
      left: left,
      width: width,
      height: height
    };
    this._prevScrollPos = this._getScrollPosition([0, 0], options);
  };

  __proto.drag = function (e, options) {
    var clientX = e.clientX,
        clientY = e.clientY;
    var _a = options.threshold,
        threshold = _a === void 0 ? 0 : _a;

    var _b = this,
        _startRect = _b._startRect,
        _startPos = _b._startPos;

    var direction = [0, 0];

    if (_startRect.top > clientY - threshold) {
      if (_startPos[1] > _startRect.top || clientY < _startPos[1]) {
        direction[1] = -1;
      }
    } else if (_startRect.top + _startRect.height < clientY + threshold) {
      if (_startPos[1] < _startRect.top + _startRect.height || clientY > _startPos[1]) {
        direction[1] = 1;
      }
    }

    if (_startRect.left > clientX - threshold) {
      if (_startPos[0] > _startRect.left || clientX < _startPos[0]) {
        direction[0] = -1;
      }
    } else if (_startRect.left + _startRect.width < clientX + threshold) {
      if (_startPos[0] < _startRect.left + _startRect.width || clientX > _startPos[0]) {
        direction[0] = 1;
      }
    }

    clearTimeout(this._timer);

    if (!direction[0] && !direction[1]) {
      return false;
    }

    return this._continueDrag(dragscroll_esm_assign(dragscroll_esm_assign({}, options), {
      direction: direction,
      inputEvent: e,
      isDrag: true
    }));
  };

  __proto.checkScroll = function (options) {
    var _this = this;

    if (this._isWait) {
      return false;
    }

    var _a = options.prevScrollPos,
        prevScrollPos = _a === void 0 ? this._prevScrollPos : _a,
        direction = options.direction,
        _b = options.throttleTime,
        throttleTime = _b === void 0 ? 0 : _b,
        inputEvent = options.inputEvent,
        isDrag = options.isDrag;

    var nextScrollPos = this._getScrollPosition(direction || [0, 0], options);

    var offsetX = nextScrollPos[0] - prevScrollPos[0];
    var offsetY = nextScrollPos[1] - prevScrollPos[1];
    var nextDirection = direction || [offsetX ? Math.abs(offsetX) / offsetX : 0, offsetY ? Math.abs(offsetY) / offsetY : 0];
    this._prevScrollPos = nextScrollPos;

    if (!offsetX && !offsetY) {
      return false;
    }

    this.trigger("move", {
      offsetX: nextDirection[0] ? offsetX : 0,
      offsetY: nextDirection[1] ? offsetY : 0,
      inputEvent: inputEvent
    });

    if (throttleTime && isDrag) {
      this._timer = window.setTimeout(function () {
        _this._continueDrag(options);
      }, throttleTime);
    }

    return true;
  };

  __proto.dragEnd = function () {
    clearTimeout(this._timer);
  };

  __proto._getScrollPosition = function (direction, options) {
    var container = options.container,
        _a = options.getScrollPosition,
        getScrollPosition = _a === void 0 ? getDefaultScrollPosition : _a;
    return getScrollPosition({
      container: container,
      direction: direction
    });
  };

  __proto._continueDrag = function (options) {
    var _this = this;

    var container = options.container,
        direction = options.direction,
        throttleTime = options.throttleTime,
        useScroll = options.useScroll,
        isDrag = options.isDrag,
        inputEvent = options.inputEvent;

    if (isDrag && this._isWait) {
      return;
    }

    var nowTime = utils_esm_now();
    var distTime = Math.max(throttleTime + this._prevTime - nowTime, 0);

    if (distTime > 0) {
      this._timer = window.setTimeout(function () {
        _this._continueDrag(options);
      }, distTime);
      return false;
    }

    this._prevTime = nowTime;

    var prevScrollPos = this._getScrollPosition(direction, options);

    this._prevScrollPos = prevScrollPos;

    if (isDrag) {
      this._isWait = true;
    }

    this.trigger("scroll", {
      container: container,
      direction: direction,
      inputEvent: inputEvent
    });
    this._isWait = false;
    return useScroll || this.checkScroll(dragscroll_esm_assign(dragscroll_esm_assign({}, options), {
      prevScrollPos: prevScrollPos,
      direction: direction,
      inputEvent: inputEvent
    }));
  };

  return DragScroll;
}(event_emitter_esm);

/* harmony default export */ const dragscroll_esm = (DragScroll);
//# sourceMappingURL=dragscroll.esm.js.map

;// CONCATENATED MODULE: ./node_modules/gesto/dist/gesto.esm.js
/*
Copyright (c) 2019 Daybrush
name: gesto
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/gesto.git
version: 1.9.0
*/



/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

/* global Reflect, Promise */
var gesto_esm_extendStatics = function (d, b) {
  gesto_esm_extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (d, b) {
    d.__proto__ = b;
  } || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
  };

  return gesto_esm_extendStatics(d, b);
};

function gesto_esm_extends(d, b) {
  gesto_esm_extendStatics(d, b);

  function __() {
    this.constructor = d;
  }

  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
var gesto_esm_assign = function () {
  gesto_esm_assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return gesto_esm_assign.apply(this, arguments);
};

function gesto_esm_getRad(pos1, pos2) {
  var distX = pos2[0] - pos1[0];
  var distY = pos2[1] - pos1[1];
  var rad = Math.atan2(distY, distX);
  return rad >= 0 ? rad : rad + Math.PI * 2;
}
function getRotatiion(touches) {
  return gesto_esm_getRad([touches[0].clientX, touches[0].clientY], [touches[1].clientX, touches[1].clientY]) / Math.PI * 180;
}
function isMultiTouch(e) {
  return e.touches && e.touches.length >= 2;
}
function getEventClients(e) {
  if (!e) {
    return [];
  }

  if (e.touches) {
    return getClients(e.touches);
  } else {
    return [getClient(e)];
  }
}
function getPosition(clients, prevClients, startClients) {
  var length = startClients.length;

  var _a = getAverageClient(clients, length),
      clientX = _a.clientX,
      clientY = _a.clientY,
      originalClientX = _a.originalClientX,
      originalClientY = _a.originalClientY;

  var _b = getAverageClient(prevClients, length),
      prevX = _b.clientX,
      prevY = _b.clientY;

  var _c = getAverageClient(startClients, length),
      startX = _c.clientX,
      startY = _c.clientY;

  var deltaX = clientX - prevX;
  var deltaY = clientY - prevY;
  var distX = clientX - startX;
  var distY = clientY - startY;
  return {
    clientX: originalClientX,
    clientY: originalClientY,
    deltaX: deltaX,
    deltaY: deltaY,
    distX: distX,
    distY: distY
  };
}
function gesto_esm_getDist(clients) {
  return Math.sqrt(Math.pow(clients[0].clientX - clients[1].clientX, 2) + Math.pow(clients[0].clientY - clients[1].clientY, 2));
}
function getClients(touches) {
  var length = Math.min(touches.length, 2);
  var clients = [];

  for (var i = 0; i < length; ++i) {
    clients.push(getClient(touches[i]));
  }

  return clients;
}
function getClient(e) {
  return {
    clientX: e.clientX,
    clientY: e.clientY
  };
}
function getAverageClient(clients, length) {
  if (length === void 0) {
    length = clients.length;
  }

  var sumClient = {
    clientX: 0,
    clientY: 0,
    originalClientX: 0,
    originalClientY: 0
  };

  for (var i = 0; i < length; ++i) {
    var client = clients[i];
    sumClient.originalClientX += "originalClientX" in client ? client.originalClientX : client.clientX;
    sumClient.originalClientY += "originalClientY" in client ? client.originalClientY : client.clientY;
    sumClient.clientX += client.clientX;
    sumClient.clientY += client.clientY;
  }

  if (!length) {
    return sumClient;
  }

  return {
    clientX: sumClient.clientX / length,
    clientY: sumClient.clientY / length,
    originalClientX: sumClient.originalClientX / length,
    originalClientY: sumClient.originalClientY / length
  };
}

var ClientStore =
/*#__PURE__*/
function () {
  function ClientStore(clients) {
    this.prevClients = [];
    this.startClients = [];
    this.movement = 0;
    this.length = 0;
    this.startClients = clients;
    this.prevClients = clients;
    this.length = clients.length;
  }

  var __proto = ClientStore.prototype;

  __proto.getAngle = function (clients) {
    if (clients === void 0) {
      clients = this.prevClients;
    }

    return getRotatiion(clients);
  };

  __proto.getRotation = function (clients) {
    if (clients === void 0) {
      clients = this.prevClients;
    }

    return getRotatiion(clients) - getRotatiion(this.startClients);
  };

  __proto.getPosition = function (clients, isAdd) {
    if (clients === void 0) {
      clients = this.prevClients;
    }

    var position = getPosition(clients || this.prevClients, this.prevClients, this.startClients);
    var deltaX = position.deltaX,
        deltaY = position.deltaY;
    this.movement += Math.sqrt(deltaX * deltaX + deltaY * deltaY);
    this.prevClients = clients;
    return position;
  };

  __proto.getPositions = function (clients) {
    if (clients === void 0) {
      clients = this.prevClients;
    }

    var prevClients = this.prevClients;
    return this.startClients.map(function (startClient, i) {
      return getPosition([clients[i]], [prevClients[i]], [startClient]);
    });
  };

  __proto.getMovement = function (clients) {
    var movement = this.movement;

    if (!clients) {
      return movement;
    }

    var currentClient = getAverageClient(clients, this.length);
    var prevClient = getAverageClient(this.prevClients, this.length);
    var deltaX = currentClient.clientX - prevClient.clientX;
    var deltaY = currentClient.clientY - prevClient.clientY;
    return Math.sqrt(deltaX * deltaX + deltaY * deltaY) + movement;
  };

  __proto.getDistance = function (clients) {
    if (clients === void 0) {
      clients = this.prevClients;
    }

    return gesto_esm_getDist(clients);
  };

  __proto.getScale = function (clients) {
    if (clients === void 0) {
      clients = this.prevClients;
    }

    return gesto_esm_getDist(clients) / gesto_esm_getDist(this.startClients);
  };

  __proto.move = function (deltaX, deltaY) {
    this.startClients.forEach(function (client) {
      client.clientX -= deltaX;
      client.clientY -= deltaY;
    });
  };

  return ClientStore;
}();

var INPUT_TAGNAMES = ["textarea", "input"];
/**
 * You can set up drag, pinch events in any browser.
 */

var Gesto =
/*#__PURE__*/
function (_super) {
  gesto_esm_extends(Gesto, _super);
  /**
   *
   */


  function Gesto(targets, options) {
    if (options === void 0) {
      options = {};
    }

    var _this = _super.call(this) || this;

    _this.options = {};
    _this.flag = false;
    _this.pinchFlag = false;
    _this.datas = {};
    _this.isDrag = false;
    _this.isPinch = false;
    _this.isMouse = false;
    _this.isTouch = false;
    _this.clientStores = [];
    _this.targets = [];
    _this.prevTime = 0;
    _this.doubleFlag = false;
    _this._dragFlag = false;

    _this.onDragStart = function (e, isTrusted) {
      if (isTrusted === void 0) {
        isTrusted = true;
      }

      if (!_this.flag && e.cancelable === false) {
        return;
      }

      var _a = _this.options,
          container = _a.container,
          pinchOutside = _a.pinchOutside,
          preventWheelClick = _a.preventWheelClick,
          preventRightClick = _a.preventRightClick,
          preventDefault = _a.preventDefault,
          checkInput = _a.checkInput;
      var isTouch = _this.isTouch;
      var isDragStart = !_this.flag;

      if (preventWheelClick && (e.which === 2 || e.button === 1) || preventRightClick && (e.which === 3 || e.button === 2)) {
        _this.initDrag();

        return false;
      }

      if (isDragStart) {
        var activeElement = document.activeElement;
        var target = e.target;
        var tagName = target.tagName.toLowerCase();
        var hasInput = INPUT_TAGNAMES.indexOf(tagName) > -1;
        var hasContentEditable = target.isContentEditable;

        if (hasInput || hasContentEditable) {
          if (checkInput || activeElement === target) {
            // force false or already focused.
            return false;
          } // no focus


          if (activeElement && hasContentEditable && activeElement.isContentEditable && activeElement.contains(target)) {
            return false;
          }
        } else if ((preventDefault || e.type === "touchstart") && activeElement) {
          var activeTagName = activeElement.tagName;

          if (activeElement.isContentEditable || INPUT_TAGNAMES.indexOf(activeTagName) > -1) {
            activeElement.blur();
          }
        }

        _this.clientStores = [new ClientStore(getEventClients(e))];
        _this.flag = true;
        _this.isDrag = false;
        _this._dragFlag = true;
        _this.datas = {};
        _this.doubleFlag = now() - _this.prevTime < 200;

        var result = _this.emit("dragStart", gesto_esm_assign(gesto_esm_assign({
          datas: _this.datas,
          inputEvent: e,
          isTrusted: isTrusted,
          isDouble: _this.doubleFlag
        }, _this.getCurrentStore().getPosition()), {
          preventDefault: function () {
            e.preventDefault();
          },
          preventDrag: function () {
            _this._dragFlag = false;
          }
        }));

        if (result === false) {
          _this.initDrag();
        }

        _this.flag && preventDefault && e.preventDefault();
      }

      if (!_this.flag) {
        return false;
      }

      var timer = 0;

      if (isDragStart && isTouch && pinchOutside) {
        timer = setTimeout(function () {
          addEvent(container, "touchstart", _this.onDragStart, {
            passive: false
          });
        });
      }

      if (!isDragStart && isTouch && pinchOutside) {
        removeEvent(container, "touchstart", _this.onDragStart);
      }

      if (_this.flag && isMultiTouch(e)) {
        clearTimeout(timer);

        if (isDragStart && e.touches.length !== e.changedTouches.length) {
          return;
        }

        if (!_this.pinchFlag) {
          _this.onPinchStart(e);
        }
      }
    };

    _this.onDrag = function (e, isScroll) {
      if (!_this.flag) {
        return;
      }

      var clients = getEventClients(e);

      var result = _this.moveClients(clients, e, false);

      if (_this._dragFlag) {
        if (_this.pinchFlag || result.deltaX || result.deltaY) {
          var dragResult = _this.emit("drag", gesto_esm_assign(gesto_esm_assign({}, result), {
            isScroll: !!isScroll,
            inputEvent: e
          }));

          if (dragResult === false) {
            _this.stop();

            return;
          }
        }

        if (_this.pinchFlag) {
          _this.onPinch(e, clients);
        }
      }

      _this.getCurrentStore().getPosition(clients, true);
    };

    _this.onDragEnd = function (e) {
      if (!_this.flag) {
        return;
      }

      var _a = _this.options,
          pinchOutside = _a.pinchOutside,
          container = _a.container;

      if (_this.isTouch && pinchOutside) {
        removeEvent(container, "touchstart", _this.onDragStart);
      }

      if (_this.pinchFlag) {
        _this.onPinchEnd(e);
      }

      var clients = (e === null || e === void 0 ? void 0 : e.touches) ? getEventClients(e) : [];
      var clientsLength = clients.length;

      if (clientsLength === 0 || !_this.options.keepDragging) {
        _this.flag = false;
      } else {
        _this._addStore(new ClientStore(clients));
      }

      var position = _this._getPosition();

      var currentTime = now();
      var isDouble = !_this.isDrag && _this.doubleFlag;
      _this.prevTime = _this.isDrag || isDouble ? 0 : currentTime;

      if (!_this.flag) {
        _this.emit("dragEnd", gesto_esm_assign({
          datas: _this.datas,
          isDouble: isDouble,
          isDrag: _this.isDrag,
          isClick: !_this.isDrag,
          inputEvent: e
        }, position));

        _this.clientStores = [];
      }
    };

    _this.onBlur = function () {
      _this.onDragEnd();
    };

    var elements = [].concat(targets);
    _this.options = gesto_esm_assign({
      checkInput: false,
      container: elements.length > 1 ? window : elements[0],
      preventRightClick: true,
      preventWheelClick: true,
      preventDefault: true,
      checkWindowBlur: false,
      keepDragging: false,
      pinchThreshold: 0,
      events: ["touch", "mouse"]
    }, options);
    var _a = _this.options,
        container = _a.container,
        events = _a.events,
        checkWindowBlur = _a.checkWindowBlur;
    _this.isTouch = events.indexOf("touch") > -1;
    _this.isMouse = events.indexOf("mouse") > -1;
    _this.targets = elements;

    if (_this.isMouse) {
      elements.forEach(function (el) {
        addEvent(el, "mousedown", _this.onDragStart);
      });
      addEvent(container, "mousemove", _this.onDrag);
      addEvent(container, "mouseup", _this.onDragEnd);
      addEvent(container, "contextmenu", _this.onDragEnd);
    }

    if (checkWindowBlur) {
      addEvent(window, "blur", _this.onBlur);
    }

    if (_this.isTouch) {
      var passive_1 = {
        passive: false
      };
      elements.forEach(function (el) {
        addEvent(el, "touchstart", _this.onDragStart, passive_1);
      });
      addEvent(container, "touchmove", _this.onDrag, passive_1);
      addEvent(container, "touchend", _this.onDragEnd, passive_1);
      addEvent(container, "touchcancel", _this.onDragEnd, passive_1);
    }

    return _this;
  }
  /**
   * Stop Gesto's drag events.
   */


  var __proto = Gesto.prototype;

  __proto.stop = function () {
    this.isDrag = false;
    this.flag = false;
    this.clientStores = [];
    this.datas = {};
  };
  /**
   * The total moved distance
   */


  __proto.getMovement = function (clients) {
    return this.getCurrentStore().getMovement(clients) + this.clientStores.slice(1).reduce(function (prev, cur) {
      return prev + cur.movement;
    }, 0);
  };
  /**
   * Whether to drag
   */


  __proto.isDragging = function () {
    return this.isDrag;
  };
  /**
   * Whether to start drag
   */


  __proto.isFlag = function () {
    return this.flag;
  };
  /**
   * Whether to start pinch
   */


  __proto.isPinchFlag = function () {
    return this.pinchFlag;
  };
  /**
  * Whether to start double click
  */


  __proto.isDoubleFlag = function () {
    return this.doubleFlag;
  };
  /**
   * Whether to pinch
   */


  __proto.isPinching = function () {
    return this.isPinch;
  };
  /**
   * If a scroll event occurs, it is corrected by the scroll distance.
   */


  __proto.scrollBy = function (deltaX, deltaY, e, isCallDrag) {
    if (isCallDrag === void 0) {
      isCallDrag = true;
    }

    if (!this.flag) {
      return;
    }

    this.clientStores[0].move(deltaX, deltaY);
    isCallDrag && this.onDrag(e, true);
  };
  /**
   * Create a virtual drag event.
   */


  __proto.move = function (_a, inputEvent) {
    var deltaX = _a[0],
        deltaY = _a[1];
    var store = this.getCurrentStore();
    var nextClients = store.prevClients;
    return this.moveClients(nextClients.map(function (_a) {
      var clientX = _a.clientX,
          clientY = _a.clientY;
      return {
        clientX: clientX + deltaX,
        clientY: clientY + deltaY,
        originalClientX: clientX,
        originalClientY: clientY
      };
    }), inputEvent, true);
  };
  /**
   * The dragStart event is triggered by an external event.
   */


  __proto.triggerDragStart = function (e) {
    this.onDragStart(e, false);
  };
  /**
   * Set the event data while dragging.
   */


  __proto.setEventDatas = function (datas) {
    var currentDatas = this.datas;

    for (var name in datas) {
      currentDatas[name] = datas[name];
    }

    return this;
  };
  /**
   * Get the current event state while dragging.
   */


  __proto.getCurrentEvent = function (inputEvent) {
    return gesto_esm_assign(gesto_esm_assign({
      datas: this.datas
    }, this._getPosition()), {
      movement: this.getMovement(),
      isDrag: this.isDrag,
      isPinch: this.isPinch,
      isScroll: false,
      inputEvent: inputEvent
    });
  };
  /**
   * Get & Set the event data while dragging.
   */


  __proto.getEventDatas = function () {
    return this.datas;
  };
  /**
   * Unset Gesto
   */


  __proto.unset = function () {
    var _this = this;

    var targets = this.targets;
    var container = this.options.container;
    this.off();
    removeEvent(window, "blur", this.onBlur);

    if (this.isMouse) {
      targets.forEach(function (target) {
        removeEvent(target, "mousedown", _this.onDragStart);
      });
      removeEvent(container, "mousemove", this.onDrag);
      removeEvent(container, "mouseup", this.onDragEnd);
      removeEvent(container, "contextmenu", this.onDragEnd);
    }

    if (this.isTouch) {
      targets.forEach(function (target) {
        removeEvent(target, "touchstart", _this.onDragStart);
      });
      removeEvent(container, "touchstart", this.onDragStart);
      removeEvent(container, "touchmove", this.onDrag);
      removeEvent(container, "touchend", this.onDragEnd);
      removeEvent(container, "touchcancel", this.onDragEnd);
    }
  };

  __proto.onPinchStart = function (e) {
    var pinchThreshold = this.options.pinchThreshold;

    if (this.isDrag && this.getMovement() > pinchThreshold) {
      return;
    }

    var store = new ClientStore(getEventClients(e));
    this.pinchFlag = true;

    this._addStore(store);

    var result = this.emit("pinchStart", gesto_esm_assign(gesto_esm_assign({
      datas: this.datas,
      angle: store.getAngle(),
      touches: this.getCurrentStore().getPositions()
    }, store.getPosition()), {
      inputEvent: e
    }));

    if (result === false) {
      this.pinchFlag = false;
    }
  };

  __proto.onPinch = function (e, clients) {
    if (!this.flag || !this.pinchFlag || clients.length < 2) {
      return;
    }

    var store = this.getCurrentStore();
    this.isPinch = true;
    this.emit("pinch", gesto_esm_assign(gesto_esm_assign({
      datas: this.datas,
      movement: this.getMovement(clients),
      angle: store.getAngle(clients),
      rotation: store.getRotation(clients),
      touches: store.getPositions(clients),
      scale: store.getScale(clients),
      distance: store.getDistance(clients)
    }, store.getPosition(clients)), {
      inputEvent: e
    }));
  };

  __proto.onPinchEnd = function (e) {
    if (!this.pinchFlag) {
      return;
    }

    var isPinch = this.isPinch;
    this.isPinch = false;
    this.pinchFlag = false;
    var store = this.getCurrentStore();
    this.emit("pinchEnd", gesto_esm_assign(gesto_esm_assign({
      datas: this.datas,
      isPinch: isPinch,
      touches: store.getPositions()
    }, store.getPosition()), {
      inputEvent: e
    }));
  };

  __proto.initDrag = function () {
    this.clientStores = [];
    this.pinchFlag = false;
    this.doubleFlag = false;
    this.prevTime = 0;
    this.flag = false;
  };

  __proto.getCurrentStore = function () {
    return this.clientStores[0];
  };

  __proto.moveClients = function (clients, inputEvent, isAdd) {
    var position = this._getPosition(clients, isAdd);

    if (position.deltaX || position.deltaY) {
      this.isDrag = true;
    }

    return gesto_esm_assign(gesto_esm_assign({
      datas: this.datas
    }, position), {
      movement: this.getMovement(clients),
      isDrag: this.isDrag,
      isPinch: this.isPinch,
      isScroll: false,
      inputEvent: inputEvent
    });
  };

  __proto._addStore = function (store) {
    this.clientStores.splice(0, 0, store);
  };

  __proto._getPosition = function (clients, isAdd) {
    var store = this.getCurrentStore();
    var position = store.getPosition(clients, isAdd);

    var _a = this.clientStores.slice(1).reduce(function (prev, cur) {
      var storePosition = cur.getPosition();
      prev.distX += storePosition.distX;
      prev.distY += storePosition.distY;
      return prev;
    }, position),
        distX = _a.distX,
        distY = _a.distY;

    return gesto_esm_assign(gesto_esm_assign({}, position), {
      distX: distX,
      distY: distY
    });
  };

  return Gesto;
}(event_emitter_esm);

/* harmony default export */ const gesto_esm = (Gesto);
//# sourceMappingURL=gesto.esm.js.map

;// CONCATENATED MODULE: ./node_modules/css-styled/dist/styled.esm.js
/*
Copyright (c) 2019 Daybrush
name: css-styled
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/css-styled.git
version: 1.0.0
*/


function styled_esm_hash(str) {
  var hash = 5381,
      i    = str.length;

  while(i) {
    hash = (hash * 33) ^ str.charCodeAt(--i);
  }

  /* JavaScript does bitwise operations (like XOR, above) on 32-bit signed
   * integers. Since we want the results to be always positive, convert the
   * signed int to an unsigned by doing an unsigned bitshift. */
  return hash >>> 0;
}

var stringHash = styled_esm_hash;

function getHash(str) {
  return stringHash(str).toString(36);
}
function getShadowRoot(parentElement) {
  if (parentElement && parentElement.getRootNode) {
    var rootNode = parentElement.getRootNode();

    if (rootNode.nodeType === 11) {
      return rootNode;
    }
  }

  return;
}
function replaceStyle(className, css, options) {
  if (options.original) {
    return css;
  }

  return css.replace(/([^};{\s}][^};{]*|^\s*){/mg, function (_, selector) {
    var trimmedSelector = selector.trim();
    return (trimmedSelector ? splitComma(trimmedSelector) : [""]).map(function (subSelector) {
      var trimmedSubSelector = subSelector.trim();

      if (trimmedSubSelector.indexOf("@") === 0) {
        return trimmedSubSelector;
      } else if (trimmedSubSelector.indexOf(":global") > -1) {
        return trimmedSubSelector.replace(/\:global/g, "");
      } else if (trimmedSubSelector.indexOf(":host") > -1) {
        return "" + trimmedSubSelector.replace(/\:host/g, "." + className);
      } else if (trimmedSubSelector) {
        return "." + className + " " + trimmedSubSelector;
      } else {
        return "." + className;
      }
    }).join(", ") + " {";
  });
}
function injectStyle(className, css, options, shadowRoot) {
  var style = document.createElement("style");
  style.setAttribute("type", "text/css");
  style.setAttribute("data-styled-id", className);

  if (options.nonce) {
    style.setAttribute("nonce", options.nonce);
  }

  style.innerHTML = replaceStyle(className, css, options);
  (shadowRoot || document.head || document.body).appendChild(style);
  return style;
}

/**
 * Create an styled object that can be defined and inserted into the css.
 * @param - css styles
 */

function styled(css) {
  var injectClassName = "rCS" + getHash(css);
  var injectCount = 0;
  var injectElement;
  return {
    className: injectClassName,
    inject: function (el, options) {
      if (options === void 0) {
        options = {};
      }

      var shadowRoot = getShadowRoot(el);
      var firstMount = injectCount === 0;
      var styleElement;

      if (shadowRoot || firstMount) {
        styleElement = injectStyle(injectClassName, css, options, shadowRoot);
      }

      if (firstMount) {
        injectElement = styleElement;
      }

      if (!shadowRoot) {
        ++injectCount;
      }

      return {
        destroy: function () {
          if (shadowRoot) {
            el.removeChild(styleElement);
            styleElement = null;
          } else {
            if (injectCount > 0) {
              --injectCount;
            }

            if (injectCount === 0 && injectElement) {
              injectElement.parentNode.removeChild(injectElement);
              injectElement = null;
            }
          }
        }
      };
    }
  };
}

/* harmony default export */ const styled_esm = (styled);
//# sourceMappingURL=styled.esm.js.map

;// CONCATENATED MODULE: ./node_modules/react-compat-css-styled/dist/styled.esm.js
/*
Copyright (c) Daybrush
name: react-compat-css-styled
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/css-styled.git
version: 1.0.8
*/




/*
Copyright (c) 2019 Daybrush
name: react-css-styled
license: MIT
author: Daybrush
repository: https://github.com/daybrush/css-styled/tree/master/packages/react-css-styled
version: 1.0.3
*/

/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

/* global Reflect, Promise */
var styled_esm_extendStatics = function (d, b) {
  styled_esm_extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (d, b) {
    d.__proto__ = b;
  } || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
  };

  return styled_esm_extendStatics(d, b);
};

function styled_esm_extends(d, b) {
  styled_esm_extendStatics(d, b);

  function __() {
    this.constructor = d;
  }

  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
var styled_esm_assign = function () {
  styled_esm_assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return styled_esm_assign.apply(this, arguments);
};
function styled_esm_rest(s, e) {
  var t = {};

  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];

  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}

var StyledElement =
/*#__PURE__*/
function (_super) {
  styled_esm_extends(StyledElement, _super);

  function StyledElement() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.injectResult = null;
    _this.tag = "div";
    return _this;
  }

  var __proto = StyledElement.prototype;

  __proto.render = function () {
    var _a = this.props,
        _b = _a.className,
        className = _b === void 0 ? "" : _b,
        cspNonce = _a.cspNonce,
        portalContainer = _a.portalContainer,
        attributes = styled_esm_rest(_a, ["className", "cspNonce", "portalContainer"]);

    var cssId = this.injector.className;
    var Tag = this.tag;
    var portalAttributes = {};

    if ((compat_esm_version || "").indexOf("simple") > -1 && portalContainer) {
      portalAttributes = {
        portalContainer: portalContainer
      };
    }

    return createElement(Tag, styled_esm_assign({
      "ref": ref(this, "element"),
      "data-styled-id": cssId,
      "className": className + " " + cssId
    }, portalAttributes, attributes));
  };

  __proto.componentDidMount = function () {
    this.injectResult = this.injector.inject(this.element, {
      nonce: this.props.cspNonce
    });
  };

  __proto.componentWillUnmount = function () {
    this.injectResult.destroy();
    this.injectResult = null;
  };

  __proto.getElement = function () {
    return this.element;
  };

  return StyledElement;
}(Component);

function styled_esm_styled(tag, css) {
  var injector = styled_esm(css);
  return (
    /*#__PURE__*/
    function (_super) {
      styled_esm_extends(Styled, _super);

      function Styled() {
        var _this = _super !== null && _super.apply(this, arguments) || this;

        _this.injector = injector;
        _this.tag = tag;
        return _this;
      }

      return Styled;
    }(StyledElement)
  );
}

/* harmony default export */ const dist_styled_esm = (styled_esm_styled);


;// CONCATENATED MODULE: ./node_modules/react-compat-moveable/dist/moveable.esm.js
/*
Copyright (c) 2019 Daybrush
name: react-compat-moveable
license: MIT
author: Daybrush
repository: https://github.com/daybrush/moveable/blob/master/packages/react-compat-moveable
version: 0.18.0
*/













/*
Copyright (c) 2019 Daybrush
name: @scena/event-emitter
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/gesture.git
version: 1.0.5
*/

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var __assign$1 = function () {
  __assign$1 = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return __assign$1.apply(this, arguments);
};
function moveable_esm_spreadArrays() {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;

  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];

  return r;
}

/**
 * Implement EventEmitter on object or component.
 */

var moveable_esm_EventEmitter =
/*#__PURE__*/
function () {
  function EventEmitter() {
    this._events = {};
  }
  /**
   * Add a listener to the registered event.
   * @param - Name of the event to be added
   * @param - listener function of the event to be added
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Add listener in "a" event
   * emitter.on("a", () => {
   * });
   * // Add listeners
   * emitter.on({
   *  a: () => {},
   *  b: () => {},
   * });
   */


  var __proto = EventEmitter.prototype;

  __proto.on = function (eventName, listener) {
    if (utils_esm_isObject(eventName)) {
      for (var name in eventName) {
        this.on(name, eventName[name]);
      }
    } else {
      this._addEvent(eventName, listener, {});
    }

    return this;
  };
  /**
   * Remove listeners registered in the event target.
   * @param - Name of the event to be removed
   * @param - listener function of the event to be removed
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Remove all listeners.
   * emitter.off();
   *
   * // Remove all listeners in "A" event.
   * emitter.off("a");
   *
   *
   * // Remove "listener" listener in "a" event.
   * emitter.off("a", listener);
   */


  __proto.off = function (eventName, listener) {
    if (!eventName) {
      this._events = {};
    } else if (utils_esm_isObject(eventName)) {
      for (var name in eventName) {
        this.off(name);
      }
    } else if (!listener) {
      this._events[eventName] = [];
    } else {
      var events = this._events[eventName];

      if (events) {
        var index = findIndex(events, function (e) {
          return e.listener === listener;
        });

        if (index > -1) {
          events.splice(index, 1);
        }
      }
    }

    return this;
  };
  /**
   * Add a disposable listener and Use promise to the registered event.
   * @param - Name of the event to be added
   * @param - disposable listener function of the event to be added
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Add a disposable listener in "a" event
   * emitter.once("a", () => {
   * });
   *
   * // Use Promise
   * emitter.once("a").then(e => {
   * });
   */


  __proto.once = function (eventName, listener) {
    var _this = this;

    if (listener) {
      this._addEvent(eventName, listener, {
        once: true
      });
    }

    return new Promise(function (resolve) {
      _this._addEvent(eventName, resolve, {
        once: true
      });
    });
  };
  /**
   * Fires an event to call listeners.
   * @param - Event name
   * @param - Event parameter
   * @return If false, stop the event.
   * @example
   *
   * import EventEmitter from "@scena/event-emitter";
   *
   *
   * const emitter = new EventEmitter();
   *
   * emitter.on("a", e => {
   * });
   *
   *
   * emitter.emit("a", {
   *   a: 1,
   * });
   */


  __proto.emit = function (eventName, param) {
    var _this = this;

    if (param === void 0) {
      param = {};
    }

    var events = this._events[eventName];

    if (!eventName || !events) {
      return true;
    }

    var isStop = false;
    param.eventType = eventName;

    param.stop = function () {
      isStop = true;
    };

    param.currentTarget = this;

    moveable_esm_spreadArrays(events).forEach(function (info) {
      info.listener(param);

      if (info.once) {
        _this.off(eventName, info.listener);
      }
    });

    return !isStop;
  };
  /**
   * Fires an event to call listeners.
   * @param - Event name
   * @param - Event parameter
   * @return If false, stop the event.
   * @example
   *
   * import EventEmitter from "@scena/event-emitter";
   *
   *
   * const emitter = new EventEmitter();
   *
   * emitter.on("a", e => {
   * });
   *
   *
   * emitter.emit("a", {
   *   a: 1,
   * });
   */

  /**
  * Fires an event to call listeners.
  * @param - Event name
  * @param - Event parameter
  * @return If false, stop the event.
  * @example
  *
  * import EventEmitter from "@scena/event-emitter";
  *
  *
  * const emitter = new EventEmitter();
  *
  * emitter.on("a", e => {
  * });
  *
  * // emit
  * emitter.trigger("a", {
  *   a: 1,
  * });
  */


  __proto.trigger = function (eventName, param) {
    if (param === void 0) {
      param = {};
    }

    return this.emit(eventName, param);
  };

  __proto._addEvent = function (eventName, listener, options) {
    var events = this._events;
    events[eventName] = events[eventName] || [];
    var listeners = events[eventName];
    listeners.push(__assign$1({
      listener: listener
    }, options));
  };

  return EventEmitter;
}();

var EventEmitter$1 = moveable_esm_EventEmitter;

/*
Copyright (c) 2019 Daybrush
name: react-moveable
license: MIT
author: Daybrush
repository: https://github.com/daybrush/moveable/blob/master/packages/react-moveable
version: 0.33.0
*/
/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

/* global Reflect, Promise */

var moveable_esm_extendStatics = function (d, b) {
  moveable_esm_extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function (d, b) {
    d.__proto__ = b;
  } || function (d, b) {
    for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
  };

  return moveable_esm_extendStatics(d, b);
};

function moveable_esm_extends(d, b) {
  if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
  moveable_esm_extendStatics(d, b);

  function __() {
    this.constructor = d;
  }

  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var moveable_esm_assign = function () {
  moveable_esm_assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return moveable_esm_assign.apply(this, arguments);
};

function moveable_esm_rest(s, e) {
  var t = {};

  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];

  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}

function __decorate(decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __spreadArray(to, from, pack) {
  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
    if (ar || !(i in from)) {
      if (!ar) ar = Array.prototype.slice.call(from, 0, i);
      ar[i] = from[i];
    }
  }
  return to.concat(ar || Array.prototype.slice.call(from));
}

function makeAble(name, able) {
  var _a;

  return moveable_esm_assign({
    events: {},
    props: (_a = {}, _a[name] = Boolean, _a),
    name: name
  }, able);
}

function getSVGCursor(scale, degree) {
  return "data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"".concat(32 * scale, "px\" height=\"").concat(32 * scale, "px\" viewBox=\"0 0 32 32\" ><path d=\"M 16,5 L 12,10 L 14.5,10 L 14.5,22 L 12,22 L 16,27 L 20,22 L 17.5,22 L 17.5,10 L 20, 10 L 16,5 Z\" stroke-linejoin=\"round\" stroke-width=\"1.2\" fill=\"black\" stroke=\"white\" style=\"transform:rotate(").concat(degree, "deg);transform-origin: 16px 16px\"></path></svg>");
}

function getCursorCSS(degree) {
  var x1 = getSVGCursor(1, degree); // const x2 = getSVGCursor(2, degree);

  var degree45 = Math.round(degree / 45) * 45 % 180;
  var defaultCursor = "ns-resize";

  if (degree45 === 135) {
    defaultCursor = "nwse-resize";
  } else if (degree45 === 45) {
    defaultCursor = "nesw-resize";
  } else if (degree45 === 90) {
    defaultCursor = "ew-resize";
  } // tslint:disable-next-line: max-line-length


  return "cursor:".concat(defaultCursor, ";cursor: url('").concat(x1, "') 16 16, ").concat(defaultCursor, ";");
}

var moveable_esm_agent = agent_esm();
var IS_WEBKIT = moveable_esm_agent.browser.webkit;

var IS_WEBKIT605 = IS_WEBKIT && function () {
  var navi = typeof window === "undefined" ? {
    userAgent: ""
  } : window.navigator;
  var res = /applewebkit\/([^\s]+)/g.exec(navi.userAgent.toLowerCase());
  return res ? parseFloat(res[1]) < 605 : false;
}();

var PREFIX = "moveable-";
var MOVEABLE_CSS = "\n{\n\tposition: absolute;\n\twidth: 1px;\n\theight: 1px;\n\tleft: 0;\n\ttop: 0;\n    z-index: 3000;\n    --moveable-color: #4af;\n    --zoom: 1;\n    --zoompx: 1px;\n    will-change: transform;\n}\n.control-box {\n    z-index: 0;\n}\n.line, .control {\n    position: absolute;\n\tleft: 0;\n    top: 0;\n    will-change: transform;\n}\n.control {\n\twidth: 14px;\n\theight: 14px;\n\tborder-radius: 50%;\n\tborder: 2px solid #fff;\n\tbox-sizing: border-box;\n    background: #4af;\n    background: var(--moveable-color);\n\tmargin-top: -7px;\n    margin-left: -7px;\n    border: 2px solid #fff;\n    z-index: 10;\n}\n.padding {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 100px;\n    height: 100px;\n    transform-origin: 0 0;\n}\n.line {\n\twidth: 1px;\n    height: 1px;\n    background: #4af;\n    background: var(--moveable-color);\n\ttransform-origin: 0px 50%;\n}\n.line.dashed {\n    box-sizing: border-box;\n    background: transparent;\n}\n.line.dashed.horizontal {\n    border-top: 1px dashed #4af;\n    border-top-color: #4af;\n    border-top-color: var(--moveable-color);\n}\n.line.dashed.vertical {\n    border-left: 1px dashed #4af;\n    border-left-color: #4af;\n    border-left-color: var(--moveable-color);\n}\n.line.vertical {\n    transform: translateX(-50%);\n}\n.line.horizontal {\n    transform: translateY(-50%);\n}\n.line.vertical.bold {\n    width: 2px;\n}\n.line.horizontal.bold {\n    height: 2px;\n}\n\n.control.origin {\n\tborder-color: #f55;\n\tbackground: #fff;\n\twidth: 12px;\n\theight: 12px;\n\tmargin-top: -6px;\n    margin-left: -6px;\n\tpointer-events: none;\n}\n".concat([0, 15, 30, 45, 60, 75, 90, 105, 120, 135, 150, 165].map(function (degree) {
  return "\n.direction[data-rotation=\"".concat(degree, "\"] {\n\t").concat(getCursorCSS(degree), "\n}\n");
}).join("\n"), "\n.group {\n    z-index: -1;\n}\n.area {\n    position: absolute;\n}\n.area-pieces {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: none;\n}\n.area.avoid, .area.pass {\n    pointer-events: none;\n}\n.area.avoid+.area-pieces {\n    display: block;\n}\n.area-piece {\n    position: absolute;\n}\n\n").concat(IS_WEBKIT605 ? ":global svg *:before {\n\tcontent:\"\";\n\ttransform-origin: inherit;\n}" : "", "\n");
var NEARBY_POS = [[0, 1, 2], [1, 0, 3], [2, 0, 3], [3, 1, 2]];
var FLOAT_POINT_NUM = 0.0001;
var moveable_esm_TINY_NUM = 0.0000001;
var MIN_SCALE = 0.000000001;
var MAX_NUM = Math.pow(10, 10);
var MIN_NUM = -MAX_NUM;
var DIRECTIONS = ["n", "w", "s", "e", "nw", "ne", "sw", "se"];
var DIRECTION_INDEXES = {
  n: [0, 1],
  s: [2, 3],
  w: [2, 0],
  e: [1, 3],
  nw: [0],
  ne: [1],
  sw: [2],
  se: [3]
};
var DIRECTION_ROTATIONS = {
  n: 0,
  s: 180,
  w: 270,
  e: 90,
  nw: 315,
  ne: 45,
  sw: 225,
  se: 135
};
var MOVEABLE_METHODS = ["isMoveableElement", "updateRect", "updateTarget", "destroy", "dragStart", "isInside", "hitTest", "setState", "getRect", "request", "isDragging", "getManager", "forceUpdate"];

function setCustomDrag(e, state, delta, isPinch, isConvert) {
  var result = state.gesto.move(delta, e.inputEvent);
  var datas = result.originalDatas || result.datas;
  var draggableDatas = datas.draggable || (datas.draggable = {});
  return moveable_esm_assign(moveable_esm_assign({}, isConvert ? convertDragDist(state, result) : result), {
    isPinch: !!isPinch,
    parentEvent: true,
    datas: draggableDatas,
    originalDatas: e.originalDatas
  });
}

var CustomGesto = /*#__PURE__*/function () {
  function CustomGesto() {
    this.prevX = 0;
    this.prevY = 0;
    this.startX = 0;
    this.startY = 0;
    this.isDrag = false;
    this.isFlag = false;
    this.datas = {
      draggable: {}
    };
  }

  var __proto = CustomGesto.prototype;

  __proto.dragStart = function (client, e) {
    this.isDrag = false;
    this.isFlag = false;
    var originalDatas = e.originalDatas;
    this.datas = originalDatas;

    if (!originalDatas.draggable) {
      originalDatas.draggable = {};
    }

    return moveable_esm_assign(moveable_esm_assign({}, this.move(client, e.inputEvent)), {
      type: "dragstart"
    });
  };

  __proto.drag = function (client, inputEvent) {
    return this.move([client[0] - this.prevX, client[1] - this.prevY], inputEvent);
  };

  __proto.move = function (delta, inputEvent) {
    var clientX;
    var clientY;

    if (!this.isFlag) {
      this.prevX = delta[0];
      this.prevY = delta[1];
      this.startX = delta[0];
      this.startY = delta[1];
      clientX = delta[0];
      clientY = delta[1];
      this.isFlag = true;
    } else {
      clientX = this.prevX + delta[0];
      clientY = this.prevY + delta[1];

      if (delta[0] || delta[1]) {
        this.isDrag = true;
      }
    }

    this.prevX = clientX;
    this.prevY = clientY;
    return {
      type: "drag",
      clientX: clientX,
      clientY: clientY,
      inputEvent: inputEvent,
      isDrag: this.isDrag,
      distX: clientX - this.startX,
      distY: clientY - this.startY,
      deltaX: delta[0],
      deltaY: delta[1],
      datas: this.datas.draggable,
      originalDatas: this.datas,
      parentEvent: true,
      parentGesto: this
    };
  };

  return CustomGesto;
}();

function fillChildEvents(moveable, name, e) {
  var datas = e.originalDatas;
  datas.groupable = datas.groupable || {};
  var groupableDatas = datas.groupable;
  groupableDatas.childDatas = groupableDatas.childDatas || [];
  var childDatas = groupableDatas.childDatas;
  return moveable.moveables.map(function (_, i) {
    childDatas[i] = childDatas[i] || {};
    childDatas[i][name] = childDatas[i][name] || {};
    return moveable_esm_assign(moveable_esm_assign({}, e), {
      datas: childDatas[i][name],
      originalDatas: childDatas[i]
    });
  });
}

function triggerChildGesto(moveable, able, type, delta, e, isConvert) {
  var isStart = !!type.match(/Start$/g);
  var isEnd = !!type.match(/End$/g);
  var isPinch = e.isPinch;
  var datas = e.datas;
  var events = fillChildEvents(moveable, able.name, e);
  var moveables = moveable.moveables;
  var childs = events.map(function (ev, i) {
    var childMoveable = moveables[i];
    var state = childMoveable.state;
    var childEvent = ev;

    if (isStart) {
      childEvent = new CustomGesto().dragStart(delta, ev);
    } else {
      if (!state.gesto) {
        state.gesto = datas.childGestos[i];
      }

      if (!state.gesto) {
        return;
      }

      childEvent = setCustomDrag(ev, state, delta, isPinch, isConvert);
    }

    var result = able[type](childMoveable, moveable_esm_assign(moveable_esm_assign({}, childEvent), {
      parentFlag: true
    }));

    if (isEnd) {
      state.gesto = null;
    }

    return result;
  });

  if (isStart) {
    datas.childGestos = moveables.map(function (child) {
      return child.state.gesto;
    });
  }

  return childs;
}

function triggerChildAbles(moveable, able, type, e, eachEvent, callback) {
  if (eachEvent === void 0) {
    eachEvent = function (_, ev) {
      return ev;
    };
  }

  var isEnd = !!type.match(/End$/g);
  var events = fillChildEvents(moveable, able.name, e);
  var moveables = moveable.moveables;
  var childs = events.map(function (ev, i) {
    var childMoveable = moveables[i];
    var childEvent = ev;
    childEvent = eachEvent(childMoveable, ev);
    var result = able[type](childMoveable, moveable_esm_assign(moveable_esm_assign({}, childEvent), {
      parentFlag: true
    }));
    result && callback && callback(childMoveable, ev, result, i);

    if (isEnd) {
      childMoveable.state.gesto = null;
    }

    return result;
  });
  return childs;
}

function renderDirectionControls(moveable, defaultDirections, React, additionalClassName) {
  if (additionalClassName === void 0) {
    additionalClassName = "";
  }

  var _a = moveable.state,
      renderPoses = _a.renderPoses,
      rotationRad = _a.rotation,
      direction = _a.direction;
  var _b = moveable.props,
      _c = _b.renderDirections,
      directions = _c === void 0 ? defaultDirections : _c,
      zoom = _b.zoom;
  var directionMap = {};

  if (!directions) {
    return [];
  }

  var sign = direction > 0 ? 1 : -1;
  var renderDirections = directions === true ? DIRECTIONS : directions;
  var degRotation = rotationRad / Math.PI * 180;
  renderDirections.forEach(function (dir) {
    directionMap[dir] = true;
  });
  return renderDirections.map(function (dir) {
    var indexes = DIRECTION_INDEXES[dir];

    if (!indexes || !directionMap[dir]) {
      return null;
    }

    var directionRotation = (utils_esm_throttle(degRotation, 15) + sign * DIRECTION_ROTATIONS[dir] + 720) % 180;
    return React.createElement("div", {
      className: prefix("control", "direction", dir, additionalClassName),
      "data-rotation": directionRotation,
      "data-direction": dir,
      key: "direction-".concat(dir),
      style: getControlTransform.apply(void 0, __spreadArray([rotationRad, zoom], indexes.map(function (index) {
        return renderPoses[index];
      }), false))
    });
  });
}

function renderLine(React, direction, pos1, pos2, zoom, key) {
  var classNames = [];

  for (var _i = 6; _i < arguments.length; _i++) {
    classNames[_i - 6] = arguments[_i];
  }

  var rad = getRad(pos1, pos2);
  var rotation = direction ? utils_esm_throttle(rad / Math.PI * 180, 15) % 180 : -1;
  return React.createElement("div", {
    key: "line".concat(key),
    className: prefix.apply(void 0, __spreadArray(["line", "direction", direction], classNames, false)),
    "data-rotation": rotation,
    "data-line-index": key,
    "data-direction": direction,
    style: getLineStyle(pos1, pos2, zoom, rad)
  });
}

function renderAllDirections(moveable, React) {
  return renderDirectionControls(moveable, DIRECTIONS, React);
}

function renderDiagonalDirections(moveable, React) {
  return renderDirectionControls(moveable, ["nw", "ne", "sw", "se"], React);
}
/**
 * @namespace Rotatable
 * @memberof Moveable
 * @description Rotatable indicates whether the target can be rotated.
 */


function setRotateStartInfo(moveable, datas, clientX, clientY, origin, rect) {
  var n = moveable.state.is3d ? 4 : 3;
  var nextOrigin = calculatePosition(moveable.state.rootMatrix, origin, n);
  var startAbsoluteOrigin = plus([rect.left, rect.top], nextOrigin);
  datas.startAbsoluteOrigin = startAbsoluteOrigin;
  datas.prevDeg = getRad(startAbsoluteOrigin, [clientX, clientY]) / Math.PI * 180;
  datas.defaultDeg = datas.prevDeg;
  datas.prevSnapDeg = 0;
  datas.loop = 0;
}

function getAbsoluteDist(deg, direction, datas) {
  var defaultDeg = datas.defaultDeg,
      prevDeg = datas.prevDeg;
  var normalizedPrevDeg = prevDeg % 360;
  var loop = Math.floor(prevDeg / 360);

  if (normalizedPrevDeg < 0) {
    normalizedPrevDeg += 360;
  }

  if (normalizedPrevDeg > deg && normalizedPrevDeg > 270 && deg < 90) {
    // 360 => 0
    ++loop;
  } else if (normalizedPrevDeg < deg && normalizedPrevDeg < 90 && deg > 270) {
    // 0 => 360
    --loop;
  }

  var dist = direction * (loop * 360 + deg - defaultDeg);
  datas.prevDeg = defaultDeg + dist;
  return dist;
}

function getAbsoluteDistByClient(clientX, clientY, direction, datas) {
  return getAbsoluteDist(getRad(datas.startAbsoluteOrigin, [clientX, clientY]) / Math.PI * 180, direction, datas);
}

function getRotateInfo(moveable, moveableRect, datas, dist, startValue, isSnap) {
  var _a = moveable.props.throttleRotate,
      throttleRotate = _a === void 0 ? 0 : _a;
  var nextDist = dist;
  var prevSnapDeg = datas.prevSnapDeg;

  if (isSnap) {
    nextDist = checkSnapRotate(moveable, moveableRect, datas.origin, nextDist);
  }

  var snapRotation = utils_esm_throttle(startValue + nextDist, throttleRotate);
  var snapDeg = snapRotation - startValue;
  datas.prevSnapDeg = snapDeg;
  return [snapDeg - prevSnapDeg, nextDist, snapRotation];
}

function getRotationPositions(rotationPosition, _a, direction) {
  var pos1 = _a[0],
      pos2 = _a[1],
      pos3 = _a[2],
      pos4 = _a[3];

  if (rotationPosition === "none") {
    return;
  }

  var _b = (rotationPosition || "top").split("-"),
      dir1 = _b[0],
      dir2 = _b[1];

  var radPoses = [pos1, pos2]; // if (scale[0] < 0) {
  //     dir1 = getReversePositionX(dir1);
  //     dir2 = getReversePositionX(dir2);
  // }
  // if (scale[1] < 0) {
  //     dir1 = getReversePositionY(dir1);
  //     dir2 = getReversePositionY(dir2);
  // }

  if (dir1 === "left") {
    radPoses = [pos3, pos1];
  } else if (dir1 === "right") {
    radPoses = [pos2, pos4];
  } else if (dir1 === "bottom") {
    radPoses = [pos4, pos3];
  }

  var pos = [(radPoses[0][0] + radPoses[1][0]) / 2, (radPoses[0][1] + radPoses[1][1]) / 2];
  var rad = getRotationRad(radPoses, direction);

  if (dir2) {
    var isStart = dir2 === "top" || dir2 === "left";
    var isReverse = dir1 === "bottom" || dir1 === "left";
    pos = radPoses[isStart && !isReverse || !isStart && isReverse ? 0 : 1];
  }

  return [pos, rad];
}

function dragControlCondition(moveable, e) {
  if (e.isRequest) {
    return e.requestAble === "rotatable";
  }

  var target = e.inputEvent.target;

  if (hasClass(target, prefix("rotation-control"))) {
    return true;
  }

  var rotationTarget = moveable.props.rotationTarget;

  if (rotationTarget) {
    return getRefTargets(rotationTarget, true).some(function (element) {
      if (!element) {
        return false;
      }

      return target === element || target.contains(element);
    });
  }

  return false;
}

var Rotatable = {
  name: "rotatable",
  canPinch: true,
  props: {
    rotatable: Boolean,
    rotationPosition: String,
    throttleRotate: Number,
    renderDirections: Object,
    rotationTarget: Object
  },
  events: {
    onRotateStart: "rotateStart",
    onBeforeRotate: "beforeRotate",
    onRotate: "rotate",
    onRotateEnd: "rotateEnd",
    onRotateGroupStart: "rotateGroupStart",
    onBeforeRotateGroup: "beforeRotateGroup",
    onRotateGroup: "rotateGroup",
    onRotateGroupEnd: "rotateGroupEnd"
  },
  css: [".rotation {\n            position: absolute;\n            height: 40px;\n            width: 1px;\n            transform-origin: 50% 100%;\n            height: calc(40px * var(--zoom));\n            top: auto;\n            left: 0;\n            bottom: 100%;\n            will-change: transform;\n        }\n        .rotation .rotation-line {\n            display: block;\n            width: 100%;\n            height: 100%;\n            transform-origin: 50% 50%;\n        }\n        .rotation .rotation-control {\n            border-color: #4af;\n            border-color: var(--moveable-color);\n            background:#fff;\n            cursor: alias;\n        }"],
  render: function (moveable, React) {
    var _a = moveable.props,
        rotatable = _a.rotatable,
        rotationPosition = _a.rotationPosition,
        zoom = _a.zoom,
        renderDirections = _a.renderDirections;
    var _b = moveable.state,
        renderPoses = _b.renderPoses,
        direction = _b.direction;

    if (!rotatable) {
      return null;
    }

    var positions = getRotationPositions(rotationPosition, renderPoses, direction);
    var jsxs = [];

    if (positions) {
      var pos = positions[0],
          rad = positions[1];
      jsxs.push(React.createElement("div", {
        key: "rotation",
        className: prefix("rotation"),
        style: {
          // tslint:disable-next-line: max-line-length
          transform: "translate(-50%) translate(".concat(pos[0], "px, ").concat(pos[1], "px) rotate(").concat(rad, "rad)")
        }
      }, React.createElement("div", {
        className: prefix("line rotation-line"),
        style: {
          transform: "scaleX(".concat(zoom, ")")
        }
      }), React.createElement("div", {
        className: prefix("control rotation-control"),
        style: {
          transform: "translate(0.5px) scale(".concat(zoom, ")")
        }
      })));
    }

    if (renderDirections) {
      jsxs.push.apply(jsxs, renderDirectionControls(moveable, [], React));
    }

    return jsxs;
  },
  dragControlCondition: dragControlCondition,
  dragControlStart: function (moveable, e) {
    var datas = e.datas,
        clientX = e.clientX,
        clientY = e.clientY,
        parentRotate = e.parentRotate,
        parentFlag = e.parentFlag,
        isPinch = e.isPinch,
        isRequest = e.isRequest;
    var _a = moveable.state,
        target = _a.target,
        left = _a.left,
        top = _a.top,
        origin = _a.origin,
        beforeOrigin = _a.beforeOrigin,
        direction = _a.direction,
        beforeDirection = _a.beforeDirection,
        targetTransform = _a.targetTransform,
        moveableClientRect = _a.moveableClientRect;

    if (!isRequest && !target) {
      return false;
    }

    var rect = moveable.getRect();
    datas.rect = rect;
    datas.transform = targetTransform;
    datas.left = left;
    datas.top = top;
    datas.fixedPosition = getDirectionOffset(moveable, getOriginDirection(moveable));

    if (isRequest || isPinch || parentFlag) {
      var externalRotate = parentRotate || 0;
      datas.beforeInfo = {
        origin: rect.beforeOrigin,
        prevDeg: externalRotate,
        defaultDeg: externalRotate,
        prevSnapDeg: 0
      };
      datas.afterInfo = moveable_esm_assign(moveable_esm_assign({}, datas.beforeInfo), {
        origin: rect.origin
      });
      datas.absoluteInfo = moveable_esm_assign(moveable_esm_assign({}, datas.beforeInfo), {
        origin: rect.origin,
        startValue: externalRotate
      });
    } else {
      datas.beforeInfo = {
        origin: rect.beforeOrigin
      };
      datas.afterInfo = {
        origin: rect.origin
      };
      datas.absoluteInfo = {
        origin: rect.origin,
        startValue: rect.rotation
      };
      setRotateStartInfo(moveable, datas.beforeInfo, clientX, clientY, beforeOrigin, moveableClientRect);
      setRotateStartInfo(moveable, datas.afterInfo, clientX, clientY, origin, moveableClientRect);
      setRotateStartInfo(moveable, datas.absoluteInfo, clientX, clientY, origin, moveableClientRect);
    }

    datas.direction = direction;
    datas.beforeDirection = beforeDirection;
    datas.startValue = 0;
    datas.datas = {};
    setDefaultTransformIndex(e, "rotate");
    var params = fillParams(moveable, e, moveable_esm_assign(moveable_esm_assign({
      set: function (rotatation) {
        datas.startValue = rotatation * Math.PI / 180;
      }
    }, fillTransformStartEvent(e)), {
      dragStart: moveable_esm_Draggable.dragStart(moveable, new CustomGesto().dragStart([0, 0], e))
    }));
    var result = triggerEvent(moveable, "onRotateStart", params);
    datas.isRotate = result !== false;
    moveable.state.snapRenderInfo = {
      request: e.isRequest
    };
    return datas.isRotate ? params : false;
  },
  dragControl: function (moveable, e) {
    var _a, _b, _c;

    var datas = e.datas,
        clientX = e.clientX,
        clientY = e.clientY,
        parentRotate = e.parentRotate,
        parentFlag = e.parentFlag,
        isPinch = e.isPinch,
        groupDelta = e.groupDelta;
    var beforeDirection = datas.beforeDirection,
        beforeInfo = datas.beforeInfo,
        afterInfo = datas.afterInfo,
        absoluteInfo = datas.absoluteInfo,
        isRotate = datas.isRotate,
        startValue = datas.startValue,
        rect = datas.rect;

    if (!isRotate) {
      return;
    }

    resolveTransformEvent(e, "rotate");
    var targetDirection = getTransformDirection(e);
    var direction = beforeDirection * targetDirection;
    var parentMoveable = moveable.props.parentMoveable;
    var beforeDelta = 0;
    var beforeDist;
    var beforeRotation;
    var delta = 0;
    var dist;
    var rotation;
    var absoluteDelta = 0;
    var absoluteDist;
    var absoluteRotation;
    var startRotation = 180 / Math.PI * startValue;
    var absoluteStartRotation = absoluteInfo.startValue;
    var isSnap = false;

    if (!parentFlag && "parentDist" in e) {
      var parentDist = e.parentDist;
      beforeDist = parentDist;
      dist = parentDist;
      absoluteDist = parentDist;
    } else if (isPinch || parentFlag) {
      beforeDist = getAbsoluteDist(parentRotate, beforeDirection, beforeInfo);
      dist = getAbsoluteDist(parentRotate, direction, afterInfo);
      absoluteDist = getAbsoluteDist(parentRotate, direction, absoluteInfo);
    } else {
      beforeDist = getAbsoluteDistByClient(clientX, clientY, beforeDirection, beforeInfo);
      dist = getAbsoluteDistByClient(clientX, clientY, direction, afterInfo);
      absoluteDist = getAbsoluteDistByClient(clientX, clientY, direction, absoluteInfo);
      isSnap = true;
    }

    beforeRotation = startRotation + beforeDist;
    rotation = startRotation + dist;
    absoluteRotation = absoluteStartRotation + absoluteDist;
    triggerEvent(moveable, "onBeforeRotate", fillParams(moveable, e, {
      beforeRotation: beforeRotation,
      rotation: rotation,
      absoluteRotation: absoluteRotation,
      setRotation: function (nextRotation) {
        dist = nextRotation - startRotation;
        beforeDist = dist;
        absoluteDist = dist;
      }
    }, true));
    _a = getRotateInfo(moveable, rect, beforeInfo, beforeDist, startRotation, isSnap), beforeDelta = _a[0], beforeDist = _a[1], beforeRotation = _a[2];
    _b = getRotateInfo(moveable, rect, afterInfo, dist, startRotation, isSnap), delta = _b[0], dist = _b[1], rotation = _b[2];
    _c = getRotateInfo(moveable, rect, absoluteInfo, absoluteDist, absoluteStartRotation, isSnap), absoluteDelta = _c[0], absoluteDist = _c[1], absoluteRotation = _c[2];

    if (!absoluteDelta && !delta && !beforeDelta && !parentMoveable) {
      return;
    }

    var nextTransform = convertTransformFormat(datas, "rotate(".concat(rotation, "deg)"), "rotate(".concat(dist, "deg)"));
    var inverseDist = getRotateDist(moveable, dist, datas.fixedPosition, datas);
    var inverseDelta = minus(plus(groupDelta || [0, 0], inverseDist), datas.prevInverseDist || [0, 0]);
    datas.prevInverseDist = inverseDist;
    datas.requestValue = null;
    var params = fillParams(moveable, e, moveable_esm_assign({
      delta: delta,
      dist: dist,
      rotate: rotation,
      rotation: rotation,
      beforeDist: beforeDist,
      beforeDelta: beforeDelta,
      beforeRotate: beforeRotation,
      beforeRotation: beforeRotation,
      absoluteDist: absoluteDist,
      absoluteDelta: absoluteDelta,
      absoluteRotate: absoluteRotation,
      absoluteRotation: absoluteRotation,
      isPinch: !!isPinch
    }, fillTransformEvent(moveable, nextTransform, inverseDelta, isPinch, e)));
    triggerEvent(moveable, "onRotate", params);
    return params;
  },
  dragControlAfter: function (moveable, e) {
    e.datas.requestValue;
  },
  dragControlEnd: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isRotate) {
      return;
    }

    datas.isRotate = false;
    var params = fillEndParams(moveable, e, {});
    triggerEvent(moveable, "onRotateEnd", params);
    return params;
  },
  dragGroupControlCondition: dragControlCondition,
  dragGroupControlStart: function (moveable, e) {
    var datas = e.datas;
    var _a = moveable.state,
        parentLeft = _a.left,
        parentTop = _a.top,
        parentBeforeOrigin = _a.beforeOrigin;
    var params = this.dragControlStart(moveable, e);

    if (!params) {
      return false;
    }

    params.set(datas.beforeDirection * moveable.rotation);
    var events = triggerChildAbles(moveable, this, "dragControlStart", e, function (child, ev) {
      var _a = child.state,
          left = _a.left,
          top = _a.top,
          beforeOrigin = _a.beforeOrigin;
      var childClient = plus(minus([left, top], [parentLeft, parentTop]), minus(beforeOrigin, parentBeforeOrigin));
      ev.datas.groupClient = childClient;
      return moveable_esm_assign(moveable_esm_assign({}, ev), {
        parentRotate: 0
      });
    });

    var nextParams = moveable_esm_assign(moveable_esm_assign({}, params), {
      targets: moveable.props.targets,
      events: events
    });

    var result = triggerEvent(moveable, "onRotateGroupStart", nextParams);
    datas.isRotate = result !== false;
    return datas.isRotate ? params : false;
  },
  dragGroupControl: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isRotate) {
      return;
    }

    catchEvent(moveable, "onBeforeRotate", function (parentEvent) {
      triggerEvent(moveable, "onBeforeRotateGroup", fillParams(moveable, e, moveable_esm_assign(moveable_esm_assign({}, parentEvent), {
        targets: moveable.props.targets
      }), true));
    });
    var params = this.dragControl(moveable, e);

    if (!params) {
      return;
    }

    var direction = datas.beforeDirection;
    var parentRotate = params.beforeDist;
    var deg = params.beforeDelta;
    var rad = deg / 180 * Math.PI;
    var events = triggerChildAbles(moveable, this, "dragControl", e, function (_, ev) {
      var _a = ev.datas.groupClient,
          prevX = _a[0],
          prevY = _a[1];

      var _b = rotate([prevX, prevY], rad * direction),
          clientX = _b[0],
          clientY = _b[1];

      var delta = [clientX - prevX, clientY - prevY];
      ev.datas.groupClient = [clientX, clientY];
      return moveable_esm_assign(moveable_esm_assign({}, ev), {
        parentRotate: parentRotate,
        groupDelta: delta
      });
    });
    moveable.rotation = direction * params.beforeRotation;

    var nextParams = moveable_esm_assign({
      targets: moveable.props.targets,
      events: events,
      set: function (rotation) {
        moveable.rotation = rotation;
      },
      setGroupRotation: function (rotation) {
        moveable.rotation = rotation;
      }
    }, params);

    triggerEvent(moveable, "onRotateGroup", nextParams);
    return nextParams;
  },
  dragGroupControlEnd: function (moveable, e) {
    var isDrag = e.isDrag,
        datas = e.datas;

    if (!datas.isRotate) {
      return;
    }

    this.dragControlEnd(moveable, e);
    var events = triggerChildAbles(moveable, this, "dragControlEnd", e);
    var nextParams = fillEndParams(moveable, e, {
      targets: moveable.props.targets,
      events: events
    });
    triggerEvent(moveable, "onRotateGroupEnd", nextParams);
    return isDrag;
  },

  /**
   * @method Moveable.Rotatable#request
   * @param {object} [e] - the Resizable's request parameter
   * @param {number} [e.deltaRotate=0] -  delta number of rotation
   * @param {number} [e.rotate=0] - absolute number of moveable's rotation
   * @return {Moveable.Requester} Moveable Requester
   * @example
    * // Instantly Request (requestStart - request - requestEnd)
   * moveable.request("rotatable", { deltaRotate: 10 }, true);
   *
   * * moveable.request("rotatable", { rotate: 10 }, true);
   *
   * // requestStart
   * const requester = moveable.request("rotatable");
   *
   * // request
   * requester.request({ deltaRotate: 10 });
   * requester.request({ deltaRotate: 10 });
   * requester.request({ deltaRotate: 10 });
   *
   * requester.request({ rotate: 10 });
   * requester.request({ rotate: 20 });
   * requester.request({ rotate: 30 });
   *
   * // requestEnd
   * requester.requestEnd();
   */
  request: function (moveable) {
    var datas = {};
    var distRotate = 0;
    var startRotation = moveable.getRotation();
    return {
      isControl: true,
      requestStart: function () {
        return {
          datas: datas
        };
      },
      request: function (e) {
        if ("deltaRotate" in e) {
          distRotate += e.deltaRotate;
        } else if ("rotate" in e) {
          distRotate = e.rotate - startRotation;
        }

        return {
          datas: datas,
          parentDist: distRotate
        };
      },
      requestEnd: function () {
        return {
          datas: datas,
          isDrag: true
        };
      }
    };
  }
};
/**
 * Whether or not target can be rotated. (default: false)
 * @name Moveable.Rotatable#rotatable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.rotatable = true;
 */

/**
 * You can specify the position of the rotation. (default: "top")
 * @name Moveable.Rotatable#rotationPosition
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   rotationPosition: "top",
 * });
 *
 * moveable.rotationPosition = "bottom"
 */

/**
 * throttle of angle(degree) when rotate.
 * @name Moveable.Rotatable#throttleRotate
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.throttleRotate = 1;
 */

/**
 * When the rotate starts, the rotateStart event is called.
 * @memberof Moveable.Rotatable
 * @event rotateStart
 * @param {Moveable.Rotatable.OnRotateStart} - Parameters for the rotateStart event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { rotatable: true });
 * moveable.on("rotateStart", ({ target }) => {
 *     console.log(target);
 * });
 */

/**
* When rotating, the rotate event is called.
* @memberof Moveable.Rotatable
* @event rotate
* @param {Moveable.Rotatable.OnRotate} - Parameters for the rotate event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, { rotatable: true });
* moveable.on("rotate", ({ target, transform, dist }) => {
*     target.style.transform = transform;
* });
*/

/**
 * When the rotate finishes, the rotateEnd event is called.
 * @memberof Moveable.Rotatable
 * @event rotateEnd
 * @param {Moveable.Rotatable.OnRotateEnd} - Parameters for the rotateEnd event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { rotatable: true });
 * moveable.on("rotateEnd", ({ target, isDrag }) => {
 *     console.log(target, isDrag);
 * });
 */

/**
 * When the group rotate starts, the `rotateGroupStart` event is called.
 * @memberof Moveable.Rotatable
 * @event rotateGroupStart
 * @param {Moveable.Rotatable.OnRotateGroupStart} - Parameters for the `rotateGroupStart` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     rotatable: true
 * });
 * moveable.on("rotateGroupStart", ({ targets }) => {
 *     console.log("onRotateGroupStart", targets);
 * });
 */

/**
* When the group rotate, the `rotateGroup` event is called.
* @memberof Moveable.Rotatable
* @event rotateGroup
* @param {Moveable.Rotatable.OnRotateGroup} - Parameters for the `rotateGroup` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     target: [].slice.call(document.querySelectorAll(".target")),
*     rotatable: true
* });
* moveable.on("rotateGroup", ({ targets, events }) => {
*     console.log("onRotateGroup", targets);
*     events.forEach(ev => {
*         const target = ev.target;
*         // ev.drag is a drag event that occurs when the group rotate.
*         const left = ev.drag.beforeDist[0];
*         const top = ev.drag.beforeDist[1];
*         const deg = ev.beforeDist;
*     });
* });
*/

/**
 * When the group rotate finishes, the `rotateGroupEnd` event is called.
 * @memberof Moveable.Rotatable
 * @event rotateGroupEnd
 * @param {Moveable.Rotatable.OnRotateGroupEnd} - Parameters for the `rotateGroupEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     rotatable: true
 * });
 * moveable.on("rotateGroupEnd", ({ targets, isDrag }) => {
 *     console.log("onRotateGroupEnd", targets, isDrag);
 * });
 */

var VERTICAL_NAMES = ["left", "right", "center"];
var HORIZONTAL_NAMES = ["top", "bottom", "middle"];
var VERTICAL_NAMES_MAP = {
  start: "left",
  end: "right",
  center: "center"
};
var HORIZONTAL_NAMES_MAP = {
  start: "top",
  end: "bottom",
  center: "middle"
};

function hasGuidelines(moveable, ableName) {
  var _a = moveable.props,
      snappable = _a.snappable,
      bounds = _a.bounds,
      innerBounds = _a.innerBounds,
      verticalGuidelines = _a.verticalGuidelines,
      horizontalGuidelines = _a.horizontalGuidelines,
      snapGridWidth = _a.snapGridWidth,
      snapGridHeight = _a.snapGridHeight,
      _b = moveable.state,
      guidelines = _b.guidelines,
      enableSnap = _b.enableSnap;

  if (!snappable || !enableSnap || ableName && snappable !== true && snappable.indexOf(ableName) < 0) {
    return false;
  }

  if (snapGridWidth || snapGridHeight || bounds || innerBounds || guidelines && guidelines.length || verticalGuidelines && verticalGuidelines.length || horizontalGuidelines && horizontalGuidelines.length) {
    return true;
  }

  return false;
}

function getSnapDirections(snapDirections) {
  if (snapDirections === false) {
    return {};
  } else if (snapDirections === true || !snapDirections) {
    return {
      left: true,
      right: true,
      top: true,
      bottom: true
    };
  }

  return snapDirections;
}

function mapSnapDirectionPoses(snapDirections, snapPoses) {
  var nextSnapDirections = getSnapDirections(snapDirections);
  var nextSnapPoses = {};

  for (var name in nextSnapDirections) {
    if (name in snapPoses && nextSnapDirections[name]) {
      nextSnapPoses[name] = snapPoses[name];
    }
  }

  return nextSnapPoses;
}

function splitSnapDirectionPoses(snapDirections, snapPoses) {
  var nextSnapPoses = mapSnapDirectionPoses(snapDirections, snapPoses);
  var horizontalNames = HORIZONTAL_NAMES.filter(function (name) {
    return name in nextSnapPoses;
  });
  var verticalNames = VERTICAL_NAMES.filter(function (name) {
    return name in nextSnapPoses;
  });
  return {
    horizontal: horizontalNames.map(function (name) {
      return nextSnapPoses[name];
    }),
    vertical: verticalNames.map(function (name) {
      return nextSnapPoses[name];
    })
  };
}

function getGapGuidelines(moveable, targetRect, snapThreshold) {
  var elementRects = moveable.state.elementRects;
  var gapGuidelines = [];
  [["vertical", VERTICAL_NAMES_MAP, HORIZONTAL_NAMES_MAP], ["horizontal", HORIZONTAL_NAMES_MAP, VERTICAL_NAMES_MAP]].forEach(function (_a) {
    var type = _a[0],
        mainNames = _a[1],
        sideNames = _a[2];
    var targetStart = targetRect[mainNames.start];
    var targetEnd = targetRect[mainNames.end];
    var targetCenter = targetRect[mainNames.center];
    var targetStart2 = targetRect[sideNames.start];
    var targetEnd2 = targetRect[sideNames.end]; // element : moveable

    function getDist(elementRect) {
      var rect = elementRect.rect;

      if (rect[mainNames.end] < targetStart + snapThreshold) {
        return targetStart - rect[mainNames.end];
      } else if (targetEnd - snapThreshold < rect[mainNames.start]) {
        return rect[mainNames.start] - targetEnd;
      } else {
        return -1;
      }
    }

    var nextElementRects = elementRects.filter(function (elementRect) {
      var rect = elementRect.rect;

      if (rect[sideNames.start] > targetEnd2 || rect[sideNames.end] < targetStart2) {
        return false;
      }

      return getDist(elementRect) > 0;
    }).sort(function (a, b) {
      return getDist(a) - getDist(b);
    });
    var groups = [];
    nextElementRects.forEach(function (snapRect1) {
      nextElementRects.forEach(function (snapRect2) {
        if (snapRect1 === snapRect2) {
          return;
        }

        var rect1 = snapRect1.rect;
        var rect2 = snapRect2.rect;
        var rect1Start = rect1[sideNames.start];
        var rect1End = rect1[sideNames.end];
        var rect2Start = rect2[sideNames.start];
        var rect2End = rect2[sideNames.end];

        if (rect1Start > rect2End || rect2Start > rect1End) {
          return;
        }

        groups.push([snapRect1, snapRect2]);
      });
    });
    groups.forEach(function (_a) {
      var snapRect1 = _a[0],
          snapRect2 = _a[1];
      var rect1 = snapRect1.rect;
      var rect2 = snapRect2.rect;
      var rect1Start = rect1[mainNames.start];
      var rect1End = rect1[mainNames.end];
      var rect2Start = rect2[mainNames.start];
      var rect2End = rect2[mainNames.end];
      var gap = 0;
      var pos = 0;
      var isStart = false;
      var isCenter = false;
      var isEnd = false;

      if (rect1End <= targetStart && targetEnd <= rect2Start) {
        // (l)element1(r) : (l)target(r) : (l)element2(r)
        isCenter = true;
        gap = (rect2Start - rect1End - (targetEnd - targetStart)) / 2;
        pos = rect1End + gap + (targetEnd - targetStart) / 2;

        if (Math.abs(pos - targetCenter) > snapThreshold) {
          return;
        }
      } else if (rect1End < rect2Start && rect2End < targetStart + snapThreshold) {
        // (l)element1(r) : (l)element2(r) : (l)target
        isStart = true;
        gap = rect2Start - rect1End;
        pos = rect2End + gap;

        if (Math.abs(pos - targetStart) > snapThreshold) {
          return;
        }
      } else if (rect1End < rect2Start && targetEnd - snapThreshold < rect1Start) {
        // target(r) : (l)element1(r) : (l)element2(r)
        isEnd = true;
        gap = rect2Start - rect1End;
        pos = rect1Start - gap;

        if (Math.abs(pos - targetEnd) > snapThreshold) {
          return;
        }
      } else {
        return;
      }

      if (!gap) {
        return;
      }

      gapGuidelines.push({
        type: type,
        pos: type === "vertical" ? [pos, 0] : [0, pos],
        element: snapRect2.element,
        size: 0,
        className: snapRect2.className,
        isStart: isStart,
        isCenter: isCenter,
        isEnd: isEnd,
        gap: gap,
        hide: true,
        gapRects: [snapRect1, snapRect2]
      });
    });
  });
  return gapGuidelines;
}

function getDefaultGuidelines(horizontalGuidelines, verticalGuidelines, width, height, clientLeft, clientTop, snapOffset) {
  if (clientLeft === void 0) {
    clientLeft = 0;
  }

  if (clientTop === void 0) {
    clientTop = 0;
  }

  if (snapOffset === void 0) {
    snapOffset = {
      left: 0,
      top: 0,
      right: 0,
      bottom: 0
    };
  }

  var guidelines = [];
  var snapOffsetLeft = snapOffset.left,
      snapOffsetTop = snapOffset.top,
      snapOffsetBottom = snapOffset.bottom,
      snapOffsetRight = snapOffset.right;
  var snapWidth = width + snapOffsetRight - snapOffsetLeft;
  var snapHeight = height + snapOffsetBottom - snapOffsetTop;
  horizontalGuidelines && horizontalGuidelines.forEach(function (pos) {
    guidelines.push({
      type: "horizontal",
      pos: [snapOffsetLeft, utils_esm_throttle(pos - clientTop + snapOffsetTop, 0.1)],
      size: snapWidth
    });
  });
  verticalGuidelines && verticalGuidelines.forEach(function (pos) {
    guidelines.push({
      type: "vertical",
      pos: [utils_esm_throttle(pos - clientLeft + snapOffsetLeft, 0.1), snapOffsetTop],
      size: snapHeight
    });
  });
  return guidelines;
}

function calculateContainerPos(rootMatrix, containerRect, n) {
  var clientPos = calculatePosition(rootMatrix, [containerRect.clientLeft, containerRect.clientTop], n);
  return [containerRect.left + clientPos[0], containerRect.top + clientPos[1]];
}

function getSnapElementRects(moveable, values) {
  if (!values.length) {
    return [];
  }

  var state = moveable.state;
  var containerClientRect = state.containerClientRect,
      _a = state.targetClientRect,
      clientTop = _a.top,
      clientLeft = _a.left,
      rootMatrix = state.rootMatrix,
      is3d = state.is3d;
  var n = is3d ? 4 : 3;

  var _b = calculateContainerPos(rootMatrix, containerClientRect, n),
      containerLeft = _b[0],
      containerTop = _b[1];

  var poses = getAbsolutePosesByState(state);

  var _c = getMinMaxs(poses),
      targetLeft = _c.minX,
      targetTop = _c.minY;

  var _d = minus([targetLeft, targetTop], calculateInversePosition(rootMatrix, [clientLeft - containerLeft, clientTop - containerTop], n)).map(function (pos) {
    return roundSign(pos);
  }),
      distLeft = _d[0],
      distTop = _d[1];

  return values.map(function (value) {
    var rect = value.element.getBoundingClientRect();
    var left = rect.left - containerLeft;
    var top = rect.top - containerTop;
    var bottom = top + rect.height;
    var right = left + rect.width;

    var _a = calculateInversePosition(rootMatrix, [left, top], n),
        elementLeft = _a[0],
        elementTop = _a[1];

    var _b = calculateInversePosition(rootMatrix, [right, bottom], n),
        elementRight = _b[0],
        elementBottom = _b[1];

    return moveable_esm_assign(moveable_esm_assign({}, value), {
      rect: {
        left: elementLeft + distLeft,
        right: elementRight + distLeft,
        top: elementTop + distTop,
        bottom: elementBottom + distTop,
        center: (elementLeft + elementRight) / 2 + distLeft,
        middle: (elementTop + elementBottom) / 2 + distTop
      }
    });
  });
}

function getElementGuidelines(moveable) {
  var state = moveable.state;
  var _a = moveable.props.elementGuidelines,
      elementGuidelines = _a === void 0 ? [] : _a;

  if (!elementGuidelines.length) {
    state.elementRects = [];
    return [];
  }

  var prevValues = (state.elementRects || []).filter(function (snapRect) {
    return !snapRect.refresh;
  });
  var nextElementGuidelines = elementGuidelines.map(function (el) {
    if (utils_esm_isObject(el) && "element" in el) {
      return el;
    }

    return {
      element: getRefTarget(el, true)
    };
  }).filter(function (value) {
    return value.element;
  });

  var _b = children_differ_esm_diff(prevValues.map(function (v) {
    return v.element;
  }), nextElementGuidelines.map(function (v) {
    return v.element;
  })),
      maintained = _b.maintained,
      added = _b.added;

  var nextValues = [];
  maintained.forEach(function (_a) {
    var prevIndex = _a[0],
        nextIndex = _a[1];
    nextValues[nextIndex] = prevValues[prevIndex];
  });
  getSnapElementRects(moveable, added.map(function (index) {
    return nextElementGuidelines[index];
  })).map(function (rect, i) {
    nextValues[added[i]] = rect;
  });
  state.elementRects = nextValues;
  var elementSnapDirections = getSnapDirections(moveable.props.elementSnapDirections);
  var nextGuidelines = [];
  nextValues.forEach(function (snapRect) {
    var element = snapRect.element,
        _a = snapRect.top,
        topValue = _a === void 0 ? elementSnapDirections.top : _a,
        _b = snapRect.left,
        leftValue = _b === void 0 ? elementSnapDirections.left : _b,
        _c = snapRect.right,
        rightValue = _c === void 0 ? elementSnapDirections.right : _c,
        _d = snapRect.bottom,
        bottomValue = _d === void 0 ? elementSnapDirections.bottom : _d,
        _e = snapRect.center,
        centerValue = _e === void 0 ? elementSnapDirections.center : _e,
        _f = snapRect.middle,
        middleValue = _f === void 0 ? elementSnapDirections.middle : _f,
        className = snapRect.className,
        rect = snapRect.rect;

    var _g = splitSnapDirectionPoses({
      top: topValue,
      right: rightValue,
      left: leftValue,
      bottom: bottomValue,
      center: centerValue,
      middle: middleValue
    }, rect),
        horizontal = _g.horizontal,
        vertical = _g.vertical;

    var rectTop = rect.top;
    var rectLeft = rect.left;
    var width = rect.right - rectLeft;
    var height = rect.bottom - rectTop;
    var sizes = [width, height];
    vertical.forEach(function (pos) {
      nextGuidelines.push({
        type: "vertical",
        element: element,
        pos: [utils_esm_throttle(pos, 0.1), rectTop],
        size: height,
        sizes: sizes,
        className: className,
        elementRect: snapRect
      });
    });
    horizontal.forEach(function (pos) {
      nextGuidelines.push({
        type: "horizontal",
        element: element,
        pos: [rectLeft, utils_esm_throttle(pos, 0.1)],
        size: width,
        sizes: sizes,
        className: className,
        elementRect: snapRect
      });
    });
  });
  return nextGuidelines;
}

function getTotalGuidelines(moveable) {
  var _a = moveable.state,
      snapOffset = _a.snapOffset,
      _b = _a.containerClientRect,
      overflow = _b.overflow,
      containerHeight = _b.scrollHeight,
      containerWidth = _b.scrollWidth,
      containerClientHeight = _b.clientHeight,
      containerClientWidth = _b.clientWidth,
      clientLeft = _b.clientLeft,
      clientTop = _b.clientTop;
  var _c = moveable.props,
      _d = _c.snapGap,
      snapGap = _d === void 0 ? true : _d,
      verticalGuidelines = _c.verticalGuidelines,
      horizontalGuidelines = _c.horizontalGuidelines,
      _e = _c.snapThreshold,
      snapThreshold = _e === void 0 ? 5 : _e,
      _f = _c.snapGridWidth,
      snapGridWidth = _f === void 0 ? 0 : _f,
      _g = _c.snapGridHeight,
      snapGridHeight = _g === void 0 ? 0 : _g;
  var elementGuidelines = getElementGuidelines(moveable);

  var totalGuidelines = __spreadArray([], elementGuidelines, true);

  if (snapGap) {
    var _h = moveable_esm_getRect(getAbsolutePosesByState(moveable.state)),
        top = _h.top,
        left = _h.left,
        bottom = _h.bottom,
        right = _h.right;

    totalGuidelines.push.apply(totalGuidelines, getGapGuidelines(moveable, {
      top: top,
      left: left,
      bottom: bottom,
      right: right,
      center: (left + right) / 2,
      middle: (top + bottom) / 2
    }, snapThreshold));
  }

  totalGuidelines.push.apply(totalGuidelines, getGridGuidelines(snapGridWidth, snapGridHeight, overflow ? containerWidth : containerClientWidth, overflow ? containerHeight : containerClientHeight, clientLeft, clientTop));
  totalGuidelines.push.apply(totalGuidelines, getDefaultGuidelines(horizontalGuidelines || false, verticalGuidelines || false, overflow ? containerWidth : containerClientWidth, overflow ? containerHeight : containerClientHeight, clientLeft, clientTop, snapOffset));
  return totalGuidelines;
}

function getGridGuidelines(snapGridWidth, snapGridHeight, containerWidth, containerHeight, clientLeft, clientTop) {
  if (clientLeft === void 0) {
    clientLeft = 0;
  }

  if (clientTop === void 0) {
    clientTop = 0;
  }

  var guidelines = [];

  if (snapGridHeight) {
    for (var pos = 0; pos <= containerHeight; pos += snapGridHeight) {
      guidelines.push({
        type: "horizontal",
        pos: [0, utils_esm_throttle(pos - clientTop, 0.1)],
        size: containerWidth,
        hide: true
      });
    }
  }

  if (snapGridWidth) {
    for (var pos = 0; pos <= containerWidth; pos += snapGridWidth) {
      guidelines.push({
        type: "vertical",
        pos: [utils_esm_throttle(pos - clientLeft, 0.1), 0],
        size: containerHeight,
        hide: true
      });
    }
  }

  return guidelines;
}

function solveLineConstants(_a) {
  var point1 = _a[0],
      point2 = _a[1];
  var dx = point2[0] - point1[0];
  var dy = point2[1] - point1[1];

  if (Math.abs(dx) < TINY_NUM) {
    dx = 0;
  }

  if (Math.abs(dy) < TINY_NUM) {
    dy = 0;
  } // b > 0
  // ax + by + c = 0


  var a = 0;
  var b = 0;
  var c = 0;

  if (!dx) {
    // -x + 1 = 0
    a = -1;
    c = point1[0];
  } else if (!dy) {
    // y - 1 = 0
    b = 1;
    c = -point1[1];
  } else {
    // y = -a(x - x1) + y1
    // ax + y + a * x1 - y1 = 0
    a = -dy / dx;
    b = 1;
    c = a * point1[0] - point1[1];
  }

  return [a, b, c].map(function (v) {
    return utils_esm_throttle(v, TINY_NUM);
  });
}

function checkMoveableSnapPoses(moveable, posesX, posesY, customSnapThreshold) {
  var props = moveable.props;
  var snapThreshold = selectValue(customSnapThreshold, props.snapThreshold, 5);
  return checkSnapPoses(moveable.state.guidelines, posesX, posesY, snapThreshold);
}

function checkSnapPoses(guidelines, posesX, posesY, snapThreshold) {
  return {
    vertical: checkSnap(guidelines, "vertical", posesX, snapThreshold),
    horizontal: checkSnap(guidelines, "horizontal", posesY, snapThreshold)
  };
}

function checkSnapKeepRatio(moveable, startPos, endPos) {
  var endX = endPos[0],
      endY = endPos[1];
  var startX = startPos[0],
      startY = startPos[1];

  var _a = minus(endPos, startPos),
      dx = _a[0],
      dy = _a[1];

  var isBottom = dy > 0;
  var isRight = dx > 0;
  dx = getTinyDist(dx);
  dy = getTinyDist(dy);
  var verticalInfo = {
    isSnap: false,
    offset: 0,
    pos: 0
  };
  var horizontalInfo = {
    isSnap: false,
    offset: 0,
    pos: 0
  };

  if (dx === 0 && dy === 0) {
    return {
      vertical: verticalInfo,
      horizontal: horizontalInfo
    };
  }

  var _b = checkMoveableSnapPoses(moveable, dx ? [endX] : [], dy ? [endY] : []),
      verticalSnapInfo = _b.vertical,
      horizontalSnapInfo = _b.horizontal;

  verticalSnapInfo.posInfos.filter(function (_a) {
    var pos = _a.pos;
    return isRight ? pos >= startX : pos <= startX;
  });
  horizontalSnapInfo.posInfos.filter(function (_a) {
    var pos = _a.pos;
    return isBottom ? pos >= startY : pos <= startY;
  });
  verticalSnapInfo.isSnap = verticalSnapInfo.posInfos.length > 0;
  horizontalSnapInfo.isSnap = horizontalSnapInfo.posInfos.length > 0;

  var _c = getNearestSnapGuidelineInfo(verticalSnapInfo),
      isVerticalSnap = _c.isSnap,
      verticalGuideline = _c.guideline;

  var _d = getNearestSnapGuidelineInfo(horizontalSnapInfo),
      isHorizontalSnap = _d.isSnap,
      horizontalGuideline = _d.guideline;

  var horizontalPos = isHorizontalSnap ? horizontalGuideline.pos[1] : 0;
  var verticalPos = isVerticalSnap ? verticalGuideline.pos[0] : 0;

  if (dx === 0) {
    if (isHorizontalSnap) {
      horizontalInfo.isSnap = true;
      horizontalInfo.pos = horizontalGuideline.pos[1];
      horizontalInfo.offset = endY - horizontalInfo.pos;
    }
  } else if (dy === 0) {
    if (isVerticalSnap) {
      verticalInfo.isSnap = true;
      verticalInfo.pos = verticalPos;
      verticalInfo.offset = endX - verticalPos;
    }
  } else {
    // y - y1 = a * (x - x1)
    var a = dy / dx;
    var b = endPos[1] - a * endX;
    var y = 0;
    var x = 0;
    var isSnap = false;

    if (isVerticalSnap) {
      x = verticalPos;
      y = a * x + b;
      isSnap = true;
    } else if (isHorizontalSnap) {
      y = horizontalPos;
      x = (y - b) / a;
      isSnap = true;
    }

    if (isSnap) {
      verticalInfo.isSnap = true;
      verticalInfo.pos = x;
      verticalInfo.offset = endX - x;
      horizontalInfo.isSnap = true;
      horizontalInfo.pos = y;
      horizontalInfo.offset = endY - y;
    }
  }

  return {
    vertical: verticalInfo,
    horizontal: horizontalInfo
  };
}

function checkSnaps(moveable, rect, customSnapThreshold) {
  var poses = splitSnapDirectionPoses(moveable.props.snapDirections, rect);
  return checkMoveableSnapPoses(moveable, poses.vertical, poses.horizontal, customSnapThreshold);
}

function getNearestSnapGuidelineInfo(snapInfo) {
  var isSnap = snapInfo.isSnap;

  if (!isSnap) {
    return {
      isSnap: false,
      offset: 0,
      dist: -1,
      pos: 0,
      guideline: null
    };
  }

  var posInfo = snapInfo.posInfos[0];
  var guidelineInfo = posInfo.guidelineInfos[0];
  var offset = guidelineInfo.offset;
  var dist = guidelineInfo.dist;
  var guideline = guidelineInfo.guideline;
  return {
    isSnap: isSnap,
    offset: offset,
    dist: dist,
    pos: posInfo.pos,
    guideline: guideline
  };
}

function checkSnap(guidelines, targetType, targetPoses, snapThreshold) {
  if (!guidelines || !guidelines.length) {
    return {
      isSnap: false,
      index: -1,
      posInfos: []
    };
  }

  var isVertical = targetType === "vertical";
  var posType = isVertical ? 0 : 1;
  var snapPosInfos = targetPoses.map(function (targetPos, index) {
    var guidelineInfos = guidelines.map(function (guideline) {
      var pos = guideline.pos;
      var offset = targetPos - pos[posType];
      return {
        offset: offset,
        dist: Math.abs(offset),
        guideline: guideline
      };
    }).filter(function (_a) {
      var guideline = _a.guideline,
          dist = _a.dist;
      var type = guideline.type;

      if (type !== targetType || dist > snapThreshold) {
        return false;
      }

      return true;
    }).sort(function (a, b) {
      return a.dist - b.dist;
    });
    return {
      pos: targetPos,
      index: index,
      guidelineInfos: guidelineInfos
    };
  }).filter(function (snapPosInfo) {
    return snapPosInfo.guidelineInfos.length > 0;
  }).sort(function (a, b) {
    return a.guidelineInfos[0].dist - b.guidelineInfos[0].dist;
  });
  var isSnap = snapPosInfos.length > 0;
  return {
    isSnap: isSnap,
    index: isSnap ? snapPosInfos[0].index : -1,
    posInfos: snapPosInfos
  };
}

function getSnapInfosByDirection(moveable, poses, snapDirection) {
  var nextPoses = [];

  if (snapDirection[0] && snapDirection[1]) {
    nextPoses = [snapDirection, [-snapDirection[0], snapDirection[1]], [snapDirection[0], -snapDirection[1]]].map(function (direction) {
      return getPosByDirection(poses, direction);
    });
  } else if (!snapDirection[0] && !snapDirection[1]) {
    var alignPoses = [poses[0], poses[1], poses[3], poses[2], poses[0]];

    for (var i = 0; i < 4; ++i) {
      nextPoses.push(alignPoses[i]);
      nextPoses.push([(alignPoses[i][0] + alignPoses[i + 1][0]) / 2, (alignPoses[i][1] + alignPoses[i + 1][1]) / 2]);
    }
  } else {
    if (moveable.props.keepRatio) {
      nextPoses = [[-1, -1], [-1, 1], [1, -1], [1, 1], snapDirection].map(function (dir) {
        return getPosByDirection(poses, dir);
      });
    } else {
      nextPoses = getPosesByDirection(poses, snapDirection);

      if (nextPoses.length > 1) {
        nextPoses.push([(nextPoses[0][0] + nextPoses[1][0]) / 2, (nextPoses[0][1] + nextPoses[1][1]) / 2]);
      }
    }
  }

  return checkMoveableSnapPoses(moveable, nextPoses.map(function (pos) {
    return pos[0];
  }), nextPoses.map(function (pos) {
    return pos[1];
  }), 1);
}

function checkSnapBoundPriority(a, b) {
  var aDist = Math.abs(a.offset);
  var bDist = Math.abs(b.offset);

  if (a.isBound && b.isBound) {
    return bDist - aDist;
  } else if (a.isBound) {
    return -1;
  } else if (b.isBound) {
    return 1;
  } else if (a.isSnap && b.isSnap) {
    return bDist - aDist;
  } else if (a.isSnap) {
    return -1;
  } else if (b.isSnap) {
    return 1;
  } else if (aDist < moveable_esm_TINY_NUM) {
    return 1;
  } else if (bDist < moveable_esm_TINY_NUM) {
    return -1;
  }

  return aDist - bDist;
}

function getNearOffsetInfo(offsets, index) {
  return offsets.slice().sort(function (a, b) {
    var aSign = a.sign[index];
    var bSign = b.sign[index];
    var aOffset = a.offset[index];
    var bOffset = b.offset[index]; // -1 The positions of a and b do not change.
    // 1 The positions of a and b are reversed.

    if (!aSign) {
      return 1;
    } else if (!bSign) {
      return -1;
    }

    return checkSnapBoundPriority({
      isBound: a.isBound,
      isSnap: a.isSnap,
      offset: aOffset
    }, {
      isBound: b.isBound,
      isSnap: b.isSnap,
      offset: bOffset
    });
  })[0];
}

function getCheckSnapDirections(direction, fixedDirection, keepRatio) {
  var directions = []; // const fixedDirection = [-direction[0], -direction[1]];

  if (keepRatio) {
    if (Math.abs(fixedDirection[0]) !== 1 || Math.abs(fixedDirection[1]) !== 1) {
      directions.push([fixedDirection, [-1, -1]], [fixedDirection, [-1, 1]], [fixedDirection, [1, -1]], [fixedDirection, [1, 1]]);
    } else {
      directions.push([fixedDirection, [direction[0], -direction[1]]], [fixedDirection, [-direction[0], direction[1]]]);
    }

    directions.push([fixedDirection, direction]);
  } else {
    if (direction[0] && direction[1] || !direction[0] && !direction[1]) {
      var endDirection_1 = direction[0] ? direction : [1, 1];
      [1, -1].forEach(function (signX) {
        [1, -1].forEach(function (signY) {
          var nextDirection = [signX * endDirection_1[0], signY * endDirection_1[1]];

          if (fixedDirection[0] === nextDirection[0] && fixedDirection[1] === nextDirection[1]) {
            return;
          }

          directions.push([fixedDirection, nextDirection]);
        });
      });
    } else if (direction[0]) {
      var signs = Math.abs(fixedDirection[0]) === 1 ? [1] : [1, -1];
      signs.forEach(function (sign) {
        directions.push([[fixedDirection[0], -1], [sign * direction[0], -1]], [[fixedDirection[0], 0], [sign * direction[0], 0]], [[fixedDirection[0], 1], [sign * direction[0], 1]]);
      });
    } else if (direction[1]) {
      var signs = Math.abs(fixedDirection[1]) === 1 ? [1] : [1, -1];
      signs.forEach(function (sign) {
        directions.push([[-1, fixedDirection[1]], [-1, sign * direction[1]]], [[0, fixedDirection[1]], [0, sign * direction[1]]], [[1, fixedDirection[1]], [1, sign * direction[1]]]);
      });
    }
  }

  return directions;
}

function isStartLine(dot, line) {
  // l    o     => true
  // o    l    => false
  var cx = utils_esm_average([line[0][0], line[1][0]]);
  var cy = utils_esm_average([line[0][1], line[1][1]]);
  return {
    vertical: cx <= dot[0],
    horizontal: cy <= dot[1]
  };
}

function hitTestLine(dot, _a) {
  var pos1 = _a[0],
      pos2 = _a[1];
  var dx = pos2[0] - pos1[0];
  var dy = pos2[1] - pos1[1];

  if (Math.abs(dx) < moveable_esm_TINY_NUM) {
    dx = 0;
  }

  if (Math.abs(dy) < moveable_esm_TINY_NUM) {
    dy = 0;
  }

  var test1;
  var test2;

  if (!dx) {
    test1 = pos1[0];
    test2 = dot[0];
  } else if (!dy) {
    test1 = pos1[1];
    test2 = dot[1];
  } else {
    var a = dy / dx; // y = a * (x - pos1) + pos1

    test1 = a * (dot[0] - pos1[0]) + pos1[1];
    test2 = dot[1];
  }

  return test1 - test2;
}

function isSameStartLine(dots, line, centerSign, error) {
  if (error === void 0) {
    error = moveable_esm_TINY_NUM;
  }

  return dots.every(function (dot) {
    var value = hitTestLine(dot, line);
    var sign = value <= 0;
    return sign === centerSign || Math.abs(value) <= error;
  });
}

function checkInnerBoundDot(pos, start, end, isStart, threshold) {
  if (threshold === void 0) {
    threshold = 0;
  }

  if (isStart && start - threshold <= pos || !isStart && pos <= end + threshold) {
    // false 402 565 602 => 37 ([0, 37])
    // true 400 524.9712603540036 600 => 124 ([124, 0])
    // true 400 410 600 => 10 ([10, 0])
    return {
      isBound: true,
      offset: isStart ? start - pos : end - pos
    };
  }

  return {
    isBound: false,
    offset: 0
  };
}

function checkInnerBound(moveable, _a) {
  var line = _a.line,
      centerSign = _a.centerSign,
      verticalSign = _a.verticalSign,
      horizontalSign = _a.horizontalSign,
      lineConstants = _a.lineConstants;
  var bounds = moveable.props.innerBounds;

  if (!bounds) {
    return {
      isAllBound: false,
      isBound: false,
      isVerticalBound: false,
      isHorizontalBound: false,
      offset: [0, 0]
    };
  }

  var left = bounds.left,
      top = bounds.top,
      width = bounds.width,
      height = bounds.height;
  var leftLine = [[left, top], [left, top + height]];
  var topLine = [[left, top], [left + width, top]];
  var rightLine = [[left + width, top], [left + width, top + height]];
  var bottomLine = [[left, top + height], [left + width, top + height]];

  if (isSameStartLine([[left, top], [left + width, top], [left, top + height], [left + width, top + height]], line, centerSign)) {
    return {
      isAllBound: false,
      isBound: false,
      isVerticalBound: false,
      isHorizontalBound: false,
      offset: [0, 0]
    };
  } // test vertical


  var topBoundInfo = checkLineBoundCollision(line, lineConstants, topLine, verticalSign);
  var bottomBoundInfo = checkLineBoundCollision(line, lineConstants, bottomLine, verticalSign); // test horizontal

  var leftBoundInfo = checkLineBoundCollision(line, lineConstants, leftLine, horizontalSign);
  var rightBoundInfo = checkLineBoundCollision(line, lineConstants, rightLine, horizontalSign);
  var isAllVerticalBound = topBoundInfo.isBound && bottomBoundInfo.isBound;
  var isVerticalBound = topBoundInfo.isBound || bottomBoundInfo.isBound;
  var isAllHorizontalBound = leftBoundInfo.isBound && rightBoundInfo.isBound;
  var isHorizontalBound = leftBoundInfo.isBound || rightBoundInfo.isBound;
  var verticalOffset = maxOffset(topBoundInfo.offset, bottomBoundInfo.offset);
  var horizontalOffset = maxOffset(leftBoundInfo.offset, rightBoundInfo.offset);
  var offset = [0, 0];
  var isBound = false;
  var isAllBound = false;

  if (Math.abs(horizontalOffset) < Math.abs(verticalOffset)) {
    offset = [verticalOffset, 0];
    isBound = isVerticalBound;
    isAllBound = isAllVerticalBound;
  } else {
    offset = [0, horizontalOffset];
    isBound = isHorizontalBound;
    isAllBound = isAllHorizontalBound;
  }

  return {
    isAllBound: isAllBound,
    isVerticalBound: isVerticalBound,
    isHorizontalBound: isHorizontalBound,
    isBound: isBound,
    offset: offset
  };
}

function checkLineBoundCollision(line, _a, boundLine, isStart, threshold, isRender) {
  var a = _a[0],
      b = _a[1];
  var dot1 = line[0]; // const dot2 = line[1];

  var boundDot1 = boundLine[0];
  var boundDot2 = boundLine[1]; // const dy1 = getTinyDist(dot2[1] - dot1[1]);
  // const dx1 = getTinyDist(dot2[0] - dot1[0]);

  var dy2 = getTinyDist(boundDot2[1] - boundDot1[1]);
  var dx2 = getTinyDist(boundDot2[0] - boundDot1[0]);
  var hasDx = b;
  var hasDy = a;
  var slope = -a / b; // lineConstants
  // ax + by + c = 0
  // dx2 or dy2 is zero

  if (!dx2) {
    // vertical
    // by + c = 0
    if (isRender && !hasDy) {
      // 90deg
      return {
        isBound: false,
        offset: 0
      };
    } else if (hasDx) {
      // ax + by + c = 0
      // const y = dy1 ? dy1 / dx1 * (boundDot1[0] - dot1[0]) + dot1[1] : dot1[1];
      var y = slope * (boundDot1[0] - dot1[0]) + dot1[1]; // boundDot1[1] <= y  <= boundDot2[1]

      return checkInnerBoundDot(y, boundDot1[1], boundDot2[1], isStart, threshold);
    } else {
      // ax + c = 0
      var offset = boundDot1[0] - dot1[0];
      var isBound = Math.abs(offset) <= (threshold || 0);
      return {
        isBound: isBound,
        offset: isBound ? offset : 0
      };
    }
  } else if (!dy2) {
    // horizontal
    if (isRender && !hasDx) {
      // 90deg
      return {
        isBound: false,
        offset: 0
      };
    } else if (hasDy) {
      // y = a * (x - x1) + y1
      // x = (y - y1) / a + x1
      // const a = dy1 / dx1;
      // const x = dx1 ? (boundDot1[1] - dot1[1]) / a + dot1[0] : dot1[0];
      var x = (boundDot1[1] - dot1[1]) / slope + dot1[0]; // boundDot1[0] <= x && x <= boundDot2[0]

      return checkInnerBoundDot(x, boundDot1[0], boundDot2[0], isStart, threshold);
    } else {
      var offset = boundDot1[1] - dot1[1];
      var isBound = Math.abs(offset) <= (threshold || 0);
      return {
        isBound: isBound,
        offset: isBound ? offset : 0
      };
    }
  }

  return {
    isBound: false,
    offset: 0
  };
}

function getInnerBoundInfo(moveable, lineInfos, datas) {
  return lineInfos.map(function (info) {
    var _a = checkInnerBound(moveable, info),
        isBound = _a.isBound,
        offset = _a.offset,
        isVerticalBound = _a.isVerticalBound,
        isHorizontalBound = _a.isHorizontalBound;

    var multiple = info.multiple;
    var sizeOffset = getDragDist({
      datas: datas,
      distX: offset[0],
      distY: offset[1]
    }).map(function (size, i) {
      return size * (multiple[i] ? 2 / multiple[i] : 0);
    });
    return {
      sign: multiple,
      isBound: isBound,
      isVerticalBound: isVerticalBound,
      isHorizontalBound: isHorizontalBound,
      isSnap: false,
      offset: sizeOffset
    };
  });
}

function getInnerBoundDragInfo(moveable, poses, datas) {
  var _a;

  var lines = getCheckInnerBoundLineInfos(moveable, poses, [0, 0], false).map(function (info) {
    return moveable_esm_assign(moveable_esm_assign({}, info), {
      multiple: info.multiple.map(function (dir) {
        return Math.abs(dir) * 2;
      })
    });
  });
  var innerBoundInfo = getInnerBoundInfo(moveable, lines, datas);
  var widthOffsetInfo = getNearOffsetInfo(innerBoundInfo, 0);
  var heightOffsetInfo = getNearOffsetInfo(innerBoundInfo, 1);
  var verticalOffset = 0;
  var horizontalOffset = 0;
  var isVerticalBound = widthOffsetInfo.isVerticalBound || heightOffsetInfo.isVerticalBound;
  var isHorizontalBound = widthOffsetInfo.isHorizontalBound || heightOffsetInfo.isHorizontalBound;

  if (isVerticalBound || isHorizontalBound) {
    _a = getInverseDragDist({
      datas: datas,
      distX: -widthOffsetInfo.offset[0],
      distY: -heightOffsetInfo.offset[1]
    }), verticalOffset = _a[0], horizontalOffset = _a[1];
  }

  return {
    vertical: {
      isBound: isVerticalBound,
      offset: verticalOffset
    },
    horizontal: {
      isBound: isHorizontalBound,
      offset: horizontalOffset
    }
  };
}

function getCheckSnapLineDirections(direction, keepRatio) {
  var lineDirections = [];
  var x = direction[0];
  var y = direction[1];

  if (x && y) {
    lineDirections.push([[0, y * 2], direction, [-x, y]], [[x * 2, 0], direction, [x, -y]]);
  } else if (x) {
    // vertcal
    lineDirections.push([[x * 2, 0], [x, 1], [x, -1]]);

    if (keepRatio) {
      lineDirections.push([[0, -1], [x, -1], [-x, -1]], [[0, 1], [x, 1], [-x, 1]]);
    }
  } else if (y) {
    // horizontal
    lineDirections.push([[0, y * 2], [1, y], [-1, y]]);

    if (keepRatio) {
      lineDirections.push([[-1, 0], [-1, y], [-1, -y]], [[1, 0], [1, y], [1, -y]]);
    }
  } else {
    // [0, 0] to all direction
    lineDirections.push([[-1, 0], [-1, -1], [-1, 1]], [[1, 0], [1, -1], [1, 1]], [[0, -1], [-1, -1], [1, -1]], [[0, 1], [-1, 1], [1, 1]]);
  }

  return lineDirections;
}

function getCheckInnerBoundLineInfos(moveable, poses, direction, keepRatio) {
  var _a = moveable.state,
      allMatrix = _a.allMatrix,
      is3d = _a.is3d;
  var virtualPoses = calculatePoses(allMatrix, 100, 100, is3d ? 4 : 3);
  var center = getPosByDirection(virtualPoses, [0, 0]);
  return getCheckSnapLineDirections(direction, keepRatio).map(function (_a) {
    var multiple = _a[0],
        dir1 = _a[1],
        dir2 = _a[2];
    var virtualLine = [getPosByDirection(virtualPoses, dir1), getPosByDirection(virtualPoses, dir2)];
    var lineConstants = solveLineConstants(virtualLine);

    var _b = isStartLine(center, virtualLine),
        verticalSign = _b.vertical,
        horizontalSign = _b.horizontal;

    var centerSign = hitTestLine(center, virtualLine) <= 0;
    return {
      multiple: multiple,
      centerSign: centerSign,
      verticalSign: verticalSign,
      horizontalSign: horizontalSign,
      lineConstants: lineConstants,
      line: [getPosByDirection(poses, dir1), getPosByDirection(poses, dir2)]
    };
  });
}

function isBoundRotate$1(relativePoses, boundDots, center, rad) {
  var nextPoses = rad ? relativePoses.map(function (pos) {
    return rotate(pos, rad);
  }) : relativePoses;
  return [[nextPoses[0], nextPoses[1]], [nextPoses[1], nextPoses[3]], [nextPoses[3], nextPoses[2]], [nextPoses[2], nextPoses[0]]].some(function (line) {
    var centerSign = hitTestLine(center, line) <= 0;
    return !isSameStartLine(boundDots, line, centerSign);
  });
}

function getDistPointLine(_a) {
  // x = 0, y = 0
  // d = (ax + by + c) / root(a2 + b2)
  var pos1 = _a[0],
      pos2 = _a[1];
  var dx = pos2[0] - pos1[0];
  var dy = pos2[1] - pos1[1];

  if (!dx) {
    return Math.abs(pos1[0]);
  }

  if (!dy) {
    return Math.abs(pos1[1]);
  } // y - y1 = a(x - x1)
  // 0 = ax -y + -a * x1 + y1


  var a = dy / dx;
  return Math.abs((-a * pos1[0] + pos1[1]) / Math.sqrt(Math.pow(a, 2) + 1));
}

function solveReverseLine(_a) {
  var pos1 = _a[0],
      pos2 = _a[1];
  var dx = pos2[0] - pos1[0];
  var dy = pos2[1] - pos1[1];

  if (!dx) {
    return [pos1[0], 0];
  }

  if (!dy) {
    return [0, pos1[1]];
  }

  var a = dy / dx; // y - y1 = a (x  - x1)
  // y = ax - a * x1 + y1

  var b = -a * pos1[0] + pos1[1]; // y = ax + b = -1/a x
  // x = -b / (a + 1 / a)
  // y = b / (1 + 1 / a^2)

  return [-b / (a + 1 / a), b / (a * a + 1)];
}

function checkRotateInnerBounds(moveable, prevPoses, nextPoses, origin, rotation) {
  var bounds = moveable.props.innerBounds;
  var rad = rotation * Math.PI / 180;

  if (!bounds) {
    return [];
  }

  var left = bounds.left,
      top = bounds.top,
      width = bounds.width,
      height = bounds.height;
  var relativeLeft = left - origin[0];
  var relativeRight = left + width - origin[0];
  var relativeTop = top - origin[1];
  var relativeBottom = top + height - origin[1];
  var dots = [[relativeLeft, relativeTop], [relativeRight, relativeTop], [relativeLeft, relativeBottom], [relativeRight, relativeBottom]];
  var center = getPosByDirection(nextPoses, [0, 0]);

  if (!isBoundRotate$1(nextPoses, dots, center, 0)) {
    return [];
  }

  var result = [];
  var dotInfos = dots.map(function (dot) {
    return [getDistSize(dot), getRad([0, 0], dot)];
  });
  [[nextPoses[0], nextPoses[1]], [nextPoses[1], nextPoses[3]], [nextPoses[3], nextPoses[2]], [nextPoses[2], nextPoses[0]]].forEach(function (line) {
    var lineRad = getRad([0, 0], solveReverseLine(line));
    var lineDist = getDistPointLine(line);
    result.push.apply(result, dotInfos.filter(function (_a) {
      var dotDist = _a[0];
      return dotDist && lineDist <= dotDist;
    }).map(function (_a) {
      var dotDist = _a[0],
          dotRad = _a[1];
      var distRad = Math.acos(dotDist ? lineDist / dotDist : 0);
      var nextRad1 = dotRad + distRad;
      var nextRad2 = dotRad - distRad;
      return [rad + nextRad1 - lineRad, rad + nextRad2 - lineRad];
    }).reduce(function (prev, cur) {
      prev.push.apply(prev, cur);
      return prev;
    }, []).filter(function (nextRad) {
      return !isBoundRotate$1(prevPoses, dots, center, nextRad);
    }).map(function (nextRad) {
      return utils_esm_throttle(nextRad * 180 / Math.PI, moveable_esm_TINY_NUM);
    }));
  });
  return result;
}

function checkInnerBoundPoses(moveable) {
  var innerBounds = moveable.props.innerBounds;

  if (!innerBounds) {
    return {
      vertical: [],
      horizontal: []
    };
  }

  var _a = moveable.getRect(),
      pos1 = _a.pos1,
      pos2 = _a.pos2,
      pos3 = _a.pos3,
      pos4 = _a.pos4;

  var poses = [pos1, pos2, pos3, pos4];
  var center = getPosByDirection(poses, [0, 0]);
  var left = innerBounds.left,
      top = innerBounds.top,
      width = innerBounds.width,
      height = innerBounds.height;
  var leftLine = [[left, top], [left, top + height]];
  var topLine = [[left, top], [left + width, top]];
  var rightLine = [[left + width, top], [left + width, top + height]];
  var bottomLine = [[left, top + height], [left + width, top + height]];
  var lineInfos = getCheckInnerBoundLineInfos(moveable, poses, [0, 0], false);
  var horizontalPoses = [];
  var verticalPoses = [];
  var boundMap = {
    top: false,
    bottom: false,
    left: false,
    right: false
  };
  lineInfos.forEach(function (lineInfo) {
    var line = lineInfo.line,
        lineConstants = lineInfo.lineConstants;

    var _a = isStartLine(center, line),
        isHorizontalStart = _a.horizontal,
        isVerticalStart = _a.vertical; // test vertical


    var topBoundInfo = checkLineBoundCollision(line, lineConstants, topLine, isVerticalStart, 1, true);
    var bottomBoundInfo = checkLineBoundCollision(line, lineConstants, bottomLine, isVerticalStart, 1, true); // test horizontal

    var leftBoundInfo = checkLineBoundCollision(line, lineConstants, leftLine, isHorizontalStart, 1, true);
    var rightBoundInfo = checkLineBoundCollision(line, lineConstants, rightLine, isHorizontalStart, 1, true);

    if (topBoundInfo.isBound && !boundMap.top) {
      horizontalPoses.push(top);
      boundMap.top = true;
    }

    if (bottomBoundInfo.isBound && !boundMap.bottom) {
      horizontalPoses.push(top + height);
      boundMap.bottom = true;
    }

    if (leftBoundInfo.isBound && !boundMap.left) {
      verticalPoses.push(left);
      boundMap.left = true;
    }

    if (rightBoundInfo.isBound && !boundMap.right) {
      verticalPoses.push(left + width);
      boundMap.right = true;
    }
  });
  return {
    horizontal: horizontalPoses,
    vertical: verticalPoses
  };
}

function checkBoundPoses(bounds, verticalPoses, horizontalPoses) {
  var _a = bounds || {},
      _b = _a.position,
      position = _b === void 0 ? "client" : _b,
      _c = _a.left,
      left = _c === void 0 ? -Infinity : _c,
      _d = _a.top,
      top = _d === void 0 ? -Infinity : _d,
      _e = _a.right,
      right = _e === void 0 ? Infinity : _e,
      _f = _a.bottom,
      bottom = _f === void 0 ? Infinity : _f;

  var nextBounds = {
    position: position,
    left: left,
    top: top,
    right: right,
    bottom: bottom
  };
  return {
    vertical: checkBounds(nextBounds, verticalPoses, true),
    horizontal: checkBounds(nextBounds, horizontalPoses, false)
  };
}

function getBounds(moveable, externalBounds) {
  var _a = moveable.state,
      _b = _a.containerClientRect,
      containerHeight = _b.clientHeight,
      containerWidth = _b.clientWidth,
      clientLeft = _b.clientLeft,
      clientTop = _b.clientTop,
      _c = _a.snapOffset,
      snapOffsetLeft = _c.left,
      snapOffsetTop = _c.top,
      snapOffsetRight = _c.right,
      snapOffsetBottom = _c.bottom;
  var bounds = externalBounds || moveable.props.bounds || {};
  var position = bounds.position || "client";
  var isCSS = position === "css";
  var _d = bounds.left,
      left = _d === void 0 ? -Infinity : _d,
      _e = bounds.top,
      top = _e === void 0 ? -Infinity : _e;
  var _f = bounds.right,
      right = _f === void 0 ? isCSS ? -Infinity : Infinity : _f,
      _g = bounds.bottom,
      bottom = _g === void 0 ? isCSS ? -Infinity : Infinity : _g;

  if (isCSS) {
    right = containerWidth + snapOffsetRight - snapOffsetLeft - right;
    bottom = containerHeight + snapOffsetBottom - snapOffsetTop - bottom;
  }

  return {
    left: left + snapOffsetLeft - clientLeft,
    right: right + snapOffsetLeft - clientLeft,
    top: top + snapOffsetTop - clientTop,
    bottom: bottom + snapOffsetTop - clientTop
  };
}

function checkBoundKeepRatio(moveable, startPos, endPos) {
  var _a = getBounds(moveable),
      left = _a.left,
      top = _a.top,
      right = _a.right,
      bottom = _a.bottom;

  var endX = endPos[0],
      endY = endPos[1];

  var _b = minus(endPos, startPos),
      dx = _b[0],
      dy = _b[1];

  if (Math.abs(dx) < moveable_esm_TINY_NUM) {
    dx = 0;
  }

  if (Math.abs(dy) < moveable_esm_TINY_NUM) {
    dy = 0;
  }

  var isBottom = dy > 0;
  var isRight = dx > 0;
  var verticalInfo = {
    isBound: false,
    offset: 0,
    pos: 0
  };
  var horizontalInfo = {
    isBound: false,
    offset: 0,
    pos: 0
  };

  if (dx === 0 && dy === 0) {
    return {
      vertical: verticalInfo,
      horizontal: horizontalInfo
    };
  } else if (dx === 0) {
    if (isBottom) {
      if (bottom < endY) {
        horizontalInfo.pos = bottom;
        horizontalInfo.offset = endY - bottom;
      }
    } else {
      if (top > endY) {
        horizontalInfo.pos = top;
        horizontalInfo.offset = endY - top;
      }
    }
  } else if (dy === 0) {
    if (isRight) {
      if (right < endX) {
        verticalInfo.pos = right;
        verticalInfo.offset = endX - right;
      }
    } else {
      if (left > endX) {
        verticalInfo.pos = left;
        verticalInfo.offset = endX - left;
      }
    }
  } else {
    // y - y1 = a * (x - x1)
    var a = dy / dx;
    var b = endPos[1] - a * endX;
    var y = 0;
    var x = 0;
    var isBound = false;

    if (isRight && right <= endX) {
      y = a * right + b;
      x = right;
      isBound = true;
    } else if (!isRight && endX <= left) {
      y = a * left + b;
      x = left;
      isBound = true;
    }

    if (isBound) {
      if (y < top || y > bottom) {
        isBound = false;
      }
    }

    if (!isBound) {
      if (isBottom && bottom <= endY) {
        y = bottom;
        x = (y - b) / a;
        isBound = true;
      } else if (!isBottom && endY <= top) {
        y = top;
        x = (y - b) / a;
        isBound = true;
      }
    }

    if (isBound) {
      verticalInfo.isBound = true;
      verticalInfo.pos = x;
      verticalInfo.offset = endX - x;
      horizontalInfo.isBound = true;
      horizontalInfo.pos = y;
      horizontalInfo.offset = endY - y;
    }
  }

  return {
    vertical: verticalInfo,
    horizontal: horizontalInfo
  };
}

function checkBounds(bounds, poses, isVertical) {
  // 0   [100 - 200]  300
  var startBoundPos = bounds[isVertical ? "left" : "top"];
  var endBoundPos = bounds[isVertical ? "right" : "bottom"]; // 450

  var minPos = Math.min.apply(Math, poses);
  var maxPos = Math.max.apply(Math, poses);
  var boundInfos = [];

  if (startBoundPos + 1 > minPos) {
    boundInfos.push({
      isBound: true,
      offset: minPos - startBoundPos,
      pos: startBoundPos
    });
  }

  if (endBoundPos - 1 < maxPos) {
    boundInfos.push({
      isBound: true,
      offset: maxPos - endBoundPos,
      pos: endBoundPos
    });
  }

  if (!boundInfos.length) {
    boundInfos.push({
      isBound: false,
      offset: 0,
      pos: 0
    });
  }

  return boundInfos.sort(function (a, b) {
    return Math.abs(b.offset) - Math.abs(a.offset);
  });
}

function isBoundRotate(relativePoses, boundRect, rad) {
  var nextPoses = rad ? relativePoses.map(function (pos) {
    return rotate(pos, rad);
  }) : relativePoses;
  return nextPoses.some(function (pos) {
    return pos[0] < boundRect.left && Math.abs(pos[0] - boundRect.left) > 0.1 || pos[0] > boundRect.right && Math.abs(pos[0] - boundRect.right) > 0.1 || pos[1] < boundRect.top && Math.abs(pos[1] - boundRect.top) > 0.1 || pos[1] > boundRect.bottom && Math.abs(pos[1] - boundRect.bottom) > 0.1;
  });
}

function boundRotate(vec, boundPos, index) {
  var r = getDistSize(vec);
  var nextPos = Math.sqrt(r * r - boundPos * boundPos) || 0;
  return [nextPos, -nextPos].sort(function (a, b) {
    return Math.abs(a - vec[index ? 0 : 1]) - Math.abs(b - vec[index ? 0 : 1]);
  }).map(function (pos) {
    return getRad([0, 0], index ? [pos, boundPos] : [boundPos, pos]);
  });
}

function checkRotateBounds(moveable, prevPoses, nextPoses, origin, rotation) {
  if (!moveable.props.bounds) {
    return [];
  }

  var rad = rotation * Math.PI / 180;

  var _a = getBounds(moveable),
      left = _a.left,
      top = _a.top,
      right = _a.right,
      bottom = _a.bottom;

  var relativeLeft = left - origin[0];
  var relativeRight = right - origin[0];
  var relativeTop = top - origin[1];
  var relativeBottom = bottom - origin[1];
  var boundRect = {
    left: relativeLeft,
    top: relativeTop,
    right: relativeRight,
    bottom: relativeBottom
  };

  if (!isBoundRotate(nextPoses, boundRect, 0)) {
    return [];
  }

  var result = [];
  [[relativeLeft, 0], [relativeRight, 0], [relativeTop, 1], [relativeBottom, 1]].forEach(function (_a) {
    var boundPos = _a[0],
        index = _a[1];
    nextPoses.forEach(function (nextPos) {
      var relativeRad1 = getRad([0, 0], nextPos);
      result.push.apply(result, boundRotate(nextPos, boundPos, index).map(function (relativeRad2) {
        return rad + relativeRad2 - relativeRad1;
      }).filter(function (nextRad) {
        return !isBoundRotate(prevPoses, boundRect, nextRad);
      }).map(function (nextRad) {
        return utils_esm_throttle(nextRad * 180 / Math.PI, moveable_esm_TINY_NUM);
      }));
    });
  });
  return result;
}

function renderGuideline(info, React) {
  var _a;

  var direction = info.direction,
      classNames = info.classNames,
      size = info.size,
      pos = info.pos,
      zoom = info.zoom,
      key = info.key;
  var isHorizontal = direction === "horizontal";
  var scaleType = isHorizontal ? "Y" : "X"; // const scaleType2 = isHorizontal ? "Y" : "X";

  return React.createElement("div", {
    key: key,
    className: classNames.join(" "),
    style: (_a = {}, _a[isHorizontal ? "width" : "height"] = "".concat(size), _a.transform = "translate(".concat(pos[0], ", ").concat(pos[1], ") translate").concat(scaleType, "(-50%) scale").concat(scaleType, "(").concat(zoom, ")"), _a)
  });
}

function renderInnerGuideline(info, React) {
  return renderGuideline(moveable_esm_assign(moveable_esm_assign({}, info), {
    classNames: __spreadArray([prefix("line", "guideline", info.direction)], info.classNames, true).filter(function (className) {
      return className;
    }),
    size: info.size || "".concat(info.sizeValue, "px"),
    pos: info.pos || info.posValue.map(function (v) {
      return "".concat(utils_esm_throttle(v, 0.1), "px");
    })
  }), React);
}

function renderSnapPoses(moveable, direction, snapPoses, minPos, targetPos, size, index, React) {
  var zoom = moveable.props.zoom;
  return snapPoses.map(function (_a, i) {
    var type = _a.type,
        pos = _a.pos;
    var renderPos = [0, 0];
    renderPos[index] = minPos;
    renderPos[index ? 0 : 1] = -targetPos + pos;
    return renderInnerGuideline({
      key: "".concat(direction, "TargetGuideline").concat(i),
      classNames: [prefix("target", "bold", type)],
      posValue: renderPos,
      sizeValue: size,
      zoom: zoom,
      direction: direction
    }, React);
  });
}

function renderGuidelines(moveable, type, guidelines, targetPos, targetRect, React) {
  var _a = moveable.props,
      zoom = _a.zoom,
      isDisplayInnerSnapDigit = _a.isDisplayInnerSnapDigit;
  var mainNames = type === "horizontal" ? VERTICAL_NAMES_MAP : HORIZONTAL_NAMES_MAP;
  var targetStart = targetRect[mainNames.start];
  var targetEnd = targetRect[mainNames.end];
  return guidelines.filter(function (_a) {
    var hide = _a.hide,
        elementRect = _a.elementRect;

    if (hide) {
      return false;
    }

    if (isDisplayInnerSnapDigit && elementRect) {
      // inner
      var rect = elementRect.rect;

      if (rect[mainNames.start] <= targetStart && targetEnd <= rect[mainNames.end]) {
        return false;
      }
    }

    return true;
  }).map(function (guideline, i) {
    var pos = guideline.pos,
        size = guideline.size,
        element = guideline.element;
    var renderPos = [-targetPos[0] + pos[0], -targetPos[1] + pos[1]];
    return renderInnerGuideline({
      key: "".concat(type, "-default-guideline-").concat(i),
      classNames: element ? [prefix("bold")] : [],
      direction: type,
      posValue: renderPos,
      sizeValue: size,
      zoom: zoom
    }, React);
  });
}

function renderDigitLine(moveable, type, lineType, index, gap, renderPos, className, React) {
  var _a;

  var _b = moveable.props,
      _c = _b.snapDigit,
      snapDigit = _c === void 0 ? 0 : _c,
      _d = _b.isDisplaySnapDigit,
      isDisplaySnapDigit = _d === void 0 ? true : _d,
      _e = _b.snapDistFormat,
      snapDistFormat = _e === void 0 ? function (v, type) {
    // Type can be used render different values.
    if (type === 'vertical') {
      return v;
    }

    return v;
  } : _e,
      zoom = _b.zoom;
  var scaleType = type === "horizontal" ? "X" : "Y";
  var sizeName = type === "vertical" ? "height" : "width";
  var absGap = Math.abs(gap);
  var snapSize = isDisplaySnapDigit ? parseFloat(absGap.toFixed(snapDigit)) : 0;
  return React.createElement("div", {
    key: "".concat(type, "-").concat(lineType, "-guideline-").concat(index),
    className: prefix("guideline-group", type),
    style: (_a = {
      left: "".concat(renderPos[0], "px"),
      top: "".concat(renderPos[1], "px")
    }, _a[sizeName] = "".concat(absGap, "px"), _a)
  }, renderInnerGuideline({
    direction: type,
    classNames: [prefix(lineType), className],
    size: "100%",
    posValue: [0, 0],
    sizeValue: absGap,
    zoom: zoom
  }, React), React.createElement("div", {
    className: prefix("size-value", "gap"),
    style: {
      transform: "translate".concat(scaleType, "(-50%) scale(").concat(zoom, ")")
    }
  }, snapSize > 0 ? snapDistFormat(snapSize, type) : ""));
}

function groupByElementGuidelines(type, guidelines, targetRect, isDisplayInnerSnapDigit) {
  var index = type === "vertical" ? 0 : 1;
  var otherIndex = type === "vertical" ? 1 : 0;
  var names = index ? VERTICAL_NAMES_MAP : HORIZONTAL_NAMES_MAP;
  var targetStart = targetRect[names.start];
  var targetEnd = targetRect[names.end];
  return groupBy(guidelines, function (guideline) {
    return guideline.pos[index];
  }).map(function (nextGuidelines) {
    var start = [];
    var end = [];
    var inner = [];
    nextGuidelines.forEach(function (guideline) {
      var _a, _b;

      var element = guideline.element;
      var rect = guideline.elementRect.rect;

      if (rect[names.end] < targetStart) {
        start.push(guideline);
      } else if (targetEnd < rect[names.start]) {
        end.push(guideline);
      } else if (rect[names.start] <= targetStart && targetEnd <= rect[names.end] && isDisplayInnerSnapDigit) {
        var pos = guideline.pos;
        var elementRect1 = {
          element: element,
          rect: moveable_esm_assign(moveable_esm_assign({}, rect), (_a = {}, _a[names.end] = rect[names.start], _a))
        };
        var elementRect2 = {
          element: element,
          rect: moveable_esm_assign(moveable_esm_assign({}, rect), (_b = {}, _b[names.start] = rect[names.end], _b))
        };
        var nextPos1 = [0, 0];
        var nextPos2 = [0, 0];
        nextPos1[index] = pos[index];
        nextPos1[otherIndex] = pos[otherIndex];
        nextPos2[index] = pos[index];
        nextPos2[otherIndex] = pos[otherIndex] + guideline.size;
        start.push({
          type: type,
          pos: nextPos1,
          size: 0,
          elementRect: elementRect1
        });
        end.push({
          type: type,
          pos: nextPos2,
          size: 0,
          elementRect: elementRect2
        }); // inner.push(guideline);
      }
    });
    start.sort(function (a, b) {
      return b.pos[otherIndex] - a.pos[otherIndex];
    });
    end.sort(function (a, b) {
      return a.pos[otherIndex] - b.pos[otherIndex];
    });
    return {
      total: nextGuidelines,
      start: start,
      end: end,
      inner: inner
    };
  });
}

function renderDashedGuidelines(moveable, guidelines, targetPos, targetRect, React) {
  var isDisplayInnerSnapDigit = moveable.props.isDisplayInnerSnapDigit;
  var rendered = [];
  ["vertical", "horizontal"].forEach(function (type) {
    var nextGuidelines = guidelines.filter(function (guideline) {
      return guideline.type === type;
    });
    var index = type === "vertical" ? 1 : 0;
    var otherIndex = index ? 0 : 1;
    var groups = groupByElementGuidelines(type, nextGuidelines, targetRect, isDisplayInnerSnapDigit);
    var mainNames = index ? HORIZONTAL_NAMES_MAP : VERTICAL_NAMES_MAP;
    var sideNames = index ? VERTICAL_NAMES_MAP : HORIZONTAL_NAMES_MAP;
    var targetStart = targetRect[mainNames.start];
    var targetEnd = targetRect[mainNames.end];
    groups.forEach(function (_a) {
      var total = _a.total,
          start = _a.start,
          end = _a.end,
          inner = _a.inner;
      var sidePos = targetPos[otherIndex] + total[0].pos[otherIndex] - targetRect[sideNames.start];
      var prevRect = targetRect;
      start.forEach(function (guideline) {
        var nextRect = guideline.elementRect.rect;
        var size = prevRect[mainNames.start] - nextRect[mainNames.end];

        if (size > 0) {
          var renderPos = [0, 0];
          renderPos[index] = targetPos[index] + prevRect[mainNames.start] - targetStart - size;
          renderPos[otherIndex] = sidePos;
          rendered.push(renderDigitLine(moveable, type, "dashed", rendered.length, size, renderPos, guideline.className, React));
        }

        prevRect = nextRect;
      });
      prevRect = targetRect;
      end.forEach(function (guideline) {
        var nextRect = guideline.elementRect.rect;
        var size = nextRect[mainNames.start] - prevRect[mainNames.end];

        if (size > 0) {
          var renderPos = [0, 0];
          renderPos[index] = targetPos[index] + prevRect[mainNames.end] - targetStart;
          renderPos[otherIndex] = sidePos;
          rendered.push(renderDigitLine(moveable, type, "dashed", rendered.length, size, renderPos, guideline.className, React));
        }

        prevRect = nextRect;
      });
      inner.forEach(function (guideline) {
        var nextRect = guideline.elementRect.rect;
        var size1 = targetStart - nextRect[mainNames.start];
        var size2 = nextRect[mainNames.end] - targetEnd;
        var renderPos1 = [0, 0];
        var renderPos2 = [0, 0];
        renderPos1[index] = targetPos[index] - size1;
        renderPos1[otherIndex] = sidePos;
        renderPos2[index] = targetPos[index] + targetEnd - targetStart;
        renderPos2[otherIndex] = sidePos;
        rendered.push(renderDigitLine(moveable, type, "dashed", rendered.length, size1, renderPos1, guideline.className, React));
        rendered.push(renderDigitLine(moveable, type, "dashed", rendered.length, size2, renderPos2, guideline.className, React));
      });
    });
  });
  return rendered;
}

function renderGapGuidelines(moveable, guidelines, targetPos, targetRect, React) {
  var rendered = [];
  ["horizontal", "vertical"].forEach(function (type) {
    var nextGuidelines = guidelines.filter(function (guideline) {
      return guideline.type === type;
    });
    var index = type === "vertical" ? 0 : 1;
    var otherIndex = index ? 0 : 1;
    var mainNames = index ? HORIZONTAL_NAMES_MAP : VERTICAL_NAMES_MAP;
    var sideNames = index ? VERTICAL_NAMES_MAP : HORIZONTAL_NAMES_MAP;
    var targetStart = targetRect[mainNames.start];
    var targetEnd = targetRect[mainNames.end];
    var targetSideStart = targetRect[sideNames.start];
    var targetSideEnd = targetRect[sideNames.end];
    nextGuidelines.forEach(function (_a) {
      var gap = _a.gap,
          gapRects = _a.gapRects,
          className = _a.className;
      var sideStartPos = Math.max.apply(Math, __spreadArray([targetSideStart], gapRects.map(function (_a) {
        var rect = _a.rect;
        return rect[sideNames.start];
      }), false));
      var sideEndPos = Math.min.apply(Math, __spreadArray([targetSideEnd], gapRects.map(function (_a) {
        var rect = _a.rect;
        return rect[sideNames.end];
      }), false));
      var sideCenterPos = (sideStartPos + sideEndPos) / 2;

      if (sideStartPos === sideEndPos || sideCenterPos === (targetSideStart + targetSideEnd) / 2) {
        return;
      }

      gapRects.forEach(function (_a) {
        var rect = _a.rect;
        var renderPos = [targetPos[0], targetPos[1]];

        if (rect[mainNames.end] < targetStart) {
          renderPos[index] += rect[mainNames.end] - targetStart;
        } else if (targetEnd < rect[mainNames.start]) {
          renderPos[index] += rect[mainNames.start] - targetStart - gap;
        } else {
          return;
        }

        renderPos[otherIndex] += sideCenterPos - targetSideStart;
        rendered.push(renderDigitLine(moveable, index ? "vertical" : "horizontal", "gap", rendered.length, gap, renderPos, className, React));
      });
    });
  });
  return rendered;
}

function solveEquation(pos1, pos2, snapOffset, isVertical) {
  var dx = pos2[0] - pos1[0];
  var dy = pos2[1] - pos1[1];

  if (Math.abs(dx) < TINY_NUM) {
    dx = 0;
  }

  if (Math.abs(dy) < TINY_NUM) {
    dy = 0;
  }

  if (!dx) {
    // y = 0 * x + b
    // only horizontal
    if (!isVertical) {
      return [0, snapOffset];
    }

    return [0, 0];
  }

  if (!dy) {
    // only vertical
    if (isVertical) {
      return [snapOffset, 0];
    }

    return [0, 0];
  } // y = ax + b


  var a = dy / dx;
  var b = pos1[1] - a * pos1[0];

  if (isVertical) {
    // y = a * x + b
    var y = a * (pos2[0] + snapOffset) + b;
    return [snapOffset, y - pos2[1]];
  } else {
    // x = (y - b) / a
    var x = (pos2[1] + snapOffset - b) / a;
    return [x - pos2[0], snapOffset];
  }
}

function solveNextOffset(pos1, pos2, offset, isVertical, datas) {
  var sizeOffset = solveEquation(pos1, pos2, offset, isVertical);

  if (!sizeOffset) {
    return {
      isOutside: false,
      offset: [0, 0]
    };
  }

  var size = utils_esm_getDist(pos1, pos2);
  var dist1 = utils_esm_getDist(sizeOffset, pos1);
  var dist2 = utils_esm_getDist(sizeOffset, pos2);
  var isOutside = dist1 > size || dist2 > size;

  var _a = getDragDist({
    datas: datas,
    distX: sizeOffset[0],
    distY: sizeOffset[1]
  }),
      widthOffset = _a[0],
      heightOffset = _a[1];

  return {
    offset: [widthOffset, heightOffset],
    isOutside: isOutside
  };
}

function getSnapBound(boundInfo, snapInfo) {
  if (boundInfo.isBound) {
    return boundInfo.offset;
  } else if (snapInfo.isSnap) {
    return getNearestSnapGuidelineInfo(snapInfo).offset;
  }

  return 0;
}

function checkThrottleDragRotate(throttleDragRotate, _a, _b, _c, _d) {
  var distX = _a[0],
      distY = _a[1];
  var isVerticalBound = _b[0],
      isHorizontalBound = _b[1];
  var isVerticalSnap = _c[0],
      isHorizontalSnap = _c[1];
  var verticalOffset = _d[0],
      horizontalOffset = _d[1];
  var offsetX = -verticalOffset;
  var offsetY = -horizontalOffset;

  if (throttleDragRotate && distX && distY) {
    offsetX = 0;
    offsetY = 0;
    var adjustPoses = [];

    if (isVerticalBound && isHorizontalBound) {
      adjustPoses.push([0, horizontalOffset], [verticalOffset, 0]);
    } else if (isVerticalBound) {
      adjustPoses.push([verticalOffset, 0]);
    } else if (isHorizontalBound) {
      adjustPoses.push([0, horizontalOffset]);
    } else if (isVerticalSnap && isHorizontalSnap) {
      adjustPoses.push([0, horizontalOffset], [verticalOffset, 0]);
    } else if (isVerticalSnap) {
      adjustPoses.push([verticalOffset, 0]);
    } else if (isHorizontalSnap) {
      adjustPoses.push([0, horizontalOffset]);
    }

    if (adjustPoses.length) {
      adjustPoses.sort(function (a, b) {
        return getDistSize(minus([distX, distY], a)) - getDistSize(minus([distX, distY], b));
      });
      var adjustPos = adjustPoses[0];

      if (adjustPos[0] && Math.abs(distX) > TINY_NUM) {
        offsetX = -adjustPos[0];
        offsetY = distY * Math.abs(distX + offsetX) / Math.abs(distX) - distY;
      } else if (adjustPos[1] && Math.abs(distY) > TINY_NUM) {
        var prevDistY = distY;
        offsetY = -adjustPos[1];
        offsetX = distX * Math.abs(distY + offsetY) / Math.abs(prevDistY) - distX;
      }

      if (throttleDragRotate && isHorizontalBound && isVerticalBound) {
        if (Math.abs(offsetX) > TINY_NUM && Math.abs(offsetX) < Math.abs(verticalOffset)) {
          var scale = Math.abs(verticalOffset) / Math.abs(offsetX);
          offsetX *= scale;
          offsetY *= scale;
        } else if (Math.abs(offsetY) > TINY_NUM && Math.abs(offsetY) < Math.abs(horizontalOffset)) {
          var scale = Math.abs(horizontalOffset) / Math.abs(offsetY);
          offsetX *= scale;
          offsetY *= scale;
        } else {
          offsetX = maxOffset(-verticalOffset, offsetX);
          offsetY = maxOffset(-horizontalOffset, offsetY);
        }
      }
    }
  } else {
    offsetX = distX || isVerticalBound ? -verticalOffset : 0;
    offsetY = distY || isHorizontalBound ? -horizontalOffset : 0;
  }

  return [offsetX, offsetY];
}

function checkSnapBoundsDrag(moveable, distX, distY, throttleDragRotate, isRequest, datas) {
  if (!hasGuidelines(moveable, "draggable")) {
    return [{
      isSnap: false,
      isBound: false,
      offset: 0
    }, {
      isSnap: false,
      isBound: false,
      offset: 0
    }];
  }

  var poses = getAbsolutePoses(datas.absolutePoses, [distX, distY]);

  var _a = moveable_esm_getRect(poses),
      left = _a.left,
      right = _a.right,
      top = _a.top,
      bottom = _a.bottom;

  var boundPoses = {
    horizontal: poses.map(function (pos) {
      return pos[1];
    }),
    vertical: poses.map(function (pos) {
      return pos[0];
    })
  };
  var snapDirections = getSnapDirections(moveable.props.snapDirections);
  var snapPoses = splitSnapDirectionPoses(snapDirections, {
    left: left,
    right: right,
    top: top,
    bottom: bottom,
    center: (left + right) / 2,
    middle: (top + bottom) / 2
  });

  var _b = checkMoveableSnapBounds(moveable, isRequest, snapPoses, boundPoses),
      verticalSnapBoundInfo = _b.vertical,
      horizontalSnapBoundInfo = _b.horizontal;

  var _c = getInnerBoundDragInfo(moveable, poses, datas),
      verticalInnerBoundInfo = _c.vertical,
      horizontalInnerBoundInfo = _c.horizontal;

  var isVerticalSnap = verticalSnapBoundInfo.isSnap;
  var isHorizontalSnap = horizontalSnapBoundInfo.isSnap;
  var isVerticalBound = verticalSnapBoundInfo.isBound || verticalInnerBoundInfo.isBound;
  var isHorizontalBound = horizontalSnapBoundInfo.isBound || horizontalInnerBoundInfo.isBound;
  var verticalOffset = maxOffset(verticalSnapBoundInfo.offset, verticalInnerBoundInfo.offset);
  var horizontalOffset = maxOffset(horizontalSnapBoundInfo.offset, horizontalInnerBoundInfo.offset);

  var _d = checkThrottleDragRotate(throttleDragRotate, [distX, distY], [isVerticalBound, isHorizontalBound], [isVerticalSnap, isHorizontalSnap], [verticalOffset, horizontalOffset]),
      offsetX = _d[0],
      offsetY = _d[1];

  return [{
    isBound: isVerticalBound,
    isSnap: isVerticalSnap,
    offset: offsetX
  }, {
    isBound: isHorizontalBound,
    isSnap: isHorizontalSnap,
    offset: offsetY
  }];
}

function checkMoveableSnapBounds(moveable, isRequest, poses, boundPoses) {
  if (boundPoses === void 0) {
    boundPoses = poses;
  }

  var _a = checkBoundPoses(getBounds(moveable), boundPoses.vertical, boundPoses.horizontal),
      horizontalBoundInfos = _a.horizontal,
      verticalBoundInfos = _a.vertical;

  var _b = isRequest ? {
    horizontal: {
      isSnap: false,
      index: -1
    },
    vertical: {
      isSnap: false,
      index: -1
    }
  } : checkMoveableSnapPoses(moveable, poses.vertical, poses.horizontal),
      horizontalSnapInfo = _b.horizontal,
      verticalSnapInfo = _b.vertical;

  var horizontalOffset = getSnapBound(horizontalBoundInfos[0], horizontalSnapInfo);
  var verticalOffset = getSnapBound(verticalBoundInfos[0], verticalSnapInfo);
  var horizontalDist = Math.abs(horizontalOffset);
  var verticalDist = Math.abs(verticalOffset);
  return {
    horizontal: {
      isBound: horizontalBoundInfos[0].isBound,
      isSnap: horizontalSnapInfo.isSnap,
      snapIndex: horizontalSnapInfo.index,
      offset: horizontalOffset,
      dist: horizontalDist,
      bounds: horizontalBoundInfos,
      snap: horizontalSnapInfo
    },
    vertical: {
      isBound: verticalBoundInfos[0].isBound,
      isSnap: verticalSnapInfo.isSnap,
      snapIndex: verticalSnapInfo.index,
      offset: verticalOffset,
      dist: verticalDist,
      bounds: verticalBoundInfos,
      snap: verticalSnapInfo
    }
  };
}

function checkSnapBounds(guideines, bounds, posesX, posesY, snapThreshold) {
  var _a = checkBoundPoses(bounds, posesX, posesY),
      horizontalBoundInfos = _a.horizontal,
      verticalBoundInfos = _a.vertical; // options.isRequest ? {
  //     horizontal: { isSnap: false, index: -1 } as SnapInfo,
  //     vertical: { isSnap: false, index: -1 } as SnapInfo,
  // } :


  var _b = checkSnapPoses(guideines, posesX, posesY, snapThreshold),
      horizontalSnapInfo = _b.horizontal,
      verticalSnapInfo = _b.vertical;

  var horizontalOffset = getSnapBound(horizontalBoundInfos[0], horizontalSnapInfo);
  var verticalOffset = getSnapBound(verticalBoundInfos[0], verticalSnapInfo);
  var horizontalDist = Math.abs(horizontalOffset);
  var verticalDist = Math.abs(verticalOffset);
  return {
    horizontal: {
      isBound: horizontalBoundInfos[0].isBound,
      isSnap: horizontalSnapInfo.isSnap,
      snapIndex: horizontalSnapInfo.index,
      offset: horizontalOffset,
      dist: horizontalDist,
      bounds: horizontalBoundInfos,
      snap: horizontalSnapInfo
    },
    vertical: {
      isBound: verticalBoundInfos[0].isBound,
      isSnap: verticalSnapInfo.isSnap,
      snapIndex: verticalSnapInfo.index,
      offset: verticalOffset,
      dist: verticalDist,
      bounds: verticalBoundInfos,
      snap: verticalSnapInfo
    }
  };
}

function checkSnapRightLine(startPos, endPos, snapBoundInfo, keepRatio) {
  var rad = getRad(startPos, endPos) / Math.PI * 180;
  var _a = snapBoundInfo.vertical,
      isVerticalBound = _a.isBound,
      isVerticalSnap = _a.isSnap,
      verticalDist = _a.dist,
      _b = snapBoundInfo.horizontal,
      isHorizontalBound = _b.isBound,
      isHorizontalSnap = _b.isSnap,
      horizontalDist = _b.dist;
  var rad180 = rad % 180;
  var isHorizontalLine = rad180 < 3 || rad180 > 177;
  var isVerticalLine = rad180 > 87 && rad180 < 93;

  if (horizontalDist < verticalDist) {
    if (isVerticalBound || isVerticalSnap && !isVerticalLine && (!keepRatio || !isHorizontalLine)) {
      return "vertical";
    }
  }

  if (isHorizontalBound || isHorizontalSnap && !isHorizontalLine && (!keepRatio || !isVerticalLine)) {
    return "horizontal";
  }

  return "";
}

function getSnapBoundInfo(moveable, poses, directions, keepRatio, isRequest, datas) {
  return directions.map(function (_a) {
    var startDirection = _a[0],
        endDirection = _a[1];
    var otherStartPos = getPosByDirection(poses, startDirection);
    var otherEndPos = getPosByDirection(poses, endDirection);
    var snapBoundInfo = keepRatio ? checkSnapBoundsKeepRatio(moveable, otherStartPos, otherEndPos, isRequest) : checkMoveableSnapBounds(moveable, isRequest, {
      vertical: [otherEndPos[0]],
      horizontal: [otherEndPos[1]]
    });
    var _b = snapBoundInfo.horizontal,
        // dist: otherHorizontalDist,
    otherHorizontalOffset = _b.offset,
        isOtherHorizontalBound = _b.isBound,
        isOtherHorizontalSnap = _b.isSnap,
        _c = snapBoundInfo.vertical,
        // dist: otherVerticalDist,
    otherVerticalOffset = _c.offset,
        isOtherVerticalBound = _c.isBound,
        isOtherVerticalSnap = _c.isSnap;
    var multiple = minus(endDirection, startDirection);

    if (!otherVerticalOffset && !otherHorizontalOffset) {
      return {
        isBound: isOtherVerticalBound || isOtherHorizontalBound,
        isSnap: isOtherVerticalSnap || isOtherHorizontalSnap,
        sign: multiple,
        offset: [0, 0]
      };
    }

    var snapLine = checkSnapRightLine(otherStartPos, otherEndPos, snapBoundInfo, keepRatio);

    if (!snapLine) {
      return {
        sign: multiple,
        isBound: false,
        isSnap: false,
        offset: [0, 0]
      };
    }

    var isVertical = snapLine === "vertical";
    var sizeOffset = [0, 0];

    if (!keepRatio && Math.abs(endDirection[0]) === 1 && Math.abs(endDirection[1]) === 1 && startDirection[0] !== endDirection[0] && startDirection[1] !== endDirection[1]) {
      sizeOffset = getDragDist({
        datas: datas,
        distX: -otherVerticalOffset,
        distY: -otherHorizontalOffset
      });
    } else {
      sizeOffset = solveNextOffset(otherStartPos, otherEndPos, -(isVertical ? otherVerticalOffset : otherHorizontalOffset), isVertical, datas).offset;
    }

    sizeOffset = sizeOffset.map(function (size, i) {
      return size * (multiple[i] ? 2 / multiple[i] : 0);
    });
    return {
      sign: multiple,
      isBound: isVertical ? isOtherVerticalBound : isOtherHorizontalBound,
      isSnap: isVertical ? isOtherVerticalSnap : isOtherHorizontalSnap,
      offset: sizeOffset
    };
  });
}

function getSnapBoundOffset(boundInfo, snapInfo) {
  if (boundInfo.isBound) {
    return boundInfo.offset;
  } else if (snapInfo.isSnap) {
    return snapInfo.offset;
  }

  return 0;
}

function checkSnapBoundsKeepRatio(moveable, startPos, endPos, isRequest) {
  var _a = checkBoundKeepRatio(moveable, startPos, endPos),
      horizontalBoundInfo = _a.horizontal,
      verticalBoundInfo = _a.vertical;

  var _b = isRequest ? {
    horizontal: {
      isSnap: false
    },
    vertical: {
      isSnap: false
    }
  } : checkSnapKeepRatio(moveable, startPos, endPos),
      horizontalSnapInfo = _b.horizontal,
      verticalSnapInfo = _b.vertical;

  var horizontalOffset = getSnapBoundOffset(horizontalBoundInfo, horizontalSnapInfo);
  var verticalOffset = getSnapBoundOffset(verticalBoundInfo, verticalSnapInfo);
  var horizontalDist = Math.abs(horizontalOffset);
  var verticalDist = Math.abs(verticalOffset);
  return {
    horizontal: {
      isBound: horizontalBoundInfo.isBound,
      isSnap: horizontalSnapInfo.isSnap,
      offset: horizontalOffset,
      dist: horizontalDist
    },
    vertical: {
      isBound: verticalBoundInfo.isBound,
      isSnap: verticalSnapInfo.isSnap,
      offset: verticalOffset,
      dist: verticalDist
    }
  };
}

function checkMaxBounds(moveable, poses, direction, fixedPosition, datas) {
  var fixedDirection = [-direction[0], -direction[1]];
  var _a = moveable.state,
      width = _a.width,
      height = _a.height;
  var bounds = moveable.props.bounds;
  var maxWidth = Infinity;
  var maxHeight = Infinity;

  if (bounds) {
    var directions = [[direction[0], -direction[1]], [-direction[0], direction[1]]];
    var _b = bounds.left,
        left_1 = _b === void 0 ? -Infinity : _b,
        _c = bounds.top,
        top_1 = _c === void 0 ? -Infinity : _c,
        _d = bounds.right,
        right_1 = _d === void 0 ? Infinity : _d,
        _e = bounds.bottom,
        bottom_1 = _e === void 0 ? Infinity : _e;
    directions.forEach(function (otherDirection) {
      var isCheckVertical = otherDirection[0] !== fixedDirection[0];
      var isCheckHorizontal = otherDirection[1] !== fixedDirection[1];
      var otherPos = getPosByDirection(poses, otherDirection);
      var deg = getRad(fixedPosition, otherPos) * 360 / Math.PI;

      if (isCheckHorizontal) {
        var nextOtherPos = otherPos.slice();

        if (Math.abs(deg - 360) < 2 || Math.abs(deg - 180) < 2) {
          nextOtherPos[1] = fixedPosition[1];
        }

        var _a = solveNextOffset(fixedPosition, nextOtherPos, (fixedPosition[1] < otherPos[1] ? bottom_1 : top_1) - otherPos[1], false, datas),
            _b = _a.offset,
            heightOffset = _b[1],
            isHeightOutside = _a.isOutside;

        if (!isNaN(heightOffset)) {
          maxHeight = height + (isHeightOutside ? 1 : -1) * Math.abs(heightOffset);
        }
      }

      if (isCheckVertical) {
        var nextOtherPos = otherPos.slice();

        if (Math.abs(deg - 90) < 2 || Math.abs(deg - 270) < 2) {
          nextOtherPos[0] = fixedPosition[0];
        }

        var _c = solveNextOffset(fixedPosition, nextOtherPos, (fixedPosition[0] < otherPos[0] ? right_1 : left_1) - otherPos[0], true, datas),
            widthOffset = _c.offset[0],
            isWidthOutside = _c.isOutside;

        if (!isNaN(widthOffset)) {
          maxWidth = width + (isWidthOutside ? 1 : -1) * Math.abs(widthOffset);
        }
      }
    });
  }

  return {
    maxWidth: maxWidth,
    maxHeight: maxHeight
  };
}

function snapStart(moveable) {
  var state = moveable.state;

  if (state.guidelines && state.guidelines.length) {
    return;
  }

  var container = moveable.state.container;
  var snapContainer = moveable.props.snapContainer || container;
  var containerClientRect = state.containerClientRect;
  var snapOffset = {
    left: 0,
    top: 0,
    bottom: 0,
    right: 0
  };

  if (container !== snapContainer) {
    var snapContainerTarget = getRefTarget(snapContainer, true);

    if (snapContainerTarget) {
      var snapContainerRect = getClientRect(snapContainerTarget);
      var offset1 = getDragDistByState(state, [snapContainerRect.left - containerClientRect.left, snapContainerRect.top - containerClientRect.top]);
      var offset2 = getDragDistByState(state, [snapContainerRect.right - containerClientRect.right, snapContainerRect.bottom - containerClientRect.bottom]);
      snapOffset.left = utils_esm_throttle(offset1[0], 0.1);
      snapOffset.top = utils_esm_throttle(offset1[1], 0.1);
      snapOffset.right = utils_esm_throttle(offset2[0], 0.1);
      snapOffset.bottom = utils_esm_throttle(offset2[1], 0.1);
    }
  }

  state.snapOffset = snapOffset;
  state.guidelines = getTotalGuidelines(moveable);
  state.enableSnap = true;
}

function getNextFixedPoses(matrix, width, height, fixedDirection, fixedPos, is3d) {
  var nextPoses = calculatePoses(matrix, width, height, is3d ? 4 : 3);
  var nextFixedPos = getPosByDirection(nextPoses, fixedDirection);
  return getAbsolutePoses(nextPoses, minus(fixedPos, nextFixedPos));
}

function getSizeOffsetInfo(moveable, poses, direction, keepRatio, isRequest, datas) {
  var fixedDirection = datas.fixedDirection;
  var directions = getCheckSnapDirections(direction, fixedDirection, keepRatio);
  var innerBoundLineInfos = getCheckInnerBoundLineInfos(moveable, poses, direction, keepRatio);

  var offsets = __spreadArray(__spreadArray([], getSnapBoundInfo(moveable, poses, directions, keepRatio, isRequest, datas), true), getInnerBoundInfo(moveable, innerBoundLineInfos, datas), true);

  var widthOffsetInfo = getNearOffsetInfo(offsets, 0);
  var heightOffsetInfo = getNearOffsetInfo(offsets, 1);
  return {
    width: {
      isBound: widthOffsetInfo.isBound,
      offset: widthOffsetInfo.offset[0]
    },
    height: {
      isBound: heightOffsetInfo.isBound,
      offset: heightOffsetInfo.offset[1]
    }
  };
}

function recheckSizeByTwoDirection(moveable, poses, width, height, maxWidth, maxHeight, direction, isRequest, datas) {
  var snapPos = getPosByDirection(poses, direction);

  var _a = checkMoveableSnapBounds(moveable, isRequest, {
    vertical: [snapPos[0]],
    horizontal: [snapPos[1]]
  }),
      horizontalOffset = _a.horizontal.offset,
      verticalOffset = _a.vertical.offset;

  if (verticalOffset || horizontalOffset) {
    var _b = getDragDist({
      datas: datas,
      distX: -verticalOffset,
      distY: -horizontalOffset
    }),
        nextWidthOffset = _b[0],
        nextHeightOffset = _b[1];

    var nextWidth = Math.min(maxWidth || Infinity, width + direction[0] * nextWidthOffset);
    var nextHeight = Math.min(maxHeight || Infinity, height + direction[1] * nextHeightOffset);
    return [nextWidth - width, nextHeight - height];
  }

  return [0, 0];
}

function checkSizeDist(moveable, getNextPoses, width, height, direction, fixedPosition, isRequest, datas) {
  var poses = getAbsolutePosesByState(moveable.state);
  var keepRatio = moveable.props.keepRatio;
  var widthOffset = 0;
  var heightOffset = 0;

  for (var i = 0; i < 2; ++i) {
    var nextPoses = getNextPoses(widthOffset, heightOffset);

    var _a = getSizeOffsetInfo(moveable, nextPoses, direction, keepRatio, isRequest, datas),
        widthOffsetInfo = _a.width,
        heightOffsetInfo = _a.height;

    var isWidthBound = widthOffsetInfo.isBound;
    var isHeightBound = heightOffsetInfo.isBound;
    var nextWidthOffset = widthOffsetInfo.offset;
    var nextHeightOffset = heightOffsetInfo.offset;

    if (i === 1) {
      if (!isWidthBound) {
        nextWidthOffset = 0;
      }

      if (!isHeightBound) {
        nextHeightOffset = 0;
      }
    }

    if (i === 0 && isRequest && !isWidthBound && !isHeightBound) {
      return [0, 0];
    }

    if (keepRatio) {
      var widthDist = Math.abs(nextWidthOffset) * (width ? 1 / width : 1);
      var heightDist = Math.abs(nextHeightOffset) * (height ? 1 / height : 1);
      var isGetWidthOffset = isWidthBound && isHeightBound ? widthDist < heightDist : isHeightBound || !isWidthBound && widthDist < heightDist;

      if (isGetWidthOffset) {
        // width : height = ? : heightOffset
        nextWidthOffset = width * nextHeightOffset / height;
      } else {
        // width : height = widthOffset : ?
        nextHeightOffset = height * nextWidthOffset / width;
      }
    }

    widthOffset += nextWidthOffset;
    heightOffset += nextHeightOffset;
  }

  if (direction[0] && direction[1]) {
    var _b = checkMaxBounds(moveable, poses, direction, fixedPosition, datas),
        maxWidth = _b.maxWidth,
        maxHeight = _b.maxHeight;

    var _c = recheckSizeByTwoDirection(moveable, getNextPoses(widthOffset, heightOffset).map(function (pos) {
      return pos.map(function (p) {
        return utils_esm_throttle(p, FLOAT_POINT_NUM);
      });
    }), width + widthOffset, height + heightOffset, maxWidth, maxHeight, direction, isRequest, datas),
        nextWidthOffset = _c[0],
        nextHeightOffset = _c[1];

    widthOffset += nextWidthOffset;
    heightOffset += nextHeightOffset;
  }

  return [widthOffset, heightOffset];
}

function checkSnapRotate(moveable, rect, origin, rotation) {
  if (!hasGuidelines(moveable, "rotatable")) {
    return rotation;
  }

  var pos1 = rect.pos1,
      pos2 = rect.pos2,
      pos3 = rect.pos3,
      pos4 = rect.pos4;
  var rad = rotation * Math.PI / 180;
  var prevPoses = [pos1, pos2, pos3, pos4].map(function (pos) {
    return minus(pos, origin);
  });
  var nextPoses = prevPoses.map(function (pos) {
    return rotate(pos, rad);
  });

  var result = __spreadArray(__spreadArray([], checkRotateBounds(moveable, prevPoses, nextPoses, origin, rotation), true), checkRotateInnerBounds(moveable, prevPoses, nextPoses, origin, rotation), true);

  result.sort(function (a, b) {
    return Math.abs(a - rotation) - Math.abs(b - rotation);
  });

  if (result.length) {
    return result[0];
  } else {
    return rotation;
  }
}

function checkSnapResize(moveable, width, height, direction, fixedPosition, isRequest, datas) {
  if (!hasGuidelines(moveable, "resizable")) {
    return [0, 0];
  }

  var fixedDirection = datas.fixedDirection;
  var _a = moveable.state,
      allMatrix = _a.allMatrix,
      is3d = _a.is3d;
  return checkSizeDist(moveable, function (widthOffset, heightOffset) {
    return getNextFixedPoses(allMatrix, width + widthOffset, height + heightOffset, fixedDirection, fixedPosition, is3d);
  }, width, height, direction, fixedPosition, isRequest, datas);
}

function checkSnapScale(moveable, scale, direction, isRequest, datas) {
  if (!hasGuidelines(moveable, "scalable")) {
    return [0, 0];
  }

  var startOffsetWidth = datas.startOffsetWidth,
      startOffsetHeight = datas.startOffsetHeight,
      fixedPosition = datas.fixedPosition,
      fixedDirection = datas.fixedDirection,
      is3d = datas.is3d;
  var sizeDist = checkSizeDist(moveable, function (widthOffset, heightOffset) {
    return getNextFixedPoses(scaleMatrix(datas, plus(scale, [widthOffset / startOffsetWidth, heightOffset / startOffsetHeight])), startOffsetWidth, startOffsetHeight, fixedDirection, fixedPosition, is3d);
  }, startOffsetWidth, startOffsetHeight, direction, fixedPosition, isRequest, datas);
  return [sizeDist[0] / startOffsetWidth, sizeDist[1] / startOffsetHeight];
}

function startCheckSnapDrag(moveable, datas) {
  datas.absolutePoses = getAbsolutePosesByState(moveable.state);
}

function getSnapGuidelines(posInfos) {
  var guidelines = [];
  posInfos.forEach(function (posInfo) {
    posInfo.guidelineInfos.forEach(function (_a) {
      var guideline = _a.guideline;

      if (guidelines.indexOf(guideline) > -1) {
        return;
      }

      guidelines.push(guideline);
    });
  });
  return guidelines;
}

function addBoundGuidelines(moveable, verticalPoses, horizontalPoses, verticalSnapPoses, horizontalSnapPoses, externalBounds) {
  var _a = checkBoundPoses(getBounds(moveable, externalBounds), verticalPoses, horizontalPoses),
      verticalBoundInfos = _a.vertical,
      horizontalBoundInfos = _a.horizontal;

  verticalBoundInfos.forEach(function (info) {
    if (info.isBound) {
      verticalSnapPoses.push({
        type: "bounds",
        pos: info.pos
      });
    }
  });
  horizontalBoundInfos.forEach(function (info) {
    if (info.isBound) {
      horizontalSnapPoses.push({
        type: "bounds",
        pos: info.pos
      });
    }
  });

  var _b = checkInnerBoundPoses(moveable),
      verticalInnerBoundPoses = _b.vertical,
      horizontalInnerBoundPoses = _b.horizontal;

  verticalInnerBoundPoses.forEach(function (innerPos) {
    if (findIndex(verticalSnapPoses, function (_a) {
      var type = _a.type,
          pos = _a.pos;
      return type === "bounds" && pos === innerPos;
    }) >= 0) {
      return;
    }

    verticalSnapPoses.push({
      type: "bounds",
      pos: innerPos
    });
  });
  horizontalInnerBoundPoses.forEach(function (innerPos) {
    if (findIndex(horizontalSnapPoses, function (_a) {
      var type = _a.type,
          pos = _a.pos;
      return type === "bounds" && pos === innerPos;
    }) >= 0) {
      return;
    }

    horizontalSnapPoses.push({
      type: "bounds",
      pos: innerPos
    });
  });
}
/**
 * @namespace Moveable.Snappable
 * @description Whether or not target can be snapped to the guideline. (default: false)
 * @sort 2
 */


var Snappable = {
  name: "snappable",
  dragRelation: "strong",
  props: {
    snappable: [Boolean, Array],
    snapContainer: Object,
    snapDirections: [Boolean, Object],
    elementSnapDirections: [Boolean, Object],
    snapGap: Boolean,
    snapGridWidth: Number,
    snapGridHeight: Number,
    isDisplaySnapDigit: Boolean,
    isDisplayInnerSnapDigit: Boolean,
    snapDigit: Number,
    snapThreshold: Number,
    horizontalGuidelines: Array,
    verticalGuidelines: Array,
    elementGuidelines: Array,
    bounds: Object,
    innerBounds: Object,
    snapDistFormat: Function
  },
  events: {
    onSnap: "snap"
  },
  css: [":host {\n    --bounds-color: #d66;\n}\n.guideline {\n    pointer-events: none;\n    z-index: 2;\n}\n.guideline.bounds {\n    background: #d66;\n    background: var(--bounds-color);\n}\n.guideline-group {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n.guideline-group .size-value {\n    position: absolute;\n    color: #f55;\n    font-size: 12px;\n    font-weight: bold;\n}\n.guideline-group.horizontal .size-value {\n    transform-origin: 50% 100%;\n    transform: translateX(-50%);\n    left: 50%;\n    bottom: 5px;\n}\n.guideline-group.vertical .size-value {\n    transform-origin: 0% 50%;\n    top: 50%;\n    transform: translateY(-50%);\n    left: 5px;\n}\n.guideline.gap {\n    background: #f55;\n}\n.size-value.gap {\n    color: #f55;\n}\n"],
  render: function (moveable, React) {
    var state = moveable.state;
    var targetTop = state.top,
        targetLeft = state.left,
        pos1 = state.pos1,
        pos2 = state.pos2,
        pos3 = state.pos3,
        pos4 = state.pos4,
        snapRenderInfo = state.snapRenderInfo;

    if (!snapRenderInfo || !hasGuidelines(moveable, "")) {
      return [];
    }

    state.guidelines = getTotalGuidelines(moveable);
    var minLeft = Math.min(pos1[0], pos2[0], pos3[0], pos4[0]);
    var minTop = Math.min(pos1[1], pos2[1], pos3[1], pos4[1]);
    var externalPoses = snapRenderInfo.externalPoses || [];
    var poses = getAbsolutePosesByState(moveable.state);
    var verticalSnapPoses = [];
    var horizontalSnapPoses = [];
    var verticalGuidelines = [];
    var horizontalGuidelines = [];
    var snapInfos = [];

    var _a = moveable_esm_getRect(poses),
        width = _a.width,
        height = _a.height,
        top = _a.top,
        left = _a.left,
        bottom = _a.bottom,
        right = _a.right;

    var targetRect = {
      left: left,
      right: right,
      top: top,
      bottom: bottom,
      center: (left + right) / 2,
      middle: (top + bottom) / 2
    };
    var hasExternalPoses = externalPoses.length > 0;
    var externalRect = hasExternalPoses ? moveable_esm_getRect(externalPoses) : {};

    if (!snapRenderInfo.request) {
      if (snapRenderInfo.direction) {
        snapInfos.push(getSnapInfosByDirection(moveable, poses, snapRenderInfo.direction));
      }

      if (snapRenderInfo.snap) {
        var rect = moveable_esm_getRect(poses);

        if (snapRenderInfo.center) {
          rect.middle = (rect.top + rect.bottom) / 2;
          rect.center = (rect.left + rect.right) / 2;
        }

        snapInfos.push(checkSnaps(moveable, rect, 1));
      }

      if (hasExternalPoses) {
        if (snapRenderInfo.center) {
          externalRect.middle = (externalRect.top + externalRect.bottom) / 2;
          externalRect.center = (externalRect.left + externalRect.right) / 2;
        }

        snapInfos.push(checkSnaps(moveable, externalRect, 1));
      }

      snapInfos.forEach(function (snapInfo) {
        var verticalPosInfos = snapInfo.vertical.posInfos,
            horizontalPosInfos = snapInfo.horizontal.posInfos;
        verticalSnapPoses.push.apply(verticalSnapPoses, verticalPosInfos.filter(function (_a) {
          var guidelineInfos = _a.guidelineInfos;
          return guidelineInfos.some(function (_a) {
            var guideline = _a.guideline;
            return !guideline.hide;
          });
        }).map(function (posInfo) {
          return {
            type: "snap",
            pos: posInfo.pos
          };
        }));
        horizontalSnapPoses.push.apply(horizontalSnapPoses, horizontalPosInfos.filter(function (_a) {
          var guidelineInfos = _a.guidelineInfos;
          return guidelineInfos.some(function (_a) {
            var guideline = _a.guideline;
            return !guideline.hide;
          });
        }).map(function (posInfo) {
          return {
            type: "snap",
            pos: posInfo.pos
          };
        }));
        verticalGuidelines.push.apply(verticalGuidelines, getSnapGuidelines(verticalPosInfos));
        horizontalGuidelines.push.apply(horizontalGuidelines, getSnapGuidelines(horizontalPosInfos));
      });
    }

    addBoundGuidelines(moveable, [left, right], [top, bottom], verticalSnapPoses, horizontalSnapPoses);

    if (hasExternalPoses) {
      addBoundGuidelines(moveable, [externalRect.left, externalRect.right], [externalRect.top, externalRect.bottom], verticalSnapPoses, horizontalSnapPoses, snapRenderInfo.externalBounds);
    }

    var allGuidelines = __spreadArray(__spreadArray([], verticalGuidelines, true), horizontalGuidelines, true);

    var elementGuidelines = allGuidelines.filter(function (guideline) {
      return guideline.element && !guideline.gapRects;
    });
    var gapGuidelines = allGuidelines.filter(function (guideline) {
      return guideline.gapRects;
    });
    triggerEvent(moveable, "onSnap", {
      guidelines: allGuidelines.filter(function (_a) {
        var element = _a.element;
        return !element;
      }),
      elements: elementGuidelines,
      gaps: gapGuidelines
    }, true);
    return __spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([], renderDashedGuidelines(moveable, elementGuidelines, [minLeft, minTop], targetRect, React), true), renderGapGuidelines(moveable, gapGuidelines, [minLeft, minTop], targetRect, React), true), renderGuidelines(moveable, "horizontal", horizontalGuidelines, [targetLeft, targetTop], targetRect, React), true), renderGuidelines(moveable, "vertical", verticalGuidelines, [targetLeft, targetTop], targetRect, React), true), renderSnapPoses(moveable, "horizontal", horizontalSnapPoses, minLeft, targetTop, width, 0, React), true), renderSnapPoses(moveable, "vertical", verticalSnapPoses, minTop, targetLeft, height, 1, React), true);
  },
  dragStart: function (moveable, e) {
    moveable.state.snapRenderInfo = {
      request: e.isRequest,
      snap: true,
      center: true
    };
    snapStart(moveable);
  },
  drag: function (moveable) {
    var state = moveable.state;
    state.guidelines = getTotalGuidelines(moveable);
  },
  pinchStart: function (moveable) {
    this.unset(moveable);
  },
  dragEnd: function (moveable) {
    this.unset(moveable);
  },
  dragControlCondition: function (moveable, e) {
    if (directionCondition(moveable, e) || dragControlCondition(moveable, e)) {
      return true;
    }

    if (!e.isRequest && e.inputEvent) {
      return hasClass(e.inputEvent.target, prefix("snap-control"));
    }
  },
  dragControlStart: function (moveable) {
    moveable.state.snapRenderInfo = null;
    snapStart(moveable);
  },
  dragControl: function (moveable) {
    this.drag(moveable);
  },
  dragControlEnd: function (moveable) {
    this.unset(moveable);
  },
  dragGroupStart: function (moveable, e) {
    this.dragStart(moveable, e);
  },
  dragGroup: function (moveable) {
    this.drag(moveable);
  },
  dragGroupEnd: function (moveable) {
    this.unset(moveable);
  },
  dragGroupControlStart: function (moveable) {
    moveable.state.snapRenderInfo = null;
    snapStart(moveable);
  },
  dragGroupControl: function (moveable) {
    this.drag(moveable);
  },
  dragGroupControlEnd: function (moveable) {
    this.unset(moveable);
  },
  unset: function (moveable) {
    var state = moveable.state;
    state.enableSnap = false;
    state.guidelines = [];
    state.snapRenderInfo = null;
    state.elementRects = [];
  }
};
/**
 * Whether or not target can be snapped to the guideline. (default: false)
 * @name Moveable.Snappable#snappable
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.snappable = true;
 */

/**
 *  A snap container that is the basis for snap, bounds, and innerBounds. (default: null = container)
 * @name Moveable.Snappable#snapContainer
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.querySelector(".container"));
 *
 * moveable.snapContainer = document.body;
 */

/**
 * You can specify the directions to snap to the target. (default: { left: true, top: true, right: true, bottom: true })
 * @name Moveable.Snappable#snapDirections
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   snappable: true,
 *   snapDirections: true,
 * });
 * // snap center
 * moveable.snapDirections = { left: true, top: true, right: true, bottom: true, center: true, middle: true };
 */

/**
 * You can specify the snap directions of elements. (default: { left: true, top: true, right: true, bottom: true })
 * @name Moveable.Snappable#elementSnapDirections
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   snappable: true,
 *   elementSnapDirections: true,
 * });
 * // snap center
 * moveable.elementSnapDirections = { left: true, top: true, right: true, bottom: true, center: true, middle: true };
 */

/**
 * When you drag, make the gap snap in the element guidelines. (default: true)
 * @name Moveable.Snappable#snapGap
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   snappable: true,
 *   snapElement: true,
 *   snapGap: true,
 * });
 *
 * moveable.snapGap = false;
 */

/**
 * Distance value that can snap to guidelines. (default: 5)
 * @name Moveable.Snappable#snapThreshold
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.snapThreshold = 5;
 */

/**
 * Add guidelines in the horizontal direction. (default: [])
 * @name Moveable.Snappable#horizontalGuidelines
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.horizontalGuidelines = [100, 200, 500];
 */

/**
 * Add guidelines in the vertical direction. (default: [])
 * @name Moveable.Snappable#verticalGuidelines
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.verticalGuidelines = [100, 200, 500];
 */

/**
 * Add guidelines for the element. (default: [])
 * @name Moveable.Snappable#elementGuidelines
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.elementGuidelines = [
 *   document.querySelector(".element"),
 * ];
 */

/**
 * You can set up boundaries.
 * @name Moveable.Snappable#bounds
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @default null
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.bounds = { left: 0, right: 1000, top: 0, bottom: 1000};
 */

/**
 * You can set up inner boundaries.
 * @name Moveable.Snappable#innerBounds
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @default null
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.innerBounds = { left: 500, top: 500, width: 100, height: 100};
 */

/**
 * snap distance digits (default: 0)
 * @name Moveable.Snappable#snapDigit
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.snapDigit = 0
 */

/**
 * If width size is greater than 0, you can vertical snap to the grid. (default: 0)
 * @name Moveable.Snappable#snapGridWidth
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.snapGridWidth = 5;
 */

/**
 * If height size is greater than 0, you can horizontal snap to the grid. (default: 0)
 * @name Moveable.Snappable#snapGridHeight
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.snapGridHeight = 5;
 */

/**
 * Whether to show snap distance (default: true)
 * @name Moveable.Snappable#isDisplaySnapDigit
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.isDisplaySnapDigit = true;
 */

/**
 * Whether to show element inner snap distance (default: false)
 * @name Moveable.Snappable#isDisplayInnerSnapDigit
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.isDisplayInnerSnapDigit = true;
 */

/**
 * You can set the text format of the distance shown in the guidelines. (default: self)
 * @name Moveable.Snappable#snapDistFormat
 * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Snappable.html#.SnappableOptions}
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *  snappable: true,
 *  snapDistFormat: (v, type) => v,
 * });
 * moveable.snapDistFormat = (v, type) => `${v}px`;
 */

/**
 * When you drag or dragControl, the `snap` event is called.
 * @memberof Moveable.Snappable
 * @event snap
 * @param {Moveable.Snappable.OnSnap} - Parameters for the `snap` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     snappable: true
 * });
 * moveable.on("snap", e => {
 *     console.log("onSnap", e);
 * });
 */

/**
 * @namespace Draggable
 * @memberof Moveable
 * @description Draggable refers to the ability to drag and move targets.
 */

var moveable_esm_Draggable = {
  name: "draggable",
  props: {
    draggable: Boolean,
    throttleDrag: Number,
    throttleDragRotate: Number,
    startDragRotate: Number,
    edgeDraggable: Boolean
  },
  events: {
    onDragStart: "dragStart",
    onDrag: "drag",
    onDragEnd: "dragEnd",
    onDragGroupStart: "dragGroupStart",
    onDragGroup: "dragGroup",
    onDragGroupEnd: "dragGroupEnd"
  },
  render: function (moveable, React) {
    var _a = moveable.props,
        throttleDragRotate = _a.throttleDragRotate,
        zoom = _a.zoom;
    var _b = moveable.state,
        dragInfo = _b.dragInfo,
        beforeOrigin = _b.beforeOrigin;

    if (!throttleDragRotate || !dragInfo) {
      return [];
    }

    var dist = dragInfo.dist;

    if (!dist[0] && !dist[1]) {
      return [];
    }

    var width = getDistSize(dist);
    var rad = getRad(dist, [0, 0]);
    return [React.createElement("div", {
      className: prefix("line", "horizontal", "dragline", "dashed"),
      key: "dragRotateGuideline",
      style: {
        width: "".concat(width, "px"),
        transform: "translate(".concat(beforeOrigin[0], "px, ").concat(beforeOrigin[1], "px) rotate(").concat(rad, "rad) scaleY(").concat(zoom, ")")
      }
    })];
  },
  dragStart: function (moveable, e) {
    var datas = e.datas,
        parentEvent = e.parentEvent,
        parentGesto = e.parentGesto;
    var state = moveable.state;
    var target = state.target,
        gesto = state.gesto;

    if (gesto) {
      return false;
    }

    state.gesto = parentGesto || moveable.targetGesto;
    var style = moveable_esm_getComputedStyle(target);
    datas.datas = {};
    datas.left = parseFloat(style.left || "") || 0;
    datas.top = parseFloat(style.top || "") || 0;
    datas.bottom = parseFloat(style.bottom || "") || 0;
    datas.right = parseFloat(style.right || "") || 0;
    datas.startValue = [0, 0];
    setDragStart(moveable, e);
    setDefaultTransformIndex(e, "translate");
    startCheckSnapDrag(moveable, datas);
    datas.prevDist = [0, 0];
    datas.prevBeforeDist = [0, 0];
    datas.isDrag = false;
    datas.deltaOffset = [0, 0];
    var params = fillParams(moveable, e, moveable_esm_assign({
      set: function (translate) {
        datas.startValue = translate;
      }
    }, fillTransformStartEvent(e)));
    var result = parentEvent || triggerEvent(moveable, "onDragStart", params);

    if (result !== false) {
      datas.isDrag = true;
      moveable.state.dragInfo = {
        startRect: moveable.getRect(),
        dist: [0, 0]
      };
    } else {
      state.gesto = null;
      datas.isPinch = false;
    }

    return datas.isDrag ? params : false;
  },
  drag: function (moveable, e) {
    if (!e) {
      return;
    }

    resolveTransformEvent(e, "translate");
    var datas = e.datas,
        parentEvent = e.parentEvent,
        parentFlag = e.parentFlag,
        isPinch = e.isPinch,
        isRequest = e.isRequest,
        deltaOffset = e.deltaOffset;
    var distX = e.distX,
        distY = e.distY;
    var isDrag = datas.isDrag,
        prevDist = datas.prevDist,
        prevBeforeDist = datas.prevBeforeDist,
        startValue = datas.startValue;

    if (!isDrag) {
      return;
    }

    if (deltaOffset) {
      distX += deltaOffset[0];
      distY += deltaOffset[1];
    }

    var props = moveable.props;
    var parentMoveable = props.parentMoveable;
    var throttleDrag = parentEvent ? 0 : props.throttleDrag || 0;
    var throttleDragRotate = parentEvent ? 0 : props.throttleDragRotate || 0;
    var isSnap = false;
    var dragRotateRad = 0;

    if (!parentEvent && throttleDragRotate > 0 && (distX || distY)) {
      var startDragRotate = props.startDragRotate || 0;
      var deg = utils_esm_throttle(startDragRotate + getRad([0, 0], [distX, distY]) * 180 / Math.PI, throttleDragRotate) - startDragRotate;
      var ry = distY * Math.abs(Math.cos((deg - 90) / 180 * Math.PI));
      var rx = distX * Math.abs(Math.cos(deg / 180 * Math.PI));
      var r = getDistSize([rx, ry]);
      dragRotateRad = deg * Math.PI / 180;
      distX = r * Math.cos(dragRotateRad);
      distY = r * Math.sin(dragRotateRad);
    }

    if (!isPinch && !parentEvent && !parentFlag && (!throttleDragRotate || distX || distY)) {
      var _a = checkSnapBoundsDrag(moveable, distX, distY, throttleDragRotate, isRequest || deltaOffset, datas),
          verticalInfo = _a[0],
          horizontalInfo = _a[1];

      var isVerticalSnap = verticalInfo.isSnap,
          isVerticalBound = verticalInfo.isBound,
          verticalOffset = verticalInfo.offset;
      var isHorizontalSnap = horizontalInfo.isSnap,
          isHorizontalBound = horizontalInfo.isBound,
          horizontalOffset = horizontalInfo.offset;
      isSnap = isVerticalSnap || isHorizontalSnap || isVerticalBound || isHorizontalBound;
      distX += verticalOffset;
      distY += horizontalOffset;
    }

    var beforeTranslate = plus(getBeforeDragDist({
      datas: datas,
      distX: distX,
      distY: distY
    }), startValue);
    var translate = plus(getTransformDist({
      datas: datas,
      distX: distX,
      distY: distY
    }), startValue);

    if (!throttleDragRotate && !isSnap) {
      throttleArray(translate, throttleDrag);
      throttleArray(beforeTranslate, throttleDrag);
    }

    var beforeDist = minus(beforeTranslate, startValue);
    var dist = minus(translate, startValue);
    var delta = minus(dist, prevDist);
    var beforeDelta = minus(beforeDist, prevBeforeDist);
    datas.prevDist = dist;
    datas.prevBeforeDist = beforeDist;
    datas.passDelta = delta; //distX - (datas.passDistX || 0);
    // datas.passDeltaY = distY - (datas.passDistY || 0);

    datas.passDist = dist; //distX;
    // datas.passDistY = distY;

    var left = datas.left + beforeDist[0];
    var top = datas.top + beforeDist[1];
    var right = datas.right - beforeDist[0];
    var bottom = datas.bottom - beforeDist[1];
    var nextTransform = convertTransformFormat(datas, "translate(".concat(translate[0], "px, ").concat(translate[1], "px)"), "translate(".concat(dist[0], "px, ").concat(dist[1], "px)"));
    fillOriginalTransform(e, nextTransform);
    moveable.state.dragInfo.dist = parentEvent ? [0, 0] : dist;

    if (!parentEvent && !parentMoveable && delta.every(function (num) {
      return !num;
    }) && beforeDelta.some(function (num) {
      return !num;
    })) {
      return;
    }

    var _b = moveable.state,
        width = _b.width,
        height = _b.height;
    var params = fillParams(moveable, e, {
      transform: nextTransform,
      dist: dist,
      delta: delta,
      translate: translate,
      beforeDist: beforeDist,
      beforeDelta: beforeDelta,
      beforeTranslate: beforeTranslate,
      left: left,
      top: top,
      right: right,
      bottom: bottom,
      width: width,
      height: height,
      isPinch: isPinch
    });
    !parentEvent && triggerEvent(moveable, "onDrag", params);
    return params;
  },
  dragAfter: function (moveable, e) {
    var datas = e.datas;
    var deltaOffset = datas.deltaOffset;

    if (deltaOffset[0] || deltaOffset[1]) {
      datas.deltaOffset = [0, 0];
      return this.drag(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
        deltaOffset: deltaOffset
      }));
    }

    return false;
  },
  dragEnd: function (moveable, e) {
    var parentEvent = e.parentEvent,
        datas = e.datas;
    moveable.state.gesto = null;
    moveable.state.dragInfo = null;

    if (!datas.isDrag) {
      return;
    }

    datas.isDrag = false;
    var param = fillEndParams(moveable, e, {});
    !parentEvent && triggerEvent(moveable, "onDragEnd", param);
    return param;
  },
  dragGroupStart: function (moveable, e) {
    var datas = e.datas,
        clientX = e.clientX,
        clientY = e.clientY;
    var params = this.dragStart(moveable, e);

    if (!params) {
      return false;
    }

    var events = triggerChildGesto(moveable, this, "dragStart", [clientX || 0, clientY || 0], e, false);

    var nextParams = moveable_esm_assign(moveable_esm_assign({}, params), {
      targets: moveable.props.targets,
      events: events
    });

    var result = triggerEvent(moveable, "onDragGroupStart", nextParams);
    datas.isDrag = result !== false;
    return datas.isDrag ? params : false;
  },
  dragGroup: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isDrag) {
      return;
    }

    var params = this.drag(moveable, e);
    var passDelta = e.datas.passDelta;
    var events = triggerChildGesto(moveable, this, "drag", passDelta, e, false);

    if (!params) {
      return;
    }

    var nextParams = moveable_esm_assign({
      targets: moveable.props.targets,
      events: events
    }, params);

    triggerEvent(moveable, "onDragGroup", nextParams);
    return nextParams;
  },
  dragGroupEnd: function (moveable, e) {
    var isDrag = e.isDrag,
        datas = e.datas;

    if (!datas.isDrag) {
      return;
    }

    this.dragEnd(moveable, e);
    var events = triggerChildGesto(moveable, this, "dragEnd", [0, 0], e, false);
    triggerEvent(moveable, "onDragGroupEnd", fillEndParams(moveable, e, {
      targets: moveable.props.targets,
      events: events
    }));
    return isDrag;
  },

  /**
   * @method Moveable.Draggable#request
   * @param {object} [e] - the draggable's request parameter
   * @param {number} [e.x] - x position
   * @param {number} [e.y] - y position
   * @param {number} [e.deltaX] - X number to move
   * @param {number} [e.deltaY] - Y number to move
   * @return {Moveable.Requester} Moveable Requester
   * @example
    * // Instantly Request (requestStart - request - requestEnd)
   * // Use Relative Value
   * moveable.request("draggable", { deltaX: 10, deltaY: 10 }, true);
   * // Use Absolute Value
   * moveable.request("draggable", { x: 200, y: 100 }, true);
   *
   * // requestStart
   * const requester = moveable.request("draggable");
   *
   * // request
   * // Use Relative Value
   * requester.request({ deltaX: 10, deltaY: 10 });
   * requester.request({ deltaX: 10, deltaY: 10 });
   * requester.request({ deltaX: 10, deltaY: 10 });
   * // Use Absolute Value
   * moveable.request("draggable", { x: 200, y: 100 });
   * moveable.request("draggable", { x: 220, y: 100 });
   * moveable.request("draggable", { x: 240, y: 100 });
   *
   * // requestEnd
   * requester.requestEnd();
   */
  request: function (moveable) {
    var datas = {};
    var rect = moveable.getRect();
    var distX = 0;
    var distY = 0;
    return {
      isControl: false,
      requestStart: function () {
        return {
          datas: datas
        };
      },
      request: function (e) {
        if ("x" in e) {
          distX = e.x - rect.left;
        } else if ("deltaX" in e) {
          distX += e.deltaX;
        }

        if ("y" in e) {
          distY = e.y - rect.top;
        } else if ("deltaY" in e) {
          distY += e.deltaY;
        }

        return {
          datas: datas,
          distX: distX,
          distY: distY
        };
      },
      requestEnd: function () {
        return {
          datas: datas,
          isDrag: true
        };
      }
    };
  },
  unset: function (moveable) {
    moveable.state.dragInfo = null;
  }
};
/**
 * Whether or not target can be dragged. (default: false)
 * @name Moveable.Draggable#draggable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.draggable = true;
 */

/**
 * throttle of x, y when drag.
 * @name Moveable.Draggable#throttleDrag
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.throttleDrag = 1;
 */

/**
* throttle of angle of x, y when drag.
* @name Moveable.Draggable#throttleDragRotate
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body);
*
* moveable.throttleDragRotate = 45;
*/

/**
* start angle of throttleDragRotate of x, y when drag.
* @name Moveable.Draggable#startDragRotate
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body);
*
* // 45, 135, 225, 315
* moveable.throttleDragRotate = 90;
* moveable.startDragRotate = 45;
*/

/**
 * When the drag starts, the dragStart event is called.
 * @memberof Moveable.Draggable
 * @event dragStart
 * @param {Moveable.Draggable.OnDragStart} - Parameters for the dragStart event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { draggable: true });
 * moveable.on("dragStart", ({ target }) => {
 *     console.log(target);
 * });
 */

/**
 * When dragging, the drag event is called.
 * @memberof Moveable.Draggable
 * @event drag
 * @param {Moveable.Draggable.OnDrag} - Parameters for the drag event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { draggable: true });
 * moveable.on("drag", ({ target, transform }) => {
 *     target.style.transform = transform;
 * });
 */

/**
 * When the drag finishes, the dragEnd event is called.
 * @memberof Moveable.Draggable
 * @event dragEnd
 * @param {Moveable.Draggable.OnDragEnd} - Parameters for the dragEnd event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { draggable: true });
 * moveable.on("dragEnd", ({ target, isDrag }) => {
 *     console.log(target, isDrag);
 * });
 */

/**
* When the group drag starts, the `dragGroupStart` event is called.
* @memberof Moveable.Draggable
* @event dragGroupStart
* @param {Moveable.Draggable.OnDragGroupStart} - Parameters for the `dragGroupStart` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     target: [].slice.call(document.querySelectorAll(".target")),
*     draggable: true
* });
* moveable.on("dragGroupStart", ({ targets }) => {
*     console.log("onDragGroupStart", targets);
* });
*/

/**
* When the group drag, the `dragGroup` event is called.
* @memberof Moveable.Draggable
* @event dragGroup
* @param {Moveable.Draggable.OnDragGroup} - Parameters for the `dragGroup` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     target: [].slice.call(document.querySelectorAll(".target")),
*     draggable: true
* });
* moveable.on("dragGroup", ({ targets, events }) => {
*     console.log("onDragGroup", targets);
*     events.forEach(ev => {
*          // drag event
*          console.log("onDrag left, top", ev.left, ev.top);
*          // ev.target!.style.left = `${ev.left}px`;
*          // ev.target!.style.top = `${ev.top}px`;
*          console.log("onDrag translate", ev.dist);
*          ev.target!.style.transform = ev.transform;)
*     });
* });
*/

/**
 * When the group drag finishes, the `dragGroupEnd` event is called.
 * @memberof Moveable.Draggable
 * @event dragGroupEnd
 * @param {Moveable.Draggable.OnDragGroupEnd} - Parameters for the `dragGroupEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     draggable: true
 * });
 * moveable.on("dragGroupEnd", ({ targets, isDrag }) => {
 *     console.log("onDragGroupEnd", targets, isDrag);
 * });
 */

function calculatePointerDist(moveable, e) {
  var clientX = e.clientX,
      clientY = e.clientY,
      datas = e.datas;
  var _a = moveable.state,
      moveableClientRect = _a.moveableClientRect,
      rootMatrix = _a.rootMatrix,
      is3d = _a.is3d,
      pos1 = _a.pos1;
  var left = moveableClientRect.left,
      top = moveableClientRect.top;
  var n = is3d ? 4 : 3;

  var _b = minus(calculateInversePosition(rootMatrix, [clientX - left, clientY - top], n), pos1),
      posX = _b[0],
      posY = _b[1];

  var _c = getDragDist({
    datas: datas,
    distX: posX,
    distY: posY
  }),
      distX = _c[0],
      distY = _c[1];

  return [distX, distY];
}

function setDragStart(moveable, _a) {
  var datas = _a.datas;
  var _b = moveable.state,
      allMatrix = _b.allMatrix,
      beforeMatrix = _b.beforeMatrix,
      is3d = _b.is3d,
      left = _b.left,
      top = _b.top,
      origin = _b.origin,
      offsetMatrix = _b.offsetMatrix,
      targetMatrix = _b.targetMatrix,
      transformOrigin = _b.transformOrigin;
  var n = is3d ? 4 : 3;
  datas.is3d = is3d;
  datas.matrix = allMatrix;
  datas.targetMatrix = targetMatrix;
  datas.beforeMatrix = beforeMatrix;
  datas.offsetMatrix = offsetMatrix;
  datas.transformOrigin = transformOrigin;
  datas.inverseMatrix = matrix_esm_invert(allMatrix, n);
  datas.inverseBeforeMatrix = matrix_esm_invert(beforeMatrix, n);
  datas.absoluteOrigin = convertPositionMatrix(plus([left, top], origin), n);
  datas.startDragBeforeDist = calculate(datas.inverseBeforeMatrix, datas.absoluteOrigin, n);
  datas.startDragDist = calculate(datas.inverseMatrix, datas.absoluteOrigin, n);
}

function getTransformDirection(e) {
  return calculateMoveablePosition(e.datas.beforeTransform, [50, 50], 100, 100).direction;
}

function resolveTransformEvent(event, functionName) {
  var datas = event.datas,
      originalDatas = event.originalDatas.beforeRenderable;
  var index = datas.transformIndex;
  var nextTransforms = originalDatas.nextTransforms;
  var nextTransformAppendedIndexes = originalDatas.nextTransformAppendedIndexes;
  var nextIndex = 0;

  if (index === -1) {
    nextIndex = nextTransforms.length;
    datas.transformIndex = nextIndex;
  } else {
    nextIndex = index + nextTransformAppendedIndexes.filter(function (i) {
      return i < index;
    }).length;
  }

  var result = convertTransformInfo(nextTransforms, nextIndex);
  var targetFunction = result.targetFunction;
  var matFunctionName = functionName === "rotate" ? "rotateZ" : functionName;
  datas.beforeFunctionTexts = result.beforeFunctionTexts;
  datas.afterFunctionTexts = result.afterFunctionTexts;
  datas.beforeTransform = result.beforeFunctionMatrix;
  datas.beforeTransform2 = result.beforeFunctionMatrix2;
  datas.targetTansform = result.targetFunctionMatrix;
  datas.afterTransform = result.afterFunctionMatrix;
  datas.afterTransform2 = result.afterFunctionMatrix2;
  datas.targetAllTransform = result.allFunctionMatrix;

  if (targetFunction.functionName === matFunctionName) {
    datas.afterFunctionTexts.splice(0, 1);
    datas.isAppendTransform = false;
  } else {
    datas.isAppendTransform = true;
    originalDatas.nextTransformAppendedIndexes = __spreadArray(__spreadArray([], nextTransformAppendedIndexes, true), [nextIndex], false);
  }
}

function convertTransformFormat(datas, value, dist) {
  return "".concat(datas.beforeFunctionTexts.join(" "), " ").concat(datas.isAppendTransform ? dist : value, " ").concat(datas.afterFunctionTexts.join(" "));
}

function getTransformDist(_a) {
  var datas = _a.datas,
      distX = _a.distX,
      distY = _a.distY;

  var _b = getBeforeDragDist({
    datas: datas,
    distX: distX,
    distY: distY
  }),
      bx = _b[0],
      by = _b[1]; // B * [tx, ty] * A = [bx, by] * targetMatrix;
  // [tx, ty] = B-1 * [bx, by] * targetMatrix * A-1 * [0, 0];


  var res = getTransfromMatrix(datas, fromTranslation([bx, by], 4));
  return calculate(res, convertPositionMatrix([0, 0, 0], 4), 4);
}

function getTransfromMatrix(datas, targetMatrix, isAfter) {
  var beforeTransform = datas.beforeTransform,
      afterTransform = datas.afterTransform,
      beforeTransform2 = datas.beforeTransform2,
      afterTransform2 = datas.afterTransform2,
      targetAllTransform = datas.targetAllTransform; // B * afterTargetMatrix * A = (targetMatrix * targetAllTransform)
  // afterTargetMatrix = B-1 * targetMatrix * targetAllTransform * A-1
  // nextTargetMatrix = (targetMatrix * targetAllTransform)

  var nextTargetMatrix = isAfter ? multiply(targetAllTransform, targetMatrix, 4) : multiply(targetMatrix, targetAllTransform, 4); // res1 = B-1 * nextTargetMatrix

  var res1 = multiply(matrix_esm_invert(isAfter ? beforeTransform2 : beforeTransform, 4), nextTargetMatrix, 4); // res3 = res2 * A-1

  var afterTargetMatrix = multiply(res1, matrix_esm_invert(isAfter ? afterTransform2 : afterTransform, 4), 4);
  return afterTargetMatrix;
}

function getBeforeDragDist(_a) {
  var datas = _a.datas,
      distX = _a.distX,
      distY = _a.distY; // TT = BT

  var inverseBeforeMatrix = datas.inverseBeforeMatrix,
      is3d = datas.is3d,
      startDragBeforeDist = datas.startDragBeforeDist,
      absoluteOrigin = datas.absoluteOrigin;
  var n = is3d ? 4 : 3; // ABS_ORIGIN * [distX, distY] = BM * (ORIGIN + [tx, ty])
  // BM -1 * ABS_ORIGIN * [distX, distY] - ORIGIN = [tx, ty]

  return minus(calculate(inverseBeforeMatrix, plus(absoluteOrigin, [distX, distY]), n), startDragBeforeDist);
}

function getDragDist(_a, isBefore) {
  var datas = _a.datas,
      distX = _a.distX,
      distY = _a.distY;
  var inverseBeforeMatrix = datas.inverseBeforeMatrix,
      inverseMatrix = datas.inverseMatrix,
      is3d = datas.is3d,
      startDragBeforeDist = datas.startDragBeforeDist,
      startDragDist = datas.startDragDist,
      absoluteOrigin = datas.absoluteOrigin;
  var n = is3d ? 4 : 3;
  return minus(calculate(isBefore ? inverseBeforeMatrix : inverseMatrix, plus(absoluteOrigin, [distX, distY]), n), isBefore ? startDragBeforeDist : startDragDist);
}

function getInverseDragDist(_a, isBefore) {
  var datas = _a.datas,
      distX = _a.distX,
      distY = _a.distY;
  var beforeMatrix = datas.beforeMatrix,
      matrix = datas.matrix,
      is3d = datas.is3d,
      startDragBeforeDist = datas.startDragBeforeDist,
      startDragDist = datas.startDragDist,
      absoluteOrigin = datas.absoluteOrigin;
  var n = is3d ? 4 : 3;
  return minus(calculate(isBefore ? beforeMatrix : matrix, plus(isBefore ? startDragBeforeDist : startDragDist, [distX, distY]), n), absoluteOrigin);
}

function calculateTransformOrigin(transformOrigin, width, height, prevWidth, prevHeight, prevOrigin) {
  if (prevWidth === void 0) {
    prevWidth = width;
  }

  if (prevHeight === void 0) {
    prevHeight = height;
  }

  if (prevOrigin === void 0) {
    prevOrigin = [0, 0];
  }

  if (!transformOrigin) {
    return prevOrigin;
  }

  return transformOrigin.map(function (pos, i) {
    var _a = splitUnit(pos),
        value = _a.value,
        unit = _a.unit;

    var prevSize = i ? prevHeight : prevWidth;
    var size = i ? height : width;

    if (pos === "%" || isNaN(value)) {
      // no value but %
      var measureRatio = prevSize ? prevOrigin[i] / prevSize : 0;
      return size * measureRatio;
    } else if (unit !== "%") {
      return value;
    }

    return size * value / 100;
  });
}

function getPosIndexesByDirection(direction) {
  var indexes = [];

  if (direction[1] >= 0) {
    if (direction[0] >= 0) {
      indexes.push(3);
    }

    if (direction[0] <= 0) {
      indexes.push(2);
    }
  }

  if (direction[1] <= 0) {
    if (direction[0] >= 0) {
      indexes.push(1);
    }

    if (direction[0] <= 0) {
      indexes.push(0);
    }
  }

  return indexes;
}

function getPosesByDirection(poses, direction) {
  /*
  [-1, -1](pos1)       [0, -1](pos1,pos2)       [1, -1](pos2)
  [-1, 0](pos1, pos3)                           [1, 0](pos2, pos4)
  [-1, 1](pos3)        [0, 1](pos3, pos4)       [1, 1](pos4)
  */
  return getPosIndexesByDirection(direction).map(function (index) {
    return poses[index];
  });
}

function getPosByDirection(poses, direction) {
  /*
  [-1, -1](pos1)       [0, -1](pos1,pos2)       [1, -1](pos2)
  [-1, 0](pos1, pos3)                           [1, 0](pos2, pos4)
  [-1, 1](pos3)        [0, 1](pos3, pos4)       [1, 1](pos4)
  */
  var nextPoses = getPosesByDirection(poses, direction);
  return [utils_esm_average(nextPoses.map(function (pos) {
    return pos[0];
  })), utils_esm_average(nextPoses.map(function (pos) {
    return pos[1];
  }))];
}

function moveable_esm_getDist(startPos, matrix, width, height, n, fixedDirection) {
  var poses = calculatePoses(matrix, width, height, n);
  var fixedPos = getPosByDirection(poses, fixedDirection);
  var distX = startPos[0] - fixedPos[0];
  var distY = startPos[1] - fixedPos[1];
  return [distX, distY];
}

function getNextMatrix(offsetMatrix, targetMatrix, origin, n) {
  return multiply(offsetMatrix, getAbsoluteMatrix(targetMatrix, n, origin), n);
}

function getNextTransformMatrix(state, datas, transform) {
  var transformOrigin = state.transformOrigin,
      offsetMatrix = state.offsetMatrix,
      is3d = state.is3d;
  var beforeTransform = datas.beforeTransform,
      afterTransform = datas.afterTransform;
  var n = is3d ? 4 : 3;
  var targetTransform = parseMat([transform]);
  return getNextMatrix(offsetMatrix, convertDimension(multiply(multiply(beforeTransform, targetTransform, 4), afterTransform, 4), 4, n), transformOrigin, n);
}

function scaleMatrix(state, scale) {
  var transformOrigin = state.transformOrigin,
      offsetMatrix = state.offsetMatrix,
      is3d = state.is3d,
      targetMatrix = state.targetMatrix;
  var n = is3d ? 4 : 3;
  return getNextMatrix(offsetMatrix, multiply(targetMatrix, createScaleMatrix(scale, n), n), transformOrigin, n);
}

function fillTransformStartEvent(e) {
  var originalDatas = e.originalDatas.beforeRenderable;
  return {
    setTransform: function (transform, index) {
      if (index === void 0) {
        index = -1;
      }

      originalDatas.startTransforms = isArray(transform) ? transform : splitSpace(transform);
      setTransformIndex(e, index);
    },
    setTransformIndex: function (index) {
      setTransformIndex(e, index);
    }
  };
}

function setDefaultTransformIndex(e, property) {
  var originalDatas = e.originalDatas.beforeRenderable;
  var startTransforms = originalDatas.startTransforms;
  setTransformIndex(e, findIndex(startTransforms, function (func) {
    return func.indexOf("".concat(property, "(")) === 0;
  }));
}

function setTransformIndex(e, index) {
  var originalDatas = e.originalDatas.beforeRenderable;
  var datas = e.datas;
  datas.transformIndex = index;

  if (index === -1) {
    return;
  }

  var transform = originalDatas.startTransforms[index];

  if (!transform) {
    return;
  }

  var info = parse([transform]);
  datas.startValue = info[0].functionValue;
}

function fillOriginalTransform(e, transform) {
  var originalDatas = e.originalDatas.beforeRenderable;
  originalDatas.nextTransforms = splitSpace(transform);
}

function getNextTransformText(e) {
  var originalDatas = e.originalDatas.beforeRenderable;
  return originalDatas.nextTransforms.join(" ");
}

function fillTransformEvent(moveable, nextTransform, delta, isPinch, e) {
  fillOriginalTransform(e, nextTransform);
  return {
    transform: nextTransform,
    drag: moveable_esm_Draggable.drag(moveable, setCustomDrag(e, moveable.state, delta, isPinch, false))
  };
}

function getTranslateDist(moveable, transform, fixedDirection, fixedPosition, datas) {
  var state = moveable.state;
  var left = state.left,
      top = state.top;
  var groupable = moveable.props.groupable;
  var nextMatrix = getNextTransformMatrix(moveable.state, datas, transform);
  var groupLeft = groupable ? left : 0;
  var groupTop = groupable ? top : 0;
  var nextFixedPosition = getDirectionOffset(moveable, fixedDirection, nextMatrix);
  var dist = minus(fixedPosition, nextFixedPosition);
  return minus(dist, [groupLeft, groupTop]);
}

function getScaleDist(moveable, scaleDist, fixedDirection, fixedPosition, datas) {
  var dist = getTranslateDist(moveable, "scale(".concat(scaleDist.join(", "), ")"), fixedDirection, fixedPosition, datas);
  return dist;
}

function getOriginDirection(moveable) {
  var _a = moveable.state,
      width = _a.width,
      height = _a.height,
      transformOrigin = _a.transformOrigin;
  return [-1 + transformOrigin[0] / (width / 2), -1 + transformOrigin[1] / (height / 2)];
}

function getDirectionOffset(moveable, direction, nextMatrix) {
  if (nextMatrix === void 0) {
    nextMatrix = moveable.state.allMatrix;
  }

  var _a = moveable.state,
      width = _a.width,
      height = _a.height,
      is3d = _a.is3d;
  var n = is3d ? 4 : 3;
  var nextFixedOffset = [width / 2 * (1 + direction[0]), height / 2 * (1 + direction[1])];
  return calculatePosition(nextMatrix, nextFixedOffset, n);
}

function getRotateDist(moveable, rotateDist, fixedPosition, datas) {
  var fixedDirection = getOriginDirection(moveable);
  return getTranslateDist(moveable, "rotate(".concat(rotateDist, "deg)"), fixedDirection, fixedPosition, datas);
}

function getResizeDist(moveable, width, height, fixedDirection, fixedPosition, transformOrigin) {
  var groupable = moveable.props.groupable;
  var _a = moveable.state,
      prevOrigin = _a.transformOrigin,
      targetMatrix = _a.targetMatrix,
      offsetMatrix = _a.offsetMatrix,
      is3d = _a.is3d,
      prevWidth = _a.width,
      prevHeight = _a.height,
      left = _a.left,
      top = _a.top;
  var n = is3d ? 4 : 3;
  var nextOrigin = calculateTransformOrigin(transformOrigin, width, height, prevWidth, prevHeight, prevOrigin);
  var groupLeft = groupable ? left : 0;
  var groupTop = groupable ? top : 0;
  var nextMatrix = getNextMatrix(offsetMatrix, targetMatrix, nextOrigin, n);
  var dist = moveable_esm_getDist(fixedPosition, nextMatrix, width, height, n, fixedDirection);
  return minus(dist, [groupLeft, groupTop]);
}

function getAbsolutePosition(moveable, direction) {
  return getPosByDirection(getAbsolutePosesByState(moveable.state), direction);
}

function multiply2(pos1, pos2) {
  return [pos1[0] * pos2[0], pos1[1] * pos2[1]];
}

function prefix() {
  var classNames = [];

  for (var _i = 0; _i < arguments.length; _i++) {
    classNames[_i] = arguments[_i];
  }

  return prefixNames.apply(void 0, __spreadArray([PREFIX], classNames, false));
}

function defaultSync(fn) {
  fn();
}

function getTransformMatrix(transform) {
  if (!transform || transform === "none") {
    return [1, 0, 0, 1, 0, 0];
  }

  if (utils_esm_isObject(transform)) {
    return transform;
  }

  return parseMat(transform);
}

function getAbsoluteMatrix(matrix, n, origin) {
  return multiplies(n, createOriginMatrix(origin, n), matrix, createOriginMatrix(origin.map(function (a) {
    return -a;
  }), n));
}

function measureSVGSize(el, unit, isHorizontal) {
  if (unit === "%") {
    var viewBox = getSVGViewBox(el.ownerSVGElement);
    return viewBox[isHorizontal ? "width" : "height"] / 100;
  }

  return 1;
}

function getBeforeTransformOrigin(el) {
  var relativeOrigin = getTransformOrigin(moveable_esm_getComputedStyle(el, ":before"));
  return relativeOrigin.map(function (o, i) {
    var _a = splitUnit(o),
        value = _a.value,
        unit = _a.unit;

    return value * measureSVGSize(el, unit, i === 0);
  });
}

function getTransformOrigin(style) {
  var transformOrigin = style.transformOrigin;
  return transformOrigin ? transformOrigin.split(" ") : ["0", "0"];
}

function getElementTransform(target, computedStyle) {
  if (computedStyle === void 0) {
    computedStyle = moveable_esm_getComputedStyle(target);
  }

  var computedTransform = computedStyle.transform;

  if (computedTransform && computedTransform !== "none") {
    return computedStyle.transform;
  }

  if ("transform" in target) {
    var list = target.transform;
    var baseVal = list.baseVal;

    if (!baseVal) {
      return "";
    }

    var length = baseVal.length;

    if (!length) {
      return "";
    }

    var matrixes = [];

    var _loop_1 = function (i) {
      var matrix = baseVal[i].matrix;
      matrixes.push("matrix(".concat(["a", "b", "c", "d", "e", "f"].map(function (chr) {
        return matrix[chr];
      }).join(", "), ")"));
    };

    for (var i = 0; i < length; ++i) {
      _loop_1(i);
    }

    return matrixes.join(" ");
  }

  return "";
}

function getOffsetInfo(el, lastParent, isParent) {
  var body = document.body;
  var target = !el || isParent ? el : el.parentElement;
  var isEnd = el === lastParent || target === lastParent;
  var position = "relative";

  while (target && target !== body) {
    if (lastParent === target) {
      isEnd = true;
    }

    var style = moveable_esm_getComputedStyle(target);
    var tagName = target.tagName.toLowerCase();
    var transform = getElementTransform(target, style);
    position = style.position;

    if (tagName === "svg" || position !== "static" || transform && transform !== "none") {
      break;
    }

    target = target.parentElement;
    position = "relative";
  }

  return {
    isStatic: position === "static",
    isEnd: isEnd || !target || target === body,
    offsetParent: target || body
  };
}

function getOffsetPosInfo(el, style) {
  var _a;

  var tagName = el.tagName.toLowerCase();
  var offsetLeft = el.offsetLeft;
  var offsetTop = el.offsetTop; // svg

  var isSVG = isUndefined(offsetLeft);
  var hasOffset = !isSVG;
  var origin;
  var targetOrigin; // inner svg element

  if (!hasOffset && tagName !== "svg") {
    origin = IS_WEBKIT605 ? getBeforeTransformOrigin(el) : getTransformOrigin(style).map(function (pos) {
      return parseFloat(pos);
    });
    targetOrigin = origin.slice();
    hasOffset = true;
    _a = getSVGGraphicsOffset(el, origin), offsetLeft = _a[0], offsetTop = _a[1], origin[0] = _a[2], origin[1] = _a[3];
  } else {
    origin = getTransformOrigin(style).map(function (pos) {
      return parseFloat(pos);
    });
    targetOrigin = origin.slice();
  }

  return {
    tagName: tagName,
    isSVG: isSVG,
    hasOffset: hasOffset,
    offset: [offsetLeft || 0, offsetTop || 0],
    origin: origin,
    targetOrigin: targetOrigin
  };
}

function getBodyOffset(el, isSVG, style) {
  if (style === void 0) {
    style = moveable_esm_getComputedStyle(el);
  }

  var bodyStyle = moveable_esm_getComputedStyle(document.body);
  var bodyPosition = bodyStyle.position;

  if (!isSVG && (!bodyPosition || bodyPosition === "static")) {
    return [0, 0];
  }

  var marginLeft = parseInt(bodyStyle.marginLeft, 10);
  var marginTop = parseInt(bodyStyle.marginTop, 10);

  if (style.position === "absolute") {
    if (style.top !== "auto" || style.bottom !== "auto") {
      marginTop = 0;
    }

    if (style.left !== "auto" || style.right !== "auto") {
      marginLeft = 0;
    }
  }

  return [marginLeft, marginTop];
}

function convert3DMatrixes(matrixes) {
  matrixes.forEach(function (info) {
    var matrix = info.matrix;

    if (matrix) {
      info.matrix = convertDimension(matrix, 3, 4);
    }
  });
}

function getBodyScrollPos() {
  return [document.documentElement.scrollLeft || document.body.scrollLeft, document.documentElement.scrollTop || document.body.scrollTop];
}

function getPositionFixedInfo(el) {
  var fixedContainer = el.parentElement;
  var hasTransform = false;

  while (fixedContainer) {
    var transform = moveable_esm_getComputedStyle(fixedContainer).transform;

    if (transform && transform !== "none") {
      hasTransform = true;
      break;
    }

    if (fixedContainer === document.body) {
      break;
    }

    fixedContainer = fixedContainer.parentElement;
  }

  return {
    fixedContainer: fixedContainer || document.body,
    hasTransform: hasTransform
  };
}

function getMatrixStackInfo(target, container, checkContainer) {
  var el = target;
  var matrixes = [];
  var requestEnd = !checkContainer && target === container || target === document.body;
  var isEnd = requestEnd;
  var is3d = false;
  var n = 3;
  var transformOrigin;
  var targetTransformOrigin;
  var targetMatrix;
  var hasFixed = false;
  var offsetContainer = getOffsetInfo(container, container, true).offsetParent;

  while (el && !isEnd) {
    isEnd = requestEnd;
    var style = moveable_esm_getComputedStyle(el);
    var position = style.position;
    var transform = getElementTransform(el, style);
    var matrix = convertCSStoMatrix(getTransformMatrix(transform));
    var isFixed = position === "fixed";
    var fixedInfo = {
      hasTransform: false,
      fixedContainer: null
    };

    if (isFixed) {
      hasFixed = true;
      fixedInfo = getPositionFixedInfo(el);
      offsetContainer = fixedInfo.fixedContainer;
    } // convert 3 to 4


    var length = matrix.length;

    if (!is3d && length === 16) {
      is3d = true;
      n = 4;
      convert3DMatrixes(matrixes);

      if (targetMatrix) {
        targetMatrix = convertDimension(targetMatrix, 3, 4);
      }
    }

    if (is3d && length === 9) {
      matrix = convertDimension(matrix, 3, 4);
    }

    var _a = getOffsetPosInfo(el, style),
        tagName = _a.tagName,
        hasOffset = _a.hasOffset,
        isSVG = _a.isSVG,
        origin = _a.origin,
        targetOrigin = _a.targetOrigin,
        offsetPos = _a.offset;

    var offsetLeft = offsetPos[0],
        offsetTop = offsetPos[1];

    if (tagName === "svg" && targetMatrix) {
      // scale matrix for svg's SVGElements.
      matrixes.push({
        type: "target",
        target: el,
        matrix: getSVGMatrix(el, n)
      });
      matrixes.push({
        type: "offset",
        target: el,
        matrix: createIdentityMatrix(n)
      });
    } else if (tagName === "g" && target !== el) {
      offsetLeft = 0;
      offsetTop = 0;
    }

    var offsetParent = void 0;
    var isOffsetEnd = false;
    var isStatic = false;

    if (isFixed) {
      offsetParent = fixedInfo.fixedContainer;
      isOffsetEnd = true;
    } else {
      var offsetInfo = getOffsetInfo(el, container);
      offsetParent = offsetInfo.offsetParent;
      isOffsetEnd = offsetInfo.isEnd;
      isStatic = offsetInfo.isStatic;
    }

    if (IS_WEBKIT && hasOffset && !isSVG && isStatic && (position === "relative" || position === "static")) {
      offsetLeft -= offsetParent.offsetLeft;
      offsetTop -= offsetParent.offsetTop;
      requestEnd = requestEnd || isOffsetEnd;
    }

    var parentClientLeft = 0;
    var parentClientTop = 0;
    var fixedClientLeft = 0;
    var fixedClientTop = 0;

    if (isFixed) {
      if (hasOffset && fixedInfo.hasTransform) {
        // border
        fixedClientLeft = offsetParent.clientLeft;
        fixedClientTop = offsetParent.clientTop;
      }
    } else {
      if (hasOffset && offsetContainer !== offsetParent) {
        // border
        parentClientLeft = offsetParent.clientLeft;
        parentClientTop = offsetParent.clientTop;
      }

      if (hasOffset && offsetParent === document.body) {
        var margin = getBodyOffset(el, false, style);
        offsetLeft += margin[0];
        offsetTop += margin[1];
      }
    }

    matrixes.push({
      type: "target",
      target: el,
      matrix: getAbsoluteMatrix(matrix, n, origin)
    });

    if (hasOffset) {
      matrixes.push({
        type: "offset",
        target: el,
        matrix: createOriginMatrix([offsetLeft - el.scrollLeft + parentClientLeft - fixedClientLeft, offsetTop - el.scrollTop + parentClientTop - fixedClientTop], n)
      });
    } else {
      // svg
      matrixes.push({
        type: "offset",
        target: el,
        origin: origin
      });
    }

    if (!targetMatrix) {
      targetMatrix = matrix;
    }

    if (!transformOrigin) {
      transformOrigin = origin;
    }

    if (!targetTransformOrigin) {
      targetTransformOrigin = targetOrigin;
    }

    if (isEnd || isFixed) {
      break;
    } else {
      el = offsetParent;
      requestEnd = isOffsetEnd;
    }

    if (!checkContainer || el === document.body) {
      isEnd = requestEnd;
    }
  }

  if (!targetMatrix) {
    targetMatrix = createIdentityMatrix(n);
  }

  if (!transformOrigin) {
    transformOrigin = [0, 0];
  }

  if (!targetTransformOrigin) {
    targetTransformOrigin = [0, 0];
  }

  return {
    offsetContainer: offsetContainer,
    matrixes: matrixes,
    targetMatrix: targetMatrix,
    transformOrigin: transformOrigin,
    targetOrigin: targetTransformOrigin,
    is3d: is3d,
    hasFixed: hasFixed
  };
}

function calculateElementInfo(target, container, rootContainer, isAbsolute3d) {
  if (rootContainer === void 0) {
    rootContainer = container;
  }

  var width = 0;
  var height = 0;
  var rotation = 0;
  var allResult = {};

  if (target) {
    var _a = getSize(target),
        offsetWidth = _a.offsetWidth,
        offsetHeight = _a.offsetHeight;

    width = offsetWidth;
    height = offsetHeight;
  }

  if (target) {
    var result = calculateMatrixStack(target, container, rootContainer, isAbsolute3d);
    var position = calculateMoveablePosition(result.allMatrix, result.transformOrigin, width, height);
    allResult = moveable_esm_assign(moveable_esm_assign({}, result), position);
    var rotationPosition = calculateMoveablePosition(result.allMatrix, [50, 50], 100, 100);
    rotation = getRotationRad([rotationPosition.pos1, rotationPosition.pos2], rotationPosition.direction);
  }

  var n = isAbsolute3d ? 4 : 3;
  return moveable_esm_assign({
    width: width,
    height: height,
    rotation: rotation,
    rootMatrix: createIdentityMatrix(n),
    beforeMatrix: createIdentityMatrix(n),
    offsetMatrix: createIdentityMatrix(n),
    allMatrix: createIdentityMatrix(n),
    targetMatrix: createIdentityMatrix(n),
    targetTransform: "",
    transformOrigin: [0, 0],
    targetOrigin: [0, 0],
    is3d: !!isAbsolute3d,
    left: 0,
    top: 0,
    right: 0,
    bottom: 0,
    origin: [0, 0],
    pos1: [0, 0],
    pos2: [0, 0],
    pos3: [0, 0],
    pos4: [0, 0],
    direction: 1,
    hasFixed: false
  }, allResult);
}

function getElementInfo(target, container, rootContainer) {
  if (rootContainer === void 0) {
    rootContainer = container;
  }

  return calculateElementInfo(target, container, rootContainer, true);
}

function calculateMatrixStack(target, container, rootContainer, isAbsolute3d) {
  var _a;

  if (rootContainer === void 0) {
    rootContainer = container;
  }

  var _b = getMatrixStackInfo(target, container),
      matrixes = _b.matrixes,
      is3d = _b.is3d,
      prevTargetMatrix = _b.targetMatrix,
      transformOrigin = _b.transformOrigin,
      targetOrigin = _b.targetOrigin,
      offsetContainer = _b.offsetContainer,
      hasFixed = _b.hasFixed; // prevMatrix


  var _c = getMatrixStackInfo(offsetContainer, rootContainer, true),
      rootMatrixes = _c.matrixes,
      isRoot3d = _c.is3d; // prevRootMatrix
  // if (rootContainer === document.body) {
  //     console.log(offsetContainer, rootContainer, rootMatrixes);
  // }


  var isNext3d = isAbsolute3d || isRoot3d || is3d;
  var n = isNext3d ? 4 : 3;
  var isSVGGraphicElement = target.tagName.toLowerCase() !== "svg" && "ownerSVGElement" in target;
  var targetMatrix = prevTargetMatrix; // let allMatrix = prevMatrix ? convertDimension(prevMatrix, prevN!, n) : createIdentityMatrix(n);
  // let rootMatrix = prevRootMatrix ? convertDimension(prevRootMatrix, prevN!, n) : createIdentityMatrix(n);
  // let beforeMatrix = prevMatrix ? convertDimension(prevMatrix, prevN!, n) : createIdentityMatrix(n);

  var allMatrix = createIdentityMatrix(n);
  var rootMatrix = createIdentityMatrix(n);
  var beforeMatrix = createIdentityMatrix(n);
  var offsetMatrix = createIdentityMatrix(n);
  var length = matrixes.length;
  rootMatrixes.reverse();
  matrixes.reverse();

  if (!is3d && isNext3d) {
    targetMatrix = convertDimension(targetMatrix, 3, 4);
    convert3DMatrixes(matrixes);
  }

  if (!isRoot3d && isNext3d) {
    convert3DMatrixes(rootMatrixes);
  } // rootMatrix = (...) -> container -> offset -> absolute -> offset -> absolute(targetMatrix)
  // rootMatrixBeforeOffset = lastOffsetMatrix -> (...) -> container
  // beforeMatrix = (... -> container -> offset -> absolute) -> offset -> absolute(targetMatrix)
  // offsetMatrix = (... -> container -> offset -> absolute -> offset) -> absolute(targetMatrix)


  rootMatrixes.forEach(function (info) {
    rootMatrix = multiply(rootMatrix, info.matrix, n);
  });
  var originalRootContainer = rootContainer || document.body;
  var endContainer = ((_a = rootMatrixes[0]) === null || _a === void 0 ? void 0 : _a.target) || getOffsetInfo(originalRootContainer, originalRootContainer, true).offsetParent;
  var rootMatrixBeforeOffset = rootMatrixes.slice(1).reduce(function (matrix, info) {
    return multiply(matrix, info.matrix, n);
  }, createIdentityMatrix(n));
  matrixes.forEach(function (info, i) {
    if (length - 2 === i) {
      // length - 3
      beforeMatrix = allMatrix.slice();
    }

    if (length - 1 === i) {
      // length - 2
      offsetMatrix = allMatrix.slice();
    } // calculate for SVGElement


    if (!info.matrix) {
      var nextInfo = matrixes[i + 1];
      var offset = getSVGOffset(info, nextInfo, endContainer, n, multiply(rootMatrixBeforeOffset, allMatrix, n));
      info.matrix = createOriginMatrix(offset, n);
    }

    allMatrix = multiply(allMatrix, info.matrix, n);
  });
  var isMatrix3d = !isSVGGraphicElement && is3d;

  if (!targetMatrix) {
    targetMatrix = createIdentityMatrix(isMatrix3d ? 4 : 3);
  }

  var targetTransform = makeMatrixCSS(isSVGGraphicElement && targetMatrix.length === 16 ? convertDimension(targetMatrix, 4, 3) : targetMatrix, isMatrix3d);
  rootMatrix = ignoreDimension(rootMatrix, n, n);
  return {
    hasFixed: hasFixed,
    rootMatrix: rootMatrix,
    beforeMatrix: beforeMatrix,
    offsetMatrix: offsetMatrix,
    allMatrix: allMatrix,
    targetMatrix: targetMatrix,
    targetTransform: targetTransform,
    transformOrigin: transformOrigin,
    targetOrigin: targetOrigin,
    is3d: isNext3d
  };
}

function makeMatrixCSS(matrix, is3d) {
  if (is3d === void 0) {
    is3d = matrix.length > 9;
  }

  return "".concat(is3d ? "matrix3d" : "matrix", "(").concat(convertMatrixtoCSS(matrix, !is3d).join(","), ")");
}

function getSVGViewBox(el) {
  var clientWidth = el.clientWidth;
  var clientHeight = el.clientHeight;

  if (!el) {
    return {
      x: 0,
      y: 0,
      width: 0,
      height: 0,
      clientWidth: clientWidth,
      clientHeight: clientHeight
    };
  }

  var viewBox = el.viewBox;
  var baseVal = viewBox && viewBox.baseVal || {
    x: 0,
    y: 0,
    width: 0,
    height: 0
  };
  return {
    x: baseVal.x,
    y: baseVal.y,
    width: baseVal.width || clientWidth,
    height: baseVal.height || clientHeight,
    clientWidth: clientWidth,
    clientHeight: clientHeight
  };
}

function getSVGMatrix(el, n) {
  var _a = getSVGViewBox(el),
      viewBoxWidth = _a.width,
      viewBoxHeight = _a.height,
      clientWidth = _a.clientWidth,
      clientHeight = _a.clientHeight;

  var scaleX = clientWidth / viewBoxWidth;
  var scaleY = clientHeight / viewBoxHeight;
  var preserveAspectRatio = el.preserveAspectRatio.baseVal; // https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/preserveAspectRatio

  var align = preserveAspectRatio.align; // 1 : meet 2: slice

  var meetOrSlice = preserveAspectRatio.meetOrSlice;
  var svgOrigin = [0, 0];
  var scale = [scaleX, scaleY];
  var translate = [0, 0];

  if (align !== 1) {
    var xAlign = (align - 2) % 3;
    var yAlign = Math.floor((align - 2) / 3);
    svgOrigin[0] = viewBoxWidth * xAlign / 2;
    svgOrigin[1] = viewBoxHeight * yAlign / 2;
    var scaleDimension = meetOrSlice === 2 ? Math.max(scaleY, scaleX) : Math.min(scaleX, scaleY);
    scale[0] = scaleDimension;
    scale[1] = scaleDimension;
    translate[0] = (clientWidth - viewBoxWidth) / 2 * xAlign;
    translate[1] = (clientHeight - viewBoxHeight) / 2 * yAlign;
  }

  var scaleMatrix = createScaleMatrix(scale, n);
  scaleMatrix[n * (n - 1)] = translate[0], scaleMatrix[n * (n - 1) + 1] = translate[1];
  return getAbsoluteMatrix(scaleMatrix, n, svgOrigin);
}

function getSVGGraphicsOffset(el, origin) {
  if (!el.getBBox || el.tagName.toLowerCase() === "g") {
    return [0, 0, 0, 0];
  }

  var bbox = el.getBBox();
  var viewBox = getSVGViewBox(el.ownerSVGElement);
  var left = bbox.x - viewBox.x;
  var top = bbox.y - viewBox.y;
  return [left, top, origin[0] - left, origin[1] - top];
}

function calculatePosition(matrix, pos, n) {
  return calculate(matrix, convertPositionMatrix(pos, n), n);
}

function calculatePoses(matrix, width, height, n) {
  return [[0, 0], [width, 0], [0, height], [width, height]].map(function (pos) {
    return calculatePosition(matrix, pos, n);
  });
}

function moveable_esm_getRect(poses) {
  var posesX = poses.map(function (pos) {
    return pos[0];
  });
  var posesY = poses.map(function (pos) {
    return pos[1];
  });
  var left = Math.min.apply(Math, posesX);
  var top = Math.min.apply(Math, posesY);
  var right = Math.max.apply(Math, posesX);
  var bottom = Math.max.apply(Math, posesY);
  var rectWidth = right - left;
  var rectHeight = bottom - top;
  return {
    left: left,
    top: top,
    right: right,
    bottom: bottom,
    width: rectWidth,
    height: rectHeight
  };
}

function calculateRect(matrix, width, height, n) {
  var poses = calculatePoses(matrix, width, height, n);
  return moveable_esm_getRect(poses);
}

function getSVGOffset(offsetInfo, targetInfo, container, n, beforeMatrix) {
  var _a;

  var target = offsetInfo.target;
  var origin = offsetInfo.origin;
  var targetMatrix = targetInfo.matrix;

  var _b = getSize(target),
      width = _b.offsetWidth,
      height = _b.offsetHeight;

  var containerClientRect = container.getBoundingClientRect();
  var margin = [0, 0];

  if (container === document.body) {
    margin = getBodyOffset(target, true);
  }

  var rect = target.getBoundingClientRect();
  var rectLeft = rect.left - containerClientRect.left + container.scrollLeft - (container.clientLeft || 0) + margin[0];
  var rectTop = rect.top - containerClientRect.top + container.scrollTop - (container.clientTop || 0) + margin[1];
  var rectWidth = rect.width;
  var rectHeight = rect.height;
  var mat = multiplies(n, beforeMatrix, targetMatrix);

  var _c = calculateRect(mat, width, height, n),
      prevLeft = _c.left,
      prevTop = _c.top,
      prevWidth = _c.width,
      prevHeight = _c.height;

  var posOrigin = calculatePosition(mat, origin, n);
  var prevOrigin = minus(posOrigin, [prevLeft, prevTop]);
  var rectOrigin = [rectLeft + prevOrigin[0] * rectWidth / prevWidth, rectTop + prevOrigin[1] * rectHeight / prevHeight];
  var offset = [0, 0];
  var count = 0;

  while (++count < 10) {
    var inverseBeforeMatrix = matrix_esm_invert(beforeMatrix, n);
    _a = minus(calculatePosition(inverseBeforeMatrix, rectOrigin, n), calculatePosition(inverseBeforeMatrix, posOrigin, n)), offset[0] = _a[0], offset[1] = _a[1];
    var mat2 = multiplies(n, beforeMatrix, createOriginMatrix(offset, n), targetMatrix);

    var _d = calculateRect(mat2, width, height, n),
        nextLeft = _d.left,
        nextTop = _d.top;

    var distLeft = nextLeft - rectLeft;
    var distTop = nextTop - rectTop;

    if (Math.abs(distLeft) < 2 && Math.abs(distTop) < 2) {
      break;
    }

    rectOrigin[0] -= distLeft;
    rectOrigin[1] -= distTop;
  }

  return offset.map(function (p) {
    return Math.round(p);
  });
}

function calculateMoveablePosition(matrix, origin, width, height) {
  var is3d = matrix.length === 16;
  var n = is3d ? 4 : 3;
  var poses = calculatePoses(matrix, width, height, n);
  var _a = poses[0],
      x1 = _a[0],
      y1 = _a[1],
      _b = poses[1],
      x2 = _b[0],
      y2 = _b[1],
      _c = poses[2],
      x3 = _c[0],
      y3 = _c[1],
      _d = poses[3],
      x4 = _d[0],
      y4 = _d[1];

  var _e = calculatePosition(matrix, origin, n),
      originX = _e[0],
      originY = _e[1];

  var left = Math.min(x1, x2, x3, x4);
  var top = Math.min(y1, y2, y3, y4);
  var right = Math.max(x1, x2, x3, x4);
  var bottom = Math.max(y1, y2, y3, y4);
  x1 = x1 - left || 0;
  x2 = x2 - left || 0;
  x3 = x3 - left || 0;
  x4 = x4 - left || 0;
  y1 = y1 - top || 0;
  y2 = y2 - top || 0;
  y3 = y3 - top || 0;
  y4 = y4 - top || 0;
  originX = originX - left || 0;
  originY = originY - top || 0;
  var direction = getShapeDirection(poses);
  return {
    left: left,
    top: top,
    right: right,
    bottom: bottom,
    origin: [originX, originY],
    pos1: [x1, y1],
    pos2: [x2, y2],
    pos3: [x3, y3],
    pos4: [x4, y4],
    direction: direction
  };
}

function getDistSize(vec) {
  return Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1]);
}

function getDiagonalSize(pos1, pos2) {
  return getDistSize([pos2[0] - pos1[0], pos2[1] - pos1[1]]);
}

function getLineStyle(pos1, pos2, zoom, rad) {
  if (zoom === void 0) {
    zoom = 1;
  }

  if (rad === void 0) {
    rad = getRad(pos1, pos2);
  }

  var width = getDiagonalSize(pos1, pos2);
  return {
    transform: "translateY(-50%) translate(".concat(pos1[0], "px, ").concat(pos1[1], "px) rotate(").concat(rad, "rad) scaleY(").concat(zoom, ")"),
    width: "".concat(width, "px")
  };
}

function getControlTransform(rotation, zoom) {
  var poses = [];

  for (var _i = 2; _i < arguments.length; _i++) {
    poses[_i - 2] = arguments[_i];
  }

  var length = poses.length;
  var x = poses.reduce(function (prev, pos) {
    return prev + pos[0];
  }, 0) / length;
  var y = poses.reduce(function (prev, pos) {
    return prev + pos[1];
  }, 0) / length;
  return {
    transform: "translateZ(0px) translate(".concat(x, "px, ").concat(y, "px) rotate(").concat(rotation, "rad) scale(").concat(zoom, ")")
  };
}

function getCSSSize(target) {
  var style = moveable_esm_getComputedStyle(target);
  return [parseFloat(style.width), parseFloat(style.height)];
}

function getSize(target, style) {
  if (style === void 0) {
    style = moveable_esm_getComputedStyle(target);
  }

  var hasOffset = !isUndefined(target.offsetWidth);

  if (!hasOffset && target.tagName.toLowerCase() !== "svg") {
    var bbox = target.getBBox();
    var offsetWidth = bbox.width;
    var offsetHeight = bbox.height;
    return {
      svg: true,
      offsetWidth: offsetWidth,
      offsetHeight: offsetHeight,
      clientWidth: offsetWidth,
      clientHeight: offsetHeight,
      cssWidth: offsetWidth,
      cssHeight: offsetHeight
    };
  } else {
    var boxSizing = style.boxSizing === "border-box";
    var borderLeft = parseFloat(style.borderLeftWidth) || 0;
    var borderRight = parseFloat(style.borderRightWidth) || 0;
    var borderTop = parseFloat(style.borderTopWidth) || 0;
    var borderBottom = parseFloat(style.borderBottomWidth) || 0;
    var paddingLeft = parseFloat(style.paddingLeft) || 0;
    var paddingRight = parseFloat(style.paddingRight) || 0;
    var paddingTop = parseFloat(style.paddingTop) || 0;
    var paddingBottom = parseFloat(style.paddingBottom) || 0;
    var cssWidth = parseFloat(style.width);
    var cssHeight = parseFloat(style.height);
    var offsetWidth = cssWidth;
    var offsetHeight = cssHeight;
    var clientWidth = cssWidth;
    var clientHeight = cssHeight;
    var horizontalPadding = paddingLeft + paddingRight;
    var verticalPadding = paddingTop + paddingBottom;
    var horizontalBorder = borderLeft + borderRight;
    var verticalBorder = borderTop + borderBottom;
    var horizontalOffset = horizontalPadding + horizontalBorder;
    var verticalOffset = verticalPadding + verticalBorder;

    if (boxSizing) {
      cssWidth = offsetWidth - horizontalOffset;
      cssHeight = offsetHeight - verticalOffset;
    } else {
      offsetWidth = cssWidth + horizontalOffset;
      offsetHeight = cssHeight + verticalOffset;
    }

    clientWidth = cssWidth + horizontalPadding;
    clientHeight = cssHeight + verticalPadding;
    return {
      svg: false,
      offsetWidth: offsetWidth,
      offsetHeight: offsetHeight,
      clientWidth: clientWidth,
      clientHeight: clientHeight,
      cssWidth: cssWidth,
      cssHeight: cssHeight
    };
  }
}

function getRotationRad(poses, direction) {
  return getRad(direction > 0 ? poses[0] : poses[1], direction > 0 ? poses[1] : poses[0]);
}

function getTargetInfo(moveableElement, target, container, parentContainer, rootContainer) {
  var beforeDirection = 1;
  var beforeOrigin = [0, 0];
  var targetClientRect = resetClientRect();
  var containerClientRect = resetClientRect();
  var moveableClientRect = resetClientRect();
  var result = calculateElementInfo(target, container, rootContainer, false);

  if (target) {
    var n = result.is3d ? 4 : 3;
    var beforePosition = calculateMoveablePosition(result.offsetMatrix, plus(result.transformOrigin, getOrigin(result.targetMatrix, n)), result.width, result.height);
    beforeDirection = beforePosition.direction;
    beforeOrigin = plus(beforePosition.origin, [beforePosition.left - result.left, beforePosition.top - result.top]);
    targetClientRect = getClientRect(target);
    containerClientRect = getClientRect(getOffsetInfo(parentContainer, parentContainer, true).offsetParent || document.body, true);

    if (moveableElement) {
      moveableClientRect = getClientRect(moveableElement);
    }
  }

  return moveable_esm_assign({
    targetClientRect: targetClientRect,
    containerClientRect: containerClientRect,
    moveableClientRect: moveableClientRect,
    beforeDirection: beforeDirection,
    beforeOrigin: beforeOrigin,
    originalBeforeOrigin: beforeOrigin,
    target: target
  }, result);
}

function resetClientRect() {
  return {
    left: 0,
    right: 0,
    top: 0,
    bottom: 0,
    width: 0,
    height: 0,
    clientLeft: 0,
    clientTop: 0,
    clientWidth: 0,
    clientHeight: 0,
    scrollWidth: 0,
    scrollHeight: 0
  };
}

function getClientRect(el, isExtends) {
  var _a;

  var left = 0;
  var top = 0;
  var width = 0;
  var height = 0;

  if (el === document.body || el === document.documentElement) {
    width = window.innerWidth;
    height = window.innerHeight;
    var scrollPos = getBodyScrollPos();
    _a = [-scrollPos[0], -scrollPos[1]], left = _a[0], top = _a[1];
  } else {
    var clientRect = el.getBoundingClientRect();
    left = clientRect.left;
    top = clientRect.top;
    width = clientRect.width;
    height = clientRect.height;
  }

  var rect = {
    left: left,
    right: left + width,
    top: top,
    bottom: top + height,
    width: width,
    height: height
  };

  if (isExtends) {
    rect.clientLeft = el.clientLeft;
    rect.clientTop = el.clientTop;
    rect.clientWidth = el.clientWidth;
    rect.clientHeight = el.clientHeight;
    rect.scrollWidth = el.scrollWidth;
    rect.scrollHeight = el.scrollHeight;
    rect.overflow = moveable_esm_getComputedStyle(el).overflow !== "visible";
  }

  return rect;
}

function getDirection(target) {
  if (!target) {
    return;
  }

  var direciton = target.getAttribute("data-direction");

  if (!direciton) {
    return;
  }

  var dir = [0, 0];
  direciton.indexOf("w") > -1 && (dir[0] = -1);
  direciton.indexOf("e") > -1 && (dir[0] = 1);
  direciton.indexOf("n") > -1 && (dir[1] = -1);
  direciton.indexOf("s") > -1 && (dir[1] = 1);
  return dir;
}

function getAbsolutePoses(poses, dist) {
  return [plus(dist, poses[0]), plus(dist, poses[1]), plus(dist, poses[2]), plus(dist, poses[3])];
}

function getAbsolutePosesByState(_a) {
  var left = _a.left,
      top = _a.top,
      pos1 = _a.pos1,
      pos2 = _a.pos2,
      pos3 = _a.pos3,
      pos4 = _a.pos4;
  return getAbsolutePoses([pos1, pos2, pos3, pos4], [left, top]);
}

function roundSign(num) {
  return Math.round(num % 1 === -0.5 ? num - 1 : num);
}

function unset(self, name) {
  var _a;

  (_a = self[name]) === null || _a === void 0 ? void 0 : _a.unset();
  self[name] = null;
}

function fillParams(moveable, e, params, isBeforeEvent) {
  var datas = e.datas;

  if (!datas.datas) {
    datas.datas = {};
  }

  var nextParams = moveable_esm_assign(moveable_esm_assign({}, params), {
    target: moveable.state.target,
    clientX: e.clientX,
    clientY: e.clientY,
    inputEvent: e.inputEvent,
    currentTarget: moveable,
    moveable: moveable,
    datas: datas.datas
  });

  if (!datas.isStartEvent) {
    datas.isStartEvent = true;
  } else if (!isBeforeEvent) {
    datas.lastEvent = nextParams;
  }

  return nextParams;
}

function fillEndParams(moveable, e, params) {
  var datas = e.datas;
  var isDrag = "isDrag" in params ? params.isDrag : e.isDrag;

  if (!datas.datas) {
    datas.datas = {};
  }

  return moveable_esm_assign(moveable_esm_assign({
    isDrag: isDrag
  }, params), {
    moveable: moveable,
    target: moveable.state.target,
    clientX: e.clientX,
    clientY: e.clientY,
    inputEvent: e.inputEvent,
    currentTarget: moveable,
    lastEvent: datas.lastEvent,
    isDouble: e.isDouble,
    datas: datas.datas
  });
}

function catchEvent(moveable, name, callback) {
  moveable._emitter.on(name, callback);
}

function triggerEvent(moveable, name, params, isManager) {
  return moveable.triggerEvent(name, params, isManager);
}

function moveable_esm_getComputedStyle(el, pseudoElt) {
  return window.getComputedStyle(el, pseudoElt);
}

function filterAbles(ables, methods, triggerAblesSimultaneously) {
  var enabledAbles = {};
  var ableGroups = {};
  return ables.filter(function (able) {
    var name = able.name;

    if (enabledAbles[name] || !methods.some(function (method) {
      return able[method];
    })) {
      return false;
    }

    if (!triggerAblesSimultaneously && able.ableGroup) {
      if (ableGroups[able.ableGroup]) {
        return false;
      }

      ableGroups[able.ableGroup] = true;
    }

    enabledAbles[name] = true;
    return true;
  });
}

function equals(a1, a2) {
  return a1 === a2 || a1 == null && a2 == null;
}

function selectValue() {
  var values = [];

  for (var _i = 0; _i < arguments.length; _i++) {
    values[_i] = arguments[_i];
  }

  var length = values.length - 1;

  for (var i = 0; i < length; ++i) {
    var value = values[i];

    if (!isUndefined(value)) {
      return value;
    }
  }

  return values[length];
}

function groupBy(arr, func) {
  var groups = [];
  var groupKeys = [];
  arr.forEach(function (el, index) {
    var groupKey = func(el, index, arr);
    var keyIndex = groupKeys.indexOf(groupKey);
    var group = groups[keyIndex] || [];

    if (keyIndex === -1) {
      groupKeys.push(groupKey);
      groups.push(group);
    }

    group.push(el);
  });
  return groups;
}

function groupByMap(arr, func) {
  var groups = [];
  var groupKeys = {};
  arr.forEach(function (el, index) {
    var groupKey = func(el, index, arr);
    var group = groupKeys[groupKey];

    if (!group) {
      group = [];
      groupKeys[groupKey] = group;
      groups.push(group);
    }

    group.push(el);
  });
  return groups;
}

function moveable_esm_flat(arr) {
  return arr.reduce(function (prev, cur) {
    return prev.concat(cur);
  }, []);
}

function maxOffset() {
  var args = [];

  for (var _i = 0; _i < arguments.length; _i++) {
    args[_i] = arguments[_i];
  }

  args.sort(function (a, b) {
    return Math.abs(b) - Math.abs(a);
  });
  return args[0];
}

function calculateInversePosition(matrix, pos, n) {
  return calculate(matrix_esm_invert(matrix, n), convertPositionMatrix(pos, n), n);
}

function convertDragDist(state, e) {
  var _a;

  var is3d = state.is3d,
      rootMatrix = state.rootMatrix;
  var n = is3d ? 4 : 3;
  _a = calculateInversePosition(rootMatrix, [e.distX, e.distY], n), e.distX = _a[0], e.distY = _a[1];
  return e;
}

function calculatePadding(matrix, pos, transformOrigin, origin, n) {
  return minus(calculatePosition(matrix, plus(transformOrigin, pos), n), origin);
}

function convertCSSSize(value, size, isRelative) {
  return isRelative ? "".concat(value / size * 100, "%") : "".concat(value, "px");
}

function getTinyDist(v) {
  return Math.abs(v) <= moveable_esm_TINY_NUM ? 0 : v;
}

function directionCondition(moveable, e) {
  if (e.isRequest) {
    if (e.requestAble === "resizable" || e.requestAble === "scalable") {
      return e.parentDirection;
    } else {
      return false;
    }
  }

  return hasClass(e.inputEvent.target, prefix("direction"));
}

function invertObject(obj) {
  var nextObj = {};

  for (var name in obj) {
    nextObj[obj[name]] = name;
  }

  return nextObj;
}

function convertTransformInfo(transforms, index) {
  var beforeFunctionTexts = transforms.slice(0, index < 0 ? undefined : index);
  var beforeFunctionTexts2 = transforms.slice(0, index < 0 ? undefined : index + 1);
  var targetFunctionText = transforms[index] || "";
  var afterFunctionTexts = index < 0 ? [] : transforms.slice(index);
  var afterFunctionTexts2 = index < 0 ? [] : transforms.slice(index + 1);
  var beforeFunctions = parse(beforeFunctionTexts);
  var beforeFunctions2 = parse(beforeFunctionTexts2);
  var targetFunctions = parse([targetFunctionText]);
  var afterFunctions = parse(afterFunctionTexts);
  var afterFunctions2 = parse(afterFunctionTexts2);
  var beforeFunctionMatrix = toMat(beforeFunctions);
  var beforeFunctionMatrix2 = toMat(beforeFunctions2);
  var afterFunctionMatrix = toMat(afterFunctions);
  var afterFunctionMatrix2 = toMat(afterFunctions2);
  var allFunctionMatrix = multiply(beforeFunctionMatrix, afterFunctionMatrix, 4);
  return {
    transforms: transforms,
    beforeFunctionMatrix: beforeFunctionMatrix,
    beforeFunctionMatrix2: beforeFunctionMatrix2,
    targetFunctionMatrix: toMat(targetFunctions),
    afterFunctionMatrix: afterFunctionMatrix,
    afterFunctionMatrix2: afterFunctionMatrix2,
    allFunctionMatrix: allFunctionMatrix,
    beforeFunctions: beforeFunctions,
    beforeFunctions2: beforeFunctions2,
    targetFunction: targetFunctions[0],
    afterFunctions: afterFunctions,
    afterFunctions2: afterFunctions2,
    beforeFunctionTexts: beforeFunctionTexts,
    beforeFunctionTexts2: beforeFunctionTexts2,
    targetFunctionText: targetFunctionText,
    afterFunctionTexts: afterFunctionTexts,
    afterFunctionTexts2: afterFunctionTexts2
  };
}

function isArrayFormat(arr) {
  if (!arr || !utils_esm_isObject(arr)) {
    return false;
  }

  if (arr instanceof Element) {
    return false;
  }

  return isArray(arr) || "length" in arr;
}

function getRefTarget(target, isSelector) {
  if (!target) {
    return null;
  }

  if (isString(target)) {
    if (isSelector) {
      return document.querySelector(target);
    }

    return target;
  }

  if (utils_esm_isFunction(target)) {
    return target();
  }

  if ("current" in target) {
    return target.current;
  }

  return target;
}

function getRefTargets(targets, isSelector) {
  if (!targets) {
    return [];
  }

  var userTargets = isArrayFormat(targets) ? [].slice.call(targets) : [targets];
  return userTargets.reduce(function (prev, target) {
    if (isString(target) && isSelector) {
      return __spreadArray(__spreadArray([], prev, true), [].slice.call(document.querySelectorAll(target)), true);
    }

    prev.push(getRefTarget(target, isSelector));
    return prev;
  }, []);
}

function getElementTargets(targets, selectorMap) {
  var elementTargets = [];
  targets.forEach(function (target) {
    if (!target) {
      return;
    }

    if (isString(target)) {
      if (selectorMap[target]) {
        elementTargets.push.apply(elementTargets, selectorMap[target]);
      }

      return;
    }

    elementTargets.push(target);
  });
  return elementTargets;
}

function getAbsoluteRotation(pos1, pos2, direction) {
  var deg = getRad(pos1, pos2) / Math.PI * 180;
  deg = direction >= 0 ? deg : 180 - deg;
  deg = deg >= 0 ? deg : 360 + deg;
  return deg;
}

function getDragDistByState(state, dist) {
  var rootMatrix = state.rootMatrix,
      is3d = state.is3d;
  var n = is3d ? 4 : 3;
  var inverseMatrix = matrix_esm_invert(rootMatrix, n);

  if (!is3d) {
    inverseMatrix = convertDimension(inverseMatrix, 3, 4);
  }

  inverseMatrix[12] = 0;
  inverseMatrix[13] = 0;
  inverseMatrix[14] = 0;
  return calculateMatrixDist(inverseMatrix, dist);
}

function getSizeDistByDist(startSize, dist, ratio, direction, keepRatio) {
  var startOffsetWidth = startSize[0],
      startOffsetHeight = startSize[1];
  var distWidth = 0;
  var distHeight = 0;

  if (keepRatio && startOffsetWidth && startOffsetHeight) {
    var rad = getRad([0, 0], dist);
    var standardRad = getRad([0, 0], direction);
    var size = getDistSize(dist);
    var signSize = Math.cos(rad - standardRad) * size;

    if (!direction[0]) {
      // top, bottom
      distHeight = signSize;
      distWidth = distHeight * ratio;
    } else if (!direction[1]) {
      // left, right
      distWidth = signSize;
      distHeight = distWidth / ratio;
    } else {
      // two-way
      var startWidthSize = direction[0] * 2 * startOffsetWidth;
      var startHeightSize = direction[1] * 2 * startOffsetHeight;
      var distSize = getDistSize([startWidthSize + dist[0], startHeightSize + dist[1]]) - getDistSize([startWidthSize, startHeightSize]);
      var ratioRad = getRad([0, 0], [ratio, 1]);
      distWidth = Math.cos(ratioRad) * distSize;
      distHeight = Math.sin(ratioRad) * distSize;
    }
  } else {
    distWidth = direction[0] * dist[0];
    distHeight = direction[1] * dist[1];
  }

  return [distWidth, distHeight];
}

function getOffsetSizeDist(sizeDirection, keepRatio, datas, e) {
  var _a;

  var ratio = datas.ratio,
      startOffsetWidth = datas.startOffsetWidth,
      startOffsetHeight = datas.startOffsetHeight;
  var distWidth = 0;
  var distHeight = 0;
  var distX = e.distX,
      distY = e.distY,
      parentDistance = e.parentDistance,
      parentDist = e.parentDist,
      parentScale = e.parentScale,
      isPinch = e.isPinch;
  var startFixedDirection = datas.fixedDirection;

  if (parentDist) {
    distWidth = parentDist[0];
    distHeight = parentDist[1];

    if (keepRatio) {
      if (!distWidth) {
        distWidth = distHeight * ratio;
      } else if (!distHeight) {
        distHeight = distWidth / ratio;
      }
    }
  } else if (parentScale) {
    distWidth = (parentScale[0] - 1) * startOffsetWidth;
    distHeight = (parentScale[1] - 1) * startOffsetHeight;
  } else if (isPinch) {
    if (parentDistance) {
      distWidth = parentDistance;
      distHeight = parentDistance * startOffsetHeight / startOffsetWidth;
    }
  } else {
    var dist_1 = getDragDist({
      datas: datas,
      distX: distX,
      distY: distY
    });
    dist_1 = [0, 1].map(function (index) {
      var directionRatio = Math.abs(sizeDirection[index] - startFixedDirection[index]);

      if (directionRatio !== 0) {
        directionRatio = 2 / directionRatio;
      }

      return dist_1[index] * directionRatio;
    });
    _a = getSizeDistByDist([startOffsetWidth, startOffsetHeight], dist_1, ratio, sizeDirection, keepRatio), distWidth = _a[0], distHeight = _a[1];
  }

  return {
    // direction,
    // sizeDirection,
    distWidth: distWidth,
    distHeight: distHeight
  };
}
/**
 * @namespace Moveable.Pinchable
 * @description Whether or not target can be pinched with draggable, resizable, scalable, rotatable (default: false)
 */


var Pinchable = makeAble("pinchable", {
  events: {
    onPinchStart: "pinchStart",
    onPinch: "pinch",
    onPinchEnd: "pinchEnd",
    onPinchGroupStart: "pinchGroupStart",
    onPinchGroup: "pinchGroup",
    onPinchGroupEnd: "pinchGroupEnd"
  },
  dragStart: function () {
    return true;
  },
  pinchStart: function (moveable, e) {
    var datas = e.datas,
        targets = e.targets,
        angle = e.angle,
        originalDatas = e.originalDatas;
    var _a = moveable.props,
        pinchable = _a.pinchable,
        ables = _a.ables;

    if (!pinchable) {
      return false;
    }

    var eventName = "onPinch".concat(targets ? "Group" : "", "Start");
    var controlEventName = "drag".concat(targets ? "Group" : "", "ControlStart");
    var pinchAbles = (pinchable === true ? moveable.controlAbles : ables.filter(function (able) {
      return pinchable.indexOf(able.name) > -1;
    })).filter(function (able) {
      return able.canPinch && able[controlEventName];
    });
    var params = fillParams(moveable, e, {});

    if (targets) {
      params.targets = targets;
    }

    var result = triggerEvent(moveable, eventName, params);
    datas.isPinch = result !== false;
    datas.ables = pinchAbles;
    var isPinch = datas.isPinch;

    if (!isPinch) {
      return false;
    }

    pinchAbles.forEach(function (able) {
      originalDatas[able.name] = originalDatas[able.name] || {};

      if (!able[controlEventName]) {
        return;
      }

      var ableEvent = moveable_esm_assign(moveable_esm_assign({}, e), {
        datas: originalDatas[able.name],
        parentRotate: angle,
        isPinch: true
      });

      able[controlEventName](moveable, ableEvent);
    });
    moveable.state.snapRenderInfo = {
      request: e.isRequest,
      direction: [0, 0]
    };
    return isPinch;
  },
  pinch: function (moveable, e) {
    var datas = e.datas,
        pinchScale = e.scale,
        distance = e.distance,
        originalDatas = e.originalDatas,
        inputEvent = e.inputEvent,
        targets = e.targets,
        angle = e.angle;

    if (!datas.isPinch) {
      return;
    }

    var parentDistance = distance * (1 - 1 / pinchScale);
    var params = fillParams(moveable, e, {});

    if (targets) {
      params.targets = targets;
    }

    var eventName = "onPinch".concat(targets ? "Group" : "");
    triggerEvent(moveable, eventName, params);
    var ables = datas.ables;
    var controlEventName = "drag".concat(targets ? "Group" : "", "Control");
    ables.forEach(function (able) {
      if (!able[controlEventName]) {
        return;
      }

      able[controlEventName](moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
        datas: originalDatas[able.name],
        inputEvent: inputEvent,
        parentDistance: parentDistance,
        parentRotate: angle,
        isPinch: true
      }));
    });
    return params;
  },
  pinchEnd: function (moveable, e) {
    var datas = e.datas,
        isPinch = e.isPinch,
        inputEvent = e.inputEvent,
        targets = e.targets,
        originalDatas = e.originalDatas;

    if (!datas.isPinch) {
      return;
    }

    var eventName = "onPinch".concat(targets ? "Group" : "", "End");
    var params = fillEndParams(moveable, e, {
      isDrag: isPinch
    });

    if (targets) {
      params.targets = targets;
    }

    triggerEvent(moveable, eventName, params);
    var ables = datas.ables;
    var controlEventName = "drag".concat(targets ? "Group" : "", "ControlEnd");
    ables.forEach(function (able) {
      if (!able[controlEventName]) {
        return;
      }

      able[controlEventName](moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
        isDrag: isPinch,
        datas: originalDatas[able.name],
        inputEvent: inputEvent,
        isPinch: true
      }));
    });
    return isPinch;
  },
  pinchGroupStart: function (moveable, e) {
    return this.pinchStart(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  },
  pinchGroup: function (moveable, e) {
    return this.pinch(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  },
  pinchGroupEnd: function (moveable, e) {
    return this.pinchEnd(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  }
});
/**
 * Whether or not target can be pinched with draggable, resizable, scalable, rotatable (default: false)
 * @name Moveable.Pinchable#pinchable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.pinchable = true;
 */

/**
 * When the pinch starts, the pinchStart event is called with part of scaleStart, rotateStart, resizeStart
 * @memberof Moveable.Pinchable
 * @event pinchStart
 * @param {Moveable.Pinchable.OnPinchStart} - Parameters for the pinchStart event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     rotatable: true,
 *     scalable: true,
 *     pinchable: true, // ["rotatable", "scalable"]
 * });
 * moveable.on("pinchStart", ({ target }) => {
 *     console.log(target);
 * });
 * moveable.on("rotateStart", ({ target }) => {
 *     console.log(target);
 * });
 * moveable.on("scaleStart", ({ target }) => {
 *     console.log(target);
 * });
 */

/**
 * When pinching, the pinch event is called with part of scale, rotate, resize
 * @memberof Moveable.Pinchable
 * @event pinch
 * @param {Moveable.Pinchable.OnPinch} - Parameters for the pinch event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     rotatable: true,
 *     scalable: true,
 *     pinchable: true, // ["rotatable", "scalable"]
 * });
 * moveable.on("pinch", ({ target }) => {
 *     console.log(target);
 * });
 * moveable.on("rotate", ({ target }) => {
 *     console.log(target);
 * });
 * moveable.on("scale", ({ target }) => {
 *     console.log(target);
 * });
 */

/**
 * When the pinch finishes, the pinchEnd event is called.
 * @memberof Moveable.Pinchable
 * @event pinchEnd
 * @param {Moveable.Pinchable.OnPinchEnd} - Parameters for the pinchEnd event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     rotatable: true,
 *     scalable: true,
 *     pinchable: true, // ["rotatable", "scalable"]
 * });
 * moveable.on("pinchEnd", ({ target }) => {
 *     console.log(target);
 * });
 * moveable.on("rotateEnd", ({ target }) => {
 *     console.log(target);
 * });
 * moveable.on("scaleEnd", ({ target }) => {
 *     console.log(target);
 * });
 */

/**
 * When the group pinch starts, the `pinchGroupStart` event is called.
 * @memberof Moveable.Pinchable
 * @event pinchGroupStart
 * @param {Moveable.Pinchable.OnPinchGroupStart} - Parameters for the `pinchGroupStart` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     pinchable: true
 * });
 * moveable.on("pinchGroupStart", ({ targets }) => {
 *     console.log("onPinchGroupStart", targets);
 * });
 */

/**
 * When the group pinch, the `pinchGroup` event is called.
 * @memberof Moveable.Pinchable
 * @event pinchGroup
 * @param {Moveable.Pinchable.OnPinchGroup} - Parameters for the `pinchGroup` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     pinchable: true
 * });
 * moveable.on("pinchGroup", ({ targets, events }) => {
 *     console.log("onPinchGroup", targets);
 * });
 */

/**
 * When the group pinch finishes, the `pinchGroupEnd` event is called.
 * @memberof Moveable.Pinchable
 * @event pinchGroupEnd
 * @param {Moveable.Pinchable.OnPinchGroupEnd} - Parameters for the `pinchGroupEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     pinchable: true
 * });
 * moveable.on("pinchGroupEnd", ({ targets, isDrag }) => {
 *     console.log("onPinchGroupEnd", targets, isDrag);
 * });
 */

/**
 * @namespace Resizable
 * @memberof Moveable
 * @description Resizable indicates whether the target's width and height can be increased or decreased.
 */

var Resizable = {
  name: "resizable",
  ableGroup: "size",
  canPinch: true,
  props: {
    resizable: Boolean,
    throttleResize: Number,
    renderDirections: Array,
    keepRatio: Boolean,
    resizeFormat: Function
  },
  events: {
    onResizeStart: "resizeStart",
    onBeforeResize: "beforeResize",
    onResize: "resize",
    onResizeEnd: "resizeEnd",
    onResizeGroupStart: "resizeGroupStart",
    onBeforeResizeGroup: "beforeResizeGroup",
    onResizeGroup: "resizeGroup",
    onResizeGroupEnd: "resizeGroupEnd"
  },
  render: function (moveable, React) {
    var _a = moveable.props,
        resizable = _a.resizable,
        edge = _a.edge;

    if (resizable) {
      if (edge) {
        return renderDiagonalDirections(moveable, React);
      }

      return renderAllDirections(moveable, React);
    }
  },
  dragControlCondition: directionCondition,
  dragControlStart: function (moveable, e) {
    var _a;

    var inputEvent = e.inputEvent,
        isPinch = e.isPinch,
        isGroup = e.isGroup,
        parentDirection = e.parentDirection,
        datas = e.datas;
    var direction = parentDirection || (isPinch ? [0, 0] : getDirection(inputEvent.target));
    var _b = moveable.state,
        target = _b.target,
        width = _b.width,
        height = _b.height;

    if (!direction || !target) {
      return false;
    }

    !isPinch && setDragStart(moveable, e);
    datas.datas = {};
    datas.direction = direction;
    datas.startOffsetWidth = width;
    datas.startOffsetHeight = height;
    datas.prevWidth = 0;
    datas.prevHeight = 0;
    _a = getCSSSize(target), datas.startWidth = _a[0], datas.startHeight = _a[1];
    var padding = [Math.max(0, width - datas.startWidth), Math.max(0, height - datas.startHeight)];
    datas.minSize = padding;
    datas.maxSize = [Infinity, Infinity];

    if (!isGroup) {
      var style = moveable_esm_getComputedStyle(target);
      var position = style.position,
          minWidth = style.minWidth,
          minHeight = style.minHeight,
          maxWidth = style.maxWidth,
          maxHeight = style.maxHeight;
      var isParentElement = position === "static" || position === "relative";
      var container = isParentElement ? target.parentElement : target.offsetParent;
      var containerWidth = width;
      var containerHeight = height;

      if (container) {
        containerWidth = container.clientWidth;
        containerHeight = container.clientHeight;

        if (isParentElement) {
          var containerStyle = moveable_esm_getComputedStyle(container);
          containerWidth -= parseFloat(containerStyle.paddingLeft) || 0;
          containerHeight -= parseFloat(containerStyle.paddingTop) || 0;
        }
      }

      datas.minSize = plus([convertUnitSize(minWidth, containerWidth) || 0, convertUnitSize(minHeight, containerHeight) || 0], padding);
      datas.maxSize = plus([convertUnitSize(maxWidth, containerWidth) || Infinity, convertUnitSize(maxHeight, containerHeight) || Infinity], padding);
    }

    var transformOrigin = moveable.props.transformOrigin || "% %";
    datas.transformOrigin = transformOrigin && isString(transformOrigin) ? transformOrigin.split(" ") : transformOrigin;
    datas.isWidth = !direction[0] && !direction[1] || direction[0] || !direction[1];

    function setRatio(ratio) {
      datas.ratio = ratio && isFinite(ratio) ? ratio : 0;
    }

    datas.startPositions = getAbsolutePosesByState(moveable.state);

    function setFixedDirection(fixedDirection) {
      datas.fixedDirection = fixedDirection;
      datas.fixedPosition = getPosByDirection(datas.startPositions, fixedDirection);
    }

    function setMin(minSize) {
      datas.minSize = [convertUnitSize("".concat(minSize[0]), 0) || 0, convertUnitSize("".concat(minSize[1]), 0) || 0];
    }

    function setMax(maxSize) {
      var nextMaxSize = [maxSize[0] || Infinity, maxSize[1] || Infinity];

      if (!isNumber(nextMaxSize[0]) || isFinite(nextMaxSize[0])) {
        nextMaxSize[0] = convertUnitSize("".concat(nextMaxSize[0]), 0) || Infinity;
      }

      if (!isNumber(nextMaxSize[1]) || isFinite(nextMaxSize[1])) {
        nextMaxSize[1] = convertUnitSize("".concat(nextMaxSize[1]), 0) || Infinity;
      }

      datas.maxSize = nextMaxSize;
    }

    setRatio(width / height);
    setFixedDirection([-direction[0], -direction[1]]);
    datas.setFixedDirection = setFixedDirection;
    datas.setMin = setMin;
    datas.setMax = setMax;
    var params = fillParams(moveable, e, {
      direction: direction,
      set: function (_a) {
        var startWidth = _a[0],
            startHeight = _a[1];
        datas.startWidth = startWidth;
        datas.startHeight = startHeight;
      },
      setMin: setMin,
      setMax: setMax,
      setRatio: setRatio,
      setFixedDirection: setFixedDirection,
      setOrigin: function (origin) {
        datas.transformOrigin = origin;
      },
      dragStart: moveable_esm_Draggable.dragStart(moveable, new CustomGesto().dragStart([0, 0], e))
    });
    var result = triggerEvent(moveable, "onResizeStart", params);

    if (result !== false) {
      datas.isResize = true;
      moveable.state.snapRenderInfo = {
        request: e.isRequest,
        direction: direction
      };
    }

    return datas.isResize ? params : false;
  },
  dragControl: function (moveable, e) {
    var _a;

    var datas = e.datas,
        parentFlag = e.parentFlag,
        isPinch = e.isPinch,
        parentKeepRatio = e.parentKeepRatio,
        dragClient = e.dragClient,
        parentDist = e.parentDist,
        isRequest = e.isRequest;
    var isResize = datas.isResize,
        transformOrigin = datas.transformOrigin,
        startWidth = datas.startWidth,
        startHeight = datas.startHeight,
        prevWidth = datas.prevWidth,
        prevHeight = datas.prevHeight,
        minSize = datas.minSize,
        maxSize = datas.maxSize,
        ratio = datas.ratio,
        isWidth = datas.isWidth,
        startOffsetWidth = datas.startOffsetWidth,
        startOffsetHeight = datas.startOffsetHeight;

    if (!isResize) {
      return;
    }

    var props = moveable.props;
    var resizeFormat = props.resizeFormat,
        _b = props.throttleResize,
        throttleResize = _b === void 0 ? 1 : _b,
        parentMoveable = props.parentMoveable;
    var direction = datas.direction;
    var sizeDirection = direction;
    var distWidth = 0;
    var distHeight = 0;

    if (!direction[0] && !direction[1]) {
      sizeDirection = [1, 1];
    }

    var keepRatio = ratio && (parentKeepRatio != null ? parentKeepRatio : props.keepRatio) || false;

    function getNextBoundingSize() {
      var nextSize = getOffsetSizeDist(sizeDirection, keepRatio, datas, e);
      distWidth = nextSize.distWidth;
      distHeight = nextSize.distHeight;
      var nextWidth = sizeDirection[0] || keepRatio ? Math.max(startOffsetWidth + distWidth, moveable_esm_TINY_NUM) : startOffsetWidth;
      var nextHeight = sizeDirection[1] || keepRatio ? Math.max(startOffsetHeight + distHeight, moveable_esm_TINY_NUM) : startOffsetHeight;

      if (keepRatio && startOffsetWidth && startOffsetHeight) {
        // startOffsetWidth : startOffsetHeight = nextWidth : nextHeight
        if (isWidth) {
          nextHeight = nextWidth / ratio;
        } else {
          nextWidth = nextHeight * ratio;
        }
      }

      return [nextWidth, nextHeight];
    }

    var _c = getNextBoundingSize(),
        boundingWidth = _c[0],
        boundingHeight = _c[1];

    datas.setFixedDirection(datas.fixedDirection);
    triggerEvent(moveable, "onBeforeResize", fillParams(moveable, e, {
      setFixedDirection: function (nextFixedDirection) {
        var _a;

        datas.setFixedDirection(nextFixedDirection);
        _a = getNextBoundingSize(), boundingWidth = _a[0], boundingHeight = _a[1];
        return [boundingWidth, boundingHeight];
      },
      boundingWidth: boundingWidth,
      boundingHeight: boundingHeight,
      setSize: function (size) {
        boundingWidth = size[0], boundingHeight = size[1];
      }
    }, true));
    var fixedPosition = dragClient;

    if (!dragClient) {
      if (!parentFlag && isPinch) {
        fixedPosition = getAbsolutePosition(moveable, [0, 0]);
      } else {
        fixedPosition = datas.fixedPosition;
      }
    }

    var snapDist = [0, 0];

    if (!isPinch) {
      snapDist = checkSnapResize(moveable, boundingWidth, boundingHeight, direction, fixedPosition, isRequest, datas);
    }

    if (parentDist) {
      !parentDist[0] && (snapDist[0] = 0);
      !parentDist[1] && (snapDist[1] = 0);
    }

    function computeSize() {
      var _a;

      if (resizeFormat) {
        _a = resizeFormat([boundingWidth, boundingHeight]), boundingWidth = _a[0], boundingHeight = _a[1];
      }

      boundingWidth = utils_esm_throttle(boundingWidth, throttleResize);
      boundingHeight = utils_esm_throttle(boundingHeight, throttleResize);
    }

    if (keepRatio) {
      if (sizeDirection[0] && sizeDirection[1] && snapDist[0] && snapDist[1]) {
        if (Math.abs(snapDist[0]) > Math.abs(snapDist[1])) {
          snapDist[1] = 0;
        } else {
          snapDist[0] = 0;
        }
      }

      var isNoSnap = !snapDist[0] && !snapDist[1];

      if (isNoSnap) {
        // pre-compute before maintaining the ratio
        computeSize();
      }

      if (sizeDirection[0] && !sizeDirection[1] || snapDist[0] && !snapDist[1] || isNoSnap && isWidth) {
        boundingWidth += snapDist[0];
        boundingHeight = boundingWidth / ratio;
      } else if (!sizeDirection[0] && sizeDirection[1] || !snapDist[0] && snapDist[1] || isNoSnap && !isWidth) {
        boundingHeight += snapDist[1];
        boundingWidth = boundingHeight * ratio;
      }
    } else {
      boundingWidth += snapDist[0];
      boundingHeight += snapDist[1];
      boundingWidth = Math.max(0, boundingWidth);
      boundingHeight = Math.max(0, boundingHeight);
    }

    _a = calculateBoundSize([boundingWidth, boundingHeight], minSize, maxSize, keepRatio ? ratio : false), boundingWidth = _a[0], boundingHeight = _a[1];
    computeSize();
    distWidth = boundingWidth - startOffsetWidth;
    distHeight = boundingHeight - startOffsetHeight;
    var delta = [distWidth - prevWidth, distHeight - prevHeight];
    datas.prevWidth = distWidth;
    datas.prevHeight = distHeight;
    var inverseDelta = getResizeDist(moveable, boundingWidth, boundingHeight, datas.fixedDirection, fixedPosition, transformOrigin);

    if (!parentMoveable && delta.every(function (num) {
      return !num;
    }) && inverseDelta.every(function (num) {
      return !num;
    })) {
      return;
    }

    var params = fillParams(moveable, e, {
      width: startWidth + distWidth,
      height: startHeight + distHeight,
      offsetWidth: Math.round(boundingWidth),
      offsetHeight: Math.round(boundingHeight),
      boundingWidth: boundingWidth,
      boundingHeight: boundingHeight,
      direction: direction,
      dist: [distWidth, distHeight],
      delta: delta,
      isPinch: !!isPinch,
      drag: moveable_esm_Draggable.drag(moveable, setCustomDrag(e, moveable.state, inverseDelta, !!isPinch, false))
    });
    triggerEvent(moveable, "onResize", params);
    return params;
  },
  dragControlAfter: function (moveable, e) {
    var datas = e.datas;
    var isResize = datas.isResize,
        startOffsetWidth = datas.startOffsetWidth,
        startOffsetHeight = datas.startOffsetHeight,
        prevWidth = datas.prevWidth,
        prevHeight = datas.prevHeight;

    if (!isResize) {
      return;
    }

    var _a = moveable.state,
        width = _a.width,
        height = _a.height;
    var errorWidth = width - (startOffsetWidth + prevWidth);
    var errorHeight = height - (startOffsetHeight + prevHeight);
    var isErrorWidth = Math.abs(errorWidth) > 3;
    var isErrorHeight = Math.abs(errorHeight) > 3;

    if (isErrorWidth) {
      datas.startWidth += errorWidth;
      datas.startOffsetWidth += errorWidth;
      datas.prevWidth += errorWidth;
    }

    if (isErrorHeight) {
      datas.startHeight += errorHeight;
      datas.startOffsetHeight += errorHeight;
      datas.prevHeight += errorHeight;
    }

    if (isErrorWidth || isErrorHeight) {
      return this.dragControl(moveable, e);
    }
  },
  dragControlEnd: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isResize) {
      return;
    }

    datas.isResize = false;
    var params = fillEndParams(moveable, e, {});
    triggerEvent(moveable, "onResizeEnd", params);
    return params;
  },
  dragGroupControlCondition: directionCondition,
  dragGroupControlStart: function (moveable, e) {
    var datas = e.datas;
    var params = this.dragControlStart(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      isGroup: true
    }));

    if (!params) {
      return false;
    }

    var originalEvents = fillChildEvents(moveable, "resizable", e);

    function setDist(child, ev) {
      var fixedDirection = datas.fixedDirection;
      var fixedPosition = datas.fixedPosition;
      var startPositions = ev.datas.startPositions || getAbsolutePosesByState(child.state);
      var pos = getPosByDirection(startPositions, fixedDirection);

      var _a = calculate(createRotateMatrix(-moveable.rotation / 180 * Math.PI, 3), [pos[0] - fixedPosition[0], pos[1] - fixedPosition[1], 1], 3),
          originalX = _a[0],
          originalY = _a[1];

      ev.datas.originalX = originalX;
      ev.datas.originalY = originalY;
      return ev;
    }

    var parentStartOffsetWidth = datas.startOffsetWidth,
        parentStartOffsetHeight = datas.startOffsetHeight;

    function updateGroupMin() {
      var originalMinSize = datas.minSize;
      originalEvents.forEach(function (ev) {
        var _a = ev.datas,
            childMinSize = _a.minSize,
            childStartOffsetWidth = _a.startOffsetWidth,
            childStartOffsetHeight = _a.startOffsetHeight;
        var parentMinWidth = parentStartOffsetWidth * (childStartOffsetWidth ? childMinSize[0] / childStartOffsetWidth : 0);
        var parentMinHeight = parentStartOffsetHeight * (childStartOffsetHeight ? childMinSize[1] / childStartOffsetHeight : 0);
        originalMinSize[0] = Math.max(originalMinSize[0], parentMinWidth);
        originalMinSize[1] = Math.max(originalMinSize[1], parentMinHeight);
      });
    }

    function updateGroupMax() {
      var originalMaxSize = datas.maxSize;
      originalEvents.forEach(function (ev) {
        var _a = ev.datas,
            childMaxSize = _a.maxSize,
            childStartOffsetWidth = _a.startOffsetWidth,
            childStartOffsetHeight = _a.startOffsetHeight;
        var parentMaxWidth = parentStartOffsetWidth * (childStartOffsetWidth ? childMaxSize[0] / childStartOffsetWidth : 0);
        var parentMaxHeight = parentStartOffsetHeight * (childStartOffsetHeight ? childMaxSize[1] / childStartOffsetHeight : 0);
        originalMaxSize[0] = Math.min(originalMaxSize[0], parentMaxWidth);
        originalMaxSize[1] = Math.min(originalMaxSize[1], parentMaxHeight);
      });
    }

    var events = triggerChildAbles(moveable, this, "dragControlStart", e, function (child, ev) {
      return setDist(child, ev);
    });
    updateGroupMin();
    updateGroupMax();

    var setFixedDirection = function (fixedDirection) {
      params.setFixedDirection(fixedDirection);
      events.forEach(function (ev, i) {
        ev.setFixedDirection(fixedDirection);
        setDist(ev.moveable, originalEvents[i]);
      });
    };

    datas.setFixedDirection = setFixedDirection;

    var nextParams = moveable_esm_assign(moveable_esm_assign({}, params), {
      targets: moveable.props.targets,
      events: events.map(function (ev) {
        return moveable_esm_assign(moveable_esm_assign({}, ev), {
          setMin: function (minSize) {
            ev.setMin(minSize);
            updateGroupMin();
          },
          setMax: function (maxSize) {
            ev.setMax(maxSize);
            updateGroupMax();
          }
        });
      }),
      setFixedDirection: setFixedDirection,
      setMin: function (minSize) {
        params.setMin(minSize);
        updateGroupMin();
      },
      setMax: function (maxSize) {
        params.setMax(maxSize);
        updateGroupMax();
      }
    });

    var result = triggerEvent(moveable, "onResizeGroupStart", nextParams);
    datas.isResize = result !== false;
    return datas.isResize ? params : false;
  },
  dragGroupControl: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isResize) {
      return;
    }

    catchEvent(moveable, "onBeforeResize", function (parentEvent) {
      triggerEvent(moveable, "onBeforeResizeGroup", fillParams(moveable, e, moveable_esm_assign(moveable_esm_assign({}, parentEvent), {
        targets: moveable.props.targets
      }), true));
    });
    var params = this.dragControl(moveable, e);

    if (!params) {
      return;
    }

    var boundingWidth = params.boundingWidth,
        boundingHeight = params.boundingHeight,
        dist = params.dist;
    var keepRatio = moveable.props.keepRatio;
    var parentScale = [boundingWidth / (boundingWidth - dist[0]), boundingHeight / (boundingHeight - dist[1])];
    var fixedPosition = datas.fixedPosition;
    var events = triggerChildAbles(moveable, this, "dragControl", e, function (_, ev) {
      var _a = calculate(createRotateMatrix(moveable.rotation / 180 * Math.PI, 3), [ev.datas.originalX * parentScale[0], ev.datas.originalY * parentScale[1], 1], 3),
          clientX = _a[0],
          clientY = _a[1];

      return moveable_esm_assign(moveable_esm_assign({}, ev), {
        parentDist: null,
        parentScale: parentScale,
        dragClient: plus(fixedPosition, [clientX, clientY]),
        parentKeepRatio: keepRatio
      });
    });

    var nextParams = moveable_esm_assign({
      targets: moveable.props.targets,
      events: events
    }, params);

    triggerEvent(moveable, "onResizeGroup", nextParams);
    return nextParams;
  },
  dragGroupControlEnd: function (moveable, e) {
    var isDrag = e.isDrag,
        datas = e.datas;

    if (!datas.isResize) {
      return;
    }

    this.dragControlEnd(moveable, e);
    var events = triggerChildAbles(moveable, this, "dragControlEnd", e);
    var nextParams = fillEndParams(moveable, e, {
      targets: moveable.props.targets,
      events: events
    });
    triggerEvent(moveable, "onResizeGroupEnd", nextParams);
    return isDrag;
  },

  /**
   * @method Moveable.Resizable#request
   * @param {Moveable.Resizable.ResizableRequestParam} e - the Resizable's request parameter
   * @return {Moveable.Requester} Moveable Requester
   * @example
    * // Instantly Request (requestStart - request - requestEnd)
   * // Use Relative Value
   * moveable.request("resizable", { deltaWidth: 10, deltaHeight: 10 }, true);
   *
   * // Use Absolute Value
   * moveable.request("resizable", { offsetWidth: 100, offsetHeight: 100 }, true);
   *
   * // requestStart
   * const requester = moveable.request("resizable");
   *
   * // request
   * // Use Relative Value
   * requester.request({ deltaWidth: 10, deltaHeight: 10 });
   * requester.request({ deltaWidth: 10, deltaHeight: 10 });
   * requester.request({ deltaWidth: 10, deltaHeight: 10 });
   *
   * // Use Absolute Value
   * moveable.request("resizable", { offsetWidth: 100, offsetHeight: 100 });
   * moveable.request("resizable", { offsetWidth: 110, offsetHeight: 100 });
   * moveable.request("resizable", { offsetWidth: 120, offsetHeight: 100 });
   *
   * // requestEnd
   * requester.requestEnd();
   */
  request: function (moveable) {
    var datas = {};
    var distWidth = 0;
    var distHeight = 0;
    var rect = moveable.getRect();
    return {
      isControl: true,
      requestStart: function (e) {
        return {
          datas: datas,
          parentDirection: e.direction || [1, 1]
        };
      },
      request: function (e) {
        if ("offsetWidth" in e) {
          distWidth = e.offsetWidth - rect.offsetWidth;
        } else if ("deltaWidth" in e) {
          distWidth += e.deltaWidth;
        }

        if ("offsetHeight" in e) {
          distHeight = e.offsetHeight - rect.offsetHeight;
        } else if ("deltaHeight" in e) {
          distHeight += e.deltaHeight;
        }

        return {
          datas: datas,
          parentDist: [distWidth, distHeight],
          parentKeepRatio: e.keepRatio
        };
      },
      requestEnd: function () {
        return {
          datas: datas,
          isDrag: true
        };
      }
    };
  }
};
/**
 * Whether or not target can be resized.
 * @name Moveable.Resizable#resizable
 * @default false
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     resizable: false,
 * });
 *
 * moveable.resizable = true;
 */

/**
 * throttle of width, height when resize. If throttleResize is set to less than 1, the target may shake.
 * @name Moveable.Resizable#throttleResize
 * @default 1
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   resizable: true,
 *   throttleResize: 1,
 * });
 *
 * moveable.throttleResize = 0;
 */

/**
 * When resize or scale, keeps a ratio of the width, height.
 * @name Moveable.Resizable#keepRatio
 * @default false
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   resizable: true,
 * });
 *
 * moveable.keepRatio = true;
 */

/**
 * Set directions to show the control box.
 * @name Moveable.Resizable#renderDirections
 * @default ["n", "nw", "ne", "s", "se", "sw", "e", "w"]
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   resizable: true,
 *   renderDirections: ["n", "nw", "ne", "s", "se", "sw", "e", "w"],
 * });
 *
 * moveable.renderDirections = ["nw", "ne", "sw", "se"];
 */

/**
 * Function to convert size for resize
 * @name Moveable.Resizable#resizeFormat
 * @default oneself
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   resizable: true,
 *   resizeFormat: v => v,
 * });
 *
 * moveable.resizeFormat = (size: number[]) => ([Math.trunc(size[0]), Math.trunc(size[1])];
 */

/**
 * When the resize starts, the resizeStart event is called.
 * @memberof Moveable.Resizable
 * @event resizeStart
 * @param {Moveable.Resizable.OnResizeStart} - Parameters for the resizeStart event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { resizable: true });
 * moveable.on("resizeStart", ({ target }) => {
 *     console.log(target);
 * });
 */

/**
 * When resizing, `beforeResize` is called before `resize` occurs. In `beforeResize`, you can get and set the pre-value before resizing.
 * @memberof Moveable.Resizable
 * @event beforeResize
 * @param {Moveable.Resizable.OnBeforeResize} - Parameters for the `beforeResize` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { resizable: true });
 * moveable.on("beforeResize", ({ setFixedDirection }) => {
 *     if (shiftKey) {
 *        setFixedDirection([0, 0]);
 *     }
 * });
 * moveable.on("resize", ({ target, width, height, drag }) => {
 *     target.style.width = `${width}px`;
 *     target.style.height = `${height}px`;
 *     target.style.transform = drag.transform;
 * });
 */

/**
 * When resizing, the resize event is called.
 * @memberof Moveable.Resizable
 * @event resize
 * @param {Moveable.Resizable.OnResize} - Parameters for the resize event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { resizable: true });
 * moveable.on("resize", ({ target, width, height }) => {
 *     target.style.width = `${e.width}px`;
 *     target.style.height = `${e.height}px`;
 * });
 */

/**
 * When the resize finishes, the resizeEnd event is called.
 * @memberof Moveable.Resizable
 * @event resizeEnd
 * @param {Moveable.Resizable.OnResizeEnd} - Parameters for the resizeEnd event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { resizable: true });
 * moveable.on("resizeEnd", ({ target, isDrag }) => {
 *     console.log(target, isDrag);
 * });
 */

/**
* When the group resize starts, the `resizeGroupStart` event is called.
* @memberof Moveable.Resizable
* @event resizeGroupStart
* @param {Moveable.Resizable.OnResizeGroupStart} - Parameters for the `resizeGroupStart` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     target: [].slice.call(document.querySelectorAll(".target")),
*     resizable: true
* });
* moveable.on("resizeGroupStart", ({ targets }) => {
*     console.log("onResizeGroupStart", targets);
* });
*/

/**
* When the group resize, the `resizeGroup` event is called.
* @memberof Moveable.Resizable
* @event resizeGroup
* @param {Moveable.Resizable.onResizeGroup} - Parameters for the `resizeGroup` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     target: [].slice.call(document.querySelectorAll(".target")),
*     resizable: true
* });
* moveable.on("resizeGroup", ({ targets, events }) => {
*     console.log("onResizeGroup", targets);
*     events.forEach(ev => {
*         const offset = [
*             direction[0] < 0 ? -ev.delta[0] : 0,
*             direction[1] < 0 ? -ev.delta[1] : 0,
*         ];
*         // ev.drag is a drag event that occurs when the group resize.
*         const left = offset[0] + ev.drag.beforeDist[0];
*         const top = offset[1] + ev.drag.beforeDist[1];
*         const width = ev.width;
*         const top = ev.top;
*     });
* });
*/

/**
 * When the group resize finishes, the `resizeGroupEnd` event is called.
 * @memberof Moveable.Resizable
 * @event resizeGroupEnd
 * @param {Moveable.Resizable.OnResizeGroupEnd} - Parameters for the `resizeGroupEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     resizable: true
 * });
 * moveable.on("resizeGroupEnd", ({ targets, isDrag }) => {
 *     console.log("onResizeGroupEnd", targets, isDrag);
 * });
 */

/**
 * @namespace Scalable
 * @memberof Moveable
 * @description Scalable indicates whether the target's x and y can be scale of transform.
 */

var Scalable = {
  name: "scalable",
  ableGroup: "size",
  canPinch: true,
  props: {
    scalable: Boolean,
    throttleScale: Number,
    renderDirections: String,
    keepRatio: Boolean
  },
  events: {
    onScaleStart: "scaleStart",
    onBeforeScale: "beforeScale",
    onScale: "scale",
    onScaleEnd: "scaleEnd",
    onScaleGroupStart: "scaleGroupStart",
    onBeforeScaleGroup: "beforeScaleGroup",
    onScaleGroup: "scaleGroup",
    onScaleGroupEnd: "scaleGroupEnd"
  },
  render: function (moveable, React) {
    var _a = moveable.props,
        resizable = _a.resizable,
        scalable = _a.scalable,
        edge = _a.edge;

    if (!resizable && scalable) {
      if (edge) {
        return renderDiagonalDirections(moveable, React);
      }

      return renderAllDirections(moveable, React);
    }
  },
  dragControlCondition: directionCondition,
  dragControlStart: function (moveable, e) {
    var datas = e.datas,
        isPinch = e.isPinch,
        inputEvent = e.inputEvent,
        parentDirection = e.parentDirection;
    var direction = parentDirection || (isPinch ? [0, 0] : getDirection(inputEvent.target));
    var _a = moveable.state,
        width = _a.width,
        height = _a.height,
        targetTransform = _a.targetTransform,
        target = _a.target,
        pos1 = _a.pos1,
        pos2 = _a.pos2,
        pos4 = _a.pos4;

    if (!direction || !target) {
      return false;
    }

    if (!isPinch) {
      setDragStart(moveable, e);
    }

    datas.datas = {};
    datas.transform = targetTransform;
    datas.prevDist = [1, 1];
    datas.direction = direction;
    datas.startOffsetWidth = width;
    datas.startOffsetHeight = height;
    datas.startValue = [1, 1];
    var scaleWidth = utils_esm_getDist(pos1, pos2);
    var scaleHeight = utils_esm_getDist(pos2, pos4);
    var isWidth = !direction[0] && !direction[1] || direction[0] || !direction[1];
    datas.scaleWidth = scaleWidth;
    datas.scaleHeight = scaleHeight;
    datas.scaleXRatio = scaleWidth / width;
    datas.scaleYRatio = scaleHeight / height;
    setDefaultTransformIndex(e, "scale");
    datas.isWidth = isWidth;

    function setRatio(ratio) {
      datas.ratio = ratio && isFinite(ratio) ? ratio : 0;
    }

    datas.startPositions = getAbsolutePosesByState(moveable.state);

    function setFixedDirection(fixedDirection) {
      datas.fixedDirection = fixedDirection;
      datas.fixedPosition = getPosByDirection(datas.startPositions, fixedDirection);
    }

    datas.setFixedDirection = setFixedDirection;
    setRatio(utils_esm_getDist(pos1, pos2) / utils_esm_getDist(pos2, pos4));
    setFixedDirection([-direction[0], -direction[1]]);
    var params = fillParams(moveable, e, moveable_esm_assign(moveable_esm_assign({
      direction: direction,
      set: function (scale) {
        datas.startValue = scale;
      },
      setRatio: setRatio,
      setFixedDirection: setFixedDirection
    }, fillTransformStartEvent(e)), {
      dragStart: moveable_esm_Draggable.dragStart(moveable, new CustomGesto().dragStart([0, 0], e))
    }));
    var result = triggerEvent(moveable, "onScaleStart", params);

    if (result !== false) {
      datas.isScale = true;
      moveable.state.snapRenderInfo = {
        request: e.isRequest,
        direction: direction
      };
    }

    return datas.isScale ? params : false;
  },
  dragControl: function (moveable, e) {
    resolveTransformEvent(e, "scale");
    var datas = e.datas,
        parentKeepRatio = e.parentKeepRatio,
        parentFlag = e.parentFlag,
        isPinch = e.isPinch,
        dragClient = e.dragClient,
        isRequest = e.isRequest;
    var prevDist = datas.prevDist,
        direction = datas.direction,
        startOffsetWidth = datas.startOffsetWidth,
        startOffsetHeight = datas.startOffsetHeight,
        isScale = datas.isScale,
        startValue = datas.startValue,
        isWidth = datas.isWidth,
        ratio = datas.ratio;

    if (!isScale) {
      return false;
    }

    var props = moveable.props;
    var throttleScale = props.throttleScale,
        parentMoveable = props.parentMoveable;
    var sizeDirection = direction;

    if (!direction[0] && !direction[1]) {
      sizeDirection = [1, 1];
    }

    var keepRatio = ratio && (parentKeepRatio != null ? parentKeepRatio : props.keepRatio) || false;
    var state = moveable.state;

    function getNextScale() {
      var _a = getOffsetSizeDist(sizeDirection, keepRatio, datas, e),
          distWidth = _a.distWidth,
          distHeight = _a.distHeight;

      var scaleX = (startOffsetWidth + distWidth) / startOffsetWidth;
      var scaleY = (startOffsetHeight + distHeight) / startOffsetHeight;
      scaleX = sizeDirection[0] || keepRatio ? scaleX * startValue[0] : startValue[0];
      scaleY = sizeDirection[1] || keepRatio ? scaleY * startValue[1] : startValue[1];

      if (scaleX === 0) {
        scaleX = (prevDist[0] > 0 ? 1 : -1) * MIN_SCALE;
      }

      if (scaleY === 0) {
        scaleY = (prevDist[1] > 0 ? 1 : -1) * MIN_SCALE;
      }

      return [scaleX, scaleY];
    }

    var scale = getNextScale();

    if (!isPinch && moveable.props.groupable) {
      var snapRenderInfo = state.snapRenderInfo || {};
      var stateDirection = snapRenderInfo.direction;

      if (isArray(stateDirection) && (stateDirection[0] || stateDirection[1])) {
        state.snapRenderInfo = {
          direction: direction,
          request: e.isRequest
        };
      }
    }

    triggerEvent(moveable, "onBeforeScale", fillParams(moveable, e, {
      scale: scale,
      setFixedDirection: function (nextFixedDirection) {
        datas.setFixedDirection(nextFixedDirection);
        scale = getNextScale();
        return scale;
      },
      setScale: function (nextScale) {
        scale = nextScale;
      }
    }, true));
    var dist = [scale[0] / startValue[0], scale[1] / startValue[1]];
    var fixedPosition = dragClient;
    var snapDist = [0, 0];

    if (!dragClient) {
      if (!parentFlag && isPinch) {
        fixedPosition = getAbsolutePosition(moveable, [0, 0]);
      } else {
        fixedPosition = datas.fixedPosition;
      }
    }

    if (!isPinch) {
      snapDist = checkSnapScale(moveable, dist, direction, isRequest, datas);
    }

    if (keepRatio) {
      if (sizeDirection[0] && sizeDirection[1] && snapDist[0] && snapDist[1]) {
        if (Math.abs(snapDist[0] * startOffsetWidth) > Math.abs(snapDist[1] * startOffsetHeight)) {
          snapDist[1] = 0;
        } else {
          snapDist[0] = 0;
        }
      }

      var isNoSnap = !snapDist[0] && !snapDist[1];

      if (isNoSnap) {
        if (isWidth) {
          dist[0] = utils_esm_throttle(dist[0] * startValue[0], throttleScale) / startValue[0];
        } else {
          dist[1] = utils_esm_throttle(dist[1] * startValue[1], throttleScale) / startValue[1];
        }
      }

      if (sizeDirection[0] && !sizeDirection[1] || snapDist[0] && !snapDist[1] || isNoSnap && isWidth) {
        dist[0] += snapDist[0];
        var snapHeight = startOffsetWidth * dist[0] * startValue[0] / ratio;
        dist[1] = snapHeight / startOffsetHeight / startValue[1];
      } else if (!sizeDirection[0] && sizeDirection[1] || !snapDist[0] && snapDist[1] || isNoSnap && !isWidth) {
        dist[1] += snapDist[1];
        var snapWidth = startOffsetHeight * dist[1] * startValue[1] * ratio;
        dist[0] = snapWidth / startOffsetWidth / startValue[0];
      }
    } else {
      dist[0] += snapDist[0];
      dist[1] += snapDist[1];

      if (!snapDist[0]) {
        dist[0] = utils_esm_throttle(dist[0] * startValue[0], throttleScale) / startValue[0];
      }

      if (!snapDist[1]) {
        dist[1] = utils_esm_throttle(dist[1] * startValue[1], throttleScale) / startValue[1];
      }
    }

    if (dist[0] === 0) {
      dist[0] = (prevDist[0] > 0 ? 1 : -1) * MIN_SCALE;
    }

    if (dist[1] === 0) {
      dist[1] = (prevDist[1] > 0 ? 1 : -1) * MIN_SCALE;
    }

    var delta = [dist[0] / prevDist[0], dist[1] / prevDist[1]];
    scale = multiply2(dist, startValue);
    var inverseDist = getScaleDist(moveable, dist, datas.fixedDirection, fixedPosition, datas);
    var inverseDelta = minus(inverseDist, datas.prevInverseDist || [0, 0]);
    datas.prevDist = dist;
    datas.prevInverseDist = inverseDist;

    if (scale[0] === prevDist[0] && scale[1] === prevDist[1] && inverseDelta.every(function (num) {
      return !num;
    }) && !parentMoveable) {
      return false;
    }

    var nextTransform = convertTransformFormat(datas, "scale(".concat(scale.join(", "), ")"), "scale(".concat(dist.join(", "), ")"));
    var params = fillParams(moveable, e, moveable_esm_assign({
      offsetWidth: startOffsetWidth,
      offsetHeight: startOffsetHeight,
      direction: direction,
      scale: scale,
      dist: dist,
      delta: delta,
      isPinch: !!isPinch
    }, fillTransformEvent(moveable, nextTransform, inverseDelta, isPinch, e)));
    triggerEvent(moveable, "onScale", params);
    return params;
  },
  dragControlEnd: function (moveable, e) {
    var datas = e.datas,
        isDrag = e.isDrag;

    if (!datas.isScale) {
      return false;
    }

    datas.isScale = false;
    triggerEvent(moveable, "onScaleEnd", fillEndParams(moveable, e, {}));
    return isDrag;
  },
  dragGroupControlCondition: directionCondition,
  dragGroupControlStart: function (moveable, e) {
    var datas = e.datas;
    var params = this.dragControlStart(moveable, e);

    if (!params) {
      return false;
    }

    var originalEvents = fillChildEvents(moveable, "resizable", e);

    function setDist(child, ev) {
      var fixedDirection = datas.fixedDirection;
      var fixedPosition = datas.fixedPosition;
      var startPositions = ev.datas.startPositions || getAbsolutePosesByState(child.state);
      var pos = getPosByDirection(startPositions, fixedDirection);

      var _a = calculate(createRotateMatrix(-moveable.rotation / 180 * Math.PI, 3), [pos[0] - fixedPosition[0], pos[1] - fixedPosition[1], 1], 3),
          originalX = _a[0],
          originalY = _a[1];

      ev.datas.originalX = originalX;
      ev.datas.originalY = originalY;
      return ev;
    }

    datas.moveableScale = moveable.scale;
    var events = triggerChildAbles(moveable, this, "dragControlStart", e, function (child, ev) {
      return setDist(child, ev);
    });

    var setFixedDirection = function (fixedDirection) {
      params.setFixedDirection(fixedDirection);
      events.forEach(function (ev, i) {
        ev.setFixedDirection(fixedDirection);
        setDist(ev.moveable, originalEvents[i]);
      });
    };

    datas.setFixedDirection = setFixedDirection;

    var nextParams = moveable_esm_assign(moveable_esm_assign({}, params), {
      targets: moveable.props.targets,
      events: events,
      setFixedDirection: setFixedDirection
    });

    var result = triggerEvent(moveable, "onScaleGroupStart", nextParams);
    datas.isScale = result !== false;
    return datas.isScale ? nextParams : false;
  },
  dragGroupControl: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isScale) {
      return;
    }

    catchEvent(moveable, "onBeforeScale", function (parentEvent) {
      triggerEvent(moveable, "onBeforeScaleGroup", fillParams(moveable, e, moveable_esm_assign(moveable_esm_assign({}, parentEvent), {
        targets: moveable.props.targets
      }), true));
    });
    var params = this.dragControl(moveable, e);

    if (!params) {
      return;
    }

    var moveableScale = datas.moveableScale;
    moveable.scale = [params.scale[0] * moveableScale[0], params.scale[1] * moveableScale[1]];
    var keepRatio = moveable.props.keepRatio;
    var dist = params.dist,
        scale = params.scale;
    var fixedPosition = datas.fixedPosition;
    var events = triggerChildAbles(moveable, this, "dragControl", e, function (_, ev) {
      var _a = calculate(createRotateMatrix(moveable.rotation / 180 * Math.PI, 3), [ev.datas.originalX * dist[0], ev.datas.originalY * dist[1], 1], 3),
          clientX = _a[0],
          clientY = _a[1];

      return moveable_esm_assign(moveable_esm_assign({}, ev), {
        parentDist: null,
        parentScale: scale,
        parentKeepRatio: keepRatio,
        dragClient: plus(fixedPosition, [clientX, clientY])
      });
    });

    var nextParams = moveable_esm_assign({
      targets: moveable.props.targets,
      events: events
    }, params);

    triggerEvent(moveable, "onScaleGroup", nextParams);
    return nextParams;
  },
  dragGroupControlEnd: function (moveable, e) {
    var isDrag = e.isDrag,
        datas = e.datas;

    if (!datas.isScale) {
      return;
    }

    this.dragControlEnd(moveable, e);
    var events = triggerChildAbles(moveable, this, "dragControlEnd", e);
    var nextParams = fillEndParams(moveable, e, {
      targets: moveable.props.targets,
      events: events
    });
    triggerEvent(moveable, "onScaleGroupEnd", nextParams);
    return isDrag;
  },

  /**
   * @method Moveable.Scalable#request
   * @param {Moveable.Scalable.ScalableRequestParam} e - the Scalable's request parameter
   * @return {Moveable.Requester} Moveable Requester
   * @example
    * // Instantly Request (requestStart - request - requestEnd)
   * moveable.request("scalable", { deltaWidth: 10, deltaHeight: 10 }, true);
   *
   * // requestStart
   * const requester = moveable.request("scalable");
   *
   * // request
   * requester.request({ deltaWidth: 10, deltaHeight: 10 });
   * requester.request({ deltaWidth: 10, deltaHeight: 10 });
   * requester.request({ deltaWidth: 10, deltaHeight: 10 });
   *
   * // requestEnd
   * requester.requestEnd();
   */
  request: function () {
    var datas = {};
    var distWidth = 0;
    var distHeight = 0;
    return {
      isControl: true,
      requestStart: function (e) {
        return {
          datas: datas,
          parentDirection: e.direction || [1, 1]
        };
      },
      request: function (e) {
        distWidth += e.deltaWidth;
        distHeight += e.deltaHeight;
        return {
          datas: datas,
          parentDist: [distWidth, distHeight],
          parentKeepRatio: e.keepRatio
        };
      },
      requestEnd: function () {
        return {
          datas: datas,
          isDrag: true
        };
      }
    };
  }
};
/**
 * Whether or not target can scaled.
 *
 * @name Moveable.Scalable#scalable
 * @default false
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.scalable = true;
 */

/**
 * throttle of scaleX, scaleY when scale.
 * @name Moveable.Scalable#throttleScale
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.throttleScale = 0.1;
 */

/**
 * Set directions to show the control box. (default: ["n", "nw", "ne", "s", "se", "sw", "e", "w"])
 * @name Moveable.Scalable#renderDirections
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     scalable: true,
 *   renderDirections: ["n", "nw", "ne", "s", "se", "sw", "e", "w"],
 * });
 *
 * moveable.renderDirections = ["nw", "ne", "sw", "se"];
 */

/**
 * When resize or scale, keeps a ratio of the width, height. (default: false)
 * @name Moveable.Scalable#keepRatio
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     scalable: true,
 * });
 *
 * moveable.keepRatio = true;
 */

/**
 * When the scale starts, the scaleStart event is called.
 * @memberof Moveable.Scalable
 * @event scaleStart
 * @param {Moveable.Scalable.OnScaleStart} - Parameters for the scaleStart event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { scalable: true });
 * moveable.on("scaleStart", ({ target }) => {
 *     console.log(target);
 * });
 */

/**
 * When scaling, `beforeScale` is called before `scale` occurs. In `beforeScale`, you can get and set the pre-value before scaling.
 * @memberof Moveable.Scalable
 * @event beforeScale
 * @param {Moveable.Scalable.OnBeforeScale} - Parameters for the `beforeScale` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { scalable: true });
 * moveable.on("beforeScale", ({ setFixedDirection }) => {
 *     if (shiftKey) {
 *        setFixedDirection([0, 0]);
 *     }
 * });
 * moveable.on("scale", ({ target, transform, dist }) => {
 *     target.style.transform = transform;
 * });
 */

/**
 * When scaling, the `scale` event is called.
 * @memberof Moveable.Scalable
 * @event scale
 * @param {Moveable.Scalable.OnScale} - Parameters for the `scale` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { scalable: true });
 * moveable.on("scale", ({ target, transform, dist }) => {
 *     target.style.transform = transform;
 * });
 */

/**
 * When the scale finishes, the `scaleEnd` event is called.
 * @memberof Moveable.Scalable
 * @event scaleEnd
 * @param {Moveable.Scalable.OnScaleEnd} - Parameters for the `scaleEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { scalable: true });
 * moveable.on("scaleEnd", ({ target, isDrag }) => {
 *     console.log(target, isDrag);
 * });
 */

/**
* When the group scale starts, the `scaleGroupStart` event is called.
* @memberof Moveable.Scalable
* @event scaleGroupStart
* @param {Moveable.Scalable.OnScaleGroupStart} - Parameters for the `scaleGroupStart` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     target: [].slice.call(document.querySelectorAll(".target")),
*     scalable: true
* });
* moveable.on("scaleGroupStart", ({ targets }) => {
*     console.log("onScaleGroupStart", targets);
* });
*/

/**
* When the group scale, the `scaleGroup` event is called.
* @memberof Moveable.Scalable
* @event scaleGroup
* @param {Moveable.Scalable.OnScaleGroup} - Parameters for the `scaleGroup` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     target: [].slice.call(document.querySelectorAll(".target")),
*     scalable: true
* });
* moveable.on("scaleGroup", ({ targets, events }) => {
*     console.log("onScaleGroup", targets);
*     events.forEach(ev => {
*         const target = ev.target;
*         // ev.drag is a drag event that occurs when the group scale.
*         const left = ev.drag.beforeDist[0];
*         const top = ev.drag.beforeDist[1];
*         const scaleX = ev.scale[0];
*         const scaleY = ev.scale[1];
*     });
* });
*/

/**
 * When the group scale finishes, the `scaleGroupEnd` event is called.
 * @memberof Moveable.Scalable
 * @event scaleGroupEnd
 * @param {Moveable.Scalable.OnScaleGroupEnd} - Parameters for the `scaleGroupEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 *     scalable: true
 * });
 * moveable.on("scaleGroupEnd", ({ targets, isDrag }) => {
 *     console.log("onScaleGroupEnd", targets, isDrag);
 * });
 */

function getMiddleLinePos(pos1, pos2) {
  return pos1.map(function (pos, i) {
    return dot(pos, pos2[i], 1, 2);
  });
}

function getTriangleRad(pos1, pos2, pos3) {
  // pos1 Rad
  var rad1 = getRad(pos1, pos2);
  var rad2 = getRad(pos1, pos3);
  var rad = rad2 - rad1;
  return rad >= 0 ? rad : rad + 2 * Math.PI;
}

function isValidPos(poses1, poses2) {
  var rad1 = getTriangleRad(poses1[0], poses1[1], poses1[2]);
  var rad2 = getTriangleRad(poses2[0], poses2[1], poses2[2]);
  var pi = Math.PI;

  if (rad1 >= pi && rad2 <= pi || rad1 <= pi && rad2 >= pi) {
    return false;
  }

  return true;
}
/**
 * @namespace Moveable.Warpable
 * @description Warpable indicates whether the target can be warped(distorted, bented).
 */


var Warpable = {
  name: "warpable",
  ableGroup: "size",
  props: {
    warpable: Boolean,
    renderDirections: Array
  },
  events: {
    onWarpStart: "warpStart",
    onWarp: "warp",
    onWarpEnd: "warpEnd"
  },
  render: function (moveable, React) {
    var _a = moveable.props,
        resizable = _a.resizable,
        scalable = _a.scalable,
        warpable = _a.warpable,
        zoom = _a.zoom;

    if (resizable || scalable || !warpable) {
      return [];
    }

    var _b = moveable.state,
        pos1 = _b.pos1,
        pos2 = _b.pos2,
        pos3 = _b.pos3,
        pos4 = _b.pos4;
    var linePosFrom1 = getMiddleLinePos(pos1, pos2);
    var linePosFrom2 = getMiddleLinePos(pos2, pos1);
    var linePosFrom3 = getMiddleLinePos(pos1, pos3);
    var linePosFrom4 = getMiddleLinePos(pos3, pos1);
    var linePosTo1 = getMiddleLinePos(pos3, pos4);
    var linePosTo2 = getMiddleLinePos(pos4, pos3);
    var linePosTo3 = getMiddleLinePos(pos2, pos4);
    var linePosTo4 = getMiddleLinePos(pos4, pos2);
    return __spreadArray([React.createElement("div", {
      className: prefix("line"),
      key: "middeLine1",
      style: getLineStyle(linePosFrom1, linePosTo1, zoom)
    }), React.createElement("div", {
      className: prefix("line"),
      key: "middeLine2",
      style: getLineStyle(linePosFrom2, linePosTo2, zoom)
    }), React.createElement("div", {
      className: prefix("line"),
      key: "middeLine3",
      style: getLineStyle(linePosFrom3, linePosTo3, zoom)
    }), React.createElement("div", {
      className: prefix("line"),
      key: "middeLine4",
      style: getLineStyle(linePosFrom4, linePosTo4, zoom)
    })], renderAllDirections(moveable, React), true);
  },
  dragControlCondition: function (moveable, e) {
    if (e.isRequest) {
      return false;
    }

    return hasClass(e.inputEvent.target, prefix("direction"));
  },
  dragControlStart: function (moveable, e) {
    var datas = e.datas,
        inputEvent = e.inputEvent;
    var target = moveable.props.target;
    var inputTarget = inputEvent.target;
    var direction = getDirection(inputTarget);

    if (!direction || !target) {
      return false;
    }

    var state = moveable.state;
    var transformOrigin = state.transformOrigin,
        is3d = state.is3d,
        targetTransform = state.targetTransform,
        targetMatrix = state.targetMatrix,
        width = state.width,
        height = state.height,
        left = state.left,
        top = state.top;
    datas.datas = {};
    datas.targetTransform = targetTransform;
    datas.warpTargetMatrix = is3d ? targetMatrix : convertDimension(targetMatrix, 3, 4);
    datas.targetInverseMatrix = ignoreDimension(matrix_esm_invert(datas.warpTargetMatrix, 4), 3, 4);
    datas.direction = direction;
    datas.left = left;
    datas.top = top;
    datas.poses = [[0, 0], [width, 0], [0, height], [width, height]].map(function (p) {
      return minus(p, transformOrigin);
    });
    datas.nextPoses = datas.poses.map(function (_a) {
      var x = _a[0],
          y = _a[1];
      return calculate(datas.warpTargetMatrix, [x, y, 0, 1], 4);
    });
    datas.startValue = createIdentityMatrix(4);
    datas.prevMatrix = createIdentityMatrix(4);
    datas.absolutePoses = getAbsolutePosesByState(state);
    datas.posIndexes = getPosIndexesByDirection(direction);
    setDragStart(moveable, e);
    setDefaultTransformIndex(e, "matrix3d");
    state.snapRenderInfo = {
      request: e.isRequest,
      direction: direction
    };
    var params = fillParams(moveable, e, moveable_esm_assign({
      set: function (matrix) {
        datas.startValue = matrix;
      }
    }, fillTransformStartEvent(e)));
    var result = triggerEvent(moveable, "onWarpStart", params);

    if (result !== false) {
      datas.isWarp = true;
    }

    return datas.isWarp;
  },
  dragControl: function (moveable, e) {
    var datas = e.datas,
        isRequest = e.isRequest;
    var distX = e.distX,
        distY = e.distY;
    var targetInverseMatrix = datas.targetInverseMatrix,
        prevMatrix = datas.prevMatrix,
        isWarp = datas.isWarp,
        startValue = datas.startValue,
        poses = datas.poses,
        posIndexes = datas.posIndexes,
        absolutePoses = datas.absolutePoses;

    if (!isWarp) {
      return false;
    }

    resolveTransformEvent(e, "matrix3d");

    if (hasGuidelines(moveable, "warpable")) {
      var selectedPoses = posIndexes.map(function (index) {
        return absolutePoses[index];
      });

      if (selectedPoses.length > 1) {
        selectedPoses.push([(selectedPoses[0][0] + selectedPoses[1][0]) / 2, (selectedPoses[0][1] + selectedPoses[1][1]) / 2]);
      }

      var _a = checkMoveableSnapBounds(moveable, isRequest, {
        horizontal: selectedPoses.map(function (pos) {
          return pos[1] + distY;
        }),
        vertical: selectedPoses.map(function (pos) {
          return pos[0] + distX;
        })
      }),
          horizontalSnapInfo = _a.horizontal,
          verticalSnapInfo = _a.vertical;

      distY -= horizontalSnapInfo.offset;
      distX -= verticalSnapInfo.offset;
    }

    var dist = getDragDist({
      datas: datas,
      distX: distX,
      distY: distY
    }, true);
    var nextPoses = datas.nextPoses.slice();
    posIndexes.forEach(function (index) {
      nextPoses[index] = plus(nextPoses[index], dist);
    });

    if (!NEARBY_POS.every(function (nearByPoses) {
      return isValidPos(nearByPoses.map(function (i) {
        return poses[i];
      }), nearByPoses.map(function (i) {
        return nextPoses[i];
      }));
    })) {
      return false;
    }

    var h = createWarpMatrix(poses[0], poses[2], poses[1], poses[3], nextPoses[0], nextPoses[2], nextPoses[1], nextPoses[3]);

    if (!h.length) {
      return false;
    } // B * A * M


    var afterMatrix = multiply(targetInverseMatrix, h, 4); // B * M * A

    var matrix = getTransfromMatrix(datas, afterMatrix, true);
    var delta = multiply(matrix_esm_invert(prevMatrix, 4), matrix, 4);
    datas.prevMatrix = matrix;
    var totalMatrix = multiply(startValue, matrix, 4);
    var nextTransform = convertTransformFormat(datas, "matrix3d(".concat(totalMatrix.join(", "), ")"), "matrix3d(".concat(matrix.join(", "), ")"));
    fillOriginalTransform(e, nextTransform);
    triggerEvent(moveable, "onWarp", fillParams(moveable, e, {
      delta: delta,
      matrix: totalMatrix,
      dist: matrix,
      multiply: multiply,
      transform: nextTransform
    }));
    return true;
  },
  dragControlEnd: function (moveable, e) {
    var datas = e.datas,
        isDrag = e.isDrag;

    if (!datas.isWarp) {
      return false;
    }

    datas.isWarp = false;
    triggerEvent(moveable, "onWarpEnd", fillEndParams(moveable, e, {}));
    return isDrag;
  }
};
/**
 * Whether or not target can be warped. (default: false)
 * @name Moveable.Warpable#warpable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.warpable = true;
 */

/**
* Set directions to show the control box. (default: ["n", "nw", "ne", "s", "se", "sw", "e", "w"])
* @name Moveable.Warpable#renderDirections
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     warpable: true,
*     renderDirections: ["n", "nw", "ne", "s", "se", "sw", "e", "w"],
* });
*
* moveable.renderDirections = ["nw", "ne", "sw", "se"];
*/

/**
* When the warp starts, the warpStart event is called.
* @memberof Moveable.Warpable
* @event warpStart
* @param {Moveable.Warpable.OnWarpStart} - Parameters for the warpStart event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, { warpable: true });
* moveable.on("warpStart", ({ target }) => {
*     console.log(target);
* });
*/

/**
 * When warping, the warp event is called.
 * @memberof Moveable.Warpable
 * @event warp
 * @param {Moveable.Warpable.OnWarp} - Parameters for the warp event
 * @example
 * import Moveable from "moveable";
 * let matrix = [
 *  1, 0, 0, 0,
 *  0, 1, 0, 0,
 *  0, 0, 1, 0,
 *  0, 0, 0, 1,
 * ];
 * const moveable = new Moveable(document.body, { warpable: true });
 * moveable.on("warp", ({ target, transform, delta, multiply }) => {
 *    // target.style.transform = transform;
 *    matrix = multiply(matrix, delta);
 *    target.style.transform = `matrix3d(${matrix.join(",")})`;
 * });
 */

/**
 * When the warp finishes, the warpEnd event is called.
 * @memberof Moveable.Warpable
 * @event warpEnd
 * @param {Moveable.Warpable.OnWarpEnd} - Parameters for the warpEnd event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, { warpable: true });
 * moveable.on("warpEnd", ({ target, isDrag }) => {
 *     console.log(target, isDrag);
 * });
 */

var AREA_PIECES = /*#__PURE__*/prefix("area-pieces");
var AREA_PIECE = /*#__PURE__*/prefix("area-piece");
var AVOID = /*#__PURE__*/prefix("avoid");

function restoreStyle(moveable) {
  var el = moveable.areaElement;

  if (!el) {
    return;
  }

  var _a = moveable.state,
      width = _a.width,
      height = _a.height;
  removeClass(el, AVOID);
  el.style.cssText += "left: 0px; top: 0px; width: ".concat(width, "px; height: ").concat(height, "px");
}

function renderPieces(React) {
  return React.createElement("div", {
    key: "area_pieces",
    className: AREA_PIECES
  }, React.createElement("div", {
    className: AREA_PIECE
  }), React.createElement("div", {
    className: AREA_PIECE
  }), React.createElement("div", {
    className: AREA_PIECE
  }), React.createElement("div", {
    className: AREA_PIECE
  }));
}

var DragArea = {
  name: "dragArea",
  props: {
    dragArea: Boolean,
    passDragArea: Boolean
  },
  events: {
    onClick: "click",
    onClickGroup: "clickGroup"
  },
  render: function (moveable, React) {
    var _a = moveable.props,
        target = _a.target,
        dragArea = _a.dragArea,
        groupable = _a.groupable,
        passDragArea = _a.passDragArea;
    var _b = moveable.state,
        width = _b.width,
        height = _b.height,
        renderPoses = _b.renderPoses;
    var className = passDragArea ? prefix("area", "pass") : prefix("area");

    if (groupable) {
      return [React.createElement("div", {
        key: "area",
        ref: ref(moveable, "areaElement"),
        className: className
      }), renderPieces(React)];
    }

    if (!target || !dragArea) {
      return [];
    }

    var h = createWarpMatrix([0, 0], [width, 0], [0, height], [width, height], renderPoses[0], renderPoses[1], renderPoses[2], renderPoses[3]);
    var transform = h.length ? makeMatrixCSS(h, true) : "none";
    return [React.createElement("div", {
      key: "area",
      ref: ref(moveable, "areaElement"),
      className: className,
      style: {
        top: "0px",
        left: "0px",
        width: "".concat(width, "px"),
        height: "".concat(height, "px"),
        transformOrigin: "0 0",
        transform: transform
      }
    }), renderPieces(React)];
  },
  dragStart: function (moveable, _a) {
    var datas = _a.datas,
        clientX = _a.clientX,
        clientY = _a.clientY,
        inputEvent = _a.inputEvent;

    if (!inputEvent) {
      return false;
    }

    datas.isDragArea = false;
    var areaElement = moveable.areaElement;
    var state = moveable.state;
    var moveableClientRect = state.moveableClientRect,
        renderPoses = state.renderPoses,
        rootMatrix = state.rootMatrix,
        is3d = state.is3d;
    var left = moveableClientRect.left,
        top = moveableClientRect.top;

    var _b = moveable_esm_getRect(renderPoses),
        relativeLeft = _b.left,
        relativeTop = _b.top,
        width = _b.width,
        height = _b.height;

    var n = is3d ? 4 : 3;

    var _c = calculateInversePosition(rootMatrix, [clientX - left, clientY - top], n),
        posX = _c[0],
        posY = _c[1];

    posX -= relativeLeft;
    posY -= relativeTop;
    var rects = [{
      left: relativeLeft,
      top: relativeTop,
      width: width,
      height: posY - 10
    }, {
      left: relativeLeft,
      top: relativeTop,
      width: posX - 10,
      height: height
    }, {
      left: relativeLeft,
      top: relativeTop + posY + 10,
      width: width,
      height: height - posY - 10
    }, {
      left: relativeLeft + posX + 10,
      top: relativeTop,
      width: width - posX - 10,
      height: height
    }];
    var children = [].slice.call(areaElement.nextElementSibling.children);
    rects.forEach(function (rect, i) {
      children[i].style.cssText = "left: ".concat(rect.left, "px;top: ").concat(rect.top, "px; width: ").concat(rect.width, "px; height: ").concat(rect.height, "px;");
    });
    addClass(areaElement, AVOID);
    state.disableNativeEvent = true;
    return;
  },
  drag: function (moveable, _a) {
    var datas = _a.datas,
        inputEvent = _a.inputEvent;
    this.enableNativeEvent(moveable);

    if (!inputEvent) {
      return false;
    }

    if (!datas.isDragArea) {
      datas.isDragArea = true;
      restoreStyle(moveable);
    }
  },
  dragEnd: function (moveable, e) {
    this.enableNativeEvent(moveable);
    var inputEvent = e.inputEvent,
        datas = e.datas;

    if (!inputEvent) {
      return false;
    }

    if (!datas.isDragArea) {
      restoreStyle(moveable);
    }
  },
  dragGroupStart: function (moveable, e) {
    return this.dragStart(moveable, e);
  },
  dragGroup: function (moveable, e) {
    return this.drag(moveable, e);
  },
  dragGroupEnd: function (moveable, e) {
    return this.dragEnd(moveable, e);
  },
  unset: function (moveable) {
    restoreStyle(moveable);
    moveable.state.disableNativeEvent = false;
  },
  enableNativeEvent: function (moveable) {
    var state = moveable.state;

    if (state.disableNativeEvent) {
      utils_esm_requestAnimationFrame(function () {
        state.disableNativeEvent = false;
      });
    }
  }
};
/**
 * Add an event to the moveable area instead of the target for stopPropagation. (default: false, true in group)
 * @name Moveable#dragArea
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *  dragArea: false,
 * });
 */

/**
 * Set `pointerEvents: none;` css to pass events in dragArea. (default: false)
 * @name Moveable#passDragArea
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *  dragArea: false,
 * });
 */

var Origin = makeAble("origin", {
  render: function (moveable, React) {
    var zoom = moveable.props.zoom;
    var _a = moveable.state,
        beforeOrigin = _a.beforeOrigin,
        rotation = _a.rotation;
    return [React.createElement("div", {
      className: prefix("control", "origin"),
      style: getControlTransform(rotation, zoom, beforeOrigin),
      key: "beforeOrigin"
    })];
  }
});
/**
 * Whether or not the origin controlbox will be visible or not (default: true)
 * @name Moveable#origin
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 *
 * moveable.origin = true;
 */

function moveable_esm_getDefaultScrollPosition(e) {
  var scrollContainer = e.scrollContainer;
  return [scrollContainer.scrollLeft, scrollContainer.scrollTop];
}
/**
 * @namespace Moveable.Scrollable
 * @description Whether or not target can be scrolled to the scroll container (default: false)
 */


var Scrollable = {
  name: "scrollable",
  canPinch: true,
  props: {
    scrollable: Boolean,
    scrollContainer: Object,
    scrollThreshold: Number,
    getScrollPosition: Function
  },
  events: {
    onScroll: "scroll",
    onScrollGroup: "scrollGroup"
  },
  dragRelation: "strong",
  dragStart: function (moveable, e) {
    var props = moveable.props;
    var _a = props.scrollContainer,
        scrollContainer = _a === void 0 ? moveable.getContainer() : _a;
    var dragScroll = new dragscroll_esm();
    var scrollContainerElement = getRefTarget(scrollContainer, true);
    e.datas.dragScroll = dragScroll;
    var gestoName = e.isControl ? "controlGesto" : "targetGesto";
    var targets = e.targets;
    dragScroll.on("scroll", function (_a) {
      var container = _a.container,
          direction = _a.direction;
      var params = fillParams(moveable, e, {
        scrollContainer: container,
        direction: direction
      });
      var eventName = targets ? "onScrollGroup" : "onScroll";

      if (targets) {
        params.targets = targets;
      }

      triggerEvent(moveable, eventName, params);
    }).on("move", function (_a) {
      var offsetX = _a.offsetX,
          offsetY = _a.offsetY;
      moveable[gestoName].scrollBy(offsetX, offsetY, e.inputEvent, false);
    });
    dragScroll.dragStart(e, {
      container: scrollContainerElement
    });
  },
  checkScroll: function (moveable, e) {
    var dragScroll = e.datas.dragScroll;

    if (!dragScroll) {
      return;
    }

    var _a = moveable.props,
        _b = _a.scrollContainer,
        scrollContainer = _b === void 0 ? moveable.getContainer() : _b,
        _c = _a.scrollThreshold,
        scrollThreshold = _c === void 0 ? 0 : _c,
        _d = _a.getScrollPosition,
        getScrollPosition = _d === void 0 ? moveable_esm_getDefaultScrollPosition : _d;
    dragScroll.drag(e, {
      container: scrollContainer,
      threshold: scrollThreshold,
      getScrollPosition: function (ev) {
        return getScrollPosition({
          scrollContainer: ev.container,
          direction: ev.direction
        });
      }
    });
    return true;
  },
  drag: function (moveable, e) {
    return this.checkScroll(moveable, e);
  },
  dragEnd: function (moveable, e) {
    e.datas.dragScroll.dragEnd();
    e.datas.dragScroll = null;
  },
  dragControlStart: function (moveable, e) {
    return this.dragStart(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      isControl: true
    }));
  },
  dragControl: function (moveable, e) {
    return this.drag(moveable, e);
  },
  dragControlEnd: function (moveable, e) {
    return this.dragEnd(moveable, e);
  },
  dragGroupStart: function (moveable, e) {
    return this.dragStart(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  },
  dragGroup: function (moveable, e) {
    return this.drag(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  },
  dragGroupEnd: function (moveable, e) {
    return this.dragEnd(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  },
  dragGroupControlStart: function (moveable, e) {
    return this.dragStart(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets,
      isControl: true
    }));
  },
  dragGroupContro: function (moveable, e) {
    return this.drag(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  },
  dragGroupControEnd: function (moveable, e) {
    return this.dragEnd(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      targets: moveable.props.targets
    }));
  }
};
/**
 * Whether or not target can be scrolled to the scroll container (default: false)
 * @name Moveable.Scrollable#scrollable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   scrollable: true,
 *   scrollContainer: document.body,
 *   scrollThreshold: 0,
 *   getScrollPosition: ({ scrollContainer }) => ([scrollContainer.scrollLeft, scrollContainer.scrollTop]),
 * });
 *
 * moveable.scrollable = true;
 */

/**
 * The container to which scroll is applied (default: container)
 * @name Moveable.Scrollable#scrollContainer
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   scrollable: true,
 *   scrollContainer: document.body,
 *   scrollThreshold: 0,
 *   getScrollPosition: ({ scrollContainer }) => ([scrollContainer.scrollLeft, scrollContainer.scrollTop]),
 * });
 */

/**
 * Expand the range of the scroll check area. (default: 0)
 * @name Moveable.Scrollable#scrollThreshold
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   scrollable: true,
 *   scrollContainer: document.body,
 *   scrollThreshold: 0,
 *   getScrollPosition: ({ scrollContainer }) => ([scrollContainer.scrollLeft, scrollContainer.scrollTop]),
 * });
 */

/**
 * Sets a function to get the scroll position. (default: Function)
 * @name Moveable.Scrollable#getScrollPosition
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   scrollable: true,
 *   scrollContainer: document.body,
 *   scrollThreshold: 0,
 *   getScrollPosition: ({ scrollContainer }) => ([scrollContainer.scrollLeft, scrollContainer.scrollTop]),
 * });
 *
 */

/**
 * When the drag cursor leaves the scrollContainer, the `scroll` event occur to scroll.
 * @memberof Moveable.Scrollable
 * @event scroll
 * @param {Moveable.Scrollable.OnScroll} - Parameters for the `scroll` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: document.querySelector(".target"),
 * });
 * moveable.on("scroll", ({ scrollContainer, direction }) => {
 *   scrollContainer.scrollLeft += direction[0] * 10;
 *   scrollContainer.scrollTop += direction[1] * 10;
 * });
 */

/**
 * When the drag cursor leaves the scrollContainer, the `scrollGroup` event occur to scroll in group.
 * @memberof Moveable.Scrollable
 * @event scrollGroup
 * @param {Moveable.Scrollable.OnScrollGroup} - Parameters for the `scrollGroup` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 * });
 * moveable.on("scroll", ({ scrollContainer, direction }) => {
 *   scrollContainer.scrollLeft += direction[0] * 10;
 *   scrollContainer.scrollTop += direction[1] * 10;
 * });
 */

var Default = {
  name: "",
  props: {
    target: Object,
    dragTarget: Object,
    container: Object,
    portalContainer: Object,
    rootContainer: Object,
    useResizeObserver: Boolean,
    zoom: Number,
    transformOrigin: Array,
    edge: Boolean,
    ables: Array,
    className: String,
    pinchThreshold: Number,
    pinchOutside: Boolean,
    triggerAblesSimultaneously: Boolean,
    checkInput: Boolean,
    cspNonce: String,
    translateZ: Number,
    hideDefaultLines: Boolean,
    props: Object,
    flushSync: Function
  },
  events: {}
};
var Padding = makeAble("padding", {
  render: function (moveable, React) {
    var props = moveable.props;

    if (props.dragArea) {
      return [];
    }

    var padding = props.padding || {};
    var _a = padding.left,
        left = _a === void 0 ? 0 : _a,
        _b = padding.top,
        top = _b === void 0 ? 0 : _b,
        _c = padding.right,
        right = _c === void 0 ? 0 : _c,
        _d = padding.bottom,
        bottom = _d === void 0 ? 0 : _d;
    var _e = moveable.state,
        renderPoses = _e.renderPoses,
        pos1 = _e.pos1,
        pos2 = _e.pos2,
        pos3 = _e.pos3,
        pos4 = _e.pos4;
    var poses = [pos1, pos2, pos3, pos4];
    var paddingDirections = [];

    if (left > 0) {
      paddingDirections.push([0, 2]);
    }

    if (top > 0) {
      paddingDirections.push([0, 1]);
    }

    if (right > 0) {
      paddingDirections.push([1, 3]);
    }

    if (bottom > 0) {
      paddingDirections.push([2, 3]);
    }

    return paddingDirections.map(function (_a, i) {
      var dir1 = _a[0],
          dir2 = _a[1];
      var paddingPos1 = poses[dir1];
      var paddingPos2 = poses[dir2];
      var paddingPos3 = renderPoses[dir1];
      var paddingPos4 = renderPoses[dir2];
      var h = createWarpMatrix([0, 0], [100, 0], [0, 100], [100, 100], paddingPos1, paddingPos2, paddingPos3, paddingPos4);

      if (!h.length) {
        return undefined;
      }

      return React.createElement("div", {
        key: "padding".concat(i),
        className: prefix("padding"),
        style: {
          transform: makeMatrixCSS(h, true)
        }
      });
    });
  }
});
/**
 * Add padding around the target to increase the drag area.
 * @name Moveable#padding
 * @default null
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *  target: document.querySelector(".target"),
 *  padding: { left: 0, top: 0, right: 0, bottom: 0 },
 * });
 * moveable.padding = { left: 10, top: 10, right: 10, bottom: 10 },
 * moveable.updateRect();
 */

var RADIUS_DIRECTIONS = ["nw", "ne", "se", "sw"];

function calculateRatio(values, size) {
  var sumSize = values[0] + values[1];
  var sumRatio = sumSize > size ? size / sumSize : 1;
  values[0] *= sumRatio;
  values[1] = size - values[1] * sumRatio;
  return values;
}

var HORIZONTAL_RADIUS_ORDER = [1, 2, 5, 6];
var VERTICAL_RADIUS_ORDER = [0, 3, 4, 7];
var HORIZONTAL_RADIUS_DIRECTIONS = [1, -1, -1, 1];
var VERTICAL_RADIUS_DIRECTIONS = [1, 1, -1, -1];

function getRadiusStyles(poses, controlPoses, isRelative, width, height, left, top, right, bottom) {
  if (left === void 0) {
    left = 0;
  }

  if (top === void 0) {
    top = 0;
  }

  if (right === void 0) {
    right = width;
  }

  if (bottom === void 0) {
    bottom = height;
  }

  var clipStyles = [];
  var isVertical = false;
  var raws = poses.map(function (pos, i) {
    var _a = controlPoses[i],
        horizontal = _a.horizontal,
        vertical = _a.vertical;

    if (vertical && !isVertical) {
      isVertical = true;
      clipStyles.push("/");
    }

    if (isVertical) {
      var rawPos = Math.max(0, vertical === 1 ? pos[1] - top : bottom - pos[1]);
      clipStyles.push(convertCSSSize(rawPos, height, isRelative));
      return rawPos;
    } else {
      var rawPos = Math.max(0, horizontal === 1 ? pos[0] - left : right - pos[0]);
      clipStyles.push(convertCSSSize(rawPos, width, isRelative));
      return rawPos;
    }
  });
  return {
    styles: clipStyles,
    raws: raws
  };
}

function getRadiusRange(controlPoses) {
  // [start, length]
  var horizontalRange = [0, 0];
  var verticalRange = [0, 0];
  var length = controlPoses.length;

  for (var i = 0; i < length; ++i) {
    var clipPose = controlPoses[i];

    if (!clipPose.sub) {
      continue;
    }

    if (clipPose.horizontal) {
      if (horizontalRange[1] === 0) {
        horizontalRange[0] = i;
      }

      horizontalRange[1] = i - horizontalRange[0] + 1;
      verticalRange[0] = i + 1;
    }

    if (clipPose.vertical) {
      if (verticalRange[1] === 0) {
        verticalRange[0] = i;
      }

      verticalRange[1] = i - verticalRange[0] + 1;
    }
  }

  return {
    horizontalRange: horizontalRange,
    verticalRange: verticalRange
  };
}

function getRadiusValues(values, width, height, left, top, minCounts) {
  var _a, _b, _c, _d;

  if (minCounts === void 0) {
    minCounts = [0, 0];
  }

  var splitIndex = values.indexOf("/");
  var splitLength = (splitIndex > -1 ? values.slice(0, splitIndex) : values).length;
  var horizontalValues = values.slice(0, splitLength);
  var verticalValues = values.slice(splitLength + 1);
  var _e = horizontalValues[0],
      nwValue = _e === void 0 ? "0px" : _e,
      _f = horizontalValues[1],
      neValue = _f === void 0 ? nwValue : _f,
      _g = horizontalValues[2],
      seValue = _g === void 0 ? nwValue : _g,
      _h = horizontalValues[3],
      swValue = _h === void 0 ? neValue : _h;
  var _j = verticalValues[0],
      wnValue = _j === void 0 ? nwValue : _j,
      _k = verticalValues[1],
      enValue = _k === void 0 ? wnValue : _k,
      _l = verticalValues[2],
      esValue = _l === void 0 ? wnValue : _l,
      _m = verticalValues[3],
      wsValue = _m === void 0 ? enValue : _m;
  var horizontalRawPoses = [nwValue, neValue, seValue, swValue].map(function (pos) {
    return convertUnitSize(pos, width);
  });
  var verticalRawPoses = [wnValue, enValue, esValue, wsValue].map(function (pos) {
    return convertUnitSize(pos, height);
  });
  var horizontalPoses = horizontalRawPoses.slice();
  var verticalPoses = verticalRawPoses.slice();
  _a = calculateRatio([horizontalPoses[0], horizontalPoses[1]], width), horizontalPoses[0] = _a[0], horizontalPoses[1] = _a[1];
  _b = calculateRatio([horizontalPoses[3], horizontalPoses[2]], width), horizontalPoses[3] = _b[0], horizontalPoses[2] = _b[1];
  _c = calculateRatio([verticalPoses[0], verticalPoses[3]], height), verticalPoses[0] = _c[0], verticalPoses[3] = _c[1];
  _d = calculateRatio([verticalPoses[1], verticalPoses[2]], height), verticalPoses[1] = _d[0], verticalPoses[2] = _d[1];
  var nextHorizontalPoses = horizontalPoses.slice(0, Math.max(minCounts[0], horizontalValues.length));
  var nextVerticalPoses = verticalPoses.slice(0, Math.max(minCounts[1], verticalValues.length));
  return __spreadArray(__spreadArray([], nextHorizontalPoses.map(function (pos, i) {
    var direction = RADIUS_DIRECTIONS[i];
    return {
      horizontal: HORIZONTAL_RADIUS_DIRECTIONS[i],
      vertical: 0,
      pos: [left + pos, top + (VERTICAL_RADIUS_DIRECTIONS[i] === -1 ? height : 0)],
      sub: true,
      raw: horizontalRawPoses[i],
      direction: direction
    };
  }), true), nextVerticalPoses.map(function (pos, i) {
    var direction = RADIUS_DIRECTIONS[i];
    return {
      horizontal: 0,
      vertical: VERTICAL_RADIUS_DIRECTIONS[i],
      pos: [left + (HORIZONTAL_RADIUS_DIRECTIONS[i] === -1 ? width : 0), top + pos],
      sub: true,
      raw: verticalRawPoses[i],
      direction: direction
    };
  }), true);
}

function removeRadiusPos(controlPoses, poses, index, startIndex, length) {
  if (length === void 0) {
    length = poses.length;
  }

  var _a = getRadiusRange(controlPoses.slice(startIndex)),
      horizontalRange = _a.horizontalRange,
      verticalRange = _a.verticalRange;

  var radiuslIndex = index - startIndex;
  var deleteCount = 0;

  if (radiuslIndex === 0) {
    deleteCount = length;
  } else if (radiuslIndex > 0 && radiuslIndex < horizontalRange[1]) {
    deleteCount = horizontalRange[1] - radiuslIndex;
  } else if (radiuslIndex >= verticalRange[0]) {
    deleteCount = verticalRange[0] + verticalRange[1] - radiuslIndex;
  } else {
    return;
  }

  controlPoses.splice(index, deleteCount);
  poses.splice(index, deleteCount);
}

function addRadiusPos(controlPoses, poses, startIndex, horizontalIndex, verticalIndex, distX, distY, right, bottom, left, top) {
  if (left === void 0) {
    left = 0;
  }

  if (top === void 0) {
    top = 0;
  }

  var _a = getRadiusRange(controlPoses.slice(startIndex)),
      horizontalRange = _a.horizontalRange,
      verticalRange = _a.verticalRange;

  if (horizontalIndex > -1) {
    var radiusX = HORIZONTAL_RADIUS_DIRECTIONS[horizontalIndex] === 1 ? distX - left : right - distX;

    for (var i = horizontalRange[1]; i <= horizontalIndex; ++i) {
      var y = VERTICAL_RADIUS_DIRECTIONS[i] === 1 ? top : bottom;
      var x = 0;

      if (horizontalIndex === i) {
        x = distX;
      } else if (i === 0) {
        x = left + radiusX;
      } else if (HORIZONTAL_RADIUS_DIRECTIONS[i] === -1) {
        x = right - (poses[startIndex][0] - left);
      }

      controlPoses.splice(startIndex + i, 0, {
        horizontal: HORIZONTAL_RADIUS_DIRECTIONS[i],
        vertical: 0,
        pos: [x, y]
      });
      poses.splice(startIndex + i, 0, [x, y]);

      if (i === 0) {
        break;
      }
    }
  } else if (verticalIndex > -1) {
    var radiusY = VERTICAL_RADIUS_DIRECTIONS[verticalIndex] === 1 ? distY - top : bottom - distY;

    if (horizontalRange[1] === 0 && verticalRange[1] === 0) {
      var pos = [left + radiusY, top];
      controlPoses.push({
        horizontal: HORIZONTAL_RADIUS_DIRECTIONS[0],
        vertical: 0,
        pos: pos
      });
      poses.push(pos);
    }

    var startVerticalIndex = verticalRange[0];

    for (var i = verticalRange[1]; i <= verticalIndex; ++i) {
      var x = HORIZONTAL_RADIUS_DIRECTIONS[i] === 1 ? left : right;
      var y = 0;

      if (verticalIndex === i) {
        y = distY;
      } else if (i === 0) {
        y = top + radiusY;
      } else if (VERTICAL_RADIUS_DIRECTIONS[i] === 1) {
        y = poses[startIndex + startVerticalIndex][1];
      } else if (VERTICAL_RADIUS_DIRECTIONS[i] === -1) {
        y = bottom - (poses[startIndex + startVerticalIndex][1] - top);
      }

      controlPoses.push({
        horizontal: 0,
        vertical: VERTICAL_RADIUS_DIRECTIONS[i],
        pos: [x, y]
      });
      poses.push([x, y]);

      if (i === 0) {
        break;
      }
    }
  }
}

function splitRadiusPoses(controlPoses, raws) {
  if (raws === void 0) {
    raws = controlPoses.map(function (pos) {
      return pos.raw;
    });
  }

  var horizontals = controlPoses.map(function (pos, i) {
    return pos.horizontal ? raws[i] : null;
  }).filter(function (pos) {
    return pos != null;
  });
  var verticals = controlPoses.map(function (pos, i) {
    return pos.vertical ? raws[i] : null;
  }).filter(function (pos) {
    return pos != null;
  });
  return {
    horizontals: horizontals,
    verticals: verticals
  };
}

var CLIP_DIRECTIONS = [[0, -1, "n"], [1, 0, "e"]];
var CLIP_RECT_DIRECTIONS = [[-1, -1, "nw"], [0, -1, "n"], [1, -1, "ne"], [1, 0, "e"], [1, 1, "se"], [0, 1, "s"], [-1, 1, "sw"], [-1, 0, "w"]]; // 1 2 5 6 0 3 4 7
// 0 1 2 3 4 5 6 7

function getClipStyles(moveable, clipPath, poses) {
  var clipRelative = moveable.props.clipRelative;
  var _a = moveable.state,
      width = _a.width,
      height = _a.height;
  var _b = clipPath,
      clipType = _b.type,
      clipPoses = _b.poses;
  var isRect = clipType === "rect";
  var isCircle = clipType === "circle";

  if (clipType === "polygon") {
    return poses.map(function (pos) {
      return "".concat(convertCSSSize(pos[0], width, clipRelative), " ").concat(convertCSSSize(pos[1], height, clipRelative));
    });
  } else if (isRect || clipType === "inset") {
    var top = poses[1][1];
    var right = poses[3][0];
    var left = poses[7][0];
    var bottom = poses[5][1];

    if (isRect) {
      return [top, right, bottom, left].map(function (pos) {
        return "".concat(pos, "px");
      });
    }

    var clipStyles = [top, width - right, height - bottom, left].map(function (pos, i) {
      return convertCSSSize(pos, i % 2 ? width : height, clipRelative);
    });

    if (poses.length > 8) {
      var _c = minus(poses[4], poses[0]),
          subWidth = _c[0],
          subHeight = _c[1];

      clipStyles.push.apply(clipStyles, __spreadArray(["round"], getRadiusStyles(poses.slice(8), clipPoses.slice(8), clipRelative, subWidth, subHeight, left, top, right, bottom).styles, false));
    }

    return clipStyles;
  } else if (isCircle || clipType === "ellipse") {
    var center = poses[0];
    var ry = convertCSSSize(Math.abs(poses[1][1] - center[1]), isCircle ? Math.sqrt((width * width + height * height) / 2) : height, clipRelative);
    var clipStyles = isCircle ? [ry] : [convertCSSSize(Math.abs(poses[2][0] - center[0]), width, clipRelative), ry];
    clipStyles.push("at", convertCSSSize(center[0], width, clipRelative), convertCSSSize(center[1], height, clipRelative));
    return clipStyles;
  }
}

function getRectPoses(top, right, bottom, left) {
  var xs = [left, (left + right) / 2, right];
  var ys = [top, (top + bottom) / 2, bottom];
  return CLIP_RECT_DIRECTIONS.map(function (_a) {
    var dirx = _a[0],
        diry = _a[1],
        dir = _a[2];
    var x = xs[dirx + 1];
    var y = ys[diry + 1];
    return {
      vertical: Math.abs(diry),
      horizontal: Math.abs(dirx),
      direction: dir,
      pos: [x, y]
    };
  });
}

function getControlSize(controlPoses) {
  var xRange = [Infinity, -Infinity];
  var yRange = [Infinity, -Infinity];
  controlPoses.forEach(function (_a) {
    var pos = _a.pos;
    xRange[0] = Math.min(xRange[0], pos[0]);
    xRange[1] = Math.max(xRange[1], pos[0]);
    yRange[0] = Math.min(yRange[0], pos[1]);
    yRange[1] = Math.max(yRange[1], pos[1]);
  });
  return [Math.abs(xRange[1] - xRange[0]), Math.abs(yRange[1] - yRange[0])];
}

function moveControlPos(controlPoses, index, dist, isRect, keepRatio) {
  var _a = controlPoses[index],
      direction = _a.direction,
      sub = _a.sub;
  var dists = controlPoses.map(function () {
    return [0, 0];
  });
  var directions = direction ? direction.split("") : [];

  if (isRect && index < 8) {
    var verticalDirections = directions.filter(function (dir) {
      return dir === "w" || dir === "e";
    });
    var horizontalDirections = directions.filter(function (dir) {
      return dir === "n" || dir === "s";
    });
    var verticalDirection_1 = verticalDirections[0];
    var horizontalDirection_1 = horizontalDirections[0];
    dists[index] = dist;

    var _b = getControlSize(controlPoses),
        width = _b[0],
        height = _b[1];

    var ratio = width && height ? width / height : 0;

    if (ratio && keepRatio) {
      // 0 1 2
      // 7   3
      // 6 5 4
      var fixedIndex = (index + 4) % 8;
      var fixedPosition = controlPoses[fixedIndex].pos;
      var sizeDirection = [0, 0];

      if (direction.indexOf("w") > -1) {
        sizeDirection[0] = -1;
      } else if (direction.indexOf("e") > -1) {
        sizeDirection[0] = 1;
      }

      if (direction.indexOf("n") > -1) {
        sizeDirection[1] = -1;
      } else if (direction.indexOf("s") > -1) {
        sizeDirection[1] = 1;
      }

      var nextDist = getSizeDistByDist([width, height], dist, ratio, sizeDirection, true);
      var nextWidth = width + nextDist[0];
      var nextHeight = height + nextDist[1];
      var top = fixedPosition[1];
      var bottom = fixedPosition[1];
      var left = fixedPosition[0];
      var right = fixedPosition[0];

      if (sizeDirection[0] === -1) {
        left = right - nextWidth;
      } else if (sizeDirection[0] === 1) {
        right = left + nextWidth;
      } else {
        left = left - nextWidth / 2;
        right = right + nextWidth / 2;
      }

      if (sizeDirection[1] === -1) {
        top = bottom - nextHeight;
      } else if (sizeDirection[1] === 1) {
        bottom = top + nextHeight;
      } else {
        top = bottom - nextHeight / 2;
        bottom = top + nextHeight;
      }

      var nextControlPoses_1 = getRectPoses(top, right, bottom, left);
      controlPoses.forEach(function (controlPose, i) {
        dists[i][0] = nextControlPoses_1[i].pos[0] - controlPose.pos[0];
        dists[i][1] = nextControlPoses_1[i].pos[1] - controlPose.pos[1];
      });
    } else {
      controlPoses.forEach(function (controlPose, i) {
        var controlDir = controlPose.direction;

        if (!controlDir) {
          return;
        }

        if (controlDir.indexOf(verticalDirection_1) > -1) {
          dists[i][0] = dist[0];
        }

        if (controlDir.indexOf(horizontalDirection_1) > -1) {
          dists[i][1] = dist[1];
        }
      });

      if (verticalDirection_1) {
        dists[1][0] = dist[0] / 2;
        dists[5][0] = dist[0] / 2;
      }

      if (horizontalDirection_1) {
        dists[3][1] = dist[1] / 2;
        dists[7][1] = dist[1] / 2;
      }
    }
  } else if (direction && !sub) {
    directions.forEach(function (dir) {
      var isVertical = dir === "n" || dir === "s";
      controlPoses.forEach(function (controlPose, i) {
        var dirDir = controlPose.direction,
            dirHorizontal = controlPose.horizontal,
            dirVertical = controlPose.vertical;

        if (!dirDir || dirDir.indexOf(dir) === -1) {
          return;
        }

        dists[i] = [isVertical || !dirHorizontal ? 0 : dist[0], !isVertical || !dirVertical ? 0 : dist[1]];
      });
    });
  } else {
    dists[index] = dist;
  }

  return dists;
}

function getClipPath(target, width, height, defaultClip, customClip) {
  var _a, _b, _c, _d, _e, _f, _g;

  var clipText = customClip;

  if (!clipText) {
    var style = moveable_esm_getComputedStyle(target);
    var clipPath = style.clipPath;
    clipText = clipPath !== "none" ? clipPath : style.clip;
  }

  if (!clipText || clipText === "none" || clipText === "auto") {
    clipText = defaultClip;

    if (!clipText) {
      return;
    }
  }

  var _h = splitBracket(clipText),
      _j = _h.prefix,
      clipPrefix = _j === void 0 ? clipText : _j,
      _k = _h.value,
      value = _k === void 0 ? "" : _k;

  var isCircle = clipPrefix === "circle";
  var splitter = " ";

  if (clipPrefix === "polygon") {
    var values = splitComma(value || "0% 0%, 100% 0%, 100% 100%, 0% 100%");
    splitter = ",";
    var poses = values.map(function (pos) {
      var _a = pos.split(" "),
          xPos = _a[0],
          yPos = _a[1];

      return {
        vertical: 1,
        horizontal: 1,
        pos: [convertUnitSize(xPos, width), convertUnitSize(yPos, height)]
      };
    });
    return {
      type: clipPrefix,
      clipText: clipText,
      poses: poses,
      splitter: splitter
    };
  } else if (isCircle || clipPrefix === "ellipse") {
    var xPos = "";
    var yPos = "";
    var radiusX_1 = 0;
    var radiusY_1 = 0;
    var values = splitSpace(value);

    if (isCircle) {
      var radius = "";
      _a = values[0], radius = _a === void 0 ? "50%" : _a, _b = values[2], xPos = _b === void 0 ? "50%" : _b, _c = values[3], yPos = _c === void 0 ? "50%" : _c;
      radiusX_1 = convertUnitSize(radius, Math.sqrt((width * width + height * height) / 2));
      radiusY_1 = radiusX_1;
    } else {
      var xRadius = "";
      var yRadius = "";
      _d = values[0], xRadius = _d === void 0 ? "50%" : _d, _e = values[1], yRadius = _e === void 0 ? "50%" : _e, _f = values[3], xPos = _f === void 0 ? "50%" : _f, _g = values[4], yPos = _g === void 0 ? "50%" : _g;
      radiusX_1 = convertUnitSize(xRadius, width);
      radiusY_1 = convertUnitSize(yRadius, height);
    }

    var centerPos_1 = [convertUnitSize(xPos, width), convertUnitSize(yPos, height)];

    var poses = __spreadArray([{
      vertical: 1,
      horizontal: 1,
      pos: centerPos_1,
      direction: "nesw"
    }], CLIP_DIRECTIONS.slice(0, isCircle ? 1 : 2).map(function (dir) {
      return {
        vertical: Math.abs(dir[1]),
        horizontal: dir[0],
        direction: dir[2],
        sub: true,
        pos: [centerPos_1[0] + dir[0] * radiusX_1, centerPos_1[1] + dir[1] * radiusY_1]
      };
    }), true);

    return {
      type: clipPrefix,
      clipText: clipText,
      radiusX: radiusX_1,
      radiusY: radiusY_1,
      left: centerPos_1[0] - radiusX_1,
      top: centerPos_1[1] - radiusY_1,
      poses: poses,
      splitter: splitter
    };
  } else if (clipPrefix === "inset") {
    var values = splitSpace(value || "0 0 0 0");
    var roundIndex = values.indexOf("round");
    var rectLength = (roundIndex > -1 ? values.slice(0, roundIndex) : values).length;
    var radiusValues = values.slice(rectLength + 1);

    var _l = values.slice(0, rectLength),
        topValue = _l[0],
        _m = _l[1],
        rightValue = _m === void 0 ? topValue : _m,
        _o = _l[2],
        bottomValue = _o === void 0 ? topValue : _o,
        _p = _l[3],
        leftValue = _p === void 0 ? rightValue : _p;

    var _q = [topValue, bottomValue].map(function (pos) {
      return convertUnitSize(pos, height);
    }),
        top = _q[0],
        bottom = _q[1];

    var _r = [leftValue, rightValue].map(function (pos) {
      return convertUnitSize(pos, width);
    }),
        left = _r[0],
        right = _r[1];

    var nextRight = width - right;
    var nextBottom = height - bottom;
    var radiusPoses = getRadiusValues(radiusValues, nextRight - left, nextBottom - top, left, top);

    var poses = __spreadArray(__spreadArray([], getRectPoses(top, nextRight, nextBottom, left), true), radiusPoses, true);

    return {
      type: "inset",
      clipText: clipText,
      poses: poses,
      top: top,
      left: left,
      right: nextRight,
      bottom: nextBottom,
      radius: radiusValues,
      splitter: splitter
    };
  } else if (clipPrefix === "rect") {
    // top right bottom left
    var values = splitComma(value || "0px, ".concat(width, "px, ").concat(height, "px, 0px"));
    splitter = ",";

    var _s = values.map(function (pos) {
      var posValue = splitUnit(pos).value;
      return posValue;
    }),
        top = _s[0],
        right = _s[1],
        bottom = _s[2],
        left = _s[3];

    var poses = getRectPoses(top, right, bottom, left);
    return {
      type: "rect",
      clipText: clipText,
      poses: poses,
      top: top,
      right: right,
      bottom: bottom,
      left: left,
      values: values,
      splitter: splitter
    };
  }

  return;
}

function addClipPath(moveable, e) {
  var _a = calculatePointerDist(moveable, e),
      distX = _a[0],
      distY = _a[1];

  var _b = e.datas,
      clipPath = _b.clipPath,
      clipIndex = _b.clipIndex;
  var _c = clipPath,
      clipType = _c.type,
      clipPoses = _c.poses,
      splitter = _c.splitter;
  var poses = clipPoses.map(function (pos) {
    return pos.pos;
  });

  if (clipType === "polygon") {
    poses.splice(clipIndex, 0, [distX, distY]);
  } else if (clipType === "inset") {
    var horizontalIndex = HORIZONTAL_RADIUS_ORDER.indexOf(clipIndex);
    var verticalIndex = VERTICAL_RADIUS_ORDER.indexOf(clipIndex);
    var length = clipPoses.length;
    addRadiusPos(clipPoses, poses, 8, horizontalIndex, verticalIndex, distX, distY, poses[4][0], poses[4][1], poses[0][0], poses[0][1]);

    if (length === clipPoses.length) {
      return;
    }
  } else {
    return;
  }

  var clipStyles = getClipStyles(moveable, clipPath, poses);
  triggerEvent(moveable, "onClip", fillParams(moveable, e, {
    clipEventType: "added",
    clipType: clipType,
    poses: poses,
    clipStyles: clipStyles,
    clipStyle: "".concat(clipType, "(").concat(clipStyles.join(splitter), ")"),
    distX: 0,
    distY: 0
  }));
}

function removeClipPath(moveable, e) {
  var _a = e.datas,
      clipPath = _a.clipPath,
      clipIndex = _a.clipIndex;
  var _b = clipPath,
      clipType = _b.type,
      clipPoses = _b.poses,
      splitter = _b.splitter;
  var poses = clipPoses.map(function (pos) {
    return pos.pos;
  });
  var length = poses.length;

  if (clipType === "polygon") {
    clipPoses.splice(clipIndex, 1);
    poses.splice(clipIndex, 1);
  } else if (clipType === "inset") {
    if (clipIndex < 8) {
      return;
    }

    removeRadiusPos(clipPoses, poses, clipIndex, 8, length);

    if (length === clipPoses.length) {
      return;
    }
  } else {
    return;
  }

  var clipStyles = getClipStyles(moveable, clipPath, poses);
  triggerEvent(moveable, "onClip", fillParams(moveable, e, {
    clipEventType: "removed",
    clipType: clipType,
    poses: poses,
    clipStyles: clipStyles,
    clipStyle: "".concat(clipType, "(").concat(clipStyles.join(splitter), ")"),
    distX: 0,
    distY: 0
  }));
}
/**
 * @namespace Moveable.Clippable
 * @description Whether to clip the target.
 */


var Clippable = {
  name: "clippable",
  props: {
    clippable: Boolean,
    defaultClipPath: String,
    customClipPath: String,
    keepRatio: Boolean,
    clipRelative: Boolean,
    clipArea: Boolean,
    dragWithClip: Boolean,
    clipTargetBounds: Boolean,
    clipVerticalGuidelines: Array,
    clipHorizontalGuidelines: Array,
    clipSnapThreshold: Boolean
  },
  events: {
    onClipStart: "clipStart",
    onClip: "clip",
    onClipEnd: "clipEnd"
  },
  css: [".control.clip-control {\n    background: #6d6;\n    cursor: pointer;\n}\n.control.clip-control.clip-radius {\n    background: #d66;\n}\n.line.clip-line {\n    background: #6e6;\n    cursor: move;\n    z-index: 1;\n}\n.clip-area {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n.clip-ellipse {\n    position: absolute;\n    cursor: move;\n    border: 1px solid #6d6;\n    border: var(--zoompx) solid #6d6;\n    border-radius: 50%;\n    transform-origin: 0px 0px;\n}", ":host {\n    --bounds-color: #d66;\n}", ".guideline {\n    pointer-events: none;\n    z-index: 2;\n}", ".line.guideline.bounds {\n    background: #d66;\n    background: var(--bounds-color);\n}"],
  render: function (moveable, React) {
    var _a = moveable.props,
        customClipPath = _a.customClipPath,
        defaultClipPath = _a.defaultClipPath,
        clipArea = _a.clipArea,
        zoom = _a.zoom;
    var _b = moveable.state,
        target = _b.target,
        width = _b.width,
        height = _b.height,
        allMatrix = _b.allMatrix,
        is3d = _b.is3d,
        left = _b.left,
        top = _b.top,
        pos1 = _b.pos1,
        pos2 = _b.pos2,
        pos3 = _b.pos3,
        pos4 = _b.pos4,
        clipPathState = _b.clipPathState,
        snapBoundInfos = _b.snapBoundInfos,
        rotationRad = _b.rotation;

    if (!target) {
      return [];
    }

    var clipPath = getClipPath(target, width, height, defaultClipPath || "inset", clipPathState || customClipPath);

    if (!clipPath) {
      return [];
    }

    var n = is3d ? 4 : 3;
    var type = clipPath.type;
    var clipPoses = clipPath.poses;
    var poses = clipPoses.map(function (pos) {
      // return [x, y];
      var calculatedPos = calculatePosition(allMatrix, pos.pos, n);
      return [calculatedPos[0] - left, calculatedPos[1] - top];
    });
    var controls = [];
    var lines = [];
    var isRect = type === "rect";
    var isInset = type === "inset";
    var isPolygon = type === "polygon";

    if (isRect || isInset || isPolygon) {
      var linePoses_1 = isInset ? poses.slice(0, 8) : poses;
      lines = linePoses_1.map(function (to, i) {
        var from = i === 0 ? linePoses_1[linePoses_1.length - 1] : linePoses_1[i - 1];
        var rad = getRad(from, to);
        var dist = getDiagonalSize(from, to);
        return React.createElement("div", {
          key: "clipLine".concat(i),
          className: prefix("line", "clip-line", "snap-control"),
          "data-clip-index": i,
          style: {
            width: "".concat(dist, "px"),
            transform: "translate(".concat(from[0], "px, ").concat(from[1], "px) rotate(").concat(rad, "rad) scaleY(").concat(zoom, ")")
          }
        });
      });
    }

    controls = poses.map(function (pos, i) {
      return React.createElement("div", {
        key: "clipControl".concat(i),
        className: prefix("control", "clip-control", "snap-control"),
        "data-clip-index": i,
        style: {
          transform: "translate(".concat(pos[0], "px, ").concat(pos[1], "px) rotate(").concat(rotationRad, "rad) scale(").concat(zoom, ")")
        }
      });
    });

    if (isInset) {
      controls.push.apply(controls, poses.slice(8).map(function (pos, i) {
        return React.createElement("div", {
          key: "clipRadiusControl".concat(i),
          className: prefix("control", "clip-control", "clip-radius", "snap-control"),
          "data-clip-index": 8 + i,
          style: {
            transform: "translate(".concat(pos[0], "px, ").concat(pos[1], "px) rotate(").concat(rotationRad, "rad) scale(").concat(zoom, ")")
          }
        });
      }));
    }

    if (type === "circle" || type === "ellipse") {
      var clipLeft = clipPath.left,
          clipTop = clipPath.top,
          radiusX = clipPath.radiusX,
          radiusY = clipPath.radiusY;

      var _c = minus(calculatePosition(allMatrix, [clipLeft, clipTop], n), calculatePosition(allMatrix, [0, 0], n)),
          distLeft = _c[0],
          distTop = _c[1];

      var ellipseClipPath = "none";

      if (!clipArea) {
        var piece = Math.max(10, radiusX / 5, radiusY / 5);
        var areaPoses = [];

        for (var i = 0; i <= piece; ++i) {
          var rad = Math.PI * 2 / piece * i;
          areaPoses.push([radiusX + (radiusX - zoom) * Math.cos(rad), radiusY + (radiusY - zoom) * Math.sin(rad)]);
        }

        areaPoses.push([radiusX, -2]);
        areaPoses.push([-2, -2]);
        areaPoses.push([-2, radiusY * 2 + 2]);
        areaPoses.push([radiusX * 2 + 2, radiusY * 2 + 2]);
        areaPoses.push([radiusX * 2 + 2, -2]);
        areaPoses.push([radiusX, -2]);
        ellipseClipPath = "polygon(".concat(areaPoses.map(function (pos) {
          return "".concat(pos[0], "px ").concat(pos[1], "px");
        }).join(", "), ")");
      }

      controls.push(React.createElement("div", {
        key: "clipEllipse",
        className: prefix("clip-ellipse", "snap-control"),
        style: {
          width: "".concat(radiusX * 2, "px"),
          height: "".concat(radiusY * 2, "px"),
          clipPath: ellipseClipPath,
          transform: "translate(".concat(-left + distLeft, "px, ").concat(-top + distTop, "px) ").concat(makeMatrixCSS(allMatrix))
        }
      }));
    }

    if (clipArea) {
      var _d = moveable_esm_getRect(__spreadArray([pos1, pos2, pos3, pos4], poses, true)),
          allWidth = _d.width,
          allHeight = _d.height,
          allLeft_1 = _d.left,
          allTop_1 = _d.top;

      if (isPolygon || isRect || isInset) {
        var areaPoses = isInset ? poses.slice(0, 8) : poses;
        controls.push(React.createElement("div", {
          key: "clipArea",
          className: prefix("clip-area", "snap-control"),
          style: {
            width: "".concat(allWidth, "px"),
            height: "".concat(allHeight, "px"),
            transform: "translate(".concat(allLeft_1, "px, ").concat(allTop_1, "px)"),
            clipPath: "polygon(".concat(areaPoses.map(function (pos) {
              return "".concat(pos[0] - allLeft_1, "px ").concat(pos[1] - allTop_1, "px");
            }).join(", "), ")")
          }
        }));
      }
    }

    if (snapBoundInfos) {
      ["vertical", "horizontal"].forEach(function (directionType) {
        var info = snapBoundInfos[directionType];
        var isHorizontal = directionType === "horizontal";

        if (info.isSnap) {
          lines.push.apply(lines, info.snap.posInfos.map(function (_a, i) {
            var pos = _a.pos;
            var snapPos1 = minus(calculatePosition(allMatrix, isHorizontal ? [0, pos] : [pos, 0], n), [left, top]);
            var snapPos2 = minus(calculatePosition(allMatrix, isHorizontal ? [width, pos] : [pos, height], n), [left, top]);
            return renderLine(React, "", snapPos1, snapPos2, zoom, "clip".concat(directionType, "snap").concat(i), "guideline");
          }));
        }

        if (info.isBound) {
          lines.push.apply(lines, info.bounds.map(function (_a, i) {
            var pos = _a.pos;
            var snapPos1 = minus(calculatePosition(allMatrix, isHorizontal ? [0, pos] : [pos, 0], n), [left, top]);
            var snapPos2 = minus(calculatePosition(allMatrix, isHorizontal ? [width, pos] : [pos, height], n), [left, top]);
            return renderLine(React, "", snapPos1, snapPos2, zoom, "clip".concat(directionType, "bounds").concat(i), "guideline", "bounds", "bold");
          }));
        }
      });
    }

    return __spreadArray(__spreadArray([], controls, true), lines, true);
  },
  dragControlCondition: function (moveable, e) {
    return e.inputEvent && (e.inputEvent.target.getAttribute("class") || "").indexOf("clip") > -1;
  },
  dragStart: function (moveable, e) {
    var props = moveable.props;
    var _a = props.dragWithClip,
        dragWithClip = _a === void 0 ? true : _a;

    if (dragWithClip) {
      return false;
    }

    return this.dragControlStart(moveable, e);
  },
  drag: function (moveable, e) {
    return this.dragControl(moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
      isDragTarget: true
    }));
  },
  dragEnd: function (moveable, e) {
    return this.dragControlEnd(moveable, e);
  },
  dragControlStart: function (moveable, e) {
    var state = moveable.state;
    var _a = moveable.props,
        defaultClipPath = _a.defaultClipPath,
        customClipPath = _a.customClipPath;
    var target = state.target,
        width = state.width,
        height = state.height;
    var inputTarget = e.inputEvent ? e.inputEvent.target : null;
    var className = inputTarget && inputTarget.getAttribute("class") || "";
    var datas = e.datas;
    var clipPath = getClipPath(target, width, height, defaultClipPath || "inset", customClipPath);

    if (!clipPath) {
      return false;
    }

    var clipText = clipPath.clipText,
        type = clipPath.type,
        poses = clipPath.poses;
    var result = triggerEvent(moveable, "onClipStart", fillParams(moveable, e, {
      clipType: type,
      clipStyle: clipText,
      poses: poses.map(function (pos) {
        return pos.pos;
      })
    }));

    if (result === false) {
      datas.isClipStart = false;
      return false;
    }

    datas.isControl = className && className.indexOf("clip-control") > -1;
    datas.isLine = className.indexOf("clip-line") > -1;
    datas.isArea = className.indexOf("clip-area") > -1 || className.indexOf("clip-ellipse") > -1;
    datas.clipIndex = inputTarget ? parseInt(inputTarget.getAttribute("data-clip-index"), 10) : -1;
    datas.clipPath = clipPath;
    datas.isClipStart = true;
    state.clipPathState = clipText;
    setDragStart(moveable, e);
    return true;
  },
  dragControl: function (moveable, e) {
    var _a;

    var datas = e.datas,
        originalDatas = e.originalDatas,
        isDragTarget = e.isDragTarget;

    if (!datas.isClipStart) {
      return false;
    }

    var _b = datas,
        isControl = _b.isControl,
        isLine = _b.isLine,
        isArea = _b.isArea,
        clipIndex = _b.clipIndex,
        clipPath = _b.clipPath;

    if (!clipPath) {
      return false;
    }

    var keepRatio = moveable.props.keepRatio;
    var distX = 0;
    var distY = 0;
    var originalDraggable = originalDatas.draggable;
    var originalDist = getDragDist(e);

    if (isDragTarget && originalDraggable) {
      _a = originalDraggable.prevBeforeDist, distX = _a[0], distY = _a[1];
    } else {
      distX = originalDist[0], distY = originalDist[1];
    }

    var firstDist = [distX, distY];
    var props = moveable.props;
    var state = moveable.state;
    var width = state.width,
        height = state.height;
    var isDragWithTarget = !isArea && !isControl && !isLine;
    var clipType = clipPath.type,
        clipPoses = clipPath.poses,
        splitter = clipPath.splitter;
    var poses = clipPoses.map(function (pos) {
      return pos.pos;
    });

    if (isDragWithTarget) {
      distX = -distX;
      distY = -distY;
    }

    var isAll = !isControl || clipPoses[clipIndex].direction === "nesw";
    var isRect = clipType === "inset" || clipType === "rect";
    var dists = clipPoses.map(function () {
      return [0, 0];
    });

    if (isControl && !isAll) {
      var _c = clipPoses[clipIndex],
          horizontal = _c.horizontal,
          vertical = _c.vertical;
      var dist = [distX * Math.abs(horizontal), distY * Math.abs(vertical)];
      dists = moveControlPos(clipPoses, clipIndex, dist, isRect, keepRatio);
    } else if (isAll) {
      dists = poses.map(function () {
        return [distX, distY];
      });
    }

    var nextPoses = poses.map(function (pos, i) {
      return plus(pos, dists[i]);
    });

    var guidePoses = __spreadArray([], nextPoses, true);

    state.snapBoundInfos = null;
    var isCircle = clipPath.type === "circle";
    var isEllipse = clipPath.type === "ellipse";

    if (isCircle || isEllipse) {
      var guideRect = moveable_esm_getRect(nextPoses);
      var ry = Math.abs(guideRect.bottom - guideRect.top);
      var rx = Math.abs(isEllipse ? guideRect.right - guideRect.left : ry);
      var bottom = nextPoses[0][1] + ry;
      var left = nextPoses[0][0] - rx;
      var right = nextPoses[0][0] + rx; // right

      if (isCircle) {
        guidePoses.push([right, guideRect.bottom]);
        dists.push([1, 0]);
      } // bottom


      guidePoses.push([guideRect.left, bottom]);
      dists.push([0, 1]); // left

      guidePoses.push([left, guideRect.bottom]);
      dists.push([1, 0]);
    }

    var guidelines = getDefaultGuidelines((props.clipHorizontalGuidelines || []).map(function (v) {
      return convertUnitSize("".concat(v), height);
    }), (props.clipVerticalGuidelines || []).map(function (v) {
      return convertUnitSize("".concat(v), width);
    }), width, height);
    var guideXPoses = [];
    var guideYPoses = [];

    if (isCircle || isEllipse) {
      guideXPoses = [guidePoses[4][0], guidePoses[2][0]];
      guideYPoses = [guidePoses[1][1], guidePoses[3][1]];
    } else if (isRect) {
      var rectPoses = [guidePoses[0], guidePoses[2], guidePoses[4], guidePoses[6]];
      var rectDists_1 = [dists[0], dists[2], dists[4], dists[6]];
      guideXPoses = rectPoses.filter(function (_, i) {
        return rectDists_1[i][0];
      }).map(function (pos) {
        return pos[0];
      });
      guideYPoses = rectPoses.filter(function (_, i) {
        return rectDists_1[i][1];
      }).map(function (pos) {
        return pos[1];
      });
    } else {
      guideXPoses = guidePoses.filter(function (_, i) {
        return dists[i][0];
      }).map(function (pos) {
        return pos[0];
      });
      guideYPoses = guidePoses.filter(function (_, i) {
        return dists[i][1];
      }).map(function (pos) {
        return pos[1];
      });
    }

    var boundDelta = [0, 0];

    var _d = checkSnapBounds(guidelines, props.clipTargetBounds && {
      left: 0,
      top: 0,
      right: width,
      bottom: height
    }, guideXPoses, guideYPoses, 5),
        horizontalSnapInfo = _d.horizontal,
        verticalSnapInfo = _d.vertical;

    var snapOffsetY = horizontalSnapInfo.offset;
    var snapOffsetX = verticalSnapInfo.offset;

    if (horizontalSnapInfo.isBound) {
      boundDelta[1] += snapOffsetY;
    }

    if (verticalSnapInfo.isBound) {
      boundDelta[0] += snapOffsetX;
    }

    if ((isEllipse || isCircle) && dists[0][0] === 0 && dists[0][1] === 0) {
      var guideRect = moveable_esm_getRect(nextPoses);
      var cy = guideRect.bottom - guideRect.top;
      var cx = isEllipse ? guideRect.right - guideRect.left : cy;
      var distSnapX = verticalSnapInfo.isBound ? Math.abs(snapOffsetX) : verticalSnapInfo.snapIndex === 0 ? -snapOffsetX : snapOffsetX;
      var distSnapY = horizontalSnapInfo.isBound ? Math.abs(snapOffsetY) : horizontalSnapInfo.snapIndex === 0 ? -snapOffsetY : snapOffsetY;
      cx -= distSnapX;
      cy -= distSnapY;

      if (isCircle) {
        cy = checkSnapBoundPriority(verticalSnapInfo, horizontalSnapInfo) > 0 ? cy : cx;
        cx = cy;
      }

      var center = guidePoses[0];
      guidePoses[1][1] = center[1] - cy;
      guidePoses[2][0] = center[0] + cx;
      guidePoses[3][1] = center[1] + cy;
      guidePoses[4][0] = center[0] - cx;
    } else if (isRect && keepRatio && isControl) {
      var _e = getControlSize(clipPoses),
          width_1 = _e[0],
          height_1 = _e[1];

      var ratio = width_1 && height_1 ? width_1 / height_1 : 0;
      var clipPose = clipPoses[clipIndex];
      var direction = clipPose.direction || "";
      var top = guidePoses[1][1];
      var bottom = guidePoses[5][1];
      var left = guidePoses[7][0];
      var right = guidePoses[3][0];

      if (snapOffsetY <= snapOffsetX) {
        snapOffsetY = snapOffsetX / ratio;
      } else {
        snapOffsetX = snapOffsetY * ratio;
      }

      if (direction.indexOf("w") > -1) {
        left -= snapOffsetX;
      } else if (direction.indexOf("e") > -1) {
        right -= snapOffsetX;
      } else {
        left += snapOffsetX / 2;
        right -= snapOffsetX / 2;
      }

      if (direction.indexOf("n") > -1) {
        top -= snapOffsetY;
      } else if (direction.indexOf("s") > -1) {
        bottom -= snapOffsetY;
      } else {
        top += snapOffsetY / 2;
        bottom -= snapOffsetY / 2;
      }

      var nextControlPoses_2 = getRectPoses(top, right, bottom, left);
      guidePoses.forEach(function (pos, i) {
        var _a;

        _a = nextControlPoses_2[i].pos, pos[0] = _a[0], pos[1] = _a[1];
      });
    } else {
      guidePoses.forEach(function (pos, j) {
        var dist = dists[j];

        if (dist[0]) {
          pos[0] -= snapOffsetX;
        }

        if (dist[1]) {
          pos[1] -= snapOffsetY;
        }
      });
    }

    var nextClipStyles = getClipStyles(moveable, clipPath, nextPoses);
    var clipStyle = "".concat(clipType, "(").concat(nextClipStyles.join(splitter), ")");
    state.clipPathState = clipStyle;

    if (isCircle || isEllipse) {
      guideXPoses = [guidePoses[4][0], guidePoses[2][0]];
      guideYPoses = [guidePoses[1][1], guidePoses[3][1]];
    } else if (isRect) {
      var rectPoses = [guidePoses[0], guidePoses[2], guidePoses[4], guidePoses[6]];
      guideXPoses = rectPoses.map(function (pos) {
        return pos[0];
      });
      guideYPoses = rectPoses.map(function (pos) {
        return pos[1];
      });
    } else {
      guideXPoses = guidePoses.map(function (pos) {
        return pos[0];
      });
      guideYPoses = guidePoses.map(function (pos) {
        return pos[1];
      });
    }

    state.snapBoundInfos = checkSnapBounds(guidelines, props.clipTargetBounds && {
      left: 0,
      top: 0,
      right: width,
      bottom: height
    }, guideXPoses, guideYPoses, 1);

    if (originalDraggable) {
      var is3d = state.is3d,
          allMatrix = state.allMatrix;
      var n = is3d ? 4 : 3;
      var dragDist = boundDelta;

      if (isDragTarget) {
        dragDist = [firstDist[0] + boundDelta[0] - originalDist[0], firstDist[1] + boundDelta[1] - originalDist[1]];
      }

      originalDraggable.deltaOffset = multiply(allMatrix, [dragDist[0], dragDist[1], 0, 0], n);
    }

    triggerEvent(moveable, "onClip", fillParams(moveable, e, {
      clipEventType: "changed",
      clipType: clipType,
      poses: nextPoses,
      clipStyle: clipStyle,
      clipStyles: nextClipStyles,
      distX: distX,
      distY: distY
    }));
    return true;
  },
  dragControlEnd: function (moveable, e) {
    this.unset(moveable);
    var isDrag = e.isDrag,
        datas = e.datas,
        isDouble = e.isDouble;
    var isLine = datas.isLine,
        isClipStart = datas.isClipStart,
        isControl = datas.isControl;

    if (!isClipStart) {
      return false;
    }

    triggerEvent(moveable, "onClipEnd", fillEndParams(moveable, e, {}));

    if (isDouble) {
      if (isControl) {
        removeClipPath(moveable, e);
      } else if (isLine) {
        // add
        addClipPath(moveable, e);
      }
    }

    return isDouble || isDrag;
  },
  unset: function (moveable) {
    moveable.state.clipPathState = "";
    moveable.state.snapBoundInfos = null;
  }
};
/**
 * Whether to clip the target. (default: false)
 * @name Moveable.Clippable#clippable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 *  If clippath is not set, the default value can be set. (defaultClipPath < style < customClipPath < dragging clipPath)
 * @name Moveable.Clippable#defaultClipPath
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * % Can be used instead of the absolute px (`rect` not possible) (default: false)
 * @name Moveable.Clippable#clipRelative
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * You can force the custom clipPath. (defaultClipPath < style < customClipPath < dragging clipPath)
 * @name Moveable.Clippable#customClipPath
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * When dragging the target, the clip also moves. (default: true)
 * @name Moveable.Clippable#dragWithClip
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * You can drag the clip by setting clipArea. (default: false)
 * @name Moveable.Clippable#clipArea
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
* Whether the clip is bound to the target. (default: false)
* @name Moveable.Clippable#clipTargetBounds
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     clippable: true,
*     defaultClipPath: "inset",
*     customClipPath: "",
*     clipRelative: false,
*     clipArea: false,
*     dragWithClip: true,
*     clipTargetBounds: true,
* });
* moveable.on("clipStart", e => {
*     console.log(e);
* }).on("clip", e => {
*     if (e.clipType === "rect") {
*         e.target.style.clip = e.clipStyle;
*     } else {
*         e.target.style.clipPath = e.clipStyle;
*     }
* }).on("clipEnd", e => {
*     console.log(e);
* });
*/

/**
* Add clip guidelines in the vertical direction. (default: [])
* @name Moveable.Clippable#clipVerticalGuidelines
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     clippable: true,
*     defaultClipPath: "inset",
*     customClipPath: "",
*     clipRelative: false,
*     clipArea: false,
*     dragWithClip: true,
*     clipVerticalGuidelines: [0, 100, 200],
*     clipHorizontalGuidelines: [0, 100, 200],
*     clipSnapThreshold: 5,
* });
*/

/**
* Add clip guidelines in the horizontal direction. (default: [])
* @name Moveable.Clippable#clipHorizontalGuidelines
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     clippable: true,
*     defaultClipPath: "inset",
*     customClipPath: "",
*     clipRelative: false,
*     clipArea: false,
*     dragWithClip: true,
*     clipVerticalGuidelines: [0, 100, 200],
*     clipHorizontalGuidelines: [0, 100, 200],
*     clipSnapThreshold: 5,
* });
*/

/**
* istance value that can snap to clip guidelines. (default: 5)
* @name Moveable.Clippable#clipSnapThreshold
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     clippable: true,
*     defaultClipPath: "inset",
*     customClipPath: "",
*     clipRelative: false,
*     clipArea: false,
*     dragWithClip: true,
*     clipVerticalGuidelines: [0, 100, 200],
*     clipHorizontalGuidelines: [0, 100, 200],
*     clipSnapThreshold: 5,
* });
*/

/**
 * When drag start the clip area or controls, the `clipStart` event is called.
 * @memberof Moveable.Clippable
 * @event clipStart
 * @param {Moveable.Clippable.OnClipStart} - Parameters for the `clipStart` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * When drag the clip area or controls, the `clip` event is called.
 * @memberof Moveable.Clippable
 * @event clip
 * @param {Moveable.Clippable.OnClip} - Parameters for the `clip` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * When drag end the clip area or controls, the `clipEnd` event is called.
 * @memberof Moveable.Clippable
 * @event clipEnd
 * @param {Moveable.Clippable.OnClipEnd} - Parameters for the `clipEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     clippable: true,
 *     defaultClipPath: "inset",
 *     customClipPath: "",
 *     clipRelative: false,
 *     clipArea: false,
 *     dragWithClip: true,
 * });
 * moveable.on("clipStart", e => {
 *     console.log(e);
 * }).on("clip", e => {
 *     if (e.clipType === "rect") {
 *         e.target.style.clip = e.clipStyle;
 *     } else {
 *         e.target.style.clipPath = e.clipStyle;
 *     }
 * }).on("clipEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * @namespace OriginDraggable
 * @memberof Moveable
 * @description Whether to drag origin (default: false)
 */

var OriginDraggable = {
  name: "originDraggable",
  props: {
    originDraggable: Boolean,
    originRelative: Boolean
  },
  events: {
    onDragOriginStart: "dragOriginStart",
    onDragOrigin: "dragOrigin",
    onDragOriginEnd: "dragOriginEnd"
  },
  css: [":host[data-able-origindraggable] .control.origin {\n    pointer-events: auto;\n}"],
  dragControlCondition: function (_, e) {
    if (e.isRequest) {
      return e.requestAble === "originDraggable";
    }

    return hasClass(e.inputEvent.target, prefix("origin"));
  },
  dragControlStart: function (moveable, e) {
    var datas = e.datas;
    setDragStart(moveable, e);
    var params = fillParams(moveable, e, {
      dragStart: moveable_esm_Draggable.dragStart(moveable, new CustomGesto().dragStart([0, 0], e))
    });
    var result = triggerEvent(moveable, "onDragOriginStart", params);
    datas.startOrigin = moveable.state.transformOrigin;
    datas.startTargetOrigin = moveable.state.targetOrigin;
    datas.prevOrigin = [0, 0];
    datas.isDragOrigin = true;

    if (result === false) {
      datas.isDragOrigin = false;
      return false;
    }

    return params;
  },
  dragControl: function (moveable, e) {
    var datas = e.datas,
        isPinch = e.isPinch,
        isRequest = e.isRequest;

    if (!datas.isDragOrigin) {
      return false;
    }

    var _a = getDragDist(e),
        distX = _a[0],
        distY = _a[1];

    var state = moveable.state;
    var width = state.width,
        height = state.height,
        offsetMatrix = state.offsetMatrix,
        targetMatrix = state.targetMatrix,
        is3d = state.is3d;
    var _b = moveable.props.originRelative,
        originRelative = _b === void 0 ? true : _b;
    var n = is3d ? 4 : 3;
    var dist = [distX, distY];

    if (isRequest) {
      var distOrigin = e.distOrigin;

      if (distOrigin[0] || distOrigin[1]) {
        dist = distOrigin;
      }
    }

    var origin = plus(datas.startOrigin, dist);
    var targetOrigin = plus(datas.startTargetOrigin, dist);
    var delta = minus(dist, datas.prevOrigin);
    var nextMatrix = getNextMatrix(offsetMatrix, targetMatrix, origin, n);
    var rect = moveable.getRect();
    var nextRect = moveable_esm_getRect(calculatePoses(nextMatrix, width, height, n));
    var dragDelta = [rect.left - nextRect.left, rect.top - nextRect.top];
    datas.prevOrigin = dist;
    var transformOrigin = [convertCSSSize(targetOrigin[0], width, originRelative), convertCSSSize(targetOrigin[1], height, originRelative)].join(" ");
    var params = fillParams(moveable, e, {
      width: width,
      height: height,
      origin: origin,
      dist: dist,
      delta: delta,
      transformOrigin: transformOrigin,
      drag: moveable_esm_Draggable.drag(moveable, setCustomDrag(e, moveable.state, dragDelta, !!isPinch, false))
    });
    triggerEvent(moveable, "onDragOrigin", params);
    return params;
  },
  dragControlEnd: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isDragOrigin) {
      return false;
    }

    triggerEvent(moveable, "onDragOriginEnd", fillEndParams(moveable, e, {}));
    return true;
  },
  dragGroupControlCondition: function (moveable, e) {
    return this.dragControlCondition(moveable, e);
  },
  dragGroupControlStart: function (moveable, e) {
    var params = this.dragControlStart(moveable, e);

    if (!params) {
      return false;
    }

    return true;
  },
  dragGroupControl: function (moveable, e) {
    var params = this.dragControl(moveable, e);

    if (!params) {
      return false;
    }

    moveable.transformOrigin = params.transformOrigin;
    return true;
  },

  /**
  * @method Moveable.OriginDraggable#request
  * @param {object} e - the OriginDraggable's request parameter
  * @param {number} [e.x] - x position
  * @param {number} [e.y] - y position
  * @param {number} [e.deltaX] - x number to move
  * @param {number} [e.deltaY] - y number to move
  * @param {array} [e.deltaOrigin] - left, top number to move transform-origin
  * @param {array} [e.origin] - transform-origin position
  * @param {number} [e.isInstant] - Whether to execute the request instantly
  * @return {Moveable.Requester} Moveable Requester
  * @example
   * // Instantly Request (requestStart - request - requestEnd)
  * // Use Relative Value
  * moveable.request("originDraggable", { deltaX: 10, deltaY: 10 }, true);
  * // Use Absolute Value
  * moveable.request("originDraggable", { x: 200, y: 100 }, true);
  * // Use Transform Value
  * moveable.request("originDraggable", { deltaOrigin: [10, 0] }, true);
  * moveable.request("originDraggable", { origin: [100, 0] }, true);
  * // requestStart
  * const requester = moveable.request("originDraggable");
  *
  * // request
  * // Use Relative Value
  * requester.request({ deltaX: 10, deltaY: 10 });
  * requester.request({ deltaX: 10, deltaY: 10 });
  * requester.request({ deltaX: 10, deltaY: 10 });
  * // Use Absolute Value
  * moveable.request("originDraggable", { x: 200, y: 100 });
  * moveable.request("originDraggable", { x: 220, y: 100 });
  * moveable.request("originDraggable", { x: 240, y: 100 });
  *
  * // requestEnd
  * requester.requestEnd();
  */
  request: function (moveable) {
    var datas = {};
    var rect = moveable.getRect();
    var distX = 0;
    var distY = 0;
    var transformOrigin = rect.transformOrigin;
    var distOrigin = [0, 0];
    return {
      isControl: true,
      requestStart: function () {
        return {
          datas: datas
        };
      },
      request: function (e) {
        if ("deltaOrigin" in e) {
          distOrigin[0] += e.deltaOrigin[0];
          distOrigin[1] += e.deltaOrigin[1];
        } else if ("origin" in e) {
          distOrigin[0] = e.origin[0] - transformOrigin[0];
          distOrigin[1] = e.origin[1] - transformOrigin[1];
        } else {
          if ("x" in e) {
            distX = e.x - rect.left;
          } else if ("deltaX" in e) {
            distX += e.deltaX;
          }

          if ("y" in e) {
            distY = e.y - rect.top;
          } else if ("deltaY" in e) {
            distY += e.deltaY;
          }
        }

        return {
          datas: datas,
          distX: distX,
          distY: distY,
          distOrigin: distOrigin
        };
      },
      requestEnd: function () {
        return {
          datas: datas,
          isDrag: true
        };
      }
    };
  }
};
/**
 * Whether to drag origin (default: false)
 * @name Moveable.OriginDraggable#originDraggable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     originDraggable: true,
 * });
 * let translate = [0, 0];
 * moveable.on("dragOriginStart", e => {
 *     e.dragStart && e.dragStart.set(translate);
 * }).on("dragOrigin", e => {
 *     translate = e.drag.beforeTranslate;
 *     e.target.style.cssText
 *         = `transform-origin: ${e.transformOrigin};`
 *         + `transform: translate(${translate[0]}px, ${translate[1]}px)`;
 * }).on("dragOriginEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * % Can be used instead of the absolute px (default: true)
 * @name Moveable.OriginDraggable#originRelative
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     originDraggable: true,
 *     originRelative: false,
 * });
 * moveable.originRelative = true;
 */

/**
* When drag start the origin, the `dragOriginStart` event is called.
* @memberof Moveable.OriginDraggable
* @event dragOriginStart
* @param {Moveable.OriginDraggable.OnDragOriginStart} - Parameters for the `dragOriginStart` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     originDraggable: true,
* });
* let translate = [0, 0];
* moveable.on("dragOriginStart", e => {
*     e.dragStart && e.dragStart.set(translate);
* }).on("dragOrigin", e => {
*     translate = e.drag.beforeTranslate;
*     e.target.style.cssText
*         = `transform-origin: ${e.transformOrigin};`
*         + `transform: translate(${translate[0]}px, ${translate[1]}px)`;
* }).on("dragOriginEnd", e => {
*     console.log(e);
* });
*/

/**
* When drag the origin, the `dragOrigin` event is called.
* @memberof Moveable.OriginDraggable
* @event dragOrigin
* @param {Moveable.OriginDraggable.OnDragOrigin} - Parameters for the `dragOrigin` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     originDraggable: true,
* });
* let translate = [0, 0];
* moveable.on("dragOriginStart", e => {
*     e.dragStart && e.dragStart.set(translate);
* }).on("dragOrigin", e => {
*     translate = e.drag.beforeTranslate;
*     e.target.style.cssText
*         = `transform-origin: ${e.transformOrigin};`
*         + `transform: translate(${translate[0]}px, ${translate[1]}px)`;
* }).on("dragOriginEnd", e => {
*     console.log(e);
* });
*/

/**
* When drag end the origin, the `dragOriginEnd` event is called.
* @memberof Moveable.OriginDraggable
* @event dragOriginEnd
* @param {Moveable.OriginDraggable.OnDragOriginEnd} - Parameters for the `dragOriginEnd` event
* @example
* import Moveable from "moveable";
*
* const moveable = new Moveable(document.body, {
*     originDraggable: true,
* });
* let translate = [0, 0];
* moveable.on("dragOriginStart", e => {
*     e.dragStart && e.dragStart.set(translate);
* }).on("dragOrigin", e => {
*     translate = e.drag.beforeTranslate;
*     e.target.style.cssText
*         = `transform-origin: ${e.transformOrigin};`
*         + `transform: translate(${translate[0]}px, ${translate[1]}px)`;
* }).on("dragOriginEnd", e => {
*     console.log(e);
* });
*/

function addBorderRadius(controlPoses, poses, lineIndex, distX, distY, width, height) {
  var _a = splitRadiusPoses(controlPoses),
      horizontals = _a.horizontals,
      verticals = _a.verticals;

  var horizontalsLength = horizontals.length;
  var verticalsLength = verticals.length; // lineIndex
  // 0 top
  // 1 right
  // 2 left
  // 3 bottom
  // 0 top - left
  // 1 top - right
  // 2 bottom - right
  // 3 bottom - left
  // 0 left - top
  // 1 right - top
  // 2 right - bottom
  // 3 left - bottom

  var horizontalIndex = -1;
  var verticalIndex = -1;

  if (lineIndex === 0) {
    if (horizontalsLength === 0) {
      horizontalIndex = 0;
    } else if (horizontalsLength === 1) {
      horizontalIndex = 1;
    }
  } else if (lineIndex === 3) {
    if (horizontalsLength <= 2) {
      horizontalIndex = 2;
    } else if (horizontalsLength <= 3) {
      horizontalIndex = 3;
    }
  }

  if (lineIndex === 2) {
    if (verticalsLength === 0) {
      verticalIndex = 0;
    } else if (verticalsLength < 4) {
      verticalIndex = 3;
    }
  } else if (lineIndex === 1) {
    if (verticalsLength <= 1) {
      verticalIndex = 1;
    } else if (verticalsLength <= 2) {
      verticalIndex = 2;
    }
  }

  addRadiusPos(controlPoses, poses, 0, horizontalIndex, verticalIndex, distX, distY, width, height);
}

function getBorderRadius(target, width, height, minCounts, state) {
  if (minCounts === void 0) {
    minCounts = [0, 0];
  }

  var borderRadius;
  var values = [];

  if (!state) {
    var style = moveable_esm_getComputedStyle(target);
    borderRadius = style && style.borderRadius || "";
  } else {
    borderRadius = state;
  }

  if (!borderRadius || !state && borderRadius === "0px") {
    values = [];
  } else {
    values = splitSpace(borderRadius);
  }

  return getRadiusValues(values, width, height, 0, 0, minCounts);
}

function triggerRoundEvent(moveable, e, dist, delta, controlPoses, nextPoses) {
  var state = moveable.state;
  var width = state.width,
      height = state.height;

  var _a = getRadiusStyles(nextPoses, controlPoses, moveable.props.roundRelative, width, height),
      raws = _a.raws,
      styles = _a.styles;

  var _b = splitRadiusPoses(controlPoses, raws),
      horizontals = _b.horizontals,
      verticals = _b.verticals;

  var borderRadius = styles.join(" ");
  state.borderRadiusState = borderRadius;
  triggerEvent(moveable, "onRound", fillParams(moveable, e, {
    horizontals: horizontals,
    verticals: verticals,
    borderRadius: borderRadius,
    width: width,
    height: height,
    delta: delta,
    dist: dist
  }));
}
/**
 * @namespace Moveable.Roundable
 * @description Whether to show and drag or double click border-radius
 */


var Roundable = {
  name: "roundable",
  props: {
    roundable: Boolean,
    roundRelative: Boolean,
    minRoundControls: Array,
    maxRoundControls: Array,
    roundClickable: Boolean
  },
  events: {
    onRoundStart: "roundStart",
    onRound: "round",
    onRoundEnd: "roundEnd"
  },
  css: [".control.border-radius {\n    background: #d66;\n    cursor: pointer;\n}", ":host[data-able-roundable] .line.direction {\n    cursor: pointer;\n}"],
  render: function (moveable, React) {
    var _a = moveable.state,
        target = _a.target,
        width = _a.width,
        height = _a.height,
        allMatrix = _a.allMatrix,
        is3d = _a.is3d,
        left = _a.left,
        top = _a.top,
        borderRadiusState = _a.borderRadiusState;
    var _b = moveable.props,
        _c = _b.minRoundControls,
        minRoundControls = _c === void 0 ? [0, 0] : _c,
        _d = _b.maxRoundControls,
        maxRoundControls = _d === void 0 ? [4, 4] : _d,
        zoom = _b.zoom;

    if (!target) {
      return null;
    }

    var n = is3d ? 4 : 3;
    var radiusValues = getBorderRadius(target, width, height, minRoundControls, borderRadiusState);

    if (!radiusValues) {
      return null;
    }

    var verticalCount = 0;
    var horizontalCount = 0;
    return radiusValues.map(function (v, i) {
      horizontalCount += Math.abs(v.horizontal);
      verticalCount += Math.abs(v.vertical);
      var pos = minus(calculatePosition(allMatrix, v.pos, n), [left, top]);
      var isDisplay = v.vertical ? verticalCount <= maxRoundControls[1] : horizontalCount <= maxRoundControls[0];
      return React.createElement("div", {
        key: "borderRadiusControl".concat(i),
        className: prefix("control", "border-radius"),
        "data-radius-index": i,
        style: {
          display: isDisplay ? "block" : "none",
          transform: "translate(".concat(pos[0], "px, ").concat(pos[1], "px) scale(").concat(zoom, ")")
        }
      });
    });
  },
  dragControlCondition: function (moveable, e) {
    if (!e.inputEvent || e.isRequest) {
      return false;
    }

    var className = e.inputEvent.target.getAttribute("class") || "";
    return className.indexOf("border-radius") > -1 || className.indexOf("moveable-line") > -1 && className.indexOf("moveable-direction") > -1;
  },
  dragControlStart: function (moveable, e) {
    var inputEvent = e.inputEvent,
        datas = e.datas;
    var inputTarget = inputEvent.target;
    var className = inputTarget.getAttribute("class") || "";
    var isControl = className.indexOf("border-radius") > -1;
    var isLine = className.indexOf("moveable-line") > -1 && className.indexOf("moveable-direction") > -1;
    var controlIndex = isControl ? parseInt(inputTarget.getAttribute("data-radius-index"), 10) : -1;
    var lineIndex = isLine ? parseInt(inputTarget.getAttribute("data-line-index"), 10) : -1;

    if (!isControl && !isLine) {
      return false;
    }

    var result = triggerEvent(moveable, "onRoundStart", fillParams(moveable, e, {}));

    if (result === false) {
      return false;
    }

    datas.lineIndex = lineIndex;
    datas.controlIndex = controlIndex;
    datas.isControl = isControl;
    datas.isLine = isLine;
    setDragStart(moveable, e);
    var _a = moveable.props,
        roundRelative = _a.roundRelative,
        _b = _a.minRoundControls,
        minRoundControls = _b === void 0 ? [0, 0] : _b;
    var state = moveable.state;
    var target = state.target,
        width = state.width,
        height = state.height;
    datas.isRound = true;
    datas.prevDist = [0, 0];
    var controlPoses = getBorderRadius(target, width, height, minRoundControls) || [];
    datas.controlPoses = controlPoses;
    state.borderRadiusState = getRadiusStyles(controlPoses.map(function (pos) {
      return pos.pos;
    }), controlPoses, roundRelative, width, height).styles.join(" ");
    return true;
  },
  dragControl: function (moveable, e) {
    var datas = e.datas;

    if (!datas.isRound || !datas.isControl || !datas.controlPoses.length) {
      return false;
    }

    var index = datas.controlIndex;
    var controlPoses = datas.controlPoses;

    var _a = getDragDist(e),
        distX = _a[0],
        distY = _a[1];

    var dist = [distX, distY];
    var delta = minus(dist, datas.prevDist);
    var _b = moveable.props.maxRoundControls,
        maxRoundControls = _b === void 0 ? [4, 4] : _b;
    var _c = moveable.state,
        width = _c.width,
        height = _c.height;
    var selectedControlPose = controlPoses[index];
    var selectedVertical = selectedControlPose.vertical;
    var selectedHorizontal = selectedControlPose.horizontal; // 0: [0, 1, 2, 3] maxCount === 1
    // 0: [0, 2] maxCount === 2
    // 1: [1, 3] maxCount === 2
    // 0: [0] maxCount === 3
    // 1: [1, 3] maxCount === 3

    var dists = controlPoses.map(function (pose) {
      var horizontal = pose.horizontal,
          vertical = pose.vertical;
      var poseDist = [horizontal * selectedHorizontal * dist[0], vertical * selectedVertical * dist[1]];

      if (horizontal) {
        if (maxRoundControls[0] === 1) {
          return poseDist;
        } else if (maxRoundControls[0] < 4 && horizontal !== selectedHorizontal) {
          return poseDist;
        }
      } else if (maxRoundControls[1] === 0) {
        poseDist[1] = vertical * selectedHorizontal * dist[0] / width * height;
        return poseDist;
      } else if (selectedVertical) {
        if (maxRoundControls[1] === 1) {
          return poseDist;
        } else if (maxRoundControls[1] < 4 && vertical !== selectedVertical) {
          return poseDist;
        }
      }

      return [0, 0];
    });
    dists[index] = dist;
    var nextPoses = controlPoses.map(function (pos, i) {
      return plus(pos.pos, dists[i]);
    });
    datas.prevDist = [distX, distY];
    triggerRoundEvent(moveable, e, dist, delta, controlPoses, nextPoses);
    return true;
  },
  dragControlEnd: function (moveable, e) {
    var state = moveable.state;
    state.borderRadiusState = "";
    var datas = e.datas,
        isDouble = e.isDouble;

    if (!datas.isRound) {
      return false;
    }

    var width = state.width,
        height = state.height;
    var isControl = datas.isControl,
        controlIndex = datas.controlIndex,
        isLine = datas.isLine,
        lineIndex = datas.lineIndex;
    var controlPoses = datas.controlPoses;
    var poses = controlPoses.map(function (pos) {
      return pos.pos;
    });
    var length = poses.length;
    var _a = moveable.props.roundClickable,
        roundClickable = _a === void 0 ? true : _a;

    if (isDouble && roundClickable) {
      if (isControl) {
        removeRadiusPos(controlPoses, poses, controlIndex, 0);
      } else if (isLine) {
        var _b = calculatePointerDist(moveable, e),
            distX = _b[0],
            distY = _b[1];

        addBorderRadius(controlPoses, poses, lineIndex, distX, distY, width, height);
      }

      if (length !== controlPoses.length) {
        triggerRoundEvent(moveable, e, [0, 0], [0, 0], controlPoses, poses);
      }
    }

    triggerEvent(moveable, "onRoundEnd", fillEndParams(moveable, e, {}));
    state.borderRadiusState = "";
    return true;
  },
  unset: function (moveable) {
    moveable.state.borderRadiusState = "";
  }
};
/**
 * Whether to show and drag or double click border-radius, (default: false)
 * @name Moveable.Roundable#roundable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 * });
 * moveable.on("roundStart", e => {
 *     console.log(e);
 * }).on("round", e => {
 *     e.target.style.borderRadius = e.borderRadius;
 * }).on("roundEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * % Can be used instead of the absolute px
 * @name Moveable.Roundable#roundRelative
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 * });
 * moveable.on("roundStart", e => {
 *     console.log(e);
 * }).on("round", e => {
 *     e.target.style.borderRadius = e.borderRadius;
 * }).on("roundEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * Minimum number of round controls. It moves in proportion by control. [horizontal, vertical] (default: [0, 0])
 * @name Moveable.Roundable#minRoundControls
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 *     minRoundControls: [0, 0],
 * });
 * moveable.maxRoundControls = [1, 0];
 */

/**
 * Maximum number of round controls. It moves in proportion by control. [horizontal, vertical] (default: [4, 4])
 * @name Moveable.Roundable#maxRoundControls
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 *     maxRoundControls: [4, 4],
 * });
 * moveable.maxRoundControls = [1, 0];
 */

/**
 * @property - Whether you can add/delete round controls by double-clicking a line or control. (default: true)
 * @name Moveable.Roundable#roundClickable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 *     roundClickable: true,
 * });
 * moveable.roundClickable = false;
 */

/**
 * When drag start the clip area or controls, the `roundStart` event is called.
 * @memberof Moveable.Roundable
 * @event roundStart
 * @param {Moveable.Roundable.OnRoundStart} - Parameters for the `roundStart` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 * });
 * moveable.on("roundStart", e => {
 *     console.log(e);
 * }).on("round", e => {
 *     e.target.style.borderRadius = e.borderRadius;
 * }).on("roundEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * When drag or double click the border area or controls, the `round` event is called.
 * @memberof Moveable.Roundable
 * @event round
 * @param {Moveable.Roundable.OnRound} - Parameters for the `round` event
 * @example
  * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 * });
 * moveable.on("roundStart", e => {
 *     console.log(e);
 * }).on("round", e => {
 *     e.target.style.borderRadius = e.borderRadius;
 * }).on("roundEnd", e => {
 *     console.log(e);
 * });
 */

/**
 * When drag end the border area or controls, the `roundEnd` event is called.
 * @memberof Moveable.Roundable
 * @event roundEnd
 * @param {Moveable.Roundable.onRoundEnd} - Parameters for the `roundEnd` event
 * @example
  * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     roundable: true,
 *     roundRelative: false,
 * });
 * moveable.on("roundStart", e => {
 *     console.log(e);
 * }).on("round", e => {
 *     e.target.style.borderRadius = e.borderRadius;
 * }).on("roundEnd", e => {
 *     console.log(e);
 * });
 */

function isIdentityMatrix(matrix, is3d) {
  var value = is3d ? "matrix3d(".concat(createIdentityMatrix(4)) : "matrix(".concat(createIdentityMatrix(3), ")");
  return matrix === value || matrix === "matrix(1,0,0,1,0,0)";
}

var BeforeRenderable = {
  isPinch: true,
  name: "beforeRenderable",
  props: {},
  events: {
    onBeforeRenderStart: "beforeRenderStart",
    onBeforeRender: "beforeRender",
    onBeforeRenderEnd: "beforeRenderEnd",
    onBeforeRenderGroupStart: "beforeRenderGroupStart",
    onBeforeRenderGroup: "beforeRenderGroup",
    onBeforeRenderGroupEnd: "beforeRenderGroupEnd"
  },
  dragRelation: "weak",
  setTransform: function (moveable, e) {
    var _a = moveable.state,
        is3d = _a.is3d,
        target = _a.target,
        targetMatrix = _a.targetMatrix;
    var transform = target === null || target === void 0 ? void 0 : target.style.transform;
    var cssMatrix = is3d ? "matrix3d(".concat(targetMatrix.join(","), ")") : "matrix(".concat(convertMatrixtoCSS(targetMatrix, true), ")");
    var startTransform = !transform || transform === "none" ? cssMatrix : transform;
    e.datas.startTransforms = isIdentityMatrix(startTransform, is3d) ? [] : splitSpace(startTransform);
  },
  resetTransform: function (e) {
    e.datas.nextTransforms = e.datas.startTransforms;
    e.datas.nextTransformAppendedIndexes = [];
  },
  fillDragStartParams: function (moveable, e) {
    return fillParams(moveable, e, {
      setTransform: function (transform) {
        e.datas.startTransforms = isArray(transform) ? transform : splitSpace(transform);
      },
      isPinch: !!e.isPinch
    });
  },
  fillDragParams: function (moveable, e) {
    return fillParams(moveable, e, {
      isPinch: !!e.isPinch
    });
  },
  dragStart: function (moveable, e) {
    this.setTransform(moveable, e);
    triggerEvent(moveable, "onBeforeRenderStart", this.fillDragStartParams(moveable, e));
  },
  drag: function (moveable, e) {
    this.resetTransform(e);
    triggerEvent(moveable, "onBeforeRender", fillParams(moveable, e, {
      isPinch: !!e.isPinch
    }));
  },
  dragEnd: function (moveable, e) {
    triggerEvent(moveable, "onBeforeRenderEnd", fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      isDrag: e.isDrag
    }));
  },
  dragGroupStart: function (moveable, e) {
    var _this = this;

    this.dragStart(moveable, e);
    var events = fillChildEvents(moveable, "beforeRenderable", e);
    var moveables = moveable.moveables;
    var params = events.map(function (childEvent, i) {
      var childMoveable = moveables[i];

      _this.setTransform(childMoveable, childEvent);

      return _this.fillDragStartParams(childMoveable, childEvent);
    });
    triggerEvent(moveable, "onBeforeRenderGroupStart", fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      targets: moveable.props.targets,
      setTransform: function () {},
      events: params
    }));
  },
  dragGroup: function (moveable, e) {
    var _this = this;

    this.drag(moveable, e);
    var events = fillChildEvents(moveable, "beforeRenderable", e);
    var moveables = moveable.moveables;
    var params = events.map(function (childEvent, i) {
      var childMoveable = moveables[i];

      _this.resetTransform(childEvent);

      return _this.fillDragParams(childMoveable, childEvent);
    });
    triggerEvent(moveable, "onBeforeRenderGroup", fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      targets: moveable.props.targets,
      events: params
    }));
  },
  dragGroupEnd: function (moveable, e) {
    this.dragEnd(moveable, e);
    triggerEvent(moveable, "onBeforeRenderGroupEnd", fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      isDrag: e.isDrag,
      targets: moveable.props.targets
    }));
  },
  dragControlStart: function (moveable, e) {
    return this.dragStart(moveable, e);
  },
  dragControl: function (moveable, e) {
    return this.drag(moveable, e);
  },
  dragControlEnd: function (moveable, e) {
    return this.dragEnd(moveable, e);
  },
  dragGroupControlStart: function (moveable, e) {
    return this.dragGroupStart(moveable, e);
  },
  dragGroupControl: function (moveable, e) {
    return this.dragGroup(moveable, e);
  },
  dragGroupControlEnd: function (moveable, e) {
    return this.dragGroupEnd(moveable, e);
  }
};
var Renderable = {
  name: "renderable",
  props: {},
  events: {
    onRenderStart: "renderStart",
    onRender: "render",
    onRenderEnd: "renderEnd",
    onRenderGroupStart: "renderGroupStart",
    onRenderGroup: "renderGroup",
    onRenderGroupEnd: "renderGroupEnd"
  },
  dragRelation: "weak",
  dragStart: function (moveable, e) {
    triggerEvent(moveable, "onRenderStart", fillParams(moveable, e, {
      isPinch: !!e.isPinch
    }));
  },
  drag: function (moveable, e) {
    triggerEvent(moveable, "onRender", this.fillDragParams(moveable, e));
  },
  dragAfter: function (moveable, e) {
    if (e.resultCount) {
      return this.drag(moveable, e);
    }
  },
  dragEnd: function (moveable, e) {
    triggerEvent(moveable, "onRenderEnd", this.fillDragEndParams(moveable, e));
  },
  dragGroupStart: function (moveable, e) {
    triggerEvent(moveable, "onRenderGroupStart", fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      targets: moveable.props.targets
    }));
  },
  dragGroup: function (moveable, e) {
    var _this = this;

    var events = fillChildEvents(moveable, "beforeRenderable", e);
    var moveables = moveable.moveables;
    var params = events.map(function (childEvent, i) {
      var childMoveable = moveables[i];
      return _this.fillDragParams(childMoveable, childEvent);
    });
    triggerEvent(moveable, "onRenderGroup", fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      targets: moveable.props.targets,
      transform: getNextTransformText(e),
      events: params
    }));
  },
  dragGroupEnd: function (moveable, e) {
    var _this = this;

    var events = fillChildEvents(moveable, "beforeRenderable", e);
    var moveables = moveable.moveables;
    var params = events.map(function (childEvent, i) {
      var childMoveable = moveables[i];
      return _this.fillDragEndParams(childMoveable, childEvent);
    });
    triggerEvent(moveable, "onRenderGroupEnd", fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      isDrag: e.isDrag,
      targets: moveable.props.targets,
      events: params
    }));
  },
  dragControlStart: function (moveable, e) {
    return this.dragStart(moveable, e);
  },
  dragControl: function (moveable, e) {
    return this.drag(moveable, e);
  },
  dragControlAfter: function (moveable, e) {
    return this.dragAfter(moveable, e);
  },
  dragControlEnd: function (moveable, e) {
    return this.dragEnd(moveable, e);
  },
  dragGroupControlStart: function (moveable, e) {
    return this.dragGroupStart(moveable, e);
  },
  dragGroupControl: function (moveable, e) {
    return this.dragGroup(moveable, e);
  },
  dragGroupControlEnd: function (moveable, e) {
    return this.dragGroupEnd(moveable, e);
  },
  fillDragParams: function (moveable, e) {
    return fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      transform: getNextTransformText(e)
    });
  },
  fillDragEndParams: function (moveable, e) {
    return fillParams(moveable, e, {
      isPinch: !!e.isPinch,
      isDrag: e.isDrag
    });
  }
};

function triggerAble(moveable, ableType, eventOperation, eventAffix, eventType, e, requestInstant) {
  var isStart = eventType === "Start";
  var target = moveable.state.target;
  var isRequest = e.isRequest;

  if (!target || isStart && eventAffix.indexOf("Control") > -1 && !isRequest && moveable.areaElement === e.inputEvent.target) {
    return false;
  } // "drag" "Control" "After"


  var eventName = "".concat(eventOperation).concat(eventAffix).concat(eventType);
  var conditionName = "".concat(eventOperation).concat(eventAffix, "Condition");
  var isEnd = eventType === "End";
  var isAfter = eventType === "After";
  var isFirstStart = isStart && (!moveable.targetGesto || !moveable.controlGesto || !moveable.targetGesto.isFlag() || !moveable.controlGesto.isFlag());

  if (isFirstStart) {
    moveable.updateRect(eventType, true, false);
  }

  if (eventType === "" && !isRequest) {
    convertDragDist(moveable.state, e);
  } // const isGroup = eventAffix.indexOf("Group") > -1;


  var ables = __spreadArray([], moveable[ableType], true);

  if (isRequest) {
    var requestAble_1 = e.requestAble;

    if (!ables.some(function (able) {
      return able.name === requestAble_1;
    })) {
      ables.push.apply(ables, moveable.props.ables.filter(function (able) {
        return able.name === requestAble_1;
      }));
    }
  }

  if (!ables.length) {
    return false;
  }

  var eventAbles = __spreadArray(__spreadArray([BeforeRenderable], ables, true), [Renderable], false).filter(function (able) {
    return able[eventName];
  });

  var datas = e.datas;

  if (isFirstStart) {
    eventAbles.forEach(function (able) {
      able.unset && able.unset(moveable);
    });
  }

  var inputEvent = e.inputEvent;
  var inputTarget;

  if (isEnd && inputEvent) {
    inputTarget = document.elementFromPoint(e.clientX, e.clientY) || inputEvent.target;
  }

  var resultCount = 0;
  var results = eventAbles.filter(function (able) {
    var ableName = able.name;
    var nextDatas = datas[ableName] || (datas[ableName] = {});

    if (isStart) {
      nextDatas.isEventStart = !able[conditionName] || able[conditionName](moveable, e);
    }

    if (nextDatas.isEventStart) {
      var result = able[eventName](moveable, moveable_esm_assign(moveable_esm_assign({}, e), {
        resultCount: resultCount,
        datas: nextDatas,
        originalDatas: datas,
        inputTarget: inputTarget
      }));

      moveable._emitter.off();

      if (isStart && result === false) {
        nextDatas.isEventStart = false;
      }

      resultCount += result ? 1 : 0;
      return result;
    }

    return false;
  });
  var isUpdate = results.length;
  var isForceEnd = false; // end ables

  if (isStart && eventAbles.length && !isUpdate) {
    isForceEnd = eventAbles.filter(function (able) {
      var ableName = able.name;
      var nextDatas = datas[ableName];

      if (nextDatas.isEventStart) {
        if (able.dragRelation === "strong") {
          // cancel drag
          nextDatas.isEventStart = false;
          return false;
        } // start drag


        return true;
      } // cancel event


      return false;
    }).length === 0;
  }

  if (isEnd || isForceEnd) {
    moveable.state.gesto = null;

    if (moveable.moveables) {
      moveable.moveables.forEach(function (childMoveable) {
        childMoveable.state.gesto = null;
      });
    }
  }

  if (isFirstStart && isForceEnd) {
    eventAbles.forEach(function (able) {
      able.unset && able.unset(moveable);
    });
  }

  if (isStart && !isRequest && isUpdate) {
    e === null || e === void 0 ? void 0 : e.preventDefault();
  }

  if (moveable.isUnmounted || isForceEnd) {
    return false;
  }

  if (!isStart && isUpdate && !requestInstant || isEnd) {
    var flushSync = moveable.props.flushSync || defaultSync;
    flushSync(function () {
      moveable.updateRect(isEnd ? eventType : "", true, false);
      moveable.forceUpdate();
    });
  }

  if (!isStart && !isEnd && !isAfter && isUpdate && !requestInstant) {
    triggerAble(moveable, ableType, eventOperation, eventAffix, eventType + "After", e);
  }

  return true;
}

function getTargetAbleGesto(moveable, moveableTarget, eventAffix) {
  var controlBox = moveable.controlBox.getElement();
  var targets = [];
  targets.push(controlBox);

  if (!moveable.props.dragArea || moveable.props.dragTarget) {
    targets.push(moveableTarget);
  }

  var startFunc = function (e) {
    var eventTarget = e.inputEvent.target;
    var areaElement = moveable.areaElement;
    return eventTarget === areaElement || !moveable.isMoveableElement(eventTarget) && !moveable.controlBox.getElement().contains(eventTarget) || hasClass(eventTarget, "moveable-area") || hasClass(eventTarget, "moveable-padding");
  };

  return getAbleGesto(moveable, targets, "targetAbles", eventAffix, {
    dragStart: startFunc,
    pinchStart: startFunc
  });
}

function getAbleGesto(moveable, target, ableType, eventAffix, conditionFunctions) {
  if (conditionFunctions === void 0) {
    conditionFunctions = {};
  }

  var _a = moveable.props,
      pinchOutside = _a.pinchOutside,
      pinchThreshold = _a.pinchThreshold;
  var options = {
    preventDefault: false,
    preventRightClick: true,
    preventWheelClick: true,
    container: window,
    pinchThreshold: pinchThreshold,
    pinchOutside: pinchOutside
  };
  var gesto = new gesto_esm(target, options);
  ["drag", "pinch"].forEach(function (eventOperation) {
    ["Start", "", "End"].forEach(function (eventType) {
      gesto.on("".concat(eventOperation).concat(eventType), function (e) {
        var eventName = e.eventType;

        if (conditionFunctions[eventName] && !conditionFunctions[eventName](e)) {
          e.stop();
          return;
        }

        var result = triggerAble(moveable, ableType, eventOperation, eventAffix, eventType, e);

        if (!result) {
          e.stop();
        }
      });
    });
  });
  return gesto;
}

var EventManager = /*#__PURE__*/function () {
  function EventManager(target, moveable, eventName) {
    var _this = this;

    this.target = target;
    this.moveable = moveable;
    this.eventName = eventName;
    this.ables = [];

    this._onEvent = function (e) {
      var eventName = _this.eventName;
      var moveable = _this.moveable;

      if (moveable.state.disableNativeEvent) {
        return;
      }

      _this.ables.forEach(function (able) {
        able[eventName](moveable, {
          inputEvent: e
        });
      });
    };

    target.addEventListener(eventName.toLowerCase(), this._onEvent);
  }

  var __proto = EventManager.prototype;

  __proto.setAbles = function (ables) {
    this.ables = ables;
  };

  __proto.destroy = function () {
    this.target.removeEventListener(this.eventName.toLowerCase(), this._onEvent);
    this.target = null;
    this.moveable = null;
  };

  return EventManager;
}();

var MoveableManager = /*#__PURE__*/function (_super) {
  moveable_esm_extends(MoveableManager, _super);

  function MoveableManager() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.state = moveable_esm_assign({
      container: null,
      gesto: null,
      renderPoses: [[0, 0], [0, 0], [0, 0], [0, 0]],
      disableNativeEvent: false
    }, getTargetInfo(null));
    _this.enabledAbles = [];
    _this.targetAbles = [];
    _this.controlAbles = [];
    _this.rotation = 0;
    _this.scale = [1, 1];
    _this.isUnmounted = false;
    _this.events = {
      "mouseEnter": null,
      "mouseLeave": null
    };
    _this._emitter = new EventEmitter$1();
    _this._prevTarget = null;
    _this._prevDragArea = false;
    _this._observer = null;
    _this._observerId = 0;

    _this.onPreventClick = function (e) {
      e.stopPropagation();
      e.preventDefault();
      removeEvent(window, "click", _this.onPreventClick, true);
    };

    _this.checkUpdateRect = function () {
      if (_this.isDragging()) {
        return;
      }

      var parentMoveable = _this.props.parentMoveable;

      if (parentMoveable) {
        parentMoveable.checkUpdateRect();
        return;
      }

      cancelAnimationFrame(_this._observerId);
      _this._observerId = utils_esm_requestAnimationFrame(function () {
        if (_this.isDragging()) {
          return;
        }

        _this.updateRect();
      });
    };

    return _this;
  }

  var __proto = MoveableManager.prototype;

  __proto.render = function () {
    var props = this.props;
    var state = this.state;
    var parentPosition = props.parentPosition,
        className = props.className,
        propsTarget = props.target,
        zoom = props.zoom,
        cspNonce = props.cspNonce,
        translateZ = props.translateZ,
        ControlBoxElement = props.cssStyled,
        portalContainer = props.portalContainer;
    this.checkUpdate();
    this.updateRenderPoses();

    var _a = parentPosition || {
      left: 0,
      top: 0
    },
        parentLeft = _a.left,
        parentTop = _a.top;

    var left = state.left,
        top = state.top,
        stateTarget = state.target,
        direction = state.direction,
        hasFixed = state.hasFixed;
    var groupTargets = props.targets;
    var isDisplay = (groupTargets && groupTargets.length || propsTarget) && stateTarget;
    var isDragging = this.isDragging();
    var ableAttributes = {};
    this.getEnabledAbles().forEach(function (able) {
      ableAttributes["data-able-".concat(able.name.toLowerCase())] = true;
    });
    return createElement(ControlBoxElement, moveable_esm_assign({
      cspNonce: cspNonce,
      ref: ref(this, "controlBox"),
      className: "".concat(prefix("control-box", direction === -1 ? "reverse" : "", isDragging ? "dragging" : ""), " ").concat(className)
    }, ableAttributes, {
      onClick: this.onPreventClick,
      portalContainer: portalContainer,
      style: {
        "position": hasFixed ? "fixed" : "absolute",
        "display": isDisplay ? "block" : "none",
        "transform": "translate3d(".concat(left - parentLeft, "px, ").concat(top - parentTop, "px, ").concat(translateZ, ")"),
        "--zoom": zoom,
        "--zoompx": "".concat(zoom, "px")
      }
    }), this.renderAbles(), this._renderLines());
  };

  __proto.componentDidMount = function () {
    this.isUnmounted = false;
    this.controlBox.getElement();
    var props = this.props;
    var parentMoveable = props.parentMoveable,
        container = props.container,
        wrapperMoveable = props.wrapperMoveable;

    this._updateTargets();

    this._updateNativeEvents();

    this._updateEvents();

    if (!container && !parentMoveable && !wrapperMoveable) {
      this.updateRect("", false, true);
    }

    this.updateCheckInput();

    this._updateObserver(this.props);
  };

  __proto.componentDidUpdate = function (prevProps) {
    this._updateNativeEvents();

    this._updateEvents();

    this._updateTargets();

    this.updateCheckInput();

    this._updateObserver(prevProps);
  };

  __proto.componentWillUnmount = function () {
    this.isUnmounted = true;

    this._emitter.off();

    unset(this, "targetGesto");
    unset(this, "controlGesto");
    var events = this.events;

    for (var name in events) {
      var manager = events[name];
      manager && manager.destroy();
    }
  };

  __proto.getContainer = function () {
    var _a = this.props,
        parentMoveable = _a.parentMoveable,
        wrapperMoveable = _a.wrapperMoveable,
        container = _a.container;
    return container || wrapperMoveable && wrapperMoveable.getContainer() || parentMoveable && parentMoveable.getContainer() || this.controlBox.getElement().parentElement;
  };
  /**
   * Check if the target is an element included in the moveable.
   * @method Moveable#isMoveableElement
   * @param - the target
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * window.addEventListener("click", e => {
   *     if (!moveable.isMoveableElement(e.target)) {
   *         moveable.target = e.target;
   *     }
   * });
   */


  __proto.isMoveableElement = function (target) {
    return target && (target.getAttribute("class") || "").indexOf(PREFIX) > -1;
  };
  /**
   * You can drag start the Moveable through the external `MouseEvent`or `TouchEvent`. (Angular: ngDragStart)
   * @method Moveable#dragStart
   * @param - external `MouseEvent`or `TouchEvent`
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * document.body.addEventListener("mousedown", e => {
   *     if (!moveable.isMoveableElement(e.target)) {
   *          moveable.dragStart(e);
   *     }
   * });
   */


  __proto.dragStart = function (e) {
    var targetGesto = this.targetGesto;

    if (targetGesto && !targetGesto.isFlag()) {
      targetGesto.triggerDragStart(e);
    }

    return this;
  };
  /**
   * Hit test an element or rect on a moveable target.
   * @method Moveable#hitTest
   * @param - element or rect to test
   * @return - Get hit test rate (rate > 0 is hitted)
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * document.body.addEventListener("mousedown", e => {
   *     if (moveable.hitTest(e.target) > 0) {
   *          console.log("hiited");
   *     }
   * });
   */


  __proto.hitTest = function (el) {
    var _a = this.state,
        target = _a.target,
        pos1 = _a.pos1,
        pos2 = _a.pos2,
        pos3 = _a.pos3,
        pos4 = _a.pos4,
        targetClientRect = _a.targetClientRect;

    if (!target) {
      return 0;
    }

    var rect;

    if (el instanceof Element) {
      var clientRect = el.getBoundingClientRect();
      rect = {
        left: clientRect.left,
        top: clientRect.top,
        width: clientRect.width,
        height: clientRect.height
      };
    } else {
      rect = moveable_esm_assign({
        width: 0,
        height: 0
      }, el);
    }

    var rectLeft = rect.left,
        rectTop = rect.top,
        rectWidth = rect.width,
        rectHeight = rect.height;
    var points = fitPoints([pos1, pos2, pos4, pos3], targetClientRect);
    var size = getOverlapSize(points, [[rectLeft, rectTop], [rectLeft + rectWidth, rectTop], [rectLeft + rectWidth, rectTop + rectHeight], [rectLeft, rectTop + rectHeight]]);
    var totalSize = getAreaSize(points);

    if (!size || !totalSize) {
      return 0;
    }

    return Math.min(100, size / totalSize * 100);
  };
  /**
   * Whether the coordinates are inside Moveable
   * @method Moveable#isInside
   * @param - x coordinate
   * @param - y coordinate
   * @return - True if the coordinate is in moveable or false
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * document.body.addEventListener("mousedown", e => {
   *     if (moveable.isInside(e.clientX, e.clientY)) {
   *          console.log("inside");
   *     }
   * });
   */


  __proto.isInside = function (clientX, clientY) {
    var _a = this.state,
        target = _a.target,
        pos1 = _a.pos1,
        pos2 = _a.pos2,
        pos3 = _a.pos3,
        pos4 = _a.pos4,
        targetClientRect = _a.targetClientRect;

    if (!target) {
      return false;
    }

    return isInside([clientX, clientY], fitPoints([pos1, pos2, pos4, pos3], targetClientRect));
  };
  /**
   * If the width, height, left, and top of all elements change, update the shape of the moveable.
   * @method Moveable#updateRect
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * window.addEventListener("resize", e => {
   *     moveable.updateRect();
   * });
   */


  __proto.updateRect = function (type, isTarget, isSetState) {
    if (isSetState === void 0) {
      isSetState = true;
    }

    var props = this.props;
    var parentMoveable = props.parentMoveable;
    var state = this.state;
    var target = state.target || this.props.target;
    var container = this.getContainer();
    var rootContainer = parentMoveable ? parentMoveable.props.rootContainer : props.rootContainer;
    this.updateState(getTargetInfo(this.controlBox && this.controlBox.getElement(), target, container, container, rootContainer || container), parentMoveable ? false : isSetState);
  };
  /**
   * Check if the moveable state is being dragged.
   * @method Moveable#isDragging
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * // false
   * console.log(moveable.isDragging());
   *
   * moveable.on("drag", () => {
   *   // true
   *   console.log(moveable.isDragging());
   * });
   */


  __proto.isDragging = function () {
    return (this.targetGesto ? this.targetGesto.isFlag() : false) || (this.controlGesto ? this.controlGesto.isFlag() : false);
  };
  /**
   * If the width, height, left, and top of the only target change, update the shape of the moveable.
   * @method Moveable#updateTarget
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * moveable.updateTarget();
   */


  __proto.updateTarget = function (type) {
    this.updateRect(type, true);
  };
  /**
   * You can get the vertex information, position and offset size information of the target based on the container.
   * @method Moveable#getRect
   * @return - The Rect Info
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * const rectInfo = moveable.getRect();
   */


  __proto.getRect = function () {
    var state = this.state;
    var poses = getAbsolutePosesByState(this.state);
    var pos1 = poses[0],
        pos2 = poses[1],
        pos3 = poses[2],
        pos4 = poses[3];
    var rect = moveable_esm_getRect(poses);
    var offsetWidth = state.width,
        offsetHeight = state.height;
    var width = rect.width,
        height = rect.height,
        left = rect.left,
        top = rect.top;
    var statePos = [state.left, state.top];
    var origin = plus(statePos, state.origin);
    var beforeOrigin = plus(statePos, state.beforeOrigin);
    var transformOrigin = state.transformOrigin;
    return {
      width: width,
      height: height,
      left: left,
      top: top,
      pos1: pos1,
      pos2: pos2,
      pos3: pos3,
      pos4: pos4,
      offsetWidth: offsetWidth,
      offsetHeight: offsetHeight,
      beforeOrigin: beforeOrigin,
      origin: origin,
      transformOrigin: transformOrigin,
      rotation: this.getRotation()
    };
  };
  /**
   * Get a manager that manages the moveable's state and props.
   * @method Moveable#getManager
   * @return - The Rect Info
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * const manager = moveable.getManager(); // real moveable class instance
   */


  __proto.getManager = function () {
    return this;
  };

  __proto.getRotation = function () {
    var _a = this.state,
        pos1 = _a.pos1,
        pos2 = _a.pos2,
        direction = _a.direction;
    return getAbsoluteRotation(pos1, pos2, direction);
  };
  /**
   * Request able through a method rather than an event.
   * At the moment of execution, requestStart is executed,
   * and then request and requestEnd can be executed through Requester.
   * @method Moveable#request
   * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Draggable.html#request|Draggable Requester}
   * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Resizable.html#request|Resizable Requester}
   * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Scalable.html#request|Scalable Requester}
   * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.Rotatable.html#request|Rotatable Requester}
   * @see {@link https://daybrush.com/moveable/release/latest/doc/Moveable.OriginDraggable.html#request|OriginDraggable Requester}
   * @param - ableName
   * @param - request to be able params.
   * @param - If isInstant is true, request and requestEnd are executed immediately.
   * @return - Able Requester. If there is no request in able, nothing will work.
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * // Instantly Request (requestStart - request - requestEnd)
   * moveable.request("draggable", { deltaX: 10, deltaY: 10 }, true);
   *
   * // Start move
   * const requester = moveable.request("draggable");
   * requester.request({ deltaX: 10, deltaY: 10 });
   * requester.request({ deltaX: 10, deltaY: 10 });
   * requester.request({ deltaX: 10, deltaY: 10 });
   * requester.requestEnd();
   */


  __proto.request = function (ableName, param, isInstant) {
    if (param === void 0) {
      param = {};
    }

    var _a = this.props,
        ables = _a.ables,
        groupable = _a.groupable;
    var requsetAble = ables.filter(function (able) {
      return able.name === ableName;
    })[0];

    if (this.isDragging() || !requsetAble || !requsetAble.request) {
      return {
        request: function () {
          return this;
        },
        requestEnd: function () {
          return this;
        }
      };
    }

    var self = this;
    var ableRequester = requsetAble.request(this);
    var requestInstant = isInstant || param.isInstant;
    var ableType = ableRequester.isControl ? "controlAbles" : "targetAbles";
    var eventAffix = "".concat(groupable ? "Group" : "").concat(ableRequester.isControl ? "Control" : "");
    var requester = {
      request: function (ableParam) {
        triggerAble(self, ableType, "drag", eventAffix, "", moveable_esm_assign(moveable_esm_assign({}, ableRequester.request(ableParam)), {
          requestAble: ableName,
          isRequest: true
        }), requestInstant);
        return this;
      },
      requestEnd: function () {
        triggerAble(self, ableType, "drag", eventAffix, "End", moveable_esm_assign(moveable_esm_assign({}, ableRequester.requestEnd()), {
          requestAble: ableName,
          isRequest: true
        }), requestInstant);
        return this;
      }
    };
    triggerAble(self, ableType, "drag", eventAffix, "Start", moveable_esm_assign(moveable_esm_assign({}, ableRequester.requestStart(param)), {
      requestAble: ableName,
      isRequest: true
    }), requestInstant);
    return requestInstant ? requester.request(param).requestEnd() : requester;
  };
  /**
   * Remove the Moveable object and the events.
   * @method Moveable#destroy
   * @example
   * import Moveable from "moveable";
   *
   * const moveable = new Moveable(document.body);
   *
   * moveable.destroy();
   */


  __proto.destroy = function () {
    this.componentWillUnmount();
  };

  __proto.updateRenderPoses = function () {
    var state = this.state;
    var props = this.props;
    var originalBeforeOrigin = state.originalBeforeOrigin,
        transformOrigin = state.transformOrigin,
        allMatrix = state.allMatrix,
        is3d = state.is3d,
        pos1 = state.pos1,
        pos2 = state.pos2,
        pos3 = state.pos3,
        pos4 = state.pos4,
        stateLeft = state.left,
        stateTop = state.top;

    var _a = props.padding || {},
        _b = _a.left,
        left = _b === void 0 ? 0 : _b,
        _c = _a.top,
        top = _c === void 0 ? 0 : _c,
        _d = _a.bottom,
        bottom = _d === void 0 ? 0 : _d,
        _e = _a.right,
        right = _e === void 0 ? 0 : _e;

    var n = is3d ? 4 : 3;
    var absoluteOrigin = props.groupable ? originalBeforeOrigin : plus(originalBeforeOrigin, [stateLeft, stateTop]);
    state.renderPoses = [plus(pos1, calculatePadding(allMatrix, [-left, -top], transformOrigin, absoluteOrigin, n)), plus(pos2, calculatePadding(allMatrix, [right, -top], transformOrigin, absoluteOrigin, n)), plus(pos3, calculatePadding(allMatrix, [-left, bottom], transformOrigin, absoluteOrigin, n)), plus(pos4, calculatePadding(allMatrix, [right, bottom], transformOrigin, absoluteOrigin, n))];
  };

  __proto.checkUpdate = function () {
    var _a = this.props,
        target = _a.target,
        container = _a.container,
        parentMoveable = _a.parentMoveable;
    var _b = this.state,
        stateTarget = _b.target,
        stateContainer = _b.container;

    if (!stateTarget && !target) {
      return;
    }

    this.updateAbles();
    var isChanged = !equals(stateTarget, target) || !equals(stateContainer, container);

    if (!isChanged) {
      return;
    }

    var moveableContainer = container || this.controlBox;

    if (moveableContainer) {
      this.unsetAbles();
    }

    this.updateState({
      target: target,
      container: container
    });

    if (!parentMoveable && moveableContainer) {
      this.updateRect("End", false, false);
    }
  };

  __proto.triggerEvent = function (name, e) {
    this._emitter.trigger(name, e);

    var callback = this.props[name];
    return callback && callback(e);
  };

  __proto.useCSS = function (tag, css) {
    var customStyleMap = this.props.customStyledMap;
    var key = tag + css;

    if (!customStyleMap[key]) {
      customStyleMap[key] = dist_styled_esm(tag, css);
    }

    return customStyleMap[key];
  };

  __proto.unsetAbles = function () {
    var _this = this;

    this.targetAbles.forEach(function (able) {
      if (able.unset) {
        able.unset(_this);
      }
    });
  };

  __proto.updateAbles = function (ables, eventAffix) {
    if (ables === void 0) {
      ables = this.props.ables;
    }

    if (eventAffix === void 0) {
      eventAffix = "";
    }

    var props = this.props;
    var triggerAblesSimultaneously = props.triggerAblesSimultaneously;
    var enabledAbles = ables.filter(function (able) {
      return able && (able.always && props[able.name] !== false || props[able.name]);
    });
    var dragStart = "drag".concat(eventAffix, "Start");
    var pinchStart = "pinch".concat(eventAffix, "Start");
    var dragControlStart = "drag".concat(eventAffix, "ControlStart");
    var targetAbles = filterAbles(enabledAbles, [dragStart, pinchStart], triggerAblesSimultaneously);
    var controlAbles = filterAbles(enabledAbles, [dragControlStart], triggerAblesSimultaneously);
    this.enabledAbles = enabledAbles;
    this.targetAbles = targetAbles;
    this.controlAbles = controlAbles;
  };

  __proto.updateState = function (nextState, isSetState) {
    if (isSetState) {
      if (this.isUnmounted) {
        return;
      }

      this.setState(nextState);
    } else {
      var state = this.state;

      for (var name in nextState) {
        state[name] = nextState[name];
      }
    }
  };

  __proto.getEnabledAbles = function () {
    var props = this.props;
    var ables = props.ables;
    return ables.filter(function (able) {
      return able && props[able.name];
    });
  };

  __proto.renderAbles = function () {
    var _this = this;

    var props = this.props;
    var triggerAblesSimultaneously = props.triggerAblesSimultaneously;
    var Renderer = {
      createElement: createElement
    };
    return groupByMap(moveable_esm_flat(filterAbles(this.getEnabledAbles(), ["render"], triggerAblesSimultaneously).map(function (_a) {
      var render = _a.render;
      return render(_this, Renderer) || [];
    })).filter(function (el) {
      return el;
    }), function (_a) {
      var key = _a.key;
      return key;
    }).map(function (group) {
      return group[0];
    });
  };

  __proto.updateCheckInput = function () {
    this.targetGesto && (this.targetGesto.options.checkInput = this.props.checkInput);
  };

  __proto._updateObserver = function (prevProps) {
    var _a;

    var props = this.props;
    var target = props.target;

    if (!window.ResizeObserver || !target || !props.useResizeObserver) {
      (_a = this._observer) === null || _a === void 0 ? void 0 : _a.disconnect();
      return;
    }

    if (prevProps.target === target && this._observer) {
      return;
    }

    var observer = new ResizeObserver(this.checkUpdateRect);
    observer.observe(target, {
      box: "border-box"
    });
    this._observer = observer;
    return;
  };

  __proto._updateEvents = function () {
    var controlBoxElement = this.controlBox.getElement();
    var hasTargetAble = this.targetAbles.length;
    var hasControlAble = this.controlAbles.length;
    var props = this.props;
    var target = props.dragTarget || props.target;

    var isUnset = !hasTargetAble && this.targetGesto || this._isTargetChanged(true);

    if (isUnset) {
      unset(this, "targetGesto");
      this.updateState({
        gesto: null
      });
    }

    if (!hasControlAble) {
      unset(this, "controlGesto");
    }

    if (target && hasTargetAble && !this.targetGesto) {
      this.targetGesto = getTargetAbleGesto(this, target, "");
    }

    if (!this.controlGesto && hasControlAble) {
      this.controlGesto = getAbleGesto(this, controlBoxElement, "controlAbles", "Control");
    }
  };

  __proto._updateTargets = function () {
    var props = this.props;
    this._prevTarget = props.dragTarget || props.target;
    this._prevDragArea = props.dragArea;
  };

  __proto._renderLines = function () {
    var props = this.props;
    var edge = props.edge,
        zoom = props.zoom,
        hideDefaultLines = props.hideDefaultLines;

    if (hideDefaultLines) {
      return [];
    }

    var renderPoses = this.state.renderPoses;
    var Renderer = {
      createElement: createElement
    };
    return [renderLine(Renderer, edge ? "n" : "", renderPoses[0], renderPoses[1], zoom, 0), renderLine(Renderer, edge ? "e" : "", renderPoses[1], renderPoses[3], zoom, 1), renderLine(Renderer, edge ? "w" : "", renderPoses[0], renderPoses[2], zoom, 2), renderLine(Renderer, edge ? "s" : "", renderPoses[2], renderPoses[3], zoom, 3)];
  };

  __proto._isTargetChanged = function (useDragArea) {
    var props = this.props;
    var target = props.dragTarget || props.target;
    var prevTarget = this._prevTarget;
    var prevDragArea = this._prevDragArea;
    var dragArea = props.dragArea; // check target without dragArea

    var isTargetChanged = !dragArea && prevTarget !== target;
    var isDragAreaChanged = (useDragArea || dragArea) && prevDragArea !== dragArea;
    return isTargetChanged || isDragAreaChanged;
  };

  __proto._updateNativeEvents = function () {
    var _this = this;

    var props = this.props;
    var target = props.dragArea ? this.areaElement : this.state.target;
    var events = this.events;
    var eventKeys = getKeys(events);

    if (this._isTargetChanged()) {
      for (var eventName in events) {
        var manager = events[eventName];
        manager && manager.destroy();
        events[eventName] = null;
      }
    }

    if (!target) {
      return;
    }

    var enabledAbles = this.enabledAbles;
    eventKeys.forEach(function (eventName) {
      var ables = filterAbles(enabledAbles, [eventName]);
      var hasAbles = ables.length > 0;
      var manager = events[eventName];

      if (!hasAbles) {
        if (manager) {
          manager.destroy();
          events[eventName] = null;
        }

        return;
      }

      if (!manager) {
        manager = new EventManager(target, _this, eventName);
        events[eventName] = manager;
      }

      manager.setAbles(ables);
    });
  };

  MoveableManager.defaultProps = {
    target: null,
    dragTarget: null,
    container: null,
    rootContainer: null,
    origin: true,
    edge: false,
    parentMoveable: null,
    wrapperMoveable: null,
    parentPosition: null,
    portalContainer: null,
    useResizeObserver: false,
    ables: [],
    pinchThreshold: 20,
    dragArea: false,
    passDragArea: false,
    transformOrigin: "",
    className: "",
    zoom: 1,
    triggerAblesSimultaneously: false,
    padding: {},
    pinchOutside: true,
    checkInput: false,
    groupable: false,
    hideDefaultLines: false,
    cspNonce: "",
    translateZ: 0,
    cssStyled: null,
    customStyledMap: {},
    props: {},
    flushSync: defaultSync
  };
  return MoveableManager;
}(PureComponent);
/**
 * The target to indicate Moveable Control Box.
 * @name Moveable#target
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 * moveable.target = document.querySelector(".target");
 */

/**
 * Zooms in the elements of a moveable.
 * @name Moveable#zoom
 * @default 1
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 * moveable.zoom = 2;
 */

/**
 * Whether the target size is detected and updated whenever it changes.
 * @name Moveable#zoom
 * @default false
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 * moveable.useResizeObserver = true;
 */

/**
 * Resize, Scale Events at edges
 * @name Moveable#edge
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 * moveable.edge = true;
 */

/**
 * You can specify the className of the moveable controlbox.
 * @name Moveable#className
 * @default ""
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *   className: "",
 * });
 *
 * moveable.className = "moveable1";
 */

/**
 * The target(s) to drag Moveable target(s)
 * @name Moveable#dragTarget
 * @default target
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body);
 * moveable.target = document.querySelector(".target");
 * moveable.dragTarget = document.querySelector(".dragTarget");
 */

/**
 * `renderStart` event occurs at the first start of all events.
 * @memberof Moveable
 * @event renderStart
 * @param {Moveable.OnRenderStart} - Parameters for the `renderStart` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: document.querySelector(".target"),
 * });
 * moveable.on("renderStart", ({ target }) => {
 *     console.log("onRenderStart", target);
 * });
 */

/**
 * `render` event occurs before the target is drawn on the screen.
 * @memberof Moveable
 * @event render
 * @param {Moveable.OnRender} - Parameters for the `render` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: document.querySelector(".target"),
 * });
 * moveable.on("render", ({ target }) => {
 *     console.log("onRender", target);
 * });
 */

/**
 * `renderEnd` event occurs at the end of all events.
 * @memberof Moveable
 * @event renderEnd
 * @param {Moveable.OnRenderEnd} - Parameters for the `renderEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: document.querySelector(".target"),
 * });
 * moveable.on("renderEnd", ({ target }) => {
 *     console.log("onRenderEnd", target);
 * });
 */

/**
 * `renderGroupStart` event occurs at the first start of all events in group.
 * @memberof Moveable
 * @event renderGroupStart
 * @param {Moveable.OnRenderGroupStart} - Parameters for the `renderGroupStart` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 * });
 * moveable.on("renderGroupStart", ({ targets }) => {
 *     console.log("onRenderGroupStart", targets);
 * });
 */

/**
 * `renderGroup` event occurs before the target is drawn on the screen in group.
 * @memberof Moveable
 * @event renderGroup
 * @param {Moveable.OnRenderGroup} - Parameters for the `renderGroup` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 * });
 * moveable.on("renderGroup", ({ targets }) => {
 *     console.log("onRenderGroup", targets);
 * });
 */

/**
 * `renderGroupEnd` event occurs at the end of all events in group.
 * @memberof Moveable
 * @event renderGroupEnd
 * @param {Moveable.OnRenderGroupEnd} - Parameters for the `renderGroupEnd` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 * });
 * moveable.on("renderGroupEnd", ({ targets }) => {
 *     console.log("onRenderGroupEnd", targets);
 * });
 */


var Groupable = {
  name: "groupable",
  props: {
    defaultGroupRotate: Number,
    defaultGroupOrigin: String,
    groupable: Boolean
  },
  events: {},
  render: function (moveable, React) {
    var targets = moveable.props.targets || [];
    moveable.moveables = [];
    var _a = moveable.state,
        left = _a.left,
        top = _a.top;
    var position = {
      left: left,
      top: top
    };
    var props = moveable.props;
    return targets.map(function (target, i) {
      return React.createElement(MoveableManager, {
        key: "moveable" + i,
        ref: refs(moveable, "moveables", i),
        target: target,
        origin: false,
        cssStyled: props.cssStyled,
        customStyledMap: props.customStyledMap,
        useResizeObserver: props.useResizeObserver,
        parentMoveable: moveable,
        parentPosition: position
      });
    });
  }
};
var Clickable = makeAble("clickable", {
  props: {
    clickable: Boolean,
    preventClickDefault: Boolean
  },
  events: {
    onClick: "click",
    onClickGroup: "clickGroup"
  },
  always: true,
  dragRelation: "weak",
  dragStart: function (moveable, e) {
    if (!e.isRequest) {
      addEvent(window, "click", moveable.onPreventClick, true);
    }
  },
  dragControlStart: function (moveable, e) {
    this.dragStart(moveable, e);
  },
  dragGroupStart: function (moveable, e) {
    this.dragStart(moveable, e);
    e.datas.inputTarget = e.inputEvent && e.inputEvent.target;
  },
  dragEnd: function (moveable, e) {
    this.endEvent(moveable);
    var target = moveable.state.target;
    var inputEvent = e.inputEvent;
    var inputTarget = e.inputTarget;
    var isMoveableElement = moveable.isMoveableElement(inputTarget);
    var containsElement = !isMoveableElement && moveable.controlBox.getElement().contains(inputTarget);

    if (!moveable.props.preventClickDefault && !e.isDrag || containsElement) {
      this.unset(moveable);
    }

    if (!inputEvent || !inputTarget || e.isDrag || moveable.isMoveableElement(inputTarget) || containsElement // External event duplicate target or dragAreaElement
    ) {
      return;
    }

    var containsTarget = target.contains(inputTarget);
    triggerEvent(moveable, "onClick", fillParams(moveable, e, {
      isDouble: e.isDouble,
      inputTarget: inputTarget,
      isTarget: target === inputTarget,
      containsTarget: containsTarget
    }));
  },
  dragGroupEnd: function (moveable, e) {
    this.endEvent(moveable);
    var inputEvent = e.inputEvent;
    var inputTarget = e.inputTarget;

    if (!inputEvent || !inputTarget || e.isDrag || moveable.isMoveableElement(inputTarget) // External event duplicate target or dragAreaElement
    || e.datas.inputTarget === inputTarget) {
      return;
    }

    var targets = moveable.props.targets;
    var targetIndex = targets.indexOf(inputTarget);
    var isTarget = targetIndex > -1;
    var containsTarget = false;

    if (targetIndex === -1) {
      targetIndex = findIndex(targets, function (parentTarget) {
        return parentTarget.contains(inputTarget);
      });
      containsTarget = targetIndex > -1;
    }

    triggerEvent(moveable, "onClickGroup", fillParams(moveable, e, {
      isDouble: e.isDouble,
      targets: targets,
      inputTarget: inputTarget,
      targetIndex: targetIndex,
      isTarget: isTarget,
      containsTarget: containsTarget
    }));
  },
  dragControlEnd: function (moveable, e) {
    this.dragEnd(moveable, e);
  },
  dragGroupControlEnd: function (moveable, e) {
    this.dragEnd(moveable, e);
  },
  endEvent: function (moveable) {
    var _this = this;

    utils_esm_requestAnimationFrame(function () {
      _this.unset(moveable);
    });
  },
  unset: function (moveable) {
    removeEvent(window, "click", moveable.onPreventClick, true);
  }
});
/**
 * When you click on the element, the `click` event is called.
 * @memberof Moveable
 * @event click
 * @param {Moveable.OnClick} - Parameters for the `click` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: document.querySelector(".target"),
 * });
 * moveable.on("click", ({ hasTarget, containsTarget, targetIndex }) => {
 *     // If you click on an element other than the target and not included in the target, index is -1.
 *     console.log("onClickGroup", target, hasTarget, containsTarget, targetIndex);
 * });
 */

/**
 * When you click on the element inside the group, the `clickGroup` event is called.
 * @memberof Moveable
 * @event clickGroup
 * @param {Moveable.OnClickGroup} - Parameters for the `clickGroup` event
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *     target: [].slice.call(document.querySelectorAll(".target")),
 * });
 * moveable.on("clickGroup", ({ inputTarget, isTarget, containsTarget, targetIndex }) => {
 *     // If you click on an element other than the target and not included in the target, index is -1.
 *     console.log("onClickGroup", inputTarget, isTarget, containsTarget, targetIndex);
 * });
 */

function getDraggableEvent(e) {
  var datas = e.originalDatas.draggable;

  if (!datas) {
    e.originalDatas.draggable = {};
    datas = e.originalDatas.draggable;
  }

  return moveable_esm_assign(moveable_esm_assign({}, e), {
    datas: datas
  });
}

var edgeDraggable = makeAble("edgeDraggable", {
  dragControlCondition: function (moveable, e) {
    if (!moveable.props.edgeDraggable || !e.inputEvent) {
      return false;
    }

    var target = e.inputEvent.target;
    return hasClass(target, prefix("direction")) && hasClass(target, prefix("line"));
  },
  dragControlStart: function (moveable, e) {
    return moveable_esm_Draggable.dragStart(moveable, getDraggableEvent(e));
  },
  dragControl: function (moveable, e) {
    return moveable_esm_Draggable.drag(moveable, getDraggableEvent(e));
  },
  dragControlEnd: function (moveable, e) {
    return moveable_esm_Draggable.dragEnd(moveable, getDraggableEvent(e));
  },
  dragGroupControlCondition: function (moveable, e) {
    if (!moveable.props.edgeDraggable || !e.inputEvent) {
      return false;
    }

    var target = e.inputEvent.target;
    return hasClass(target, prefix("direction")) && hasClass(target, prefix("line"));
  },
  dragGroupControlStart: function (moveable, e) {
    return moveable_esm_Draggable.dragGroupStart(moveable, getDraggableEvent(e));
  },
  dragGroupControl: function (moveable, e) {
    return moveable_esm_Draggable.dragGroup(moveable, getDraggableEvent(e));
  },
  dragGroupControlEnd: function (moveable, e) {
    return moveable_esm_Draggable.dragGroupEnd(moveable, getDraggableEvent(e));
  },
  unset: function (moveable) {
    return moveable_esm_Draggable.unset(moveable);
  }
});
/**
 * Whether to move by dragging the edge line (default: false)
 * @name Moveable.Draggable#edgeDraggable
 * @example
 * import Moveable from "moveable";
 *
 * const moveable = new Moveable(document.body, {
 *  draggable: true,
 *  edgeDraggable: false,
 * });
 *
 * moveable.edgeDraggable = true;
 */

var IndividualGroupable = {
  name: "individualGroupable",
  props: {
    individualGroupable: Boolean
  },
  events: {}
};
var MOVEABLE_ABLES = [BeforeRenderable, Default, Snappable, Pinchable, moveable_esm_Draggable, edgeDraggable, Rotatable, Resizable, Scalable, Warpable, Scrollable, Padding, Origin, OriginDraggable, Clippable, Roundable, Groupable, IndividualGroupable, Clickable, DragArea, Renderable];
var MOVEABLE_EVENTS_PROPS_MAP = /*#__PURE__*/MOVEABLE_ABLES.reduce(function (current, able) {
  return moveable_esm_assign(moveable_esm_assign({}, current), "events" in able ? able.events : {});
}, {});
var MOVEABLE_PROPS_MAP = /*#__PURE__*/MOVEABLE_ABLES.reduce(function (current, able) {
  return moveable_esm_assign(moveable_esm_assign({}, current), able.props);
}, {});
var MOVEABLE_EVENTS_MAP = /*#__PURE__*/invertObject(MOVEABLE_EVENTS_PROPS_MAP);
var MOVEABLE_EVENTS = Object.keys(MOVEABLE_EVENTS_MAP);
var MOVEABLE_PROPS = Object.keys(MOVEABLE_PROPS_MAP);

function getMaxPos(poses, index) {
  return Math.max.apply(Math, poses.map(function (_a) {
    var pos1 = _a[0],
        pos2 = _a[1],
        pos3 = _a[2],
        pos4 = _a[3];
    return Math.max(pos1[index], pos2[index], pos3[index], pos4[index]);
  }));
}

function getMinPos(poses, index) {
  return Math.min.apply(Math, poses.map(function (_a) {
    var pos1 = _a[0],
        pos2 = _a[1],
        pos3 = _a[2],
        pos4 = _a[3];
    return Math.min(pos1[index], pos2[index], pos3[index], pos4[index]);
  }));
}

function getGroupRect(moveables, rotation) {
  if (!moveables.length) {
    return [0, 0, 0, 0];
  }

  var moveablePoses = moveables.map(function (_a) {
    var state = _a.state;
    return getAbsolutePosesByState(state);
  });
  var minX = MAX_NUM;
  var minY = MAX_NUM;
  var groupWidth = 0;
  var groupHeight = 0;
  var fixedRotation = utils_esm_throttle(rotation, moveable_esm_TINY_NUM);

  if (fixedRotation % 90) {
    var rad_1 = fixedRotation / 180 * Math.PI;
    var a1_1 = Math.tan(rad_1);
    var a2_1 = -1 / a1_1;
    var b1MinMax_1 = [MIN_NUM, MAX_NUM];
    var b2MinMax_1 = [MIN_NUM, MAX_NUM];
    moveablePoses.forEach(function (poses) {
      poses.forEach(function (pos) {
        // ax + b = y
        // b = y - ax
        var b1 = pos[1] - a1_1 * pos[0];
        var b2 = pos[1] - a2_1 * pos[0];
        b1MinMax_1[0] = Math.max(b1MinMax_1[0], b1);
        b1MinMax_1[1] = Math.min(b1MinMax_1[1], b1);
        b2MinMax_1[0] = Math.max(b2MinMax_1[0], b2);
        b2MinMax_1[1] = Math.min(b2MinMax_1[1], b2);
      });
    });
    b1MinMax_1.forEach(function (b1) {
      // a1x + b1 = a2x + b2
      b2MinMax_1.forEach(function (b2) {
        // (a1 - a2)x = b2 - b1
        var x = (b2 - b1) / (a1_1 - a2_1);
        var y = a1_1 * x + b1;
        minX = Math.min(minX, x);
        minY = Math.min(minY, y);
      });
    });
    var rotatePoses = moveablePoses.map(function (_a) {
      var pos1 = _a[0],
          pos2 = _a[1],
          pos3 = _a[2],
          pos4 = _a[3];
      return [rotate(pos1, -rad_1), rotate(pos2, -rad_1), rotate(pos3, -rad_1), rotate(pos4, -rad_1)];
    });
    groupWidth = getMaxPos(rotatePoses, 0) - getMinPos(rotatePoses, 0);
    groupHeight = getMaxPos(rotatePoses, 1) - getMinPos(rotatePoses, 1);
  } else {
    minX = getMinPos(moveablePoses, 0);
    minY = getMinPos(moveablePoses, 1);
    groupWidth = getMaxPos(moveablePoses, 0) - minX;
    groupHeight = getMaxPos(moveablePoses, 1) - minY;

    if (fixedRotation % 180) {
      var changedWidth = groupWidth;
      groupWidth = groupHeight;
      groupHeight = changedWidth;
    }
  }

  return [minX, minY, groupWidth, groupHeight];
}
/**
 * @namespace Moveable.Group
 * @description You can make targets moveable.
 */


var MoveableGroup = /*#__PURE__*/function (_super) {
  moveable_esm_extends(MoveableGroup, _super);

  function MoveableGroup() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.differ = new children_differ_esm();
    _this.moveables = [];
    _this.transformOrigin = "50% 50%";
    return _this;
  }

  var __proto = MoveableGroup.prototype;

  __proto.checkUpdate = function () {
    this.updateAbles();
  };

  __proto.updateRect = function (type, isTarget, isSetState) {
    if (isSetState === void 0) {
      isSetState = true;
    }

    if (!this.controlBox) {
      return;
    }

    this.moveables.forEach(function (moveable) {
      moveable.updateRect(type, false, false);
    });
    var state = this.state;
    var props = this.props;
    var target = state.target || props.target;

    if (!isTarget || type !== "" && props.updateGroup) {
      // reset rotataion
      this.rotation = props.defaultGroupRotate;
      this.transformOrigin = props.defaultGroupOrigin || "50% 50%";
      this.scale = [1, 1];
    }

    var rotation = this.rotation;
    var scale = this.scale;

    var _a = getGroupRect(this.moveables, rotation),
        left = _a[0],
        top = _a[1],
        width = _a[2],
        height = _a[3]; // tslint:disable-next-line: max-line-length


    var transform = "rotate(".concat(rotation, "deg) scale(").concat(scale[0] >= 0 ? 1 : -1, ", ").concat(scale[1] >= 0 ? 1 : -1, ")");
    target.style.cssText += "left:0px;top:0px; transform-origin: ".concat(this.transformOrigin, "; width:").concat(width, "px; height:").concat(height, "px;") + "transform:".concat(transform);
    state.width = width;
    state.height = height;
    var container = this.getContainer();
    var info = getTargetInfo(this.controlBox.getElement(), target, this.controlBox.getElement(), this.getContainer(), this.props.rootContainer || container);
    var pos = [info.left, info.top];

    var _b = getAbsolutePosesByState(info),
        pos1 = _b[0],
        pos2 = _b[1],
        pos3 = _b[2],
        pos4 = _b[3]; // info.left + info.pos(1 ~ 4)


    var minPos = getMinMaxs([pos1, pos2, pos3, pos4]);
    var delta = [minPos.minX, minPos.minY];
    info.pos1 = minus(pos1, delta);
    info.pos2 = minus(pos2, delta);
    info.pos3 = minus(pos3, delta);
    info.pos4 = minus(pos4, delta);
    info.left = left - info.left + delta[0];
    info.top = top - info.top + delta[1];
    info.origin = minus(plus(pos, info.origin), delta);
    info.beforeOrigin = minus(plus(pos, info.beforeOrigin), delta);
    info.originalBeforeOrigin = plus(pos, info.originalBeforeOrigin); // info.transformOrigin = minus(plus(pos, info.transformOrigin!), delta);

    var clientRect = info.targetClientRect;
    var direction = scale[0] * scale[1] > 0 ? 1 : -1;
    clientRect.top += info.top - state.top;
    clientRect.left += info.left - state.left;
    target.style.transform = "translate(".concat(-delta[0], "px, ").concat(-delta[1], "px) ").concat(transform);
    this.updateState(moveable_esm_assign(moveable_esm_assign({}, info), {
      direction: direction,
      beforeDirection: direction
    }), isSetState);
  };

  __proto.getRect = function () {
    return moveable_esm_assign(moveable_esm_assign({}, _super.prototype.getRect.call(this)), {
      children: this.moveables.map(function (child) {
        return child.getRect();
      })
    });
  };

  __proto.triggerEvent = function (name, e, isManager) {
    if (isManager || name.indexOf("Group") > -1) {
      return _super.prototype.triggerEvent.call(this, name, e);
    } else {
      this._emitter.trigger(name, e);
    }
  };

  __proto.updateAbles = function () {
    _super.prototype.updateAbles.call(this, __spreadArray(__spreadArray([], this.props.ables, true), [Groupable], false), "Group");
  };

  __proto._updateTargets = function () {
    _super.prototype._updateTargets.call(this);

    this._prevTarget = this.props.dragTarget || this.areaElement;
  };

  __proto._updateEvents = function () {
    var state = this.state;
    var props = this.props;
    var prevTarget = this._prevTarget;
    var nextTarget = props.dragTarget || this.areaElement;

    if (prevTarget !== nextTarget) {
      unset(this, "targetGesto");
      unset(this, "controlGesto");
      state.target = null;
    }

    if (!state.target) {
      state.target = this.areaElement;
      this.controlBox.getElement().style.display = "block";
    }

    if (state.target) {
      if (!this.targetGesto) {
        this.targetGesto = getTargetAbleGesto(this, nextTarget, "Group");
      }

      if (!this.controlGesto) {
        this.controlGesto = getAbleGesto(this, this.controlBox.getElement(), "controlAbles", "GroupControl");
      }
    }

    var isContainerChanged = !equals(state.container, props.container);

    if (isContainerChanged) {
      state.container = props.container;
    }

    var _a = this.differ.update(props.targets),
        added = _a.added,
        changed = _a.changed,
        removed = _a.removed;

    if (isContainerChanged || added.length || changed.length || removed.length) {
      this.updateRect();
    }
  };

  __proto._updateObserver = function () {};

  MoveableGroup.defaultProps = moveable_esm_assign(moveable_esm_assign({}, MoveableManager.defaultProps), {
    transformOrigin: ["50%", "50%"],
    groupable: true,
    dragArea: true,
    keepRatio: true,
    targets: [],
    defaultGroupRotate: 0,
    defaultGroupOrigin: "50% 50%"
  });
  return MoveableGroup;
}(MoveableManager);
/**
 * @namespace Moveable.IndividualGroup
 * @description Create targets individually, not as a group.Create targets individually, not as a group.
 */


var MoveableIndividualGroup = /*#__PURE__*/function (_super) {
  moveable_esm_extends(MoveableIndividualGroup, _super);

  function MoveableIndividualGroup() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.moveables = [];
    return _this;
  }

  var __proto = MoveableIndividualGroup.prototype;

  __proto.render = function () {
    var _this = this;

    var _a = this.props,
        cspNonce = _a.cspNonce,
        ControlBoxElement = _a.cssStyled,
        targets = _a.targets;
    return createElement(ControlBoxElement, {
      cspNonce: cspNonce,
      ref: ref(this, "controlBox"),
      className: prefix("control-box")
    }, targets.map(function (target, i) {
      return createElement(MoveableManager, moveable_esm_assign({
        key: "moveable" + i,
        ref: refs(_this, "moveables", i)
      }, _this.props, {
        target: target,
        wrapperMoveable: _this
      }));
    }));
  };

  __proto.componentDidUpdate = function () {};

  __proto.updateRect = function (type, isTarget, isSetState) {
    if (isSetState === void 0) {
      isSetState = true;
    }

    this.moveables.forEach(function (moveable) {
      moveable.updateRect(type, isTarget, isSetState);
    });
  };

  __proto.getRect = function () {
    return moveable_esm_assign(moveable_esm_assign({}, _super.prototype.getRect.call(this)), {
      children: this.moveables.map(function (child) {
        return child.getRect();
      })
    });
  };

  __proto.request = function () {
    return {
      request: function () {
        return this;
      },
      requestEnd: function () {
        return this;
      }
    };
  };

  __proto.dragStart = function () {
    return this;
  };

  __proto.hitTest = function () {
    return 0;
  };

  __proto.isInside = function () {
    return false;
  };

  __proto.isDragging = function () {
    return false;
  };

  __proto.updateRenderPoses = function () {};

  __proto.checkUpdate = function () {};

  __proto.triggerEvent = function () {};

  __proto.updateAbles = function () {};

  __proto._updateEvents = function () {};

  __proto._updateObserver = function () {};

  return MoveableIndividualGroup;
}(MoveableManager);

var InitialMoveable = /*#__PURE__*/function (_super) {
  moveable_esm_extends(InitialMoveable, _super);

  function InitialMoveable() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.refTargets = [];
    _this.selectorMap = {};
    return _this;
  }

  var __proto = InitialMoveable.prototype;

  InitialMoveable.makeStyled = function () {
    var cssMap = {};
    var ables = this.getTotalAbles();
    ables.forEach(function (_a) {
      var css = _a.css;

      if (!css) {
        return;
      }

      css.forEach(function (text) {
        cssMap[text] = true;
      });
    });
    var style = getKeys(cssMap).join("\n");
    this.defaultStyled = dist_styled_esm("div", prefixCSS(PREFIX, MOVEABLE_CSS + style));
  };

  InitialMoveable.getTotalAbles = function () {
    return __spreadArray([Default, Groupable, IndividualGroupable, DragArea], this.defaultAbles, true);
  };

  __proto.render = function () {
    var moveableContructor = this.constructor;

    if (!moveableContructor.defaultStyled) {
      moveableContructor.makeStyled();
    }

    var _a = this.props,
        userAbles = _a.ables,
        userProps = _a.props,
        props = moveable_esm_rest(_a, ["ables", "props"]);

    var refTargets = this._updateRefs(true);

    var elementTargets = getElementTargets(refTargets, this.selectorMap);
    var isGroup = elementTargets.length > 1;
    var totalAbles = moveableContructor.getTotalAbles();

    var ables = __spreadArray(__spreadArray([], totalAbles, true), userAbles || [], true);

    var nextProps = moveable_esm_assign(moveable_esm_assign(moveable_esm_assign({}, props), userProps || {}), {
      ables: ables,
      cssStyled: moveableContructor.defaultStyled,
      customStyledMap: moveableContructor.customStyledMap
    });

    if (isGroup) {
      if (props.individualGroupable) {
        return createElement(MoveableIndividualGroup, moveable_esm_assign({
          key: "individual-group",
          ref: ref(this, "moveable")
        }, nextProps, {
          target: null,
          targets: elementTargets
        }));
      }

      return createElement(MoveableGroup, moveable_esm_assign({
        key: "group",
        ref: ref(this, "moveable")
      }, nextProps, {
        target: null,
        targets: elementTargets
      }));
    } else {
      return createElement(MoveableManager, moveable_esm_assign({
        key: "single",
        ref: ref(this, "moveable")
      }, nextProps, {
        target: elementTargets[0]
      }));
    }
  };

  __proto.componentDidMount = function () {
    this._updateRefs();
  };

  __proto.componentDidUpdate = function () {
    this._updateRefs();
  };

  __proto.componentWillUnmount = function () {
    this.selectorMap = {};
    this.refTargets = [];
  };

  __proto.getManager = function () {
    return this.moveable;
  };

  __proto._updateRefs = function (isRender) {
    var prevRefTargets = this.refTargets;
    var nextRefTargets = getRefTargets(this.props.target || this.props.targets);
    var isBrowser = typeof document !== "undefined";
    var isUpdate = prevRefTargets.length !== nextRefTargets.length || prevRefTargets.some(function (target, i) {
      var nextTarget = nextRefTargets[i];

      if (!target && !nextTarget) {
        return false;
      } else if (target !== nextTarget) {
        return true;
      }

      return false;
    });
    var selectorMap = this.selectorMap;
    var nextSelectorMap = {};
    this.refTargets.forEach(function (target) {
      if (isString(target)) {
        var selectorTarget = selectorMap[target];

        if (selectorTarget) {
          nextSelectorMap[target] = selectorMap[target];
        } else if (isBrowser) {
          isUpdate = true;
          nextSelectorMap[target] = [].slice.call(document.querySelectorAll(target));
        }
      }
    });
    this.refTargets = nextRefTargets;
    this.selectorMap = nextSelectorMap;

    if (!isRender && isUpdate) {
      this.forceUpdate();
    }

    return nextRefTargets;
  };

  InitialMoveable.defaultAbles = [];
  InitialMoveable.customStyledMap = {};
  InitialMoveable.defaultStyled = null;

  __decorate([withMethods(MOVEABLE_METHODS)], InitialMoveable.prototype, "moveable", void 0);

  return InitialMoveable;
}(PureComponent);

var Moveable$1 = /*#__PURE__*/function (_super) {
  moveable_esm_extends(Moveable, _super);

  function Moveable() {
    return _super !== null && _super.apply(this, arguments) || this;
  }

  Moveable.defaultAbles = MOVEABLE_ABLES;
  return Moveable;
}(InitialMoveable);

function makeMoveable(ables) {
  var _a;

  return _a = /*#__PURE__*/function (_super) {
    moveable_esm_extends(Moveable, _super);

    function Moveable() {
      return _super !== null && _super.apply(this, arguments) || this;
    }

    return Moveable;
  }(InitialMoveable), _a.defaultAbles = ables, _a;
}

var Moveable = Moveable$1;



;// CONCATENATED MODULE: ./node_modules/moveable/dist/moveable.esm.js
/*
Copyright (c) 2019 Daybrush
name: moveable
license: MIT
author: Daybrush
repository: https://github.com/daybrush/moveable/blob/master/packages/moveable
version: 0.30.0
*/






/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var dist_moveable_esm_extendStatics = function(d, b) {
    dist_moveable_esm_extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return dist_moveable_esm_extendStatics(d, b);
};

function dist_moveable_esm_extends(d, b) {
    dist_moveable_esm_extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var moveable_esm_assign$1 = function() {
    moveable_esm_assign$1 = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    };
    return moveable_esm_assign$1.apply(this, arguments);
};

function moveable_esm_decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

var InnerMoveable =
/*#__PURE__*/
function (_super) {
  dist_moveable_esm_extends(InnerMoveable, _super);

  function InnerMoveable(props) {
    var _this = _super.call(this, props) || this;

    _this.state = {};
    _this.state = _this.props;
    return _this;
  }

  var __proto = InnerMoveable.prototype;

  __proto.render = function () {
    return createPortal(createElement(Moveable, moveable_esm_assign$1({
      ref: ref(this, "moveable")
    }, this.state)), this.state.parentElement);
  };

  return InnerMoveable;
}(Component);

var PROPERTIES = MOVEABLE_PROPS;
var METHODS = MOVEABLE_METHODS;
var EVENTS = MOVEABLE_EVENTS;
var PROPS_MAP = MOVEABLE_PROPS_MAP;

/*
Copyright (c) 2019 Daybrush
name: @scena/event-emitter
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/gesture.git
version: 1.0.5
*/

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var dist_moveable_esm_assign = function () {
  dist_moveable_esm_assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return dist_moveable_esm_assign.apply(this, arguments);
};
function dist_moveable_esm_spreadArrays() {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;

  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];

  return r;
}

/**
 * Implement EventEmitter on object or component.
 */

var dist_moveable_esm_EventEmitter =
/*#__PURE__*/
function () {
  function EventEmitter() {
    this._events = {};
  }
  /**
   * Add a listener to the registered event.
   * @param - Name of the event to be added
   * @param - listener function of the event to be added
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Add listener in "a" event
   * emitter.on("a", () => {
   * });
   * // Add listeners
   * emitter.on({
   *  a: () => {},
   *  b: () => {},
   * });
   */


  var __proto = EventEmitter.prototype;

  __proto.on = function (eventName, listener) {
    if (utils_esm_isObject(eventName)) {
      for (var name in eventName) {
        this.on(name, eventName[name]);
      }
    } else {
      this._addEvent(eventName, listener, {});
    }

    return this;
  };
  /**
   * Remove listeners registered in the event target.
   * @param - Name of the event to be removed
   * @param - listener function of the event to be removed
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Remove all listeners.
   * emitter.off();
   *
   * // Remove all listeners in "A" event.
   * emitter.off("a");
   *
   *
   * // Remove "listener" listener in "a" event.
   * emitter.off("a", listener);
   */


  __proto.off = function (eventName, listener) {
    if (!eventName) {
      this._events = {};
    } else if (utils_esm_isObject(eventName)) {
      for (var name in eventName) {
        this.off(name);
      }
    } else if (!listener) {
      this._events[eventName] = [];
    } else {
      var events = this._events[eventName];

      if (events) {
        var index = findIndex(events, function (e) {
          return e.listener === listener;
        });

        if (index > -1) {
          events.splice(index, 1);
        }
      }
    }

    return this;
  };
  /**
   * Add a disposable listener and Use promise to the registered event.
   * @param - Name of the event to be added
   * @param - disposable listener function of the event to be added
   * @example
   * import EventEmitter from "@scena/event-emitter";
   * cosnt emitter = new EventEmitter();
   *
   * // Add a disposable listener in "a" event
   * emitter.once("a", () => {
   * });
   *
   * // Use Promise
   * emitter.once("a").then(e => {
   * });
   */


  __proto.once = function (eventName, listener) {
    var _this = this;

    if (listener) {
      this._addEvent(eventName, listener, {
        once: true
      });
    }

    return new Promise(function (resolve) {
      _this._addEvent(eventName, resolve, {
        once: true
      });
    });
  };
  /**
   * Fires an event to call listeners.
   * @param - Event name
   * @param - Event parameter
   * @return If false, stop the event.
   * @example
   *
   * import EventEmitter from "@scena/event-emitter";
   *
   *
   * const emitter = new EventEmitter();
   *
   * emitter.on("a", e => {
   * });
   *
   *
   * emitter.emit("a", {
   *   a: 1,
   * });
   */


  __proto.emit = function (eventName, param) {
    var _this = this;

    if (param === void 0) {
      param = {};
    }

    var events = this._events[eventName];

    if (!eventName || !events) {
      return true;
    }

    var isStop = false;
    param.eventType = eventName;

    param.stop = function () {
      isStop = true;
    };

    param.currentTarget = this;

    dist_moveable_esm_spreadArrays(events).forEach(function (info) {
      info.listener(param);

      if (info.once) {
        _this.off(eventName, info.listener);
      }
    });

    return !isStop;
  };
  /**
   * Fires an event to call listeners.
   * @param - Event name
   * @param - Event parameter
   * @return If false, stop the event.
   * @example
   *
   * import EventEmitter from "@scena/event-emitter";
   *
   *
   * const emitter = new EventEmitter();
   *
   * emitter.on("a", e => {
   * });
   *
   *
   * emitter.emit("a", {
   *   a: 1,
   * });
   */

  /**
  * Fires an event to call listeners.
  * @param - Event name
  * @param - Event parameter
  * @return If false, stop the event.
  * @example
  *
  * import EventEmitter from "@scena/event-emitter";
  *
  *
  * const emitter = new EventEmitter();
  *
  * emitter.on("a", e => {
  * });
  *
  * // emit
  * emitter.trigger("a", {
  *   a: 1,
  * });
  */


  __proto.trigger = function (eventName, param) {
    if (param === void 0) {
      param = {};
    }

    return this.emit(eventName, param);
  };

  __proto._addEvent = function (eventName, listener, options) {
    var events = this._events;
    events[eventName] = events[eventName] || [];
    var listeners = events[eventName];
    listeners.push(dist_moveable_esm_assign({
      listener: listener
    }, options));
  };

  return EventEmitter;
}();

var moveable_esm_EventEmitter$1 = dist_moveable_esm_EventEmitter;

/**
 * Moveable is Draggable! Resizable! Scalable! Rotatable!
 * @sort 1
 * @alias Moveable
 * @extends EventEmitter
 */

var moveable_esm_MoveableManager =
/*#__PURE__*/
function (_super) {
  dist_moveable_esm_extends(MoveableManager, _super);
  /**
   *
   */


  function MoveableManager(parentElement, options) {
    if (options === void 0) {
      options = {};
    }

    var _this = _super.call(this) || this;

    _this.tempElement = document.createElement("div");

    var nextOptions = moveable_esm_assign$1({}, options);

    var events = {};
    EVENTS.forEach(function (name) {
      events[camelize("on ".concat(name))] = function (e) {
        return _this.trigger(name, e);
      };
    });
    render(createElement(InnerMoveable, moveable_esm_assign$1({
      ref: ref(_this, "innerMoveable"),
      parentElement: parentElement
    }, nextOptions, events)), _this.tempElement);
    var target = nextOptions.target;

    if (isArray(target) && target.length > 1) {
      _this.updateRect();
    }

    return _this;
  }

  var __proto = MoveableManager.prototype;

  __proto.setState = function (state, callback) {
    this.innerMoveable.setState(state, callback);
  };

  __proto.forceUpdate = function (callback) {
    this.innerMoveable.forceUpdate(callback);
  };

  __proto.dragStart = function (e) {
    var innerMoveable = this.innerMoveable;

    if (innerMoveable.$_timer) {
      this.forceUpdate();
    }

    this.getMoveable().dragStart(e);
  };

  __proto.destroy = function () {
    render(null, this.tempElement);
    this.off();
    this.tempElement = null;
    this.innerMoveable = null;
  };

  __proto.getMoveable = function () {
    return this.innerMoveable.moveable;
  };

  MoveableManager = moveable_esm_decorate([Properties(METHODS, function (prototype, property) {
    if (prototype[property]) {
      return;
    }

    prototype[property] = function () {
      var args = [];

      for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
      }

      var self = this.getMoveable();

      if (!self || !self[property]) {
        return;
      }

      return self[property].apply(self, args);
    };
  }), Properties(PROPERTIES, function (prototype, property) {
    Object.defineProperty(prototype, property, {
      get: function () {
        return this.getMoveable().props[property];
      },
      set: function (value) {
        var _a;

        this.setState((_a = {}, _a[property] = value, _a));
      },
      enumerable: true,
      configurable: true
    });
  })], MoveableManager);
  return MoveableManager;
}(moveable_esm_EventEmitter$1);

var moveable_esm_Moveable =
/*#__PURE__*/
function (_super) {
  dist_moveable_esm_extends(Moveable, _super);

  function Moveable() {
    return _super !== null && _super.apply(this, arguments) || this;
  }

  return Moveable;
}(moveable_esm_MoveableManager);

function moveable_esm_getElementInfo(target, container, rootContainer) {
  return getElementInfo$1(target, container, rootContainer);
}
function moveable_esm_makeAble(name, able) {
  return makeAble$1(name, able);
}


//# sourceMappingURL=moveable.esm.js.map

// EXTERNAL MODULE: ./node_modules/blueimp-load-image/js/index.js
var blueimp_load_image_js = __webpack_require__(303);
var blueimp_load_image_js_default = /*#__PURE__*/__webpack_require__.n(blueimp_load_image_js);
;// CONCATENATED MODULE: ./src/contentbuilder/elementimage.js
function elementimage_typeof(obj) { "@babel/helpers - typeof"; return elementimage_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementimage_typeof(obj); }
function elementimage_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementimage_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementimage_toPropertyKey(descriptor.key), descriptor); } }
function elementimage_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementimage_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementimage_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementimage_toPropertyKey(arg) { var key = elementimage_toPrimitive(arg, "string"); return elementimage_typeof(key) === "symbol" ? key : String(key); }
function elementimage_toPrimitive(input, hint) { if (elementimage_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementimage_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }



var elementimage_Image = /*#__PURE__*/function () {
  function Image(builder) {
    elementimage_classCallCheck(this, Image);
    this.builder = builder;
  }
  elementimage_createClass(Image, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var imageTool = builderStuff.querySelector('#divImageTool');
      var imageResizer;
      if (!imageTool) {
        var html = "\n                <div id=\"divImageTool\" class=\"is-tool\">\n                    <div role=\"button\" tabindex=\"0\" class=\"image-embed\" style=\"".concat(this.builder.opts.imageEmbed ? '' : 'display:none;', "width:40px;height:40px;overflow:hidden;\">\n                        <div style=\"position:absolute;width:100%;height:100%;\"><svg class=\"is-icon-flex\" style=\"position: absolute;top: 13px;left: 15px;width: 14px;height: 14px;\"><use xlink:href=\"#ion-image\"></use></svg></div>\n                        <input title=\"").concat(util.out('Change Image'), "\" data-title=\"").concat(util.out('Change Image'), "\" id=\"fileEmbedImage\" type=\"file\" accept=\"image/*\" style=\"position:absolute;top:-20px;left:0;width:40px;height:60px;opacity: 0;cursor: pointer;\"/>\n                    </div>\n                    <button tabindex=\"0\" title=\"").concat(util.out('Link'), "\" data-title=\"").concat(util.out('Link'), "\" class=\"image-link\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\" style=\"width:17px;height:17px;\"><use xlink:href=\"#ion-link\"></use></svg></button> \n                    <button tabindex=\"0\" title=\"").concat(util.out('Select'), "\" data-title=\"").concat(util.out('Select'), "\" class=\"open-asset\" style=\"display:none;width:40px;height:40px;\"><svg class=\"is-icon-flex\" style=\"width:17px;height:17px;color:#fff\"><use xlink:href=\"#icon-folder2\"></use></svg></button> \n                    <button tabindex=\"0\" title=\"").concat(util.out('Edit'), "\" data-title=\"").concat(util.out('Edit'), "\" class=\"image-edit\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#ion-android-create\"></use></svg></button>\n                </div>\n                <div id=\"divImageProgress\">\n                    <div>\n                        <div class=\"dot\"></div>\n                        <div class=\"dot\"></div>\n                        <div class=\"dot\"></div>\n                    </div>\n                </div>\n                <div id=\"divImageResizerOverlay\" class=\"is-tool\">\n                </div>\n                <div id=\"divImageResizer\" class=\"keep-selection\" style=\"position:absolute;\">\n                </div>\n                ");
        dom.appendHtml(builderStuff, html);
        imageTool = builderStuff.querySelector('#divImageTool');
        this.imageTool = imageTool;
        imageResizer = document.querySelector('#divImageResizer');
        this.imageResizer = imageResizer;
        imageResizer.addEventListener('wheel', function () {
          _this.hideImageResizer();
        }, {
          passive: true
        });
        var imageResizerOverlay = document.querySelector('#divImageResizerOverlay');
        this.builder.moveable = new moveable_esm_Moveable(document.body, {
          target: imageResizer,
          resizable: true,
          throttleResize: 0,
          keepRatio: true
        }).on('resizeStart', function () {
          imageResizerOverlay.style.display = 'block'; // prevent cursor moving not smooth above iframe, so overlay is used.
        }).on('resize', function (_ref) {
          var target = _ref.target,
            width = _ref.width,
            height = _ref.height;
          if (width === 0 || height === 0 || isNaN(width) || isNaN(height)) {
            return;
          }

          // hide image tool
          _this.imageTool.style.display = '';

          // hide element tool
          var elementTool;
          if (!_this.builder.iframe) {
            elementTool = builderStuff.querySelector('.is-element-tool');
          } else {
            elementTool = contentStuff.querySelector('.is-element-tool');
          }
          elementTool.style.display = '';
          var activeImage = _this.builder.activeImage;
          var newPos = _this.builder.util.getElementPosition(activeImage);
          if (_this.builder.iframe) {
            var scaleX = newPos.scaleX;
            var scaleY = newPos.scaleY;
            width = width / scaleX;
            height = height / scaleY;
          }
          var bCircular = false;
          if (dom.hasClass(activeImage.parentNode, 'img-circular')) {
            activeImage = activeImage.parentNode;
            bCircular = true;
          }
          var zoom = _this.builder.opts.zoom;
          var win = _this.builder.win;
          if (!bCircular) {
            activeImage.style.width = "".concat(width / zoom, "px");
            activeImage.style.height = 'auto';
          } else {
            var pl = parseFloat(win.getComputedStyle(activeImage.parentNode).getPropertyValue('padding-left'));
            var pr = parseFloat(win.getComputedStyle(activeImage.parentNode).getPropertyValue('padding-right'));
            var maxWidth = activeImage.parentNode.offsetWidth * zoom - pl - pr;
            if (width >= maxWidth) width = maxWidth;
            if (height >= width) {
              activeImage.style.width = "".concat(width / zoom, "px");
              activeImage.style.height = "".concat(width / zoom, "px");
              activeImage.querySelector('img').style.width = "".concat(width / zoom, "px");
              activeImage.querySelector('img').style.height = "".concat(width / zoom, "px");
            } else {
              activeImage.style.width = "".concat(width / zoom, "px");
              activeImage.style.height = "".concat(height / zoom, "px");
              activeImage.querySelector('img').style.width = "".concat(width / zoom, "px");
              activeImage.querySelector('img').style.height = "".concat(height / zoom, "px");
            }
          }
          newPos = _this.builder.util.getElementPosition(activeImage);
          var top = newPos.top + window.pageYOffset;
          var left = newPos.left + window.pageXOffset;
          target.style.top = top + 'px';
          target.style.left = left + 'px';
          target.style.width = activeImage.offsetWidth + 'px';
          target.style.height = activeImage.offsetHeight + 'px';
          _this.repositionHandler(activeImage.offsetWidth, activeImage.offsetHeight);

          // https://stackoverflow.com/questions/29908261/prevent-text-selection-on-mouse-drag
          // prevent text selection
          if (document.selection) {
            document.selection.empty();
          } else {
            window.getSelection().removeAllRanges();
          }
          imageResizer.setAttribute('data-resizing', '1'); // important: see util.hidePops()
        }).on('resizeEnd', function (_ref2) {
          var target = _ref2.target;
          imageResizer.removeAttribute('data-resizing');
          imageResizerOverlay.style.display = '';
          var activeImage = _this.builder.activeImage;
          var bCircular = false;
          if (dom.hasClass(activeImage.parentNode, 'img-circular')) {
            activeImage = activeImage.parentNode;
            bCircular = true;
          }

          // https://stackoverflow.com/questions/25197184/get-the-height-of-an-element-minus-padding-margin-border-widths
          var cs = getComputedStyle(activeImage.parentNode);
          var paddingX = parseFloat(cs.paddingLeft) + parseFloat(cs.paddingRight);
          var borderX = parseFloat(cs.borderLeftWidth) + parseFloat(cs.borderRightWidth);

          // Element width and height minus padding and border
          var elementWidth = activeImage.parentNode.offsetWidth - paddingX - borderX;
          var win = _this.builder.win;
          var currentWidth;
          if (!bCircular) {
            var parentWidth = elementWidth; //activeImage.parentNode.offsetWidth;
            currentWidth = activeImage.offsetWidth;
            var percentage = currentWidth / parentWidth * 100;
            activeImage.style.width = percentage + '%';
          } else {
            var _screenwidth = win.innerWidth;
            currentWidth = activeImage.offsetWidth;
            var _percentage = currentWidth / _screenwidth * 100;
            activeImage.style.width = _percentage + 'vw';
            activeImage.style.height = _percentage + 'vw';
            var img = activeImage.querySelector('img');
            if (img) {
              img.style.width = '100%';
              img.style.height = '100%';
            }
          }
          if (_this.builder.opts.emailMode) {
            activeImage.setAttribute('width', currentWidth);
          }
          target.setAttribute('data-resized', 1);
          setTimeout(function () {
            target.setAttribute('data-resized', 0);
          }, 300);
          _this.builder.opts.onChange();
        });
        var movControlBox = document.querySelector('.moveable-control-box');
        if (movControlBox) movControlBox.style.display = 'none';
        imageResizer.addEventListener('click', function () {
          if (!_this.builder.activeImage) return;
          _this.builder.activeImage.click();
          _this.repositionImageTool();
          _this.builder.elmTool.repositionElementTool();
        });

        // Browse local image
        var elm = imageTool.querySelector('#fileEmbedImage');
        dom.addEventListener(elm, 'change', function (e) {
          _this.builder.uo.saveForUndo();
          var input = e.target;
          var img = _this.builder.activeImage;
          var imageProgress = builderStuff.querySelector('#divImageProgress');
          imageProgress.style.display = 'table';
          imageProgress.style.width = img.offsetWidth * _this.builder.opts.zoom + 'px';
          imageProgress.style.height = img.offsetHeight * _this.builder.opts.zoom + 'px';
          var newPos = _this.builder.util.getElementPosition(img);
          var top = newPos.top + window.pageYOffset;
          var left = newPos.left + window.pageXOffset;
          imageProgress.style.top = top + 'px';
          imageProgress.style.left = left + 'px';

          //The #fileEmbedImage triggered 2 times in IE (because of clearInputs below). This makes input.files[0].name returns error on 2nd trigger. Just add try{}!
          try {
            img.setAttribute('data-filename', input.files[0].name); //needed for saveimage.js | 

            // img.crossOrigin = 'anonymous';

            _this.processImage(input.files[0], img, function () {
              imageProgress.style.display = 'none';
              elm = imageTool.querySelector('#fileEmbedImage');
              elm.value = ''; //clear input

              //Check if image is part of module snippet. If so, refresh the (active) module (hide imageTool). If not, refresh imageTool position
              _this.refreshIfIsModule(img);
              _this.startImageMonitor(img);

              //Trigger Change event
              _this.builder.opts.onChange();
              _this.builder.elmTool.refresh();
              if (_this.builder.onImageChange) _this.builder.onImageChange();
            });
          } catch (e) {
            imageProgress.style.display = 'none';
          }
        });

        // Trigger onImageBrowseClick (if set), will cancel browsing local image
        if (this.builder.opts.onImageBrowseClick) {
          elm = imageTool.querySelector('.image-embed');
          dom.addEventListener(elm, 'click', function (e) {
            _this.builder.opts.onImageBrowseClick();
            e.preventDefault();
            return false;
          });
        }
        var btnImageLink = imageTool.querySelector('.image-link');
        dom.addEventListener(btnImageLink, 'click', function () {
          _this.renderPanel();
          var modalImageLink = builderStuff.querySelector('.imagelink');
          var movControlBox = document.querySelector('.moveable-control-box');
          if (movControlBox) movControlBox.style.display = 'none'; //needed by Safari (prevent z-index problem)

          if (_this.builder.opts.onImageSettingClick) {
            _this.builder.opts.onImageSettingClick();
            return false;
          }
          var img = _this.builder.activeImage;
          var lnk;
          if (img.parentNode.tagName.toLowerCase() === 'a' && img.parentNode.childElementCount === 1) {
            lnk = img.parentNode;
          }

          //get values
          var src = img.getAttribute('src'); //img.src;
          var title = img.getAttribute('alt');
          var inputSrc = modalImageLink.querySelector('.input-src');
          if (src.indexOf('base64') === -1) {
            inputSrc.value = src;
          } else {
            inputSrc.value = '[Image Data]';
          }
          var inputTitle = modalImageLink.querySelector('.input-title');
          inputTitle.value = title;
          var inputLink = modalImageLink.querySelector('.input-link');
          inputLink.value = '';
          var inputTarget = modalImageLink.querySelector('.input-newwindow');
          inputTarget.checked = false;
          var inputLightbox = modalImageLink.querySelector('.input-openlightbox');
          inputLightbox.checked = false;
          if (lnk) {
            inputLink.value = lnk.getAttribute('href');
            if (title === '') {
              var lnkTitle = lnk.getAttribute('title');
              if (lnkTitle) inputTitle.value = lnkTitle;
            }
            var target = lnk.getAttribute('target');
            if (target === '_blank') {
              inputTarget.checked = true;
            } else {
              inputTarget.checked = false;
            }
            if (dom.hasClass(lnk, 'is-lightbox')) {
              inputLightbox.checked = true;
            } else {
              inputLightbox.checked = false;
            }
          }
          util.showModal(modalImageLink, true, function () {
            btnImageLink.removeAttribute('data-focus');
            btnImageLink.focus();
          }, true);
          btnImageLink.setAttribute('data-focus', true);
          inputSrc.focus();
        });
        var btnOpenAsset = imageTool.querySelector('.open-asset');
        if (this.builder.opts.onImageSelectClick || this.builder.opts.imageselect) {
          btnOpenAsset.style.display = 'block';
          dom.addEventListener(btnOpenAsset, 'click', function () {
            var img = _this.builder.activeImage;
            var currentSrc = img ? img.getAttribute('src') : '';
            _this.builder.openImageSelect(function (src) {
              _this.builder.uo.saveForUndo();
              var img = _this.builder.activeImage;
              img.addEventListener('load', function () {
                if (_this.builder.activeModule) {
                  _this.refreshIfIsModule(_this.builder.activeModule);
                  _this.builder.activeModule.click();
                } else {
                  _this.repositionImageTool();
                  _this.builder.elmTool.repositionElementTool();
                }
              });
              img.setAttribute('src', src);
              _this.builder.opts.onChange();
              _this.builder.opts.onRender();
              if (_this.builder.onImageChange) _this.builder.onImageChange();
            }, currentSrc);
          });
        } else {
          btnOpenAsset.style.display = 'none';
        }

        // Edit (crop) image
        var btnImageEdit = imageTool.querySelector('.image-edit');
        dom.addEventListener(btnImageEdit, 'click', function () {
          _this.renderPanel();
          var modalImageEdit = builderStuff.querySelector('.imageedit');
          var img = _this.builder.activeImage;
          var preview = modalImageEdit.querySelector('.imageedit-preview');
          preview.innerHTML = '<img style="max-width:100%;object-fit:contain;height:100%;"/>';
          var imagePreview = modalImageEdit.querySelector('img');
          if (_this.builder.onImageEditClick) {
            var result = _this.builder.onImageEditClick(img, imagePreview);
            if (!result) return;
          }
          util.showModal(modalImageEdit, true, function () {
            btnImageEdit.removeAttribute('data-focus');
            btnImageEdit.focus();
          });
          btnImageEdit.setAttribute('data-focus', true);
          var maxW = 800;
          var maxH = 550;
          preview.style.height = '';
          if (img.offsetWidth < maxW && img.offsetHeight < maxH) {
            preview.style.width = img.offsetWidth + 'px';
          } else {
            var h = maxW * img.offsetHeight / img.offsetWidth; // test useing maxW
            if (h <= maxH) {
              //ok
              preview.style.width = maxW + 'px';
            } else {
              preview.style.height = maxH + 'px';
            }
          }
          if (window.innerHeight <= 800) {
            preview.style.height = '350px';
          }

          // imagePreview.src = img.src;
          if (img.src.indexOf('base64') === -1) {
            imagePreview.src = img.src + (img.src.indexOf('?') === -1 ? '?' : '&') + "timestamp=".concat(new Date().getTime());
          } else {
            imagePreview.src = img.src;
          }
          if (_this.builder.setCropperConfig) {
            _this.cropper = new (cropper_default())(imagePreview, _this.builder.setCropperConfig);
          } else {
            _this.cropper = new (cropper_default())(imagePreview, {
              zoomable: false
            });
          }
          var movControlBox = document.querySelector('.moveable-control-box');
          if (movControlBox) movControlBox.style.display = 'none'; //needed by Safari (prevent z-index problem)
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var modalImageLink = builderStuff.querySelector('.imagelink');
      if (!modalImageLink) {
        var html = "\n                <div class=\"is-modal imageedit\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                    <div class=\"is-modal-content\">\n                        <div class=\"imageedit-crop\" style=\"display:flex;height:80px;align-items:center;align-self:flex-start;\">\n                            <button title=\"5x5\" data-crop-size=\"1\" style=\"width: 60px;height: 60px;\">5x5</button>\n                            <button title=\"4x3\" data-crop-size=\"1.33333\" style=\"width: 60px;height: 45px;\">4x3</button>\n                            <button title=\"3x4\" data-crop-size=\"0.75\" style=\"width: 45px;height: 60px;\">3x4</button>\n                            <button title=\"6x4\" data-crop-size=\"1.5\" style=\"width: 60px;height: 40px;\">6x4</button>\n                            <button title=\"4x6\" data-crop-size=\"0.6666\" style=\"width: 40px;height: 60px;\">4x6</button>\n                            <button title=\"16x9\" data-crop-size=\"1.77\" style=\"width: 60px;height: 35px;\">16x9</button>\n                            <button title=\"".concat(util.out('Free'), "\" data-crop-size=\"\" style=\"width: 60px;height: 45px;\">").concat(util.out('Free'), "</button>\n                        </div>\n                        <div class=\"imageedit-preview\" style=\"max-width:1000px;width:100%;max-height:550px;\">\n                        </div>\n                        <div style=\"margin-top:15px;text-align:right;align-self:flex-end;\">\n                            <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                            <button title=\"").concat(util.out('Apply'), "\" class=\"input-ok classic-primary\">").concat(util.out('Apply'), "</button>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"is-modal imagelink\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                    <div class=\"is-modal-content\">\n\n                        <label for=\"inpImageLinkSource\" style=\"display:block\">").concat(util.out('Source'), ":</label>\n                        <div class=\"image-src\">\n                            <input id=\"inpImageLinkSource\" class=\"input-src\" type=\"text\"/>\n                            <button title=\"").concat(util.out('Select'), "\" class=\"input-select\" style=\"flex:none;\">\n                                ").concat(this.builder.opts.selectIcon, "\n                            </button>\n                \n                            <div class=\"image-larger1 is-btn classic\" style=\"position:relative;flex:none;box-shadow: 0px 3px 6px -6px rgba(0, 0, 0, 0.32);\">\n                                <form class=\"form-upload-larger\" target=\"frameTargetImageUpload\" method=\"post\" action=\"").concat(this.builder.opts.largerImageHandler, "\" enctype=\"multipart/form-data\" style=\"border-radius:1px;position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;\">\n\t\t\t\t                    <input id=\"hidRefId1\" name=\"hidRefId\" type=\"hidden\" value=\"\" />\n                                    <svg class=\"is-icon-flex\" style=\"width:18px;height:18px;\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                                    <input onclick=\"blur()\" title=\"").concat(util.out('Select'), "\" id=\"fileImage1\" name=\"fileImage\" type=\"file\" accept=\"image/*\" style=\"position:absolute;top:-30px;left:0;width:100%;height:80px;opacity: 0;cursor: pointer;\">\n                                </form>\n\n                                <iframe id=\"frameTargetImageUpload\" name=\"frameTargetImageUpload\" tabindex=\"-1\" src=\"about:blank\" style=\"width:1px;height:1px;position:absolute;top:0;right:-100000px\"></iframe>\n                            </div>\n                        </div>\n\n                        <label for=\"inpImageLinkTitle\" style=\"margin-top:14px;display:block\">").concat(util.out('Title'), ":</label>\n                        <input id=\"inpImageLinkTitle\" class=\"input-title\" type=\"text\" style=\"width:100%;border-top: none;\"/>\n\n                        <label for=\"inpImageLinkLink\" style=\"margin-top:14px;display:block\">").concat(util.out('Link'), ":</label>\n                        <div class=\"image-link\">\n                            <input id=\"inpImageLinkLink\" class=\"input-link\" type=\"text\" style=\"width:100%;border-top: none;\"/>\n                            <button title=\"").concat(util.out('Select'), "\" class=\"input-select2\" style=\"flex:none;\">\n                                ").concat(this.builder.opts.selectIcon, "\n                            </button>\n                            \n                            <button title=\"").concat(util.out(this.builder.opts.otherSelectCaption), "\" class=\"input-select-other\" style=\"display:none;width:50px\">").concat(this.builder.opts.otherSelectIcon, "</button>\n   \n                            <div class=\"image-larger2 is-btn classic\" style=\"position:relative;flex:none;box-shadow: 0px 3px 6px -6px rgba(0, 0, 0, 0.32);\">\n                                <form class=\"form-upload-larger\" target=\"frameTargetImageUpload\" method=\"post\" action=\"").concat(this.builder.opts.fileHandler ? this.builder.opts.fileHandler : this.builder.opts.largerImageHandler, "\" enctype=\"multipart/form-data\" style=\"border-radius:1px;position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;\">\n\t\t\t\t                    <input id=\"hidRefId2\" name=\"hidRefId\" type=\"hidden\" value=\"\" />\n                                    <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                                    <input onclick=\"blur()\" title=\"").concat(util.out('Select'), "\" id=\"fileImage2\" name=\"fileImage\" type=\"file\" accept=\"*\" style=\"position:absolute;top:-30px;left:0;width:100%;height:80px;opacity: 0;cursor: pointer;\">\n                                </form>\n                            </div>\n                        </div>\n\n                        <label style=\"display:block;margin-top:14px;\">\n                            <input class=\"input-newwindow\" id=\"__input_newwindow2\" type=\"checkbox\" />  ").concat(util.out('Open new window'), "&nbsp;\n                        </label>\n                        <label id=\"lblImageLinkOpenLightbox\" style=\"").concat(this.builder.useLightbox ? 'display:block' : 'display:none', ";margin-top:5px;margin-bottom:14px;\">\n                            <input class=\"input-openlightbox\" id=\"__input_openlightbox2\" type=\"checkbox\" />  ").concat(util.out('Open in a lightbox (for image, video or Youtube)'), "&nbsp;\n                        </label>\n                        \n                        <div style=\"text-align:right;margin-top:14px;\">\n                            <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                            <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                        </div>\n                    </div>\n                </div>\n                ");
        dom.appendHtml(builderStuff, html);
        var _modalImageLink = builderStuff.querySelector('.imagelink');
        if (this.builder.opts.onOtherSelectClick || this.builder.opts.otherSelect) {
          _modalImageLink.querySelector('.input-select-other').style.display = 'block';
          var inputSelectOther = _modalImageLink.querySelector('.input-select-other');
          if (inputSelectOther) dom.addEventListener(inputSelectOther, 'click', function (e) {
            if (_this2.builder.opts.onOtherSelectClick) {
              _this2.builder.opts.onOtherSelectClick({
                targetInput: _modalImageLink.querySelector('.input-link'),
                theTrigger: _modalImageLink.querySelector('.input-select-other')
              });
            } else {
              var modalFileSelect = builderStuff.querySelector('.is-modal.otherselect');
              if (_this2.builder.opts.assetRefresh) {
                modalFileSelect.querySelector('iframe').src = _this2.builder.opts.otherSelect;
                _this2.builder.opts.assetRefresh = false;
              }
              if (modalFileSelect.querySelector('iframe').src === 'about:blank') {
                modalFileSelect.querySelector('iframe').src = _this2.builder.opts.otherSelect;
              }
              util.showModal(modalFileSelect, false, function () {
                inputSelectOther.removeAttribute('data-focus');
                inputSelectOther.focus();
              }, false, _this2.builder.assetPanelFullScreen);
              inputSelectOther.setAttribute('data-focus', true);
            }
            _this2.builder.targetInput = _modalImageLink.querySelector('.input-link'); // used by selectAsset() (see contentbuilder.js)
            _this2.builder.targetCallback = null;
            _this2.builder.targetAssetType = 'all';
            e.preventDefault();
            e.stopImmediatePropagation();
          });
        }
        if (this.builder.opts.largerImageHandler === '' && !this.builder.opts.onLargerImageUpload) {
          _modalImageLink.querySelector('.image-larger1').style.display = 'none';
          _modalImageLink.querySelector('.image-larger2').style.display = 'none';
        }
        if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
          _modalImageLink.querySelector('.input-select').style.display = 'none';
          _modalImageLink.querySelector('.input-select2').style.display = 'none';
        }

        // Cancel
        var elm = _modalImageLink.querySelector('.input-cancel');
        dom.addEventListener(elm, 'click', function () {
          util.hideModal(_modalImageLink);
          var movControlBox = document.querySelector('.moveable-control-box');
          if (movControlBox) movControlBox.style.display = 'none'; //needed by Safari (prevent z-index problem)
        });

        // Apply link to image
        elm = _modalImageLink.querySelector('.input-ok');
        dom.addEventListener(elm, 'click', function () {
          _this2.builder.uo.saveForUndo();
          var img = _this2.builder.activeImage;
          var lnk;
          if (img.parentNode.tagName.toLowerCase() === 'a' && img.parentNode.childElementCount === 1) {
            lnk = img.parentNode;
          }
          var src = _modalImageLink.querySelector('.input-src').value;
          var title = _modalImageLink.querySelector('.input-title').value;
          var link = _modalImageLink.querySelector('.input-link').value;
          if (src.indexOf('[Image Data]') === -1) {
            img.setAttribute('src', src);
          } else {
            //no change
          }
          img.setAttribute('alt', title);
          if (link !== '') {
            if (lnk) {
              lnk.setAttribute('href', link);
              lnk.setAttribute('title', title);
              if (_modalImageLink.querySelector('.input-newwindow').checked) {
                lnk.setAttribute('target', '_blank');
              } else {
                lnk.removeAttribute('target');
              }
              if (_modalImageLink.querySelector('.input-openlightbox').checked) {
                dom.addClass(lnk, 'is-lightbox');
              } else {
                dom.removeClass(lnk, 'is-lightbox');
              }
            } else {
              //Create link
              lnk = dom.createElement('a');
              lnk.setAttribute('href', link);
              lnk.setAttribute('title', title);
              lnk.innerHTML = img.outerHTML;
              if (_modalImageLink.querySelector('.input-newwindow').checked) {
                lnk.setAttribute('target', '_blank');
              } else {
                lnk.removeAttribute('target');
              }
              if (_modalImageLink.querySelector('.input-openlightbox').checked) {
                dom.addClass(lnk, 'is-lightbox');
              } else {
                dom.removeClass(lnk, 'is-lightbox');
              }
              img.outerHTML = lnk.outerHTML;
            }
          } else {
            if (lnk) {
              //Remove link
              lnk.outerHTML = lnk.innerHTML;
            }
          }

          //Check if image is part of module snippet. If so, refresh the (active) module (hide imageTool). If not, refresh imageTool position
          _this2.refreshIfIsModule(img);
          _this2.builder.opts.onChange();
          _this2.builder.opts.onRender();
          util.hideModal(_modalImageLink);
          _this2.builder.elmTool.refresh();
          if (_this2.builder.onImageChange) _this2.builder.onImageChange();
        });

        // Select image (opens Asset Manager plugin or custom dialog)
        var divImageSrc = _modalImageLink.querySelector('.image-src');
        if (this.builder.opts.onImageSelectClick || this.builder.opts.imageselect) {
          var btnImageSelect = _modalImageLink.querySelector('.input-select');
          if (btnImageSelect) dom.addEventListener(btnImageSelect, 'click', function () {
            if (_this2.builder.opts.onImageSelectClick) {
              _this2.builder.opts.onImageSelectClick({
                targetInput: _modalImageLink.querySelector('.input-src'),
                theTrigger: btnImageSelect
              });
            } else {
              var modalImageSelect = builderStuff.querySelector('.is-modal.imageselect');
              var iframe = modalImageSelect.querySelector('iframe');
              if (_this2.builder.opts.assetRefresh) {
                iframe.src = _this2.builder.opts.imageselect;
                _this2.builder.opts.assetRefresh = false;
              }
              if (iframe.src === 'about:blank') {
                iframe.src = _this2.builder.opts.imageselect;
              }
              util.showModal(modalImageSelect, false, function () {
                btnImageSelect.removeAttribute('data-focus');
                btnImageSelect.focus();
              }, false, _this2.builder.assetPanelFullScreen);
              btnImageSelect.setAttribute('data-focus', true);
            }
            _this2.builder.targetInput = _modalImageLink.querySelector('.input-src'); // used by selectAsset() (see contentbuilder.js)
            _this2.builder.targetCallback = null;
            _this2.builder.targetAssetType = 'image';
          });
          var btnImageSelect2 = _modalImageLink.querySelector('.input-select2');
          if (btnImageSelect2) dom.addEventListener(btnImageSelect2, 'click', function () {
            if (_this2.builder.opts.onFileSelectClick) {
              _this2.builder.opts.onFileSelectClick({
                targetInput: _modalImageLink.querySelector('.input-link'),
                theTrigger: btnImageSelect2
              });
              _this2.builder.targetInput = _modalImageLink.querySelector('.input-link'); // used by selectAsset() (see contentbuilder.js)
              _this2.builder.targetCallback = null;
              _this2.builder.targetAssetType = 'all';
            } else if (_this2.builder.opts.fileselect !== '') {
              var modalFileSelect = builderStuff.querySelector('.is-modal.fileselect');
              var iframe = modalFileSelect.querySelector('iframe');
              if (_this2.builder.opts.assetRefresh) {
                iframe.src = _this2.builder.opts.fileselect;
                _this2.builder.opts.assetRefresh = false;
              }
              if (iframe.src === 'about:blank') {
                iframe.src = _this2.builder.opts.fileselect;
              }
              util.showModal(modalFileSelect, false, function () {
                btnImageSelect2.removeAttribute('data-focus');
                btnImageSelect2.focus();
              }, false, _this2.builder.assetPanelFullScreen);
              btnImageSelect2.setAttribute('data-focus', true);
              _this2.builder.targetInput = _modalImageLink.querySelector('.input-link'); // used by selectAsset() (see contentbuilder.js)
              _this2.builder.targetCallback = null;
              _this2.builder.targetAssetType = 'all';
            } else if (_this2.builder.opts.onImageSelectClick) {
              _this2.builder.opts.onImageSelectClick({
                targetInput: _modalImageLink.querySelector('.input-link'),
                theTrigger: btnImageSelect2
              });
              _this2.builder.targetInput = _modalImageLink.querySelector('.input-link'); // used by selectAsset() (see contentbuilder.js)
              _this2.builder.targetCallback = null;
              _this2.builder.targetAssetType = 'media';
            } else {
              var modalImageSelect = builderStuff.querySelector('.is-modal.imageselect');
              var _iframe = modalImageSelect.querySelector('iframe');
              if (_this2.builder.opts.assetRefresh) {
                _iframe.src = _this2.builder.opts.imageselect;
                _this2.builder.opts.assetRefresh = false;
              }
              if (_iframe.src === 'about:blank') {
                _iframe.src = _this2.builder.opts.imageselect;
              }
              util.showModal(modalImageSelect, false, function () {
                btnImageSelect2.removeAttribute('data-focus');
                btnImageSelect2.focus();
              }, false, _this2.builder.assetPanelFullScreen);
              btnImageSelect2.setAttribute('data-focus', true);
              _this2.builder.targetInput = _modalImageLink.querySelector('.input-link'); // used by selectAsset() (see contentbuilder.js)
              _this2.builder.targetCallback = null;
              _this2.builder.targetAssetType = 'media';
            }
          });
        } else {
          dom.removeClass(divImageSrc, 'image-select');
        }
        var fileLargerImage1 = _modalImageLink.querySelector('#fileImage1');
        dom.addEventListener(fileLargerImage1, 'change', function (e) {
          var element = fileLargerImage1;
          while (element.nodeName.toLowerCase() !== 'form') {
            element = element.parentNode;
          }
          var frmUpload = element;
          dom.addClass(frmUpload, 'please-wait');
          _modalImageLink.querySelector('#hidRefId1').value = _this2.builder.opts.customval;
          if (_this2.builder.opts.onLargerImageUpload) {
            _this2.builder.opts.onLargerImageUpload(e);
          } else {
            frmUpload.submit();
          }
          fileLargerImage1.value = ''; // Clear Input
        });

        var fileLargerImage2 = _modalImageLink.querySelector('#fileImage2');
        dom.addEventListener(fileLargerImage2, 'change', function (e) {
          var element = fileLargerImage2;
          while (element.nodeName.toLowerCase() !== 'form') {
            element = element.parentNode;
          }
          var frmUpload = element;
          dom.addClass(frmUpload, 'please-wait');
          _modalImageLink.querySelector('#hidRefId2').value = _this2.builder.opts.customval;
          if (_this2.builder.opts.onFileUpload) {
            _this2.builder.opts.onFileUpload(e);
          } else if (_this2.builder.opts.onLargerImageUpload) {
            _this2.builder.opts.onLargerImageUpload(e);
          } else {
            frmUpload.submit();
          }
          fileLargerImage2.value = ''; // Clear Input
        });

        // Image Edit Dialog (.is-modal.imageedit) ~~~~~~~~~~~~
        var modalImageEdit = builderStuff.querySelector('.imageedit');

        // Set crop proportion
        var cropOptions = modalImageEdit.querySelector('.imageedit-crop');
        var btns = cropOptions.querySelectorAll('button');
        Array.prototype.forEach.call(btns, function (btn) {
          dom.addEventListener(btn, 'click', function () {
            var aspectRatio = btn.getAttribute('data-crop-size') * 1;
            _this2.cropper.setAspectRatio(aspectRatio);
          });
        });

        // Cancel image edit
        var btnCancel = modalImageEdit.querySelector('.input-cancel');
        dom.addEventListener(btnCancel, 'click', function () {
          util.hideModal(modalImageEdit);
          var movControlBox = document.querySelector('.moveable-control-box');
          if (movControlBox && !_this2.builder.hideImageResizer) movControlBox.style.display = 'block'; //needed by Safari (prevent z-index problem)
        });

        // Apply (crop) image
        elm = modalImageEdit.querySelector('.input-ok');
        dom.addEventListener(elm, 'click', function () {
          _this2.builder.uo.saveForUndo();
          var img = _this2.builder.activeImage;
          var attr = img.getAttribute('data-filename');
          var extension = 'jpg';
          if (attr) {
            extension = attr.substr(attr.lastIndexOf('.') + 1).toLowerCase();
          } else {
            // no data-filename found (image from snippets)
            var f = img.src;
            if (f.indexOf('/') > -1) img.setAttribute('data-filename', f.substr(f.lastIndexOf('/') + 1));else img.setAttribute('data-filename', f);
            extension = f.substr(f.lastIndexOf('.') + 1).toLowerCase();
          }
          if (_this2.builder.opts.imageRenameOnEdit) {
            var basename = '';
            if (img.src.indexOf('base64') === -1) {
              var src = img.getAttribute('src');
              var filename = src.substring(src.lastIndexOf('/') + 1);
              basename = dom.baseName(filename);
            } else {
              basename = dom.baseName(img.getAttribute('data-filename'));
            }
            var newname = '';
            if (basename.indexOf('-edit') !== -1) {
              basename = basename.substr(0, basename.indexOf('-edit'));
            }
            newname = basename + '-edit' + util.makeId();
            newname = newname.replaceAll('%20', '-'); // fix 404 error after file upload

            img.setAttribute('data-filename', newname + '.' + extension);
          }
          if (extension === 'jpg' || extension === 'jpeg' || extension === 'webm' || extension === 'webp') {
            img.src = _this2.cropper.getCroppedCanvas({
              fillColor: '#fff',
              imageSmoothingEnabled: true,
              imageSmoothingQuality: 'high'
            }).toDataURL('image/jpeg');
          } else {
            img.src = _this2.cropper.getCroppedCanvas({}).toDataURL();
          }

          //Check if image is part of module snippet. If so, refresh the (active) module (hide imageTool). If not, refresh imageTool position
          _this2.refreshIfIsModule(img);

          //Trigger Change event
          _this2.builder.opts.onChange();
          util.hideModal(modalImageEdit);
          _this2.builder.elmTool.refresh();
          if (_this2.builder.onImageChange) _this2.builder.onImageChange();
        });
      }
    }
  }, {
    key: "startImageMonitor",
    value: function startImageMonitor(target) {
      var _this3 = this;
      var observer;
      var config = {
        attributes: true
      };
      observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
          if (mutation.attributeName === 'src') {
            // console.log('Image Changed:' + target.src);

            if (_this3.builder.onImageSrcChange) _this3.builder.onImageSrcChange();
            stopImageMonitor(); // Stop the monitor when the image changes
          }
        });
      });

      observer.observe(target, config);
      function stopImageMonitor() {
        if (observer) {
          observer.disconnect();
          // console.log('Monitor Stopped');
        } else {
          // console.log('Monitor is not running');
        }
      }
    }
  }, {
    key: "open",
    value: function open() {
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      this.renderPanel();
      var movControlBox = document.querySelector('.moveable-control-box');
      if (movControlBox) movControlBox.style.display = 'none'; //needed by Safari (prevent z-index problem)

      if (this.builder.opts.onImageSettingClick) {
        this.builder.opts.onImageSettingClick();
        return false;
      }
      var modalImageLink = builderStuff.querySelector('.imagelink');
      var img = this.builder.activeImage;
      var lnk = img.closest('a');
      var src = img.getAttribute('src');
      var title = img.getAttribute('alt');
      var inputSrc = modalImageLink.querySelector('.input-src');
      if (src.indexOf('base64') === -1) {
        inputSrc.value = src;
      } else {
        inputSrc.value = '[Image Data]';
      }
      var inputTitle = modalImageLink.querySelector('.input-title');
      inputTitle.value = title;
      var inputLink = modalImageLink.querySelector('.input-link');
      inputLink.value = '';
      var inputTarget = modalImageLink.querySelector('.input-newwindow');
      inputTarget.checked = false;
      var inputLightbox = modalImageLink.querySelector('.input-openlightbox');
      inputLightbox.checked = false;
      if (lnk) {
        inputLink.value = lnk.getAttribute('href');
        if (title === '') {
          var lnkTitle = lnk.getAttribute('title');
          if (lnkTitle) inputTitle.value = lnkTitle;
        }
        var target = lnk.getAttribute('target');
        if (target === '_blank') {
          inputTarget.checked = true;
        } else {
          inputTarget.checked = false;
        }
        if (lnk.classList.contains('is-lightbox')) {
          inputLightbox.checked = true;
        } else {
          inputLightbox.checked = false;
        }
      }
      util.showModal(modalImageLink, true, function () {

        // btnImageLink.removeAttribute('data-focus');
        // btnImageLink.focus();
      }, true);

      // btnImageLink.setAttribute('data-focus', true);

      inputSrc.focus();
    }
  }, {
    key: "change",
    value: function change(input) {
      var _this4 = this;
      // still not used
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      this.builder.uo.saveForUndo();
      var img = this.builder.activeImage;
      var imageProgress = builderStuff.querySelector('#divImageProgress');
      imageProgress.style.display = 'table';
      imageProgress.style.width = img.offsetWidth * this.builder.opts.zoom + 'px';
      imageProgress.style.height = img.offsetHeight * this.builder.opts.zoom + 'px';
      var newPos = util.getElementPosition(img);
      var top = newPos.top + window.pageYOffset;
      var left = newPos.left + window.pageXOffset;
      imageProgress.style.top = top + 'px';
      imageProgress.style.left = left + 'px';
      try {
        img.setAttribute('data-filename', input.files[0].name); //needed for saveimage.js | 
        this.processImage(input.files[0], img, function () {
          imageProgress.style.display = 'none';
          input.value = ''; //clear input

          //Check if image is part of module snippet. If so, refresh the (active) module (hide imageTool). If not, refresh imageTool position
          _this4.refreshIfIsModule(img);

          //Trigger Change event
          _this4.builder.opts.onChange();
          _this4.builder.elmTool.refresh();
        });
      } catch (e) {
        imageProgress.style.display = 'none';
      }
    }
  }, {
    key: "edit",
    value: function edit() {
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      this.renderPanel();
      var modalImageEdit = builderStuff.querySelector('.imageedit');
      var img = this.builder.activeImage;
      var preview = modalImageEdit.querySelector('.imageedit-preview');
      preview.innerHTML = '<img style="max-width:100%;object-fit:contain;height:100%;"/>';
      var imagePreview = modalImageEdit.querySelector('img');
      if (this.builder.onImageEditClick) {
        var result = this.builder.onImageEditClick(img, imagePreview);
        if (!result) return;
      }
      util.showModal(modalImageEdit, true, function () {

        // btnImageEdit.removeAttribute('data-focus');
        // btnImageEdit.focus();
      });

      // btnImageEdit.setAttribute('data-focus', true);

      var maxW = 800;
      var maxH = 550;
      preview.style.height = '';
      if (img.offsetWidth < maxW && img.offsetHeight < maxH) {
        preview.style.width = img.offsetWidth + 'px';
      } else {
        var h = maxW * img.offsetHeight / img.offsetWidth; // test useing maxW
        if (h <= maxH) {
          //ok
          preview.style.width = maxW + 'px';
        } else {
          preview.style.height = maxH + 'px';
        }
      }
      if (window.innerHeight <= 800) {
        preview.style.height = '350px';
      }

      // imagePreview.src = img.src;
      if (img.src.indexOf('base64') === -1) {
        imagePreview.src = img.src + (img.src.indexOf('?') === -1 ? '?' : '&') + "timestamp=".concat(new Date().getTime());
      } else {
        imagePreview.src = img.src;
      }
      if (this.builder.setCropperConfig) {
        this.cropper = new (cropper_default())(imagePreview, this.builder.setCropperConfig);
      } else {
        this.cropper = new (cropper_default())(imagePreview, {
          zoomable: false
        });
      }
      var movControlBox = document.querySelector('.moveable-control-box');
      if (movControlBox) movControlBox.style.display = 'none'; //needed by Safari (prevent z-index problem)
    }
  }, {
    key: "refreshIfIsModule",
    value: function refreshIfIsModule(elm) {
      var _this5 = this;
      var dom = this.builder.dom;
      var util = this.builder.util;
      var isModule = dom.parentsHasAttribute(elm, 'data-html');
      if (isModule) {
        if (this.imageTool) this.imageTool.style.display = '';

        // Extra: make image[data-image-embed] clickable/editable
        if (elm.hasAttribute('data-sync')) {
          var originalSrc = elm.getAttribute('data-src');
          var originalFilename = elm.getAttribute('data-filename');
          if (originalSrc) {
            var element = elm;
            while (!element.getAttribute('data-html')) {
              element = element.parentNode;
            }
            var module = element;
            var imgs = module.querySelectorAll('img');
            Array.prototype.forEach.call(imgs, function (img) {
              if (img.src === originalSrc) {
                img.src = elm.src;
                img.removeAttribute('data-src');
                img.setAttribute('data-filename', originalFilename);
              }
            });
            elm.removeAttribute('data-src');
          }
        }
        setTimeout(function () {
          util.refreshModule();
          if (_this5.imageTool) _this5.imageTool.style.display = '';
        }, 1000);
      } else {
        elm.onload = function () {
          _this5.refresh();
        };
      }
    }
  }, {
    key: "refresh",
    value: function refresh() {
      var _this6 = this;
      var util = this.builder.util;
      var dom = this.builder.dom;
      if (this.builder.activeImage) {
        var imageTool = this.imageTool;
        imageTool.style.display = '';
        setTimeout(function () {
          var elm = _this6.builder.activeImage;
          if (!elm) return;
          if (dom.hasClass(elm.parentNode, 'img-circular')) {
            elm = elm.parentNode;
          }
          var newPos = util.getElementPosition(elm);
          var scaleX = newPos.scaleX;
          imageTool.style.display = 'flex';
          var _toolwidth = imageTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

          var w = elm.offsetWidth * scaleX * _this6.builder.opts.zoom;
          var top = newPos.top + window.pageYOffset;
          var left = newPos.left + window.pageXOffset;
          var toolLeft = left + (w / 2 - _toolwidth / 2);

          //Adjust left in case an element is outside the screen
          var _screenwidth = window.innerWidth;
          if (!_this6.builder.iframe) {
            if (_toolwidth + left > _screenwidth) toolLeft = elm.getBoundingClientRect().left;
          } else {
            var adjX = _this6.builder.iframe.getBoundingClientRect().left + window.pageXOffset;
            if (_toolwidth + left > _screenwidth) toolLeft = elm.getBoundingClientRect().left + adjX;
          }
          imageTool.style.top = top + 'px';
          imageTool.style.left = toolLeft + 'px';
          var imageResizer = _this6.imageResizer;
          imageResizer.style.top = top + 'px';
          imageResizer.style.left = left + 'px';
          imageResizer.style.width = elm.offsetWidth * _this6.builder.opts.zoom + 'px';
          imageResizer.style.height = elm.offsetHeight * _this6.builder.opts.zoom + 'px';
          if (!_this6.builder.hideImageResizer) imageResizer.style.display = 'block';
          _this6.repositionHandler(elm.offsetWidth, elm.offsetHeight);

          // moveable
          if (_this6.builder.moveable) _this6.builder.moveable.updateRect();
          var movControlBox = document.querySelector('.moveable-control-box');
          if (movControlBox && !_this6.builder.hideImageResizer) movControlBox.style.display = 'block';
          if (elm.offsetWidth === 0) {
            // when there is image link applied

            // let imageTool = this.imageTool;
            imageTool.style.display = '';
            _this6.builder.activeImage = null;

            // let imageResizer = this.imageResizer;
            imageResizer.style.display = 'none';

            // moveable
            imageResizer.style.top = '-10px';
            imageResizer.style.left = '-10px';
            imageResizer.style.width = '1px';
            imageResizer.style.height = '1px';
            if (_this6.builder.moveable) _this6.builder.moveable.updateRect();
            var _movControlBox = document.querySelector('.moveable-control-box');
            if (_movControlBox) _movControlBox.style.display = 'none';
          }
          util.repositionColumnTool();
        }, 0); // refesh() is called after img onload, so no need to have a delay.
      }
    }
  }, {
    key: "repositionImageTool",
    value: function repositionImageTool() {
      // = refresh(), but without delay
      var util = this.builder.util;
      var dom = this.builder.dom;
      if (this.builder.activeImage) {
        var imageTool = this.imageTool;
        if (!imageTool) return;
        var elm = this.builder.activeImage;
        if (dom.hasClass(elm.parentNode, 'img-circular')) {
          elm = elm.parentNode;
        }
        var newPos = util.getElementPosition(elm);
        var scaleX = newPos.scaleX;
        imageTool.style.display = 'flex';
        var _toolwidth = imageTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

        var w = elm.offsetWidth * scaleX * this.builder.opts.zoom;
        var top = newPos.top + window.pageYOffset;
        var left = newPos.left + window.pageXOffset;
        var toolLeft = left + (w / 2 - _toolwidth / 2);

        //Adjust left in case an element is outside the screen
        var _screenwidth = window.innerWidth;
        if (!this.builder.iframe) {
          if (_toolwidth + left > _screenwidth) toolLeft = elm.getBoundingClientRect().left;
        } else {
          var adjX = this.builder.iframe.getBoundingClientRect().left + window.pageXOffset;
          if (_toolwidth + left > _screenwidth) toolLeft = elm.getBoundingClientRect().left + adjX;
        }
        imageTool.style.top = top + 'px';
        imageTool.style.left = toolLeft + 'px';
        if (!this.builder.activeImage.hasAttribute('data-noresize') && (this.builder.imageResizeOnBlock || !this.builder.activeImage.closest('.is-block'))) {
          var imageResizer = this.imageResizer;
          imageResizer.style.top = top + 'px';
          imageResizer.style.left = left + 'px';
          imageResizer.style.width = elm.offsetWidth * this.builder.opts.zoom + 'px';
          imageResizer.style.height = elm.offsetHeight * this.builder.opts.zoom + 'px';
          if (!this.builder.hideImageResizer) imageResizer.style.display = 'block';
          this.repositionHandler(elm.offsetWidth, elm.offsetHeight);

          // moveable
          if (this.builder.moveable) this.builder.moveable.updateRect();
          var movControlBox = document.querySelector('.moveable-control-box');
          if (movControlBox && !this.builder.hideImageResizer) movControlBox.style.display = 'block';
        }
      }
    }
  }, {
    key: "hideImageResizer",
    value: function hideImageResizer() {
      var imageResizer = this.imageResizer;
      if (!imageResizer) return;
      imageResizer.style.display = 'none';

      // moveable
      imageResizer.style.top = '-10px';
      imageResizer.style.left = '-10px';
      imageResizer.style.width = '1px';
      imageResizer.style.height = '1px';
      if (this.builder.moveable) {
        this.builder.moveable.updateRect();
        document.querySelector('.moveable-control-box').style.display = 'none';
      }
    }
  }, {
    key: "hideImageTool",
    value: function hideImageTool() {
      var imageTool = this.imageTool;
      if (imageTool) imageTool.style.display = '';
      this.hideImageResizer();
    }
  }, {
    key: "click",
    value: function click(e) {
      var _this7 = this;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var elm = e.target;

      //Image
      if (elm.tagName.toLowerCase() === 'img') {
        /* <img data-fixed src=".." /> (image must be fixed, cannot be replaced) */
        var fixedImage = false;
        if (elm.hasAttribute('data-fixed')) {
          fixedImage = true;
        }
        if (!fixedImage) {
          this.builder.activeImage = elm;
          if (dom.hasClass(elm.parentNode, 'img-circular')) {
            elm = elm.parentNode;
          }
          var newPos = util.getElementPosition(elm);
          var scaleX = newPos.scaleX;
          this.renderTool();
          var imageTool = this.imageTool;
          imageTool.style.display = 'flex';
          var _toolwidth = imageTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

          var w = elm.offsetWidth * scaleX * this.builder.opts.zoom;
          var top = newPos.top + window.pageYOffset;
          var left = newPos.left + window.pageXOffset;
          var toolLeft = left + (w / 2 - _toolwidth / 2);

          //Adjust left in case an element is outside the screen
          var _screenwidth = window.innerWidth;
          if (!this.builder.iframe) {
            if (_toolwidth + left > _screenwidth) toolLeft = elm.getBoundingClientRect().left;
          } else {
            var adjX = this.builder.iframe.getBoundingClientRect().left + window.pageXOffset;
            if (_toolwidth + left > _screenwidth) toolLeft = elm.getBoundingClientRect().left + adjX;
          }
          imageTool.style.top = top + 'px';
          imageTool.style.left = toolLeft + 'px';

          // Image Resizer
          if (!elm.hasAttribute('data-noresize') && (this.builder.imageResizeOnBlock || !elm.closest('.is-block'))) {
            var imageResizer = this.imageResizer;
            var _newPos = util.getElementPosition(elm);
            var _top = _newPos.top + window.pageYOffset;
            var _left = _newPos.left + window.pageXOffset;
            var _scaleX = _newPos.scaleX;
            var scaleY = _newPos.scaleY;
            imageResizer.style.top = _top + 'px';
            imageResizer.style.left = _left + 'px';
            imageResizer.style.width = elm.offsetWidth * this.builder.opts.zoom * _scaleX + 'px';
            imageResizer.style.height = elm.offsetHeight * this.builder.opts.zoom * scaleY + 'px';
            if (!this.builder.hideImageResizer) imageResizer.style.display = 'block';
            this.repositionHandler(elm.offsetWidth, elm.offsetHeight);

            //Get & save original image width
            var imgwidth = elm.style.width;
            var imgwidthpx;
            if (imgwidth.indexOf('%') !== -1) {
              imgwidth = imgwidth.replace('%', '') * 1;
              imgwidthpx = elm.offsetWidth * 100 / imgwidth;
            } else {
              imgwidthpx = elm.offsetWidth;
            }
            imageResizer.setAttribute('data-width', Math.round(imgwidthpx));

            // moveable
            if (this.builder.moveable) this.builder.moveable.updateRect();
            var movControlBox = document.querySelector('.moveable-control-box');
            if (movControlBox && !this.builder.hideImageResizer) movControlBox.style.display = 'block';
            var handleImageToolClickOut = function handleImageToolClickOut(e) {
              var elm = e.target;
              if (!elm) return;
              if (!elm.closest('#divImageResizer') && !elm.closest('#divImageTool') && !elm.closest('.is-modal') && !elm.closest('.keep-selection') && !elm.closest('.sl-wrapper') && !elm.closest('.sl-overlay') && !elm.closest('.sl-close') && !elm.closest('img')) {
                // click outside

                // hide
                _this7.hideImageTool();
                document.removeEventListener('click', handleImageToolClickOut);
                if (_this7.builder.iframeDocument) {
                  _this7.builder.doc.removeEventListener('click', handleImageToolClickOut);
                }
                _this7.builder.handleImageToolClickOut_ = false;
              }
            };
            if (!this.builder.handleImageToolClickOut_) {
              document.addEventListener('click', handleImageToolClickOut);
              if (this.builder.iframeDocument) {
                this.builder.doc.addEventListener('click', handleImageToolClickOut);
              }
              this.builder.handleImageToolClickOut_ = true;
            }
          } else {
            var _imageResizer = this.imageResizer;
            _imageResizer.style.display = 'none';

            // moveable
            _imageResizer.style.top = '-10px';
            _imageResizer.style.left = '-10px';
            _imageResizer.style.width = '1px';
            _imageResizer.style.height = '1px';
            if (this.builder.moveable) this.builder.moveable.updateRect();
            var _movControlBox2 = document.querySelector('.moveable-control-box');
            if (_movControlBox2) _movControlBox2.style.display = 'none';
          }
          if (this.builder.canvas) {
            // Do Nothing
          } else {
            var prog = false;
            if (e.screenX && e.screenX !== 0 && e.screenY && e.screenY !== 0) {
              // console.log('real button click');
              // Do Nothing
            } else {
              // console.log('Programmatically');
              prog = true;
            }
            if (prog) {
              this.hideImageTool();
            }
          }
        } else {
          this.builder.activeImage = null;
          this.hideImageTool();
        }
      } else {
        this.builder.activeImage = null;
      }
    }

    // Image Resizer
  }, {
    key: "repositionHandler",
    value: function repositionHandler(width, height) {
      var util = this.builder.util;
      var imageResizer = document.querySelector('#divImageResizer');
      imageResizer.style.width = width * this.builder.opts.zoom + 'px';
      imageResizer.style.height = height * this.builder.opts.zoom + 'px';
      var newPos = util.getElementPosition(imageResizer);
      var scaleX = newPos.scaleX;
      var scaleY = newPos.scaleY;
      imageResizer.style.width = width * this.builder.opts.zoom * scaleX + 'px';
      imageResizer.style.height = height * this.builder.opts.zoom * scaleY + 'px';
    }
  }, {
    key: "processImage",
    value: function processImage(file, targetImg, processImageDone) {
      //file can also be an URL (from the same host), ex. file = "/assets/image.jpg";

      if (!file) {
        processImageDone();
        return false;
      }
      if (!document.getElementById('myTmpCanvasNoCrop')) {
        var new_canvas = document.createElement('canvas');
        new_canvas.id = 'myTmpCanvasNoCrop';
        new_canvas.style.display = 'none';
        document.querySelector('body').appendChild(new_canvas);
      }
      var extension;
      if (!file.name) {
        //file is an URL
        extension = file.substr(file.lastIndexOf('.') + 1).toLowerCase();
      } else {
        //file is an image file
        extension = file.name.substr(file.name.lastIndexOf('.') + 1).toLowerCase();
      }
      var type, quality;
      if (extension === 'jpg' || extension === 'jpeg') {
        type = 'image/jpeg';
        quality = this.builder.opts.imageQuality;
      } else {
        type = 'image/png';
        quality = 1;
      }
      if (this.builder.opts.maxEmbedImageWidth === -1) {
        blueimp_load_image_js_default()(file, function (img) {
          targetImg.src = img.toDataURL(type, quality);
          processImageDone();
        }, {
          canvas: true
        });
      } else {
        blueimp_load_image_js_default()(file, function (img) {
          targetImg.src = img.toDataURL(type, quality);
          processImageDone();
        }, {
          maxWidth: this.builder.opts.maxEmbedImageWidth,
          maxHeight: this.builder.opts.maxEmbedImageWidth,
          canvas: true
        });
      }
    }
  }]);
  return Image;
}();
/* harmony default export */ const elementimage = (elementimage_Image);
;// CONCATENATED MODULE: ./src/contentbuilder/tabs.js
function tabs_typeof(obj) { "@babel/helpers - typeof"; return tabs_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, tabs_typeof(obj); }
function tabs_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function tabs_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, tabs_toPropertyKey(descriptor.key), descriptor); } }
function tabs_createClass(Constructor, protoProps, staticProps) { if (protoProps) tabs_defineProperties(Constructor.prototype, protoProps); if (staticProps) tabs_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function tabs_toPropertyKey(arg) { var key = tabs_toPrimitive(arg, "string"); return tabs_typeof(key) === "symbol" ? key : String(key); }
function tabs_toPrimitive(input, hint) { if (tabs_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (tabs_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var dom = new Dom();
var Tabs = /*#__PURE__*/function () {
  function Tabs() {
    var _this = this;
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    tabs_classCallCheck(this, Tabs);
    var defaults = {
      element: document
    };
    Object.assign(this, defaults, opts);

    // Close all dropdown
    var closeAllDropdowns = function closeAllDropdowns() {
      var elms = _this.element.querySelectorAll('.is-tabs-more');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
        elm.setAttribute('aria-expanded', false);
      });
      document.removeEventListener('click', handleClickOut);
    };
    var handleClickOut = function handleClickOut(e) {
      if (!(e.target.closest('.is-tab-more') || e.target.closest('[data-menu]'))) {
        closeAllDropdowns();
      }
    };

    // Open Tab Content
    var select = function select(tab) {
      var group = tab.parentNode.getAttribute('data-group');
      var menuid = tab.getAttribute('data-menu');
      if (menuid) {
        // Open Dropdown

        document.addEventListener('click', handleClickOut);
        tab.setAttribute('aria-expanded', true);
        _this.element.querySelector('#' + menuid).style.display = 'block';
        var activeItem = _this.element.querySelector('.is-tabs-more[data-group="' + group + '"] > li.active');
        if (activeItem) activeItem.focus();else {
          var dropdown = _this.element.querySelector('.is-tabs-more[data-group="' + group + '"]');
          dropdown.focus();
        }
        return false;
      }
      if (dom.hasClass(tab, 'active')) {
        return false;
      }
      var id = tab.getAttribute('data-content');
      if (!id) {
        return false;
      }

      // Highlight selected
      var samegrouptabs = _this.element.querySelectorAll('.is-tabs[data-group="' + group + '"] > a');
      Array.prototype.forEach.call(samegrouptabs, function (samegrouptab) {
        dom.removeClass(samegrouptab, 'active');
      });
      samegrouptabs = _this.element.querySelectorAll('.is-tabs-more[data-group="' + group + '"] > li');
      Array.prototype.forEach.call(samegrouptabs, function (samegrouptab) {
        dom.removeClass(samegrouptab, 'active');
      });
      dom.addClass(tab, 'active');
      var samegroupcontents = _this.element.querySelectorAll('.is-tab-content[data-group="' + group + '"]');
      Array.prototype.forEach.call(samegroupcontents, function (samegroupcontent) {
        samegroupcontent.style.display = 'none';
        dom.removeClass(samegroupcontent, 'active');
      });
      var content = _this.element.querySelector('#' + id);
      content.style.display = 'flex';
      dom.addClass(content, 'active');
      var tabMore = _this.element.querySelector('.is-tabs-more');
      if (tabMore) tabMore.style.display = 'none';

      // Close all dropdown
      closeAllDropdowns();
      _this.setupTabKey(content);
      return false;
    };
    var tabs = this.element.querySelectorAll('.is-tabs a');
    Array.prototype.forEach.call(tabs, function (tab) {
      tab.addEventListener('keydown', function (e) {
        e.preventDefault();
        if (e.which === 39 && e.target.nextElementSibling) {
          // arrow right key pressed
          e.target.nextElementSibling.focus();
        } else if (e.which === 37 && e.target.previousElementSibling) {
          // arrow left key pressed
          e.target.previousElementSibling.focus();
        } else if (e.keyCode === 13 || e.keyCode === 32) {
          // enter or spacebar key
          select(e.target);
        } else if (e.which === 9 && !e.shiftKey) {
          // tab key pressed

          // Redirect to tab content
          var inputs = [];
          var group = tab.parentNode.getAttribute('data-group');
          var tabContent = tab.parentNode.parentNode.querySelector('.is-tab-content[data-group="' + group + '"].active');
          var controls = tabContent.querySelectorAll('.is-tabs.active, a[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex]');
          controls.forEach(function (control) {
            inputs.push(control);
          });
          if (inputs.length === 0) return;
          var firstInput = inputs[0];
          firstInput.focus();
        }
      });
      tab.addEventListener('click', function (e) {
        e.preventDefault();
        select(e.target);
      });
    });
    var dropdowns = this.element.querySelectorAll('.is-tabs-more'); // //When dropdown opens, press arrow down will set focus on the first item
    Array.prototype.forEach.call(dropdowns, function (dropdown) {
      dropdown.addEventListener('keydown', function (e) {
        e.preventDefault();
        if (e.keyCode === 40 && e.target.nextElementSibling) {
          // down
          dropdown.querySelector('li').focus(); // focus on the first item
        } else if (e.keyCode === 27) {
          // escape key
          closeAllDropdowns();
        }
      });
    });
    tabs = this.element.querySelectorAll('.is-tabs-more li');
    Array.prototype.forEach.call(tabs, function (tab) {
      tab.addEventListener('keydown', function (e) {
        e.preventDefault();
        e.stopImmediatePropagation(); // a must, to prevent .is-tabs-more keydown

        if (e.keyCode === 38 && e.target.previousElementSibling) {
          // up
          e.target.previousElementSibling.focus();
        } else if (e.keyCode === 40 && e.target.nextElementSibling) {
          // down
          e.target.nextElementSibling.focus();
        } else if (e.keyCode === 27) {
          // escape key
          closeAllDropdowns();
        } else if (e.keyCode === 13 || e.keyCode === 32) {
          // enter or spacebar key

          select(e.target);
          if (e.target.closest('.is-tabs-more')) {
            var id = tab.parentNode.getAttribute('id');
            var btn = _this.element.querySelector('.is-tabs a[data-menu="' + id + '"]');
            if (btn) btn.focus();
          }
        }
      });
      tab.addEventListener('click', function (e) {
        e.preventDefault();
        select(e.target);
        if (e.target.closest('.is-tabs-more')) {
          var id = tab.parentNode.getAttribute('id');
          var btn = _this.element.querySelector('.is-tabs a[data-menu="' + id + '"]');
          if (btn) btn.focus();
        }
      });
    });
  }
  tabs_createClass(Tabs, [{
    key: "setupTabKey",
    value: function setupTabKey(area) {
      var _this2 = this;
      // Redirect to tab content
      var inputs = [];
      var controls = area.querySelectorAll('.is-tabs.active, a[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex]');
      controls.forEach(function (control) {
        inputs.push(control);
      });
      if (inputs.length === 0) return;
      var firstInput = inputs[0];
      var lastInput = inputs[inputs.length - 1];
      lastInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && !e.shiftKey) {
          e.preventDefault();

          // goto parent
          var id = area.getAttribute('id');
          var item = _this2.element.querySelector('li[data-content="' + id + '"],a[data-content="' + id + '"]');
          if (item.closest('.is-tabs-more')) {
            // part of dropdown

            id = item.parentNode.getAttribute('id');
            var btn = _this2.element.querySelector('.is-tabs a[data-menu="' + id + '"]');
            if (btn) btn.focus();
          } else {
            item.focus();
          }
        }
      });
      firstInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && e.shiftKey) {
          e.preventDefault();

          // goto parent
          var id = area.getAttribute('id');
          var item = _this2.element.querySelector('li[data-content="' + id + '"],a[data-content="' + id + '"]');
          if (item.closest('.is-tabs-more')) {
            // part of dropdown

            id = item.parentNode.getAttribute('id');
            var btn = _this2.element.querySelector('.is-tabs a[data-menu="' + id + '"]');
            if (btn) btn.focus();
          } else {
            item.focus();
          }
        }
      });
    }
  }]);
  return Tabs;
}();
/* harmony default export */ const tabs = (Tabs);
;// CONCATENATED MODULE: ./src/contentbuilder/buttoneditor.js
function buttoneditor_typeof(obj) { "@babel/helpers - typeof"; return buttoneditor_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, buttoneditor_typeof(obj); }
function buttoneditor_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function buttoneditor_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, buttoneditor_toPropertyKey(descriptor.key), descriptor); } }
function buttoneditor_createClass(Constructor, protoProps, staticProps) { if (protoProps) buttoneditor_defineProperties(Constructor.prototype, protoProps); if (staticProps) buttoneditor_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function buttoneditor_toPropertyKey(arg) { var key = buttoneditor_toPrimitive(arg, "string"); return buttoneditor_typeof(key) === "symbol" ? key : String(key); }
function buttoneditor_toPrimitive(input, hint) { if (buttoneditor_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (buttoneditor_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var ButtonEditor = /*#__PURE__*/function () {
  function ButtonEditor(builder) {
    var _this = this;
    buttoneditor_classCallCheck(this, ButtonEditor);
    this.builder = builder;
    var util = this.builder.util;
    this.util = util;
    var dom = this.builder.dom;
    this.dom = dom;
    var builderStuff = this.builder.builderStuff;
    this.builderStuff = builderStuff;
    var buttonModal = builderStuff.querySelector('.is-modal.buttoneditor');
    if (!buttonModal) {
      var html = "\n            <div class=\"is-modal is-modal-content buttoneditor\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-bar is-draggable\">\n                    ".concat(util.out('Button'), "\n                    <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">&#10005;</button>\n                </div>\n                <div style=\"padding:0;height:100%;\">\n                    <div class=\"is-tabs\" data-group=\"button\" style=\"position:relative;z-index:1\">\n                        <a title=\"").concat(util.out('General'), "\" href=\"\" data-content=\"divButtonGeneral\" class=\"active\">").concat(util.out('General'), "</a>\n                        <a title=\"").concat(util.out('Hover'), "\" href=\"\" data-content=\"divButtonHover\">").concat(util.out('Hover'), "</a>\n                        <a title=\"").concat(util.out('Text'), "\" href=\"\" data-content=\"divButtonText\">").concat(util.out('Text'), "</a>\n                        <a title=\"").concat(util.out('Saved'), "\" href=\"\" data-content=\"divMyButtons\">").concat(util.out('Saved'), "</a>\n                        <a title=\"").concat(util.out('Templates'), "\" href=\"\" data-content=\"divButtonTemplates\">").concat(util.out('Templates'), "</a>\n                    </div>\n                    <div id=\"divButtonGeneral\" class=\"is-tab-content active\" tabindex=\"-1\" data-group=\"button\" style=\"display: flex;\n                        height: 100%;\n                        width:100%;\n                        overflow-y: auto;\n                        position: absolute;\n                        border-top: 82px solid transparent;\n                        box-sizing: border-box;\n                        top: 0px;\">\n\n                        <div class=\"flex flex-row\">\n                            <div class=\"flex flex-col\" style=\"margin-right: 40px;\">\n                                <div>\n                                    <span>").concat(util.out('Background Color'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('Background Color'), "\" class=\"bg-color-command\" style=\"width:45px;height:40px;border:rgb(0 0 0 / 6%) 1px solid;margin-right:4px\"></button>\n                                </div>\n                            </div>\n                            \n                            <div class=\"flex flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Text Color'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('Text Color'), "\" class=\"text-color-command\" style=\"width:45px;height:40px;border:rgb(0 0 0 / 6%) 1px solid;margin-right:4px\"></button>\n                                </div>\n                            </div>\n                            <div class=\"flex flex-col\" style=\"margin-left: 60px;\">\n                                <div>\n                                    <span>").concat(util.out('Width'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('Auto'), "\" data-command=\"auto\" class=\"width-command\" style=\"margin-right:4px\">").concat(util.out('Auto'), "</button>\n                                    <button title=\"").concat(util.out('Full'), "\" data-command=\"full\" class=\"width-command\" style=\"margin-right:4px\">").concat(util.out('Full'), "</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-row\" style=\"margin:15px 0 0\">\n                            <div class=\"flex flex-col\" style=\"margin-right: 40px;\">\n                                <div>\n                                    <span>").concat(util.out('Border Color'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('Transparent'), "\" data-command=\"transparent\" class=\"border-color-command\" style=\"margin-right:4px\">").concat(util.out('Transparent'), "</button>\n                                    <button title=\"").concat(util.out('Current'), "\" data-command=\"current\" class=\"border-color-command\" style=\"margin-right:4px\">").concat(util.out('Current'), "</button>\n                                </div>\n                            </div>\n\n                            <div class=\"flex flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Border Thickness'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('No Border'), "\" data-command=\"0\" class=\"border-width-command\" style=\"margin-right:4px\">").concat(util.out('No Border'), "</button>\n                                    <button title=\"1px\" data-command=\"1\" class=\"border-width-command\" style=\"text-transform:none;margin-right:4px\">1px</button>\n                                    <button title=\"2px\" data-command=\"2\" class=\"border-width-command\" style=\"text-transform:none;margin-right:4px\">2px</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-row\" style=\"margin:15px 0 0\">\n                            <div class=\"flex flex-col\" style=\"margin-right: 20px;\">\n                                <div>\n                                    <span>").concat(util.out('Padding Left/Right'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row\" style=\"margin-top:5px\">\n                                    <button title=\"2\" data-command=\"2\" class=\"paddingx-command\" style=\"margin-right:4px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"paddingx-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"paddingx-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"paddingx-command\" style=\"margin-right:4px\">5</button>\n                                    <button title=\"6\" data-command=\"6\" class=\"paddingx-command\" style=\"margin-right:4px\">6</button>\n                                    <button title=\"7\" data-command=\"7\" class=\"paddingx-command\" style=\"margin-right:4px\">7</button>\n                                    <button title=\"8\" data-command=\"8\" class=\"paddingx-command\" style=\"margin-right:4px\">8</button>\n                                    <button title=\"9\" data-command=\"9\" class=\"paddingx-command\" style=\"margin-right:4px\">9</button>\n                                    <button title=\"10\" data-command=\"10\" class=\"paddingx-command\" style=\"margin-right:4px\">10</button>\n                                    <button title=\"11\" data-command=\"11\" class=\"paddingx-command\" style=\"margin-right:4px\">11</button>\n                                    <button title=\"12\" data-command=\"12\" class=\"paddingx-command\" style=\"margin-right:4px\">12</button>\n                                </div>\n                            </div>\n\n                            <div class=\"flex flex-col\" style=\"display:none\">\n                                <div>\n                                    <span>").concat(util.out('Padding Y'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"0\" class=\"paddingy-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"1\" data-command=\"1\" class=\"paddingy-command\" style=\"margin-right:4px\">1</button>\n                                    <button title=\"2\" data-command=\"2\" class=\"paddingy-command\" style=\"margin-right:4px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"paddingy-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"paddingy-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"paddingy-command\" style=\"margin-right:4px\">5</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-row\" style=\"margin:15px 0 0\">\n                            <div class=\"flex flex-col\" style=\"margin-right: 20px;\">\n                                <div>\n                                    <span>").concat(util.out('Padding Top'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"0\" class=\"paddingtop-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"1\" data-command=\"1\" class=\"paddingtop-command\" style=\"margin-right:4px\">1</button>\n                                    <button title=\"2\" data-command=\"2\" class=\"paddingtop-command\" style=\"margin-right:4px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"paddingtop-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"paddingtop-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"paddingtop-command\" style=\"margin-right:4px\">5</button>\n                                </div>\n                            </div>\n\n                            <div class=\"flex flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Padding Bottom'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"0\" class=\"paddingbottom-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"1\" data-command=\"1\" class=\"paddingbottom-command\" style=\"margin-right:4px\">1</button>\n                                    <button title=\"2\" data-command=\"2\" class=\"paddingbottom-command\" style=\"margin-right:4px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"paddingbottom-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"paddingbottom-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"paddingbottom-command\" style=\"margin-right:4px\">5</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-col\" style=\"margin:15px 0 0\">\n                            <div>\n                                <span>").concat(util.out('Border Radius'), "</span>:\n                            </div>\n                            <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                <button title=\"").concat(util.out('None'), "\" data-command=\"none\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('None'), "</button>\n                                <button title=\"").concat(util.out('SM'), "\" data-command=\"sm\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('SM'), "</button>\n                                <button title=\"").concat(util.out('Normal'), "\" data-command=\"normal\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('Normal'), "</button>\n                                <button title=\"").concat(util.out('MD'), "\" data-command=\"md\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('MD'), "</button>\n                                <button title=\"").concat(util.out('LG'), "\" data-command=\"lg\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('LG'), "</button>\n                                <button title=\"").concat(util.out('XL'), "\" data-command=\"xl\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('XL'), "</button>\n                                <button title=\"").concat(util.out('2XL'), "\" data-command=\"2xl\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('2XL'), "</button>\n                                <button title=\"").concat(util.out('3XL'), "\" data-command=\"3xl\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('3XL'), "</button>\n                                <button title=\"").concat(util.out('Full'), "\" data-command=\"full\" class=\"border-radius-command\" style=\"margin-right:4px\">").concat(util.out('Full'), "</button>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-row\" style=\"margin:15px 0 0\">\n                            <div class=\"flex flex-col\" style=\"margin-right: 20px;\">\n                                <div>\n                                    <span>").concat(util.out('Margin Left'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"0\" class=\"ml-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"1\" data-command=\"1\" class=\"ml-command\" style=\"margin-right:4px\">1</button>\n                                    <button title=\"2\" data-command=\"2\" class=\"ml-command\" style=\"margin-right:2px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"ml-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"ml-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"ml-command\" style=\"margin-right:4px\">5</button>\n                                </div>\n                            </div>\n\n                            <div class=\"flex flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Margin Right'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"0\" class=\"mr-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"1\" data-command=\"1\" class=\"mr-command\" style=\"margin-right:4px\">1</button>\n                                    <button title=\"2\" data-command=\"2\" class=\"mr-command\" style=\"margin-right:2px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"mr-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"mr-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"mr-command\" style=\"margin-right:4px\">5</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-row\" style=\"margin:15px 0 0\">\n                            <div class=\"flex flex-col\" style=\"margin-right: 20px;\">\n                                <div>\n                                    <span>").concat(util.out('Margin Top'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"0\" class=\"mt-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"1\" data-command=\"1\" class=\"mt-command\" style=\"margin-right:4px\">1</button>\n                                    <button title=\"2\" data-command=\"2\" class=\"mt-command\" style=\"margin-right:2px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"mt-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"mt-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"mt-command\" style=\"margin-right:4px\">5</button>\n                                </div>\n                            </div>\n\n                            <div class=\"flex flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Margin Bottom'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"0\" class=\"mb-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"1\" data-command=\"1\" class=\"mb-command\" style=\"margin-right:4px\">1</button>\n                                    <button title=\"2\" data-command=\"2\" class=\"mb-command\" style=\"margin-right:2px\">2</button>\n                                    <button title=\"3\" data-command=\"3\" class=\"mb-command\" style=\"margin-right:4px\">3</button>\n                                    <button title=\"4\" data-command=\"4\" class=\"mb-command\" style=\"margin-right:4px\">4</button>\n                                    <button title=\"5\" data-command=\"5\" class=\"mb-command\" style=\"margin-right:4px\">5</button>\n                                </div>\n                            </div>\n\n                        </div>\n\n                    </div>\n                    <div id=\"divButtonHover\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"button\">\n  \n                        <div class=\"flex flex-row\">\n                            <div class=\"flex-col\" style=\"margin-right: 40px;\">\n                                <div>\n                                    <span>").concat(util.out('Background Color'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('Background Color'), "\" class=\"bg-color-hover-command\" style=\"width:45px;height:40px;border:rgb(0 0 0 / 6%) 1px solid;margin-right:4px\"></button>\n                                </div>\n                            </div>\n                    \n                            <div class=\"flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Text Color'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('Dark'), "\" data-command=\"dark\" class=\"text-color-hover-command\" style=\"margin-right:4px\">").concat(util.out('Dark'), "</button>\n                                    <button title=\"").concat(util.out('Light'), "\" data-command=\"light\" class=\"text-color-hover-command\" style=\"margin-right:4px\">").concat(util.out('Light'), "</button>\n                                    <button title=\"").concat(util.out('Current'), "\" data-command=\"current\" class=\"text-color-hover-command\" style=\"margin-right:4px\">").concat(util.out('Current'), "</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-col\" style=\"margin:15px 0 0\">\n                            <div>\n                                <span>").concat(util.out('Border Color'), "</span>:\n                            </div>\n                            <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                <button title=\"").concat(util.out('Transparent'), "\" data-command=\"transparent\" class=\"border-color-hover-command\" style=\"margin-right:4px\">").concat(util.out('Transparent'), "</button>\n                                <button title=\"").concat(util.out('Current'), "\" data-command=\"current\" class=\"border-color-hover-command\" style=\"margin-right:4px\">").concat(util.out('Current'), "</button>\n                            </div>\n                        </div>\n\n                    </div>\n                    <div id=\"divButtonText\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"button\">\n\n                        <div class=\"flex flex-row\">\n                            <div class=\"flex flex-col\" style=\"width:250px;margin-right:40px;\">\n                                <div>\n                                    <span>").concat(util.out('Font Size'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"12\" data-command=\"12\" class=\"font-size-command\" style=\"margin-right:4px\">12</button>\n                                    <button title=\"13\" data-command=\"13\" class=\"font-size-command\" style=\"margin-right:4px\">13</button>\n                                    <button title=\"14\" data-command=\"14\" class=\"font-size-command\" style=\"margin-right:4px\">14</button>\n                                    <button title=\"15\" data-command=\"15\" class=\"font-size-command\" style=\"margin-right:4px\">15</button>\n                                    <button title=\"16\" data-command=\"16\" class=\"font-size-command\" style=\"margin-right:4px\">16</button>\n                                    <button title=\"17\" data-command=\"17\" class=\"font-size-command\" style=\"margin-right:4px\">17</button>\n                                    <button title=\"18\" data-command=\"18\" class=\"font-size-command\" style=\"margin-right:4px\">18</button>\n                                    <button title=\"19\" data-command=\"19\" class=\"font-size-command\" style=\"margin-right:4px\">19</button>\n                                    <button title=\"21\" data-command=\"21\" class=\"font-size-command\" style=\"margin-right:4px\">21</button>\n                                    <button title=\"24\" data-command=\"24\" class=\"font-size-command\" style=\"margin-right:4px\">24</button>\n                                    <button title=\"28\" data-command=\"28\" class=\"font-size-command\" style=\"margin-right:4px\">28</button>\n                                    <button title=\"32\" data-command=\"32\" class=\"font-size-command\" style=\"margin-right:4px\">32</button>\n                                </div>\n                            </div>\n\n                            <div class=\"flex flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Upper/Lower'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"").concat(util.out('Bold'), "\" class=\"textbold-command\" style=\"width:38px;font-family:serif;font-size:14px;text-transform:initial;margin-right:4px\">B</button>\n                                    <button title=\"").concat(util.out('Upper/Lower'), "\" class=\"textcase-command\" style=\"width:38px;font-family:serif;font-size:14px;text-transform:initial;margin-right:4px\">Aa</button>\n                                    <button title=\"").concat(util.out('Underline'), "\" class=\"textunderline-command\" style=\"width:38px;text-decoration:underline;font-family:serif;font-size:14px;text-transform:initial;margin-right:4px\">U</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex flex-row\" style=\"margin:15px 0 0\">\n                            <div class=\"flex flex-col\">\n                                <div>\n                                    <span>").concat(util.out('Letter Spacing'), "</span>:\n                                </div>\n                                <div class=\"flex flex-row flex-wrap\" style=\"margin-top:5px\">\n                                    <button title=\"0\" data-command=\"normal\" class=\"letter-spacing-command\" style=\"margin-right:4px\">0</button>\n                                    <button title=\"25\" data-command=\"wide\" class=\"letter-spacing-command\" style=\"margin-right:4px\">25</button>\n                                    <button title=\"50\" data-command=\"wider\" class=\"letter-spacing-command\" style=\"margin-right:4px\">50</button>\n                                    <button title=\"75\" data-command=\"75\" class=\"letter-spacing-command\" style=\"margin-right:4px\">75</button>\n                                    <button title=\"100\" data-command=\"widest\" class=\"letter-spacing-command\" style=\"margin-right:4px\">100</button>\n                                    <button title=\"125\" data-command=\"125\" class=\"letter-spacing-command\" style=\"margin-right:4px\">125</button>\n                                    <button title=\"150\" data-command=\"150\" class=\"letter-spacing-command\" style=\"margin-right:4px\">150</button>\n                                    <button title=\"175\" data-command=\"175\" class=\"letter-spacing-command\" style=\"margin-right:4px\">175</button>\n                                    <button title=\"200\" data-command=\"200\" class=\"letter-spacing-command\" style=\"margin-right:4px\">200</button>\n                                </div>\n                            </div>\n                        </div>\n                        \n                    </div>\n                    <div id=\"divMyButtons\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"button\">\n\n\n                        <button title=\"").concat(util.out('Save Current Button'), "\" class=\"input-save\" style=\"width:220px;position: relative;z-index: 1;\">").concat(util.out('Save Current Button'), "</button>\n                       \n                        <div id=\"divMyButtonList\"></div>\n\n                    </div>\n                    <div id=\"divButtonTemplates\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"button\">\n\n                        <div id=\"divButtonTemplateList\"></div>\n\n                    </div>\n                </div>\n            </div>\n            ");
      dom.appendHtml(builderStuff, html);
      buttonModal = builderStuff.querySelector('.is-modal.buttoneditor');
      var btnClose = buttonModal.querySelector('.is-modal-close');
      dom.addEventListener(btnClose, 'click', function () {
        dom.removeClass(buttonModal, 'active');
      });
      var btns;

      //background color
      var btnBgColor = buttonModal.querySelector('.bg-color-command');
      btnBgColor.addEventListener('click', function (e) {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // this.builder.simpleColorPicker((colorClass)=>{

        //     const activeButton = this.builder.activeButton||this.builder.activeLinkButton||this.builder.activeLink;

        //     dom.removeClassesByPrefix(activeButton, 'bg-');
        //     dom.addClass(activeButton, colorClass);

        //     this.applyDefault(activeButton);

        //     setTimeout(()=>{
        //         const currBg = dom.getStyle(activeButton,'background-color');
        //         btnBgColor.style.backgroundColor = currBg;
        //     },160);

        //     this.builder.opts.onChange();
        // });

        var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
        var elm = e.target;
        _this.builder.colorPicker.open(function (color) {
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          activeButton.style.backgroundColor = color;
          activeButton.setAttribute('data-bg', color);
          dom.removeClassesByPrefix(activeButton, 'bg-');
          elm.style.backgroundColor = color; // preview

          //Trigger Change event
          _this.builder.opts.onChange();
        }, activeButton.style.backgroundColor, function () {
          btnBgColor.removeAttribute('data-focus');
          btnBgColor.focus();
        });
        btnBgColor.setAttribute('data-focus', true);
      });

      //text color
      var btnTextColor = buttonModal.querySelector('.text-color-command');
      btnTextColor.addEventListener('click', function (e) {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // this.builder.simpleColorPicker((colorClass)=>{

        //     const activeButton = this.builder.activeButton||this.builder.activeLinkButton||this.builder.activeLink;

        //     dom.removeClassesByPrefix(activeButton, 'text-');
        //     dom.addClass(activeButton, colorClass);

        //     this.applyDefault(activeButton);

        //     setTimeout(function(){
        //         const currColor = dom.getStyle(activeButton,'color');
        //         btnTextColor.style.backgroundColor = currColor;
        //     },160);

        //     this.builder.opts.onChange();

        // }, 'text');

        var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
        var elm = e.target;
        _this.builder.colorPicker.open(function (color) {
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          activeButton.style.color = color;
          dom.removeClassesByPrefix(activeButton, 'text-');
          elm.style.backgroundColor = color; // preview

          //Trigger Change event
          _this.builder.opts.onChange();
        }, activeButton.style.color, function () {
          btnTextColor.removeAttribute('data-focus');
          btnTextColor.focus();
        });
        btnTextColor.setAttribute('data-focus', true);
      });

      //hover background color
      var btnHoverBgColor = buttonModal.querySelector('.bg-color-hover-command');
      btnHoverBgColor.addEventListener('click', function (e) {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // this.builder.simpleColorPicker((colorClass)=>{

        //     const activeButton = this.builder.activeButton||this.builder.activeLinkButton||this.builder.activeLink;

        //     dom.removeClassesByPrefix(activeButton, 'hover:bg-');
        //     if(colorClass) dom.addClass(activeButton, 'hover:' + colorClass);

        //     this.applyDefault(activeButton);

        //     this.getVisibleBgColor(colorClass, (color)=>{
        //         btnHoverBgColor.style.backgroundColor = color;
        //     });

        //     this.builder.opts.onChange();
        // });

        var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
        var hoverbgcolor = activeButton.getAttribute('data-hover-bg');
        var elm = e.target;
        _this.builder.colorPicker.open(function (color) {
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          if (color === '') {
            activeButton.removeAttribute('data-bg');
            activeButton.removeAttribute('data-hover-bg');
            activeButton.removeAttribute('onmouseover');
            activeButton.removeAttribute('onmouseout');
          } else {
            activeButton.setAttribute('data-bg', activeButton.style.backgroundColor);
            activeButton.setAttribute('data-hover-bg', color);
            activeButton.setAttribute('onmouseover', 'if(this.getAttribute(\'data-hover-bg\'))this.style.backgroundColor=this.getAttribute(\'data-hover-bg\');');
            activeButton.setAttribute('onmouseout', 'if(this.getAttribute(\'data-bg\'))this.style.backgroundColor=this.getAttribute(\'data-bg\');else this.style.backgroundColor=\'\'');
          }
          dom.removeClassesByPrefix(activeButton, 'hover:bg-');
          elm.style.backgroundColor = color; // preview

          //Trigger Change event
          _this.builder.opts.onChange();
        }, hoverbgcolor ? hoverbgcolor : '', function () {
          btnHoverBgColor.removeAttribute('data-focus');
          btnHoverBgColor.focus();
        });
        btnHoverBgColor.setAttribute('data-focus', true);
      });

      //hover text color
      var btnHoverTextColor = buttonModal.querySelectorAll('.text-color-hover-command');
      btnHoverTextColor.forEach(function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo(true); // checkLater = true

          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          if (activeButton.classList) {
            activeButton.classList.forEach(function (item) {
              if (item.indexOf('hover:text-') === 0) {
                dom.removeClass(activeButton, item);
              }
            });
          }
          if (val === 'dark') dom.addClass(activeButton, 'hover:text-black');else if (val === 'light') dom.addClass(activeButton, 'hover:text-white');else if (val === 'current') {
            // dom.addClass(activeButton, 'hover:text-current');
            // Do Nothing => clear (not set)
          }
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.text-color-hover-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //border color
      btns = buttonModal.querySelectorAll('.border-color-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClass(activeButton, 'border-transparent');
          dom.removeClass(activeButton, 'border-current');
          if (val === 'transparent') dom.addClass(activeButton, 'border-transparent');else if (val === 'current') dom.addClass(activeButton, 'border-current');
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.border-color-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //hover border color
      btns = buttonModal.querySelectorAll('.border-color-hover-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClass(activeButton, 'hover:border-transparent');
          dom.removeClass(activeButton, 'hover:border-current');
          if (val === 'transparent') dom.addClass(activeButton, 'hover:border-transparent');else if (val === 'current') dom.addClass(activeButton, 'hover:border-current');
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.border-color-hover-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //border width
      btns = buttonModal.querySelectorAll('.border-width-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClass(activeButton, 'border-0');
          dom.removeClass(activeButton, 'border-2');
          dom.removeClass(activeButton, 'border');
          if (val === '0') dom.addClass(activeButton, 'border-0');else if (val === '1') dom.addClass(activeButton, 'border');else if (val === '2') dom.addClass(activeButton, 'border-2');
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.border-width-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //border radius
      btns = buttonModal.querySelectorAll('.border-radius-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClass(activeButton, 'rounded');
          dom.removeClassesByPrefix(activeButton, 'rounded-');
          if (val === 'normal') dom.addClass(activeButton, 'rounded');else dom.addClass(activeButton, 'rounded-' + val);
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.border-radius-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //padding x
      btns = buttonModal.querySelectorAll('.paddingx-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'px-');
          if (val === '2') {
            dom.addClass(activeButton, 'px-2');
          }
          if (val === '3') {
            dom.addClass(activeButton, 'px-3');
          }
          if (val === '4') {
            dom.addClass(activeButton, 'px-4');
          }
          if (val === '5') {
            dom.addClass(activeButton, 'px-5');
          }
          if (val === '6') {
            dom.addClass(activeButton, 'px-6');
          }
          if (val === '7') {
            dom.addClass(activeButton, 'px-7');
          }
          if (val === '8') {
            dom.addClass(activeButton, 'px-8');
          }
          if (val === '9') {
            dom.addClass(activeButton, 'px-9');
          }
          if (val === '10') {
            dom.addClass(activeButton, 'px-10');
          }
          if (val === '11') {
            dom.addClass(activeButton, 'px-11');
          }
          if (val === '12') {
            dom.addClass(activeButton, 'px-12');
          }
          if (val === '14') {
            dom.addClass(activeButton, 'px-14');
          }
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.paddingx-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //padding y
      btns = buttonModal.querySelectorAll('.paddingy-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'py-');
          if (val === '0') {
            dom.addClass(activeButton, 'py-0');
          }
          if (val === '1') {
            dom.addClass(activeButton, 'py-1');
          }
          if (val === '2') {
            dom.addClass(activeButton, 'py-2');
          }
          if (val === '3') {
            dom.addClass(activeButton, 'py-3');
          }
          if (val === '4') {
            dom.addClass(activeButton, 'py-4');
          }
          if (val === '5') {
            dom.addClass(activeButton, 'py-5');
          }
          if (val === '6') {
            dom.addClass(activeButton, 'py-6');
          }
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.paddingy-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //padding top
      btns = buttonModal.querySelectorAll('.paddingtop-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'pt-');
          if (val === '0') {
            dom.addClass(activeButton, 'pt-0');
          }
          if (val === '1') {
            dom.addClass(activeButton, 'pt-1');
          }
          if (val === '2') {
            dom.addClass(activeButton, 'pt-2');
          }
          if (val === '3') {
            dom.addClass(activeButton, 'pt-3');
          }
          if (val === '4') {
            dom.addClass(activeButton, 'pt-4');
          }
          if (val === '5') {
            dom.addClass(activeButton, 'pt-5');
          }
          if (val === '6') {
            dom.addClass(activeButton, 'pt-6');
          }

          // Cleanup
          if ((activeButton.classList.contains('pt-0') || activeButton.classList.contains('pt-1') || activeButton.classList.contains('pt-2') || activeButton.classList.contains('pt-3') || activeButton.classList.contains('pt-4') || activeButton.classList.contains('pt-5')) && (activeButton.classList.contains('pt-0') || activeButton.classList.contains('pb-1') || activeButton.classList.contains('pb-2') || activeButton.classList.contains('pb-3') || activeButton.classList.contains('pb-4') || activeButton.classList.contains('pb-5'))) {
            activeButton.classList.remove('py-0');
            activeButton.classList.remove('py-1');
            activeButton.classList.remove('py-2');
            activeButton.classList.remove('py-3');
            activeButton.classList.remove('py-4');
            activeButton.classList.remove('p5-4');
          }
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.paddingtop-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //padding bottom
      btns = buttonModal.querySelectorAll('.paddingbottom-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'pb-');
          if (val === '0') {
            dom.addClass(activeButton, 'pb-0');
          }
          if (val === '1') {
            dom.addClass(activeButton, 'pb-1');
          }
          if (val === '2') {
            dom.addClass(activeButton, 'pb-2');
          }
          if (val === '3') {
            dom.addClass(activeButton, 'pb-3');
          }
          if (val === '4') {
            dom.addClass(activeButton, 'pb-4');
          }
          if (val === '5') {
            dom.addClass(activeButton, 'pb-5');
          }
          if (val === '6') {
            dom.addClass(activeButton, 'pb-6');
          }

          // Cleanup
          if ((activeButton.classList.contains('pt-0') || activeButton.classList.contains('pt-1') || activeButton.classList.contains('pt-2') || activeButton.classList.contains('pt-3') || activeButton.classList.contains('pt-4') || activeButton.classList.contains('pt-5')) && (activeButton.classList.contains('pt-0') || activeButton.classList.contains('pb-1') || activeButton.classList.contains('pb-2') || activeButton.classList.contains('pb-3') || activeButton.classList.contains('pb-4') || activeButton.classList.contains('pb-5'))) {
            activeButton.classList.remove('py-0');
            activeButton.classList.remove('py-1');
            activeButton.classList.remove('py-2');
            activeButton.classList.remove('py-3');
            activeButton.classList.remove('py-4');
            activeButton.classList.remove('p5-4');
          }
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.paddingbottom-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //Font size
      btns = buttonModal.querySelectorAll('.font-size-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'size-');
          dom.addClass(activeButton, 'size-' + val);
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.font-size-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //width
      btns = buttonModal.querySelectorAll('.width-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          if (val === 'auto') {
            activeButton.classList.remove('flex');
            activeButton.classList.remove('justify-center');
            activeButton.classList.remove('items-center');
            activeButton.classList.add('inline-block');
          }
          if (val === 'full') {
            activeButton.classList.remove('inline-block');
            activeButton.classList.add('flex');
            activeButton.classList.add('justify-center');
            activeButton.classList.add('items-center');
          }
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.width-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //text case
      var btnTextCase = buttonModal.querySelector('.textcase-command');
      btnTextCase.addEventListener('click', function () {
        _this.builder.uo.saveForUndo();
        var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
        if (dom.hasClass(activeButton, 'uppercase')) {
          dom.removeClass(activeButton, 'uppercase');
        } else {
          dom.addClass(activeButton, 'uppercase');
        }
        _this.applyDefault(activeButton);

        // Button on/off
        var btnTextCase = buttonModal.querySelector('.textcase-command');
        if (dom.hasClass(btnTextCase, 'on')) {
          dom.removeClass(btnTextCase, 'on');
        } else {
          dom.addClass(btnTextCase, 'on');
        }
        _this.builder.opts.onChange();
      });

      //text underline
      var btnTextUnderline = buttonModal.querySelector('.textunderline-command');
      btnTextUnderline.addEventListener('click', function () {
        _this.builder.uo.saveForUndo();
        var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
        if (dom.hasClass(activeButton, 'underline')) {
          dom.removeClass(activeButton, 'underline');
          dom.addClass(activeButton, 'no-underline');
        } else {
          dom.removeClass(activeButton, 'no-underline');
          dom.addClass(activeButton, 'underline');
        }
        _this.applyDefault(activeButton);

        // Button on/off
        var btnTextUnderline = buttonModal.querySelector('.textunderline-command');
        if (dom.hasClass(btnTextUnderline, 'on')) {
          dom.removeClass(btnTextUnderline, 'on');
        } else {
          dom.addClass(btnTextUnderline, 'on');
        }
        _this.builder.opts.onChange();
      });

      //text bold
      var btnTextBold = buttonModal.querySelector('.textbold-command');
      btnTextBold.addEventListener('click', function () {
        _this.builder.uo.saveForUndo();
        var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
        if (dom.hasClass(activeButton, 'font-semibold')) {
          dom.removeClass(activeButton, 'font-semibold');
          dom.addClass(activeButton, 'font-normal');
        } else {
          dom.removeClass(activeButton, 'font-normal');
          dom.addClass(activeButton, 'font-semibold');
        }
        _this.applyDefault(activeButton);

        // Button on/off
        var btnTextBold = buttonModal.querySelector('.textbold-command');
        if (dom.hasClass(btnTextBold, 'on')) {
          dom.removeClass(btnTextBold, 'on');
        } else {
          dom.addClass(btnTextBold, 'on');
        }
        _this.builder.opts.onChange();
      });

      //Letter Spacing
      btns = buttonModal.querySelectorAll('.letter-spacing-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'tracking-');
          dom.addClass(activeButton, 'tracking-' + val);
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.letter-spacing-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //Margin Left
      btns = buttonModal.querySelectorAll('.ml-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'ml-');
          dom.addClass(activeButton, 'ml-' + val);
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.ml-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //Margin Right
      btns = buttonModal.querySelectorAll('.mr-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'mr-');
          dom.addClass(activeButton, 'mr-' + val);
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.mr-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //Margin Top
      btns = buttonModal.querySelectorAll('.mt-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'mt-');
          dom.addClass(activeButton, 'mt-' + val);
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.mt-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //Margin Bottom
      btns = buttonModal.querySelectorAll('.mb-command');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function () {
          _this.builder.uo.saveForUndo();
          var val = btn.getAttribute('data-command');
          var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
          dom.removeClassesByPrefix(activeButton, 'mb-');
          dom.addClass(activeButton, 'mb-' + val);
          _this.applyDefault(activeButton);

          // Button on/off
          var items = buttonModal.querySelectorAll('.mb-command');
          items.forEach(function (item) {
            dom.removeClass(item, 'on');
          });
          dom.addClass(btn, 'on');
          _this.builder.opts.onChange();
        });
      });

      //save button
      var btnSave = buttonModal.querySelector('.input-save');
      btnSave.addEventListener('click', function () {
        var activeButton = _this.builder.activeButton || _this.builder.activeLinkButton || _this.builder.activeLink;
        var mybuttons = [];
        if (localStorage.getItem('_savedbuttons') != null) {
          mybuttons = JSON.parse(localStorage.getItem('_savedbuttons'));
        }

        // cleanup before saving
        dom.removeClass(activeButton, 'active');
        dom.removeClass(activeButton, 'elm-active');
        var dataBg = activeButton.getAttribute('data-bg');
        // if(!dataBg) {
        //     if(activeButton.style.backgroundColor) dataBg=activeButton.style.backgroundColor;
        // }
        var dataHoverBg = activeButton.getAttribute('data-hover-bg');
        // const color = activeButton.style.color;
        var cssText = activeButton.style.cssText;
        mybuttons.push({
          id: mybuttons.length,
          className: activeButton.className,
          bg: dataBg ? dataBg : '',
          hoverBg: dataHoverBg ? dataHoverBg : '',
          // color: color?color:'',
          cssText: cssText
        });
        localStorage.setItem('_savedbuttons', JSON.stringify(mybuttons));
        _this.renderMyButtons();
      });
      new tabs({
        element: buttonModal
      });
      new contentbuilder_draggable({
        selector: '.is-modal.buttoneditor .is-draggable'
      });
    }
    this.buttonModal = buttonModal;
  }
  buttoneditor_createClass(ButtonEditor, [{
    key: "open",
    value: function open() {
      // dom.addClass(this.buttonModal, 'active');
      this.util.showModal(this.buttonModal, false);
      this.realtime();
      this.renderMyButtons();
      this.renderTemplates();
    }
  }, {
    key: "realtime",
    value: function realtime() {
      var _this2 = this;
      var dom = this.dom;
      var activeButton = this.builder.activeButton || this.builder.activeLinkButton || this.builder.activeLink;
      var btnBgColor = this.buttonModal.querySelector('.bg-color-command');
      btnBgColor.style.backgroundColor = '';
      var currColor;
      var btnTextColor = this.buttonModal.querySelector('.text-color-command');
      btnTextColor.style.backgroundColor = '';
      var btnHoverBgColor = this.buttonModal.querySelector('.bg-color-hover-command');
      btnHoverBgColor.style.backgroundColor = '';
      if (activeButton.classList) {
        activeButton.classList.forEach(function (item) {
          if (item.indexOf('hover:bg-') === 0) {
            _this2.getVisibleBgColor(item.replace('hover:', ''), function (color) {
              btnHoverBgColor.style.backgroundColor = color;
              activeButton.setAttribute('data-hover-bg', color); //new inline

              if (!activeButton.hasAttribute('data-bg')) {
                // fix needed data-bg
                activeButton.setAttribute('data-bg', btnBgColor.style.backgroundColor); // needed by hover
              }

              activeButton.setAttribute('onmouseover', 'if(this.getAttribute(\'data-hover-bg\'))this.style.backgroundColor=this.getAttribute(\'data-hover-bg\');');
              activeButton.setAttribute('onmouseout', 'if(this.getAttribute(\'data-bg\'))this.style.backgroundColor=this.getAttribute(\'data-bg\');else this.style.backgroundColor=\'\'');
            });
          }
          if (item.indexOf('bg-') === 0) {
            _this2.getVisibleBgColor(item, function (color) {
              btnBgColor.style.backgroundColor = color;
              activeButton.setAttribute('data-bg', color); //new inline
            });
          }

          if (item.indexOf('text-') === 0) {
            _this2.getVisibleTextColor(item, function (color) {
              btnTextColor.style.backgroundColor = color;
              currColor = color;
            });
          }
        });
      }
      if (!currColor) {
        // if no text-[color] found
        currColor = dom.getStyle(activeButton, 'color');
        btnTextColor.style.backgroundColor = currColor;
      }

      // NEW: inline color
      if (activeButton.hasAttribute('data-bg')) {
        btnBgColor.style.backgroundColor = activeButton.getAttribute('data-bg');
      } else {
        if (activeButton.style.backgroundColor) {
          btnBgColor.style.backgroundColor = activeButton.style.backgroundColor;
        }
      }
      if (activeButton.getAttribute('data-hover-bg')) btnHoverBgColor.style.backgroundColor = activeButton.getAttribute('data-hover-bg');
      if (activeButton.style.color) btnTextColor.style.backgroundColor = activeButton.style.color;
      var btn;
      btn = this.buttonModal.querySelector('.text-color-hover-command.on');
      dom.removeClass(btn, 'on');
      if (dom.hasClass(activeButton, 'hover:text-black')) {
        btn = this.buttonModal.querySelector('.text-color-hover-command[data-command="dark"]');
        dom.addClass(btn, 'on');
      } else if (dom.hasClass(activeButton, 'hover:text-white')) {
        btn = this.buttonModal.querySelector('.text-color-hover-command[data-command="light"]');
        dom.addClass(btn, 'on');
      } else {
        btn = this.buttonModal.querySelector('.text-color-hover-command[data-command="current"]');
        dom.addClass(btn, 'on');
      }
      btn = this.buttonModal.querySelector('.border-color-hover-command.on');
      dom.removeClass(btn, 'on');
      if (dom.hasClass(activeButton, 'hover:border-transparent')) {
        btn = this.buttonModal.querySelector('.border-color-hover-command[data-command="transparent"]');
        dom.addClass(btn, 'on');
      } else if (dom.hasClass(activeButton, 'hover:border-current')) {
        btn = this.buttonModal.querySelector('.border-color-hover-command[data-command="current"]');
        dom.addClass(btn, 'on');
      }
      btn = this.buttonModal.querySelector('.border-color-command.on');
      dom.removeClass(btn, 'on');
      if (dom.hasClass(activeButton, 'border-transparent')) {
        btn = this.buttonModal.querySelector('.border-color-command[data-command="transparent"]');
        dom.addClass(btn, 'on');
      } else if (dom.hasClass(activeButton, 'border-current')) {
        btn = this.buttonModal.querySelector('.border-color-command[data-command="current"]');
        dom.addClass(btn, 'on');
      }
      btn = this.buttonModal.querySelector('.width-command.on');
      dom.removeClass(btn, 'on');
      if (dom.hasClass(activeButton, 'flex')) {
        btn = this.buttonModal.querySelector('.width-command[data-command="full"]');
        dom.addClass(btn, 'on');
      } else {
        btn = this.buttonModal.querySelector('.width-command[data-command="auto"]');
        dom.addClass(btn, 'on');
      }
      btn = this.buttonModal.querySelector('.textcase-command');
      if (dom.hasClass(activeButton, 'uppercase')) {
        dom.addClass(btn, 'on');
      } else {
        dom.removeClass(btn, 'on');
      }
      btn = this.buttonModal.querySelector('.textunderline-command');
      if (dom.hasClass(activeButton, 'underline')) {
        dom.addClass(btn, 'on');
      } else {
        dom.removeClass(btn, 'on');
      }
      btn = this.buttonModal.querySelector('.font-size-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.paddingx-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.paddingy-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.paddingtop-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.paddingbottom-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.border-radius-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.letter-spacing-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.ml-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.mr-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.mt-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.mb-command.on');
      dom.removeClass(btn, 'on');
      btn = this.buttonModal.querySelector('.textbold-command');
      if (dom.hasClass(activeButton, 'font-semibold')) {
        dom.addClass(btn, 'on');
      } else {
        dom.removeClass(btn, 'on');
      }
      if (dom.hasClass(activeButton, 'rounded')) {
        btn = this.buttonModal.querySelector('.border-radius-command[data-command="normal"]');
        dom.addClass(btn, 'on');
      }
      btn = this.buttonModal.querySelector('.border-width-command.on');
      dom.removeClass(btn, 'on');
      if (dom.hasClass(activeButton, 'border-0')) {
        btn = this.buttonModal.querySelector('.border-width-command[data-command="0"]');
        dom.addClass(btn, 'on');
      } else if (dom.hasClass(activeButton, 'border-2')) {
        btn = this.buttonModal.querySelector('.border-width-command[data-command="2"]');
        dom.addClass(btn, 'on');
      } else if (dom.hasClass(activeButton, 'border')) {
        btn = this.buttonModal.querySelector('.border-width-command[data-command="1"]');
        dom.addClass(btn, 'on');
      }
      if (activeButton.classList) {
        activeButton.classList.forEach(function (item) {
          if (item.indexOf('size-') === 0) {
            var val = item.replace('size-', '');
            var _btn = _this2.buttonModal.querySelector(".font-size-command[data-command=\"".concat(val, "\"]"));
            dom.addClass(_btn, 'on');
          }
          if (item.indexOf('px-') === 0) {
            var _val = item.replace('px-', '');
            var _btn2 = _this2.buttonModal.querySelector(".paddingx-command[data-command=\"".concat(_val, "\"]"));
            dom.addClass(_btn2, 'on');
          }
          if (item.indexOf('py-') === 0) {
            var _val2 = item.replace('py-', '');
            var _btn3 = _this2.buttonModal.querySelector(".paddingy-command[data-command=\"".concat(_val2, "\"]"));
            dom.addClass(_btn3, 'on');
            if (!(activeButton.classList.contains('pt-0') || activeButton.classList.contains('pt-1') || activeButton.classList.contains('pt-2') || activeButton.classList.contains('pt-3') || activeButton.classList.contains('pt-4') || activeButton.classList.contains('pt-5'))) {
              var _btn4 = _this2.buttonModal.querySelector(".paddingtop-command[data-command=\"".concat(_val2, "\"]"));
              dom.addClass(_btn4, 'on');
            }
            if (!(activeButton.classList.contains('pb-0') || activeButton.classList.contains('pb-1') || activeButton.classList.contains('pb-2') || activeButton.classList.contains('pb-3') || activeButton.classList.contains('pb-4') || activeButton.classList.contains('pb-5'))) {
              var _btn5 = _this2.buttonModal.querySelector(".paddingbottom-command[data-command=\"".concat(_val2, "\"]"));
              dom.addClass(_btn5, 'on');
            }
          }
          if (item.indexOf('pt-') === 0) {
            var _val3 = item.replace('pt-', '');
            var _btn6 = _this2.buttonModal.querySelector(".paddingtop-command[data-command=\"".concat(_val3, "\"]"));
            dom.addClass(_btn6, 'on');
          }
          if (item.indexOf('pb-') === 0) {
            var _val4 = item.replace('pb-', '');
            var _btn7 = _this2.buttonModal.querySelector(".paddingbottom-command[data-command=\"".concat(_val4, "\"]"));
            dom.addClass(_btn7, 'on');
          }
          if (item.indexOf('rounded-') === 0) {
            var _val5 = item.replace('rounded-', '');
            var _btn8 = _this2.buttonModal.querySelector(".border-radius-command[data-command=\"".concat(_val5, "\"]"));
            dom.addClass(_btn8, 'on');
          }
          if (item.indexOf('tracking-') === 0) {
            var _val6 = item.replace('tracking-', '');
            var _btn9 = _this2.buttonModal.querySelector(".letter-spacing-command[data-command=\"".concat(_val6, "\"]"));
            dom.addClass(_btn9, 'on');
          }
          if (item.indexOf('ml-') === 0) {
            var _val7 = item.replace('ml-', '');
            var _btn10 = _this2.buttonModal.querySelector(".ml-command[data-command=\"".concat(_val7, "\"]"));
            dom.addClass(_btn10, 'on');
          }
          if (item.indexOf('mr-') === 0) {
            var _val8 = item.replace('mr-', '');
            var _btn11 = _this2.buttonModal.querySelector(".mr-command[data-command=\"".concat(_val8, "\"]"));
            dom.addClass(_btn11, 'on');
          }
          if (item.indexOf('mt-') === 0) {
            var _val9 = item.replace('mt-', '');
            var _btn12 = _this2.buttonModal.querySelector(".mt-command[data-command=\"".concat(_val9, "\"]"));
            dom.addClass(_btn12, 'on');
          }
          if (item.indexOf('mb-') === 0) {
            var _val10 = item.replace('mb-', '');
            var _btn13 = _this2.buttonModal.querySelector(".mb-command[data-command=\"".concat(_val10, "\"]"));
            dom.addClass(_btn13, 'on');
          }
        });
      }
    }
  }, {
    key: "hide",
    value: function hide() {
      var dom = this.dom;
      dom.removeClass(this.buttonModal, 'active');
    }
  }, {
    key: "getVisibleBgColor",
    value: function getVisibleBgColor(className, callback) {
      var dom = this.dom;
      var elm = document.createElement('div');
      elm.className = className;
      this.builderStuff.appendChild(elm);
      var currColor = dom.getStyle(elm, 'background-color');
      callback(currColor);
      this.builderStuff.removeChild(elm);
    }
  }, {
    key: "getVisibleTextColor",
    value: function getVisibleTextColor(className, callback) {
      var dom = this.dom;
      var elm = document.createElement('div');
      elm.className = className;
      this.builderStuff.appendChild(elm);
      var currColor = dom.getStyle(elm, 'color');
      callback(currColor);
      this.builderStuff.removeChild(elm);
    }
  }, {
    key: "renderTemplates",
    value: function renderTemplates() {
      var _this3 = this;
      var templates = [/* rounded */

      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-7 border-current hover:border-current font-normal leading-14 rounded-full tracking-wide\">Read More</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-7 text-black leading-14 rounded-full border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-7 font-normal leading-14 border-transparent rounded-full size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(255, 127, 0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-7 font-normal leading-14 border-transparent rounded-full size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(83,98,208);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-7 font-normal leading-14 border-transparent rounded-full size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-7 border-current hover:border-current font-normal leading-14 tracking-wide rounded-full\" style=\"color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, /* colors */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-7 font-normal leading-14 border-transparent rounded-full size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(0, 200, 218);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-7 font-normal leading-14 border-transparent rounded-full size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(55, 148, 59);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-7 font-normal leading-14 border-transparent rounded-full size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(233,2,0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-7 font-normal leading-14 border-transparent rounded-full size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(254, 222, 76);\">Get Started</a>\n                "
      }, /* square */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 border-current hover:border-current font-normal leading-14 rounded tracking-wide\">Read More</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 text-black leading-14 rounded border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-6 font-normal leading-14 border-transparent rounded size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(255, 127, 0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-6 font-normal leading-14 border-transparent rounded size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(83,98,208);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-6 font-normal leading-14 border-transparent rounded size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 border-current hover:border-current font-normal leading-14 tracking-wide rounded\" style=\"color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, /* colors */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-6 font-normal leading-14 border-transparent rounded size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(0, 200, 218);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-6 font-normal leading-14 border-transparent rounded size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(55, 148, 59);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-6 font-normal leading-14 border-transparent rounded size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(233,2,0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-6 font-normal leading-14 border-transparent rounded ml-0 mt-1 size-17 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(254, 222, 76);\">Get Started</a>\n                "
      }, /* MEDIUM */

      /* rounded */

      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 border-current hover:border-current font-normal leading-relaxed rounded-full tracking-wide\">Read More</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 text-black leading-relaxed rounded-full border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-9 font-normal leading-relaxed border-transparent rounded-full size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(255, 127, 0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-9 font-normal leading-relaxed border-transparent rounded-full size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(83,98,208);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-9 font-normal leading-relaxed border-transparent rounded-full size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 border-current hover:border-current font-normal leading-relaxed tracking-wide rounded-full\" style=\"color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, /* colors */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-9 font-normal leading-relaxed border-transparent rounded-full size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(0, 200, 218);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-9 font-normal leading-relaxed border-transparent rounded-full size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(55, 148, 59);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-9 font-normal leading-relaxed border-transparent rounded-full size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(233,2,0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-9 font-normal leading-relaxed border-transparent rounded-full size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(254, 222, 76);\">Get Started</a>\n                "
      }, /* square */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-8 border-current hover:border-current font-normal leading-relaxed rounded tracking-wide\">Read More</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-8 text-black leading-relaxed rounded border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-8 font-normal leading-relaxed border-transparent rounded size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(255, 127, 0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-8 font-normal leading-relaxed border-transparent rounded size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(83,98,208);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-8 font-normal leading-relaxed border-transparent rounded size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-8 border-current hover:border-current font-normal leading-relaxed tracking-wide rounded\" style=\"color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, /* colors */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-8 font-normal leading-relaxed border-transparent rounded size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(0, 200, 218);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-8 font-normal leading-relaxed border-transparent rounded size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(55, 148, 59);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-8 font-normal leading-relaxed border-transparent rounded size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(233,2,0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 px-8 font-normal leading-relaxed border-transparent rounded ml-0 mt-1 size-18 tracking-wide hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(254, 222, 76);\">Get Started</a>\n                "
      }, /* LARGER */

      /* rounded */

      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 size-16 px-12 uppercase border-current hover:border-current font-normal leading-relaxed rounded-full tracking-75\">Read More</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 size-16 px-12 uppercase text-black leading-relaxed rounded-full border-transparent hover:border-transparent font-normal tracking-75\" style=\"background-color: rgb(240, 240, 240);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-12 uppercase font-normal leading-relaxed border-transparent rounded-full size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(255, 127, 0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-12 uppercase font-normal leading-relaxed border-transparent rounded-full size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(83,98,208);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-12 uppercase font-normal leading-relaxed border-transparent rounded-full size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 size-16 px-12 uppercase border-current hover:border-current font-normal leading-relaxed tracking-75 rounded-full\" style=\"color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, /* colors */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-12 uppercase font-normal leading-relaxed border-transparent rounded-full size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(0, 200, 218);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-12 uppercase font-normal leading-relaxed border-transparent rounded-full size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(55, 148, 59);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-12 uppercase font-normal leading-relaxed border-transparent rounded-full size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(233,2,0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-12 uppercase font-normal leading-relaxed border-transparent rounded-full size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(254, 222, 76);\">Get Started</a>\n                "
      }, /* square */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 size-16 px-11 uppercase border-current hover:border-current font-normal leading-relaxed rounded tracking-75\">Read More</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 size-16 px-11 uppercase text-black leading-relaxed rounded border-transparent hover:border-transparent font-normal tracking-75\" style=\"background-color: rgb(240, 240, 240);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-11 uppercase font-normal leading-relaxed border-transparent rounded size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(255, 127, 0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-11 uppercase font-normal leading-relaxed border-transparent rounded size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(83,98,208);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-11 uppercase font-normal leading-relaxed border-transparent rounded size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 size-16 px-11 uppercase border-current hover:border-current font-normal leading-relaxed tracking-75 rounded\" style=\"color: rgb(255, 255, 255);\">Get Started</a>\n                "
      }, /* colors */
      {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-11 uppercase font-normal leading-relaxed border-transparent rounded size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(0, 200, 218);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-11 uppercase font-normal leading-relaxed border-transparent rounded size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(55, 148, 59);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-11 uppercase font-normal leading-relaxed border-transparent rounded size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(255, 255, 255); background-color: rgb(233,2,0);\">Get Started</a>\n                "
      }, {
        html: "\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 pt-3 pb-3 px-11 uppercase font-normal leading-relaxed border-transparent rounded ml-0 mt-1 size-16 tracking-75 hover:border-transparent\" style=\"color: rgb(0, 0, 0); background-color: rgb(254, 222, 76);\">Get Started</a>\n                "
      }, {
        text: 'Order Now',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid rounded-full border-current ml-1 mr-1 px-8 py-2 text-pink-600 hover:text-white  bg-white hover:bg-pink-500 hover:border-transparent size-18 font-semibold tracking-75 leading-relaxed'
      }, {
        text: 'Explore',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline font-semibold border-2 border-solid tracking-200 rounded-full border-current size-12 ml-1 mr-1 py-0 px-3 text-indigo-600 hover:text-white bg-white hover:bg-indigo-500 hover:border-transparent leading-relaxed'
      }, {
        text: 'View Demo',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid border-transparent ml-1 mr-1 hover:border-transparent rounded bg-gray-200 hover:bg-gray-300 size-16 py-1 px-5 font-normal tracking-wide text-gray-800 leading-relaxed'
      }, {
        text: 'Get Started',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid ml-1 mr-1 rounded size-16 text-black py-1 px-5 font-normal border-current hover: hover:border-current tracking-wide leading-relaxed'
      }, {
        text: 'Create',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid border-transparent ml-1 mr-1 hover:border-transparent size-12 rounded bg-yellow-300 text-black bg-white hover:bg-yellow-400 font-normal px-3 py-0 tracking-75 leading-relaxed'
      }, {
        text: 'Hello!',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid border-current ml-1 mr-1 hover:text-white hover:border-transparent rounded-lg size-24 font-normal py-2 tracking-150 px-12 text-orange-500 bg-white hover:bg-orange-500 leading-relaxed'
      }, {
        text: 'Build',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid border-transparent ml-1 mr-1 text-violet-700 hover:border-transparent hover:bg-cyan-200 rounded uppercase size-12 tracking-75 px-4 py-1 font-semibold bg-cyan-200 leading-relaxed'
      }, {
        text: 'Contact',
        className: 'transition-all inline-block whitespace-nowrap border-2 border-solid rounded-none no-underline hover:border-transparent ml-1 mr-1 cursor-pointer bg-white text-red-600 border-current hover:bg-red-600 hover:text-white uppercase size-12 font-semibold py-2 px-6 tracking-150 leading-relaxed'
      }, {
        text: 'Read More',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer border-2 border-solid border-transparent ml-1 mr-1 hover:border-transparent rounded size-16 py-1 px-5 font-normal tracking-wide text-gray-800 underline leading-relaxed'
      }, {
        text: 'Send a Message',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid ml-1 mr-1 rounded tracking-75 uppercase px-6 py-2 size-12 hover:border-transparent font-semibold bg-gray-200 border-transparent hover:bg-gray-300 text-gray-800 leading-relaxed'
      }, {
        text: 'Our Works',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid ml-1 mr-1 rounded tracking-75 uppercase px-6 py-2 size-12 border-current hover:text-white hover:border-transparent hover:bg-indigo-500 text-indigo-500 font-semibold leading-relaxed'
      }, {
        text: 'Read More',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-1 tracking-75 uppercase py-2 size-14 px-8 rounded font-normal ml-1 border-transparent bg-gray-200 hover:bg-gray-300 hover:border-transparent text-gray-800 leading-relaxed'
      }, {
        text: 'Get a Quote',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-1 tracking-75 uppercase py-2 size-14 px-8 border-current rounded text-black hover:border-current font-normal ml-1 leading-relaxed'
      }, {
        text: 'Try Demo',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid border-transparent hover:border-transparent bg-gray-200 hover:bg-gray-300 size-16 text-black font-normal uppercase py-3 px-11 tracking-75 mr-3 ml-0 rounded-md leading-relaxed'
      }, {
        text: 'Buy Now',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid size-16 tracking-75 font-normal uppercase px-11 py-3 hover:text-white hover:bg-teal-500 bg-teal-400 text-white border-transparent hover:border-transparent ml-0 mr-2 rounded-md leading-relaxed'
      }, {
        text: 'Play',
        className: 'transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid ml-1 mr-1 size-16 text-black tracking-75 font-normal uppercase px-11 border-current hover:border-current py-3 rounded leading-relaxed'
      }];
      var html = '';
      for (var i = 0; i < templates.length; i++) {
        if (templates[i].html) {
          html += templates[i].html;
        } else {
          html += "<a class=\"".concat(templates[i].className, "\" href=\"#\" role=\"button\" tabindex=\"0\">").concat(templates[i].text, "</a>");
        }
      }
      document.querySelector('#divButtonTemplateList').innerHTML = html;
      var btns = this.buttonModal.querySelectorAll('#divButtonTemplateList a');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function (e) {
          _this3.builder.uo.saveForUndo();
          var activeButton = _this3.builder.activeButton || _this3.builder.activeLinkButton || _this3.builder.activeLink;

          // this.applyStyles(activeButton, btn);

          // this.cleanupOldClasses(activeButton);

          activeButton.removeAttribute('style');
          activeButton.removeAttribute('onmouseover');
          activeButton.removeAttribute('onmouseout');
          activeButton.removeAttribute('data-bg');
          activeButton.removeAttribute('data-hover-bg');
          activeButton.setAttribute('class', btn.getAttribute('class'));
          if (btn.hasAttribute('style')) activeButton.setAttribute('style', btn.getAttribute('style'));
          if (btn.hasAttribute('onmouseover')) activeButton.setAttribute('onmouseover', btn.getAttribute('onmouseover'));
          if (btn.hasAttribute('onmouseout')) activeButton.setAttribute('onmouseout', btn.getAttribute('onmouseout'));
          if (btn.hasAttribute('data-bg')) {
            activeButton.setAttribute('data-bg', btn.getAttribute('data-bg'));
            activeButton.style.backgroundColor = btn.getAttribute('data-bg');
          }
          if (btn.hasAttribute('data-hover-bg')) {
            activeButton.setAttribute('data-hover-bg', btn.getAttribute('data-hover-bg'));
          }
          activeButton.classList.remove('active');
          if (activeButton.tagName.toLowerCase() === 'a') {
            activeButton.setAttribute('role', 'button');
          }
          _this3.realtime();
          _this3.builder.opts.onChange();
          e.preventDefault();
          return false;
        });
      });
    }
  }, {
    key: "renderMyButtons",
    value: function renderMyButtons() {
      var _this4 = this;
      var dom = this.dom;
      if (!localStorage.getItem('_savedbuttons')) return;
      var mybuttons = JSON.parse(localStorage.getItem('_savedbuttons'));
      var html_mybuttons = '';
      for (var i = 0; i < mybuttons.length; i++) {
        var sDataBg = '';
        if (mybuttons[i].bg !== '') sDataBg = " data-bg=\"".concat(mybuttons[i].bg, "\"");
        var sDataHoverBg = '';
        if (mybuttons[i].hoverBg !== '') sDataHoverBg = " data-hover-bg=\"".concat(mybuttons[i].hoverBg, "\"");
        if (sDataHoverBg !== '' && sDataBg === '') {
          sDataBg = ' data-bg=""';
        }
        html_mybuttons += "<a data-id=\"".concat(mybuttons[i].id, "\"").concat(sDataBg).concat(sDataHoverBg, " class=\"").concat(mybuttons[i].className, "\" href=\"#\" style=\"").concat(mybuttons[i].cssText, "\">Button<span class=\"is-button-remove\"><svg class=\"is-icon-flex\" style=\"fill:rgba(255, 255, 266, 1);width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></span></a>");
      }
      document.querySelector('#divMyButtonList').innerHTML = html_mybuttons;
      var btns = this.buttonModal.querySelectorAll('#divMyButtonList a');
      Array.prototype.forEach.call(btns, function (btn) {
        if (btn.getAttribute('data-hover-bg')) {
          btn.setAttribute('onmouseover', 'if(this.getAttribute(\'data-hover-bg\'))this.style.backgroundColor=this.getAttribute(\'data-hover-bg\');');
          btn.setAttribute('onmouseout', 'if(this.getAttribute(\'data-bg\'))this.style.backgroundColor=this.getAttribute(\'data-bg\');else this.style.backgroundColor=\'\'');
        }
        btn.addEventListener('click', function (e) {
          _this4.builder.uo.saveForUndo();
          var activeButton = _this4.builder.activeButton || _this4.builder.activeLinkButton || _this4.builder.activeLink;
          var links = _this4.buttonModal.querySelectorAll('#divMyButtonList a');
          Array.prototype.forEach.call(links, function (link) {
            dom.removeClass(link, 'active');
          });
          dom.addClass(btn, 'active');

          // this.applyStyles(activeButton, btn);

          // this.cleanupOldClasses(activeButton);

          activeButton.removeAttribute('style');
          activeButton.removeAttribute('onmouseover');
          activeButton.removeAttribute('onmouseout');
          activeButton.removeAttribute('data-bg');
          activeButton.removeAttribute('data-hover-bg');
          activeButton.setAttribute('class', btn.getAttribute('class'));
          if (btn.hasAttribute('style')) activeButton.setAttribute('style', btn.getAttribute('style'));
          if (btn.hasAttribute('onmouseover')) activeButton.setAttribute('onmouseover', btn.getAttribute('onmouseover'));
          if (btn.hasAttribute('onmouseout')) activeButton.setAttribute('onmouseout', btn.getAttribute('onmouseout'));
          if (btn.hasAttribute('data-bg')) {
            activeButton.setAttribute('data-bg', btn.getAttribute('data-bg'));
            activeButton.style.backgroundColor = btn.getAttribute('data-bg');
          }
          if (btn.hasAttribute('data-hover-bg')) {
            activeButton.setAttribute('data-hover-bg', btn.getAttribute('data-hover-bg'));
          }
          activeButton.classList.remove('active');
          if (activeButton.tagName.toLowerCase() === 'a') {
            activeButton.setAttribute('role', 'button');
          }
          _this4.builder.opts.onChange();
          _this4.realtime();
          e.preventDefault();
          return false;
        });
      });
      btns = this.buttonModal.querySelectorAll('.is-button-remove');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.addEventListener('click', function (e) {
          var button = e.target.closest('a');
          var id = button.getAttribute('data-id');
          if (localStorage.getItem('_savedbuttons') != null) {
            var _mybuttons = JSON.parse(localStorage.getItem('_savedbuttons'));
            for (var _i = 0; _i < _mybuttons.length; _i++) {
              if (_mybuttons[_i].id === parseInt(id)) {
                _mybuttons.splice(_i, 1);
                for (var j = 0; j < _mybuttons.length; j++) {
                  _mybuttons[j].id = j;
                }
                localStorage.setItem('_savedbuttons', JSON.stringify(_mybuttons));

                // button.parentNode.removeChild(button);
                _this4.renderMyButtons();
                e.stopImmediatePropagation();
                e.preventDefault();
                return false;
              }
            }
          }
          e.stopImmediatePropagation();
          e.preventDefault();
          return false;
        });
      });
    }
  }, {
    key: "applyStyles",
    value: function applyStyles(link, button) {
      link.style.backgroundColor = '';
      link.style.color = '';
      link.className = button.className.replace(' active ', '').replace('active ', '').replace(' active', '');
      var dataBg = button.getAttribute('data-bg');
      if (dataBg) {
        link.setAttribute('data-bg', dataBg);
        link.style.backgroundColor = dataBg;
      } else {
        link.removeAttribute('data-bg');
        link.style.backgroundColor = '';
      }
      var dataHoverBg = button.getAttribute('data-hover-bg');
      if (dataHoverBg) link.setAttribute('data-hover-bg', dataHoverBg);else link.removeAttribute('data-hover-bg');
      if (button.style.color) link.style.color = button.style.color;else button.style.color = '';
      this.applyDefault(link);
      this.realtime();
    }
  }, {
    key: "applyDefault",
    value: function applyDefault(link) {
      var dom = this.dom;
      // dom.addClass(link, 'transition-all');
      // if(!dom.hasClass(link,'flex')) dom.addClass(link, 'inline-block');
      // dom.addClass(link, 'cursor-pointer');
      // dom.addClass(link, 'border-solid');
      // dom.addClass(link, 'leading-relaxed');

      link.removeAttribute('data-hover-bgcolor');
      link.removeAttribute('data-hover-color');
      link.removeAttribute('data-hover-bordercolor');
      dom.addClass(link, 'whitespace-nowrap');
      if (link.tagName.toLowerCase() === 'a') {
        link.setAttribute('role', 'button');
      }
    }
  }, {
    key: "cleanupOldClasses",
    value: function cleanupOldClasses(link) {
      var dom = this.dom;
      dom.removeClass(link, 'is-btn-ghost1');
      dom.removeClass(link, 'is-btn-ghost2');
      dom.removeClass(link, 'is-upper');
      dom.removeClass(link, 'is-btn-small');
      dom.removeClass(link, 'is-btn');
      dom.removeClass(link, 'is-rounded-30');
      dom.removeClass(link, 'btn-primary');
      dom.removeClass(link, 'btn-default');
      dom.removeClass(link, 'btn');
    }
  }]);
  return ButtonEditor;
}();
/* harmony default export */ const buttoneditor = (ButtonEditor);
;// CONCATENATED MODULE: ./src/contentbuilder/elementhyperlink.js
function elementhyperlink_typeof(obj) { "@babel/helpers - typeof"; return elementhyperlink_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementhyperlink_typeof(obj); }
function elementhyperlink_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementhyperlink_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementhyperlink_toPropertyKey(descriptor.key), descriptor); } }
function elementhyperlink_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementhyperlink_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementhyperlink_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementhyperlink_toPropertyKey(arg) { var key = elementhyperlink_toPrimitive(arg, "string"); return elementhyperlink_typeof(key) === "symbol" ? key : String(key); }
function elementhyperlink_toPrimitive(input, hint) { if (elementhyperlink_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementhyperlink_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var Hyperlink = /*#__PURE__*/function () {
  function Hyperlink(builder) {
    elementhyperlink_classCallCheck(this, Hyperlink);
    this.builder = builder;
  }
  elementhyperlink_createClass(Hyperlink, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var linkTool = builderStuff.querySelector('#divLinkTool');
      if (!linkTool) {
        var html = "<div id=\"divLinkTool\" class=\"is-tool\">\n            <button title=\"".concat(util.out('Edit Button'), "\" data-title=\"").concat(util.out('Edit Button'), "\" class=\"link-button-edit\" style=\"display:none;\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-android-create\"></use></svg></button>\n                <button title=\"").concat(util.out('Link'), "\" data-title=\"").concat(util.out('Link'), "\" class=\"link-edit\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-link\"></use></svg></button>\n                <button title=\"").concat(util.out('Duplicate'), "\" data-title=\"").concat(util.out('Duplicate'), "\" class=\"link-duplicate\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></button>\n                <button title=\"").concat(util.out('Delete'), "\" data-title=\"").concat(util.out('Delete'), "\" class=\"link-remove\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          linkTool = builderStuff.querySelector('#divLinkTool');
        } else {
          linkTool = contentStuff.querySelector('#divLinkTool');
        }
        this.linkTool = linkTool;
        var linkEdit = linkTool.querySelector('.link-edit');
        dom.addEventListener(linkEdit, 'click', function () {
          _this.editLink();
        });
        var buttonEdit = linkTool.querySelector('.link-button-edit');
        dom.addEventListener(buttonEdit, 'click', function () {
          _this.editButton();
        });
        var linkDuplicate = linkTool.querySelector('.link-duplicate');
        dom.addEventListener(linkDuplicate, 'click', function () {
          if (_this.builder.activeLink) {
            _this.builder.uo.saveForUndo();
            if (_this.builder.opts.emailMode) {
              var element = _this.builder.activeLink;
              while (element.tagName.toLowerCase() !== 'table' && !dom.hasClass(element, 'button')) {
                element = element.parentNode;
              }
              element = element.parentNode;
              var activeLinkTD = element;
              var newlinkTD = activeLinkTD.cloneNode(true);

              // if there is active icon class, do not copy the class
              var iconActive = newlinkTD.querySelector('.icon-active');
              if (iconActive) dom.removeClass(iconActive, 'icon-active');
              newlinkTD.style.paddingRight = '15px';
              activeLinkTD.parentNode.insertBefore(newlinkTD, activeLinkTD);
              _this.showTool(_this.builder.activeLink);
            } else {
              var newlink = _this.builder.activeLink.cloneNode(true);

              // if there is active icon class, do not copy the class
              var _iconActive = newlink.querySelector('.icon-active');
              if (_iconActive) dom.removeClass(_iconActive, 'icon-active');
              _this.builder.activeLink.parentNode.insertBefore(newlink, _this.builder.activeLink);
              _this.showTool(_this.builder.activeLink);
            }
          }
        });
        var linkRemove = linkTool.querySelector('.link-remove');
        dom.addEventListener(linkRemove, 'click', function () {
          _this.builder.uo.saveForUndo();
          if (_this.builder.opts.emailMode) {
            var element = _this.builder.activeLink;
            while (element.tagName.toLowerCase() !== 'table' && !dom.hasClass(element, 'button')) {
              element = element.parentNode;
            }
            element = element.parentNode;
            var activeLinkTD = element;
            if (activeLinkTD) activeLinkTD.parentNode.removeChild(activeLinkTD);
            linkTool.style.display = '';
          } else {
            if (_this.builder.activeLink) _this.builder.activeLink.parentNode.removeChild(_this.builder.activeLink);
            linkTool.style.display = '';
          }

          // if there is active icon, set null.
          var iconActive = _this.builder.activeLink.querySelector('.icon-active');
          if (iconActive) _this.builder.activeIcon = null;
        });
      }
    }
  }, {
    key: "renderButtonPanel",
    value: function renderButtonPanel() {
      var builderStuff = this.builder.builderStuff;
      var buttonModal = builderStuff.querySelector('.is-modal.buttoneditor');
      if (!buttonModal) {
        this.buttonEditor = new buttoneditor(this.builder);
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var modal = builderStuff.querySelector('.is-modal.createlink');
      if (!modal) {
        var html = "\n            <div class=\"is-modal createlink\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">  \n                    <label for=\"inpCreateLinkUrl\">".concat(util.out('Link'), ":</label>\n                    <div class=\"link-src\">\n                        <input id=\"inpCreateLinkUrl\" class=\"input-url\" type=\"text\"/>\n                        <button title=\"").concat(util.out('Select'), "\" class=\"input-select\">\n                            ").concat(this.builder.opts.selectIcon, "\n                        </button>\n                        <button title=\"").concat(util.out(this.builder.opts.otherSelectCaption), "\" class=\"input-select-other\" style=\"display:none;width:50px\">\n                            ").concat(this.builder.opts.otherSelectIcon, "\n                        </button>\n                        <div class=\"div-anyfile-upload is-btn classic\" style=\"position: relative; flex: 0 0 auto; width: 50px; height: 43px; box-shadow: rgba(0, 0, 0, 0.32) 0px 3px 6px -6px;\">\n                            <form class=\"form-upload-larger\" target=\"frameTargetAnyfileUpload\" method=\"post\" action=\"").concat(this.builder.opts.fileHandler, "\" enctype=\"multipart/form-data\" style=\"overflow:hidden;position:absolute;top:0;left:0;width:100%;height:100%;border-radius:1px;display:flex;align-items: center;justify-content: center;\">\n                                <input class=\"input-anyfile-customval\" name=\"hidRefId\" type=\"hidden\" value=\"").concat(this.builder.customval, "\" />\n                                <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                                <input type=\"file\" onclick=\"blur()\" tabindex=\"0\" class=\"input-anyfile-upload\" name=\"fileImage\" accept=\"*\" style=\"position:absolute;top:-30px;left:0;width:100%;height:80px;opacity: 0;cursor: pointer;\"/>\n                            </form>\n                            <iframe tabindex=\"-1\" id=\"frameTargetAnyfileUpload\" name=\"frameTargetAnyfileUpload\" src=\"about:blank\" style=\"width:1px;height:1px;position:absolute;top:0;right:-100000px\"></iframe>\n                        </div>\n                    </div>\n                    <label style=\"display:block;margin-top:14px;\">\n                        <input class=\"input-newwindow\" id=\"__input_newwindow\" type=\"checkbox\" />  ").concat(util.out('Open new window'), "&nbsp;\n                    </label>\n                    <label id=\"lblOpenLightbox\" style=\"").concat(this.builder.useLightbox ? 'display:block' : 'display:none', ";margin-top:5px;margin-bottom:14px;\">\n                        <input class=\"input-openlightbox\" id=\"__input_openlightbox\" type=\"checkbox\" />  ").concat(util.out('Open in a lightbox (for image, video or Youtube)'), "&nbsp;\n                    </label>\n\n                    <label id=\"lblCreateLinkText\" for=\"inpCreateLinkText\" style=\"margin-top:14px;display:block\">").concat(util.out('Text'), ":</label>\n                    <input id=\"inpCreateLinkText\" class=\"input-text\" type=\"text\" style=\"width:100%;\"/>\n                    \n                    <label for=\"inpCreateLinkTitle\" style=\"margin-top:14px;display:block\">").concat(util.out('Title'), ":</label>\n                    <input id=\"inpCreateLinkTitle\" class=\"input-title\" type=\"text\" style=\"width:100%;\"/>\n                    \n                    <div style=\"text-align:right;margin-top:14px;\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        modal = builderStuff.querySelector('.is-modal.createlink');
        this.modal = modal;
        if (this.builder.opts.fileHandler === '' && !this.builder.opts.onFileUpload) {
          builderStuff.querySelector('.div-anyfile-upload').style.display = 'none';
        }
        var inputFile = builderStuff.querySelector('.input-anyfile-upload');
        dom.addEventListener(inputFile, 'change', function (e) {
          var element = inputFile;
          while (element.nodeName.toLowerCase() !== 'form') {
            element = element.parentNode;
          }
          var frmUpload = element;
          dom.addClass(frmUpload, 'please-wait');
          if (_this2.builder.opts.onFileUpload) {
            _this2.builder.opts.onFileUpload(e);
          } else {
            frmUpload.submit();
          }
          inputFile.value = ''; // Clear Input
        });

        var inputOk = modal.querySelector('.input-ok');
        dom.addEventListener(inputOk, 'click', function () {
          _this2.builder.uo.saveForUndo();
          var link = _this2.builder.activeLink;
          if (link) {
            // Edit Existing Link

            var url = modal.querySelector('.input-url').value;
            var title = modal.querySelector('.input-title').value;
            var linktext = modal.querySelector('.input-text').value;
            if (linktext === '') linktext = url;
            if (url !== '') {
              link.setAttribute('href', url);
              if (modal.querySelector('.input-newwindow').checked) {
                link.setAttribute('target', '_blank');
              } else {
                link.removeAttribute('target');
              }
              if (modal.querySelector('.input-openlightbox').checked) {
                dom.addClass(link, 'is-lightbox');
              } else {
                dom.removeClass(link, 'is-lightbox');
              }
              if (_this2.builder.activeIcon) {// Icon is selected
              } else {
                link.innerHTML = linktext;
              }
              link.setAttribute('title', title);
            } else {
              // link.outerHTML = link.innerHTML;
              _this2.hideTool();
              if (_this2.builder.activeIcon) {
                _this2.builder.activeIcon.setAttribute('dummy-sel', '');
                link.outerHTML = _this2.builder.activeIcon.outerHTML;
                var icon = _this2.builder.doc.querySelector('[dummy-sel]');
                icon.removeAttribute('dummy-sel');
                _this2.builder.activeIcon = icon;
                _this2.builder.activeIcon.click();
              } else {
                link.outerHTML = link.innerHTML;
              }
            }

            //Trigger Change event
            _this2.builder.opts.onChange();
          } else {
            // Create New Link

            util.restoreSelection();
            var _url = modal.querySelector('.input-url').value;
            var _title = modal.querySelector('.input-title').value;
            var _linktext = modal.querySelector('.input-text').value;
            if (_linktext === '') _linktext = _url;
            if (_url !== '') {
              _this2.builder.uo.saveForUndo();
              var activeLink;
              if (_this2.builder.activeIcon) {
                // Icon is selected

                var iconhtml = _this2.builder.activeIcon.outerHTML;
                _this2.builder.activeIcon.outerHTML = "<a dummy-sel=\"1\" href=\"".concat(_url, "\">").concat(iconhtml, "</a>");
                activeLink = _this2.builder.doc.querySelector('[dummy-sel]');
                activeLink.removeAttribute('dummy-sel');
                if (modal.querySelector('.input-newwindow').checked) {
                  activeLink.setAttribute('target', '_blank');
                } else {
                  activeLink.removeAttribute('target');
                }
                if (modal.querySelector('.input-openlightbox').checked) {
                  dom.addClass(activeLink, 'is-lightbox');
                } else {
                  dom.removeClass(activeLink, 'is-lightbox');
                }
                activeLink.setAttribute('title', _title);
                _this2.builder.activeIcon = activeLink.childNodes[0];
                if (!util.appleMobile) {
                  _this2.builder.activeIcon.click();
                  dom.selectElementContents(_this2.builder.activeIcon);

                  // https://stackoverflow.com/questions/29908261/prevent-text-selection-on-mouse-drag
                  // prevent text selection
                  if (_this2.builder.doc.selection) {
                    _this2.builder.doc.selection.empty();
                  } else {
                    window.getSelection().removeAllRanges();
                  }
                }
              } else {
                var selectionText = _this2.builder.selectionText;
                var selectionElm = _this2.builder.selectionElm;
                var selection;
                if (selectionText) {
                  selection = selectionText;
                  var range = selection.getRangeAt(0);
                  var fragment = range.extractContents();
                  var _link = document.createElement('a');
                  _link.setAttribute('href', _url);
                  _link.setAttribute('title', _title);
                  if (modal.querySelector('.input-newwindow').checked) {
                    _link.setAttribute('target', '_blank');
                  } else {
                    _link.removeAttribute('target');
                  }
                  if (modal.querySelector('.input-openlightbox').checked) {
                    dom.addClass(_link, 'is-lightbox');
                  } else {
                    dom.removeClass(_link, 'is-lightbox');
                  }
                  _link.appendChild(fragment);
                  range.insertNode(_link);
                  _link.innerHTML = _linktext;
                  selection.selectAllChildren(_link);
                } else if (selectionElm) {
                  selection = selectionElm;
                  selectionElm.innerHTML = "<a class=\"dummylink\" href=\"dummy\">".concat(_linktext, "</a>");
                  var _link2 = document.querySelector('.dummylink');
                  _link2.setAttribute('href', _url);
                  _link2.setAttribute('title', _title);
                  if (modal.querySelector('.input-newwindow').checked) {
                    _link2.setAttribute('target', '_blank');
                  } else {
                    _link2.removeAttribute('target');
                  }
                  if (modal.querySelector('.input-openlightbox').checked) {
                    dom.addClass(_link2, 'is-lightbox');
                  } else {
                    dom.removeClass(_link2, 'is-lightbox');
                  }

                  // if(!util.appleMobile) dom.selectElementContents(link); 
                  dom.selectElementContents(_link2);
                  dom.removeClass(_link2, 'dummylink');
                }
              }
            }

            //save selection
            util.saveSelection();

            //Trigger Change event
            _this2.builder.opts.onChange();

            //Trigger Render event
            _this2.builder.opts.onRender();
          }
          util.hideModal(modal);
        });
        var inputCancel = modal.querySelector('.input-cancel');
        dom.addEventListener(inputCancel, 'click', function () {
          util.hideModal(modal);
          if (!util.appleMobile) util.restoreSelection();
        });
        if (this.builder.opts.onOtherSelectClick || this.builder.opts.otherSelect !== '') {
          modal.querySelector('.input-select-other').style.display = 'block';
          var inputSelectOther = modal.querySelector('.input-select-other');
          dom.addEventListener(inputSelectOther, 'click', function (e) {
            if (_this2.builder.opts.onOtherSelectClick) {
              _this2.builder.opts.onOtherSelectClick({
                targetInput: modal.querySelector('.input-url'),
                theTrigger: modal.querySelector('.input-select-other')
              });
            } else {
              var modalFileSelect = builderStuff.querySelector('.is-modal.otherselect');
              if (_this2.builder.opts.assetRefresh) {
                modalFileSelect.querySelector('iframe').src = _this2.builder.opts.otherSelect;
                _this2.builder.opts.assetRefresh = false;
              }
              if (modalFileSelect.querySelector('iframe').src === 'about:blank') {
                modalFileSelect.querySelector('iframe').src = _this2.builder.opts.otherSelect;
              }
              util.showModal(modalFileSelect, false, function () {
                inputSelectOther.removeAttribute('data-focus');
                inputSelectOther.focus();
              }, false, _this2.builder.assetPanelFullScreen);
              inputSelectOther.setAttribute('data-focus', true);
            }
            _this2.builder.targetInput = modal.querySelector('.input-url'); // used by selectAsset() (see contentbuilder.js)
            _this2.builder.targetCallback = null;
            _this2.builder.targetAssetType = 'all';
            e.preventDefault();
            e.stopImmediatePropagation();
          });
        }
        if (this.builder.opts.onFileSelectClick || this.builder.opts.fileselect !== '') {
          modal.querySelector('.input-select').style.display = 'block';
          modal.querySelector('.input-url').style.width = '444px';
          var inputSelect = modal.querySelector('.input-select');
          dom.addEventListener(inputSelect, 'click', function () {
            if (_this2.builder.opts.onFileSelectClick) {
              _this2.builder.opts.onFileSelectClick({
                targetInput: modal.querySelector('.input-url'),
                theTrigger: modal.querySelector('.input-select')
              });
            } else {
              var modalFileSelect = builderStuff.querySelector('.is-modal.fileselect');
              if (_this2.builder.opts.assetRefresh) {
                modalFileSelect.querySelector('iframe').src = _this2.builder.opts.fileselect;
                _this2.builder.opts.assetRefresh = false;
              }
              if (modalFileSelect.querySelector('iframe').src === 'about:blank') {
                modalFileSelect.querySelector('iframe').src = _this2.builder.opts.fileselect;
              }
              util.showModal(modalFileSelect, false, null, false, _this2.builder.assetPanelFullScreen);
            }
            _this2.builder.targetInput = modal.querySelector('.input-url'); // used by selectAsset() (see contentbuilder.js)
            _this2.builder.targetCallback = null;
            _this2.builder.targetAssetType = 'all';
          });
        } else {
          modal.querySelector('.input-select').style.display = 'none';
          modal.querySelector('.input-url').style.width = '100%';
        }
      }
    }
  }, {
    key: "click",
    value: function click(col, e) {
      var dom = this.builder.dom;
      var customcode = false;
      if (col.hasAttribute('data-html')) {
        // Column contains custom code.
        customcode = true;
      }
      var noedit = false;
      if (col.hasAttribute('data-noedit')) {
        // Column is not (text) editable.
        noedit = true;
      }
      var _protected = false;
      if (col.hasAttribute('data-protected')) {
        // Column is not (text) editable and also: cannot be deleted, moved or duplicated.
        _protected = true;
      }
      var elm = e.target;
      this.builder.activeLink = null;
      this.builder.activeLinkButton = null;
      if ((elm.tagName.toLowerCase() === 'a' || dom.parentsHasTag(elm, 'a')) && !customcode && !noedit && !_protected) {
        if (elm.childNodes.length > 0) {
          // Sometimes happens when click a link icon, but not exactly on the icon <i>, but the link <a>
          if (elm.childNodes[0].tagName) if (elm.childNodes[0].tagName.toLowerCase() === 'i' && elm.childNodes.length === 1 && elm.childNodes[0].innerHTML === '') {
            var icons = document.querySelectorAll('.icon-active');
            Array.prototype.forEach.call(icons, function (icon) {
              dom.removeClass(icon, 'icon-active');
            });
            dom.addClass(elm.childNodes[0], 'icon-active');
            dom.selectElementContents(elm.childNodes[0]);
            this.builder.activeIcon = elm.childNodes[0];
          }
        }
        if (elm.tagName.toLowerCase() === 'img') {
          return;
        }
        var link;
        if (elm.tagName.toLowerCase() === 'a') {
          link = elm;
        } else {
          var element = elm;
          while (element.tagName.toLowerCase() !== 'a') {
            element = element.parentNode;
          }
          link = element;
        }
        this.builder.activeLink = link;

        // Button Stuff
        var isButton;
        var display = dom.getStyle(link, 'display');
        if (display === 'inline-block' || display === 'block' || display === 'flex') {
          isButton = true;
        }
        if (isButton) {
          this.builder.activeLinkButton = link;
        }
        // /Button Stuff

        this.showTool(link);
        e.preventDefault();
      }
    }
  }, {
    key: "showTool",
    value: function showTool(link) {
      var _this3 = this;
      this.renderTool();
      var linkTool = this.linkTool;
      var dom = this.builder.dom;
      var linkDisplay = dom.getStyle(link, 'display');
      if (linkDisplay === 'inline' & !this.builder.activeIcon) {
        linkTool.querySelector('.link-duplicate').style.display = 'none';
        linkTool.querySelector('.link-remove').style.display = 'none';
      } else {
        linkTool.querySelector('.link-duplicate').style.display = 'block';
        linkTool.querySelector('.link-remove').style.display = 'block';
      }

      // Button Stuff
      if (this.builder.useButtonPlugin) {
        linkTool.querySelector('.link-button-edit').style.display = 'none';
      } else {
        if (link && this.builder.activeLinkButton) linkTool.querySelector('.link-button-edit').style.display = 'block';else linkTool.querySelector('.link-button-edit').style.display = 'none';
      }
      if (this.buttonEditor) if (dom.hasClass(this.buttonEditor.buttonModal, 'active')) {
        this.buttonEditor.realtime();
      }
      // /Button Stuff

      var left, top;
      top = link.getBoundingClientRect().top + this.builder.win.pageYOffset;
      if (this.builder.activeIcon) top = this.builder.activeIcon.getBoundingClientRect().top + this.builder.win.pageYOffset;
      left = link.getBoundingClientRect().left;
      linkTool.style.display = 'flex';
      var w = linkTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = linkTool.offsetHeight;
      linkTool.style.top = top - h - 3 + 'px';
      linkTool.style.left = left + link.offsetWidth * this.builder.opts.zoom - w + 'px';
      var handleLinkButtonClick = function handleLinkButtonClick(e) {
        var elm = e.target;
        if (!elm) return;
        if (!elm.closest('#divLinkTool') && !elm.closest('.is-modal') && !elm.closest('.keep-selection') && !elm.closest('a')) {
          // click outside

          _this3.hideTool();

          // Hide Button Editor Modal
          if (_this3.buttonEditor) _this3.buttonEditor.hide();
          document.removeEventListener('click', handleLinkButtonClick);
          if (_this3.builder.iframeDocument) {
            _this3.builder.doc.removeEventListener('click', handleLinkButtonClick);
          }
          _this3.builder.handleLinkButtonClick_ = false;
        }
      };
      if (!this.builder.handleLinkButtonClick_) {
        document.addEventListener('click', handleLinkButtonClick);
        if (this.builder.iframeDocument) {
          this.builder.doc.addEventListener('click', handleLinkButtonClick);
        }
        this.builder.handleLinkButtonClick_ = true;
      }
    }
  }, {
    key: "hideTool",
    value: function hideTool() {
      if (this.linkTool) this.linkTool.style.display = '';
    }

    // Button Stuff
  }, {
    key: "editButton",
    value: function editButton() {
      this.renderButtonPanel();
      this.buttonEditor.open();
    }
  }, {
    key: "createLink",
    value: function createLink() {
      this.renderPanel();
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      util.getSelection(); // new

      var text = dom.getSelected();
      var modal = builderStuff.querySelector('.is-modal.createlink');
      modal.querySelector('.input-url').value = '';
      modal.querySelector('.input-newwindow').checked = false;
      modal.querySelector('.input-openlightbox').checked = false;
      modal.querySelector('.input-title').value = '';
      modal.querySelector('.input-text').value = '';
      modal.querySelector('#lblCreateLinkText').style.display = '';
      modal.querySelector('#inpCreateLinkText').style.display = '';
      var link = this.builder.activeLink;
      if (link) {
        var url = link.getAttribute('href');
        var target = link.getAttribute('target');
        var title = link.getAttribute('title');
        var linktext = link.innerHTML;
        modal.querySelector('.input-url').value = url;
        if (target === '_blank') {
          modal.querySelector('.input-newwindow').checked = true;
        } else {
          modal.querySelector('.input-newwindow').checked = false;
        }
        if (dom.hasClass(link, 'is-lightbox')) {
          modal.querySelector('.input-openlightbox').checked = true;
        } else {
          modal.querySelector('.input-openlightbox').checked = false;
        }
        modal.querySelector('.input-title').value = title;
        modal.querySelector('.input-text').value = linktext;
      } else {
        modal.querySelector('.input-text').value = text;
        if (this.builder.activeIcon) {
          modal.querySelector('#lblCreateLinkText').style.display = 'none';
          modal.querySelector('#inpCreateLinkText').style.display = 'none';
        }
      }
      util.showModal(modal, true, function () {
        if (!util.appleMobile) util.restoreSelection();
      }, true);
      modal.querySelector('.input-url').focus();
    }
  }, {
    key: "editLink",
    value: function editLink() {
      this.renderPanel();
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var link = this.builder.activeLink;
      var modal = builderStuff.querySelector('.is-modal.createlink');
      var icon = link.querySelector('i');
      modal.querySelector('#lblCreateLinkText').style.display = '';
      modal.querySelector('#inpCreateLinkText').style.display = '';
      if (link.childElementCount === 1 && icon) {
        if (dom.hasClass(icon, 'icon')) {
          modal.querySelector('#lblCreateLinkText').style.display = 'none';
          modal.querySelector('#inpCreateLinkText').style.display = 'none';
        }
      }
      var url = link.getAttribute('href');
      var target = link.getAttribute('target');
      var title = link.getAttribute('title');
      var linktext = link.innerHTML;
      modal.querySelector('.input-url').value = url;
      if (target === '_blank') {
        modal.querySelector('.input-newwindow').checked = true;
      } else {
        modal.querySelector('.input-newwindow').checked = false;
      }
      if (dom.hasClass(link, 'is-lightbox')) {
        modal.querySelector('.input-openlightbox').checked = true;
      } else {
        modal.querySelector('.input-openlightbox').checked = false;
      }
      modal.querySelector('.input-title').value = title;
      modal.querySelector('.input-text').value = linktext;
      util.showModal(modal, true, null, true);
      modal.querySelector('.input-url').focus();
    }
  }]);
  return Hyperlink;
}();
/* harmony default export */ const elementhyperlink = (Hyperlink);
;// CONCATENATED MODULE: ./src/contentbuilder/elementbutton.js
function elementbutton_typeof(obj) { "@babel/helpers - typeof"; return elementbutton_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementbutton_typeof(obj); }
function elementbutton_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementbutton_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementbutton_toPropertyKey(descriptor.key), descriptor); } }
function elementbutton_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementbutton_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementbutton_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementbutton_toPropertyKey(arg) { var key = elementbutton_toPrimitive(arg, "string"); return elementbutton_typeof(key) === "symbol" ? key : String(key); }
function elementbutton_toPrimitive(input, hint) { if (elementbutton_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementbutton_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var Button = /*#__PURE__*/function () {
  function Button(builder) {
    elementbutton_classCallCheck(this, Button);
    this.builder = builder;
  }
  elementbutton_createClass(Button, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var util = this.builder.util;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var dom = this.builder.dom;
      this.dom = dom;
      var buttonTool = builderStuff.querySelector('#divButtonTool');
      if (!buttonTool) {
        var html = "<div id=\"divButtonTool\" class=\"is-tool\">\n                <button title=\"".concat(util.out('Edit Button'), "\" data-title=\"").concat(util.out('Edit Button'), "\" class=\"button-edit\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-android-create\"></use></svg></button>\n                <button title=\"").concat(util.out('Duplicate'), "\" data-title=\"").concat(util.out('Duplicate'), "\" class=\"button-duplicate\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></button>\n                <button title=\"").concat(util.out('Delete'), "\" data-title=\"").concat(util.out('Delete'), "\" class=\"button-remove\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          buttonTool = builderStuff.querySelector('#divButtonTool');
        } else {
          buttonTool = contentStuff.querySelector('#divButtonTool');
        }
        this.buttonTool = buttonTool;
        var buttonEdit = buttonTool.querySelector('.button-edit');
        dom.addEventListener(buttonEdit, 'click', function () {
          // old: 10853

          _this.editButton();
        });
        var buttonDuplicate = buttonTool.querySelector('.button-duplicate');
        dom.addEventListener(buttonDuplicate, 'click', function () {
          if (_this.builder.activeButton) {
            _this.builder.uo.saveForUndo();
            var newButton = _this.builder.activeButton.cloneNode(true);
            var elmActive = newButton.querySelector('.elm-active');
            if (elmActive) dom.removeClass(elmActive, 'elm-active');
            _this.builder.activeButton.parentNode.insertBefore(newButton, _this.builder.activeButton);
            _this.showTool(_this.builder.activeButton);
          }
        });
        var buttonRemove = buttonTool.querySelector('.button-remove');
        dom.addEventListener(buttonRemove, 'click', function () {
          _this.builder.uo.saveForUndo();
          if (_this.builder.activeButton) _this.builder.activeButton.parentNode.removeChild(_this.builder.activeButton);
          buttonTool.style.display = '';
          _this.builder.activeButton = null;
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var buttonModal = this.builderStuff.querySelector('.is-modal.buttoneditor');
      if (!buttonModal) {
        this.buttonEditor = new buttoneditor(this.builder);
      }
    }
  }, {
    key: "click",
    value: function click(col, e) {
      var _this2 = this;
      var customcode = false;
      if (col.hasAttribute('data-html')) {
        // Column contains custom code.
        customcode = true;
      }
      var noedit = false;
      if (col.hasAttribute('data-noedit')) {
        // Column is not (text) editable.
        noedit = true;
      }
      var _protected = false;
      if (col.hasAttribute('data-protected')) {
        // Column is not (text) editable and also: cannot be deleted, moved or duplicated.
        _protected = true;
      }
      var elm = e.target;
      this.builder.activeButton = null;
      var btn = elm.closest('button');
      if (btn && !customcode && !noedit && !_protected) {
        this.builder.activeButton = btn;
        this.renderTool();
        this.showTool(btn);
        var handleButtonClick = function handleButtonClick(e) {
          var elm = e.target;
          if (!elm) return;
          if (!elm.closest('#divButtonTool') && !elm.closest('.is-modal') && !elm.closest('.keep-selection') && !elm.closest('button')) {
            // click outside

            // hide
            _this2.hideTool();
            // console.log('HIDE');

            // Hide Button Editor Modal
            if (_this2.buttonEditor) _this2.buttonEditor.hide();
            document.removeEventListener('click', handleButtonClick);
            if (_this2.builder.iframeDocument) {
              _this2.builder.doc.removeEventListener('click', handleButtonClick);
            }
            _this2.builder.handleButtonClick_ = false;
          }
        };
        if (!this.builder.handleButtonClick_) {
          document.addEventListener('click', handleButtonClick);
          if (this.builder.iframeDocument) {
            this.builder.doc.addEventListener('click', handleButtonClick);
          }
          this.builder.handleButtonClick_ = true;
        }
        e.preventDefault();
      }
    }
  }, {
    key: "editButton",
    value: function editButton() {
      this.renderPanel();
      this.buttonEditor.open();
    }
  }, {
    key: "showTool",
    value: function showTool(activeButton) {
      var dom = this.builder.dom;
      if (this.buttonEditor) if (dom.hasClass(this.buttonEditor.buttonModal, 'active')) {
        this.buttonEditor.realtime();
      }
      var buttonTool = this.buttonTool;
      var top = activeButton.getBoundingClientRect().top + this.builder.win.pageYOffset;
      var left = activeButton.getBoundingClientRect().left;
      buttonTool.style.display = 'flex';
      var w = buttonTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = buttonTool.offsetHeight;
      buttonTool.style.top = top - h - 3 + 'px';
      buttonTool.style.left = left + activeButton.offsetWidth * this.builder.opts.zoom - w + 'px';
    }
  }, {
    key: "hideTool",
    value: function hideTool() {
      if (this.buttonTool) this.buttonTool.style.display = '';
    }
  }]);
  return Button;
}();
/* harmony default export */ const elementbutton = (Button);
;// CONCATENATED MODULE: ./src/contentbuilder/elementspacer.js
function elementspacer_typeof(obj) { "@babel/helpers - typeof"; return elementspacer_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementspacer_typeof(obj); }
function elementspacer_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementspacer_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementspacer_toPropertyKey(descriptor.key), descriptor); } }
function elementspacer_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementspacer_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementspacer_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementspacer_toPropertyKey(arg) { var key = elementspacer_toPrimitive(arg, "string"); return elementspacer_typeof(key) === "symbol" ? key : String(key); }
function elementspacer_toPrimitive(input, hint) { if (elementspacer_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementspacer_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Spacer = /*#__PURE__*/function () {
  function Spacer(builder) {
    elementspacer_classCallCheck(this, Spacer);
    this.builder = builder;
  }
  elementspacer_createClass(Spacer, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      if (this.spacerTool) return;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var spacerTool = builderStuff.querySelector('.is-spacer-tool');
      if (!spacerTool) {
        var html = "\n            <div id=\"divSpacerTool\" class=\"is-tool is-spacer-tool\">\n                <button title=\"".concat(util.out('Decrease'), "\" data-value=\"-\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-minus-empty\"></use></svg></button>\n                <button title=\"").concat(util.out('Increase'), "\" data-value=\"+\" style=\"border-left: none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          spacerTool = builderStuff.querySelector('.is-spacer-tool');
        } else {
          spacerTool = contentStuff.querySelector('.is-spacer-tool');
        }
        this.spacerTool = spacerTool;
        var btns = spacerTool.querySelectorAll('button');
        Array.prototype.forEach.call(btns, function (btn) {
          dom.addEventListener(btn, 'click', function () {
            _this.builder.uo.saveForUndo();
            var command = btn.getAttribute('data-value');
            var spacer = _this.builder.activeSpacer;
            if (command === '-') {
              if (dom.hasClass(spacer, 'height-300')) {
                dom.removeClass(spacer, 'height-300');
                dom.addClass(spacer, 'height-280');
              } else if (dom.hasClass(spacer, 'height-280')) {
                dom.removeClass(spacer, 'height-280');
                dom.addClass(spacer, 'height-260');
              } else if (dom.hasClass(spacer, 'height-260')) {
                dom.removeClass(spacer, 'height-260');
                dom.addClass(spacer, 'height-240');
              } else if (dom.hasClass(spacer, 'height-240')) {
                dom.removeClass(spacer, 'height-240');
                dom.addClass(spacer, 'height-220');
              } else if (dom.hasClass(spacer, 'height-220')) {
                dom.removeClass(spacer, 'height-220');
                dom.addClass(spacer, 'height-200');
              } else if (dom.hasClass(spacer, 'height-200')) {
                dom.removeClass(spacer, 'height-200');
                dom.addClass(spacer, 'height-180');
              } else if (dom.hasClass(spacer, 'height-180')) {
                dom.removeClass(spacer, 'height-180');
                dom.addClass(spacer, 'height-160');
              } else if (dom.hasClass(spacer, 'height-160')) {
                dom.removeClass(spacer, 'height-160');
                dom.addClass(spacer, 'height-140');
              } else if (dom.hasClass(spacer, 'height-140')) {
                dom.removeClass(spacer, 'height-140');
                dom.addClass(spacer, 'height-120');
              } else if (dom.hasClass(spacer, 'height-120')) {
                dom.removeClass(spacer, 'height-120');
                dom.addClass(spacer, 'height-100');
              } else if (dom.hasClass(spacer, 'height-100')) {
                dom.removeClass(spacer, 'height-100');
                dom.addClass(spacer, 'height-80');
              } else if (dom.hasClass(spacer, 'height-80')) {
                dom.removeClass(spacer, 'height-80');
                dom.addClass(spacer, 'height-60');
              } else if (dom.hasClass(spacer, 'height-60')) {
                dom.removeClass(spacer, 'height-60');
                dom.addClass(spacer, 'height-40');
              } else if (dom.hasClass(spacer, 'height-40')) {
                dom.removeClass(spacer, 'height-40');
                dom.addClass(spacer, 'height-20');
              }
              // else { }
            } else {
              if (dom.hasClass(spacer, 'height-20')) {
                dom.removeClass(spacer, 'height-20');
                dom.addClass(spacer, 'height-40');
              } else if (dom.hasClass(spacer, 'height-40')) {
                dom.removeClass(spacer, 'height-40');
                dom.addClass(spacer, 'height-60');
              } else if (dom.hasClass(spacer, 'height-60')) {
                dom.removeClass(spacer, 'height-60');
                dom.addClass(spacer, 'height-80');
              } else if (dom.hasClass(spacer, 'height-80')) {
                dom.removeClass(spacer, 'height-80');
                dom.addClass(spacer, 'height-100');
              } else if (dom.hasClass(spacer, 'height-100')) {
                dom.removeClass(spacer, 'height-100');
                dom.addClass(spacer, 'height-120');
              } else if (dom.hasClass(spacer, 'height-120')) {
                dom.removeClass(spacer, 'height-120');
                dom.addClass(spacer, 'height-140');
              } else if (dom.hasClass(spacer, 'height-140')) {
                dom.removeClass(spacer, 'height-140');
                dom.addClass(spacer, 'height-160');
              } else if (dom.hasClass(spacer, 'height-160')) {
                dom.removeClass(spacer, 'height-160');
                dom.addClass(spacer, 'height-180');
              } else if (dom.hasClass(spacer, 'height-180')) {
                dom.removeClass(spacer, 'height-180');
                dom.addClass(spacer, 'height-200');
              } else if (dom.hasClass(spacer, 'height-200')) {
                dom.removeClass(spacer, 'height-200');
                dom.addClass(spacer, 'height-220');
              } else if (dom.hasClass(spacer, 'height-220')) {
                dom.removeClass(spacer, 'height-220');
                dom.addClass(spacer, 'height-240');
              } else if (dom.hasClass(spacer, 'height-240')) {
                dom.removeClass(spacer, 'height-240');
                dom.addClass(spacer, 'height-260');
              } else if (dom.hasClass(spacer, 'height-260')) {
                dom.removeClass(spacer, 'height-260');
                dom.addClass(spacer, 'height-280');
              } else if (dom.hasClass(spacer, 'height-280')) {
                dom.removeClass(spacer, 'height-280');
                dom.addClass(spacer, 'height-300');
              }
            }
            _this.showTool(spacer);
            _this.builder.opts.onChange();
            if (_this.builder.onSpacerChange) _this.builder.onSpacerChange();
          });
        });
      }
    }
  }, {
    key: "click",
    value: function click(e) {
      var dom = this.builder.dom;
      var elm = e.target;
      if (dom.hasClass(elm, 'spacer')) {
        this.builder.activeSpacer = elm;

        // prevent text selection
        if (document.selection) {
          document.selection.empty();
        } else {
          window.getSelection().removeAllRanges();
        }
        this.showTool(elm);
      } else {
        this.hideTool();
      }
    }
  }, {
    key: "showTool",
    value: function showTool(elm) {
      this.renderTool();
      var top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
      var left = elm.getBoundingClientRect().left;
      this.spacerTool.style.display = 'flex';
      var w = this.spacerTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = this.spacerTool.offsetHeight;
      this.spacerTool.style.top = top + (elm.offsetHeight * this.builder.opts.zoom - h) / 2 + 'px';
      this.spacerTool.style.left = left + (elm.offsetWidth * this.builder.opts.zoom - w) / 2 + 'px';
    }
  }, {
    key: "hideTool",
    value: function hideTool() {
      if (this.spacerTool) this.spacerTool.style.display = '';
    }
  }]);
  return Spacer;
}();
/* harmony default export */ const elementspacer = (Spacer);
;// CONCATENATED MODULE: ./src/contentbuilder/elementmodule.js
function elementmodule_typeof(obj) { "@babel/helpers - typeof"; return elementmodule_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementmodule_typeof(obj); }
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function elementmodule_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementmodule_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementmodule_toPropertyKey(descriptor.key), descriptor); } }
function elementmodule_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementmodule_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementmodule_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementmodule_toPropertyKey(arg) { var key = elementmodule_toPrimitive(arg, "string"); return elementmodule_typeof(key) === "symbol" ? key : String(key); }
function elementmodule_toPrimitive(input, hint) { if (elementmodule_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementmodule_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Module = /*#__PURE__*/function () {
  function Module(builder) {
    elementmodule_classCallCheck(this, Module);
    this.builder = builder;
  }
  elementmodule_createClass(Module, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      this.dom = dom;
      var moduleTool = builderStuff.querySelector('.is-module-tool');
      if (!moduleTool) {
        var html = "\n            <div class=\"is-tool is-module-tool\">\n                <button class=\"btn-module-refresh\" title=\"".concat(util.out('Refresh'), "\" data-title=\"").concat(util.out('Refresh'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-reload\"></use></svg></button>\n                <button class=\"btn-module-settings\" title=\"").concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          moduleTool = builderStuff.querySelector('.is-module-tool');
        } else {
          moduleTool = contentStuff.querySelector('.is-module-tool');
        }
        this.moduleTool = moduleTool;
        var btnModuleSettings = moduleTool.querySelector('.btn-module-settings');
        btnModuleSettings.addEventListener('click', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
          return regeneratorRuntime.wrap(function _callee$(_context) {
            while (1) {
              switch (_context.prev = _context.next) {
                case 0:
                  _this.edit(btnModuleSettings);
                case 1:
                case "end":
                  return _context.stop();
              }
            }
          }, _callee);
        })));
        var btnModuleRefresh = moduleTool.querySelector('.btn-module-refresh');
        btnModuleRefresh.addEventListener('click', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
          var module;
          return regeneratorRuntime.wrap(function _callee2$(_context2) {
            while (1) {
              switch (_context2.prev = _context2.next) {
                case 0:
                  module = _this.builder.activeModule;
                  module.click();
                  util.refreshModuleLayout(module);
                case 3:
                case "end":
                  return _context2.stop();
              }
            }
          }, _callee2);
        })));
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var moduleModal = builderStuff.querySelector('.is-modal.custommodule');
      if (!moduleModal) {
        var html = "\n\n            <input id=\"hidContentModuleCode\" type=\"hidden\" />\n            <input id=\"hidContentModuleSettings\" type=\"hidden\" />\n            \n            <div class=\"is-modal custommodule\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <div class=\"is-modal-bar is-draggable\">\n                        ".concat(util.out('Module Settings'), "\n                        <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">&#10005;</button>\n                    </div>\n                    <iframe tabindex=\"0\" style=\"position: absolute;top: 0;left: 0;width:100%;height:100%;border:none;border-bottom:90px solid transparent;border-top:40px solid transparent;margin:0;box-sizing:border-box;\" src=\"about:blank\"></iframe>\n                    <div style=\"width:100%;height:90px;padding: 20px; box-sizing: border-box;position:absolute;left:0;bottom:0;overflow:hidden;text-align:right\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div> \n            ");
        dom.appendHtml(builderStuff, html);
        moduleModal = builderStuff.querySelector('.is-modal.custommodule');
        this.moduleModal = moduleModal;
        var btnOk = moduleModal.querySelector('.input-ok');
        dom.addEventListener(btnOk, 'click', function () {
          var modalIframe = moduleModal.querySelector('iframe');
          if (modalIframe.contentWindow.construct) modalIframe.contentWindow.construct();
          _this2.builder.uo.saveForUndo();
          var module = _this2.builder.activeModule;

          //Save Html (original)
          module.setAttribute('data-html', encodeURIComponent(builderStuff.querySelector('#hidContentModuleCode').value));

          //Save Settings (original)
          module.setAttribute('data-settings', encodeURIComponent(builderStuff.querySelector('#hidContentModuleSettings').value));

          //Render (programmatically)
          var html = builderStuff.querySelector('#hidContentModuleCode').value;
          html = html.replace(/{id}/g, util.makeId());
          html = html.replace(/<script>/g, "".concat(_this2.builder.nonce ? "<script nonce=\"".concat(_this2.builder.nonce, "\">") : '<script>'));
          module.innerHTML = '';
          var range = document.createRange();
          range.setStart(module, 0);
          module.appendChild(range.createContextualFragment(html));
          var subblocks = module.querySelectorAll('[data-subblock]');
          var i = 1;
          Array.prototype.forEach.call(subblocks, function (subblock) {
            if (module.getAttribute('data-html-' + i)) {
              subblock.innerHTML = decodeURIComponent(module.getAttribute('data-html-' + i));
            }
            i++;
          });
          var builderActive = _this2.builder.doc.querySelector('.builder-active');
          if (builderActive) _this2.builder.applyBehaviorOn(builderActive);
          _this2.builder.opts.onChange();
          _this2.builder.opts.onRender();

          // util.hideControls();

          // util.repositionColumnTool(true);
          // if(this.builder.onRefreshTool) this.builder.onRefreshTool();

          // module.click();

          _this2.builder.hideModal(moduleModal);
        });
        var btnCancel = moduleModal.querySelector('.input-cancel');
        dom.addEventListener(btnCancel, 'click', function () {
          _this2.builder.hideModal(moduleModal);
        });
      }
    }
  }, {
    key: "edit",
    value: function () {
      var _edit = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(btn) {
        var util, dom, module, moduleModal, modulename, moduleDesc, w, h, btnClose, index, builders, iframe, result;
        return regeneratorRuntime.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                util = this.builder.util;
                dom = this.builder.dom;
                this.renderPanel();
                module = this.builder.activeModule;
                moduleModal = this.moduleModal; // Set a flag to indicate active module
                dom.removeAttributes(this.builder.doc.querySelectorAll('[data-module-active]'), 'data-module-active');
                module.setAttribute('data-module-active', '1');

                //show modal
                modulename = module.getAttribute('data-module');
                moduleDesc = module.getAttribute('data-module-desc');
                if (moduleDesc) {
                  moduleModal.querySelector('.is-modal-bar').innerHTML = util.out(moduleDesc) + "<button class=\"is-modal-close\" tabindex=\"-1\" title=\"".concat(util.out('Close'), "\">\n            <svg class=\"is-icon-flex\" style=\"width:30px;height:30px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg>\n            </button>");
                } else {
                  moduleModal.querySelector('.is-modal-bar').innerHTML = util.out('Module Settings') + "<button class=\"is-modal-close\" tabindex=\"-1\" title=\"".concat(util.out('Close'), "\">\n            <svg class=\"is-icon-flex\" style=\"width:30px;height:30px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg>\n            </button>");
                }
                w = module.getAttribute('data-dialog-width');
                if (!w || w === '') {
                  w = '900px';
                }
                h = module.getAttribute('data-dialog-height');
                if (!h || h === '') {
                  h = '570px';
                }
                if (modulename === 'slider-builder') {
                  moduleModal.querySelector('div:not(.is-modal-overlay)').style.width = '90vw';
                  w = '1500px';
                  h = '80vh';
                }
                moduleModal.querySelector('div:not(.is-modal-overlay)').style.maxWidth = w;
                moduleModal.querySelector('div:not(.is-modal-overlay)').style.height = h;
                btnClose = moduleModal.querySelector('.is-modal-close');
                dom.addEventListener(btnClose, 'click', function () {
                  util.hideModal(moduleModal);
                });
                index = 1;
                builders = module.querySelectorAll('[data-subblock]');
                Array.prototype.forEach.call(builders, function (builder) {
                  // Glide Slider Support
                  if (dom.hasClass(builder.parentNode, 'glide__slide--clone')) return;
                  var builderhtml = builder.innerHTML;
                  module.setAttribute('data-html-' + index, encodeURIComponent(builderhtml));
                  index++;
                });
                if (!(module.getAttribute('data-panel') === 'side' && this.builder.controlPanel)) {
                  _context3.next = 25;
                  break;
                }
                _context3.next = 38;
                break;
              case 25:
                iframe = moduleModal.querySelector('iframe');
                iframe.style.opacity = 0.001;
                util.showModal(moduleModal, true, function () {
                  if (btn) {
                    btn.removeAttribute('data-focus');
                    btn.focus();
                  }
                });
                if (btn) btn.setAttribute('data-focus', true);

                // var d = new Date();
                // moduleModal.querySelector('iframe').src = this.builder.opts.modulePath + modulename + '.html?' + d.getTime(); //always refreshed
                _context3.next = 31;
                return fetch(this.builder.opts.modulePath + modulename + '.html');
              case 31:
                result = _context3.sent;
                _context3.next = 34;
                return result.text();
              case 34:
                result = _context3.sent;
                result = result.replace(/<script>/g, "".concat(this.builder.nonce ? "<script nonce=\"".concat(this.builder.nonce, "\">") : '<script>'));
                iframe.srcdoc = result;
                setTimeout(function () {
                  iframe.style.opacity = '';
                }, 1);
              case 38:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));
      function edit(_x) {
        return _edit.apply(this, arguments);
      }
      return edit;
    }()
  }, {
    key: "click",
    value: function click(col) {
      var custommodule = false;
      if (col.hasAttribute('data-module')) {
        // Column contains custom module.
        custommodule = true;
      }
      if (custommodule) {
        this.builder.activeModule = col;
        this.renderTool();
        this.moduleTool.style.display = 'flex';
        var btn = this.moduleTool.querySelector('.btn-module-settings');
        if (col.getAttribute('data-panel') === 'side' && this.builder.controlPanel) {
          btn.style.display = 'none';
        } else {
          btn.style.display = '';
        }
        this.repositionModuleTool();
      } else {
        this.builder.activeModule = null;
        if (this.moduleTool) this.moduleTool.style.display = '';
      }
    }
  }, {
    key: "repositionModuleTool",
    value: function repositionModuleTool() {
      if (!this.builder.activeModule) return;
      if (this.moduleTool.style.display !== 'flex') return;
      var elm = this.builder.activeModule;

      // this.moduleTool.style.display = 'flex';
      var _toolwidth = this.moduleTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

      var w = elm.offsetWidth * this.builder.opts.zoom;
      var top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
      var left = elm.getBoundingClientRect().left - 2;
      left = left + (w - _toolwidth);

      //Adjust left in case an element is outside the screen
      var _screenwidth = window.innerWidth;
      if (_toolwidth + left > _screenwidth) left = elm.getBoundingClientRect().left;
      this.moduleTool.style.top = top + 'px';
      this.moduleTool.style.left = left + 'px';
    }
  }]);
  return Module;
}();
/* harmony default export */ const elementmodule = (Module);
;// CONCATENATED MODULE: ./src/contentbuilder/elementcode.js
function elementcode_typeof(obj) { "@babel/helpers - typeof"; return elementcode_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementcode_typeof(obj); }
function elementcode_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementcode_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementcode_toPropertyKey(descriptor.key), descriptor); } }
function elementcode_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementcode_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementcode_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementcode_toPropertyKey(arg) { var key = elementcode_toPrimitive(arg, "string"); return elementcode_typeof(key) === "symbol" ? key : String(key); }
function elementcode_toPrimitive(input, hint) { if (elementcode_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementcode_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var Code = /*#__PURE__*/function () {
  function Code(builder) {
    elementcode_classCallCheck(this, Code);
    this.builder = builder;
  }
  elementcode_createClass(Code, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var codeTool = builderStuff.querySelector('.is-code-tool');
      if (!codeTool) {
        var html = "\n            <div class=\"is-tool is-code-tool\">\n                <button title=\"".concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          codeTool = builderStuff.querySelector('.is-code-tool');
        } else {
          codeTool = contentStuff.querySelector('.is-code-tool');
        }
        this.codeTool = codeTool;
        var btn = codeTool.querySelector('button');
        dom.addEventListener(btn, 'click', function () {
          _this.edit(btn);
        });
      }
    }
  }, {
    key: "edit",
    value: function edit() {
      var builderStuff = this.builder.builderStuff;
      var dom = this.builder.dom;
      var codeblock = this.builder.activeCodeBlock;
      this.builder.htmlutil.renderPanel();

      // Find editable areas (is-builder) in custom code blocks and save them to data-html-1, data-html-2, and so on.
      var tmpbuilder = builderStuff.querySelector('#tmp_buildercontent');
      if (tmpbuilder) tmpbuilder.parentNode.removeChild(tmpbuilder);
      dom.appendHtml(builderStuff, '<div id="tmp_buildercontent" style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden;visibility:hidden;"></div>');
      tmpbuilder = builderStuff.querySelector('#tmp_buildercontent');
      var index = 1;
      var builders = codeblock.querySelectorAll('is-builder');
      Array.prototype.forEach.call(builders, function (builder) {
        var builderhtml = builder.innerHTML;
        tmpbuilder = builderStuff.querySelector('#tmp_buildercontent');
        tmpbuilder.innerHTML = builderhtml;
        var elms = tmpbuilder.querySelectorAll('.elm-active');
        dom.removeClasses(elms, 'elm-active');
        elms = tmpbuilder.querySelectorAll('.elm-inspected');
        dom.removeClasses(elms, 'elm-inspected');
        elms = tmpbuilder.querySelectorAll('.cell-active');
        dom.removeClasses(elms, 'cell-active');
        elms = tmpbuilder.querySelectorAll('.row-active');
        dom.removeClasses(elms, 'row-active');
        elms = tmpbuilder.querySelectorAll('.row-outline');
        dom.removeClasses(elms, 'row-outline');
        elms = tmpbuilder.querySelectorAll('.row-outline');
        dom.removeClasses(elms, 'row-outline');
        elms = tmpbuilder.querySelectorAll('[data-click]');
        dom.removeAttributes(elms, 'data-click');
        elms = tmpbuilder.querySelectorAll('[contenteditable]');
        dom.removeAttributes(elms, 'contenteditable');
        elms = tmpbuilder.querySelectorAll('[data-module-active]');
        dom.removeAttributes(elms, 'data-module-active');
        dom.removeElements(tmpbuilder.querySelectorAll('.is-row-tool'));
        dom.removeElements(tmpbuilder.querySelectorAll('.is-col-tool'));
        dom.removeElements(tmpbuilder.querySelectorAll('.is-rowadd-tool'));
        dom.removeElements(tmpbuilder.querySelectorAll('.ovl'));
        dom.removeElements(tmpbuilder.querySelectorAll('.row-add-initial'));
        elms = tmpbuilder.querySelectorAll('[data-keep]');
        dom.removeAttributes(elms, 'data-keep');
        builderhtml = tmpbuilder.innerHTML.trim();
        builderhtml = builderhtml.replace(/<font/g, '<span').replace(/<\/font/g, '</span');
        codeblock.setAttribute('data-html-' + index, encodeURIComponent(builderhtml));
        index++;
      });
      var html = decodeURIComponent(codeblock.getAttribute('data-html'));
      html = html.replace(/<script>/g, "".concat(this.builder.nonce ? "<script nonce=\"".concat(this.builder.nonce, "\">") : '<script>'));
      tmpbuilder.parentNode.removeChild(tmpbuilder);

      // Use existing modal

      var viewhtml;
      if (this.builder.opts.htmlSyntaxHighlighting) {
        viewhtml = builderStuff.querySelector('.viewhtmlmonaco');
      } else {
        viewhtml = builderStuff.querySelector('.viewhtml');
      }
      var textarea = viewhtml.querySelector('textarea');

      // Prevent {id} get formatted.
      html = html.replaceAll('{id}', '__id__');
      var beautify = (js_default()).html;
      html = beautify(html);
      html = html.replaceAll('__id__', '{id}');
      textarea.value = html;
      this.builder.htmlutil.view('code');
    }
  }, {
    key: "click",
    value: function click(col) {
      var customcode = false;
      if (col.hasAttribute('data-html') && !col.hasAttribute('data-module')) {
        // Column contains custom code.
        customcode = true;
      }
      if (customcode) {
        this.builder.activeCodeBlock = col;
        var elm = col;
        this.renderTool();
        this.codeTool.style.display = 'flex';
        var _toolwidth = this.codeTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

        var w = elm.offsetWidth * this.builder.opts.zoom;
        var top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
        var left = elm.getBoundingClientRect().left - 2;
        left = left + (w - _toolwidth);

        //Adjust left in case an element is outside the screen
        var _screenwidth = window.innerWidth;
        if (_toolwidth + left > _screenwidth) left = elm.getBoundingClientRect().left;
        this.codeTool.style.top = top + 'px';
        this.codeTool.style.left = left + 'px';
      } else {
        this.builder.activeCodeBlock = null;
        if (this.codeTool) this.codeTool.style.display = '';
      }
    }
  }]);
  return Code;
}();
/* harmony default export */ const elementcode = (Code);
;// CONCATENATED MODULE: ./src/contentbuilder/elementiframe.js
function elementiframe_typeof(obj) { "@babel/helpers - typeof"; return elementiframe_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementiframe_typeof(obj); }
function elementiframe_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementiframe_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementiframe_toPropertyKey(descriptor.key), descriptor); } }
function elementiframe_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementiframe_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementiframe_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementiframe_toPropertyKey(arg) { var key = elementiframe_toPrimitive(arg, "string"); return elementiframe_typeof(key) === "symbol" ? key : String(key); }
function elementiframe_toPrimitive(input, hint) { if (elementiframe_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementiframe_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Iframe = /*#__PURE__*/function () {
  function Iframe(builder) {
    elementiframe_classCallCheck(this, Iframe);
    this.builder = builder;
  }
  elementiframe_createClass(Iframe, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var iframeTool = builderStuff.querySelector('.is-iframe-tool');
      if (!iframeTool) {
        var html = "\n            <div class=\"is-tool is-iframe-tool\">\n                <button title=\"".concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;background:none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          iframeTool = builderStuff.querySelector('.is-iframe-tool');
        } else {
          iframeTool = contentStuff.querySelector('.is-iframe-tool');
        }
        this.iframeTool = iframeTool;
        var btn = iframeTool.querySelector('button');
        dom.addEventListener(btn, 'click', function () {
          _this.renderPanel();
          var iframeModal = _this.iframeModal;
          var iframe = _this.builder.activeIframe;
          var src = iframe.src;
          var embeddedYoutubeRegex = /^.*\/\/www.youtube.com\/embed\//;
          var embeddedVimeoRegex = /^.*\/\/player.vimeo.com\/video\//;
          var inpSrc = iframeModal.querySelector('.input-src');
          var inpEmbedCode = iframeModal.querySelector('.input-embedcode');
          inpSrc.value = '';
          inpEmbedCode.value = '';
          util.showModal(iframeModal, true, function () {
            btn.removeAttribute('data-focus');
            btn.focus();
          });
          if (embeddedYoutubeRegex.exec(src) != null || embeddedVimeoRegex.exec(src) != null) {
            inpEmbedCode.style.display = 'none';
            inpSrc.style.display = 'block';
            inpSrc.value = src;
            inpSrc.focus();
          } else {
            inpSrc.style.display = 'none';
            inpEmbedCode.style.display = 'block';
            inpEmbedCode.value = iframe.outerHTML;
            inpEmbedCode.focus();
          }
          btn.setAttribute('data-focus', true);
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var iframeModal = builderStuff.querySelector('.is-modal.iframelink');
      if (!iframeModal) {
        var html = "\n            <div class=\"is-modal iframelink\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <input class=\"input-src\" id=\"__iframelink_input_src\" type=\"text\" placeholder=\"Source\" style=\"width:100%;margin-bottom:12px;\"/>\n                    <textarea class=\"input-embedcode\" id=\"__iframelink_input_embedcode\" type=\"text\" placeholder=\"Embed Code\" style=\"width:100%;height:300px;margin-bottom:12px;display:none;\"></textarea>\n                    <div style=\"text-align:right\">\n                        <button title=\"".concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        iframeModal = builderStuff.querySelector('.is-modal.iframelink');
        this.iframeModal = iframeModal;
        var btnOk = iframeModal.querySelector('.input-ok');
        dom.addEventListener(btnOk, 'click', function () {
          _this2.builder.uo.saveForUndo();
          var iframe = _this2.builder.activeIframe;
          var iframeParent = iframe.parentNode;
          if (iframeModal.querySelector('.input-src').value !== '') {
            var src = iframeModal.querySelector('.input-src').value;
            var youRegex = /^http[s]?:\/\/(((www.youtube.com\/watch\?(feature=player_detailpage&)?)v=)|(youtu.be\/))([^#&?]*)/;
            var vimeoRegex = /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/)|(video\/))?([0-9]+)\/?/;
            var youRegexMatches = youRegex.exec(src);
            var vimeoRegexMatches = vimeoRegex.exec(src);
            if ((youRegexMatches !== null || vimeoRegexMatches !== null) && src.indexOf('player.vimeo.com') === -1 && src.indexOf('youtube.com/embed/') === -1) {
              if (youRegexMatches != null && youRegexMatches.length >= 7) {
                var youMatch = youRegexMatches[6];
                src = 'https://www.youtube.com/embed/' + youMatch + '?rel=0';
              }
              if (vimeoRegexMatches != null && vimeoRegexMatches.length >= 7) {
                var vimeoMatch = vimeoRegexMatches[6];
                src = 'https://player.vimeo.com/video/' + vimeoMatch;
              }
              iframe.src = src;
            } else {
              iframe.src = src;
            }
            _this2.builder.opts.onChange();
          } else {
            var inpEmbedCode = iframeModal.querySelector('.input-embedcode');
            var embedcode = inpEmbedCode.value;
            if (embedcode.toLowerCase().indexOf('<iframe') === -1) {
              if (!alert(util.out('Please enter <iframe> element.'))) inpEmbedCode.focus();
              return;
            }
            if (embedcode !== '') {
              iframe.outerHTML = embedcode;
            }
            _this2.builder.activeIframe = iframeParent.querySelector('iframe');
            var builderActive = _this2.builder.doc.querySelector('.builder-active');
            if (builderActive) _this2.builder.applyBehaviorOn(builderActive);
            _this2.builder.opts.onChange();
            if (_this2.builder.onIframeChange) _this2.builder.onIframeChange();
          }
          util.hideModal(iframeModal);
        });
        var btnCancel = iframeModal.querySelector('.input-cancel');
        dom.addEventListener(btnCancel, 'click', function () {
          util.hideModal(iframeModal);
        });
      }
    }
  }, {
    key: "click",
    value: function click(e) {
      var dom = this.builder.dom;
      if (dom.hasClass(e.target, 'ovl') && e.target.parentNode.querySelector('audio')) return;
      if (dom.hasClass(e.target, 'ovl')) {
        //iframe overlay

        e.target.style.display = 'none';
        this.builder.activeIframe = e.target.parentNode.querySelector('iframe');
        var elm = this.builder.activeIframe;
        this.renderTool();
        this.iframeTool.style.display = 'flex';
        var _toolwidth = this.iframeTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

        var w = elm.offsetWidth * this.builder.opts.zoom;
        var top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
        var left = elm.getBoundingClientRect().left - 2;
        left = left + (w - _toolwidth);

        //Adjust left in case an element is outside the screen
        var _screenwidth = window.innerWidth;
        if (_toolwidth + left > _screenwidth) left = elm.getBoundingClientRect().left;
        this.iframeTool.style.top = top + 'px';
        this.iframeTool.style.left = left + 'px';
      } else {
        var ovls = this.builder.doc.querySelectorAll('.ovl');
        Array.prototype.forEach.call(ovls, function (ovl) {
          ovl.style.display = 'block';
        });
        this.builder.activeIframe = null;
        if (this.iframeTool) this.iframeTool.style.display = '';
      }
    }
  }]);
  return Iframe;
}();
/* harmony default export */ const elementiframe = (Iframe);
;// CONCATENATED MODULE: ./src/contentbuilder/elementtable.js
function elementtable_typeof(obj) { "@babel/helpers - typeof"; return elementtable_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementtable_typeof(obj); }
function elementtable_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementtable_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementtable_toPropertyKey(descriptor.key), descriptor); } }
function elementtable_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementtable_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementtable_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementtable_toPropertyKey(arg) { var key = elementtable_toPrimitive(arg, "string"); return elementtable_typeof(key) === "symbol" ? key : String(key); }
function elementtable_toPrimitive(input, hint) { if (elementtable_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementtable_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var Table = /*#__PURE__*/function () {
  function Table(builder) {
    elementtable_classCallCheck(this, Table);
    this.builder = builder;
  }
  elementtable_createClass(Table, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var tableTool = builderStuff.querySelector('.is-table-tool');
      if (!tableTool) {
        //
        //<div class="is-modal-bar is-draggable" style="background:#f9f9f9;"></div>
        var html = "\n            <div class=\"is-tool is-table-tool\">\n                <button title=\"".concat(util.out('Settings'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          tableTool = builderStuff.querySelector('.is-table-tool');
        } else {
          tableTool = contentStuff.querySelector('.is-table-tool');
        }
        this.tableTool = tableTool;
        var btn = tableTool.querySelector('button');
        dom.addEventListener(btn, 'click', function () {
          // old 10317

          if (_this.tableModal && _this.tableModal.classList.contains('active')) {
            _this.hideTableEditor();
          } else {
            _this.renderPanel();
            _this.showTableEditor();
          }
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var tableModal = builderStuff.querySelector('.is-modal.edittable');
      if (!tableModal) {
        var html = "\n            <div class=\"is-modal is-modal-content edittable\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-bar is-draggable\">\n                    ".concat(util.out('Table'), "\n                    <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">&#10005;</button>\n                </div>\n                <div style=\"padding:0\">\n                    <div class=\"is-tabs\" data-group=\"table\">\n                        <a title=\"").concat(util.out('Style'), "\" id=\"tabTableGeneral\" href=\"\" data-content=\"divTableGeneral\" class=\"active\">").concat(util.out('Style'), "</a>\n                        <a title=\"").concat(util.out('Layout'), "\" id=\"tabTableLayout\" href=\"\" data-content=\"divTableLayout\">").concat(util.out('Layout'), "</a>\n                    </div>\n                    <div id=\"divTableGeneral\" class=\"is-tab-content active\" tabindex=\"-1\" data-group=\"table\" style=\"display:block\">\n\n                        <div style=\"display:flex;padding-bottom:12px\">\n                            <div style=\"padding-right:15px\">\n                                <div>").concat(util.out('Background'), ":</div>\n                                <div>\n                                    <button title=\"").concat(util.out('Background Color'), "\" class=\"input-table-bgcolor is-btn-color\"></button>\n                                </div>\n                            </div>\n                            <div>\n                                <div>").concat(util.out('Text Color'), ":</div>\n                                <div>\n                                    <button title=\"").concat(util.out('Text Color'), "\" class=\"input-table-textcolor is-btn-color\"></button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div style=\"padding-bottom:12px;\">\n                            <div>").concat(util.out('Border Thickness'), ":</div>\n                            <div>\n                                <select id=\"selCellBorderWidth\" style=\"width:120px;\"><option value=\"0\">No Border</option><option value=\"1\">1</option><option value=\"2\">2</option><option value=\"3\">3</option></select>  \n                            </div>\n                        </div>\n                        \n                        <div style=\"padding-bottom:12px;\">\n                            <div>").concat(util.out('Border Color'), ":</div>\n                            <div>\n                                <button title=\"").concat(util.out('Border Color'), "\" class=\"input-table-bordercolor is-btn-color\"></button>\n                            </div>\n                        </div>\n                        \n                        <div style=\"padding-bottom:12px;\">\n                            <div>").concat(util.out('Apply To'), ":</div>\n                            <div>\n                                <select id=\"selTableApplyTo\" style=\"width:120px;\">\n                                    <option value=\"table\">").concat(util.out('Table'), "</option>\n                                    <option value=\"currentrow\">").concat(util.out('Current Row'), "</option>\n                                    <option value=\"currentcol\">").concat(util.out('Current Column'), "</option>\n                                    <option value=\"evenrows\">").concat(util.out('Even Rows'), "</option>\n                                    <option value=\"oddrows\">").concat(util.out('Odd Rows'), "</option>  \n                                    <option value=\"currentcell\">").concat(util.out('Current Cell'), "</option>  \n                                </select>\n                            </div>\n                        </div>\n\n                    </div>\n\n                    <div id=\"divTableLayout\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"table\">\n                    \n                        <div style=\"padding-bottom:12px;\">\n                            <div>").concat(util.out('Insert Row'), ":</div>\n                            <div style=\"display:flex\">\n                                <button class=\"classic\" title=\"").concat(util.out('Above'), "\" data-table-cmd=\"rowabove\" title=\"").concat(util.out('Above'), "\" style=\"margin-right:15px\"> ").concat(util.out('Above'), " </button>\n                                <button class=\"classic\" title=\"").concat(util.out('Below'), "\" data-table-cmd=\"rowbelow\" title=\"").concat(util.out('Below'), "\" style=\"\"> ").concat(util.out('Below'), " </button>\n                            </div> \n                        </div>\n                        \n                        <div style=\"padding-bottom:15px;\">\n                            <div>").concat(util.out('Insert Column'), ":</div>\n                            <div style=\"display:flex\">\n                                <button class=\"classic\" title=\"").concat(util.out('Left'), "\" data-table-cmd=\"columnleft\" title=\"").concat(util.out('Left'), "\" style=\"margin-right:15px\"> ").concat(util.out('Left'), " </button> \n                                <button class=\"classic\" title=\"").concat(util.out('Right'), "\" data-table-cmd=\"columnright\" title=\"").concat(util.out('Right'), "\" style=\"\"> ").concat(util.out('Right'), " </button> \n                            </div> \n                        </div>\n\n                        <div style=\"padding-bottom:15px;\">\n                            <button class=\"classic\" title=\"").concat(util.out('Delete Row'), "\" data-table-cmd=\"delrow\" title=\"Delete Row\" style=\"\"> ").concat(util.out('Delete Row'), " </button> \n                        </div>\n\n                        <div style=\"padding-bottom:15px;\">    \n                            <button class=\"classic\" title=\"").concat(util.out('Delete Column'), "\" data-table-cmd=\"delcolumn\" title=\"Delete Column\" style=\"\"> ").concat(util.out('Delete Column'), " </button> \n                        </div>\n                        \n                        <div>    \n                            <button class=\"classic\" title=\"").concat(util.out('Merge Cell'), "\" data-table-cmd=\"mergecell\" style=\"\">").concat(util.out('Merge Cell'), "</button> \n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            ");
        dom.appendHtml(builderStuff, html);
        tableModal = builderStuff.querySelector('.is-modal.edittable');
        this.tableModal = tableModal;
        var btnBgColor = tableModal.querySelector('.input-table-bgcolor');
        btnBgColor.addEventListener('click', function (e) {
          _this2.builder.uo.saveForUndo();
          var elm = e.target;
          _this2.builder.colorPicker.open(function (color) {
            if (!_this2.builder.activeTd) return;

            //Apply format
            var applyto = tableModal.querySelector('#selTableApplyTo').value;
            var oTable = _this2.builder.activeTable;
            var oRow = _this2.builder.activeTd.parentNode;
            var oCell = _this2.builder.activeTd;
            if (applyto === 'currentcell') {
              _this2.builder.activeTd.style.backgroundColor = color;
            }
            for (var i = 0; i < oTable.rows.length; i++) {
              var oTR = oTable.rows[i];
              for (var j = 0; j < oTR.cells.length; j++) {
                var oTD = oTR.cells[j];
                if (applyto === 'table' || applyto === 'evenrows' && isEven(i + 1) || applyto === 'oddrows' && !isEven(i + 1) || applyto === 'currentrow' && oTR === _this2.builder.activeTd.parentNode || applyto === 'currentcol' && j === getCellIndex(oTable, oRow, oCell)) {
                  oTD.style.backgroundColor = color;
                }
              }
            }
            elm.style.backgroundColor = color; // preview

            //Trigger Change event
            _this2.builder.opts.onChange();
          }, btnBgColor.style.backgroundColor, function () {
            btnBgColor.removeAttribute('data-focus');
            btnBgColor.focus();
          });
          btnBgColor.setAttribute('data-focus', true);
        });
        var btnTextColor = tableModal.querySelector('.input-table-textcolor');
        btnTextColor.addEventListener('click', function (e) {
          _this2.builder.uo.saveForUndo();
          var elm = e.target;
          _this2.builder.colorPicker.open(function (color) {
            if (!_this2.builder.activeTd) return;

            //Apply format
            var applyto = tableModal.querySelector('#selTableApplyTo').value;
            var oTable = _this2.builder.activeTable;
            var oRow = _this2.builder.activeTd.parentNode;
            var oCell = _this2.builder.activeTd;
            if (applyto === 'currentcell') {
              _this2.builder.activeTd.style.color = color;
            }
            for (var i = 0; i < oTable.rows.length; i++) {
              var oTR = oTable.rows[i];
              for (var j = 0; j < oTR.cells.length; j++) {
                var oTD = oTR.cells[j];
                if (applyto === 'table' || applyto === 'evenrows' && isEven(i + 1) || applyto === 'oddrows' && !isEven(i + 1) || applyto === 'currentrow' && oTR === _this2.builder.activeTd.parentNode || applyto === 'currentcol' && j === getCellIndex(oTable, oRow, oCell)) {
                  oTD.style.color = color;
                }
              }
            }
            elm.style.backgroundColor = color; // preview

            //Trigger Change event
            _this2.builder.opts.onChange();
          }, btnTextColor.style.backgroundColor, function () {
            btnTextColor.removeAttribute('data-focus');
            btnTextColor.focus();
          });
          btnTextColor.setAttribute('data-focus', true);
        });
        var btnBorderColor = tableModal.querySelector('.input-table-bordercolor');
        btnBorderColor.addEventListener('click', function (e) {
          _this2.builder.uo.saveForUndo();
          var elm = e.target;
          _this2.builder.colorPicker.open(function (color) {
            if (!_this2.builder.activeTd) return;
            var borderwidth = tableModal.querySelector('#selCellBorderWidth').value;
            if (borderwidth === '0') {
              tableModal.querySelector('#selCellBorderWidth').value = 1;
              borderwidth = 1;
            }

            //Apply format
            var applyto = tableModal.querySelector('#selTableApplyTo').value;
            var oTable = _this2.builder.activeTable;
            var oRow = _this2.builder.activeTd.parentNode;
            var oCell = _this2.builder.activeTd;
            if (applyto === 'currentcell') {
              _this2.builder.activeTd.style.borderWidth = borderwidth + 'px';
              _this2.builder.activeTd.style.borderStyle = 'solid';
              _this2.builder.activeTd.style.borderColor = color;
            }
            for (var i = 0; i < oTable.rows.length; i++) {
              var oTR = oTable.rows[i];
              for (var j = 0; j < oTR.cells.length; j++) {
                var oTD = oTR.cells[j];
                if (applyto === 'table' || applyto === 'evenrows' && isEven(i + 1) || applyto === 'oddrows' && !isEven(i + 1) || applyto === 'currentrow' && oTR === _this2.builder.activeTd.parentNode || applyto === 'currentcol' && j === getCellIndex(oTable, oRow, oCell)) {
                  oTD.style.borderWidth = borderwidth + 'px';
                  oTD.style.borderStyle = 'solid';
                  oTD.style.borderColor = color;
                }
              }
            }
            elm.style.backgroundColor = color; // preview

            //Trigger Change event
            _this2.builder.opts.onChange();
          }, btnBorderColor.style.backgroundColor, function () {
            btnBorderColor.removeAttribute('data-focus');
            btnBorderColor.focus();
          });
          btnBorderColor.setAttribute('data-focus', true);
        });
        var selBorderWidth = tableModal.querySelector('#selCellBorderWidth');
        selBorderWidth.addEventListener('change', function () {
          if (!_this2.builder.activeTd) return;
          _this2.builder.uo.saveForUndo();
          var val = selBorderWidth.value;
          var bordercolor = tableModal.querySelector('.input-table-bordercolor').style.backgroundColor;
          if (bordercolor === '') {
            bordercolor = '#000000';
          }

          //Apply format
          var applyto = tableModal.querySelector('#selTableApplyTo').value;
          var oTable = _this2.builder.activeTable;
          var oRow = _this2.builder.activeTd.parentNode;
          var oCell = _this2.builder.activeTd;
          if (applyto === 'currentcell') {
            _this2.builder.activeTd.style.borderWidth = val + 'px';
            _this2.builder.activeTd.style.borderStyle = 'solid';
            _this2.builder.activeTd.style.borderColor = bordercolor;
            if (val === '0') {
              _this2.builder.activeTd.style.borderWidth = '';
              _this2.builder.activeTd.style.borderStyle = '';
              _this2.builder.activeTd.style.borderColor = '';
              tableModal.querySelector('.input-table-bordercolor').style.backgroundColor = '';
            }
          }
          for (var i = 0; i < oTable.rows.length; i++) {
            var oTR = oTable.rows[i];
            for (var j = 0; j < oTR.cells.length; j++) {
              var oTD = oTR.cells[j];
              if (applyto === 'table' || applyto === 'evenrows' && isEven(i + 1) || applyto === 'oddrows' && !isEven(i + 1) || applyto === 'currentrow' && oTR === _this2.builder.activeTd.parentNode || applyto === 'currentcol' && j === getCellIndex(oTable, oRow, oCell)) {
                oTD.style.borderWidth = val + 'px';
                oTD.style.borderStyle = 'solid';
                oTD.style.borderColor = bordercolor;
                if (val === '0') {
                  oTD.style.borderWidth = '';
                  oTD.style.borderStyle = '';
                  oTD.style.borderColor = '';
                  tableModal.querySelector('.input-table-bordercolor').style.backgroundColor = '';
                }
              }
            }
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });

        //Table Layout

        var btn = tableModal.querySelector('[data-table-cmd="rowabove"]');
        btn.addEventListener('click', function () {
          if (!_this2.builder.activeTd) return;

          //Save for Undo
          _this2.builder.uo.saveForUndo();
          var oTable = _this2.builder.activeTable;
          var oRow = _this2.builder.activeTd.parentNode;
          var oNewRow = oTable.insertRow(oRow.rowIndex);
          for (var i = 0; i < oRow.cells.length; i++) {
            var oNewCell = oNewRow.insertCell(oNewRow.cells.length);
            if (_this2.builder.activeTd.getAttribute('style')) oNewCell.setAttribute('style', _this2.builder.activeTd.getAttribute('style'));
            // oNewCell.setAttribute('valign', 'top'); 
            oNewCell.style.verticalAlign = 'top';
            oNewCell.innerHTML = '<br>';
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });
        btn = tableModal.querySelector('[data-table-cmd="rowbelow"]');
        btn.addEventListener('click', function () {
          if (!_this2.builder.activeTd) return;

          //Save for Undo
          _this2.builder.uo.saveForUndo();
          var oTable = _this2.builder.activeTable;
          var oRow = _this2.builder.activeTd.parentNode;
          var oNewRow = oTable.insertRow(oRow.rowIndex + 1);
          for (var i = 0; i < oRow.cells.length; i++) {
            var oNewCell = oNewRow.insertCell(oNewRow.cells.length);
            if (_this2.builder.activeTd.getAttribute('style')) oNewCell.setAttribute('style', _this2.builder.activeTd.getAttribute('style'));
            // oNewCell.setAttribute('valign', 'top'); 
            oNewCell.style.verticalAlign = 'top';
            oNewCell.innerHTML = '<br>';
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });
        btn = tableModal.querySelector('[data-table-cmd="columnleft"]');
        btn.addEventListener('click', function () {
          if (!_this2.builder.activeTd) return;

          //Save for Undo
          _this2.builder.uo.saveForUndo();
          var oTable = _this2.builder.activeTable;
          var oCell = _this2.builder.activeTd;
          var nCellIndex = oCell.cellIndex;
          for (var i = 0; i < oTable.rows.length; i++) {
            var oRowTmp = oTable.rows[i];
            var oNewCell = oRowTmp.insertCell(nCellIndex);
            if (_this2.builder.activeTd.getAttribute('style')) oNewCell.setAttribute('style', _this2.builder.activeTd.getAttribute('style'));
            // oNewCell.setAttribute('valign', 'top'); 
            oNewCell.style.verticalAlign = 'top';
            oNewCell.innerHTML = '<br>';
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });
        btn = tableModal.querySelector('[data-table-cmd="columnright"]');
        btn.addEventListener('click', function () {
          if (!_this2.builder.activeTd) return;

          //Save for Undo
          _this2.builder.uo.saveForUndo();
          var oTable = _this2.builder.activeTable;
          var oCell = _this2.builder.activeTd;
          var nCellIndex = oCell.cellIndex;
          for (var i = 0; i < oTable.rows.length; i++) {
            var oRowTmp = oTable.rows[i];
            var oNewCell = oRowTmp.insertCell(nCellIndex + 1);
            if (_this2.builder.activeTd.getAttribute('style')) oNewCell.setAttribute('style', _this2.builder.activeTd.getAttribute('style'));
            // oNewCell.setAttribute('valign', 'top'); 
            oNewCell.style.verticalAlign = 'top';
            oNewCell.innerHTML = '<br>';
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });
        btn = tableModal.querySelector('[data-table-cmd="delrow"]');
        btn.addEventListener('click', function () {
          if (!_this2.builder.activeTd) return;

          //Save for Undo
          _this2.builder.uo.saveForUndo();
          var oTable = _this2.builder.activeTable;
          var oRow = _this2.builder.activeTd.parentNode;
          oTable.deleteRow(oRow.rowIndex);
          _this2.builder.activeTable = null;
          _this2.builder.activeTd = null;
          if (oTable.rows.length === 0) {
            oTable.parentNode.removeChild(oTable);
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });
        btn = tableModal.querySelector('[data-table-cmd="delcolumn"]');
        btn.addEventListener('click', function () {
          if (!_this2.builder.activeTd) return;

          //Save for Undo
          _this2.builder.uo.saveForUndo();
          var oTable = _this2.builder.activeTable;
          var oCell = _this2.builder.activeTd;
          var nCellIndex = oCell.cellIndex;
          for (var i = 0; i < oTable.rows.length; i++) {
            oTable.rows[i].deleteCell(nCellIndex);
          }
          _this2.builder.activeTable = null;
          _this2.builder.activeTd = null;
          if (oTable.rows[0].cells.length === 0) {
            oTable.parentNode.removeChild(oTable);
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });
        btn = tableModal.querySelector('[data-table-cmd="mergecell"]');
        btn.addEventListener('click', function () {
          if (!_this2.builder.activeTd) return;

          //Save for Undo
          _this2.builder.uo.saveForUndo();
          var oTable = _this2.builder.activeTable;
          var oRow = _this2.builder.activeTd.parentNode;
          var oCell = _this2.builder.activeTd;
          oCell.colSpan = oCell.colSpan + 1; /*LATER: Merge 2 cell which has already colspan.*/

          if (oCell.cellIndex + 1 < oTable.rows[oRow.rowIndex].cells.length) {
            oTable.rows[oRow.rowIndex].deleteCell(oCell.cellIndex + 1);
          }

          //Trigger Change event
          _this2.builder.opts.onChange();
        });
        var btnClose = tableModal.querySelector('.is-modal-close');
        dom.addEventListener(btnClose, 'click', function () {
          dom.removeClass(tableModal, 'active');
        });
        new tabs({
          element: tableModal
        });
        new contentbuilder_draggable({
          selector: '.is-modal.edittable .is-draggable'
        });
      }
    }
  }, {
    key: "showTableEditor",
    value: function showTableEditor() {
      var _this3 = this;
      var tableModal = this.tableModal;
      this.builder.util.showModal(tableModal);
      this.realtime();
      var handleTableClick = function handleTableClick(e) {
        // console.log('handleTableClick');
        var elm = e.target;
        if (!elm) return;
        if (!elm.closest('.is-table-tool') && !elm.closest('.is-sidebar') && !elm.closest('.is-modal') && !elm.closest('.keep-selection') && !elm.closest('table')) {
          // click outside

          // hide
          _this3.hideTableEditor();
          // console.log('HIDE');

          document.removeEventListener('click', handleTableClick);
          if (_this3.builder.iframeDocument) {
            _this3.builder.doc.removeEventListener('click', handleTableClick);
          }
          _this3.builder.handleTableClick_ = false;
        }
        if (elm.closest('table')) {
          _this3.realtime();
        }
      };
      if (!this.builder.handleTableClick_) {
        document.addEventListener('click', handleTableClick);
        if (this.builder.iframeDocument) {
          this.builder.doc.addEventListener('click', handleTableClick);
        }
        this.builder.handleTableClick_ = true;
      }
    }
  }, {
    key: "hideTableEditor",
    value: function hideTableEditor() {
      var tableModal = this.tableModal;
      if (tableModal) this.builder.util.hideModal(tableModal);
    }
  }, {
    key: "realtime",
    value: function realtime() {
      var tableModal = this.tableModal;
      if (tableModal.classList.contains('active') && this.builder.activeTable) {
        var activeTd = this.builder.activeTd;
        if (activeTd) {
          tableModal.querySelector('.input-table-bgcolor').style.backgroundColor = activeTd.style.backgroundColor;
          tableModal.querySelector('.input-table-textcolor').style.backgroundColor = activeTd.style.color;
          tableModal.querySelector('.input-table-bordercolor').style.backgroundColor = activeTd.style.borderColor;
          tableModal.querySelector('#selCellBorderWidth').value = parseInt(activeTd.style.borderWidth);
        }
      } else {
        tableModal.querySelector('.input-table-bgcolor').style.backgroundColor = '';
        tableModal.querySelector('.input-table-textcolor').style.backgroundColor = '';
        tableModal.querySelector('.input-table-bordercolor').style.backgroundColor = '';
        tableModal.querySelector('#selCellBorderWidth').value = 0;
      }
    }
  }, {
    key: "click",
    value: function click(e) {
      var dom = this.builder.dom;
      var elm = e.target;
      if (!elm) return;
      var table = elm.closest('table');
      if (table) {
        var td = elm.closest('td');
        if (dom.hasClass(table, 'default')) {
          // only edit table.default

          this.builder.activeTd = td;
          this.builder.activeTable = table;
          this.renderTool();
          this.tableTool.style.display = 'flex';
          var _toolwidth = this.tableTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

          var w = table.offsetWidth * this.builder.opts.zoom;
          var top = table.getBoundingClientRect().top + this.builder.win.pageYOffset;
          var left = table.getBoundingClientRect().left - 2;
          left = left + (w - _toolwidth);

          //Adjust left in case an element is outside the screen
          var _screenwidth = window.innerWidth;
          if (_toolwidth + left > _screenwidth) left = table.getBoundingClientRect().left;
          this.tableTool.style.top = top + 'px';
          this.tableTool.style.left = left + 'px';
        } else {
          this.builder.activeTd = null;
          this.builder.activeTable = null;
          if (this.tableTool) this.tableTool.style.display = '';
        }
      } else {
        this.builder.activeTd = null;
        this.builder.activeTable = null;
        if (this.tableTool) this.tableTool.style.display = '';
      }
    }
  }]);
  return Table;
}();
function isEven(someNumber) {
  return someNumber % 2 === 0 ? true : false;
}
function getCellIndex(oTable, oTR, oTD) {
  var nCount = 0;
  var bFinish = false;
  for (var i = 0; i < oTR.cells.length; i++) {
    if (bFinish === false) {
      nCount += oTR.cells[i].colSpan;
    }
    if (oTD === oTR.cells[i]) bFinish = true;
  }
  nCount = nCount - (oTD.colSpan - 1);
  var nCellIndex = nCount - 1;
  return nCellIndex;
}
/* harmony default export */ const elementtable = (Table);
;// CONCATENATED MODULE: ./src/contentbuilder/elementvideo.js
function elementvideo_typeof(obj) { "@babel/helpers - typeof"; return elementvideo_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementvideo_typeof(obj); }
function elementvideo_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementvideo_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementvideo_toPropertyKey(descriptor.key), descriptor); } }
function elementvideo_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementvideo_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementvideo_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementvideo_toPropertyKey(arg) { var key = elementvideo_toPrimitive(arg, "string"); return elementvideo_typeof(key) === "symbol" ? key : String(key); }
function elementvideo_toPrimitive(input, hint) { if (elementvideo_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementvideo_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Video = /*#__PURE__*/function () {
  function Video(builder) {
    elementvideo_classCallCheck(this, Video);
    this.builder = builder;
  }
  elementvideo_createClass(Video, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var videoTool = builderStuff.querySelector('.is-video-tool');
      if (!videoTool) {
        var html = "\n            <div class=\"is-tool is-video-tool\">\n                <button title=\"".concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;background:none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          videoTool = builderStuff.querySelector('.is-video-tool');
        } else {
          videoTool = contentStuff.querySelector('.is-video-tool');
        }
        this.videoTool = videoTool;
        var btn = this.videoTool.querySelector('button');
        dom.addEventListener(btn, 'click', function () {
          _this.renderPanel();
          var videoModal = _this.videoModal;
          var video = _this.builder.activeVideo;
          var source = video.querySelector('source');
          var url = '';
          if (source) url = source.getAttribute('src');
          videoModal.querySelector('.input-url').value = url;
          var inpShowControls = videoModal.querySelector('.input-video-controls');
          if (video.hasAttribute('controls')) {
            inpShowControls.checked = true;
          } else {
            inpShowControls.checked = false;
          }
          var inpLoop = videoModal.querySelector('.input-video-loop');
          if (video.hasAttribute('loop')) {
            inpLoop.checked = true;
          } else {
            inpLoop.checked = false;
          }
          var inpAutoplay = videoModal.querySelector('.input-video-autoplay');
          if (video.hasAttribute('autoplay')) {
            inpAutoplay.checked = true;
          } else {
            inpAutoplay.checked = false;
          }
          util.showModal(videoModal, true, function () {
            btn.removeAttribute('data-focus');
            btn.focus();
          });
          btn.setAttribute('data-focus', true);
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var videoModal = builderStuff.querySelector('.is-modal.videolink');
      if (!videoModal) {
        var html = "\n            <div class=\"is-modal videolink\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <label for=\"inpVideoLinkSource\" style=\"display:block\">".concat(util.out('Source'), ":</label>\n                    <div class=\"video-url\">\n                        <input id=\"inpVideoLinkSource\" class=\"input-url\" type=\"text\"/>\n                        <button title=\"").concat(util.out('Select'), "\" class=\"input-select\" style=\"flex:none;\">\n                            ").concat(this.builder.opts.selectIcon, "\n                        </button>\n                        <div class=\"video-larger1 input-upload is-btn classic\" style=\"position:relative;flex:none;box-shadow: 0px 3px 6px -6px rgba(0, 0, 0, 0.32);\">\n                            <form class=\"form-upload-larger\" target=\"frameTargetVideoUpload\" method=\"post\" action=\"").concat(this.builder.opts.videoHandler, "\" enctype=\"multipart/form-data\" style=\"position:absolute;top:0;left:0;display:flex;justify-content:center;align-items:center;width:100%;height:100%;\">\n                                <input id=\"hidRefId5\" name=\"hidRefId\" type=\"hidden\" value=\"\" />\n                                <svg class=\"is-icon-flex\" style=\"width:18px;height:18px;\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                                <input title=\"").concat(util.out('Select'), "\" id=\"fileVideo1\" name=\"fileImage\" type=\"file\" accept=\"video/mp4\" style=\"position:absolute;top:-30px;left:0;width:100%;height:80px;opacity: 0;cursor: pointer;\">\n                            </form>\n\n                            <iframe tabindex=\"0\" id=\"frameTargetVideoUpload\" name=\"frameTargetVideoUpload\" tabIndex=\"-1\" src=\"about:blank\" style=\"width:1px;height:1px;position:absolute;top:0;right:-100000px\"></iframe>\n                        </div>\n                    </div>\n                    \n                    <label style=\"display:block;margin-top:14px;\">\n                        <input class=\"input-video-controls\" id=\"__input_video_controls\" type=\"checkbox\" />  ").concat(util.out('Show Controls'), "&nbsp;\n                    </label>\n                    <label style=\"display:block;margin-top:5px;\">\n                        <input class=\"input-video-loop\" id=\"__input_video_loop\" type=\"checkbox\" />  ").concat(util.out('Loop'), "&nbsp;\n                    </label>\n                    <label style=\"display:block;margin-top:5px;\">\n                        <input class=\"input-video-autoplay\" id=\"__input_video_autoplay\" type=\"checkbox\" />  ").concat(util.out('Autoplay'), "&nbsp;\n                    </label>\n                    \n                    <div style=\"text-align:right;margin-top:14px;\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        var _videoModal = builderStuff.querySelector('.is-modal.videolink');
        this.videoModal = _videoModal;
        if (this.builder.opts.videoHandler === '' && !this.builder.opts.onVideoUpload) {
          _videoModal.querySelector('.video-larger1').style.display = 'none';
        }
        if (!this.builder.opts.onVideoSelectClick && this.builder.opts.videoSelect === '') {
          _videoModal.querySelector('.input-select').style.display = 'none';
        }
        var inpSelectVideo = _videoModal.querySelector('.input-select');
        if (inpSelectVideo) dom.addEventListener(inpSelectVideo, 'click', function () {
          if (_this2.builder.opts.onVideoSelectClick) {
            _this2.builder.opts.onVideoSelectClick({
              targetInput: _videoModal.querySelector('.input-url'),
              theTrigger: inpSelectVideo
            });
          } else {
            var modalVideoSelect = builderStuff.querySelector('.is-modal.videoselect');
            var iframe = modalVideoSelect.querySelector('iframe');
            if (_this2.builder.opts.assetRefresh) {
              iframe.src = _this2.builder.opts.videoSelect;
            }
            if (iframe.src === 'about:blank') {
              iframe.src = _this2.builder.opts.videoSelect;
            }
            util.showModal(modalVideoSelect, false, function () {
              inpSelectVideo.removeAttribute('data-focus');
              inpSelectVideo.focus();
            }, false, _this2.builder.assetPanelFullScreen);
            inpSelectVideo.setAttribute('data-focus', true);
          }
          _this2.builder.targetInput = _videoModal.querySelector('.input-url'); // used by selectAsset() (see contentbuilder.js)
          _this2.builder.targetCallback = null;
          _this2.builder.targetAssetType = 'video';
        });
        var fileLargerVideo = _videoModal.querySelector('#fileVideo1');
        dom.addEventListener(fileLargerVideo, 'change', function (e) {
          var element = fileLargerVideo;
          while (element.nodeName.toLowerCase() !== 'form') {
            element = element.parentNode;
          }
          var frmUpload = element;
          dom.addClass(frmUpload, 'please-wait');
          _videoModal.querySelector('#hidRefId5').value = _this2.builder.opts.customval;
          if (_this2.builder.opts.onVideoUpload) {
            _this2.builder.opts.onVideoUpload(e);
          } else {
            frmUpload.submit();
          }
          fileLargerVideo.value = '';
        });
        var btnOk = _videoModal.querySelector('.input-ok');
        dom.addEventListener(btnOk, 'click', function () {
          _this2.builder.uo.saveForUndo();
          var video = _this2.builder.activeVideo;
          if (_videoModal.querySelector('.input-video-controls').checked) {
            video.setAttribute('controls', '');
          } else {
            video.removeAttribute('controls');
          }
          if (_videoModal.querySelector('.input-video-loop').checked) {
            video.setAttribute('loop', '');
          } else {
            video.removeAttribute('loop');
          }
          if (_videoModal.querySelector('.input-video-autoplay').checked) {
            video.setAttribute('autoplay', '');
          } else {
            video.removeAttribute('autoplay');
          }
          if (_videoModal.querySelector('.input-url').value !== '') {
            var url = _videoModal.querySelector('.input-url').value;
            var source = video.querySelector('source');
            if (url !== source.getAttribute('src')) {
              if (source) source.setAttribute('src', url);
              setTimeout(function () {
                // refresh
                video.pause();
                video.load();
                // video.play();
              }, 100);
            }
            _this2.builder.opts.onChange();
          }
          _this2.builder.hideModal(_videoModal);
          if (_this2.builder.onVideoChange) _this2.builder.onVideoChange();
        });
        var btnCancel = _videoModal.querySelector('.input-cancel');
        dom.addEventListener(btnCancel, 'click', function () {
          _this2.builder.hideModal(_videoModal);
        });
      }
    }
  }, {
    key: "click",
    value: function click(e) {
      var elm = e.target;
      if (elm.tagName.toLowerCase() === 'video') {
        if (elm.closest('[data-html]')) {
          this.builder.activeVideo = null;
          this.videoTool.style.display = '';
          return;
        }
        this.renderTool();
        var videoTool = this.videoTool;
        this.builder.activeVideo = elm;
        videoTool.style.display = 'flex';
        var _toolwidth = videoTool.offsetWidth;
        var w = elm.offsetWidth * this.builder.opts.zoom;
        var top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
        var left = elm.getBoundingClientRect().left;
        left = left + (w - _toolwidth);

        // Adjust left in case an element is outside the screen
        var _screenwidth = window.innerWidth;
        if (_toolwidth + left > _screenwidth) left = elm.getBoundingClientRect().left;
        videoTool.style.top = top + 'px';
        videoTool.style.left = left + 'px';
      } else {
        this.builder.activeVideo = null;
        if (this.videoTool) this.videoTool.style.display = '';
      }
    }
  }, {
    key: "repositionVideoTool",
    value: function repositionVideoTool() {
      var elm = this.builder.activeVideo;
      if (!elm) return;
      if (!this.videoTool) return;
      this.videoTool.style.display = 'flex';
      var _toolwidth = this.videoTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

      var w = elm.offsetWidth * this.builder.opts.zoom;
      var top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
      var left = elm.getBoundingClientRect().left;
      left = left + (w - _toolwidth);
      // left = left + (w/2 - _toolwidth/2);

      //Adjust left in case an element is outside the screen
      var _screenwidth = window.innerWidth;
      if (_toolwidth + left > _screenwidth) left = elm.getBoundingClientRect().left;
      this.videoTool.style.top = top + 'px';
      this.videoTool.style.left = left + 'px';
    }
  }]);
  return Video;
}();
/* harmony default export */ const elementvideo = (Video);
;// CONCATENATED MODULE: ./src/contentbuilder/elementaudio.js
function elementaudio_typeof(obj) { "@babel/helpers - typeof"; return elementaudio_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementaudio_typeof(obj); }
function elementaudio_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementaudio_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementaudio_toPropertyKey(descriptor.key), descriptor); } }
function elementaudio_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementaudio_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementaudio_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementaudio_toPropertyKey(arg) { var key = elementaudio_toPrimitive(arg, "string"); return elementaudio_typeof(key) === "symbol" ? key : String(key); }
function elementaudio_toPrimitive(input, hint) { if (elementaudio_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementaudio_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Audio = /*#__PURE__*/function () {
  function Audio(builder) {
    elementaudio_classCallCheck(this, Audio);
    this.builder = builder;
  }
  elementaudio_createClass(Audio, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var audioTool = builderStuff.querySelector('.is-audio-tool');
      if (!audioTool) {
        var html = "\n            <div class=\"is-tool is-audio-tool\">\n                <button title=\"".concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:37px;height:37px;background:none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          audioTool = builderStuff.querySelector('.is-audio-tool');
        } else {
          audioTool = contentStuff.querySelector('.is-audio-tool');
        }
        this.audioTool = audioTool;
        var btn = this.audioTool.querySelector('button');
        dom.addEventListener(btn, 'click', function () {
          var audio = _this.builder.activeAudio;
          var source = audio.querySelector('source');
          var url = '';
          if (source) url = source.getAttribute('src');
          _this.renderPanel();
          var audioModal = _this.audioModal;
          audioModal.querySelector('.input-url').value = url;
          util.showModal(audioModal, true, function () {
            btn.removeAttribute('data-focus');
            btn.focus();
          });
          btn.setAttribute('data-focus', true);
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var audioModal = builderStuff.querySelector('.is-modal.audiolink');
      if (!audioModal) {
        var html = "\n            <div class=\"is-modal audiolink\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <label for=\"inpAudioLinkSource\" style=\"display:block\">".concat(util.out('Source'), ":</label>\n                    <div class=\"audio-url\">\n                        <input id=\"inpAudioLinkSource\" class=\"input-url\" type=\"text\"/>\n                        <button title=\"").concat(util.out('Select'), "\" class=\"input-select\" style=\"flex:none;\">\n                            ").concat(this.builder.opts.selectIcon, "\n                        </button>\n                        <div class=\"audio-file-upload input-upload is-btn classic\" style=\"position:relative;flex:none;box-shadow: 0px 3px 6px -6px rgba(0, 0, 0, 0.32);\">\n                            <form class=\"form-upload-larger\" target=\"frameTargetAudioUpload\" method=\"post\" action=\"").concat(this.builder.opts.audioHandler, "\" enctype=\"multipart/form-data\" style=\"position:absolute;top:0;left:0;display:flex;justify-content:center;align-items:center;width:100%;height:100%;\">\n                                <input id=\"hidRefAudio\" name=\"hidRefId\" type=\"hidden\" value=\"\" />\n                                <svg class=\"is-icon-flex\" style=\"width:18px;height:18px;\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                                <input title=\"").concat(util.out('Select'), "\" id=\"fileAudio1\" name=\"fileImage\" type=\"file\" accept=\"audio/mp3\" style=\"position:absolute;top:-30px;left:0;width:100%;height:80px;opacity: 0;cursor: pointer;\">\n                            </form>\n\n                            <iframe tabindex=\"0\" id=\"frameTargetAudioUpload\" name=\"frameTargetAudioUpload\" tabIndex=\"-1\" src=\"about:blank\" style=\"width:1px;height:1px;position:absolute;top:0;right:-100000px\"></iframe>\n                        </div>\n                    </div>\n                    \n                    <div style=\"text-align:right;margin-top:14px;\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        var _audioModal = builderStuff.querySelector('.is-modal.audiolink');
        this.audioModal = _audioModal;
        if (this.builder.opts.audioHandler === '' && !this.builder.opts.onAudioUpload) {
          _audioModal.querySelector('.audio-file-upload').style.display = 'none';
        }
        if (!this.builder.opts.onAudioSelectClick && this.builder.opts.audioSelect === '') {
          _audioModal.querySelector('.input-select').style.display = 'none';
        }
        var inpSelectAudio = _audioModal.querySelector('.input-select');
        if (inpSelectAudio) dom.addEventListener(inpSelectAudio, 'click', function () {
          if (_this2.builder.opts.onAudioSelectClick) {
            _this2.builder.opts.onAudioSelectClick({
              targetInput: _audioModal.querySelector('.input-url'),
              theTrigger: inpSelectAudio
            });
          } else {
            var modalAudioSelect = builderStuff.querySelector('.is-modal.audioselect');
            var iframe = modalAudioSelect.querySelector('iframe');
            if (_this2.builder.opts.assetRefresh) {
              iframe.src = _this2.builder.opts.audioSelect;
            }
            if (iframe.src === 'about:blank') {
              iframe.src = _this2.builder.opts.audioSelect;
            }
            util.showModal(modalAudioSelect, false, function () {
              inpSelectAudio.removeAttribute('data-focus');
              inpSelectAudio.focus();
            }, false, _this2.builder.assetPanelFullScreen);
            inpSelectAudio.setAttribute('data-focus', true);
          }
          _this2.builder.targetInput = _audioModal.querySelector('.input-url'); // used by selectAsset() (see contentbuilder.js)
          _this2.builder.targetCallback = null;
          _this2.builder.targetAssetType = 'audio';
        });
        var fileLargerAudio = _audioModal.querySelector('#fileAudio1');
        dom.addEventListener(fileLargerAudio, 'change', function (e) {
          var element = fileLargerAudio;
          while (element.nodeName.toLowerCase() !== 'form') {
            element = element.parentNode;
          }
          var frmUpload = element;
          dom.addClass(frmUpload, 'please-wait');
          _audioModal.querySelector('#hidRefAudio').value = _this2.builder.opts.customval;
          if (_this2.builder.opts.onAudioUpload) {
            _this2.builder.opts.onAudioUpload(e);
          } else {
            frmUpload.submit();
          }
          fileLargerAudio.value = ''; // Clear Input
        });

        var btnOk = _audioModal.querySelector('.input-ok');
        dom.addEventListener(btnOk, 'click', function () {
          _this2.builder.uo.saveForUndo();
          var audio = _this2.builder.activeAudio;
          if (_audioModal.querySelector('.input-url').value !== '') {
            var url = _audioModal.querySelector('.input-url').value;

            //Render
            var source = audio.querySelector('source');
            if (url !== source.getAttribute('src')) {
              if (source) source.setAttribute('src', url);
              setTimeout(function () {
                // refresh
                audio.pause();
                audio.load();
                // audio.play();
              }, 100);
            }

            //Trigger Change event
            _this2.builder.opts.onChange();
          }
          _this2.builder.hideModal(_audioModal);
        });
        var btnCancel = _audioModal.querySelector('.input-cancel');
        dom.addEventListener(btnCancel, 'click', function () {
          _this2.builder.hideModal(_audioModal);
        });
      }
    }
  }, {
    key: "click",
    value: function click(e) {
      var dom = this.builder.dom;
      if (dom.hasClass(e.target, 'ovl') && e.target.parentNode.querySelector('audio')) {
        e.target.style.display = 'none';
        var elm = e.target.parentNode.querySelector('audio');
        this.builder.activeAudio = elm;
        this.renderTool();
        this.audioTool.style.display = 'flex';
        var _toolwidth = this.audioTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

        var w = elm.offsetWidth * this.builder.opts.zoom;
        var top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
        var left = elm.getBoundingClientRect().left;
        left = left + (w - _toolwidth);

        //Adjust left in case an element is outside the screen
        var _screenwidth = window.innerWidth;
        if (_toolwidth + left > _screenwidth) left = elm.getBoundingClientRect().left;
        this.audioTool.style.top = top + 'px';
        this.audioTool.style.left = left + 'px';
      } else {
        this.builder.activeAudio = null;
        if (this.audioTool) this.audioTool.style.display = '';
      }
    }
  }]);
  return Audio;
}();
/* harmony default export */ const elementaudio = (Audio);
;// CONCATENATED MODULE: ./src/contentbuilder/elementsvg.js
function elementsvg_typeof(obj) { "@babel/helpers - typeof"; return elementsvg_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementsvg_typeof(obj); }
function elementsvg_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function elementsvg_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { elementsvg_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { elementsvg_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function elementsvg_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementsvg_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementsvg_toPropertyKey(descriptor.key), descriptor); } }
function elementsvg_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementsvg_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementsvg_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementsvg_toPropertyKey(arg) { var key = elementsvg_toPrimitive(arg, "string"); return elementsvg_typeof(key) === "symbol" ? key : String(key); }
function elementsvg_toPrimitive(input, hint) { if (elementsvg_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementsvg_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
// Currently not used
var Svg = /*#__PURE__*/function () {
  function Svg(builder) {
    elementsvg_classCallCheck(this, Svg);
    this.builder = builder;
    var dom = this.builder.dom;
    this.dom = dom;
    var util = this.builder.util;
    this.util = util;
    var builderStuff = this.builder.builderStuff;
    this.builderStuff = builderStuff;
    var contentStuff = this.builder.contentStuff;
    this.contentStuff = contentStuff;
    this.renderTool();
  }
  elementsvg_createClass(Svg, [{
    key: "renderTool",
    value: function renderTool() {
      var _this = this;
      var builderStuff = this.builderStuff;
      var contentStuff = this.contentStuff;
      var dom = this.dom;
      var util = this.util;
      var svgTool = builderStuff.querySelector('.is-svg-tool');
      if (!svgTool) {
        var html = "\n            <div class=\"is-tool is-svg-tool\">\n                <button class=\"btn-svg-settings\" title=\"".concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        if (!this.builder.iframe) {
          svgTool = builderStuff.querySelector('.is-svg-tool');
        } else {
          svgTool = contentStuff.querySelector('.is-svg-tool');
        }
        this.svgTool = svgTool;
        var btnSvgSettings = svgTool.querySelector('.btn-svg-settings');
        btnSvgSettings.addEventListener('click', /*#__PURE__*/elementsvg_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
          return regeneratorRuntime.wrap(function _callee$(_context) {
            while (1) {
              switch (_context.prev = _context.next) {
                case 0:
                  _this.edit(btnSvgSettings);
                case 1:
                case "end":
                  return _context.stop();
              }
            }
          }, _callee);
        })));
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this2 = this;
      var util = this.util;
      var builderStuff = this.builderStuff;
      var dom = this.builder.dom;
      this.dom = dom;
      var svgModal = builderStuff.querySelector('.is-modal.svgsettings');
      if (!svgModal) {
        var html = "\n\n            <div class=\"is-modal svgsettings\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content scroll\">\n                    <label for=\"inpSvgCode\" style=\"display:block\">".concat(util.out('Embed SVG'), ":</label>\n                    <div class=\"audio-url\">\n                        <textarea id=\"inpSvgCode\" class=\"input-url\"></textarea>\n                    </div>\n                    <div style=\"text-align:right;margin-top:14px;\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        svgModal = builderStuff.querySelector('.is-modal.svgsettings');
        this.svgModal = svgModal;
        var btnOk = svgModal.querySelector('.input-ok');
        dom.addEventListener(btnOk, 'click', function () {
          var inpSvgCode = svgModal.querySelector('#inpSvgCode');
          var parser = new DOMParser();
          var doc = parser.parseFromString(inpSvgCode.value, 'text/html');
          var elm = doc.querySelector('svg');
          if (!elm) return;
          elm.classList.add('svgdummy');
          _this2.builder.uo.saveForUndo();
          var svg = _this2.builder.activeSvg;
          if (svg) {
            // Update
            svg.outerHTML = doc.body.innerHTML;
          } else {
            // Insert
            _this2.builder.util.pasteHtmlAtCaret(doc.body.innerHTML, true);
          }
          var newSvg = _this2.builder.doc.querySelector('.svgdummy');
          if (newSvg) {
            newSvg.classList.remove('svgdummy');
            _this2.builder.activeSvg = newSvg;
            dom.selectElementContents(newSvg);
            util.saveSelection();
          }
          _this2.builder.opts.onChange();
          _this2.builder.hideModal(svgModal);
        });
        var btnCancel = svgModal.querySelector('.input-cancel');
        dom.addEventListener(btnCancel, 'click', function () {
          _this2.builder.hideModal(svgModal);
        });
      }
    }
  }, {
    key: "edit",
    value: function () {
      var _edit = elementsvg_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(btn) {
        var _this3 = this;
        var svgModal, dom, btnClose, inpSvgCode, svg;
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                this.renderPanel();
                svgModal = this.svgModal;
                dom = this.dom;
                btnClose = svgModal.querySelector('.is-modal-close');
                dom.addEventListener(btnClose, 'click', function () {
                  _this3.util.hideModal(svgModal);
                });
                this.util.showModal(svgModal, true, function () {
                  if (btn) {
                    btn.removeAttribute('data-focus');
                    btn.focus();
                  }
                });
                if (btn) btn.setAttribute('data-focus', true);
                inpSvgCode = svgModal.querySelector('#inpSvgCode');
                inpSvgCode.value = '';
                svg = this.builder.activeSvg;
                if (svg) inpSvgCode.value = svg.outerHTML;
                inpSvgCode.focus();
              case 12:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));
      function edit(_x) {
        return _edit.apply(this, arguments);
      }
      return edit;
    }()
  }, {
    key: "click",
    value: function click(e) {
      var elm = e.target;
      var svg = elm.closest('svg');
      if (svg) {
        this.builder.activeSvg = svg;

        // prevent text selection
        if (document.selection) {
          document.selection.empty();
        } else {
          window.getSelection().removeAllRanges();
        }

        // Use the current icon-active class
        this.builder.doc.querySelectorAll('.icon-active').forEach(function (elm) {
          return elm.classList.remove('icon-active');
        });
        svg.classList.add('icon-active');
        this.showTool(svg);
      } else {
        this.builder.activeSvg = null;
        this.hideTool();
      }
    }
  }, {
    key: "showTool",
    value: function showTool() {
      this.svgTool.style.display = 'flex';
      this.repositionModuleTool();
    }
  }, {
    key: "hideTool",
    value: function hideTool() {
      this.svgTool.style.display = '';
    }
  }, {
    key: "repositionModuleTool",
    value: function repositionModuleTool() {
      if (!this.builder.activeSvg) return;
      if (!this.svgTool) return;
      if (this.svgTool.style.display !== 'flex') return;
      var svg = this.builder.activeSvg;
      var toolwidth = this.svgTool.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.

      var w = svg.getBoundingClientRect().width;
      var top, left;
      if (w < 200) {
        left = svg.getBoundingClientRect().left + w;
        top = svg.getBoundingClientRect().top + this.builder.win.pageYOffset;
      } else {
        left = svg.getBoundingClientRect().left + w - toolwidth;
        top = svg.getBoundingClientRect().top + this.builder.win.pageYOffset + 3;
      }
      this.svgTool.style.top = top + 'px';
      this.svgTool.style.left = left + 'px';
    }
  }]);
  return Svg;
}();
/* harmony default export */ const elementsvg = (Svg);
;// CONCATENATED MODULE: ./src/contentbuilder/elements.js
function elements_typeof(obj) { "@babel/helpers - typeof"; return elements_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elements_typeof(obj); }
function elements_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elements_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elements_toPropertyKey(descriptor.key), descriptor); } }
function elements_createClass(Constructor, protoProps, staticProps) { if (protoProps) elements_defineProperties(Constructor.prototype, protoProps); if (staticProps) elements_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elements_toPropertyKey(arg) { var key = elements_toPrimitive(arg, "string"); return elements_typeof(key) === "symbol" ? key : String(key); }
function elements_toPrimitive(input, hint) { if (elements_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elements_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }











var elements_Element = /*#__PURE__*/function () {
  function Element(builder) {
    elements_classCallCheck(this, Element);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
    this.hyperlink = new elementhyperlink(builder);
    this.button = new elementbutton(builder);
    this.image = new elementimage(builder);
    this.spacer = new elementspacer(builder);
    this.module = new elementmodule(builder);
    this.code = new elementcode(builder);
    this.iframe = new elementiframe(builder);
    this.table = new elementtable(builder);
    this.video = new elementvideo(builder);
    this.audio = new elementaudio(builder);
    this.svg = new elementsvg(builder);
  }
  elements_createClass(Element, [{
    key: "applyBehavior",
    value: function applyBehavior(col) {
      var dom = this.dom;
      var customcode = false;
      if (col.hasAttribute('data-html')) {
        // Column contains custom code.
        customcode = true;
      }
      var noedit = false;
      if (col.hasAttribute('data-noedit')) {
        // Column is not (text) editable.
        noedit = true;
      }
      var _protected = false;
      if (col.hasAttribute('data-protected')) {
        // Column is not (text) editable and also: cannot be deleted, moved or duplicated.
        _protected = true;
      }
      if (customcode || noedit || _protected) {
        if (noedit) {
          // For locked column
          var ces = col.querySelectorAll('[contenteditable]');
          Array.prototype.forEach.call(ces, function (ce) {
            ce.contentEditable = false;
          });
        }
        return;
      }

      // Set contentEditable FALSE on special elements

      var sociallinks = col.querySelectorAll('.is-social');
      Array.prototype.forEach.call(sociallinks, function (sociallink) {
        sociallink.contentEditable = false;
      });
      var spacers = col.querySelectorAll('.spacer');
      Array.prototype.forEach.call(spacers, function (spacer) {
        spacer.contentEditable = false;
      });
      var lines = col.querySelectorAll('hr');
      Array.prototype.forEach.call(lines, function (line) {
        line.contentEditable = false;
      });

      // Others

      var links = col.querySelectorAll('a');
      Array.prototype.forEach.call(links, function (link) {
        var linkDisplay = dom.getStyle(link, 'display');
        if (linkDisplay === 'inline-block') {
          //link button
          link.contentEditable = true;
          if (link.parentNode !== col) link.parentNode.contentEditable = false;
        }
      });

      //iframe overlay (need to be added so that embeded video, map, etc can be selected). First click will disable/hide the overlay. Outside click will re-enable it.
      var divs = col.querySelectorAll('.embed-responsive');
      Array.prototype.forEach.call(divs, function (div) {
        var overlay = div.querySelector('.ovl');
        if (!overlay) {
          dom.appendHtml(div, '<div class="ovl" style="position:absolute;background:#fff;opacity:0.01;cursor:pointer;top:0;left:0px;width:100%;height:100%;z-index:1"></div>');
          overlay = div.querySelector('.ovl');
          dom.addEventListener(overlay, 'click', function () {
            // show iframe overlay to make it clickable => for others
            var ovls = document.querySelectorAll('.ovl');
            Array.prototype.forEach.call(ovls, function (ovl) {
              ovl.style.display = 'block';
            });
            overlay.style.display = 'none';
          });
        }
      });
      var audios = col.querySelectorAll('audio');
      Array.prototype.forEach.call(audios, function (audio) {
        var overlay = audio.parentNode.querySelector('.ovl');
        if (!overlay) {
          dom.appendHtml(audio.parentNode, '<div class="ovl" style="position:absolute;background:#fff;opacity:0.01;cursor:pointer;top:0;left:0px;width:100%;height:100%;z-index:1"></div>');
          overlay = audio.parentNode.querySelector('.ovl');
          dom.addEventListener(overlay, 'click', function () {
            // show iframe overlay to make it clickable => for others
            var ovls = document.querySelectorAll('.ovl');
            Array.prototype.forEach.call(ovls, function (ovl) {
              ovl.style.display = '';
            });
            overlay.style.display = 'none';
          });
        }
        setTimeout(function () {
          // In case of add snippet, after apply behavior, snippet will be automatically clicked/selected.
          // So check the snippet if it is selected (active). If so, hide the overlay.
          if (overlay.closest('.elm-active')) {
            overlay.click();
            // overlay.style.display = 'none';
          } else {
            overlay.style.display = '';
          }
        }, 300);
      });
    }
  }, {
    key: "click",
    value: function click(col, e) {
      var dom = this.dom;
      var elm = e.target;
      var noedit = false;
      if (col.hasAttribute('data-noedit')) {
        // Column is not (text) editable.
        noedit = true;
      }
      var _protected = false;
      if (col.hasAttribute('data-protected')) {
        // Column is not (text) editable and also: cannot be deleted, moved or duplicated.
        _protected = true;
      }
      var customcode = false;
      var subblock = false;
      if (col.hasAttribute('data-html')) {
        // Column contains custom code.
        customcode = true;
        if (dom.parentsHasAttribute(elm, 'data-subblock')) {
          subblock = true;
        }
      }
      if (!customcode && !noedit && !_protected || subblock) {
        //previously this is commented: && !noedit && !_protected

        // Icon
        var icons = this.builder.doc.querySelectorAll('.icon-active');
        icons.forEach(function (icon) {
          return icon.classList.remove('icon-active');
        });
        this.builder.activeIcon = null;
        if (elm.tagName.toLowerCase() === 'i' && elm.innerHTML === '') {
          elm.classList.add('icon-active');
          dom.selectElementContents(elm);
          this.builder.activeIcon = elm;

          // https://stackoverflow.com/questions/29908261/prevent-text-selection-on-mouse-drag
          // prevent text selection
          if (document.selection) {
            document.selection.empty();
          } else {
            window.getSelection().removeAllRanges();
          }
        }

        // Image (must be placed before //Link)
        this.image.click(e);

        // Button
        this.button.click(col, e);

        // Link
        this.hyperlink.click(col, e);
        if ((elm.tagName.toLowerCase() === 'a' || dom.parentsHasTag(elm, 'a')) && !customcode) {
          e.preventDefault();
        }

        // Table
        this.table.click(e);

        // Iframe
        this.iframe.click(e);

        // Video
        this.video.click(e);

        // Audio
        this.audio.click(e);

        // Spacer
        this.spacer.click(e);

        // Svg
        this.svg.click(e);
      } else {
        this.util.hideControls();

        // Extra: make image[data-image-embed] clickable/editable
        if (e.target.tagName.toLowerCase() === 'img' && e.target.hasAttribute('data-image-embed')) {
          this.image.click(e);
          if (e.target.hasAttribute('data-sync')) {
            var img = e.target;
            img.setAttribute('data-src', img.src);
          }
        } else if (e.target.tagName.toLowerCase() === 'img' && col.hasAttribute('data-image-allowed')) {
          this.image.click(e);
        }
      }

      // Custom Code
      this.code.click(col, e);

      // Module
      this.module.click(col, e);
    }
  }]);
  return Element;
}();
/* harmony default export */ const contentbuilder_elements = (elements_Element);
;// CONCATENATED MODULE: ./src/contentbuilder/modal.js
function modal_typeof(obj) { "@babel/helpers - typeof"; return modal_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, modal_typeof(obj); }
function modal_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function modal_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, modal_toPropertyKey(descriptor.key), descriptor); } }
function modal_createClass(Constructor, protoProps, staticProps) { if (protoProps) modal_defineProperties(Constructor.prototype, protoProps); if (staticProps) modal_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function modal_toPropertyKey(arg) { var key = modal_toPrimitive(arg, "string"); return modal_typeof(key) === "symbol" ? key : String(key); }
function modal_toPrimitive(input, hint) { if (modal_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (modal_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Modal = /*#__PURE__*/function () {
  function Modal() {
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    modal_classCallCheck(this, Modal);
    var defaults = {
      animateModal: false,
      elementToAnimate: '',
      stuffPlacement: '#_cbhtml'
    };
    this.opts = Object.assign(this, defaults, opts);
    this.id = this.makeId();
    var builderStuff = document.querySelector(this.opts.stuffPlacement);
    if (!builderStuff) {
      builderStuff = document.createElement('div');
      builderStuff.id = '_cbhtml';
      document.body.appendChild(builderStuff);
    }
    this.builderStuff = builderStuff;

    // Stuff placement for this (single) instance
    var objStuff = document.createElement('div');
    objStuff.id = this.id;
    builderStuff.appendChild(objStuff);
    this.objStuff = objStuff;
  }
  modal_createClass(Modal, [{
    key: "confirm",
    value: function confirm(message, callback, animated) {
      var _this = this;
      var html = "<div class=\"is-modal is-confirm\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"padding-bottom:20px;\">\n                <div style=\"margin: 20px 0 30px;font-size: 14px;\">".concat(message, "</div>\n                <button title=\"").concat(this.out('Delete'), "\" class=\"input-ok classic\">").concat(this.out('Delete'), "</button>\n            </div>\n        </div>");
      var confirmModal = this.objStuff.querySelector('.is-confirm');
      if (!confirmModal) {
        this.objStuff.insertAdjacentHTML('beforeend', html);
        confirmModal = this.builderStuff.querySelector('.is-confirm');
      }
      this.show(confirmModal, false, function () {
        //this function runs when overlay is clicked. Remove modal.
        confirmModal.parentNode.removeChild(confirmModal);

        //do task
        callback(false);
      }, animated);
      var buttonok = confirmModal.querySelector('.is-confirm .input-ok');
      this.addEventListener(buttonok, 'click', function () {
        _this.hide(confirmModal);
        confirmModal.parentNode.removeChild(confirmModal); //remove modal

        //do task
        callback(true);
      });
    }
  }, {
    key: "show",
    value: function show(modal, overlayStay, cancelCallback, animated) {
      var _this2 = this;
      this.addClass(modal, 'active');

      // animated param (if set) will overide global setting
      var animate = false;
      if (!(typeof animated === 'undefined' || animated === null)) {
        // animated param is set
        animate = animated;
      } else {
        // if animated param is not set
        animate = this.opts.animateModal; // use global setting
      }

      if (animate) {
        var buildercontainers = document.querySelectorAll(this.opts.elementToAnimate);
        Array.prototype.forEach.call(buildercontainers, function (buildercontainer) {
          // buildercontainer.style.transform = 'scale(0.98)';
          // buildercontainer.style.WebkitTransform= 'scale(0.98)';
          // buildercontainer.style.MozTransform= 'scale(0.98)';
          buildercontainer.style.transform = "scale(".concat(_this2.builder.opts.zoom - 0.02, ")");
          buildercontainer.style.WebkitTransform = "scale(".concat(_this2.builder.opts.zoom - 0.02, ")");
          buildercontainer.style.MozTransform = "scale(".concat(_this2.builder.opts.zoom - 0.02, ")");
          buildercontainer.setAttribute('scaled-down', '1');
        });
      }
      if (!modal.querySelector('.is-modal-overlay')) {
        var html;
        if (overlayStay) {
          html = '<div class="is-modal-overlay overlay-stay"></div>';
        } else {
          html = '<div class="is-modal-overlay"></div>';
        }
        modal.insertAdjacentHTML('afterbegin', html);
        if (!overlayStay) {
          var overlay = modal.querySelector('.is-modal-overlay');
          this.addEventListener(overlay, 'click', function () {
            //cancelCallback
            if (cancelCallback) cancelCallback();
            _this2.hide(modal);
          });
        }
      }
    }
  }, {
    key: "hide",
    value: function hide(modal) {
      var _this3 = this;
      if (this.opts.elementToAnimate !== '') {
        var buildercontainers = document.querySelectorAll(this.opts.elementToAnimate);
        Array.prototype.forEach.call(buildercontainers, function (buildercontainer) {
          // buildercontainer.style.transform = '';
          // buildercontainer.style.WebkitTransform= '';
          // buildercontainer.style.MozTransform= '';
          if (buildercontainer.getAttribute('scaled-down')) {
            buildercontainer.style.transform = "scale(".concat(_this3.builder.opts.zoom, ")");
            buildercontainer.style.WebkitTransform = "scale(".concat(_this3.builder.opts.zoom, ")");
            buildercontainer.style.MozTransform = "scale(".concat(_this3.builder.opts.zoom, ")");
            buildercontainer.removeAttribute('scaled-down');
          }
        });
      }
      this.removeClass(modal, 'active');
    }

    // http://stackoverflow.com/questions/1349404/generate-a-string-of-5-random-characters-in-javascript
  }, {
    key: "makeId",
    value: function makeId() {
      var text = '';
      var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      for (var i = 0; i < 2; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      var text2 = '';
      var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      for (var _i = 0; _i < 5; _i++) {
        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
      }
      return text + text2;
    }
  }, {
    key: "addClass",
    value: function addClass(element, classname) {
      if (!element) return;
      if (this.hasClass(element, classname)) return;
      if (element.classList.length === 0) element.className = classname;else element.className = element.className + ' ' + classname;
    }
  }, {
    key: "removeClass",
    value: function removeClass(element, classname) {
      if (!element) return;
      if (element.classList.length > 0) {
        element.className = element.className.replace(classname, '');
      }
    }
  }, {
    key: "hasClass",
    value: function hasClass(element, classname) {
      if (!element) return false;
      return element.classList ? element.classList.contains(classname) : new RegExp('\\b' + classname + '\\b').test(element.className);
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(parent, type, listener) {
      parent.addEventListener(type, listener);
    }
  }]);
  return Modal;
}();
/* harmony default export */ const contentbuilder_modal = (Modal);
;// CONCATENATED MODULE: ./src/contentbuilder/colorpicker.js
function colorpicker_typeof(obj) { "@babel/helpers - typeof"; return colorpicker_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, colorpicker_typeof(obj); }
function colorpicker_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function colorpicker_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, colorpicker_toPropertyKey(descriptor.key), descriptor); } }
function colorpicker_createClass(Constructor, protoProps, staticProps) { if (protoProps) colorpicker_defineProperties(Constructor.prototype, protoProps); if (staticProps) colorpicker_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function colorpicker_toPropertyKey(arg) { var key = colorpicker_toPrimitive(arg, "string"); return colorpicker_typeof(key) === "symbol" ? key : String(key); }
function colorpicker_toPrimitive(input, hint) { if (colorpicker_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (colorpicker_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
/*
- doesn't accept 3 digit hex
*/


var ColorPicker = /*#__PURE__*/function () {
  function ColorPicker() {
    var _this = this;
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    colorpicker_classCallCheck(this, ColorPicker);
    var defaults = {
      onPick: function onPick() {},
      color: '',
      colors: ['#ff9f01', '#f57c00', '#e64918', '#d32f2f', '#5d4038', '#37474f', '#353535', '#fbc02c', '#b0b42a', '#689f39', '#c21f5b', '#7b21a2', '#522da8', '#616161', '#01b8c9', '#009688', '#388d3c', '#0388d0', '#1465c0', '#2f3f9e', '#9e9e9e'],
      renderOn: '',
      animateModal: false,
      elementToAnimate: '',
      stuffPlacement: '#_cbhtml',
      lang: []
    };
    this.opts = Object.assign(this, defaults, opts);
    this.id = makeid();
    var builderStuff = document.querySelector(this.opts.stuffPlacement);
    if (!builderStuff) {
      builderStuff = document.createElement('div');
      builderStuff.id = '_cbhtml';
      builderStuff.className = 'is-ui';
      document.body.appendChild(builderStuff);
    }
    this.builderStuff = builderStuff;

    // Stuff placement for this (single) instance
    var objStuff = document.createElement('div');
    objStuff.id = this.id;
    builderStuff.appendChild(objStuff);
    this.objStuff = objStuff;
    var modal = new contentbuilder_modal({
      animateModal: this.opts.animateModal,
      elementToAnimate: this.opts.elementToAnimate,
      stuffPlacement: this.opts.stuffPlacement
    });
    this.modal = modal;
    var html_colors = '';
    if (this.opts.colors.length > 0) {
      html_colors += '<div class="color-default">';
      for (var i = 0; i < this.opts.colors.length; i++) {
        if (this.opts.colors[i] === '#ffffff') {
          html_colors += '<button title="' + this.opts.colors[i] + '" data-color="' + this.opts.colors[i] + '" style="background:' + this.opts.colors[i] + ';outline:rgba(222,222,222,0.75) 1px solid"></button>';
        } else {
          html_colors += '<button title="' + this.opts.colors[i] + '" data-color="' + this.opts.colors[i] + '" style="background:' + this.opts.colors[i] + ';"></button>';
        }
      }
      html_colors += '</div>';
    }
    var html_opacbg = '';
    for (i = 0; i < 105; i++) {
      if (i % 2 === 0) {
        html_opacbg += '<div class="dot-1"></div>';
      } else {
        html_opacbg += '<div class="dot-2"></div>';
      }
    }
    var html_previewbg = '';
    for (i = 0; i < 25; i++) {
      if (i % 2 === 0) {
        html_previewbg += '<div class="dot-3"></div>';
      } else {
        html_previewbg += '<div class="dot-4"></div>';
      }
    }
    var html = "<div class=\"pickcolor\" style=\"width:269px;padding:12px;box-sizing:border-box;\">\n            ".concat(html_colors, "\n            <div class=\"color-gradient\"></div>\n\n            <div class=\"div-color-opacity\" style=\"height: 10px; margin: 12px 0px 17px;position:relative;\">\n                <div style=\"position:absolute;top:0;left:0;width:100%;height:21px;display:flex;flex-direction:column;flex-flow:wrap\">\n                    ").concat(html_opacbg, "\n                </div>\n                <input type=\"range\" min=\"0\" max=\"100\" value=\"100\" class=\"color-opacity is-rangeslider\" style=\"position:relative;background: transparent;margin: 0 !important;\">\n            </div>\n            <div style=\"display:flex;margin:25px 0 3px;\">\n                <button title=\"").concat(this.out('B'), "\" data-color=\"#000000\" style=\"background:#111;color:#f3f3f3;border:transparent 1px solid;width:35px;height:35px;line-height:35px;font-size:10px;border-right:none;\">").concat(this.out('B'), "</button>\n                <button title=\"").concat(this.out('W'), "\" data-color=\"#ffffff\" style=\"border: rgb(0 0 0 / 6%) 1px solid;background:#fff;color:#111;width:35px;height:35px;line-height:35px;font-size:10px;\">").concat(this.out('W'), "</button>\n                <button title=\"").concat(this.out('Clear'), "\" data-color=\"\" class=\"clear\" style=\"width:140px;height:35px;line-height:35px;border-right:none;\">").concat(this.out('Clear'), "</button>\n                <button title=\"").concat(this.out('More'), "\" class=\"input-hsl\" style=\"width:35px;height:35px;line-height:35px;font-size:10px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>\n            </div>\n            <div style=\"display:flex\">\n                <div style=\"flex-grow: 0;flex-shrink: 0;flex-basis: 37px;height:34px;box-sizing:border-box;margin-top:8px;position:relative;\">\n                    <div style=\"position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;flex-flow:wrap;overflow:hidden;\">\n                        ").concat(html_previewbg, "\n                    </div>\n                    <button class=\"is-color-preview\" tabindex=\"0\" style=\"outline:none;cursor:default;position:absolute;top:0;left:0;width:100%;height:100%;transition:none;\"></button>\n                </div>\n                <input class=\"input-text\" id=\"{id}\" type=\"text\" style=\"width:209px;height:35px;margin-top:8px;font-size:13px;\"/>\n                <button title=\"").concat(this.out('Apply'), "\" class=\"input-ok\" style=\"height:35px;margin-top:8px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-ok\"></use></svg></use></svg></svg></button>\n            </div>\n        </div>");
    var html_modal = "<div class=\"is-modal pickcolor\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\">\n                <div class=\"is-modal-bar is-draggable\"></div>\n                <div>\n\n                    ".concat(html_colors, "\n                    <div class=\"color-gradient\"></div>\n        \n                    <div class=\"div-color-opacity\" style=\"height: 10px; margin: 12px 0px 17px;position:relative;\">\n                        <div style=\"position:absolute;top:0;left:0;width:100%;height:21px;display:flex;flex-direction:column;flex-flow:wrap\">\n                            ").concat(html_opacbg, "\n                        </div>\n                        <input type=\"range\" min=\"0\" max=\"100\" value=\"100\" class=\"color-opacity is-rangeslider\" style=\"position:relative;background: transparent;margin: 0 !important;\">\n                    </div>\n                    <div style=\"display:flex;margin:25px 0 3px;\">\n                        <button title=\"").concat(this.out('B'), "\" data-color=\"#000000\" style=\"background:#111;color:#f3f3f3;border:transparent 1px solid;width:35px;height:35px;line-height:35px;font-size:10px;border-right:none;\">").concat(this.out('B'), "</button>\n                        <button title=\"").concat(this.out('W'), "\" data-color=\"#ffffff\" style=\"background:#fff;color:#111;width:35px;height:35px;line-height:35px;font-size:10px;\">").concat(this.out('W'), "</button>\n                        <button title=\"").concat(this.out('Clear'), "\" data-color=\"\" class=\"clear\" style=\"width:140px;height:35px;line-height:35px;border-right:none;\">").concat(this.out('Clear'), "</button>\n                        <button title=\"").concat(this.out('More'), "\" class=\"input-hsl\" style=\"width:35px;height:35px;line-height:35px;font-size:10px;\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>\n                    </div>\n                    <div style=\"display:flex\">\n                        <div style=\"flex-grow: 0;flex-shrink: 0;flex-basis: 37px;height:35px;box-sizing:border-box;margin-top:8px;position:relative;\">\n                            <div style=\"position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;flex-flow:wrap;overflow:hidden;\">\n                                ").concat(html_previewbg, "\n                            </div>\n                            <button class=\"is-color-preview\" tabindex=\"0\" style=\"outline:none;cursor:default;position:absolute;top:0;left:0;width:100%;height:100%;transition:none;\"></button>\n                        </div>\n                        <input class=\"input-text\" id=\"{id}\" type=\"text\" style=\"width:209px;height:35px;margin-top:8px;font-size:13px;\"/>\n                        <button title=\"").concat(this.out('Apply'), "\" class=\"input-ok\" style=\"height:35px;margin-top:8px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-ok\"></use></svg></use></svg></svg></button>\n                    </div>\n                    \n                </div>\n            </div>\n        </div>");
    var html_more = "<div class=\"is-modal pickcolormore\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"padding: 12px\">\n                <div class=\"is-modal-bar is-draggable\"></div>\n                <div>\n                    \n                    <div class=\"color-swatch\"></div>\n                    \n                    <div class=\"div-color-hue\" style=\"height: 23px;margin: 10px 0 0;position:relative\">\n                        <input type=\"range\" min=\"0\" max=\"360\" value=\"0\" class=\"color-hue is-rangeslider\" style=\"position:relative;background:transparent;margin:0 !important;z-index:1\">\n                    </div>\n\n                </div>\n            </div>\n        </div>";
    var pickcolor;
    if (this.opts.renderOn !== '') {
      pickcolor = document.querySelector(this.opts.renderOn);
      pickcolor.insertAdjacentHTML('beforeend', html.replace(/{id}/g, this.makeId()));
    } else {
      objStuff.insertAdjacentHTML('beforeend', html_modal.replace(/{id}/g, this.makeId()));
      pickcolor = objStuff.querySelector('.is-modal.pickcolor');
    }
    objStuff.insertAdjacentHTML('beforeend', html_more);
    var pickcolormore = objStuff.querySelector('.is-modal.pickcolormore');
    this.pickcolor = pickcolor;
    this.pickcolormore = pickcolormore;
    var setupTabKeys = function setupTabKeys(div) {
      var inputs = div.querySelectorAll('a[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), *[tabindex]');
      if (inputs.length === 0) return;
      var firstInput = inputs[0];
      var lastInput = inputs[inputs.length - 1];
      // firstInput.focus();

      // console.log(lastInput)
      // console.log(firstInput)

      // Redirect last tab to first input
      lastInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && !e.shiftKey) {
          e.preventDefault();
          firstInput.focus();
        }
      });

      // Redirect first shift+tab to last input
      firstInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && e.shiftKey) {
          e.preventDefault();
          lastInput.focus();
        }
      });
    };
    setupTabKeys(pickcolor);
    new contentbuilder_draggable({
      selector: '#' + this.id + ' .is-draggable'
    });
    var tmp = document.createElement('div');
    tmp.style.backgroundColor = this.opts.color; //hex will be converted to rgb
    var s = tmp.style.backgroundColor; //rgb

    var rgb;
    if (s !== '') {
      rgb = RGBvalues.color(s);
      this.baseRGB = rgb;
    }
    var colorswatch = pickcolormore.querySelector('.color-swatch');
    var colorgradient = pickcolor.querySelector('.color-gradient');
    var opacValue;
    if (rgb) {
      var hueValue;
      if (s !== '') {
        hueValue = rgbToHue(rgb.r, rgb.g, rgb.b);
      } else {
        hueValue = 0;
      }
      opacValue = 1;
      hslSwatch(colorswatch, hueValue, opacValue);
      var hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
      colorSwatch(colorgradient, hueValue, hsl[1]);
    } else {
      var _hueValue;
      _hueValue = 0;
      opacValue = 1;
      hslSwatch(colorswatch, _hueValue, opacValue);
      var _hsl = rgbToHsl(255, 255, 255);
      colorSwatch(colorgradient, _hueValue, _hsl[1]);
    }
    setupTabKeys(pickcolormore);
    var elm = pickcolor.querySelector('.input-hsl');
    this.addEventListener(elm, 'click', function () {
      _this.openMore();
    });
    var colorHue = pickcolormore.querySelector('.color-hue');
    colorHue.oninput = function () {
      var value = colorHue.value / 360;
      var hue = value * 361;
      hslSwatch(colorswatch, hue, 1);
    };
    var hueswatch = document.createElement('div');

    //hueswatch.style = 'display:flex;position:absolute;top:0;left:0;'; //not working in IE11
    hueswatch.style.display = 'flex';
    hueswatch.style.position = 'absolute';
    hueswatch.style.width = 'calc(100% + 1px)';
    hueswatch.style.top = 0;
    hueswatch.style.left = 0;
    var hslacolors = generateHslaColors(45, 100, 1.0, 360);
    for (i = 0; i < hslacolors.length - 1; i++) {
      var item = document.createElement('div');
      item.style.backgroundColor = hslacolors[i];
      item.style.width = '1px';
      item.style.height = '24px';
      hueswatch.appendChild(item);
    }
    pickcolormore.querySelector('.div-color-hue').appendChild(hueswatch);
    var colorOpacity = pickcolor.querySelector('.color-opacity');
    // colorOpacity.onfocus = () => {
    // };
    colorOpacity.oninput = function () {
      var value = colorOpacity.value / 100;
      var rgb = _this.baseRGB;
      if (rgb) {
        var _val;
        if (value === 1) {
          _val = 'rgb(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ')';
        } else {
          _val = 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + value + ')';
        }
        var _inputPreview = pickcolor.querySelector('.is-color-preview');
        _inputPreview.style.backgroundColor = _val;
        var _inputColor = pickcolor.querySelector('.input-text');
        _inputColor.value = _val;

        // Out
        _this.opts.onPick(_val);
        colorOpacity.focus();
      }
    };
    // colorOpacity.onchange = () => {
    //     let val = colorOpacity.value;
    // };

    if (rgb) if (rgb.a) {
      colorOpacity.value = rgb.a * 100;
    } else {
      colorOpacity.value = 1 * 100;
    }
    // colorOpacitySlider._update();

    // Preview
    var transp = colorOpacity.value / 100;
    var val = '';
    var bgImage = '';
    if (rgb) {
      if (transp * 1 === 1) {
        val = 'rgb(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ')';
      } else {
        val = 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + transp + ')';
      }
      bgImage = 'linear-gradient(90deg, rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',0), rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',1))';
    }
    pickcolor.querySelector('.div-color-opacity .color-opacity').style.backgroundImage = bgImage;

    //initial preview
    var inputPreview = pickcolor.querySelector('.is-color-preview');
    inputPreview.style.background = 'none';
    if (val !== '') inputPreview.style.backgroundColor = val;
    var inputColor = pickcolor.querySelector('.input-text');
    inputColor.value = val;

    // let userAgentString = navigator.userAgent; 
    // let firefoxAgent = userAgentString.indexOf('Firefox') > -1; 
    // if(!firefoxAgent) {
    //     this.addEventListener(inputColor, 'keydown', (e) => {
    //         if (e.which === 13 || e.keyCode === 13 || e.key === 'Enter') {
    //             this.setColor(e.target.value);
    //             e.preventDefault();
    //             e.stopImmediatePropagation();
    //         }
    //     });
    // }
    this.addEventListener(inputColor, 'keydown', function (e) {
      if (e.which === 13 || e.keyCode === 13 || e.key === 'Enter') {
        _this.setColor(e.target.value);
        e.preventDefault();
        e.stopImmediatePropagation();
      }
    });
    var inputOk = pickcolor.querySelector('.input-ok');
    this.addEventListener(inputOk, 'click', function () {
      _this.setColor(inputColor.value);
    });
    var elms = pickcolor.querySelectorAll('[data-color]');
    Array.prototype.forEach.call(elms, function (elm) {
      _this.addEventListener(elm, 'click', function (e) {
        var elm = e.target;
        var base = elm.getAttribute('data-color');
        var rgb = hexToRgb(base);
        _this.baseRGB = rgb;
        if (!_this.parentsHasClass(elm, 'color-gradient') && base !== '') {
          if (rgb.r === rgb.g && rgb.g === rgb.b) {
            graySwatch(colorgradient);
          } else {
            var hue = rgbToHue(rgb.r, rgb.g, rgb.b);
            hslSwatch(colorswatch, hue, 1);
            var _colorgradient = pickcolor.querySelector('.color-gradient');
            var _hsl2 = rgbToHsl(rgb.r, rgb.g, rgb.b);
            colorSwatch(_colorgradient, hue, _hsl2[1]);
          }
        }

        // Preview
        var transp = colorOpacity.value / 100;
        var val = '';
        var bgImage = '';
        if (rgb) {
          if (transp * 1 === 1) {
            val = 'rgb(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ')';
          } else {
            val = 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + transp + ')';
          }
          bgImage = 'linear-gradient(90deg, rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',0), rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',1))';
        }
        pickcolor.querySelector('.div-color-opacity .color-opacity').style.backgroundImage = bgImage;
        var inputPreview = pickcolor.querySelector('.is-color-preview');
        inputPreview.style.backgroundColor = val;
        var inputColor = pickcolor.querySelector('.input-text');
        inputColor.value = val;

        // Out
        _this.opts.onPick(val);
        elm.focus();
      });
    });
    elms = pickcolormore.querySelectorAll('[data-color]');
    Array.prototype.forEach.call(elms, function (elm) {
      _this.addEventListener(elm, 'click', function () {
        var base = elm.getAttribute('data-color');
        var rgb = hexToRgb(base);
        _this.baseRGB = rgb;
        var hue = rgbToHue(rgb.r, rgb.g, rgb.b);
        var hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
        colorSwatch(colorgradient, hue, hsl[1]);

        // Preview
        var transp = colorOpacity.value / 100;
        var val = '';
        var bgImage = '';
        if (rgb) {
          if (transp * 1 === 1) {
            val = 'rgb(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ')';
          } else {
            val = 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + transp + ')';
          }
          bgImage = 'linear-gradient(90deg, rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',0), rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',1))';
        }
        pickcolor.querySelector('.div-color-opacity .color-opacity').style.backgroundImage = bgImage;
        var inputPreview = pickcolor.querySelector('.is-color-preview');
        inputPreview.style.backgroundColor = val;
        var inputColor = pickcolor.querySelector('.input-text');
        inputColor.value = val;

        // Out
        _this.opts.onPick(val);
        elm.focus();
      });
    });
  } //constructor
  colorpicker_createClass(ColorPicker, [{
    key: "makeId",
    value: function makeId() {
      var text = '';
      var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      for (var i = 0; i < 2; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      var text2 = '';
      var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      for (var _i = 0; _i < 5; _i++) {
        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
      }
      return text + text2;
    }
  }, {
    key: "out",
    value: function out(s) {
      if (this.opts.lang) {
        var val = this.opts.lang[s];
        if (val) return val;else {
          return s;
        }
      } else {
        return s;
      }
    }
  }, {
    key: "openMore",
    value: function openMore() {
      var _this2 = this;
      var handleKeyDown = function handleKeyDown(e) {
        if (e.keyCode === 27) {
          // escape key
          _this2.pickcolormore.classList.remove('active'); // hide

          _this2.pickcolormore.removeEventListener('keydown', handleKeyDown);
          var btnHsl = _this2.pickcolor.querySelector('.input-hsl');
          btnHsl.focus();
        }
      };
      this.modal.show(this.pickcolormore, false, function () {
        // this.pickcolormore.classList.remove('active'); // hide => not needed

        _this2.pickcolormore.removeEventListener('keydown', handleKeyDown);
        // if(cancelCallback) cancelCallback(); => Doesn't work! Because it is passed into this.modal object.

        var btnHsl = _this2.pickcolor.querySelector('.input-hsl');
        btnHsl.focus();
      }, false);
      this.pickcolormore.addEventListener('keydown', handleKeyDown);
      var input = this.pickcolormore.querySelector('input');
      input.focus();
    }
  }, {
    key: "open",
    value: function open(onPick, color, cancelCallback) {
      var _this3 = this;
      if (onPick) {
        this.opts.onPick = onPick;
      }
      if (color) {
        this.opts.color = color;
        this.setColor(color, true);
      } else {
        var _inputColor2 = this.pickcolor.querySelector('.input-text');
        _inputColor2.value = '';
      }
      var handleKeyDown = function handleKeyDown(e) {
        if (e.keyCode === 27) {
          // escape key
          _this3.pickcolor.classList.remove('active'); // hide

          _this3.pickcolor.removeEventListener('keydown', handleKeyDown);
          if (cancelCallback) cancelCallback();
        }
      };
      this.cancel = cancelCallback;
      this.modal.show(this.pickcolor, false, function () {
        // this.pickcolor.classList.remove('active'); // hide => not needed

        _this3.pickcolor.removeEventListener('keydown', handleKeyDown);
        // if(cancelCallback) cancelCallback(); => Doesn't work! Because it is passed into this.modal object.
        if (_this3.cancel) _this3.cancel();
      }, false);
      this.pickcolor.addEventListener('keydown', handleKeyDown);
      var inputColor = this.pickcolor.querySelector('.input-text');
      inputColor.focus();
    }
  }, {
    key: "isColorName",
    value: function isColorName(color) {
      var colorNamePattern = /^([a-z]+)$/i;
      return colorNamePattern.test(color);
    }
  }, {
    key: "convertColorToRGB",
    value: function convertColorToRGB(colorName) {
      var tempElement = document.createElement('div');
      tempElement.style.color = colorName;
      document.body.appendChild(tempElement);
      var computedColor = window.getComputedStyle(tempElement).color;
      document.body.removeChild(tempElement);

      // Extract RGB values from the computed color
      var rgbValues = computedColor.match(/\d+/g);
      return "rgb(".concat(rgbValues[0], ", ").concat(rgbValues[1], ", ").concat(rgbValues[2], ")");
    }
  }, {
    key: "setColor",
    value: function setColor(color, noCallback) {
      var pickcolor = this.pickcolor;
      var pickcolormore = this.pickcolormore;
      var colorOpacity = pickcolor.querySelector('.color-opacity');
      var colorgradient = pickcolor.querySelector('.color-gradient');
      var isColorName = this.isColorName(color);
      if (isColorName) {
        color = this.convertColorToRGB(color);
      }
      var base = color;
      var rgb;
      if (base.indexOf('rgb') !== -1) {
        //rgb
        rgb = RGBvalues.color(base);
      }
      if (base.indexOf('#') !== -1) {
        //hex
        rgb = hexToRgb(base);
      }
      if (!rgb) {
        graySwatch(colorgradient);
        colorOpacity.value = 1 * 100;
        // this.colorOpacitySlider._update();
        pickcolor.querySelector('.div-color-opacity .color-opacity').style.backgroundImage = '';
        var _inputPreview2 = pickcolor.querySelector('.is-color-preview');
        _inputPreview2.style.background = 'none';
        var _inputColor3 = pickcolor.querySelector('.input-text');
        _inputColor3.value = '';
        return;
      }
      this.baseRGB = rgb;
      if (rgb.r === rgb.g && rgb.g === rgb.b) {
        graySwatch(colorgradient);
      } else {
        var colorswatch = pickcolormore.querySelector('.color-swatch');
        var hue = rgbToHue(rgb.r, rgb.g, rgb.b);
        hslSwatch(colorswatch, hue, 1);
        var hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
        colorSwatch(colorgradient, hue, hsl[1]);
      }
      if (rgb.a || rgb.a === 0) {
        colorOpacity.value = rgb.a * 100;
      } else {
        colorOpacity.value = 1 * 100;
      }
      // this.colorOpacitySlider._update();

      // Preview
      var transp = colorOpacity.value / 100;
      var val = '';
      var bgImage = '';
      if (rgb) {
        if (transp * 1 === 1) {
          val = 'rgb(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ')';
        } else {
          val = 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + transp + ')';
        }
        bgImage = 'linear-gradient(90deg, rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',0), rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',1))';
      }
      pickcolor.querySelector('.div-color-opacity .color-opacity').style.backgroundImage = bgImage;
      var inputPreview = pickcolor.querySelector('.is-color-preview');
      inputPreview.style.backgroundColor = val;
      var inputColor = pickcolor.querySelector('.input-text');
      inputColor.value = val;

      // Out
      if (!noCallback) this.opts.onPick(val);
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(parent, type, listener) {
      parent.addEventListener(type, listener);
    }
  }, {
    key: "parentsHasClass",
    value: function parentsHasClass(element, classname) {
      while (element) {
        if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
        if (!element.classList) return false;
        if (element.classList.contains(classname)) {
          return true;
        }
        element = element.parentNode;
      }
    }
  }]);
  return ColorPicker;
}(); // source: http://stackoverflow.com/questions/1349404/generate-a-string-of-5-random-characters-in-javascript
function makeid() {
  var text = '';
  var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
  for (var i = 0; i < 2; i++) {
    text += possible.charAt(Math.floor(Math.random() * possible.length));
  }
  var text2 = '';
  var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  for (var _i2 = 0; _i2 < 5; _i2++) {
    text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
  }
  return text + text2;
}

// source: https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb
function hexToRgb(hex) {
  if (hex === '') return null;
  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}

// https://stackoverflow.com/questions/3080421/javascript-color-gradient
function hex(c) {
  var s = '0123456789abcdef';
  var i = parseInt(c);
  if (i === 0 || isNaN(c)) return '00';
  i = Math.round(Math.min(Math.max(0, i), 255));
  return s.charAt((i - i % 16) / 16) + s.charAt(i % 16);
}
function rgbToHex(rgb) {
  return hex(rgb[0]) + hex(rgb[1]) + hex(rgb[2]);
}
function generateHslaColors(saturation, lightness, alpha, amount) {
  var colors = [];
  var huedelta = Math.trunc(360 / amount);
  for (var i = 0; i < amount; i++) {
    var hue = i * huedelta;
    colors.push("hsla(".concat(hue, ",").concat(lightness, "%,").concat(saturation, "%,").concat(alpha, ")"));
  }
  return colors;
}

// https://css-tricks.com/hsl-hsla-is-great-for-programmatic-color-control/
// https://codepen.io/chriscoyier/pen/YvPLRg
function hslSwatch(elm, hue) {
  var x, y;
  var len = 10;
  var step = 2 * (100 / len) - 100 / len;
  var adj = step / 2;
  if (elm.innerHTML === '') {
    for (x = 0; x < len; ++x) {
      var tr = document.createElement('div');
      tr.style.width = '100%';
      // tr.id = 'row-' + x;
      tr.classList.add('row-' + x);
      elm.appendChild(tr);
      for (y = 0; y < len; ++y) {
        var sat = x * (100 / (len - 1)) + adj;
        var light = y * (100 / len) + adj;

        //Rounded values
        if (light > 50 && light <= 55) light = 50;
        if (sat > 100) sat = 100;
        //if(x===0)sat=0;

        var rgb = hslToRgb(hue, sat, light);
        var _hex = '#' + rgbToHex(rgb);
        var td = document.createElement('button');
        td.title = _hex;
        td.style.background = _hex;
        td.setAttribute('data-color', _hex);

        // let row = elm.querySelector('#row-' + x);
        var row = elm.querySelector('.row-' + x);
        row.appendChild(td);
      }
    }
  } else {
    for (x = 0; x < len; ++x) {
      var _tr = elm.childNodes[x];
      for (y = 0; y < len; ++y) {
        var _td = _tr.childNodes[y];
        var _sat = x * (100 / (len - 1)) + adj; //adj makes 0 (dark) to 9 become 0.x (not too dark) to 9.x (close to 10 / white)
        var _light = y * (100 / len) + adj;

        //Rounded values
        if (_light > 50 && _light <= 55) _light = 50;
        if (_sat > 100) _sat = 100;
        //if(x===0)sat=0;

        var _rgb = hslToRgb(hue, _sat, _light);
        var _hex2 = '#' + rgbToHex(_rgb);
        _td.title = _hex2;
        _td.style.background = _hex2;
        _td.setAttribute('data-color', _hex2);
      }
    }
  }
}
function colorSwatch(elm, hue, sat) {
  var x, y;
  var rownum = 5;
  var colnum = 7;
  var step = 2 * (100 / colnum) - 100 / colnum;
  //let adj = step/2;

  if (elm.innerHTML === '') {
    for (x = 0; x < rownum; ++x) {
      var tr = document.createElement('div');
      tr.style.width = '100%';
      // tr.id = 'row-' + x;
      tr.classList.add('row-' + x);
      elm.appendChild(tr);
      for (y = 0; y < colnum; ++y) {
        var z = (x - rownum) * -1 - 1; //convert 0 to 11 become 11 to 0

        var light = y * (100 / colnum);
        light = light + z * (step / rownum);

        //Rounded values
        if (y === 0) light = y * (100 / colnum);
        var rgb = hslToRgb(hue, sat, light);
        var _hex3 = '#' + rgbToHex(rgb);
        var td = document.createElement('button');
        td.title = _hex3;
        td.style.background = _hex3;
        td.setAttribute('data-color', _hex3);

        // let row = elm.querySelector('#row-' + x);
        var row = elm.querySelector('.row-' + x);
        row.appendChild(td);
      }
    }
  } else {
    var _tr2, _td2;
    for (x = 0; x < rownum; ++x) {
      _tr2 = elm.childNodes[x];
      for (y = 0; y < colnum; ++y) {
        _td2 = _tr2.childNodes[y];
        var _z = (x - rownum) * -1 - 1; //convert 0 to 11 become 11 to 0

        var _light2 = y * (100 / colnum);
        _light2 = _light2 + _z * (step / rownum);

        //Rounded values
        if (x === colnum - 1 && y === 0) {
          _light2 = 0;
        }
        var _rgb2 = hslToRgb(hue, sat, _light2);
        var _hex4 = '#' + rgbToHex(_rgb2);
        _td2.title = _hex4;
        _td2.style.background = _hex4;
        _td2.setAttribute('data-color', _hex4);
      }
    }
  }
}
function graySwatch(elm) {
  var x, y;
  var rownum = 5;
  var colnum = 7;
  var step = 2 * (100 / colnum) - 100 / colnum;
  if (elm.innerHTML === '') {
    for (x = 0; x < rownum; ++x) {
      var tr = document.createElement('div');
      tr.style.width = '100%';
      // tr.id = 'row-' + x;
      tr.classList.add('row-' + x);
      elm.appendChild(tr);
      for (y = 0; y < colnum; ++y) {
        var z = (x - rownum) * -1 - 1; //convert 0 to 11 become 11 to 0

        var light = y * (100 / colnum);
        light = light + z * (step / rownum);
        if (y === 0) light = y * (100 / colnum);
        var rgb = hslToRgb(0, 0, light);
        var _hex5 = '#' + rgbToHex(rgb);
        var td = document.createElement('div');
        td.title = _hex5;
        td.style.background = _hex5;
        td.setAttribute('data-color', _hex5);

        // let row = elm.querySelector('#row-' + x);
        var row = elm.querySelector('.row-' + x);
        row.appendChild(td);
      }
    }
  } else {
    var _tr3, _td3;
    for (x = 0; x < rownum; ++x) {
      _tr3 = elm.childNodes[x];
      for (y = 0; y < colnum; ++y) {
        _td3 = _tr3.childNodes[y];
        var _z2 = (x - rownum) * -1 - 1; //convert 0 to 11 become 11 to 0

        var _light3 = y * (100 / colnum);
        _light3 = _light3 + _z2 * (step / rownum);
        if (x === colnum - 1 && y === 0) {
          _light3 = 0;
        }
        var _rgb3 = hslToRgb(0, 0, _light3);
        var _hex6 = '#' + rgbToHex(_rgb3);
        _td3.title = _hex6;
        _td3.style.background = _hex6;
        _td3.setAttribute('data-color', _hex6);
      }
    }
  }
}
function hueToRgb(m1, m2, h) {
  if (h < 0) h = h + 1;else if (h > 1) h = h - 1;
  if (h * 6 < 1) return m1 + (m2 - m1) * h * 6;else if (h * 2 < 1) return m2;else if (h * 3 < 2) return m1 + (m2 - m1) * (2 / 3 - h) * 6;else return m1;
}
function hslToRgb(h, s, l) {
  h /= 360;
  s /= 100;
  l /= 100;
  var m2 = l <= 0.5 ? l * (s + 1) : l + s - l * s,
    m1 = l * 2 - m2,
    r = parseInt(hueToRgb(m1, m2, h + 1 / 3) * 255),
    g = parseInt(hueToRgb(m1, m2, h) * 255),
    b = parseInt(hueToRgb(m1, m2, h - 1 / 3) * 255);
  return [r, g, b];
}

// https://stackoverflow.com/questions/39118528/rgb-to-hsl-conversion
function rgbToHue(r, g, b) {
  r /= 255;
  g /= 255;
  b /= 255;
  var max = Math.max(r, g, b);
  var min = Math.min(r, g, b);
  var c = max - min;
  var hue;
  var segment;
  var shift;
  if (c === 0) {
    hue = 0;
  } else {
    switch (max) {
      case r:
        segment = (g - b) / c;
        shift = 0 / 60; // R° / (360° / hex sides)
        if (segment < 0) {
          // hue > 180, full rotation
          shift = 360 / 60; // R° / (360° / hex sides)
        }

        hue = segment + shift;
        break;
      case g:
        segment = (b - r) / c;
        shift = 120 / 60; // G° / (360° / hex sides)
        hue = segment + shift;
        break;
      case b:
        segment = (r - g) / c;
        shift = 240 / 60; // B° / (360° / hex sides)
        hue = segment + shift;
        break;
      default:
        break;
    }
  }
  return hue * 60; // hue is in [0,6], scale it up
}

// https://stackoverflow.com/questions/10970958/get-a-color-component-from-an-rgb-string-in-javascript
var RGBvalues = function () {
  var _hex2dec = function _hex2dec(v) {
    return parseInt(v, 16);
  };
  var _splitHEX = function _splitHEX(hex) {
    var c;
    if (hex.length === 4) {
      c = hex.replace('#', '').split('');
      return {
        r: _hex2dec(c[0] + c[0]),
        g: _hex2dec(c[1] + c[1]),
        b: _hex2dec(c[2] + c[2])
      };
    } else {
      return {
        r: _hex2dec(hex.slice(1, 3)),
        g: _hex2dec(hex.slice(3, 5)),
        b: _hex2dec(hex.slice(5))
      };
    }
  };
  var _splitRGB = function _splitRGB(rgb) {
    var c = rgb.slice(rgb.indexOf('(') + 1, rgb.indexOf(')')).split(',');
    var flag = false,
      obj;
    c = c.map(function (n, i) {
      // return (i !== 3) ? parseInt(n, 10) : flag = true, parseFloat(n);
      if (i !== 3) {
        return parseInt(n, 10);
      } else {
        flag = true;
        return parseFloat(n);
      }
    });
    obj = {
      r: c[0],
      g: c[1],
      b: c[2]
    };
    if (flag) obj.a = c[3];
    return obj;
  };
  var color = function color(col) {
    var slc = col.slice(0, 1);
    if (slc === '#') {
      return _splitHEX(col);
    } else if (slc.toLowerCase() === 'r') {
      return _splitRGB(col);
    } else {
      console.log('!Ooops! RGBvalues.color(' + col + ') : HEX, RGB, or RGBa strings only');
    }
  };
  return {
    color: color
  };
}();

// https://codepen.io/pankajparashar/pen/oFzIg
function rgbToHsl(r, g, b) {
  //r /= 255, g /= 255, b /= 255;
  r = r / 255;
  g = g / 255;
  b = b / 255;
  var max = Math.max(r, g, b),
    min = Math.min(r, g, b);
  var h,
    s,
    l = (max + min) / 2;
  if (max === min) {
    h = s = 0;
  } else {
    var d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch (max) {
      case r:
        h = (g - b) / d + (g < b ? 6 : 0);
        break;
      case g:
        h = (b - r) / d + 2;
        break;
      case b:
        h = (r - g) / d + 4;
        break;
      default:
        break;
    }
    h /= 6;
  }
  return [h * 100 + 0.5 | 0, s * 100 + 0.5 | 0, l * 100 + 0.5 | 0];
}
/* harmony default export */ const contentbuilder_colorpicker = (ColorPicker);
;// CONCATENATED MODULE: ./src/contentbuilder/gradientpicker.js
function gradientpicker_typeof(obj) { "@babel/helpers - typeof"; return gradientpicker_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, gradientpicker_typeof(obj); }
function gradientpicker_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function gradientpicker_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, gradientpicker_toPropertyKey(descriptor.key), descriptor); } }
function gradientpicker_createClass(Constructor, protoProps, staticProps) { if (protoProps) gradientpicker_defineProperties(Constructor.prototype, protoProps); if (staticProps) gradientpicker_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function gradientpicker_toPropertyKey(arg) { var key = gradientpicker_toPrimitive(arg, "string"); return gradientpicker_typeof(key) === "symbol" ? key : String(key); }
function gradientpicker_toPrimitive(input, hint) { if (gradientpicker_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (gradientpicker_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }



var GradientPicker = /*#__PURE__*/function () {
  function GradientPicker() {
    var _this = this;
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    gradientpicker_classCallCheck(this, GradientPicker);
    var defaults = {
      colors: ['#ff9f01', '#f57c00', '#e64918', '#d32f2f', '#5d4038', '#37474f', '#353535', '#fbc02c', '#b0b42a', '#689f39', '#c21f5b', '#7b21a2', '#522da8', '#616161', '#01b8c9', '#009688', '#388d3c', '#0388d0', '#1465c0', '#2f3f9e', '#9e9e9e'],
      gradientcolors: [['linear-gradient(0deg, rgb(255, 57, 25), rgb(249, 168, 37))'], ['linear-gradient(0deg, rgb(255, 57, 25), rgb(255, 104, 15))'], ['linear-gradient(0deg, #FF5722, #FF9800)'], ['linear-gradient(0deg, #613ca2, rgb(110, 123, 217))'], ['linear-gradient(0deg, rgb(65, 70, 206), rgb(236, 78, 130))'], ['linear-gradient(0deg, rgb(0, 150, 102), rgb(90, 103, 197))'], ['linear-gradient(30deg, rgb(249, 119, 148), rgb(98, 58, 162))'], ['linear-gradient(0deg, rgb(223, 70, 137), rgb(90, 103, 197))'], ['linear-gradient(0deg, rgb(40, 53, 147), rgb(90, 103, 197))'], ['linear-gradient(0deg, rgb(21, 101, 192), rgb(52, 169, 239))'], ['linear-gradient(0deg, rgb(32, 149, 219), rgb(139, 109, 230))'], ['linear-gradient(0deg, rgb(90, 103, 197), rgb(0, 184, 201))'], ['linear-gradient(0deg, rgb(0, 184, 201), rgb(253, 187, 45))'], ['linear-gradient(0deg, rgb(255, 208, 100), rgb(239, 98, 159))'], ['linear-gradient(0deg, rgb(0, 214, 223), rgb(130, 162, 253))'], ['linear-gradient(0deg, rgb(50, 234, 251), rgb(248, 247, 126))'], ['linear-gradient(0deg, rgb(141, 221, 255), rgb(255, 227, 255))'], ['linear-gradient(0deg, rgb(255, 170, 170), rgb(255, 255, 200))'], ['linear-gradient(0deg, rgb(239, 239, 239), rgb(252, 252, 252))']],
      animateModal: false,
      elementToAnimate: '',
      stuffPlacement: '#_cbhtml',
      lang: []
    };
    this.opts = Object.assign(this, defaults, opts);
    this.id = gradientpicker_makeid();
    var builderStuff = document.querySelector(this.opts.stuffPlacement);
    if (!builderStuff) {
      builderStuff = document.createElement('div');
      builderStuff.id = '_cbhtml';
      builderStuff.className = 'is-ui';
      document.body.appendChild(builderStuff);
    }
    this.builderStuff = builderStuff;

    // Stuff placement for this (single) instance
    var objStuff = document.createElement('div');
    objStuff.id = this.id;
    builderStuff.appendChild(objStuff);
    this.objStuff = objStuff;
    var modal = new contentbuilder_modal({
      animateModal: this.opts.animateModal,
      elementToAnimate: this.opts.elementToAnimate,
      stuffPlacement: this.opts.stuffPlacement
    });
    this.modal = modal;
    var html_gradcolors = '';
    for (var i = 0; i < this.opts.gradientcolors.length; i++) {
      html_gradcolors += "<button data-elmgradient=\"".concat(this.opts.gradientcolors[i][0], "\" data-textcolor=\"").concat(this.opts.gradientcolors[i][1] ? this.opts.gradientcolors[i][1] : '', "\" style=\"background-image:").concat(this.opts.gradientcolors[i][0], ";\"></button>");
    }
    var html = "\n            <div class=\"is-modal pickgradientcolor\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <div class=\"is-modal-bar is-draggable\"></div>\n                    <div style=\"padding:12px 12px 12px\">\n                        <div class=\"div-gradients\" style=\"display: flex;flex-flow: wrap;margin-bottom:10px;\">\n                            ".concat(html_gradcolors, "\n                            <button class=\"input-gradient-clear\" title=\"").concat(this.out('Clear'), "\" data-value=\"\" style=\"width:35px;height:35px;\"><svg class=\"is-icon-flex\" style=\"width:23px;height:23px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                        </div>\n                        <div class=\"is-settings\" style=\"margin-bottom:0\">\n                            <div class=\"is-label\" style=\"margin-top:0\">").concat(this.out('Custom'), ":</div>\n                            <div class=\"div-custom-gradients\" style=\"height:auto;display: flex;flex-flow: wrap;\"></div>\n                            <div>\n                                <button title=\"").concat(this.out('Select Color'), "\" class=\"input-gradient-color1 is-btn-color\" data-value=\"dark\" style=\"border-right:none\"></button>\n                                <button title=\"").concat(this.out('Select Color'), "\" class=\"input-gradient-color2 is-btn-color\" data-value=\"dark\"></button>\n                                <input type=\"text\" class=\"input-gradient-deg\" id=\"{id}\" value=\"0\" style=\"width:60px;height:35px;margin-left:7px;margin-right:5px;font-size:14px;\"/> deg\n                            </div>\n                        </div>\n                        <div class=\"is-settings\" style=\"margin-bottom:0\">\n                            <button title=\"").concat(this.out('Add'), "\" class=\"input-gradient-save classic\" style=\"width:100%;border:none;\"> ").concat(this.out('Add'), " </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ");
    objStuff.insertAdjacentHTML('beforeend', html.replace(/{id}/g, this.makeId()));
    var pickGradient = objStuff.querySelector('.is-modal.pickgradientcolor');
    this.pickGradient = pickGradient;
    var setupTabKeys = function setupTabKeys(div) {
      var inputs = div.querySelectorAll('a[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), *[tabindex]');
      if (inputs.length === 0) return;
      var firstInput = inputs[0];
      var lastInput = inputs[inputs.length - 1];
      // firstInput.focus();

      // console.log(lastInput)
      // console.log(firstInput)

      // Redirect last tab to first input
      lastInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && !e.shiftKey) {
          e.preventDefault();
          firstInput.focus();
        }
      });

      // Redirect first shift+tab to last input
      firstInput.addEventListener('keydown', function (e) {
        if (e.which === 9 && e.shiftKey) {
          e.preventDefault();
          lastInput.focus();
        }
      });
    };
    setupTabKeys(pickGradient);
    new contentbuilder_draggable({
      selector: '#' + this.id + ' .is-draggable'
    });
    var colorPicker = new contentbuilder_colorpicker({
      colors: this.opts.colors,
      animateModal: this.opts.animateModal,
      elementToAnimate: this.opts.container,
      lang: this.opts.lang
    });
    var btnColor1 = objStuff.querySelector('.input-gradient-color1');
    btnColor1.addEventListener('click', function () {
      colorPicker.open(function (color) {
        if (color === '') color = 'transparent';

        // set element style
        var color1 = color;
        var color2 = objStuff.querySelector('.input-gradient-color2').style.backgroundColor;
        var deg = objStuff.querySelector('.input-gradient-deg').value;
        if (color2 === '') color2 = '#ffffff';
        var css = "linear-gradient(".concat(deg, "deg, ").concat(color1, ", ").concat(color2, ")");
        _this.targetElement.style.backgroundImage = css;
        if (_this.opts.onChange) _this.opts.onChange(css);

        // update preview
        btnColor1.style.backgroundColor = color;
      }, btnColor1.style.backgroundColor, function () {
        btnColor1.removeAttribute('data-focus');
        btnColor1.focus();
      });
      btnColor1.setAttribute('data-focus', true);
    });
    var btnColor2 = objStuff.querySelector('.input-gradient-color2');
    btnColor2.addEventListener('click', function () {
      colorPicker.open(function (color) {
        if (color === '') color = 'transparent';

        // set element style
        var color1 = objStuff.querySelector('.input-gradient-color1').style.backgroundColor;
        var color2 = color;
        var deg = objStuff.querySelector('.input-gradient-deg').value;
        if (color1 === '') color1 = '#ffffff';
        var css = "linear-gradient(".concat(deg, "deg, ").concat(color1, ", ").concat(color2, ")");
        _this.targetElement.style.backgroundImage = css;
        if (_this.opts.onChange) _this.opts.onChange(css);

        // update preview
        btnColor2.style.backgroundColor = color;
      }, btnColor2.style.backgroundColor, function () {
        btnColor2.removeAttribute('data-focus');
        btnColor2.focus();
      });
      btnColor2.setAttribute('data-focus', true);
    });

    // Apply default gradient
    var btns = objStuff.querySelectorAll('.div-gradients [data-elmgradient]');
    Array.prototype.forEach.call(btns, function (btn) {
      var grad = btn.getAttribute('data-elmgradient');
      var textcolor = btn.getAttribute('data-textcolor');
      btn.addEventListener('click', function () {
        _this.targetElement.style.backgroundImage = grad;
        if (_this.opts.onChange) _this.opts.onChange(grad, textcolor);

        // Read gradient
        var s = _this.targetElement.style.backgroundImage;
        if (s.indexOf('linear-gradient') !== -1) {
          var result = getGradient(s);
          if (result !== null) {
            try {
              var color1 = result.colorStopList[0].color;
              var color2 = result.colorStopList[1].color;
              var line = result.line;
              _this.objStuff.querySelector('.input-gradient-color1').style.backgroundColor = color1;
              _this.objStuff.querySelector('.input-gradient-color2').style.backgroundColor = color2;
              if (line.indexOf('deg') !== -1) {
                _this.objStuff.querySelector('.input-gradient-deg').value = line.replace('deg', '');
              }
            } catch (e) {
              // Do Nothing
            }
          }
        }
        var btns = objStuff.querySelectorAll('.div-gradients [data-elmgradient]');
        Array.prototype.forEach.call(btns, function (btn) {
          _this.removeClass(btn, 'active');
        });
        _this.addClass(btn, 'active');
      });
    });
    var btnClear = objStuff.querySelector('.input-gradient-clear');
    btnClear.addEventListener('click', function () {
      _this.targetElement.style.backgroundImage = '';
      if (_this.opts.onChange) _this.opts.onChange('');
      _this.objStuff.querySelector('.input-gradient-color1').style.backgroundColor = '';
      _this.objStuff.querySelector('.input-gradient-color2').style.backgroundColor = '';
      _this.objStuff.querySelector('.input-gradient-deg').value = '0';
    });
    var inputDeg = objStuff.querySelector('.input-gradient-deg');
    inputDeg.addEventListener('keyup', function () {
      // set element style
      var color1 = objStuff.querySelector('.input-gradient-color1').style.backgroundColor;
      var color2 = objStuff.querySelector('.input-gradient-color2').style.backgroundColor;
      var deg = inputDeg.value;

      // if(color1 === '') color1 = '#ffffff';
      // if(color2 === '') color2 = '#ffffff';

      var css = "linear-gradient(".concat(deg, "deg, ").concat(color1, ", ").concat(color2, ")");
      _this.targetElement.style.backgroundImage = css;
      if (_this.opts.onChange) _this.opts.onChange(css);
    });
    var btnSave = objStuff.querySelector('.input-gradient-save');
    btnSave.addEventListener('click', function () {
      var color1 = objStuff.querySelector('.input-gradient-color1').style.backgroundColor;
      var color2 = objStuff.querySelector('.input-gradient-color2').style.backgroundColor;
      var deg = inputDeg.value;

      // if(color1 === '') color1 = '#ffffff';
      // if(color2 === '') color2 = '#ffffff';

      var css = "linear-gradient(".concat(deg, "deg, ").concat(color1, ", ").concat(color2, ")");

      // Save
      var customgradcolors = [];
      if (localStorage.getItem('_customgradcolors') !== null) {
        customgradcolors = JSON.parse(localStorage.getItem('_customgradcolors'));
      }
      customgradcolors.push(css);
      localStorage.setItem('_customgradcolors', JSON.stringify(customgradcolors));

      // Render custom gradients
      if (localStorage.getItem('_customgradcolors') !== null) {
        var _customgradcolors = JSON.parse(localStorage.getItem('_customgradcolors'));
        var _html_gradcolors = '';
        for (var i = 0; i < _customgradcolors.length; i++) {
          _html_gradcolors += "<button class=\"is-elmgrad-item\" data-elmgradient=\"".concat(_customgradcolors[i], "\" style=\"background-image:").concat(_customgradcolors[i], ";\"><div class=\"is-elmgrad-remove\"><svg class=\"is-icon-flex\" style=\"fill:rgba(255, 255, 255, 1);width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></div></button>");
        }
        _this.objStuff.querySelector('.div-custom-gradients').innerHTML = _html_gradcolors;
      }

      // Apply custom gradient
      var btns = _this.objStuff.querySelectorAll('.div-custom-gradients [data-elmgradient]');
      Array.prototype.forEach.call(btns, function (btn) {
        var grad = btn.getAttribute('data-elmgradient');
        btn.addEventListener('click', function () {
          _this.targetElement.style.backgroundImage = grad;
          if (_this.opts.onChange) _this.opts.onChange(grad);

          // Read gradient
          var s = _this.targetElement.style.backgroundImage;
          if (s.indexOf('linear-gradient') !== -1) {
            var result = getGradient(s);
            if (result !== null) {
              try {
                var _color = result.colorStopList[0].color;
                var _color2 = result.colorStopList[1].color;
                var line = result.line;
                _this.objStuff.querySelector('.input-gradient-color1').style.backgroundColor = _color;
                _this.objStuff.querySelector('.input-gradient-color2').style.backgroundColor = _color2;
                if (line.indexOf('deg') !== -1) {
                  _this.objStuff.querySelector('.input-gradient-deg').value = line.replace('deg', '');
                }
              } catch (e) {
                // Do Nothing
              }
            }
          }
          var btns = objStuff.querySelectorAll('.div-custom-gradients [data-elmgradient]');
          Array.prototype.forEach.call(btns, function (btn) {
            _this.removeClass(btn, 'active');
          });
          _this.addClass(btn, 'active');
        });
      });

      // Delete custom gradient
      var btnsRemoveGrad = _this.objStuff.querySelectorAll('.div-custom-gradients .is-elmgrad-remove');
      Array.prototype.forEach.call(btnsRemoveGrad, function (btnRemoveGrad) {
        btnRemoveGrad.addEventListener('click', function () {
          //Custom grad colors
          var customgradcolors = [];
          if (localStorage.getItem('_customgradcolors') !== null) {
            customgradcolors = JSON.parse(localStorage.getItem('_customgradcolors'));
          }
          var css = btnRemoveGrad.parentNode.getAttribute('data-elmgradient');
          for (var i = 0; i < customgradcolors.length; i++) {
            if (customgradcolors[i] === css) {
              customgradcolors.splice(i, 1);
            }
          }
          localStorage.setItem('_customgradcolors', JSON.stringify(customgradcolors));
          btnRemoveGrad.parentNode.parentNode.removeChild(btnRemoveGrad.parentNode);
          return false;
        });
      });
    });
  } //constructor
  gradientpicker_createClass(GradientPicker, [{
    key: "makeId",
    value: function makeId() {
      var text = '';
      var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      for (var i = 0; i < 2; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      var text2 = '';
      var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      for (var _i = 0; _i < 5; _i++) {
        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
      }
      return text + text2;
    }
  }, {
    key: "out",
    value: function out(s) {
      if (this.opts.lang) {
        var val = this.opts.lang[s];
        if (val) return val;else {
          return s;
        }
      } else {
        return s;
      }
    }
  }, {
    key: "open",
    value: function open(elm, onChange, onFinish) {
      var _this2 = this;
      this.opts.onChange = onChange;
      this.opts.onFinish = onFinish;
      this.targetElement = elm;

      // Read gradient
      this.objStuff.querySelector('.input-gradient-color1').style.backgroundColor = '';
      this.objStuff.querySelector('.input-gradient-color2').style.backgroundColor = '';
      this.objStuff.querySelector('.input-gradient-deg').value = '0';
      var s = elm.style.backgroundImage;
      if (s.indexOf('linear-gradient') !== -1) {
        var result = getGradient(s);
        if (result !== null) {
          try {
            var color1 = result.colorStopList[0].color;
            var color2 = result.colorStopList[1].color;
            var line = result.line;
            this.objStuff.querySelector('.input-gradient-color1').style.backgroundColor = color1;
            this.objStuff.querySelector('.input-gradient-color2').style.backgroundColor = color2;
            if (line.indexOf('deg') !== -1) {
              this.objStuff.querySelector('.input-gradient-deg').value = line.replace('deg', '');
            }
          } catch (e) {
            // Do Nothing
          }
        }
      }

      // Save original style
      this.original = s;

      // Render custom gradients
      var customgradcolors = [];
      if (localStorage.getItem('_customgradcolors') !== null) {
        customgradcolors = JSON.parse(localStorage.getItem('_customgradcolors'));
        var html_gradcolors = '';
        for (var i = 0; i < customgradcolors.length; i++) {
          html_gradcolors += "<button class=\"is-elmgrad-item\" data-elmgradient=\"".concat(customgradcolors[i], "\" style=\"background-image:").concat(customgradcolors[i], ";\"><div class=\"is-elmgrad-remove\"><svg class=\"is-icon-flex\" style=\"fill:rgba(255, 255, 255, 1);width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></div></button>");
        }
        this.objStuff.querySelector('.div-custom-gradients').innerHTML = html_gradcolors;
      }

      // Apply custom gradient
      var btns = this.objStuff.querySelectorAll('.div-custom-gradients [data-elmgradient]');
      Array.prototype.forEach.call(btns, function (btn) {
        var grad = btn.getAttribute('data-elmgradient');
        btn.addEventListener('click', function () {
          _this2.targetElement.style.backgroundImage = grad;
          if (_this2.opts.onChange) _this2.opts.onChange(grad);

          // Read gradient
          var s = _this2.targetElement.style.backgroundImage;
          if (s.indexOf('linear-gradient') !== -1) {
            var _result = getGradient(s);
            if (_result !== null) {
              try {
                var _color3 = _result.colorStopList[0].color;
                var _color4 = _result.colorStopList[1].color;
                var _line = _result.line;
                _this2.objStuff.querySelector('.input-gradient-color1').style.backgroundColor = _color3;
                _this2.objStuff.querySelector('.input-gradient-color2').style.backgroundColor = _color4;
                if (_line.indexOf('deg') !== -1) {
                  _this2.objStuff.querySelector('.input-gradient-deg').value = _line.replace('deg', '');
                }
              } catch (e) {
                // Do Nothing
              }
            }
          }
          var btns = _this2.objStuff.querySelectorAll('.div-custom-gradients [data-elmgradient]');
          Array.prototype.forEach.call(btns, function (btn) {
            _this2.removeClass(btn, 'active');
          });
          _this2.addClass(btn, 'active');
        });
      });

      // Delete custom gradient
      var btnsRemoveGrad = this.objStuff.querySelectorAll('.div-custom-gradients .is-elmgrad-remove');
      Array.prototype.forEach.call(btnsRemoveGrad, function (btnRemoveGrad) {
        btnRemoveGrad.addEventListener('click', function () {
          //Custom grad colors
          var customgradcolors = [];
          if (localStorage.getItem('_customgradcolors') !== null) {
            customgradcolors = JSON.parse(localStorage.getItem('_customgradcolors'));
          }
          var css = btnRemoveGrad.parentNode.getAttribute('data-elmgradient');
          for (var i = 0; i < customgradcolors.length; i++) {
            if (customgradcolors[i] === css) {
              customgradcolors.splice(i, 1);
            }
          }
          localStorage.setItem('_customgradcolors', JSON.stringify(customgradcolors));
          btnRemoveGrad.parentNode.parentNode.removeChild(btnRemoveGrad.parentNode);
          return false;
        });
      });
      var handleKeyDown = function handleKeyDown(e) {
        if (e.keyCode === 27) {
          // escape key
          _this2.pickGradient.classList.remove('active'); // hide

          _this2.pickGradient.removeEventListener('keydown', handleKeyDown);

          // no change
          if (_this2.opts.onFinish) {
            _this2.opts.onFinish(false);
          }
        }
      };
      this.modal.show(this.pickGradient, false, function () {
        _this2.pickGradient.removeEventListener('keydown', handleKeyDown);
        if (_this2.original === _this2.targetElement.style.backgroundImage) {
          // no change
          if (_this2.opts.onFinish) {
            _this2.opts.onFinish(false);
          }
        } else {
          // changed
          if (_this2.opts.onFinish) {
            _this2.opts.onFinish(true);
          }
        }
      }, false);
      this.pickGradient.addEventListener('keydown', handleKeyDown);
      var btn = this.pickGradient.querySelector('button');
      btn.focus();
    }
  }, {
    key: "addClass",
    value: function addClass(element, classname) {
      if (!element) return;
      if (this.hasClass(element, classname)) return;
      if (element.classList.length === 0) element.className = classname;else element.className = element.className + ' ' + classname;
      //else element.classList.add(classname); //error if there is -
    }
  }, {
    key: "removeClass",
    value: function removeClass(element, classname) {
      if (!element) return;
      if (element.classList.length > 0) {
        element.className = element.className.replace(classname, '');
      }
    }
  }, {
    key: "hasClass",
    value: function hasClass(element, classname) {
      if (!element) return false;
      return element.classList ? element.classList.contains(classname) : new RegExp('\\b' + classname + '\\b').test(element.className);
    }
  }]);
  return GradientPicker;
}(); // source: http://stackoverflow.com/questions/1349404/generate-a-string-of-5-random-characters-in-javascript
function gradientpicker_makeid() {
  var text = '';
  var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
  for (var i = 0; i < 2; i++) {
    text += possible.charAt(Math.floor(Math.random() * possible.length));
  }
  var text2 = '';
  var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  for (var _i2 = 0; _i2 < 5; _i2++) {
    text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
  }
  return text + text2;
}

// source: https://stackoverflow.com/questions/20215440/parse-css-gradient-rule-with-javascript-regex 
function getGradient(input) {
  var result,
    regExpLib = generateRegExp(),
    //rGradientEnclosedInBrackets = /.*gradient\s*\(((?:\([^\)]*\)|[^\)\(]*)*)\)/,// Captures inside brackets - max one additional inner set.
    rGradientEnclosedInBrackets = /.*gradient\s*\(((?:\([^)]*\)|[^)(]*)*)\)/,
    // Oct 29, 2019
    match = rGradientEnclosedInBrackets.exec(input);
  if (match !== null) {
    // Get the parameters for the gradient
    result = parseGradient(regExpLib, match[1]);
    if (result.original.trim() !== match[1].trim()) {
      // Did not match the input exactly - possible parsing error.
      result.parseWarning = true;
    }
  } else {
    result = 'Failed to find gradient';
  }
  return result;
}
var combineRegExp = function combineRegExp(regexpList, flags) {
  var i,
    source = '';
  for (i = 0; i < regexpList.length; i++) {
    if (typeof regexpList[i] === 'string') {
      source += regexpList[i];
    } else {
      source += regexpList[i].source;
    }
  }
  return new RegExp(source, flags);
};
var generateRegExp = function generateRegExp() {
  // Note any variables with "Capture" in name include capturing bracket set(s).
  var searchFlags = 'gi',
    // ignore case for angles, "rgb" etc
    rAngle = /(?:[+-]?\d*\.?\d+)(?:deg|grad|rad|turn)/,
    // Angle +ive, -ive and angle types
    rSideCornerCapture = /to\s+((?:(?:left|right)(?:\s+(?:top|bottom))?))/,
    // optional 2nd part
    rComma = /\s*,\s*/,
    // Allow space around comma.
    //rColorHex = /\#(?:[a-f0-9]{6}|[a-f0-9]{3})/, // 3 or 6 character form
    rColorHex = /#(?:[a-f0-9]{6}|[a-f0-9]{3})/,
    // 3 or 6 character form // Oct 29, 2019
    rDigits3 = /\(\s*(?:\d{1,3}\s*,\s*){2}\d{1,3}\s*\)/,
    // "(1, 2, 3)"
    rDigits4 = /\(\s*(?:\d{1,3}\s*,\s*){2}\d{1,3}\s*,\s*\d*\.?\d+\)/,
    // "(1, 2, 3, 4)"
    rValue = /(?:[+-]?\d*\.?\d+)(?:%|[a-z]+)?/,
    // ".9", "-5px", "100%".
    rKeyword = /[_a-z-][_a-z0-9-]*/,
    // "red", "transparent", "border-collapse".
    rColor = combineRegExp(['(?:', rColorHex, '|', '(?:rgb|hsl)', rDigits3, '|', '(?:rgba|hsla)', rDigits4, '|', rKeyword, ')'], ''),
    rColorStop = combineRegExp([rColor, '(?:\\s+', rValue, '(?:\\s+', rValue, ')?)?'], ''),
    // Single Color Stop, optional %, optional length.
    rColorStopList = combineRegExp(['(?:', rColorStop, rComma, ')*', rColorStop], ''),
    // List of color stops min 1.
    rLineCapture = combineRegExp(['(?:(', rAngle, ')|', rSideCornerCapture, ')'], ''),
    // Angle or SideCorner
    rGradientSearch = combineRegExp(['(?:(', rLineCapture, ')', rComma, ')?(', rColorStopList, ')'], searchFlags),
    // Capture 1:"line", 2:"angle" (optional), 3:"side corner" (optional) and 4:"stop list".
    rColorStopSearch = combineRegExp(['\\s*(', rColor, ')', '(?:\\s+', '(', rValue, '))?', '(?:', rComma, '\\s*)?'], searchFlags); // Capture 1:"color" and 2:"position" (optional).

  return {
    gradientSearch: rGradientSearch,
    colorStopSearch: rColorStopSearch
  };
};
var parseGradient = function parseGradient(regExpLib, input) {
  var result, matchGradient, matchColorStop, stopResult;

  // reset search position, because we reuse regex.
  regExpLib.gradientSearch.lastIndex = 0;
  matchGradient = regExpLib.gradientSearch.exec(input);
  if (matchGradient !== null) {
    result = {
      original: matchGradient[0],
      colorStopList: []
    };

    // // Line (Angle or Side-Corner).
    // if (!!matchGradient[1]) {
    //     result.line = matchGradient[1];
    // }
    // // Angle or undefined if side-corner.
    // if (!!matchGradient[2]) {
    //     result.angle = matchGradient[2];
    // }
    // // Side-corner or undefined if angle.
    // if (!!matchGradient[3]) {
    //     result.sideCorner = matchGradient[3];
    // }

    // Oct 29, 2019
    // Line (Angle or Side-Corner).
    if (matchGradient[1]) {
      result.line = matchGradient[1];
    }
    // Angle or undefined if side-corner.
    if (matchGradient[2]) {
      result.angle = matchGradient[2];
    }
    // Side-corner or undefined if angle.
    if (matchGradient[3]) {
      result.sideCorner = matchGradient[3];
    }

    // reset search position, because we reuse regex.
    regExpLib.colorStopSearch.lastIndex = 0;

    // Loop though all the color-stops.
    matchColorStop = regExpLib.colorStopSearch.exec(matchGradient[4]);
    while (matchColorStop !== null) {
      stopResult = {
        color: matchColorStop[1]
      };

      // // Position (optional).
      // if (!!matchColorStop[2]) {
      //     stopResult.position = matchColorStop[2];
      // }

      // Oct 29, 2019
      // Position (optional).
      if (matchColorStop[2]) {
        stopResult.position = matchColorStop[2];
      }
      result.colorStopList.push(stopResult);

      // Continue searching from previous position.
      matchColorStop = regExpLib.colorStopSearch.exec(matchGradient[4]);
    }
  }

  // Can be undefined if match not found.
  return result;
};
/* harmony default export */ const contentbuilder_gradientpicker = (GradientPicker);
;// CONCATENATED MODULE: ./src/contentbuilder/rowtool.js
function rowtool_typeof(obj) { "@babel/helpers - typeof"; return rowtool_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, rowtool_typeof(obj); }
function rowtool_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function rowtool_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, rowtool_toPropertyKey(descriptor.key), descriptor); } }
function rowtool_createClass(Constructor, protoProps, staticProps) { if (protoProps) rowtool_defineProperties(Constructor.prototype, protoProps); if (staticProps) rowtool_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function rowtool_toPropertyKey(arg) { var key = rowtool_toPrimitive(arg, "string"); return rowtool_typeof(key) === "symbol" ? key : String(key); }
function rowtool_toPrimitive(input, hint) { if (rowtool_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (rowtool_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }






var rowtool_RowTool = /*#__PURE__*/function () {
  function RowTool(builder) {
    rowtool_classCallCheck(this, RowTool);
    this.builder = builder;
    this.grid = new contentbuilder_grid(builder); // a must (also for ContentBox's command.js)
  }

  // Render row & column tools on each row
  rowtool_createClass(RowTool, [{
    key: "render",
    value: function render(row) {
      var _this = this;
      var dom = this.builder.dom;
      var util = this.builder.util;
      var builderStuff = this.builder.builderStuff;
      var rowtool = row.querySelector('.is-row-tool');
      if (!rowtool) {
        var html = "<div class=\"is-tool is-row-tool\">\n                <div title=\"".concat(util.out('Move'), "\" role=\"button\" tabindex=\"-1\" class=\"row-handle\" style=\"width:100%;cursor:move;text-align:center;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-move\"></use></svg></div>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('More'), "\" class=\"row-more\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-more\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Grid Editor'), "\" class=\"row-grideditor\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-grid\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Delete'), "\" class=\"row-remove\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n            </div>\n            <div class=\"is-tool is-col-tool\">\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Add'), "\" class=\"cell-add\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('More'), "\" class=\"cell-more\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-more\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Delete'), "\" class=\"cell-remove\"><svg class=\"is-icon-flex\" style=\"margin-left:-1px\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n            </div>\n            ");
        dom.appendHtml(row, html);
        rowtool = row.querySelector('.is-row-tool');
        // Prepare for tooltip
        var elms = rowtool.querySelectorAll('[title]');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.setAttribute('data-title', elm.getAttribute('title'));
          if (!_this.builder.iframe) {
            _this.builder.tooltip.set(elm, 5, 3);
          } else {
            _this.builder.tooltip.set(elm, 5, 3, true);
          }
        });
        var coltool = row.querySelector('.is-col-tool');
        // Prepare for tooltip
        elms = coltool.querySelectorAll('[title]');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.setAttribute('data-title', elm.getAttribute('title'));
          if (!_this.builder.iframe) {
            _this.builder.tooltip.set(elm, 5, 3);
          } else {
            _this.builder.tooltip.set(elm, 5, 3, true);
          }
        });

        // Check for backward compatibility
        var marginLeft = window.getComputedStyle(coltool, null).getPropertyValue('margin-left');
        if (parseInt(marginLeft) === 0) {
          this.builder.backwardCompatible();
        }
        var btnCellAdd = coltool.querySelector('.cell-add');
        if (btnCellAdd) dom.addEventListener(btnCellAdd, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          contentbuilder_quickadd(_this.builder);
          var quickadd = _this.builder.builderStuff.querySelector('.is-pop.quickadd');
          var tabs = quickadd.querySelector('.is-pop-tabs');
          tabs.style.display = 'flex';
          var newPos = util.getElementPosition(btnCellAdd);
          var top = newPos.top + window.pageYOffset;
          var left = newPos.left + window.pageXOffset;
          if (_this.builder.iframe) {
            left = left + 3;
          }
          util.showPop(quickadd, false, btnCellAdd);
          quickadd.style.top = top + 35 + 'px';
          quickadd.style.left = left + 'px';
          dom.removeClass(quickadd, 'arrow-bottom');
          dom.removeClass(quickadd, 'arrow-left');
          dom.removeClass(quickadd, 'arrow-right');
          dom.removeClass(quickadd, 'center');
          dom.removeClass(quickadd, 'right');
          dom.addClass(quickadd, 'arrow-top');
          dom.addClass(quickadd, 'left');
          var val = quickadd.querySelector('.active').getAttribute('data-value');
          if (val === 'left') {
            quickadd.setAttribute('data-mode', 'cell-left');
          } else {
            quickadd.setAttribute('data-mode', 'cell-right');
          }

          //handleQuickAddClickOut
          var handleQuickAddClickOut = function handleQuickAddClickOut(e) {
            // console.log('handleQuickAddClickOut');
            var elm = e.target;
            if (!elm) return;
            if (!elm.closest('.quickadd') && !elm.closest('.row-add') && !elm.closest('.is-rowadd-tool') && !elm.closest('.cell-add') && !elm.closest('.elm-add') && !elm.closest('.row-add-initial')) {
              // click outside

              // hide
              var _quickadd = builderStuff.querySelector('.quickadd');
              util.hidePop(_quickadd);

              // clear events
              document.removeEventListener('click', handleQuickAddClickOut);
              if (_this.builder.iframeDocument) {
                _this.builder.doc.removeEventListener('click', handleQuickAddClickOut);
              }
              _this.builder.handleQuickAddClickOut_ = false;
            }
          };
          if (!_this.builder.handleQuickAddClickOut_) {
            document.addEventListener('click', handleQuickAddClickOut);
            if (_this.builder.iframeDocument) {
              _this.builder.doc.addEventListener('click', handleQuickAddClickOut);
            }
            _this.builder.handleQuickAddClickOut_ = true;
          }
        });
        var btnCellMore = coltool.querySelector('.cell-more');
        if (btnCellMore) dom.addEventListener(btnCellMore, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          var newPos = util.getElementPosition(btnCellMore);
          var top = newPos.top + window.pageYOffset;
          var left = newPos.left + window.pageXOffset;
          _this.builder.colTool.renderColMore();
          var columnMore = builderStuff.querySelector('.columnmore');
          util.showPop(columnMore, false, btnCellMore);
          columnMore.style.top = top + 35 + 'px';
          columnMore.style.left = left - 7 + 'px';
          dom.removeClass(columnMore, 'arrow-bottom');
          dom.removeClass(columnMore, 'arrow-left');
          dom.removeClass(columnMore, 'arrow-right');
          dom.removeClass(columnMore, 'center');
          dom.removeClass(columnMore, 'right');
          dom.addClass(columnMore, 'arrow-top');
          dom.addClass(columnMore, 'left');
          var btnCellLocking = columnMore.querySelector('.cell-locking');
          if (cell.hasAttribute('data-noedit')) {
            dom.addClass(btnCellLocking, 'on');
          } else {
            dom.removeClass(btnCellLocking, 'on');
          }

          // columnMore 

          var btnIncrease = columnMore.querySelector('.cell-increase');
          var btnDecrease = columnMore.querySelector('.cell-decrease');
          var btnPrev = columnMore.querySelector('.cell-prev');
          var btnNext = columnMore.querySelector('.cell-next');
          var btnUp = columnMore.querySelector('.cell-up');
          var btnDown = columnMore.querySelector('.cell-down');
          var btnDuplicate = columnMore.querySelector('.cell-duplicate');
          var btnLock = columnMore.querySelector('.cell-locking');
          var separator = columnMore.querySelector('.is-separator');
          var nogrid = cell.closest('[nogrid]'); //dom.parentsHasAttribute(col, 'nogrid');
          if (nogrid) {
            btnPrev.style.display = 'none';
            btnNext.style.display = 'none';
            btnUp.style.display = 'none';
            btnDown.style.display = 'none';
            if (btnIncrease) btnIncrease.style.display = 'none';
            if (btnDecrease) btnDecrease.style.display = 'none';
            btnDuplicate.style.display = 'none';
            btnPrev.setAttribute('disabled', 'disabled');
            btnNext.setAttribute('disabled', 'disabled');
            btnUp.setAttribute('disabled', 'disabled');
            btnDown.setAttribute('disabled', 'disabled');
            btnIncrease.setAttribute('disabled', 'disabled');
            btnDecrease.setAttribute('disabled', 'disabled');
            btnDuplicate.setAttribute('disabled', 'disabled');
            var btnColHtml = columnMore.querySelector('.cell-html');
            if (btnColHtml) btnColHtml.style.display = '';
            if (cell.getAttribute('data-html')) {
              columnMore.querySelector('.cell-html').style.display = 'none';
              _this.columnTool.querySelector('.cell-more').style.display = 'none';
              columnMore.querySelector('.cell-html').setAttribute('disabled', 'disabled');
              _this.columnTool.querySelector('.cell-more').setAttribute('disabled', 'disabled');
            }
          } else {
            btnPrev.style.display = '';
            btnNext.style.display = '';
            btnUp.style.display = '';
            btnDown.style.display = '';
            if (btnIncrease) btnIncrease.style.display = '';
            if (btnDecrease) btnDecrease.style.display = '';
            btnDuplicate.style.display = '';
            btnPrev.removeAttribute('disabled');
            btnNext.removeAttribute('disabled');
            btnUp.removeAttribute('disabled');
            btnDown.removeAttribute('disabled');
            if (btnIncrease) btnIncrease.removeAttribute('disabled');
            if (btnDecrease) btnDecrease.removeAttribute('disabled');
            btnDuplicate.removeAttribute('disabled');
            var _btnColHtml = columnMore.querySelector('.cell-html');
            if (_btnColHtml) {
              _btnColHtml.style.display = '';
              _btnColHtml.removeAttribute('disabled');
            }
            var _row = cell.parentNode;
            var num = 3; //is-row-tool, is-col-tool & is-rowadd-tool
            if (_row.querySelector('.is-row-overlay')) {
              num = 4; //is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
            }

            if (_row.childElementCount - num === 1) {
              //-num => minus is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
              btnPrev.style.display = 'none';
              btnNext.style.display = 'none';
              if (btnIncrease) btnIncrease.style.display = 'none';
              if (btnDecrease) btnDecrease.style.display = 'none';
              btnPrev.setAttribute('disabled', 'disabled');
              btnNext.setAttribute('disabled', 'disabled');
              if (btnIncrease) btnIncrease.setAttribute('disabled', 'disabled');
              if (btnDecrease) btnDecrease.setAttribute('disabled', 'disabled');
            } else {
              btnPrev.style.display = '';
              btnNext.style.display = '';
              if (btnIncrease) btnIncrease.style.display = '';
              if (btnDecrease) btnDecrease.style.display = '';
              btnPrev.removeAttribute('disabled');
              btnNext.removeAttribute('disabled');
              if (btnIncrease) btnIncrease.removeAttribute('disabled');
              if (btnDecrease) btnDecrease.removeAttribute('disabled');
            }

            // let btnColHtml = columnMore.querySelector('.cell-html');
            var btnColDuplicate = btnDuplicate;
            if (cell.getAttribute('data-html')) {
              if (_btnColHtml) {
                _btnColHtml.style.display = 'none';
                _btnColHtml.setAttribute('disabled', 'disabled');
              }
              if (btnColDuplicate) {
                btnColDuplicate.style.display = 'none';
                btnColDuplicate.setAttribute('disabled', 'disabled');
              }
            } else {
              if (_btnColHtml) {
                _btnColHtml.style.display = '';
                _btnColHtml.removeAttribute('disabled');
              }
              if (btnColDuplicate) {
                btnColDuplicate.style.display = '';
                btnColDuplicate.removeAttribute('disabled');
              }
            }
          }
          if (cell.classList.contains('column-lock')) {
            btnPrev.style.display = 'none';
            btnNext.style.display = 'none';
            btnUp.style.display = 'none';
            btnDown.style.display = 'none';
            btnIncrease.style.display = 'none';
            btnDecrease.style.display = 'none';
            btnDuplicate.style.display = 'none';
            separator.style.display = 'none';
            btnLock.style.display = 'none';
          } else {
            separator.style.display = '';
            btnLock.style.display = '';
          }
        });
        var btnCellRemove = coltool.querySelector('.cell-remove');
        if (btnCellRemove) dom.addEventListener(btnCellRemove, 'click', function () {
          var grid = new contentbuilder_grid(_this.builder);
          grid.removeColumn();
          util.clearControls();
          if (_this.builder.onSelectChange) _this.builder.onSelectChange();
        });
        var btnGridEditor = rowtool.querySelector('.row-grideditor');
        if (btnGridEditor) dom.addEventListener(btnGridEditor, 'click', function () {
          _this.showGridEditor();
        });
        var btnMore = rowtool.querySelector('.row-more');
        if (btnMore) dom.addEventListener(btnMore, 'click', function () {
          var row;
          var cell = util.cellSelected();
          if (cell) {
            row = cell.parentNode;
          } else {
            row = util.rowSelected();
          }
          if (!row) return;

          //Change to row selection
          dom.removeClass(row, 'row-outline');

          //Hide Column tool (new!)
          util.hideColumnTool();
          var newPos = util.getElementPosition(btnMore);
          var top = newPos.top + window.pageYOffset;
          var left = newPos.left + window.pageXOffset;
          _this.renderRowMore();
          var rowMore = _this.rowMore;

          // rowMore.style.display = 'flex';
          util.showPop(rowMore, false, btnMore);
          //const w = rowMore.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
          //const h = rowMore.offsetHeight;
          rowMore.style.top = top - 8 + 'px';
          dom.removeClass(rowMore, 'arrow-bottom');
          dom.removeClass(rowMore, 'arrow-left');
          dom.removeClass(rowMore, 'arrow-right');
          dom.removeClass(rowMore, 'center');
          dom.removeClass(rowMore, 'right');
          dom.removeClass(rowMore, 'left');
          if (_this.builder.opts.rowTool === 'right') {
            rowMore.style.left = left - rowMore.offsetWidth - 10 + 'px';
            dom.addClass(rowMore, 'arrow-right');
            dom.addClass(rowMore, 'left');
          } else {
            rowMore.style.left = left + 35 + 'px';
            dom.addClass(rowMore, 'arrow-left');
            dom.addClass(rowMore, 'left');
          }
          var btnRowHtml = rowMore.querySelector('.row-html');
          var btnRowDuplicate = rowMore.querySelector('.row-duplicate');
          if (row.querySelector('[data-html]')) {
            if (btnRowHtml) btnRowHtml.style.display = 'none';
            if (btnRowDuplicate) btnRowDuplicate.style.display = 'none';
          } else {
            if (btnRowHtml) btnRowHtml.style.display = '';
            if (btnRowDuplicate) btnRowDuplicate.style.display = '';
          }
          var currentLocking = false;
          var elms = row.querySelectorAll('[data-noedit]');
          elms.forEach(function (elm) {
            if (!elm.hasAttribute('data-html')) {
              currentLocking = true;
            }
          });
          var btnRowLocking = rowMore.querySelector('.row-locking');
          if (currentLocking) {
            dom.addClass(btnRowLocking, 'on');
          } else {
            dom.removeClass(btnRowLocking, 'on');
          }
        });
        var elm = rowtool.querySelector('.row-remove');
        if (elm) dom.addEventListener(elm, 'click', function () {
          _this.grid.removeRow();
          util.clearControls();
          if (_this.builder.onSelectChange) _this.builder.onSelectChange();
        });
      }
    }
  }, {
    key: "renderRowMore",
    value: function renderRowMore() {
      var _this2 = this;
      var builder = this.builder;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var rowMore = builderStuff.querySelector('.rowmore');
      var htmlbutton = '';
      if (builder.opts.rowHtmlEditor) htmlbutton = "<button type=\"button\" title=\"".concat(util.out('HTML'), "\" class=\"row-html\">\n                <span><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></span>").concat(util.out('HTML'), "\n            </button>");
      if (!rowMore) {
        var html = "<div class=\"is-pop rowmore\" style=\"z-index:10002;\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div style=\"display:flex;flex-flow:wrap;\">\n                    <button type=\"button\" title=\"".concat(util.out('Move Up'), "\" class=\"row-up\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></span>").concat(util.out('Move Up'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Move Down'), "\" class=\"row-down\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></span>").concat(util.out('Move Down'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Duplicate'), "\" class=\"row-duplicate\"><span><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></span>").concat(util.out('Duplicate'), "</button>\n                    ").concat(htmlbutton, "\n                    <div class=\"is-separator\"></div>\n                    <button type=\"button\" title=\"").concat(util.out('Lock'), "\" class=\"row-locking\"><span><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-lock\"></use></svg></span>").concat(util.out('Lock'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Settings'), "\" class=\"row-settings\"><span><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-gear\"></use></svg></span>").concat(util.out('Settings'), "</button>\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        rowMore = builderStuff.querySelector('.rowmore');
        this.rowMore = rowMore;

        // Open Row Settings
        var elm = rowMore.querySelector('.row-settings');
        if (elm) dom.addEventListener(elm, 'click', function () {
          if (_this2.builder.controlPanel) {
            _this2.builder.controlpanel.select('row', true);
            util.hidePop(_this2.rowMore);
            return;
          }
          _this2.renderPanel();
          var rowSettings = _this2.rowSettings;
          var row = _this2.rowOverlay();
          if (!row) return;
          _this2.readRowStyles(row);

          //save selection
          util.saveSelection();
          util.showModal(rowSettings, false, function () {
            var rtetool = builderStuff.querySelector('.is-rte-tool');
            if (rtetool.style.display === 'flex') {
              // means text selection
              util.restoreSelection();
            }
          });
          util.hidePop(_this2.rowMore);
        });
        elm = rowMore.querySelector('.row-up');
        if (elm) dom.addEventListener(elm, 'click', function () {
          _this2.grid.moveRowUp();
        });
        elm = rowMore.querySelector('.row-down');
        if (elm) dom.addEventListener(elm, 'click', function () {
          _this2.grid.moveRowDown();
        });
        elm = rowMore.querySelector('.row-duplicate');
        if (elm) dom.addEventListener(elm, 'click', function () {
          _this2.grid.duplicateRow();
          util.hidePop(rowMore);

          //Hide Column tool (new!)
          util.hideColumnTool();
          util.clearControls();
        });
        elm = rowMore.querySelector('.row-html');
        if (elm) dom.addEventListener(elm, 'click', function () {
          var row;
          var cell = util.cellSelected();
          if (cell) {
            row = cell.parentNode;
          } else {
            row = util.rowSelected();
          }
          if (!row) return;
          var htmlutil = new contentbuilder_html(builder);
          htmlutil.view('row');
        });

        // Lock/Unlock Row
        var btnRowLocking = rowMore.querySelector('.row-locking');
        if (btnRowLocking) dom.addEventListener(btnRowLocking, 'click', function (e) {
          var row = util.rowSelected();
          if (!row) return;
          var currentLocking = false;
          var elms = row.querySelectorAll('[data-noedit]');
          elms.forEach(function (elm) {
            if (!elm.hasAttribute('data-html')) {
              currentLocking = true;
            }
          });
          if (!currentLocking) {
            Array.from(row.children).map(function (cell) {
              if (cell.classList.contains('is-row-tool')) return;
              if (cell.classList.contains('is-col-tool')) return;
              if (cell.classList.contains('is-rowadd-tool')) return;
              if (cell.classList.contains('is-row-overlay')) return;
              cell.setAttribute('data-noedit', '');
              cell.contentEditable = false;
              util.clearActiveElement(true);
              builder.colTool.showHideLockIndicator(cell);
              builder.element.applyBehavior(cell);
            });
            dom.addClass(btnRowLocking, 'on');
          } else {
            Array.from(row.children).map(function (cell) {
              if (cell.classList.contains('is-row-tool')) return;
              if (cell.classList.contains('is-col-tool')) return;
              if (cell.classList.contains('is-rowadd-tool')) return;
              if (cell.classList.contains('is-row-overlay')) return;
              cell.removeAttribute('data-noedit');
              cell.contentEditable = true;
              builder.colTool.showHideLockIndicator(cell);
              builder.element.applyBehavior(cell);
            });
            dom.removeClass(btnRowLocking, 'on');
          }
          util.hidePop(rowMore);
          e.preventDefault();
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this3 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var rowSettings = builderStuff.querySelector('.is-modal.rowsettings');
      if (!rowSettings) {
        var html = "\n            <div class=\"is-modal rowsettings\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <div class=\"is-modal-bar is-draggable\">\n                        ".concat(util.out('Row Settings'), "\n                        <button class=\"is-modal-close\" title=\"").concat(util.out('Close'), "\" tabindex=\"-1\">&#10005;</button>\n                    </div>\n\n                    <div style=\"padding:0;margin-top:35px;\">\n\n                        <div class=\"is-tabs\" data-group=\"rowsettings\">\n                            <a title=\"").concat(util.out('General'), "\" id=\"tabRowGeneral\" href=\"#\" data-content=\"divRowGeneral\" class=\"active\">").concat(util.out('General'), "</a>\n                            <a title=\"").concat(util.out('More'), "\" id=\"tabRowMore\" href=\"#\" data-content=\"divRowMore\">").concat(util.out('More'), "</a>\n                        </div>\n                        <div id=\"divRowGeneral\" class=\"is-tab-content active\" data-group=\"rowsettings\" style=\"display:flex\" tabindex=\"-1\">\n                        \n                            <div style=\"padding-bottom: 3px;\">").concat(util.out('Background Color'), ":</div>\n                            <div style=\"display:flex;\">\n                                <button title=\"").concat(util.out('Background Color'), "\" class=\"input-row-bgcolor is-btn-color\" style=\"margin-right:15px\"></button>\n                                <button title=\"").concat(util.out('Gradient'), "\" class=\"input-row-gradient classic\" data-value=\"+\"> ").concat(util.out('Gradient'), " </button>\n                            </div>\n\n                            <div style=\"padding-top:20px;padding-bottom: 3px;\">").concat(util.out('Background Image'), ":</div>\n                            <div>\n                                <div class=\"cell-bgimage-preview\"></div>\n                                <div style=\"display: flex\">\n                                    <button title=\"").concat(util.out('Image'), "\" class=\"input-cell-bgimage\">\n                                        <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-image\"></use></svg>\n                                        <span>").concat(util.out('Image'), "</span>\n                                    </button>\n                                    <button title=\"").concat(util.out('Select'), "\" class=\"input-select\">\n                                        ").concat(this.builder.opts.selectIcon, "\n                                    </button>\n                                    <button title=\"").concat(util.out('Remove'), "\" class=\"input-row-bgremove\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                                    <button title=\"").concat(util.out('Adjust'), "\" class=\"input-row-bgimageadjust\" style=\"width:40px\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-wrench\"></use></svg></button>\n                                </div>\n                            </div>\n\n                            <div style=\"padding:30px 0 10px;\">\n                                <label class=\"label-row-grayscale label-checkbox\" for=\"chkRowGrayscale\"><input id=\"chkRowGrayscale\" class=\"chk-row-grayscale\" type=\"checkbox\" /> ").concat(util.out('Grayscale'), "</label>\n                            </div>\n\n                            <div class=\"div-row-wrapcolumns\" style=\"display:none;flex-direction:column;padding-bottom:7px\">\n                                <div style=\"padding-top:20px;padding-bottom:3px;\">").concat(util.out('Wrap Columns (Breakpoint)'), ":</div>\n                                <div style=\"padding-top:3px;padding-bottom:5px;display:flex;align-items: center;\">\n\n                                    <label class=\"flex mr-3\" title=\"").concat(util.out('Tablet (Landscape)'), "\">\n                                        <input type=\"radio\" id=\"rdoColMdWrap\" name=\"boxWrap\" value=\"md\">\n                                        <svg class=\"is-icon-flex\" style=\"margin-left:3px;width:16px;height:16px;transform:rotate(-90deg)\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                                    </label>\n                                    <label class=\"flex mr-3\" title=\"").concat(util.out('Tablet (Portrait)'), "\">\n                                        <input type=\"radio\" id=\"rdoColSmWrap\" name=\"boxWrap\" value=\"sm\">\n                                        <svg class=\"is-icon-flex\" style=\"margin-left:3px;width:16px;height:16px\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                                    </label>\n                                    <label class=\"flex\" title=\"").concat(util.out('Mobile'), "\">\n                                        <input type=\"radio\" id=\"rdoColXsWrap\" name=\"boxWrap\" value=\"xs\">\n                                        <svg class=\"is-icon-flex\" style=\"margin-left:3px;width:16px;height:16px\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                                    </label>\n\n                                </div>\n                            </div>\n\n                            <div class=\"is-separator\"></div>\n                         \n                            <div class=\"div-target\" style=\"display: flex;justify-content: flex-end;padding: 5px 0 0;\">\n                                <button title=\"").concat(util.out('Desktop'), "\" class=\"input-device on\" data-value=\"\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-device-desktop\"></use></svg>\n                                </button>\n                                <!--<button title=\"").concat(util.out('Laptop/Tablet (Landscape)'), "\" class=\"input-device\" data-value=\"md\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#icon-device-laptop\"></use></svg>\n                                </button>-->\n                                <button title=\"").concat(util.out('Laptop/Tablet (Landscape)'), "\" class=\"input-device\" data-value=\"md\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;transform:rotate(-90deg)\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                                </button>\n                                <button title=\"").concat(util.out('Tablet (Portrait)'), "\" class=\"input-device\" data-value=\"sm\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                                </button>\n                                <button title=\"").concat(util.out('Mobile'), "\" class=\"input-device\" data-value=\"xs\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:13px;height:13px\"><use xlink:href=\"#icon-device-mobile\"></use></svg>\n                                </button>\n                            </div>\n\n                            <div style=\"padding-top:0;padding-bottom:3px;\">").concat(util.out('Visibility'), ":</div>\n                            <div class=\"div-visibility\" style=\"display:flex;\">\n                                <button title=\"").concat(util.out('Visible'), "\" class=\"input-visible on\" data-value=\"sm\" style=\"width:100px;height:34px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-eye\"></use></svg>\n                                    <span>").concat(util.out('Visible'), "</span>\n                                </button>\n                                <button title=\"").concat(util.out('Hidden'), "\" class=\"input-hidden\" data-value=\"xs\" style=\"width:100px;height:34px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-eye-off\"></use></svg>\n                                    <span>").concat(util.out('Hidden'), "</span>\n                                </button>\n                            </div>\n\n                            <div class=\"div-colsperline\" style=\"flex-direction:column\">\n                                <label style=\"margin:20px 0 0;display:flex;flex-direction:column\">\n                                    <span style=\"margin:0 4px 3px 0\">").concat(util.out('Columns per Line'), ":</span>\n                                    <select class=\"input-numofcols\" id=\"__input_numofcols\" style=\"width:50%;display:none\">\n                                        <option value=\"\">Default</option>\n                                        <option value=\"2\">2 columns per row</option>\n                                        <option value=\"3\">3 columns per row</option>\n                                        <option value=\"4\">4 columns per row</option>\n                                        <option value=\"5\">5 columns per row</option>\n                                        <option value=\"6\">6 columns per row</option>\n                                    </select>\n                                </label>\n                                <div class=\"flex\">\n                                    <button title=\"1\" class=\"input-colsperline on\" data-value=\"1\" style=\"width:40px;height:25px;\">1</button>\n                                    <button title=\"2\" class=\"input-colsperline\" data-value=\"2\" style=\"width:40px;height:25px;\">2</button>\n                                    <button title=\"3\" class=\"input-colsperline\" data-value=\"3\" style=\"width:40px;height:25px;\">3</button>\n                                    <button title=\"4\" class=\"input-colsperline\" data-value=\"4\" style=\"width:40px;height:25px;\">4</button>\n                                    <button title=\"5\" class=\"input-colsperline\" data-value=\"5\" style=\"width:40px;height:25px;\">5</button>\n                                    <button title=\"6\" class=\"input-colsperline\" data-value=\"6\" style=\"width:40px;height:25px;\">6</button>\n                                    <button title=\"").concat(util.out('Default'), "\" class=\"input-colsperline\" data-value=\"\" style=\"width:120px;height:25px;\">").concat(util.out('Default'), "</button>\n                                </div>\n                            </div>\n\n                            <div id=\"divReverseColumns\" style=\"diplay:none\">\n                                <label for=\"chkReverseColumns\" style=\"margin:20px 0 0;display:flex\"><input id=\"chkReverseColumns\" type=\"checkbox\"  style=\"margin:0 7px 0 0\"/><span>").concat(util.out('Reverse Columns'), "</span></label>\n                            </div>\n                        </div>\n\n                        <div id=\"divRowMore\" class=\"is-tab-content\" data-group=\"rowsettings\" tabindex=\"-1\">\n\n                            <label for=\"inpRowId\">").concat(util.out('Add Row ID'), ":</label>\n                            <div>\n                                <input id=\"inpRowId\" class=\"input-row-id\" type=\"text\" onkeypress=\"return /[0-9a-zA-Z_]/i.test(event.key)\" style=\"height:38px\">\n                            </div>\n        \n                            <label for=\"inpRowCssClasses\" style=\"padding:20px 0 3px;\">").concat(util.out('Add Css Classes'), ":</label>\n                            <div>\n                                <input id=\"inpRowCssClasses\" class=\"input-row-classes\" type=\"text\" style=\"height:38px\">\n                            </div>\n\n                        </div>\n                    \n                    </div>\n                        \n                </div>\n            </div>\n            \n            ");
        dom.appendHtml(builderStuff, html);
        rowSettings = builderStuff.querySelector('.is-modal.rowsettings');
        this.rowSettings = rowSettings;
        var imageSource = document.querySelector('.is-modal.imagesource');
        var imageAdjust = document.querySelector('.is-modal.imageadjust');
        var imageAdjust2 = document.querySelector('.is-modal.imageadjust2');
        this.imageSource = imageSource;
        this.imageAdjust = imageAdjust;
        this.imageAdjust2 = imageAdjust2;
        this.divRowGeneral = rowSettings.querySelector('#divRowGeneral');
        var divColsPerLine = rowSettings.querySelector('.div-colsperline');
        if (!this.builder.enableColumnsPerLine) divColsPerLine.style.display = 'none';

        // Row Background color
        var btnRowBgColor = rowSettings.querySelector('.input-row-bgcolor');
        btnRowBgColor.addEventListener('click', function (e) {
          _this3.builder.uo.saveForUndo(true); // checkLater = true

          var elm = e.target;
          _this3.builder.colorPicker.open(function (color) {
            var row = _this3.rowOverlay();
            if (!row) return;
            row.style.backgroundColor = color;
            elm.style.backgroundColor = color; // preview

            _this3.builder.opts.onChange();
          }, rowSettings.querySelector('.input-row-bgcolor').style.backgroundColor, function () {
            btnRowBgColor.removeAttribute('data-focus');
            btnRowBgColor.focus();
          });
          btnRowBgColor.setAttribute('data-focus', true);
        });

        // Row Background Image
        var btnRowBgImage = rowSettings.querySelector('.input-cell-bgimage');
        if (btnRowBgImage) dom.addEventListener(btnRowBgImage, 'click', function () {
          var row = _this3.rowOverlay();
          if (!row) return;

          //Get current value
          var imgUrl = '';
          if (row.style.backgroundImage) {
            if (row.style.backgroundImage.indexOf('url(') !== -1) {
              imgUrl = row.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
            }
          }
          _this3.builder.colTool.openImagePicker(imgUrl, function (url) {
            var row = _this3.rowOverlay();
            if (!row) return;
            _this3.builder.uo.saveForUndo();
            row.style.backgroundImage = "url(\"".concat(url, "\")");
            row.style.backgroundSize = 'cover';
            row.style.backgroundRepeat = 'no-repeat';
            var div = rowSettings.querySelector('.cell-bgimage-preview');
            var btnImageAdjust = _this3.rowSettings.querySelector('.input-row-bgimageadjust');
            var btnImageRemove = _this3.rowSettings.querySelector('.input-row-bgremove');
            btnImageAdjust.style.display = 'none';
            btnImageRemove.style.display = 'none';
            if (url !== '') {
              div.innerHTML = "<img src=\"".concat(url, "\">");
              btnImageAdjust.style.display = 'flex';
              btnImageRemove.style.display = 'flex';
            } else {
              div.innerHTML = '';
            }
            _this3.builder.opts.onChange();
          }, btnRowBgImage);
        });

        // Row Background Image Adjust
        var btnImageAdjust = rowSettings.querySelector('.input-row-bgimageadjust');
        if (btnImageAdjust) dom.addEventListener(btnImageAdjust, 'click', function () {
          var row = _this3.rowOverlay();
          if (!row) return;
          _this3.builder.colTool.openImageAdjust(row, btnImageAdjust);
        });
        var elm = rowSettings.querySelector('.input-row-bgremove');
        if (elm) dom.addEventListener(elm, 'click', function () {
          var row = _this3.rowOverlay();
          if (!row) return;
          _this3.builder.uo.saveForUndo();
          row.style.backgroundImage = '';
          row.style.backgroundSize = '';
          row.style.backgroundRepeat = '';
          row.style.backgroundPosition = '';
          var div = rowSettings.querySelector('.cell-bgimage-preview');
          var btnImageAdjust = _this3.rowSettings.querySelector('.input-row-bgimageadjust');
          var btnImageRemove = _this3.rowSettings.querySelector('.input-row-bgremove');
          btnImageAdjust.style.display = 'none';
          btnImageRemove.style.display = 'none';
          div.innerHTML = '';
          _this3.builder.opts.onChange();
        });

        // Row Background Image Open Asset

        if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
          this.divRowGeneral.querySelector('.input-select').style.display = 'none';
        }
        var btnRowBgImageOpenAsset = this.divRowGeneral.querySelector('.input-select');
        this.builder.renderSelectAsset(btnRowBgImageOpenAsset, 'image', function (url) {
          var row = _this3.rowOverlay();
          if (!row) return;
          _this3.builder.uo.saveForUndo();
          row.style.backgroundImage = "url(\"".concat(url, "\")");
          row.style.backgroundSize = 'cover';
          row.style.backgroundRepeat = 'no-repeat';
          var div = rowSettings.querySelector('.cell-bgimage-preview');
          var btnImageAdjust = _this3.rowSettings.querySelector('.input-row-bgimageadjust');
          var btnImageRemove = _this3.rowSettings.querySelector('.input-row-bgremove');
          btnImageAdjust.style.display = 'none';
          btnImageRemove.style.display = 'none';
          if (url !== '') {
            div.innerHTML = "<img src=\"".concat(url, "\">");
            btnImageAdjust.style.display = 'flex';
            btnImageRemove.style.display = 'flex';
          } else {
            div.innerHTML = '';
          }
          _this3.builder.opts.onChange();
        });

        // Background gradient
        var gradientPicker = new contentbuilder_gradientpicker({
          colors: this.builder.colors,
          gradientcolors: this.builder.opts.gradientcolors,
          lang: this.builder.opts.lang
        });
        var btnRowGradient = rowSettings.querySelector('.input-row-gradient');
        btnRowGradient.addEventListener('click', function () {
          _this3.builder.uo.saveForUndo(true); // checkLater = true

          var row = _this3.rowOverlay();
          if (!row) return;
          gradientPicker.open(row, function () {
            var btnImageAdjust = _this3.rowSettings.querySelector('.input-row-bgimageadjust');
            btnImageAdjust.style.display = 'none';
            var btnImageRemove = _this3.rowSettings.querySelector('.input-row-bgremove');
            btnImageRemove.style.display = 'none';
            var div = _this3.rowSettings.querySelector('.cell-bgimage-preview');
            div.innerHTML = '';
            var inpSrc = _this3.imageSource.querySelector('.input-src');
            inpSrc.value = '';

            //Trigger Change event
            _this3.builder.opts.onChange();
          }, function (isChanged) {
            if (isChanged) {

              // Do Nothing
            }
            btnRowGradient.removeAttribute('data-focus');
            btnRowGradient.focus();
          });
          btnRowGradient.setAttribute('data-focus', true);
        });
        var chkRowGrayscale = rowSettings.querySelector('.chk-row-grayscale');
        chkRowGrayscale.addEventListener('click', function () {
          _this3.builder.uo.saveForUndo();
          var row = _this3.rowOverlay();
          if (!row) return;
          if (chkRowGrayscale.checked) {
            row.style.filter = 'grayscale(1)';
          } else {
            if (row.style.filter) {
              row.style.filter = row.style.filter.replace('grayscale(1)', '');
            }
          }
          _this3.builder.opts.onChange();
        });

        // Responsive Visibility

        var btns = rowSettings.querySelectorAll('.input-device');
        btns.forEach(function (btn) {
          btn.addEventListener('click', function () {
            var row = util.rowSelected();
            if (!row) return;
            var elms = rowSettings.querySelectorAll('.input-device');
            elms.forEach(function (elm) {
              elm.classList.remove('on');
            });
            btn.classList.add('on');
            _this3.realtimeVisibility(row);
          });
        });
        var btnVisible = rowSettings.querySelector('.input-visible');
        var btnHidden = rowSettings.querySelector('.input-hidden');
        btnVisible.addEventListener('click', function () {
          var row = util.rowSelected();
          if (!row) return;
          _this3.builder.uo.saveForUndo();
          row.classList.remove('hideonmobile');
          var divTarget = rowSettings.querySelector('.div-target');
          var target = _this3.builder.responsive.readTarget(divTarget);
          if (target === 'xs') {
            row.classList.remove('xs-hidden');
          } else if (target === 'sm') {
            row.classList.remove('sm-hidden');
          } else if (target === 'md') {
            row.classList.remove('md-hidden');
          } else if (target === '') {
            row.classList.remove('desktop-hidden');
          }
          btnVisible.classList.add('on');
          btnHidden.classList.remove('on');
          _this3.builder.opts.onChange();
        });
        btnHidden.addEventListener('click', function () {
          var row = util.rowSelected();
          if (!row) return;
          _this3.builder.uo.saveForUndo();
          row.classList.remove('hideonmobile');
          var divTarget = rowSettings.querySelector('.div-target');
          var target = _this3.builder.responsive.readTarget(divTarget);
          if (target === 'xs') {
            row.classList.add('xs-hidden');
          } else if (target === 'sm') {
            row.classList.add('sm-hidden');
          } else if (target === 'md') {
            row.classList.add('md-hidden');
          } else if (target === '') {
            row.classList.add('desktop-hidden');
          }
          btnVisible.classList.remove('on');
          btnHidden.classList.add('on');
          _this3.builder.opts.onChange();
        });

        // Cols per line
        btns = rowSettings.querySelectorAll('.input-colsperline');
        btns.forEach(function (btn) {
          btn.addEventListener('click', function () {
            var row = util.rowSelected();
            if (!row) return;
            _this3.builder.uo.saveForUndo();
            var elms = rowSettings.querySelectorAll('.input-colsperline');
            elms.forEach(function (elm) {
              elm.classList.remove('on');
            });
            btn.classList.add('on');
            var val = btn.getAttribute('data-value');
            var divTarget = rowSettings.querySelector('.div-target');
            var target = _this3.builder.responsive.readTarget(divTarget);
            if (target === 'xs') {
              row.classList.remove('xs-items-1');
              row.classList.remove('xs-items-2');
              row.classList.remove('xs-items-3');
              row.classList.remove('xs-items-4');
              row.classList.remove('xs-items-5');
              row.classList.remove('xs-items-6');
              if (val !== '') row.classList.add("xs-items-".concat(val));
            } else if (target === 'sm') {
              row.classList.remove('sm-items-1');
              row.classList.remove('sm-items-2');
              row.classList.remove('sm-items-3');
              row.classList.remove('sm-items-4');
              row.classList.remove('sm-items-5');
              row.classList.remove('sm-items-6');
              if (val !== '') row.classList.add("sm-items-".concat(val));
            } else if (target === 'md') {
              row.classList.remove('md-items-1');
              row.classList.remove('md-items-2');
              row.classList.remove('md-items-3');
              row.classList.remove('md-items-4');
              row.classList.remove('md-items-5');
              row.classList.remove('md-items-6');
              if (val !== '') row.classList.add("md-items-".concat(val));
            } else if (target === '') {
              row.classList.remove('desktop-items-1');
              row.classList.remove('desktop-items-2');
              row.classList.remove('desktop-items-3');
              row.classList.remove('desktop-items-4');
              row.classList.remove('desktop-items-5');
              row.classList.remove('desktop-items-6');
              if (val !== '') row.classList.add("desktop-items-".concat(val));
            }
            _this3.builder.settings.onChange();
          });
        });

        // Reverse
        var chkReverseColumns = rowSettings.querySelector('#chkReverseColumns');
        chkReverseColumns.addEventListener('click', function () {
          var row = util.rowSelected();
          if (!row) return;
          _this3.builder.uo.saveForUndo();
          var divTarget = rowSettings.querySelector('.div-target');
          var target = _this3.builder.responsive.readTarget(divTarget);
          if (target === 'xs') {
            if (chkReverseColumns.checked) {
              row.classList.add('xs-column-reverse');
            } else {
              row.classList.remove('xs-column-reverse');
            }
          } else if (target === 'sm') {
            if (chkReverseColumns.checked) {
              row.classList.add('sm-column-reverse');
            } else {
              row.classList.remove('sm-column-reverse');
            }
          } else if (target === 'md') {
            if (chkReverseColumns.checked) {
              row.classList.add('md-column-reverse');
            } else {
              row.classList.remove('md-column-reverse');
            }
          } else if (target === '') {
            if (chkReverseColumns.checked) {
              row.classList.add('desktop-column-reverse');
            } else {
              row.classList.remove('desktop-column-reverse');
            }
          }
          _this3.builder.settings.onChange();
        });

        //More

        var inpRowId = rowSettings.querySelector('.input-row-id');
        inpRowId.addEventListener('change', function () {
          var row = util.rowSelected();
          if (!row) return;
          _this3.builder.uo.saveForUndo();
          if (inpRowId.value !== '') {
            row.setAttribute('id', inpRowId.value);
          } else {
            row.removeAttribute('id');
          }

          //Trigger Change event
          _this3.builder.opts.onChange();
        });
        var inpRowCssClasses = rowSettings.querySelector('.input-row-classes');
        inpRowCssClasses.addEventListener('change', function () {
          var row = util.rowSelected();
          if (!row) return;
          _this3.builder.uo.saveForUndo();
          var arrCurrentClasses = [];
          var currentClasses = row.getAttribute('data-class');
          if (currentClasses) arrCurrentClasses = currentClasses.split(' ');
          var arrNewClasses = [];
          var newClasses = inpRowCssClasses.value;
          arrNewClasses = newClasses.split(' ');
          arrCurrentClasses.forEach(function (item) {
            if (!arrNewClasses.includes(item)) {
              row.classList.remove(item);
            }
          });
          arrNewClasses.forEach(function (item) {
            if (item !== '') row.classList.add(item);
          });

          // save
          row.setAttribute('data-class', newClasses);
          if (row.getAttribute('data-class') === '') row.removeAttribute('data-class');

          //Trigger Change event
          _this3.builder.opts.onChange();
        });
        new tabs({
          element: rowSettings
        });
        new contentbuilder_draggable({
          selector: '.is-modal.rowsettings .is-draggable'
        });
      }
    }
  }, {
    key: "realtimeVisibility",
    value: function realtimeVisibility(row, initialOpen) {
      if (!this.rowSettings) return;
      if (initialOpen) {
        var builderStuff = this.builder.builderStuff;
        var modal = builderStuff.querySelector('.is-modal.content-preview.active');
        if (modal) {
          var elms = this.rowSettings.querySelectorAll('.input-device');
          elms.forEach(function (elm) {
            elm.classList.remove('on');
          });
          if (modal.classList.contains('is-screen-1920')) {
            this.rowSettings.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1440')) {
            this.rowSettings.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1024')) {
            this.rowSettings.querySelector('.input-device[data-value="md"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-768')) {
            this.rowSettings.querySelector('.input-device[data-value="sm"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-375')) {
            this.rowSettings.querySelector('.input-device[data-value="xs"]').classList.add('on');
          }
        }
      }
      var divTarget = this.rowSettings.querySelector('.div-target');
      var divVisibility = this.rowSettings.querySelector('.div-visibility');
      var target = this.builder.responsive.readTarget(divTarget);
      var valVisibility = this.builder.responsive.getVisibility(row, target);
      this.builder.responsive.showVisibility(divVisibility, valVisibility);

      // const divColsPerLine = this.rowSettings.querySelector('.div-colsperline');
      var btns = this.rowSettings.querySelectorAll('.input-colsperline');
      btns.forEach(function (btn) {
        btn.classList.remove('on');
      });

      // Column reverse 
      var valReverse = false;
      if (target === 'xs') {
        valReverse = row.classList.contains('xs-column-reverse');
        this.rowSettings.querySelector('.input-colsperline[data-value=""]').style.display = 'none';
        if (row.classList.contains('xs-items-1')) this.rowSettings.querySelector('.input-colsperline[data-value="1"]').classList.add('on');else if (row.classList.contains('xs-items-2')) this.rowSettings.querySelector('.input-colsperline[data-value="2"]').classList.add('on');else if (row.classList.contains('xs-items-3')) this.rowSettings.querySelector('.input-colsperline[data-value="3"]').classList.add('on');else if (row.classList.contains('xs-items-4')) this.rowSettings.querySelector('.input-colsperline[data-value="4"]').classList.add('on');else if (row.classList.contains('xs-items-5')) this.rowSettings.querySelector('.input-colsperline[data-value="5"]').classList.add('on');else if (row.classList.contains('xs-items-6')) this.rowSettings.querySelector('.input-colsperline[data-value="6"]').classList.add('on');else this.rowSettings.querySelector('.input-colsperline[data-value="1"]').classList.add('on');
        if (!initialOpen) this.builder.livePreview.resizePreview(375);
      } else if (target === 'sm') {
        valReverse = row.classList.contains('sm-column-reverse');
        this.rowSettings.querySelector('.input-colsperline[data-value=""]').style.display = 'flex';
        if (row.classList.contains('sm-items-1')) this.rowSettings.querySelector('.input-colsperline[data-value="1"]').classList.add('on');else if (row.classList.contains('sm-items-2')) this.rowSettings.querySelector('.input-colsperline[data-value="2"]').classList.add('on');else if (row.classList.contains('sm-items-3')) this.rowSettings.querySelector('.input-colsperline[data-value="3"]').classList.add('on');else if (row.classList.contains('sm-items-4')) this.rowSettings.querySelector('.input-colsperline[data-value="4"]').classList.add('on');else if (row.classList.contains('sm-items-5')) this.rowSettings.querySelector('.input-colsperline[data-value="5"]').classList.add('on');else if (row.classList.contains('sm-items-6')) this.rowSettings.querySelector('.input-colsperline[data-value="6"]').classList.add('on');else this.rowSettings.querySelector('.input-colsperline[data-value=""]').classList.add('on');
        if (!initialOpen) this.builder.livePreview.resizePreview(768);
      } else if (target === 'md') {
        valReverse = row.classList.contains('md-column-reverse');
        this.rowSettings.querySelector('.input-colsperline[data-value=""]').style.display = 'flex';
        if (row.classList.contains('md-items-1')) this.rowSettings.querySelector('.input-colsperline[data-value="1"]').classList.add('on');else if (row.classList.contains('md-items-2')) this.rowSettings.querySelector('.input-colsperline[data-value="2"]').classList.add('on');else if (row.classList.contains('md-items-3')) this.rowSettings.querySelector('.input-colsperline[data-value="3"]').classList.add('on');else if (row.classList.contains('md-items-4')) this.rowSettings.querySelector('.input-colsperline[data-value="4"]').classList.add('on');else if (row.classList.contains('md-items-5')) this.rowSettings.querySelector('.input-colsperline[data-value="5"]').classList.add('on');else if (row.classList.contains('md-items-6')) this.rowSettings.querySelector('.input-colsperline[data-value="6"]').classList.add('on');else this.rowSettings.querySelector('.input-colsperline[data-value=""]').classList.add('on');
        if (!initialOpen) this.builder.livePreview.resizePreview(1024);
      } else {
        valReverse = row.classList.contains('desktop-column-reverse');
        this.rowSettings.querySelector('.input-colsperline[data-value=""]').style.display = 'flex';
        if (row.classList.contains('desktop-items-1')) this.rowSettings.querySelector('.input-colsperline[data-value="1"]').classList.add('on');else if (row.classList.contains('desktop-items-2')) this.rowSettings.querySelector('.input-colsperline[data-value="2"]').classList.add('on');else if (row.classList.contains('desktop-items-3')) this.rowSettings.querySelector('.input-colsperline[data-value="3"]').classList.add('on');else if (row.classList.contains('desktop-items-4')) this.rowSettings.querySelector('.input-colsperline[data-value="4"]').classList.add('on');else if (row.classList.contains('desktop-items-5')) this.rowSettings.querySelector('.input-colsperline[data-value="5"]').classList.add('on');else if (row.classList.contains('desktop-items-6')) this.rowSettings.querySelector('.input-colsperline[data-value="6"]').classList.add('on');else this.rowSettings.querySelector('.input-colsperline[data-value=""]').classList.add('on');
        if (!initialOpen) this.builder.livePreview.resizePreview(1920);
      }
      var chkReverseColumns = this.rowSettings.querySelector('#chkReverseColumns');
      chkReverseColumns.checked = valReverse;
    }
  }, {
    key: "moveRowUp",
    value: function moveRowUp() {
      this.grid.moveRowUp();
    }
  }, {
    key: "moveRowDown",
    value: function moveRowDown() {
      this.grid.moveRowDown();
    }
  }, {
    key: "duplicateRow",
    value: function duplicateRow() {
      this.grid.duplicateRow();
    }
  }, {
    key: "removeRow",
    value: function removeRow() {
      this.grid.removeRow();
    }
  }, {
    key: "hideGridEditor",
    value: function hideGridEditor() {
      var builderStuff = this.builder.builderStuff;
      var grideditor = builderStuff.querySelector('.grideditor');
      if (!grideditor) return;
      grideditor.classList.remove('active');
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      builders.forEach(function (builder) {
        builder.removeAttribute('grideditor');
      });
    }
  }, {
    key: "showGridEditor",
    value: function showGridEditor() {
      var _this4 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var grideditor = builderStuff.querySelector('.grideditor');
      if (!grideditor) return;
      var handleGridToolClickOut = function handleGridToolClickOut(e) {
        var elm = e.target;
        if (!elm) return;
        if (!elm.closest('.rte-grideditor') && !elm.closest('.grideditor') && !elm.closest('.is-modal') && !elm.closest('.keep-selection') && !elm.closest('.is-sidebar') && !elm.closest('.is-rte-tool') && !elm.closest('.is-rte-pop') && !elm.closest('.is-elementrte-tool') && !elm.closest('.is-builder') && !elm.closest('.is-pop')) {
          // click outside

          // hide
          _this4.hideGridEditor();

          // clear events
          document.removeEventListener('click', handleGridToolClickOut);
          if (_this4.builder.iframeDocument) {
            _this4.builder.doc.removeEventListener('click', handleGridToolClickOut);
          }
          _this4.builder.handleGridToolClickOut_ = false;
        }
      };
      if (grideditor.classList.contains('active')) {
        // hide
        this.hideGridEditor();

        // clear events
        document.removeEventListener('click', handleGridToolClickOut);
        if (this.builder.iframeDocument) {
          this.builder.doc.removeEventListener('click', handleGridToolClickOut);
        }
        this.builder.handleGridToolClickOut_ = false;
        return;
      }
      util.showModal(grideditor);
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      builders.forEach(function (builder) {
        builder.setAttribute('grideditor', '');
      });
      if (!this.builder.handleGridToolClickOut_) {
        document.addEventListener('click', handleGridToolClickOut);
        if (this.builder.iframeDocument) {
          this.builder.doc.addEventListener('click', handleGridToolClickOut);
        }
        this.builder.handleGridToolClickOut_ = true;
      }
    }
  }, {
    key: "readRowStyles",
    value: function readRowStyles(row) {
      var util = this.builder.util;
      if (!this.rowSettings) return;
      util.clearActiveElement();

      // Background color
      var s = row.style.backgroundColor;
      var btn = this.rowSettings.querySelector('.input-row-bgcolor');
      if (s) btn.style.backgroundColor = s;else btn.style.backgroundColor = 'transparent';
      var imgUrl = '';
      var div = this.rowSettings.querySelector('.cell-bgimage-preview');
      var btnImageAdjust = this.rowSettings.querySelector('.input-row-bgimageadjust');
      btnImageAdjust.style.display = 'none';
      var btnImageRemove = this.rowSettings.querySelector('.input-row-bgremove');
      btnImageRemove.style.display = 'none';
      if (row.style.backgroundImage) {
        if (row.style.backgroundImage.indexOf('url(') !== -1) {
          imgUrl = row.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
          div.innerHTML = "<img src=\"".concat(imgUrl, "\">");
          btnImageAdjust.style.display = 'flex';
          btnImageRemove.style.display = 'flex';
        } else {
          div.innerHTML = '';
        }
      } else {
        div.innerHTML = '';
      }
      var chkRowGrayscale = this.rowSettings.querySelector('.chk-row-grayscale');
      chkRowGrayscale.checked = false;
      if (row.style.filter) {
        if (row.style.filter.indexOf('grayscale') !== -1) {
          chkRowGrayscale.checked = true;
        }
      }
      var actualRow = row.parentNode; // row is actually row overlay

      this.realtimeVisibility(actualRow, true);
      var divReverseBoxes = this.rowSettings.querySelector('#divReverseColumns');
      var num = 3; //is-row-tool, is-col-tool & is-rowadd-tool
      if (actualRow.querySelector('.is-row-overlay')) {
        num = 4; //is-row-tool, is-col-tool, is-rowadd-tool & is-row-overlay
      }

      if (actualRow.childElementCount - num > 1) {
        divReverseBoxes.style.display = 'flex';
      } else {
        divReverseBoxes.style.display = 'none';
      }

      //More
      var inpRowId = this.rowSettings.querySelector('.input-row-id');
      inpRowId.value = '';
      var rowId = actualRow.getAttribute('id');
      if (rowId) {
        inpRowId.value = rowId;
      }
      var inpRowClasses = this.rowSettings.querySelector('.input-row-classes');
      inpRowClasses.value = '';
      var classes = actualRow.getAttribute('data-class');
      inpRowClasses.value = classes;
    }
  }, {
    key: "rowOverlay",
    value: function rowOverlay() {
      var util = this.builder.util;
      var dom = this.builder.dom;
      var row = util.rowSelected();
      if (!row) return false;
      var rowOverlay = row.querySelector('.is-row-overlay');
      if (!rowOverlay) {
        dom.appendHtml(row, '<div class="is-row-overlay"></div>');
        rowOverlay = row.querySelector('.is-row-overlay');
      }
      row.classList.add('relative');
      return rowOverlay;
    }
  }]);
  return RowTool;
}();
/* harmony default export */ const rowtool = (rowtool_RowTool);
;// CONCATENATED MODULE: ./src/contentbuilder/rowaddtool.js
function rowaddtool_typeof(obj) { "@babel/helpers - typeof"; return rowaddtool_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, rowaddtool_typeof(obj); }
function rowaddtool_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function rowaddtool_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, rowaddtool_toPropertyKey(descriptor.key), descriptor); } }
function rowaddtool_createClass(Constructor, protoProps, staticProps) { if (protoProps) rowaddtool_defineProperties(Constructor.prototype, protoProps); if (staticProps) rowaddtool_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function rowaddtool_toPropertyKey(arg) { var key = rowaddtool_toPrimitive(arg, "string"); return rowaddtool_typeof(key) === "symbol" ? key : String(key); }
function rowaddtool_toPrimitive(input, hint) { if (rowaddtool_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (rowaddtool_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var RowAddTool = /*#__PURE__*/function () {
  function RowAddTool(builder) {
    rowaddtool_classCallCheck(this, RowAddTool);
    this.builder = builder;
    var dom = this.builder.dom;
    this.dom = dom;
  }
  rowaddtool_createClass(RowAddTool, [{
    key: "render",
    value: function render(row) {
      var _this = this;
      var dom = this.dom;
      var util = this.builder.util;
      var builderStuff = this.builder.builderStuff;
      var rowaddtool = row.querySelector('.is-rowadd-tool');
      if (!rowaddtool) {
        var html = "<div class=\"is-rowadd-tool\" style=\"height:0\">\n                <button type=\"button\" tabindex=\"-1\" title=\"".concat(util.out('Add'), "\" title=\"").concat(util.out('Add'), "\" style=\"outline:none;line-height:1;margin:0;padding:0;cursor:pointer;background-color:rgba(255,255,255,0.9);\"><svg class=\"is-icon-flex\" style=\"fill:rgba(0, 0, 0, 0.8);width:17px;height:17px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n            </div>");
        dom.appendHtml(row, html);
        rowaddtool = row.querySelector('.is-rowadd-tool');

        // Prepare for tooltip
        var elms = rowaddtool.querySelectorAll('[title]');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.setAttribute('data-title', elm.getAttribute('title'));
          if (!_this.builder.iframe) {
            _this.builder.tooltip.set(elm, 5, 3);
          } else {
            _this.builder.tooltip.set(elm, 5, 3, true);
          }
        });
      }
      var btnRowAdd = rowaddtool.querySelector('button');
      dom.addEventListener(btnRowAdd, 'click', function () {
        var quickadd = contentbuilder_quickadd(_this.builder);
        var tabs = quickadd.querySelector('.is-pop-tabs');
        tabs.style.display = 'none';
        var viewportHeight = window.innerHeight;

        /*
        let top, left;
        if(!this.builder.iframe) {
            top = btnRowAdd.getBoundingClientRect().top;
            left = btnRowAdd.getBoundingClientRect().left;
        } else {
            let adjY = this.builder.iframe.getBoundingClientRect().top;
            let adjX = this.builder.iframe.getBoundingClientRect().left;
             top = btnRowAdd.getBoundingClientRect().top + adjY;
            left = btnRowAdd.getBoundingClientRect().left + adjX;
        }
        */
        var newPos = util.getElementPosition(btnRowAdd);
        var top = newPos.top;
        var left = newPos.left;

        // quickadd.style.display = 'flex';
        util.showPop(quickadd, false, btnRowAdd);
        var w = quickadd.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
        var h = quickadd.offsetHeight;
        if (viewportHeight - top > h) {
          quickadd.style.top = top + window.pageYOffset + 27 + 'px';
          quickadd.style.left = left - w / 2 + 7 + 'px';
          dom.removeClass(quickadd, 'arrow-bottom');
          dom.removeClass(quickadd, 'arrow-right');
          dom.removeClass(quickadd, 'arrow-left');
          dom.removeClass(quickadd, 'center');
          dom.addClass(quickadd, 'arrow-top');
          dom.addClass(quickadd, 'center');
        } else {
          quickadd.style.top = top + window.pageYOffset - h - 8 + 'px';
          quickadd.style.left = left - w / 2 + 7 + 'px';
          dom.removeClass(quickadd, 'arrow-top');
          dom.removeClass(quickadd, 'arrow-right');
          dom.removeClass(quickadd, 'arrow-left');
          dom.removeClass(quickadd, 'center');
          dom.addClass(quickadd, 'arrow-bottom');
          dom.addClass(quickadd, 'center');
        }
        quickadd.setAttribute('data-mode', 'row');

        //handleQuickAddClickOut
        var handleQuickAddClickOut = function handleQuickAddClickOut(e) {
          // console.log('handleQuickAddClickOut');
          var elm = e.target;
          if (!elm) return;
          if (!elm.closest('.quickadd') && !elm.closest('.row-add') && !elm.closest('.is-rowadd-tool') && !elm.closest('.cell-add') && !elm.closest('.elm-add') && !elm.closest('.row-add-initial')) {
            // click outside

            // hide
            var _quickadd = builderStuff.querySelector('.quickadd');
            util.hidePop(_quickadd);
            // console.log('HIDE');

            // clear events
            document.removeEventListener('click', handleQuickAddClickOut);
            if (_this.builder.iframeDocument) {
              _this.builder.doc.removeEventListener('click', handleQuickAddClickOut);
            }
            _this.builder.handleQuickAddClickOut_ = false;
          }
        };
        if (!_this.builder.handleQuickAddClickOut_) {
          document.addEventListener('click', handleQuickAddClickOut);
          if (_this.builder.iframeDocument) {
            _this.builder.doc.addEventListener('click', handleQuickAddClickOut);
          }
          _this.builder.handleQuickAddClickOut_ = true;
        }
      });
    }
  }]);
  return RowAddTool;
}();
/* harmony default export */ const contentbuilder_rowaddtool = (RowAddTool);
;// CONCATENATED MODULE: ./src/contentbuilder/columntool.js
function columntool_typeof(obj) { "@babel/helpers - typeof"; return columntool_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, columntool_typeof(obj); }
function columntool_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function columntool_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, columntool_toPropertyKey(descriptor.key), descriptor); } }
function columntool_createClass(Constructor, protoProps, staticProps) { if (protoProps) columntool_defineProperties(Constructor.prototype, protoProps); if (staticProps) columntool_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function columntool_toPropertyKey(arg) { var key = columntool_toPrimitive(arg, "string"); return columntool_typeof(key) === "symbol" ? key : String(key); }
function columntool_toPrimitive(input, hint) { if (columntool_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (columntool_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }





var ColumnTool = /*#__PURE__*/function () {
  function ColumnTool(builder) {
    var _this = this;
    columntool_classCallCheck(this, ColumnTool);
    this.builder = builder;
    this.grid = new contentbuilder_grid(builder);
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
    var modals = builderStuff.querySelector('.is-pop.imageadjust');
    if (!modals) {
      var html = "\n            <div class=\"is-modal imageadjust\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"max-width:420px;\">\n                    <div class=\"is-modal-bar is-draggable\">\n                        ".concat(util.out('Background Image Adjustments'), "\n                        <button class=\"is-modal-close\" title=\"").concat(util.out('Close'), "\" tabindex=\"-1\">&#10005;</button>\n                    </div>\n\n                    <div style=\"padding:0;margin-top:25px;\">\n\n                        <div class=\"div-target\" style=\"display: flex;justify-content: flex-end;padding: 5px 0 0;\">\n                            <button title=\"").concat(util.out('Desktop'), "\" class=\"input-device on\" data-value=\"\" style=\"width:40px;height:25px;\">\n                                <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-device-desktop\"></use></svg>\n                            </button>\n                            <button title=\"").concat(util.out('Laptop/Tablet (Landscape)'), "\" class=\"input-device\" data-value=\"md\" style=\"width:40px;height:25px;\">\n                                <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;transform:rotate(-90deg)\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                            </button>\n                            <button title=\"").concat(util.out('Tablet (Portrait)'), "\" class=\"input-device\" data-value=\"sm\" style=\"width:40px;height:25px;\">\n                                <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                            </button>\n                            <button title=\"").concat(util.out('Mobile'), "\" class=\"input-device\" data-value=\"xs\" style=\"width:40px;height:25px;\">\n                                <svg class=\"is-icon-flex\" style=\"width:13px;height:13px\"><use xlink:href=\"#icon-device-mobile\"></use></svg>\n                            </button>\n                        </div>\n\n                        <div style=\"padding-bottom:3px;\">").concat(util.out('Scale'), ":</div>\n                        <div style=\"padding-top:4px\">\n                            <input type=\"range\" min=\"100\" max=\"500\" value=\"0\" class=\"image-scale-slider is-rangeslider\">\n                        </div>\n\n                        <div style=\"padding-bottom:3px;padding-top: 20px;\">").concat(util.out('Horizontal'), ":</div>\n                        <div style=\"padding-top:4px\">\n                            <input type=\"range\" min=\"0\" max=\"100\" value=\"0\" class=\"image-hor-slider is-rangeslider\">\n                        </div>\n\n                        <div style=\"padding-bottom:3px;padding-top: 20px;\">").concat(util.out('Vertical'), ":</div>\n                        <div style=\"padding-top:4px\">\n                            <input type=\"range\" min=\"0\" max=\"100\" value=\"0\" class=\"image-vert-slider is-rangeslider\">\n                        </div>\n\n                        <div style=\"padding-bottom:3px;padding-top: 10px;display:flex;justify-content:right;align-items:center;\">\n                            <button title=\"").concat(util.out('Reset'), "\" class=\"image-reset\" style=\"display:flex;width:30px;height:30px;\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                        </div>\n\n                    </div>\n\n                </div>\n            </div> \n\n            <div class=\"is-modal imageadjust2\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"max-width:420px;\">\n                    <div class=\"is-modal-bar is-draggable\">\n                        ").concat(util.out('Background Image Adjustments'), "\n                        <button class=\"is-modal-close\" title=\"").concat(util.out('Close'), "\" tabindex=\"-1\">&#10005;</button>\n                    </div>\n\n                    <div style=\"padding:0;margin-top:25px;\">\n\n                        <div style=\"padding-bottom:3px;display:flex;\">\n                            <span>").concat(util.out('Scale'), ":</span>\n                        </div>\n                        <div style=\"padding-top:4px\">\n                            <input type=\"range\" min=\"100\" max=\"500\" value=\"0\" class=\"image-scale-slider is-rangeslider\">\n                        </div>\n\n                        <div style=\"padding-bottom:3px;padding-top: 20px;display:flex;\">\n                            <span>").concat(util.out('Horizontal'), ":</span>\n                        </div>\n                        <div style=\"padding-top:4px\">\n                            <input type=\"range\" min=\"-150\" max=\"150\" value=\"0\" class=\"image-hor-slider is-rangeslider\">\n                        </div>\n\n                        <div style=\"padding-bottom:3px;padding-top: 20px;display:flex;\">\n                            <span>").concat(util.out('Vertical'), ":</span>\n                        </div>\n                        <div style=\"padding-top:4px\">\n                            <input type=\"range\" min=\"-150\" max=\"150\" value=\"0\" class=\"image-vert-slider is-rangeslider\">\n                        </div>\n\n                        <div style=\"padding-bottom:3px;padding-top: 10px;display:flex;justify-content:right;align-items:center;\">\n                            <button title=\"").concat(util.out('Reset'), "\" class=\"image-reset\" style=\"display:flex;width:30px;height:30px;\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                        </div>\n                    </div>\n\n                </div>\n            </div> \n\n            <div class=\"is-modal imagesource\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"max-width:550px;\">\n\n                    <label for=\"inpCellImageBgSource\" style=\"display:block\">").concat(util.out('Source'), ":</label>\n                    <div class=\"image-src\">\n                        <input id=\"inpCellImageBgSource\" class=\"input-src\" type=\"text\">\n                        <button title=\"").concat(util.out('Select'), "\" class=\"input-select\" style=\"flex:none;\">\n                            ").concat(this.builder.opts.selectIcon, "\n                        </button>\n                        <div class=\"image-larger3 input-upload\" style=\"position: relative; flex: 0 0 auto;box-shadow: rgba(0, 0, 0, 0.32) 0px 3px 6px -6px;\">\n                            <form class=\"form-upload-larger\" target=\"frameTargetCellImageUpload\" method=\"post\" action=\"").concat(this.builder.opts.largerImageHandler, "\" enctype=\"multipart/form-data\" style=\"position:absolute;display:flex;justify-content: center;align-items: center;top:0;left:0;width:100%;height:100%;\">\n                                <input id=\"hidRefId3\" name=\"hidRefId\" type=\"hidden\" value=\"\">\n                                <svg class=\"is-icon-flex\" style=\"width:18px;height:18px;\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                                <input onclick=\"blur()\" title=\"").concat(util.out('Select'), "\" id=\"fileImage3\" name=\"fileImage\" type=\"file\" accept=\"image/*\" style=\"position:absolute;top:-30px;left:0;width:100%;height:80px;opacity: 0;cursor: pointer;\">\n                            </form>\n\n                            <iframe tabindex=\"-1\" tabIndex=\"0\" id=\"frameTargetCellImageUpload\" name=\"frameTargetCellImageUpload\" src=\"about:blank\" style=\"width:1px;height:1px;position:absolute;top:0;right:-100000px\"></iframe>\n                        </div>\n                    </div>\n\n                    <div style=\"text-align:right;margin-top:20px;\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n\n                </div>\n            </div>\n\n            <div class=\"is-locked-indicator\">\n                <svg class=\"is-icon-flex\"><use xlink:href=\"#icon-lock\"></use></svg>\n            </div>\n            ");
      dom.appendHtml(builderStuff, html);
      if (!this.builder.iframe) {
        this.lockIndicator = builderStuff.querySelector('.is-locked-indicator');
      } else {
        this.lockIndicator = this.builder.contentStuff.querySelector('.is-locked-indicator');
      }
      var imageSource = document.querySelector('.is-modal.imagesource');
      var imageAdjust = document.querySelector('.is-modal.imageadjust');
      var imageAdjust2 = document.querySelector('.is-modal.imageadjust2');
      this.imageSource = imageSource;
      this.imageAdjust = imageAdjust;
      this.imageAdjust2 = imageAdjust2;

      // Column Background Image Select Dialog (.is-modal.imagesource) 

      if (this.builder.opts.largerImageHandler === '' && !this.builder.opts.onLargerImageUpload) {
        imageSource.querySelector('.image-larger3').style.display = 'none';
      }
      if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
        imageSource.querySelector('.input-select').style.display = 'none';
      }

      // Select image (opens Asset Manager plugin or custom dialog)
      var divImageSrc = imageSource.querySelector('.image-src');
      if (this.builder.opts.onImageSelectClick || this.builder.opts.imageselect) {
        var elm = imageSource.querySelector('.input-select');
        if (elm) dom.addEventListener(elm, 'click', function () {
          if (_this.builder.opts.onImageSelectClick) {
            _this.builder.opts.onImageSelectClick({
              targetInput: imageSource.querySelector('.input-src'),
              theTrigger: elm
            });
          } else {
            var modalImageSelect = builderStuff.querySelector('.is-modal.imageselect');
            var iframe = modalImageSelect.querySelector('iframe');
            if (_this.builder.opts.assetRefresh) {
              iframe.src = _this.builder.opts.imageselect;
              _this.builder.opts.assetRefresh = false;
            }
            if (iframe.src === 'about:blank') {
              iframe.src = _this.builder.opts.imageselect;
            }
            util.showModal(modalImageSelect, false, function () {
              elm.removeAttribute('data-focus');
              elm.focus();
            }, false, _this.builder.assetPanelFullScreen);
            elm.setAttribute('data-focus', true);
          }
          _this.builder.targetInput = imageSource.querySelector('.input-src'); // used by selectAsset() (see contentbuilder.js)
          _this.builder.targetCallback = null;
          _this.builder.targetAssetType = 'image';
        });
      } else {
        dom.removeClass(divImageSrc, 'image-select');
      }
      var fileLargerImage = imageSource.querySelector('#fileImage3');
      dom.addEventListener(fileLargerImage, 'change', function (e) {
        var element = fileLargerImage;
        while (element.nodeName.toLowerCase() !== 'form') {
          element = element.parentNode;
        }
        var frmUpload = element;
        dom.addClass(frmUpload, 'please-wait');
        imageSource.querySelector('#hidRefId3').value = _this.builder.opts.customval;
        if (_this.builder.opts.onLargerImageUpload) {
          _this.builder.opts.onLargerImageUpload(e);
        } else {
          frmUpload.submit();
        }
        fileLargerImage.value = ''; // Clear Input
      });

      var btnImageOk = imageSource.querySelector('.input-ok');
      dom.addEventListener(btnImageOk, 'click', function () {
        var inpSrc = _this.imageSource.querySelector('.input-src');
        var url = inpSrc.value;
        if (_this.builder.imageSelectedCallback) _this.builder.imageSelectedCallback(url);
        _this.builder.hideModal(imageSource);
      });
      var btnImageCancel = imageSource.querySelector('.input-cancel');
      dom.addEventListener(btnImageCancel, 'click', function () {
        _this.builder.hideModal(imageSource);
      });

      // Scale
      var inpImageScaleSlider = imageAdjust.querySelector('.image-scale-slider');
      inpImageScaleSlider.onfocus = function () {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // inpImageScaleSlider.blur();
        // imageAdjust.focus();
      };

      inpImageScaleSlider.oninput = function () {
        //val: 100 - 500
        var val = inpImageScaleSlider.value;
        var cell = _this.builder.elementSelected; //util.cellSelected();
        // cell.style.backgroundSize = val + '%';
        if (document.querySelector('.content-preview.is-screen-375.active') && _this.useTarget) {
          var dataBg = cell.getAttribute('data-bg-xs');
          if (!dataBg) dataBg = '';
          var div = document.createElement('div');
          div.style.cssText = dataBg;
          // div.style.backgroundSize = val + '%';
          div.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-xs', div.style.cssText);
        } else if (document.querySelector('.content-preview.is-screen-768.active') && _this.useTarget) {
          var _dataBg = cell.getAttribute('data-bg-sm');
          if (!_dataBg) _dataBg = '';
          var _div = document.createElement('div');
          _div.style.cssText = _dataBg;
          // div.style.backgroundSize = val + '%';
          _div.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-sm', _div.style.cssText);
        } else if (document.querySelector('.content-preview.is-screen-1024.active') && _this.useTarget) {
          var _dataBg2 = cell.getAttribute('data-bg-md');
          if (!_dataBg2) _dataBg2 = '';
          var _div2 = document.createElement('div');
          _div2.style.cssText = _dataBg2;
          // div.style.backgroundSize = val + '%';
          _div2.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-md', _div2.style.cssText);
        } else {
          cell.style.backgroundSize = val + '%';
        }

        // Clean unused
        cell.style.left = '';
        cell.style.top = '';
        cell.style.width = '';
        cell.style.height = '';
        cell.removeAttribute('data-x');
        cell.removeAttribute('data-y');
        cell.removeAttribute('data-scale');
      };
      inpImageScaleSlider.onchange = function () {
        if (document.querySelector('.content-preview.is-screen-375.active')) {
          inpImageScaleSlider.value = 0;
        } else if (document.querySelector('.content-preview.is-screen-768.active')) {
          inpImageScaleSlider.value = 0;
        } else if (document.querySelector('.content-preview.is-screen-1024.active')) {
          inpImageScaleSlider.value = 0;
        }
        _this.builder.opts.onChange();
      };

      // Scale 2
      var inpImageScaleSlider2 = imageAdjust2.querySelector('.image-scale-slider');
      inpImageScaleSlider2.onfocus = function () {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // inpImageScaleSlider2.blur();
        // imageAdjust2.focus();
      };

      inpImageScaleSlider2.oninput = function () {
        var cell = _this.builder.elementSelected;
        //val: 100 - 500
        var val = inpImageScaleSlider2.value;
        if (_this.scaleWidth) {
          cell.style.width = val + '%';
          // cell.style.height = ''; 
          cell.style.height = val * 100 / inpImageScaleSlider2.min + '%';
        } else {
          cell.style.height = val + '%';
          // cell.style.width = '';
          cell.style.width = val * 100 / inpImageScaleSlider2.min + '%';
        }
        cell.setAttribute('data-scale', val);
      };
      inpImageScaleSlider2.onchange = function () {
        _this.builder.opts.onChange();
      };

      // Horizontal
      var inpImageHorSlider = imageAdjust.querySelector('.image-hor-slider');
      inpImageHorSlider.onfocus = function () {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // inpImageHorSlider.blur();
        // imageAdjust.focus();
      };

      inpImageHorSlider.oninput = function () {
        //val: 0 - 100
        var val = inpImageHorSlider.value;
        var cell = _this.builder.elementSelected; //util.cellSelected();
        // cell.style.backgroundPositionX = val + '%';
        if (document.querySelector('.content-preview.is-screen-375.active') && _this.useTarget) {
          var dataBg = cell.getAttribute('data-bg-xs');
          if (!dataBg) dataBg = '';
          var div = document.createElement('div');
          div.style.cssText = dataBg;
          div.style.backgroundPositionX = val + '%';
          div.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-xs', div.style.cssText);
        } else if (document.querySelector('.content-preview.is-screen-768.active') && _this.useTarget) {
          var _dataBg3 = cell.getAttribute('data-bg-sm');
          if (!_dataBg3) _dataBg3 = '';
          var _div3 = document.createElement('div');
          _div3.style.cssText = _dataBg3;
          _div3.style.backgroundPositionX = val + '%';
          _div3.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-sm', _div3.style.cssText);
        } else if (document.querySelector('.content-preview.is-screen-1024.active') && _this.useTarget) {
          var _dataBg4 = cell.getAttribute('data-bg-md');
          if (!_dataBg4) _dataBg4 = '';
          var _div4 = document.createElement('div');
          _div4.style.cssText = _dataBg4;
          _div4.style.backgroundPositionX = val + '%';
          _div4.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-md', _div4.style.cssText);
        } else {
          cell.style.backgroundPositionX = val + '%';
        }

        // Clean unused
        cell.style.left = '';
        cell.style.top = '';
        cell.style.width = '';
        cell.style.height = '';
        cell.removeAttribute('data-x');
        cell.removeAttribute('data-y');
        cell.removeAttribute('data-scale');
      };
      inpImageHorSlider.onchange = function () {
        if (_this.builder.win.adjustBgPos) _this.builder.win.adjustBgPos(); // adjustBgPos() from box/flex.js

        _this.builder.opts.onChange();
      };

      // Horizontal 2
      var inpImageHorSlider2 = imageAdjust2.querySelector('.image-hor-slider');
      inpImageHorSlider2.onfocus = function () {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // inpImageHorSlider2.blur();
        // imageAdjust2.focus();
      };

      inpImageHorSlider2.oninput = function () {
        var cell = _this.builder.elementSelected;

        //val: -100 - 100
        var val = parseFloat(inpImageHorSlider2.value);
        cell.style.left = "".concat(val, "%");
        cell.style.right = '';
        cell.setAttribute('data-x', val);
      };
      inpImageHorSlider2.onchange = function () {
        _this.builder.opts.onChange();
      };

      // Vertical
      var inpImageVertSlider = imageAdjust.querySelector('.image-vert-slider');
      inpImageVertSlider.onfocus = function () {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // inpImageVertSlider.blur();
        // imageAdjust.focus();
      };

      inpImageVertSlider.oninput = function () {
        //val: 0 - 100
        var val = inpImageVertSlider.value;
        var cell = _this.builder.elementSelected; //util.cellSelected();
        // cell.style.backgroundPositionY = val + '%';
        if (document.querySelector('.content-preview.is-screen-375.active') && _this.useTarget) {
          var dataBg = cell.getAttribute('data-bg-xs');
          if (!dataBg) dataBg = '';
          var div = document.createElement('div');
          div.style.cssText = dataBg;
          div.style.backgroundPositionY = val + '%';
          div.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-xs', div.style.cssText);
        } else if (document.querySelector('.content-preview.is-screen-768.active') && _this.useTarget) {
          var _dataBg5 = cell.getAttribute('data-bg-sm');
          if (!_dataBg5) _dataBg5 = '';
          var _div5 = document.createElement('div');
          _div5.style.cssText = _dataBg5;
          _div5.style.backgroundPositionY = val + '%';
          _div5.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-sm', _div5.style.cssText);
        } else if (document.querySelector('.content-preview.is-screen-1024.active') && _this.useTarget) {
          var _dataBg6 = cell.getAttribute('data-bg-md');
          if (!_dataBg6) _dataBg6 = '';
          var _div6 = document.createElement('div');
          _div6.style.cssText = _dataBg6;
          _div6.style.backgroundPositionY = val + '%';
          _div6.style.backgroundSize = 'cover';
          cell.setAttribute('data-bg-md', _div6.style.cssText);
        } else {
          cell.style.backgroundPositionY = val + '%';
        }

        // Clean unused
        cell.style.left = '';
        cell.style.top = '';
        cell.style.width = '';
        cell.style.height = '';
        cell.removeAttribute('data-x');
        cell.removeAttribute('data-y');
        cell.removeAttribute('data-scale');
      };
      inpImageVertSlider.onchange = function () {
        if (_this.builder.win.adjustBgPos) _this.builder.win.adjustBgPos(); // adjustBgPos() from box/flex.js

        _this.builder.opts.onChange();
      };

      // Vertical 2
      var inpImageVertSlider2 = imageAdjust2.querySelector('.image-vert-slider');
      inpImageVertSlider2.onfocus = function () {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        // inpImageVertSlider2.blur();
        // imageAdjust2.focus();
      };

      inpImageVertSlider2.oninput = function () {
        var cell = _this.builder.elementSelected;

        //val: -100 - 100
        var val = parseFloat(inpImageVertSlider2.value);
        cell.style.top = "".concat(val, "%");
        cell.style.bottom = '';
        cell.setAttribute('data-y', val);
      };
      inpImageVertSlider2.onchange = function () {
        _this.builder.opts.onChange();
      };

      //Reset

      var btnImageReset = imageAdjust.querySelector('.image-reset');
      btnImageReset.addEventListener('click', function () {
        _this.builder.uo.saveForUndo();
        var cell = _this.builder.elementSelected;
        _this.resetImage(cell);
        _this.builder.opts.onChange();
      });
      var btnImageReset2 = imageAdjust2.querySelector('.image-reset');
      btnImageReset2.addEventListener('click', function () {
        _this.builder.uo.saveForUndo();
        var cell = _this.builder.elementSelected;
        _this.resetImage2(cell);
        _this.builder.opts.onChange();
      });

      // Responsive Image Adjust

      var btns = this.imageAdjust.querySelectorAll('.input-device');
      btns.forEach(function (btn) {
        btn.addEventListener('click', function () {
          var elms = _this.imageAdjust.querySelectorAll('.input-device');
          elms.forEach(function (elm) {
            elm.classList.remove('on');
          });
          btn.classList.add('on');
          var modal = builderStuff.querySelector('.is-modal.content-preview');
          if (!modal.classList.contains('active')) {
            _this.builder.openPreview();
          }
          _this.realtimeImageAdjust();
          _this.readImageAdjust(_this.builder.elementSelected, _this.useTarget);
        });
      });
    }
  }
  columntool_createClass(ColumnTool, [{
    key: "renderColMore",
    value: function renderColMore() {
      var _this2 = this;
      var builder = this.builder;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      this.grid = new contentbuilder_grid(builder);
      var columnMore = builderStuff.querySelector('.is-pop.columnmore');
      var resizebutton = "\n            <button type=\"button\" title=\"".concat(util.out('Increase'), "\" class=\"cell-increase\"><span><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-increase\"></use></svg></span>").concat(util.out('Increase'), "</button>\n            <button type=\"button\" title=\"").concat(util.out('Decrease'), "\" class=\"cell-decrease\"><span><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-decrease\"></use></svg></span>").concat(util.out('Decrease'), "</button>      \n        ");
      var htmlbutton = '';
      if (builder.opts.columnHtmlEditor) htmlbutton = "<button type=\"button\" title=\"".concat(util.out('HTML'), "\" class=\"cell-html\">\n                <span><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:12px;height:12px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></span>").concat(util.out('HTML'), "\n            </button>");
      if (!columnMore) {
        // Refer to .is-col-tool in in rowtool.js
        var html = "\n            <div class=\"is-pop columnmore\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div style=\"display:flex;flex-flow:wrap;\">\n                    <button type=\"button\" title=\"".concat(util.out('Move Left'), "\" class=\"cell-prev\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-left\"></use></svg></span>").concat(util.out('Move Left'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Move Right'), "\" class=\"cell-next\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-right\"></use></svg></span>").concat(util.out('Move Right'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Move Up'), "\" class=\"cell-up\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></span>").concat(util.out('Move Up'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Move Down'), "\" class=\"cell-down\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></span>").concat(util.out('Move Down'), "</button>\n                    ").concat(resizebutton, "\n                    <button type=\"button\" title=\"").concat(util.out('Duplicate'), "\" class=\"cell-duplicate\"><span><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></span>").concat(util.out('Duplicate'), "</button>\n                    ").concat(htmlbutton, "\n                    <div class=\"is-separator\"></div>\n                    <button type=\"button\" title=\"").concat(util.out('Lock'), "\" class=\"cell-locking\"><span><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#icon-lock\"></use></svg></span>").concat(util.out('Lock'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Settings'), "\" class=\"cell-settings\"><span><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-gear\"></use></svg></span>").concat(util.out('Settings'), "</button>\n                    \n                    <!--\n                    <button title=\"").concat(util.out('Lock'), "\" class=\"cell-locking\">\n                        <svg class=\"is-icon-flex\"><use xlink:href=\"#icon-lock\"></use></svg>\n                    </button>\n                    <button title=\"").concat(util.out('Settings'), "\" class=\"cell-settings\">\n                        <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg>\n                        <span>").concat(util.out('Settings'), "</span>\n                    </button>\n                    -->\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        columnMore = builderStuff.querySelector('.columnmore');
        this.columnMore = columnMore;
        var elm;

        // Move Previous
        elm = columnMore.querySelector('.cell-prev');
        dom.addEventListener(elm, 'click', function () {
          _this2.grid.moveColumnPrevious();

          // util.clearControls();
        });

        // Move Next
        elm = columnMore.querySelector('.cell-next');
        dom.addEventListener(elm, 'click', function () {
          _this2.grid.moveColumnNext();

          // util.clearControls();
        });

        // Move Up
        elm = columnMore.querySelector('.cell-up');
        dom.addEventListener(elm, 'click', function () {
          _this2.grid.moveColumnUp();
          util.clearControls();
        });

        // Move Down
        elm = columnMore.querySelector('.cell-down');
        dom.addEventListener(elm, 'click', function () {
          _this2.grid.moveColumnDown();
          util.clearControls();
        });

        // Increase
        elm = columnMore.querySelector('.cell-increase');
        dom.addEventListener(elm, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          var row = cell.parentNode;
          if (!_this2.builder.useDefaultGrid) {
            // Check if reset needed (reset will remove inline width, etc)
            var needed = false;
            Array.from(row.children).map(function (item) {
              if (item.classList.contains('is-row-tool')) return;
              if (item.classList.contains('is-rowadd-tool')) return;
              if (item.classList.contains('is-col-tool')) return;
              if (item.style.width) needed = true;
            });
            if (needed) {
              Array.from(row.children).map(function (item) {
                if (item.classList.contains('is-row-tool')) return;
                if (item.classList.contains('is-rowadd-tool')) return;
                if (item.classList.contains('is-col-tool')) return;
                item.style.width = '';
                item.style.flex = '';
                item.style.height = '';
                item.style.minHeight = '';
              });
              util.fixLayout(row);
            }

            // fixLayout(row);
          }

          _this2.grid.increaseColumn();

          // Refresh Module
          Array.from(cell.parentNode.children).map(function (item) {
            if (item.classList.contains('is-row-tool')) return;
            if (item.classList.contains('is-rowadd-tool')) return;
            if (item.classList.contains('is-col-tool')) return;
            if (item.getAttribute('data-module')) {
              util.refreshModuleLayout(item);
            }
          });
        });

        // Decrease
        elm = columnMore.querySelector('.cell-decrease');
        dom.addEventListener(elm, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          var row = cell.parentNode;
          if (!_this2.builder.useDefaultGrid) {
            // Check if reset needed (reset will remove inline width, etc)

            var needed = false;
            Array.from(row.children).map(function (item) {
              if (item.classList.contains('is-row-tool')) return;
              if (item.classList.contains('is-rowadd-tool')) return;
              if (item.classList.contains('is-col-tool')) return;
              if (item.style.width) needed = true;
            });
            if (needed) {
              Array.from(row.children).map(function (item) {
                if (item.classList.contains('is-row-tool')) return;
                if (item.classList.contains('is-rowadd-tool')) return;
                if (item.classList.contains('is-col-tool')) return;
                item.style.width = '';
                item.style.flex = '';
                item.style.height = '';
                item.style.minHeight = '';
              });
              util.fixLayout(row);
            }

            // fixLayout(row);
          }

          _this2.grid.decreaseColumn();

          // Refresh Module
          Array.from(cell.parentNode.children).map(function (item) {
            if (item.classList.contains('is-row-tool')) return;
            if (item.classList.contains('is-rowadd-tool')) return;
            if (item.classList.contains('is-col-tool')) return;
            if (item.getAttribute('data-module')) {
              util.refreshModuleLayout(item);
            }
          });
        });

        // Duplicate
        elm = columnMore.querySelector('.cell-duplicate');
        dom.addEventListener(elm, 'click', function () {
          _this2.grid.duplicateColumn();
          util.hidePop(_this2.columnMore);
          util.clearControls();
        });

        // View HTML
        elm = columnMore.querySelector('.cell-html');
        if (elm) dom.addEventListener(elm, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          var htmlutil = new contentbuilder_html(_this2.builder);
          htmlutil.view('cell');
        });

        // Lock/Unlock Column
        var btnCellLocking = columnMore.querySelector('.cell-locking');
        if (btnCellLocking) dom.addEventListener(btnCellLocking, 'click', function (e) {
          var cell = util.cellSelected();
          if (!cell) return;
          if (!cell.hasAttribute('data-noedit')) {
            cell.setAttribute('data-noedit', '');
            cell.contentEditable = false;
            dom.addClass(btnCellLocking, 'on');
            _this2.util.clearActiveElement(true);
          } else {
            cell.removeAttribute('data-noedit');
            cell.contentEditable = true;
            dom.removeClass(btnCellLocking, 'on');
          }
          _this2.showHideLockIndicator(cell);
          _this2.builder.element.applyBehavior(cell);

          // this.columnMore.style.display = '';
          util.hidePop(_this2.columnMore);
          e.preventDefault();
        });

        // Open Column Settings
        elm = columnMore.querySelector('.cell-settings');
        if (elm) dom.addEventListener(elm, 'click', function () {
          if (_this2.builder.controlPanel) {
            _this2.builder.controlpanel.select('column', true);
            util.hidePop(_this2.columnMore);
            return;
          }
          _this2.renderPanel();
          var cellSettings = _this2.cellSettings;
          var cell = util.cellSelected();
          if (!cell) return;
          _this2.readCellStyles(cell);

          //save selection
          util.saveSelection();
          util.showModal(cellSettings, false, function () {
            var rtetool = builderStuff.querySelector('.is-rte-tool');
            if (rtetool.style.display === 'flex') {
              // means text selection

              util.restoreSelection();

              // if(this.builder.activeElement) {
              //     dom.addClass(this.builder.activeElement, 'elm-active');
              //     this.builder.elmTool.repositionElementTool();
              // }
            }
          });

          util.hidePop(_this2.columnMore);
        });
      }
    }
  }, {
    key: "renderPanel",
    value: function renderPanel() {
      var _this3 = this;
      var builderStuff = this.builder.builderStuff;
      var util = this.builder.util;
      var dom = this.builder.dom;
      var imageSource = builderStuff.querySelector('.is-modal.imagesource');
      var imageAdjust = builderStuff.querySelector('.is-modal.imageadjust');
      var imageAdjust2 = builderStuff.querySelector('.is-modal.imageadjust2');
      this.imageSource = imageSource;
      this.imageAdjust = imageAdjust;
      this.imageAdjust2 = imageAdjust2;
      var cellSettings = builderStuff.querySelector('.is-modal.columnsettings');
      if (!cellSettings) {
        var html = "\n            <div class=\"is-modal columnsettings\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <div class=\"is-modal-bar is-draggable\">\n                        ".concat(util.out('Column Settings'), "\n                        <button class=\"is-modal-close\" title=\"").concat(util.out('Close'), "\" tabindex=\"-1\">&#10005;</button>\n                    </div>\n\n                    <div style=\"padding:0;margin-top:35px;\">\n\n                        <div class=\"is-tabs\" data-group=\"cellsettings\">\n                            <a title=\"").concat(util.out('General'), "\" id=\"tabCellGeneral\" href=\"#\" data-content=\"divCellGeneral\" class=\"active\">").concat(util.out('General'), "</a>\n                            <a title=\"").concat(util.out('Content'), "\" id=\"tabCellContent\" href=\"#\" data-content=\"divCellContent\">").concat(util.out('Content'), "</a>\n                            ").concat(this.builder.useLightbox ? "\n                            <a title=\"".concat(util.out('On Click'), "\" id=\"tabCellClick\" href=\"#\" data-content=\"divCellClick\">").concat(util.out('On Click'), "</a>\n                            ") : '', "\n                            <a title=\"").concat(util.out('More'), "\" id=\"tabCellMore\" href=\"#\" data-content=\"divCellMore\">").concat(util.out('More'), "</a>\n                        </div>\n                        <div id=\"divCellGeneral\" class=\"is-tab-content active\" data-group=\"cellsettings\" style=\"display:flex\" tabindex=\"-1\">\n                        \n                            <div style=\"padding-bottom: 3px;\">").concat(util.out('Background Color'), ":</div>\n                            <div style=\"display:flex;\">\n                                <button title=\"").concat(util.out('Background Color'), "\" class=\"input-cell-bgcolor is-btn-color\" style=\"margin-right:15px\"></button>\n                                <button title=\"").concat(util.out('Gradient'), "\" class=\"input-cell-gradient classic\" data-value=\"+\"> ").concat(util.out('Gradient'), " </button>\n                            </div>\n\n                            <div style=\"padding-top:20px;padding-bottom: 3px;\">").concat(util.out('Background Image'), ":</div>\n                            <div>\n                                <div class=\"cell-bgimage-preview\"></div>\n                                <div style=\"display: flex\">\n                                    <button title=\"").concat(util.out('Image'), "\" class=\"input-cell-bgimage\">\n                                        <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-image\"></use></svg>\n                                        <span>").concat(util.out('Image'), "</span>\n                                    </button>\n                                    <button title=\"").concat(util.out('Select'), "\" class=\"input-select\">").concat(this.builder.opts.selectIcon, "</button>\n                                    <button title=\"").concat(util.out('Remove'), "\" class=\"input-cell-bgremove\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                                    <button title=\"").concat(util.out('Adjust'), "\" class=\"input-cell-bgimageadjust\" style=\"width:40px\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-wrench\"></use></svg></button>\n                                </div>\n                            </div>\n\n                            <div style=\"padding-top:20px;padding-bottom:3px;\">").concat(util.out('Text Color'), ":</div>\n                            <div class=\"div-content-textcolor\">\n                                <button title=\"0\" class=\"input-cell-textcolor\" data-command=\"dark\">").concat(util.out('Dark'), "</button>\n                                <button title=\"10\" class=\"input-cell-textcolor\" data-command=\"light\">").concat(util.out('Light'), "</button>\n                                \n                                <button title=\"").concat(util.out('Clear'), "\" class=\"input-cell-textcolor\" data-command=\"\"><svg class=\"is-icon-flex\" style=\"flex:none;width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                            </div>\n\n                            <div style=\"padding:30px 0 10px;\">\n                                <label class=\"label-cell-grayscale label-checkbox\" for=\"chkCellGrayscale\"><input id=\"chkCellGrayscale\" class=\"chk-cell-grayscale\" type=\"checkbox\" /> ").concat(util.out('Grayscale'), "</label>\n                            </div>\n\n                            <div style=\"display:none;padding:20px 0 10px;\">\n                                <label class=\"label-cell-hideonmobile label-checkbox\" for=\"chkHideColumnOnMobile\"><input id=\"chkHideColumnOnMobile\" class=\"chk-cell-hideonmobile\" type=\"checkbox\" /> ").concat(util.out('Hide Column on Mobile'), "</label>\n                            </div>\n\n                            <div class=\"is-separator\"></div>\n                         \n                            <div class=\"div-target\" style=\"display: flex;justify-content: flex-end;padding: 5px 0 0;\">\n                                <button title=\"").concat(util.out('Desktop'), "\" class=\"input-device on\" data-value=\"\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-device-desktop\"></use></svg>\n                                </button>\n                                <button title=\"").concat(util.out('Laptop/Tablet (Landscape)'), "\" class=\"input-device\" data-value=\"md\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;transform:rotate(-90deg)\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                                </button>\n                                <button title=\"").concat(util.out('Tablet (Portrait)'), "\" class=\"input-device\" data-value=\"sm\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                                </button>\n                                <button title=\"").concat(util.out('Mobile'), "\" class=\"input-device\" data-value=\"xs\" style=\"width:40px;height:25px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:13px;height:13px\"><use xlink:href=\"#icon-device-mobile\"></use></svg>\n                                </button>\n                            </div>\n\n                            <div style=\"padding-top:0;padding-bottom:3px;\">").concat(util.out('Visibility'), ":</div>\n                            <div class=\"div-visibility\" style=\"display:flex;\">\n                                <button title=\"").concat(util.out('Visible'), "\" class=\"input-visible on\" style=\"width:100px;height:34px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-eye\"></use></svg>\n                                    <span>").concat(util.out('Visible'), "</span>\n                                </button>\n                                <button title=\"").concat(util.out('Hidden'), "\" class=\"input-hidden\" style=\"width:100px;height:34px;\">\n                                    <svg class=\"is-icon-flex\" style=\"width:16px;height:16px\"><use xlink:href=\"#icon-eye-off\"></use></svg>\n                                    <span>").concat(util.out('Hidden'), "</span>\n                                </button>\n                            </div>\n                            \n                            <!--\n                            <div style=\"display:none;padding-top:20px;padding-bottom:3px;\">").concat(util.out('Enlarge Row'), ":</div>\n                            <div style=\"display: none;\">\n                                <button title=\"").concat(util.out('Normal'), "\" class=\"input-row-enlarge\" data-command=\"0\" style=\"margin-right:1px;\">").concat(util.out('Normal'), "</button>\n                                <button title=\"+10%\" class=\"input-row-enlarge\" data-command=\"10\" style=\"width:50px;margin-right:1px;\">+10%</button>\n                                <button title=\"+20%\" class=\"input-row-enlarge\" data-command=\"20\" style=\"width:50px;margin-right:1px;\">+20%</button>\n                                <button title=\"+30%\" class=\"input-row-enlarge\" data-command=\"30\" style=\"width:50px;margin-right:1px;\">+30%</button>\n                                <button title=\"+40%\" class=\"input-row-enlarge\" data-command=\"40\" style=\"width:50px;margin-right:1px;\">+40%</button>\n                                <button title=\"+50%\" class=\"input-row-enlarge\" data-command=\"50\" style=\"width:50px;margin-right:1px;\">+50%</button>\n                                <button title=\"+60%\" class=\"input-row-enlarge\" data-command=\"60\" style=\"width:50px;margin-right:1px;\">+60%</button>\n                            </div>\n                            -->\n\n                        </div>\n\n                        <div id=\"divCellContent\" class=\"is-tab-content\" data-group=\"cellsettings\" tabindex=\"-1\">\n\n                            <div style=\"padding-bottom:3px;\">").concat(util.out('Padding'), ":</div>\n\n                            <div class=\"div-content-padding-pos\" style=\"align-items:center;").concat(this.builder.useCssClasses ? '' : 'display:none', "\">\n                                <div style=\"width:130px\">\n                                    <div style=\"display: flex;justify-content: center;\">\n                                        <button title=\"").concat(util.out('Top'), "\" class=\"input-cell-padding-pos on\" data-command=\"top\">").concat(util.out('Top'), "</button>\n                                    </div>\n                                    <div style=\"display: flex;justify-content: center;\">\n                                        <button title=\"").concat(util.out('Left'), "\" class=\"input-cell-padding-pos on\" data-command=\"left\">").concat(util.out('Left'), "</button>\n                                        <button title=\"").concat(util.out('Right'), "\" class=\"input-cell-padding-pos on\" data-command=\"right\">").concat(util.out('Right'), "</button>\n                                    </div>\n                                    <div style=\"display: flex;justify-content: center;\">\n                                        <button title=\"").concat(util.out('Bottom'), "\" class=\"input-cell-padding-pos on\" data-command=\"bottom\">").concat(util.out('Bottom'), "</button>\n                                    </div>\n                                </div>\n                                <button title=\"").concat(util.out('All'), "\" class=\"input-cell-padding-pos\" data-command=\"all\">").concat(util.out('All'), "</button>\n                                <button title=\"x\" class=\"input-cell-padding-pos\" data-command=\"x\" style=\"width:50px\">x</button>\n                                <button title=\"y\" class=\"input-cell-padding-pos\" data-command=\"y\" style=\"width:50px\">y</button>\n                            </div>\n\n                            <div class=\"div-content-padding\" style=\"flex-flow:wrap;margin-top:7px\">\n                                <div style=\"display:flex;flex-flow:wrap;").concat(this.builder.useCssClasses ? 'display:none' : '', "\">\n                                    <button title=\"0\" class=\"input-cell-padding\" data-command=\"0\">0</button>\n                                    <button title=\"10\" class=\"input-cell-padding\" data-command=\"10\">10</button>\n                                    <button title=\"20\" class=\"input-cell-padding\" data-command=\"20\">20</button>\n                                    <button title=\"30\" class=\"input-cell-padding\" data-command=\"30\">30</button>\n                                    <button title=\"40\" class=\"input-cell-padding\" data-command=\"40\">40</button>\n                                    <button title=\"50\" class=\"input-cell-padding\" data-command=\"50\">50</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"60\">60</button>\n                                </div>\n\n                                <div style=\"display:flex;flex-flow:wrap;").concat(this.builder.useCssClasses ? '' : 'display:none', "\">\n                                    <button title=\"0\" class=\"input-cell-padding\" data-command=\"0\">0</button>\n                                    <button title=\"20\" class=\"input-cell-padding\" data-command=\"1\">10</button>\n                                    <button title=\"40\" class=\"input-cell-padding\" data-command=\"2\">20</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"3\">30</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"4\">40</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"5\">50</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"6\">60</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"7\">70</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"8\">80</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"9\">90</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"10\">100</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"11\">110</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"12\">120</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"14\">140</button>\n                                    <button title=\"60\" class=\"input-cell-padding\" data-command=\"16\">160</button>\n                                    <button title=\"").concat(util.out('Clear'), "\" class=\"input-cell-padding\" data-command=\"\"><svg class=\"is-icon-flex\" style=\"flex:none;width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                                </div>\n                            </div>\n\n                            <div style=\"padding-top:20px;padding-bottom:3px;\">").concat(util.out('Height'), ":</div>\n                            <div class=\"div-content-height\">\n                                <button title=\"Decrease\" class=\"input-cell-height\" data-command=\"-\">-</button>\n                                <button title=\"Increase\" class=\"input-cell-height\" data-command=\"+\">+</button>\n                                <button title=\"300\" class=\"input-cell-height\" data-command=\"300\">300</button>\n                                <button title=\"400\" class=\"input-cell-height\" data-command=\"400\">400</button>\n                                <button title=\"500\" class=\"input-cell-height\" data-command=\"500\">500</button>\n                                <button title=\"600\" class=\"input-cell-height\" data-command=\"600\">600</button>\n                                <button title=\"700\" class=\"input-cell-height\" data-command=\"700\">700</button>\n                                <button title=\"").concat(util.out('Clear'), "\" class=\"input-cell-height\" data-command=\"\"><svg class=\"is-icon-flex\" style=\"flex:none;width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                            </div>\n\n                            <div style=\"padding-top:20px;padding-bottom:3px;\">").concat(util.out('Content Alignment'), ":</div>\n                            <div style=\"display:flex;align-items: flex-end;\">\n                                <div style=\"width:128px\">\n                                    <div class=\"div-content-position\">\n                                        <button class=\"cmd-content-pos\" data-pos=\"topleft\" title=\"").concat(util.out('Top Left'), "\" type=\"button\" style=\"\"><svg class=\"is-icon-flex\" style=\"transform: rotate(315deg);\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></button>\n                                        <button class=\"cmd-content-pos\" data-pos=\"topcenter\" title=\"").concat(util.out('Top Center'), "\" type=\"button\"><svg class=\"is-icon-flex\" style=\"\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></button>\n                                        <button class=\"cmd-content-pos\" data-pos=\"topright\" topright=\"").concat(util.out('Top Right'), "\" type=\"button\"><svg class=\"is-icon-flex\" style=\"transform: rotate(45deg);\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></button>\n                                    </div>\n                                    <div class=\"div-content-position\">\n                                        <button class=\"cmd-content-pos\" data-pos=\"centerleft\" title=\"").concat(util.out('Center Left'), "\" type=\"button\"><svg class=\"is-icon-flex\" style=\"\"><use xlink:href=\"#ion-ios-arrow-thin-left\"></use></svg></button>\n                                        <button class=\"cmd-content-pos\" data-pos=\"center\" title=\"").concat(util.out('Center'), "\" type=\"button\"><svg class=\"is-icon-flex\" style=\"width:6px;height:6px;\"><use xlink:href=\"#ion-android-contract\"></use></svg></button>\n                                        <button class=\"cmd-content-pos\" data-pos=\"centerright\" title=\"").concat(util.out('Center Right'), "\" type=\"button\"><svg class=\"is-icon-flex\" style=\"\"><use xlink:href=\"#ion-ios-arrow-thin-right\"></use></svg></button>\n                                    </div>\n                                    <div class=\"div-content-position\">\n                                        <button class=\"cmd-content-pos\" data-pos=\"bottomleft\" title=\"").concat(util.out('Bottom Left'), "\" type=\"button\" style=\";\"><svg class=\"is-icon-flex\" style=\"transform: rotate(45deg);\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></button>\n                                        <button class=\"cmd-content-pos\" data-pos=\"bottomcenter\" title=\"").concat(util.out('Bottom Center'), "\" type=\"button\"><svg class=\"is-icon-flex\" style=\"\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></button>\n                                        <button class=\"cmd-content-pos\" data-pos=\"bottomright\" title=\"").concat(util.out('Bottom Right'), "\" type=\"button\"><svg class=\"is-icon-flex\" style=\"transform: rotate(315deg);\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></button>\n                                    </div>\n                                </div>\n                                <div class=\"div-content-position\">\n                                    <button title=\"").concat(util.out('Clear'), "\" class=\"cmd-content-pos\" data-pos=\"\"><svg class=\"is-icon-flex\" style=\"flex:none;width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div id=\"divCellClick\" class=\"is-tab-content\" data-group=\"cellsettings\" tabindex=\"-1\">\n\n                            <label for=\"inpCellLinkSource\" style=\"display:block\">").concat(util.out('Open'), ":</label>\n                            <div class=\"image-src\">\n                                <!--<div class=\"div-input-text\">-->\n                                <input id=\"inpCellLinkSource\" class=\"input-src\" type=\"text\" style=\"height:38px;\">\n                                <!--<button title=\"").concat(util.out('Clear'), "\" class=\"input-clear\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                                </div>-->\n                                <button title=\"").concat(util.out('Select'), "\" class=\"input-select\" style=\"flex:none;width:40px;height:38px;\">").concat(this.builder.opts.selectIcon, "</button>\n\n                                <button title=\"").concat(util.out(this.builder.opts.otherSelectCaption), "\" class=\"input-select-other\" style=\"display:none;width:40px;height:38px;\">\n                                    ").concat(this.builder.opts.otherSelectIcon, "\n                                </button>\n                                \n                                <div class=\"image-larger4 is-btn classic\" style=\"position: relative; flex: 0 0 auto; width: 40px; height: 38px; box-shadow: rgba(0, 0, 0, 0.32) 0px 3px 6px -6px;\">\n                                    <form class=\"form-upload-larger\" target=\"frameTargetLinkUpload\" method=\"post\" action=\"").concat(this.builder.opts.largerImageHandler, "\" enctype=\"multipart/form-data\" style=\"position:absolute;top:0;left:0;width:100%;height:100%;border-radius:1px;display:flex;align-items: center;justify-content: center;\">\n                                        <input id=\"hidRefId4\" name=\"hidRefId\" type=\"hidden\" value=\"\">\n                                        <svg class=\"is-icon-flex\" style=\"width:18px;height:18px;\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                                        <input onclick=\"blur()\" title=\"").concat(util.out('Select'), "\" id=\"fileImage4\" name=\"fileImage\" type=\"file\" accept=\"image/*,video/mp4\" style=\"position:absolute;top:-30px;left:0;width:100%;height:68px;opacity: 0;cursor: pointer;\">\n                                    </form>\n\n                                    <iframe tabindex=\"-1\" id=\"frameTargetLinkUpload\" name=\"frameTargetLinkUpload\" src=\"about:blank\" style=\"width:1px;height:1px;position:absolute;top:0;right:-100000px\"></iframe>\n                                </div>\n                            </div>\n                            <div style=\"padding-top:20px\">\n                                <button class=\"input-testclick\">").concat(util.out('Test'), "</button>\n                            </div>\n\n                            <p>").concat(util.out('You can test the On-Click action on page if you lock the column by clicking the lock button'), " <svg class=\"is-icon-flex\"><use xlink:href=\"#icon-lock\"></use></svg>.</p>\n\n                        </div>\n\n                        <div id=\"divCellMore\" class=\"is-tab-content\" data-group=\"cellsettings\" tabindex=\"-1\">\n\n                            <label for=\"inpCellId\">").concat(util.out('Add Column ID'), ":</label>\n                            <div>\n                                <input id=\"inpCellId\" class=\"input-cell-id\" type=\"text\" onkeypress=\"return /[0-9a-zA-Z_]/i.test(event.key)\" style=\"height:38px\">\n                            </div>\n        \n                            <label for=\"inpCellCssClasses\" style=\"padding:20px 0 3px;\">").concat(util.out('Add Css Classes'), ":</label>\n                            <div>\n                                <input id=\"inpCellCssClasses\" class=\"input-cell-classes\" type=\"text\" style=\"height:38px\">\n                            </div>\n\n                        </div>\n\n                    \n                    </div>\n                        \n                </div>\n                \n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        cellSettings = builderStuff.querySelector('.is-modal.columnsettings');
        this.cellSettings = cellSettings;
        this.divCellClick = cellSettings.querySelector('#divCellClick');
        this.divCellGeneral = cellSettings.querySelector('#divCellGeneral');
        var inpCellId = cellSettings.querySelector('.input-cell-id');
        inpCellId.addEventListener('change', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          _this3.builder.uo.saveForUndo();
          if (inpCellId.value !== '') {
            cell.setAttribute('id', inpCellId.value);
          } else {
            cell.removeAttribute('id');
          }
          _this3.builder.opts.onChange();
        });
        var inpCellCssClasses = cellSettings.querySelector('.input-cell-classes');
        inpCellCssClasses.addEventListener('change', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          _this3.builder.uo.saveForUndo();
          var arrCurrentClasses = [];
          var currentClasses = cell.getAttribute('data-class');
          if (currentClasses) arrCurrentClasses = currentClasses.split(' ');
          var arrNewClasses = [];
          var newClasses = inpCellCssClasses.value;
          arrNewClasses = newClasses.split(' ');
          arrCurrentClasses.forEach(function (item) {
            if (!arrNewClasses.includes(item)) {
              cell.classList.remove(item);
            }
          });
          arrNewClasses.forEach(function (item) {
            if (item !== '') cell.classList.add(item);
          });

          // save
          cell.setAttribute('data-class', newClasses);
          if (cell.getAttribute('data-class') === '') cell.removeAttribute('data-class');
          _this3.builder.opts.onChange();
        });

        // Column Background color
        var btnCellBgColor = cellSettings.querySelector('.input-cell-bgcolor');
        btnCellBgColor.addEventListener('click', function (e) {
          _this3.builder.uo.saveForUndo(true); // checkLater = true

          var elm = e.target;
          _this3.builder.colorPicker.open(function (color) {
            var cell = util.cellSelected();
            cell.style.backgroundColor = color;
            elm.style.backgroundColor = color; // preview

            _this3.builder.opts.onChange();
          }, cellSettings.querySelector('.input-cell-bgcolor').style.backgroundColor, function () {
            btnCellBgColor.removeAttribute('data-focus');
            btnCellBgColor.focus();
          });
          btnCellBgColor.setAttribute('data-focus', true);
        });

        // Column Background Image
        var btnCellBgImage = cellSettings.querySelector('.input-cell-bgimage');
        if (btnCellBgImage) dom.addEventListener(btnCellBgImage, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;

          //Get current value
          var imgUrl = '';
          if (cell.style.backgroundImage) {
            if (cell.style.backgroundImage.indexOf('url(') !== -1) {
              imgUrl = cell.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
            }
          }
          _this3.openImagePicker(imgUrl, function (url) {
            var cell = util.cellSelected();
            if (!cell) return;
            _this3.builder.uo.saveForUndo();
            cell.style.backgroundImage = "url(\"".concat(url, "\")");
            cell.style.backgroundSize = 'cover';
            cell.style.backgroundRepeat = 'no-repeat';
            var div = cellSettings.querySelector('.cell-bgimage-preview');
            var btnImageAdjust = _this3.cellSettings.querySelector('.input-cell-bgimageadjust');
            var btnImageRemove = _this3.cellSettings.querySelector('.input-cell-bgremove');
            btnImageAdjust.style.display = 'none';
            btnImageRemove.style.display = 'none';
            if (url !== '') {
              div.innerHTML = "<img src=\"".concat(url, "\">");
              btnImageAdjust.style.display = 'flex';
              btnImageRemove.style.display = 'flex';
            } else {
              div.innerHTML = '';
            }
            _this3.builder.opts.onChange();
          }, btnCellBgImage);
        });

        // Column Background Image Adjust
        var btnImageAdjust = cellSettings.querySelector('.input-cell-bgimageadjust');
        if (btnImageAdjust) dom.addEventListener(btnImageAdjust, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          _this3.openImageAdjust(cell, btnImageAdjust);
        });
        var elm = cellSettings.querySelector('.input-cell-bgremove');
        if (elm) dom.addEventListener(elm, 'click', function () {
          var cell = util.cellSelected();
          if (!cell) return;
          _this3.builder.uo.saveForUndo();
          cell.style.backgroundImage = '';
          cell.style.backgroundSize = '';
          cell.style.backgroundRepeat = '';
          cell.style.backgroundPosition = '';
          var div = cellSettings.querySelector('.cell-bgimage-preview');
          var btnImageAdjust = _this3.cellSettings.querySelector('.input-cell-bgimageadjust');
          var btnImageRemove = _this3.cellSettings.querySelector('.input-cell-bgremove');
          btnImageAdjust.style.display = 'none';
          btnImageRemove.style.display = 'none';
          div.innerHTML = '';
          _this3.builder.opts.onChange();
        });

        // Column Background Image Open Asset

        if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
          this.divCellGeneral.querySelector('.input-select').style.display = 'none';
        }
        var btnCellBgImageOpenAsset = this.divCellGeneral.querySelector('.input-select');
        this.builder.renderSelectAsset(btnCellBgImageOpenAsset, 'image', function (url) {
          var cell = util.cellSelected();
          if (!cell) return;
          _this3.builder.uo.saveForUndo();
          cell.style.backgroundImage = "url(\"".concat(url, "\")");
          cell.style.backgroundSize = 'cover';
          cell.style.backgroundRepeat = 'no-repeat';
          var div = cellSettings.querySelector('.cell-bgimage-preview');
          var btnImageAdjust = _this3.cellSettings.querySelector('.input-cell-bgimageadjust');
          var btnImageRemove = _this3.cellSettings.querySelector('.input-cell-bgremove');
          btnImageAdjust.style.display = 'none';
          btnImageRemove.style.display = 'none';
          if (url !== '') {
            div.innerHTML = "<img src=\"".concat(url, "\">");
            btnImageAdjust.style.display = 'flex';
            btnImageRemove.style.display = 'flex';
          } else {
            div.innerHTML = '';
          }
          _this3.builder.opts.onChange();
        });

        // Row Enlarge (Currently not used)
        var elms = cellSettings.querySelectorAll('.input-row-enlarge');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.addEventListener(elm, 'click', function () {
            _this3.builder.uo.saveForUndo();
            var val = elm.getAttribute('data-command');
            var cell = util.cellSelected();
            var row = cell.parentNode;
            dom.removeClass(row, 'expand-10');
            dom.removeClass(row, 'expand-20');
            dom.removeClass(row, 'expand-30');
            dom.removeClass(row, 'expand-40');
            dom.removeClass(row, 'expand-50');
            dom.removeClass(row, 'expand-60');
            dom.addClass(row, 'expand-' + val);
            _this3.builder.opts.onChange();
          });
        });

        // Background gradient
        var gradientPicker = new contentbuilder_gradientpicker({
          colors: this.builder.colors,
          gradientcolors: this.builder.opts.gradientcolors,
          lang: this.builder.opts.lang
        });
        var btnCellGradient = cellSettings.querySelector('.input-cell-gradient');
        btnCellGradient.addEventListener('click', function () {
          _this3.builder.uo.saveForUndo(true); // checkLater = true

          var cell = util.cellSelected();
          gradientPicker.open(cell, function () {
            var btnImageAdjust = _this3.cellSettings.querySelector('.input-cell-bgimageadjust');
            btnImageAdjust.style.display = 'none';
            var btnImageRemove = _this3.cellSettings.querySelector('.input-cell-bgremove');
            btnImageRemove.style.display = 'none';
            var div = _this3.cellSettings.querySelector('.cell-bgimage-preview');
            div.innerHTML = '';
            var inpSrc = _this3.imageSource.querySelector('.input-src');
            inpSrc.value = '';
            _this3.builder.opts.onChange();
          }, function (isChanged) {
            if (isChanged) {

              // Do Nothing
            }
            btnCellGradient.removeAttribute('data-focus');
            btnCellGradient.focus();
          });
          btnCellGradient.setAttribute('data-focus', true);
        });
        elms = cellSettings.querySelectorAll('.input-cell-textcolor');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.addEventListener(elm, 'click', function () {
            _this3.builder.uo.saveForUndo();
            var val = elm.getAttribute('data-command');
            var cell = util.cellSelected();
            if (val === 'dark') {
              dom.removeClass(cell, 'is-light-text');
              dom.addClass(cell, 'is-dark-text');
            } else if (val === 'light') {
              dom.removeClass(cell, 'is-dark-text');
              dom.addClass(cell, 'is-light-text');
            } else {
              dom.removeClass(cell, 'is-dark-text');
              dom.removeClass(cell, 'is-light-text');
            }
            var ns = cell.querySelectorAll('*');
            Array.prototype.forEach.call(ns, function (n) {
              if (n.style.color) n.style.color = '';
            });
            _this3.builder.opts.onChange();
          });
        });
        elms = cellSettings.querySelectorAll('.input-cell-padding-pos');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.addEventListener(elm, 'click', function () {
            var val = elm.getAttribute('data-command');
            var ns = _this3.cellSettings.querySelectorAll('.input-cell-padding-pos');
            Array.prototype.forEach.call(ns, function (n) {
              dom.removeClass(n, 'on');
            });
            if (val === 'all') {
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="top"]'), 'on');
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="left"]'), 'on');
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="right"]'), 'on');
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="bottom"]'), 'on');
            } else if (val === 'x') {
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="left"]'), 'on');
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="right"]'), 'on');
            } else if (val === 'y') {
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="top"]'), 'on');
              dom.addClass(_this3.cellSettings.querySelector('button[data-command="bottom"]'), 'on');
            } else {
              dom.addClass(elm, 'on');
            }
            var btns = _this3.cellSettings.querySelectorAll('.input-cell-padding');
            Array.prototype.forEach.call(btns, function (btn) {
              dom.removeClass(btn, 'on');
            });
          });
        });
        elms = cellSettings.querySelectorAll('.input-cell-padding');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.addEventListener(elm, 'click', function () {
            _this3.builder.uo.saveForUndo();
            var val = elm.getAttribute('data-command');
            var cell = util.cellSelected();
            var ns = _this3.cellSettings.querySelectorAll('.input-cell-padding');
            Array.prototype.forEach.call(ns, function (n) {
              dom.removeClass(n, 'on');
            });
            if (_this3.builder.useCssClasses) {
              // Clean old classes
              dom.removeClass(cell, 'padding-0');
              dom.removeClass(cell, 'padding-10');
              dom.removeClass(cell, 'padding-20');
              dom.removeClass(cell, 'padding-30');
              dom.removeClass(cell, 'padding-40');
              dom.removeClass(cell, 'padding-50');
              dom.removeClass(cell, 'padding-60');
              var command;
              var _btns = _this3.cellSettings.querySelectorAll('.input-cell-padding-pos.on');
              if (_btns.length === 2) {
                // x or y selected
                command = _btns[0].getAttribute('data-command');
                if (command === 'left') {
                  // x selected

                  var classes = _this3.builder.cssClasses.padding.left;
                  for (var i = 0; i < Object.keys(classes).length; i++) {
                    var className = Object.values(classes)[i];
                    dom.removeClass(cell, className);
                  }
                  classes = _this3.builder.cssClasses.padding.right;
                  for (var _i = 0; _i < Object.keys(classes).length; _i++) {
                    var _className = Object.values(classes)[_i];
                    dom.removeClass(cell, _className);
                  }
                  classes = _this3.builder.cssClasses.padding.x;
                  for (var _i2 = 0; _i2 < Object.keys(classes).length; _i2++) {
                    var _className2 = Object.values(classes)[_i2];
                    dom.removeClass(cell, _className2);
                  }
                  if (val !== '') dom.addClass(cell, _this3.builder.cssClasses.padding.x["px_".concat(val)]);
                } else {
                  // y selected

                  var _classes = _this3.builder.cssClasses.padding.top;
                  for (var _i3 = 0; _i3 < Object.keys(_classes).length; _i3++) {
                    var _className3 = Object.values(_classes)[_i3];
                    dom.removeClass(cell, _className3);
                  }
                  _classes = _this3.builder.cssClasses.padding.bottom;
                  for (var _i4 = 0; _i4 < Object.keys(_classes).length; _i4++) {
                    var _className4 = Object.values(_classes)[_i4];
                    dom.removeClass(cell, _className4);
                  }
                  _classes = _this3.builder.cssClasses.padding.y;
                  for (var _i5 = 0; _i5 < Object.keys(_classes).length; _i5++) {
                    var _className5 = Object.values(_classes)[_i5];
                    dom.removeClass(cell, _className5);
                  }
                  if (val !== '') dom.addClass(cell, _this3.builder.cssClasses.padding.y["py_".concat(val)]);
                }
              } else if (_btns.length === 4) {
                // all selected

                var _classes2 = _this3.builder.cssClasses.padding.top;
                for (var _i6 = 0; _i6 < Object.keys(_classes2).length; _i6++) {
                  var _className6 = Object.values(_classes2)[_i6];
                  dom.removeClass(cell, _className6);
                }
                _classes2 = _this3.builder.cssClasses.padding.bottom;
                for (var _i7 = 0; _i7 < Object.keys(_classes2).length; _i7++) {
                  var _className7 = Object.values(_classes2)[_i7];
                  dom.removeClass(cell, _className7);
                }
                _classes2 = _this3.builder.cssClasses.padding.left;
                for (var _i8 = 0; _i8 < Object.keys(_classes2).length; _i8++) {
                  var _className8 = Object.values(_classes2)[_i8];
                  dom.removeClass(cell, _className8);
                }
                _classes2 = _this3.builder.cssClasses.padding.right;
                for (var _i9 = 0; _i9 < Object.keys(_classes2).length; _i9++) {
                  var _className9 = Object.values(_classes2)[_i9];
                  dom.removeClass(cell, _className9);
                }
                _classes2 = _this3.builder.cssClasses.padding.all;
                for (var _i10 = 0; _i10 < Object.keys(_classes2).length; _i10++) {
                  var _className10 = Object.values(_classes2)[_i10];
                  dom.removeClass(cell, _className10);
                }
                _classes2 = _this3.builder.cssClasses.padding.x;
                for (var _i11 = 0; _i11 < Object.keys(_classes2).length; _i11++) {
                  var _className11 = Object.values(_classes2)[_i11];
                  dom.removeClass(cell, _className11);
                }
                _classes2 = _this3.builder.cssClasses.padding.y;
                for (var _i12 = 0; _i12 < Object.keys(_classes2).length; _i12++) {
                  var _className12 = Object.values(_classes2)[_i12];
                  dom.removeClass(cell, _className12);
                }
                if (val !== '') dom.addClass(cell, _this3.builder.cssClasses.padding.all["p_".concat(val)]);
              } else {
                command = _btns[0].getAttribute('data-command');
                if (command === 'top') {
                  var _classes3 = _this3.builder.cssClasses.padding.top;
                  for (var _i13 = 0; _i13 < Object.keys(_classes3).length; _i13++) {
                    var _className13 = Object.values(_classes3)[_i13];
                    dom.removeClass(cell, _className13);
                  }
                  if (val !== '') dom.addClass(cell, _this3.builder.cssClasses.padding.top["pt_".concat(val)]);
                } else if (command === 'bottom') {
                  var _classes4 = _this3.builder.cssClasses.padding.bottom;
                  for (var _i14 = 0; _i14 < Object.keys(_classes4).length; _i14++) {
                    var _className14 = Object.values(_classes4)[_i14];
                    dom.removeClass(cell, _className14);
                  }
                  if (val !== '') dom.addClass(cell, _this3.builder.cssClasses.padding.bottom["pb_".concat(val)]);
                } else if (command === 'left') {
                  var _classes5 = _this3.builder.cssClasses.padding.left;
                  for (var _i15 = 0; _i15 < Object.keys(_classes5).length; _i15++) {
                    var _className15 = Object.values(_classes5)[_i15];
                    dom.removeClass(cell, _className15);
                  }
                  if (val !== '') dom.addClass(cell, _this3.builder.cssClasses.padding.left["pl_".concat(val)]);
                } else if (command === 'right') {
                  var _classes6 = _this3.builder.cssClasses.padding.right;
                  for (var _i16 = 0; _i16 < Object.keys(_classes6).length; _i16++) {
                    var _className16 = Object.values(_classes6)[_i16];
                    dom.removeClass(cell, _className16);
                  }
                  if (val !== '') dom.addClass(cell, _this3.builder.cssClasses.padding.right["pr_".concat(val)]);
                }
              }
              dom.addClass(elm, 'on');
            } else {
              dom.removeClass(cell, 'padding-0');
              dom.removeClass(cell, 'padding-10');
              dom.removeClass(cell, 'padding-20');
              dom.removeClass(cell, 'padding-30');
              dom.removeClass(cell, 'padding-40');
              dom.removeClass(cell, 'padding-50');
              dom.removeClass(cell, 'padding-60');
              if (val !== '') {
                dom.addClass(cell, 'padding-' + val);
                dom.addClass(elm, 'on');
              }
            }
            _this3.builder.opts.onChange();
          });
        });
        var chkCellGrayscale = cellSettings.querySelector('.chk-cell-grayscale');
        dom.addEventListener(chkCellGrayscale, 'click', function () {
          _this3.builder.uo.saveForUndo();
          var cell = util.cellSelected();
          if (chkCellGrayscale.checked) {
            cell.style.filter = 'grayscale(1)';
          } else {
            if (cell.style.filter) {
              cell.style.filter = cell.style.filter.replace('grayscale(1)', '');
            }
          }
          _this3.builder.opts.onChange();
        });
        var chkHideColumnOnMobile = cellSettings.querySelector('.chk-cell-hideonmobile');
        dom.addEventListener(chkHideColumnOnMobile, 'click', function () {
          _this3.builder.uo.saveForUndo();
          var cell = util.cellSelected();
          if (chkHideColumnOnMobile.checked) {
            cell.classList.add('hideonmobile');
          } else {
            cell.classList.remove('hideonmobile');
          }
          _this3.builder.opts.onChange();
        });
        elms = cellSettings.querySelectorAll('.input-cell-height');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.addEventListener(elm, 'click', function () {
            var arrHeight = _this3.builder.colHeight;
            _this3.builder.uo.saveForUndo();
            var val = elm.getAttribute('data-command');
            var cell = util.cellSelected();
            var ns = _this3.cellSettings.querySelectorAll('.input-cell-height');
            Array.prototype.forEach.call(ns, function (n) {
              dom.removeClass(n, 'on');
            });
            if (val === '') {
              Array.prototype.forEach.call(arrHeight, function (h) {
                dom.removeClass(cell, 'min-height-' + h);
              });
            } else if (val === '-') {
              var offHeight = cell.offsetHeight;
              Array.prototype.forEach.call(arrHeight, function (h) {
                if (offHeight - h > 0 && offHeight - h <= 50) {
                  Array.prototype.forEach.call(arrHeight, function (h) {
                    dom.removeClass(cell, 'min-height-' + h);
                  });
                  dom.addClass(cell, 'min-height-' + h);
                  if (h === 300) {
                    var btn = _this3.cellSettings.querySelector('.input-cell-height[data-command="300"');
                    dom.addClass(btn, 'on');
                  } else if (h === 400) {
                    var _btn = _this3.cellSettings.querySelector('.input-cell-height[data-command="400"');
                    dom.addClass(_btn, 'on');
                  } else if (h === 500) {
                    var _btn2 = _this3.cellSettings.querySelector('.input-cell-height[data-command="500"');
                    dom.addClass(_btn2, 'on');
                  } else if (h === 600) {
                    var _btn3 = _this3.cellSettings.querySelector('.input-cell-height[data-command="600"');
                    dom.addClass(_btn3, 'on');
                  } else if (h === 700) {
                    var _btn4 = _this3.cellSettings.querySelector('.input-cell-height[data-command="700"');
                    dom.addClass(_btn4, 'on');
                  }
                }
              });
            } else if (val === '+') {
              var _offHeight = cell.offsetHeight;
              Array.prototype.forEach.call(arrHeight, function (h) {
                if (h - _offHeight > 0 && h - _offHeight <= 50) {
                  Array.prototype.forEach.call(arrHeight, function (h) {
                    dom.removeClass(cell, 'min-height-' + h);
                  });
                  dom.addClass(cell, 'min-height-' + h);
                  if (h === 300) {
                    var btn = _this3.cellSettings.querySelector('.input-cell-height[data-command="300"');
                    dom.addClass(btn, 'on');
                  } else if (h === 400) {
                    var _btn5 = _this3.cellSettings.querySelector('.input-cell-height[data-command="400"');
                    dom.addClass(_btn5, 'on');
                  } else if (h === 500) {
                    var _btn6 = _this3.cellSettings.querySelector('.input-cell-height[data-command="500"');
                    dom.addClass(_btn6, 'on');
                  } else if (h === 600) {
                    var _btn7 = _this3.cellSettings.querySelector('.input-cell-height[data-command="600"');
                    dom.addClass(_btn7, 'on');
                  } else if (h === 700) {
                    var _btn8 = _this3.cellSettings.querySelector('.input-cell-height[data-command="700"');
                    dom.addClass(_btn8, 'on');
                  }
                }
              });
            } else {
              Array.prototype.forEach.call(arrHeight, function (h) {
                dom.removeClass(cell, 'min-height-' + h);
              });
              dom.addClass(cell, 'min-height-' + val);
              dom.addClass(elm, 'on');
            }
            _this3.builder.opts.onChange();
          });
        });
        elms = cellSettings.querySelectorAll('.cmd-content-pos');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.addEventListener(elm, 'click', function () {
            _this3.builder.uo.saveForUndo();
            var val = elm.getAttribute('data-pos');
            var cell = util.cellSelected();
            var btns = _this3.cellSettings.querySelectorAll('.cmd-content-pos');
            Array.prototype.forEach.call(btns, function (n) {
              dom.removeClass(n, 'on');
            });
            if (_this3.builder.useCssClasses) {
              if (val !== '') {
                var classes = _this3.builder.cssClasses.display;
                dom.addCssClass(cell, classes.flex, classes);
                classes = _this3.builder.cssClasses.flexDirection;
                dom.addCssClass(cell, classes.column, classes);
                if (val === 'topleft') {
                  var _classes7 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes7.start, _classes7);
                  _classes7 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes7.start, _classes7);
                  dom.addClass(elm, 'on');
                }
                if (val === 'topcenter') {
                  var _classes8 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes8.start, _classes8);
                  _classes8 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes8.center, _classes8);
                  dom.addClass(elm, 'on');
                }
                if (val === 'topright') {
                  var _classes9 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes9.start, _classes9);
                  _classes9 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes9.end, _classes9);
                  dom.addClass(elm, 'on');
                }
                if (val === 'centerleft') {
                  var _classes10 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes10.center, _classes10);
                  _classes10 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes10.start, _classes10);
                  dom.addClass(elm, 'on');
                }
                if (val === 'center') {
                  var _classes11 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes11.center, _classes11);
                  _classes11 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes11.center, _classes11);
                  dom.addClass(elm, 'on');
                }
                if (val === 'centerright') {
                  var _classes12 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes12.center, _classes12);
                  _classes12 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes12.end, _classes12);
                  dom.addClass(elm, 'on');
                }
                if (val === 'bottomleft') {
                  var _classes13 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes13.end, _classes13);
                  _classes13 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes13.start, _classes13);
                  dom.addClass(elm, 'on');
                }
                if (val === 'bottomcenter') {
                  var _classes14 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes14.end, _classes14);
                  _classes14 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes14.center, _classes14);
                  dom.addClass(elm, 'on');
                }
                if (val === 'bottomright') {
                  var _classes15 = _this3.builder.cssClasses.justifyContent;
                  dom.addCssClass(cell, _classes15.end, _classes15);
                  _classes15 = _this3.builder.cssClasses.alignItems;
                  dom.addCssClass(cell, _classes15.end, _classes15);
                  dom.addClass(elm, 'on');
                }
                cell.style.justifyContent = '';
                cell.style.alignItems = '';
              } else {
                dom.removeCssClasses(cell, _this3.builder.cssClasses.display);
                dom.removeCssClasses(cell, _this3.builder.cssClasses.flexDirection);
                dom.removeCssClasses(cell, _this3.builder.cssClasses.justifyContent);
                dom.removeCssClasses(cell, _this3.builder.cssClasses.alignItems);
                cell.style.display = '';
                cell.style.flexDirection = '';
                cell.style.justifyContent = '';
                cell.style.alignItems = '';
              }
            } else {
              cell.style.display = 'flex';
              cell.style.flexDirection = 'column';
              if (val === 'topleft') {
                cell.style.justifyContent = 'flex-start';
                cell.style.alignItems = 'flex-start';
                dom.addClass(elm, 'on');
              }
              if (val === 'topcenter') {
                cell.style.justifyContent = 'flex-start';
                cell.style.alignItems = 'center';
                dom.addClass(elm, 'on');
              }
              if (val === 'topright') {
                cell.style.justifyContent = 'flex-start';
                cell.style.alignItems = 'flex-end';
                dom.addClass(elm, 'on');
              }
              if (val === 'centerleft') {
                cell.style.justifyContent = 'center';
                cell.style.alignItems = 'flex-start';
                dom.addClass(elm, 'on');
              }
              if (val === 'center') {
                cell.style.justifyContent = 'center';
                cell.style.alignItems = 'center';
                dom.addClass(elm, 'on');
              }
              if (val === 'centerright') {
                cell.style.justifyContent = 'center';
                cell.style.alignItems = 'flex-end';
                dom.addClass(elm, 'on');
              }
              if (val === 'bottomleft') {
                cell.style.justifyContent = 'flex-end';
                cell.style.alignItems = 'flex-start';
                dom.addClass(elm, 'on');
              }
              if (val === 'bottomcenter') {
                cell.style.justifyContent = 'flex-end';
                cell.style.alignItems = 'center';
                dom.addClass(elm, 'on');
              }
              if (val === 'bottomright') {
                cell.style.justifyContent = 'flex-end';
                cell.style.alignItems = 'flex-end';
                dom.addClass(elm, 'on');
              }
            }
            _this3.builder.opts.onChange();
          });
        });

        // Click to Open Image Select Dialog (.is-modal.columnsettings)

        if (this.builder.opts.onOtherSelectClick || this.builder.opts.otherSelect !== '') {
          this.cellSettings.querySelector('.input-select-other').style.display = 'flex';
          var inputSelectOther = this.cellSettings.querySelector('.input-select-other');
          dom.addEventListener(inputSelectOther, 'click', function (e) {
            if (_this3.builder.opts.onOtherSelectClick) {
              _this3.builder.opts.onOtherSelectClick({
                targetInput: _this3.cellSettings.querySelector('.input-src'),
                theTrigger: _this3.cellSettings.querySelector('.input-select-other')
              });
            } else {
              var modalFileSelect = builderStuff.querySelector('.is-modal.otherselect');
              if (_this3.builder.opts.assetRefresh) {
                modalFileSelect.querySelector('iframe').src = _this3.builder.opts.otherSelect;
                _this3.builder.opts.assetRefresh = false;
              }
              if (modalFileSelect.querySelector('iframe').src === 'about:blank') {
                modalFileSelect.querySelector('iframe').src = _this3.builder.opts.otherSelect;
              }
              util.showModal(modalFileSelect, false, function () {
                inputSelectOther.removeAttribute('data-focus');
                inputSelectOther.focus();
              }, false, _this3.builder.assetPanelFullScreen);
              inputSelectOther.setAttribute('data-focus', true);
            }
            _this3.builder.targetInput = _this3.cellSettings.querySelector('.input-src'); // used by selectAsset() (see contentbuilder.js)
            _this3.builder.targetCallback = function () {
              _this3.applyClick();
            };
            _this3.builder.targetAssetType = 'all';
            e.preventDefault();
            e.stopImmediatePropagation();
          });
        }
        if (this.builder.opts.largerImageHandler === '' && !this.builder.opts.onLargerImageUpload) {
          this.cellSettings.querySelector('.image-larger4').style.display = 'none';
        }
        if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
          this.divCellClick.querySelector('.input-select').style.display = 'none';
        }

        // Select image (opens Asset Manager plugin or custom dialog)
        if (this.builder.opts.onMediaSelectClick || this.builder.opts.mediaSelect || this.builder.opts.onImageSelectClick || this.builder.opts.imageselect) {
          var _inpSrc = this.cellSettings.querySelector('.input-src');
          elm = this.divCellClick.querySelector('.input-select');
          if (elm) dom.addEventListener(elm, 'click', function () {
            //TODO: Simplify using openAsset

            //---default
            _this3.builder.targetInput = _inpSrc; // used by selectAsset() (see contentbuilder.js)
            _this3.builder.targetCallback = function () {
              _this3.applyClick();
            };
            _this3.builder.targetAssetType = 'media';
            //---/default

            if (_this3.builder.opts.onMediaSelectClick) {
              _this3.builder.opts.onMediaSelectClick({
                targetInput: _inpSrc,
                theTrigger: elm
              });

              // dom.observeElement(inpSrc, 'value', () => {
              //     this.applyClick();
              // });
            } else if (_this3.builder.opts.onImageSelectClick) {
              _this3.builder.opts.onImageSelectClick({
                targetInput: _inpSrc,
                theTrigger: elm
              });

              // dom.observeElement(inpSrc, 'value', () => {
              //     this.applyClick();
              // });
            } else if (_this3.builder.opts.mediaSelect) {
              var modalMediaSelect = builderStuff.querySelector('.is-modal.mediaselect');
              var iframe = modalMediaSelect.querySelector('iframe');
              if (_this3.builder.opts.assetRefresh) {
                iframe.src = _this3.builder.opts.mediaSelect;
                _this3.builder.opts.assetRefresh = false;
              }
              if (iframe.src === 'about:blank') {
                iframe.src = _this3.builder.opts.mediaSelect;
              }
              util.showModal(modalMediaSelect, false, function () {
                elm.removeAttribute('data-focus');
                elm.focus();
              }, false, _this3.builder.assetPanelFullScreen);
              elm.setAttribute('data-focus', true);
              _this3.builder.targetInput = _inpSrc; // used by selectAsset() (see contentbuilder.js)
              _this3.builder.targetCallback = function () {
                _this3.applyClick();
              };
              _this3.builder.targetAssetType = 'media';
            } else if (_this3.builder.opts.imageselect) {
              var modalImageSelect = builderStuff.querySelector('.is-modal.imageselect');
              var _iframe = modalImageSelect.querySelector('iframe');
              if (_this3.builder.opts.assetRefresh) {
                _iframe.src = _this3.builder.opts.imageselect;
                _this3.builder.opts.assetRefresh = false;
              }
              if (_iframe.src === 'about:blank') {
                _iframe.src = _this3.builder.opts.imageselect;
              }
              util.showModal(modalImageSelect, false, function () {
                elm.removeAttribute('data-focus');
                elm.focus();
              }, false, _this3.builder.assetPanelFullScreen);
              elm.setAttribute('data-focus', true);
              _this3.builder.targetInput = _inpSrc; // used by selectAsset() (see contentbuilder.js)
              _this3.builder.targetCallback = function () {
                _this3.applyClick();
              };
              _this3.builder.targetAssetType = 'media';
            }
          });
        }
        var inpSrc = this.cellSettings.querySelector('.input-src');
        dom.observeElement(inpSrc, 'value', function () {
          _this3.applyClick();
        });
        var fileLargerImage2 = this.cellSettings.querySelector('#fileImage4');
        dom.addEventListener(fileLargerImage2, 'change', function (e) {
          var element = fileLargerImage2;
          while (element.nodeName.toLowerCase() !== 'form') {
            element = element.parentNode;
          }
          var frmUpload = element;
          dom.addClass(frmUpload, 'please-wait');
          _this3.cellSettings.querySelector('#hidRefId4').value = _this3.builder.opts.customval;
          if (_this3.builder.opts.onMediaUpload) {
            _this3.builder.opts.onMediaUpload(e);
          } else if (_this3.builder.opts.onLargerImageUpload) {
            _this3.builder.opts.onLargerImageUpload(e);
          } else {
            frmUpload.submit();
          }
          fileLargerImage2.value = ''; // Clear Input
        });

        var inpClickSrc = this.cellSettings.querySelector('.input-src');
        inpClickSrc.addEventListener('focus', function () {
          _this3.builder.uo.saveForUndo(true); // checkLater = true
        });
        // this.util.attachInputTextClear(inpClickSrc);

        inpClickSrc.addEventListener('keyup', function () {
          var cell = _this3.util.cellSelected();
          if (!cell) return;
          if (inpClickSrc.value === '') {
            // Remove click
            dom.removeClass(cell, 'block-click');
            cell.removeAttribute('data-modal-url');
          } else {
            dom.addClass(cell, 'block-click');
            cell.setAttribute('data-modal-url', inpClickSrc.value);
          }
          _this3.builder.opts.onChange();
        });
        var btnTestClick = this.cellSettings.querySelector('.input-testclick');
        btnTestClick.addEventListener('click', function () {
          var cell = _this3.util.cellSelected();
          if (!cell) return;
          if (inpClickSrc.value === '') return;
          _this3.builder.openMedia(cell);
        });

        // Responsive Visibility

        var btns = this.cellSettings.querySelectorAll('.input-device');
        btns.forEach(function (btn) {
          btn.addEventListener('click', function () {
            var cell = _this3.util.cellSelected();
            if (!cell) return;
            var elms = _this3.cellSettings.querySelectorAll('.input-device');
            elms.forEach(function (elm) {
              elm.classList.remove('on');
            });
            btn.classList.add('on');
            _this3.realtimeVisibility(cell);
          });
        });
        var btnVisible = this.cellSettings.querySelector('.input-visible');
        var btnHidden = this.cellSettings.querySelector('.input-hidden');
        var rowHasHiddenColumns = function rowHasHiddenColumns(row, target) {
          var cols = row.querySelectorAll(".".concat(target, "-hidden"));
          return cols.length > 0;
        };
        btnVisible.addEventListener('click', function () {
          var cell = _this3.util.cellSelected();
          if (!cell) return;
          _this3.builder.uo.saveForUndo();
          cell.classList.remove('hideonmobile');
          var divTarget = _this3.cellSettings.querySelector('.div-target');
          var target = _this3.builder.responsive.readTarget(divTarget);
          if (target === 'xs') {
            cell.classList.remove('xs-hidden');
          } else if (target === 'sm') {
            cell.classList.remove('sm-hidden');
            if (!rowHasHiddenColumns(cell.parentNode, 'sm')) cell.parentNode.classList.remove('sm-autofit');
          } else if (target === 'md') {
            cell.classList.remove('md-hidden');
            if (!rowHasHiddenColumns(cell.parentNode, 'md')) cell.parentNode.classList.remove('md-autofit');
          } else if (target === '') {
            cell.classList.remove('desktop-hidden');
            if (!rowHasHiddenColumns(cell.parentNode, 'desktop')) cell.parentNode.classList.remove('desktop-autofit');
          }
          btnVisible.classList.add('on');
          btnHidden.classList.remove('on');
          _this3.builder.opts.onChange();
        });
        btnHidden.addEventListener('click', function () {
          var cell = _this3.util.cellSelected();
          if (!cell) return;
          _this3.builder.uo.saveForUndo();
          cell.classList.remove('hideonmobile');
          var divTarget = _this3.cellSettings.querySelector('.div-target');
          var target = _this3.builder.responsive.readTarget(divTarget);
          if (target === 'xs') {
            cell.classList.add('xs-hidden');
          } else if (target === 'sm') {
            cell.classList.add('sm-hidden');
            cell.parentNode.classList.add('sm-autofit');
          } else if (target === 'md') {
            cell.classList.add('md-hidden');
            cell.parentNode.classList.add('md-autofit');
          } else if (target === '') {
            cell.classList.add('desktop-hidden');
            cell.parentNode.classList.add('desktop-autofit');
          }
          btnVisible.classList.remove('on');
          btnHidden.classList.add('on');
          _this3.builder.opts.onChange();
        });
        new tabs({
          element: cellSettings
        });
        new contentbuilder_draggable({
          selector: '.is-modal.columnsettings .is-draggable'
        });
      }
    }
  }, {
    key: "moveColumnLeft",
    value: function moveColumnLeft() {
      this.grid.moveColumnPrevious();
    }
  }, {
    key: "moveColumnRight",
    value: function moveColumnRight() {
      this.grid.moveColumnNext();
    }
  }, {
    key: "duplicateColumn",
    value: function duplicateColumn() {
      this.grid.duplicateColumn();
    }
  }, {
    key: "removeColumn",
    value: function removeColumn() {
      this.grid.removeColumn();
    }
  }, {
    key: "moveColumnUp",
    value: function moveColumnUp() {
      this.grid.moveColumnUp();
    }
  }, {
    key: "moveColumnDown",
    value: function moveColumnDown() {
      this.grid.moveColumnDown();
    }
  }, {
    key: "applyClick",
    value: function applyClick() {
      var dom = this.dom;
      var cell = this.util.cellSelected();
      if (!cell) return;
      var inpSrc = this.cellSettings.querySelector('.input-src');
      var currValue = cell.getAttribute('data-modal-url');
      if (!currValue) currValue = '';
      var newValue = inpSrc.value;
      if (currValue === newValue) return;
      this.builder.uo.saveForUndo();
      dom.addClass(cell, 'block-click');
      cell.setAttribute('data-modal-url', inpSrc.value);
      this.builder.opts.onChange();
    }
  }, {
    key: "readCellStyles",
    value: function readCellStyles(cell) {
      var dom = this.dom;
      this.util.clearActiveElement();

      // Background color
      var s = cell.style.backgroundColor;
      var btn = this.cellSettings.querySelector('.input-cell-bgcolor');
      if (s) btn.style.backgroundColor = s;else btn.style.backgroundColor = 'transparent';
      var imgUrl = '';
      var div = this.cellSettings.querySelector('.cell-bgimage-preview');
      var btnImageAdjust = this.cellSettings.querySelector('.input-cell-bgimageadjust');
      btnImageAdjust.style.display = 'none';
      var btnImageRemove = this.cellSettings.querySelector('.input-cell-bgremove');
      btnImageRemove.style.display = 'none';
      if (cell.style.backgroundImage) {
        if (cell.style.backgroundImage.indexOf('url(') !== -1) {
          imgUrl = cell.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
          div.innerHTML = "<img src=\"".concat(imgUrl, "\">");
          btnImageAdjust.style.display = 'flex';
          btnImageRemove.style.display = 'flex';
        } else {
          div.innerHTML = '';
        }
      } else {
        div.innerHTML = '';
      }
      var inpClickSrc = this.cellSettings.querySelector('.input-src');
      inpClickSrc.value = '';
      var clickUrl = cell.getAttribute('data-modal-url');
      if (clickUrl) {
        inpClickSrc.value = clickUrl;
      }
      var elms = this.cellSettings.querySelectorAll('.input-cell-padding');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'on');
      });
      if (dom.hasClass(cell, 'padding-0')) {
        var _btn9 = this.cellSettings.querySelector('.input-cell-padding[data-command="0"');
        dom.addClass(_btn9, 'on');
      } else if (dom.hasClass(cell, 'padding-10')) {
        var _btn10 = this.cellSettings.querySelector('.input-cell-padding[data-command="10"');
        dom.addClass(_btn10, 'on');
      } else if (dom.hasClass(cell, 'padding-20')) {
        var _btn11 = this.cellSettings.querySelector('.input-cell-padding[data-command="20"');
        dom.addClass(_btn11, 'on');
      } else if (dom.hasClass(cell, 'padding-30')) {
        var _btn12 = this.cellSettings.querySelector('.input-cell-padding[data-command="30"');
        dom.addClass(_btn12, 'on');
      } else if (dom.hasClass(cell, 'padding-40')) {
        var _btn13 = this.cellSettings.querySelector('.input-cell-padding[data-command="40"');
        dom.addClass(_btn13, 'on');
      } else if (dom.hasClass(cell, 'padding-50')) {
        var _btn14 = this.cellSettings.querySelector('.input-cell-padding[data-command="50"');
        dom.addClass(_btn14, 'on');
      }
      var chkCellGrayscale = this.cellSettings.querySelector('.chk-cell-grayscale');
      chkCellGrayscale.checked = false;
      if (cell.style.filter) {
        if (cell.style.filter.indexOf('grayscale') !== -1) {
          chkCellGrayscale.checked = true;
        }
      }
      var chkHideColumnOnMobile = this.cellSettings.querySelector('.chk-cell-hideonmobile');
      chkHideColumnOnMobile.checked = false;
      if (cell.classList.contains('hideonmobile')) {
        chkHideColumnOnMobile.checked = true;
      }
      elms = this.cellSettings.querySelectorAll('.input-cell-height');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'on');
      });
      var minHeight = 0;
      var arrHeight = this.builder.colHeight;
      Array.prototype.forEach.call(arrHeight, function (h) {
        if (dom.hasClass(cell, 'min-height-' + h)) minHeight = h;
      });
      if (minHeight === 300) {
        var _btn15 = this.cellSettings.querySelector('.input-cell-height[data-command="300"');
        dom.addClass(_btn15, 'on');
      } else if (minHeight === 400) {
        var _btn16 = this.cellSettings.querySelector('.input-cell-height[data-command="400"');
        dom.addClass(_btn16, 'on');
      } else if (minHeight === 500) {
        var _btn17 = this.cellSettings.querySelector('.input-cell-height[data-command="500"');
        dom.addClass(_btn17, 'on');
      } else if (minHeight === 600) {
        var _btn18 = this.cellSettings.querySelector('.input-cell-height[data-command="600"');
        dom.addClass(_btn18, 'on');
      } else if (minHeight === 700) {
        var _btn19 = this.cellSettings.querySelector('.input-cell-height[data-command="700"');
        dom.addClass(_btn19, 'on');
      }
      elms = this.cellSettings.querySelectorAll('.cmd-content-pos');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'on');
      });
      var alignItems = cell.style.alignItems;
      var justifyContent = cell.style.justifyContent;
      var pos = '';
      if (justifyContent === 'flex-start') {
        //top
        if (alignItems === 'flex-start') {
          pos = 'topleft';
        } else if (alignItems === 'center') {
          pos = 'topcenter';
        } else if (alignItems === 'flex-end') {
          pos = 'topright';
        }
      } else if (justifyContent === 'center') {
        //top
        if (alignItems === 'flex-start') {
          pos = 'centerleft';
        } else if (alignItems === 'center') {
          pos = 'center';
        } else if (alignItems === 'flex-end') {
          pos = 'centerright';
        }
      } else if (justifyContent === 'flex-end') {
        //top
        if (alignItems === 'flex-start') {
          pos = 'bottomleft';
        } else if (alignItems === 'center') {
          pos = 'bottomcenter';
        } else if (alignItems === 'flex-end') {
          pos = 'bottomright';
        }
      }
      if (pos === 'topleft') {
        var _btn20 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="topleft"');
        dom.addClass(_btn20, 'on');
      } else if (pos === 'topcenter') {
        var _btn21 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="topcenter"');
        dom.addClass(_btn21, 'on');
      } else if (pos === 'topright') {
        var _btn22 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="topright"');
        dom.addClass(_btn22, 'on');
      } else if (pos === 'centerleft') {
        var _btn23 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="centerleft"');
        dom.addClass(_btn23, 'on');
      } else if (pos === 'center') {
        var _btn24 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="center"');
        dom.addClass(_btn24, 'on');
      } else if (pos === 'centerright') {
        var _btn25 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="centerright"');
        dom.addClass(_btn25, 'on');
      } else if (pos === 'bottomleft') {
        var _btn26 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="bottomleft"');
        dom.addClass(_btn26, 'on');
      } else if (pos === 'bottomcenter') {
        var _btn27 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="bottomcenter"');
        dom.addClass(_btn27, 'on');
      } else if (pos === 'bottomright') {
        var _btn28 = this.cellSettings.querySelector('.cmd-content-pos[data-pos="bottomright"');
        dom.addClass(_btn28, 'on');
      }
      this.realtimeVisibility(cell, true);

      //More
      var inpCellId = this.cellSettings.querySelector('.input-cell-id');
      inpCellId.value = '';
      var rowId = cell.getAttribute('id');
      if (rowId) {
        inpCellId.value = rowId;
      }
      var inpCellClasses = this.cellSettings.querySelector('.input-cell-classes');
      inpCellClasses.value = '';
      var classes = cell.getAttribute('data-class');
      inpCellClasses.value = classes;
    }
  }, {
    key: "realtimeVisibility",
    value: function realtimeVisibility(cell, initialOpen) {
      if (initialOpen) {
        var builderStuff = this.builder.builderStuff;
        var modal = builderStuff.querySelector('.is-modal.content-preview.active');
        if (modal) {
          var elms = this.cellSettings.querySelectorAll('.input-device');
          elms.forEach(function (elm) {
            elm.classList.remove('on');
          });
          if (modal.classList.contains('is-screen-1920')) {
            this.cellSettings.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1440')) {
            this.cellSettings.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1024')) {
            this.cellSettings.querySelector('.input-device[data-value="md"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-768')) {
            this.cellSettings.querySelector('.input-device[data-value="sm"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-375')) {
            this.cellSettings.querySelector('.input-device[data-value="xs"]').classList.add('on');
          }
        }
      }
      var divTarget = this.cellSettings.querySelector('.div-target');
      var divVisibility = this.cellSettings.querySelector('.div-visibility');
      var target = this.builder.responsive.readTarget(divTarget);
      var valVisibility = this.builder.responsive.getVisibility(cell, target);
      this.builder.responsive.showVisibility(divVisibility, valVisibility);

      // Live Preview Sync
      if (target === 'xs') {
        if (!initialOpen) this.builder.livePreview.resizePreview(375);
      } else if (target === 'sm') {
        if (!initialOpen) this.builder.livePreview.resizePreview(768);
      } else if (target === 'md') {
        if (!initialOpen) this.builder.livePreview.resizePreview(1024);
      } else {
        if (!initialOpen) this.builder.livePreview.resizePreview(1920);
      }
    }
  }, {
    key: "openImagePicker",
    value: function openImagePicker(currentUrl, callback, btn) {
      //Current value
      var imageSource = this.imageSource;
      var inpSrc = imageSource.querySelector('.input-src');
      inpSrc.value = currentUrl;

      //imageSelectedCallback
      this.builder.imageSelectedCallback = callback;

      //Show modal
      imageSource.style.zIndex = '10005';
      this.util.showModal(imageSource, false, function () {
        if (btn) {
          btn.removeAttribute('data-focus');
          btn.focus();
        }
      }, false, this.builder.assetPanelFullScreen);
      if (btn) btn.setAttribute('data-focus', true);
    }
  }, {
    key: "readImageAdjust",
    value: function readImageAdjust(elm, useTarget) {
      //Current value
      var imageAdjust = this.imageAdjust;
      var inpImageScaleSlider = imageAdjust.querySelector('.image-scale-slider');
      var inpImageHorSlider = imageAdjust.querySelector('.image-hor-slider');
      var inpImageVertSlider = imageAdjust.querySelector('.image-vert-slider');
      inpImageScaleSlider.value = 100;
      inpImageHorSlider.value = 0;
      inpImageVertSlider.value = 0;
      inpImageScaleSlider.disabled = false;
      if (useTarget) {
        inpImageHorSlider.value = 50;
        inpImageVertSlider.value = 60;
      }
      var div = document.createElement('div');
      if (document.querySelector('.content-preview.is-screen-375.active') && useTarget) {
        var dataBg = elm.getAttribute('data-bg-xs');
        if (!dataBg) dataBg = '';
        div.style.cssText = dataBg;
        inpImageScaleSlider.disabled = true;
        inpImageScaleSlider.style.opacity = 0.6;
      } else if (document.querySelector('.content-preview.is-screen-768.active') && useTarget) {
        var _dataBg7 = elm.getAttribute('data-bg-sm');
        if (!_dataBg7) _dataBg7 = '';
        div.style.cssText = _dataBg7;
        inpImageScaleSlider.disabled = true;
        inpImageScaleSlider.style.opacity = 0.6;
      } else if (document.querySelector('.content-preview.is-screen-1024.active') && useTarget) {
        var _dataBg8 = elm.getAttribute('data-bg-md');
        if (!_dataBg8) _dataBg8 = '';
        div.style.cssText = _dataBg8;
        inpImageScaleSlider.disabled = true;
        inpImageScaleSlider.style.opacity = 0.6;
      } else {
        div.style.cssText = elm.style.cssText;
        inpImageScaleSlider.disabled = false;
        inpImageScaleSlider.style.opacity = '';
      }
      if (div.style.backgroundSize) {
        var val;
        var bgSize = div.style.backgroundSize;
        if (isNaN(parseInt(bgSize))) {
          val = 100;
        } else {
          val = parseInt(bgSize);
        }
        if (bgSize.indexOf('%') !== -1) {
          inpImageScaleSlider.value = val;
        }
      }
      if (div.style.backgroundPositionX) {
        var _val;
        var bgPosX = div.style.backgroundPositionX;
        if (isNaN(parseInt(bgPosX))) {
          _val = 0;
        } else {
          _val = parseInt(bgPosX);
        }
        if (bgPosX.indexOf('%') !== -1) {
          inpImageHorSlider.value = _val;
        }
      }
      if (div.style.backgroundPositionY) {
        var _val2;
        var bgPosY = div.style.backgroundPositionY;
        if (isNaN(parseInt(bgPosY))) {
          _val2 = 0;
        } else {
          _val2 = parseInt(bgPosY);
        }
        if (bgPosY.indexOf('%') !== -1) {
          inpImageVertSlider.value = _val2;
        }
      }

      //elementSelected
      this.builder.elementSelected = elm;
    }
  }, {
    key: "openImageAdjust",
    value: function openImageAdjust(elm, btn, useTarget) {
      if (useTarget) this.useTarget = true;else this.useTarget = false;
      var divTarget = this.imageAdjust.querySelector('.div-target');
      if (useTarget) {
        divTarget.style.display = 'flex';
      } else {
        divTarget.style.display = 'none';
      }
      var modal = this.builderStuff.querySelector('.is-modal.content-preview');
      var elms = this.imageAdjust.querySelectorAll('.input-device');
      elms.forEach(function (elm) {
        elm.classList.remove('on');
      });
      if (!modal.classList.contains('active')) {
        this.imageAdjust.querySelector('.input-device[data-value=""]').classList.add('on');
      }
      this.readImageAdjust(elm, useTarget);

      //Show modal
      this.imageAdjust.style.zIndex = '10005';
      this.util.showModal(this.imageAdjust, false, function () {
        if (btn) {
          btn.removeAttribute('data-focus');
          btn.focus();
        }
      });
      if (btn) btn.setAttribute('data-focus', true);
      this.realtimeImageAdjust(true);
    }
  }, {
    key: "realtimeImageAdjust",
    value: function realtimeImageAdjust(initialOpen) {
      if (initialOpen) {
        var builderStuff = this.builder.builderStuff;
        var modal = builderStuff.querySelector('.is-modal.content-preview.active');
        if (modal) {
          var elms = this.imageAdjust.querySelectorAll('.input-device');
          elms.forEach(function (elm) {
            elm.classList.remove('on');
          });
          if (modal.classList.contains('is-screen-1920')) {
            this.imageAdjust.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1440')) {
            this.imageAdjust.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1024')) {
            this.imageAdjust.querySelector('.input-device[data-value="md"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-768')) {
            this.imageAdjust.querySelector('.input-device[data-value="sm"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-375')) {
            this.imageAdjust.querySelector('.input-device[data-value="xs"]').classList.add('on');
          }
        }
      }
      var divTarget = this.imageAdjust.querySelector('.div-target');
      var target = this.builder.responsive.readTarget(divTarget);

      // Live Preview Sync
      if (target === 'xs') {
        if (!initialOpen) this.builder.livePreview.resizePreview(375);
      } else if (target === 'sm') {
        if (!initialOpen) this.builder.livePreview.resizePreview(768);
      } else if (target === 'md') {
        if (!initialOpen) this.builder.livePreview.resizePreview(1024);
      } else {
        if (!initialOpen) this.builder.livePreview.resizePreview(1920);
      }
    }
  }, {
    key: "resetImage",
    value: function resetImage(elm) {
      //Current value
      var imageAdjust = this.imageAdjust;
      var inpImageScaleSlider = imageAdjust.querySelector('.image-scale-slider');
      var inpImageHorSlider = imageAdjust.querySelector('.image-hor-slider');
      var inpImageVertSlider = imageAdjust.querySelector('.image-vert-slider');
      inpImageHorSlider.value = 50;
      inpImageVertSlider.value = 60;
      inpImageScaleSlider.value = 0;
      if (elm.classList.contains('cell-active') || elm.classList.contains('is-row-overlay')) {
        inpImageHorSlider.value = 0;
        inpImageVertSlider.value = 0;
      }
      elm.style.backgroundPositionX = '';
      elm.style.backgroundPositionY = '';
      elm.style.backgroundSize = 'cover';

      // Clean unused
      elm.style.left = '';
      elm.style.top = '';
      elm.style.width = '';
      elm.style.height = '';
      elm.removeAttribute('data-x');
      elm.removeAttribute('data-y');
      elm.removeAttribute('data-scale');
      elm.removeAttribute('data-bg-xs');
      elm.removeAttribute('data-bg-sm');
      elm.removeAttribute('data-bg-md');
    }
  }, {
    key: "resetImage2",
    value: function resetImage2(elm) {
      var _this4 = this;
      //Current value
      var imageAdjust2 = this.imageAdjust2;
      var inpImageScaleSlider = imageAdjust2.querySelector('.image-scale-slider');
      var inpImageHorSlider = imageAdjust2.querySelector('.image-hor-slider');
      var inpImageVertSlider = imageAdjust2.querySelector('.image-vert-slider');
      var overlayDimension = {
        width: elm.parentNode.offsetWidth,
        height: elm.parentNode.offsetHeight
      };
      var dimension, image;
      image = new Image();
      image.src = elm.style.backgroundImage.replace(/"/g, '').replace(/url\(|\)$/ig, '');
      image.onload = function () {
        dimension = {
          width: image.naturalWidth,
          height: image.naturalHeight
        };
        _this4.dimension = dimension;
        if (overlayDimension.width / overlayDimension.height <= dimension.width / dimension.height) {
          _this4.scaleWidth = true;
          _this4.scaleHeight = false;

          // let h = overlayDimension.height; //px
          var w = overlayDimension.height * (dimension.width / dimension.height);
          w = w / overlayDimension.width * 100; //%

          if (!elm.style.width) {
            elm.style.width = w + '%';
            elm.style.height = '';
          }
          inpImageScaleSlider.min = w;
          var val = -(w - 100) * 0.5;
          inpImageHorSlider.value = val; //50%
          elm.style.left = val + '%';
          elm.setAttribute('data-x', val);
          inpImageVertSlider.value = 0;
          elm.style.top = '0%';
          elm.setAttribute('data-y', 0);
          inpImageScaleSlider.value = w;
          elm.style.width = w + '%';
          elm.setAttribute('data-scale', w);
          elm.style.height = '100%'; //((w*this.dimension.height)/this.dimension.width) + '%';
        } else {
          _this4.scaleHeight = true;
          _this4.scaleWidth = false;

          // let w = overlayDimension.width;
          var h = overlayDimension.width * (dimension.height / dimension.width);
          h = h / overlayDimension.height * 100; //%

          if (!elm.style.height) {
            elm.style.height = h + '%';
            elm.style.width = '';
          }
          inpImageScaleSlider.min = h;
          var _val3 = -(h - 100) * 0.6;
          inpImageVertSlider.value = _val3; //60%
          elm.style.top = _val3 + '%';
          elm.setAttribute('data-y', _val3);
          inpImageHorSlider.value = 0;
          elm.style.left = '0%';
          elm.setAttribute('data-x', 0);
          inpImageScaleSlider.value = h;
          elm.style.height = h + '%';
          elm.setAttribute('data-scale', h);
          elm.style.width = '100%'; //((h*this.dimension.width)/this.dimension.height) + '%';
        }
      };
    }
  }, {
    key: "openImageAdjust2",
    value: function openImageAdjust2(elm, btn) {
      var _this5 = this;
      //Current value
      var imageAdjust2 = this.imageAdjust2;
      var inpImageScaleSlider = imageAdjust2.querySelector('.image-scale-slider');
      var inpImageHorSlider = imageAdjust2.querySelector('.image-hor-slider');
      var inpImageVertSlider = imageAdjust2.querySelector('.image-vert-slider');
      inpImageScaleSlider.value = 0;
      inpImageHorSlider.value = 0;
      inpImageVertSlider.value = 15;
      var scale = elm.getAttribute('data-scale');
      if (scale) {
        inpImageScaleSlider.value = scale;
      }
      var posX = elm.getAttribute('data-x');
      if (posX) {
        inpImageHorSlider.value = posX;
      }
      var posY = elm.getAttribute('data-y');
      if (posY) {
        inpImageVertSlider.value = posY;
      }
      var overlayDimension = {
        width: elm.parentNode.offsetWidth,
        height: elm.parentNode.offsetHeight
      };
      // console.log(overlayDimension);
      var dimension, image;
      image = new Image();
      image.src = elm.style.backgroundImage.replace(/"/g, '').replace(/url\(|\)$/ig, '');
      image.onload = function () {
        dimension = {
          width: image.naturalWidth,
          height: image.naturalHeight
        };
        _this5.dimension = dimension;
        // console.log(dimension)
        if (overlayDimension.width / overlayDimension.height <= dimension.width / dimension.height) {
          _this5.scaleWidth = true;
          _this5.scaleHeight = false;

          // let h = overlayDimension.height; //px
          var w = overlayDimension.height * (dimension.width / dimension.height);
          w = w / overlayDimension.width * 100; //%

          if (!elm.style.width) {
            elm.style.width = w + '%';
            elm.style.height = '';
          }
          inpImageScaleSlider.min = w;
          if (!posX) {
            inpImageHorSlider.value = -(w - 100) * 0.5; //50%
            elm.style.left = -(w - 100) * 0.5 + '%';
            inpImageVertSlider.value = 0;
          }
          var _scale = elm.getAttribute('data-scale');
          if (!_scale) {
            inpImageScaleSlider.value = w;
          }
        } else {
          _this5.scaleHeight = true;
          _this5.scaleWidth = false;

          // let w = overlayDimension.width;
          var h = overlayDimension.width * (dimension.height / dimension.width);
          h = h / overlayDimension.height * 100; //%

          if (!elm.style.height) {
            elm.style.height = h + '%';
            elm.style.width = '';
          }
          inpImageScaleSlider.min = h;
          if (!posY) {
            inpImageVertSlider.value = -(h - 100) * 0.6; //60%
            elm.style.top = -(h - 100) * 0.6 + '%';
            inpImageHorSlider.value = 0;
          }
          var _scale2 = elm.getAttribute('data-scale');
          if (!_scale2) {
            inpImageScaleSlider.value = h;
          }
        }
      };

      // const imageAdjust2 = this.imageAdjust2;
      // const inpImageScaleSlider = imageAdjust2.querySelector('.image-scale-slider');
      // const inpImageHorSlider = imageAdjust2.querySelector('.image-hor-slider');
      // const inpImageVertSlider = imageAdjust2.querySelector('.image-vert-slider');
      // inpImageScaleSlider.value = 100;
      // inpImageHorSlider.value = 0;
      // inpImageVertSlider.value = 0;

      // if(elm.style.backgroundSize) {
      //     let val;
      //     let bgSize = elm.style.backgroundSize;
      //     if(isNaN(parseInt(bgSize))) {
      //         val = 100;
      //     } else {
      //         val = parseInt(bgSize);
      //     }
      //     if(bgSize.indexOf('%')!==-1) {
      //         inpImageScaleSlider.value = val;
      //     }
      // }

      // if(elm.style.backgroundPositionX) {
      //     let val;
      //     let bgPosX = elm.style.backgroundPositionX;
      //     if(isNaN(parseInt(bgPosX))) {
      //         val = 0;
      //     } else {
      //         val = parseInt(bgPosX);
      //     }
      //     if(bgPosX.indexOf('%')!==-1) {
      //         inpImageHorSlider.value = val;
      //     }
      // }

      // if(elm.style.backgroundPositionY) {
      //     let val;
      //     let bgPosY = elm.style.backgroundPositionY;
      //     if(isNaN(parseInt(bgPosY))) {
      //         val = 0;
      //     } else {
      //         val = parseInt(bgPosY);
      //     }
      //     if(bgPosY.indexOf('%')!==-1) {
      //         inpImageVertSlider.value = val;
      //     }
      // }

      // let img = elm.querySelector('img');
      // if(!img) {

      //     let oFitPosX = 0;
      //     let oFitPosY = 0;
      //     if(elm.style.backgroundPositionX) {
      //         let val;
      //         let bgPosX = elm.style.backgroundPositionX;
      //         if(isNaN(parseInt(bgPosX))) {
      //             val = 0;
      //         } else {
      //             val = parseInt(bgPosX);
      //         }
      //         if(bgPosX.indexOf('%')!==-1) {
      //             inpImageHorSlider.value = val;
      //             oFitPosX = val;
      //         }
      //     }

      //     if(elm.style.backgroundPositionY) {
      //         let val;
      //         let bgPosY = elm.style.backgroundPositionY;
      //         if(isNaN(parseInt(bgPosY))) {
      //             val = 0;
      //         } else {
      //             val = parseInt(bgPosY);
      //         }
      //         if(bgPosY.indexOf('%')!==-1) {
      //             inpImageVertSlider.value = val;
      //             oFitPosY = val;
      //         }
      //     }

      //     const src = elm.style.backgroundImage.replace(/"/g,"").replace(/url\(|\)$/ig, "");
      //     elm.innerHTML = '';
      //     img = document.createElement('img');
      //     img.setAttribute('src', src);
      //     elm.appendChild(img);
      //     img.style.opacity = 0.0001;
      //     img.style.width = '100%';
      //     img.style.height = '100%';
      //     img.style.objectFit = 'cover';
      //     img.style.objectPosition = `${oFitPosX}% ${oFitPosY}%`
      // } else {
      //     let x = img.style.objectPosition.split(' ')[0].replace('%','');
      //     let y = img.style.objectPosition.split(' ')[1].replace('%','');

      //     inpImageHorSlider.value = x;
      //     inpImageVertSlider.value = y;
      // }

      //elementSelected
      this.builder.elementSelected = elm;

      //Show modal
      imageAdjust2.style.zIndex = '10005';
      this.util.showModal(imageAdjust2, false, function () {
        if (btn) {
          btn.removeAttribute('data-focus');
          btn.focus();
        }
      });
      if (btn) btn.setAttribute('data-focus', true);
    }
  }, {
    key: "showHideLockIndicator",
    value: function showHideLockIndicator(col) {
      var lockIndicator = this.lockIndicator;
      if (col.hasAttribute('data-noedit')) {
        // const top = col.getBoundingClientRect().top + window.pageYOffset;
        // const left = col.getBoundingClientRect().left + window.pageXOffset;

        var top, left;
        if (!this.builder.iframe) {
          top = col.getBoundingClientRect().top + window.pageYOffset;
          left = col.getBoundingClientRect().left + window.pageXOffset;
        } else {
          top = col.getBoundingClientRect().top + this.builder.win.pageYOffset;
          left = col.getBoundingClientRect().left + this.builder.win.pageXOffset;
        }
        var w = col.offsetWidth * this.builder.zoom;
        // const h = col.offsetHeight * this.builder.zoom;
        lockIndicator.style.display = 'flex';
        lockIndicator.style.top = top + 4 + 'px';
        lockIndicator.style.left = left + w - 33 + 'px';
      } else {
        lockIndicator.style.display = '';
      }
    }
  }, {
    key: "click",
    value: function click(col) {
      this.columnTool = col.parentNode.querySelector('.is-col-tool');
      this.columnTool.style.left = col.offsetLeft + 'px';
      this.columnTool.style.top = col.offsetTop + 'px';
      var btnAdd = this.columnTool.querySelector('.cell-add');
      var btnRemove = this.columnTool.querySelector('.cell-remove');
      var btnMore = this.columnTool.querySelector('.cell-more');
      var nogrid = col.closest('[nogrid]');
      if (nogrid) {
        btnAdd.style.display = 'none';
        btnRemove.style.display = 'none';
        btnAdd.setAttribute('disabled', 'disabled');
        btnRemove.setAttribute('disabled', 'disabled');
        if (col.getAttribute('data-html')) {
          btnMore.style.display = 'none';
          btnMore.setAttribute('disabled', 'disabled');
        }
      } else {
        btnAdd.style.display = '';
        btnRemove.style.display = '';
        btnAdd.removeAttribute('disabled');
        btnRemove.removeAttribute('disabled');
      }
      var row = col.parentNode;

      //data-protected
      if (row.hasAttribute('data-protected')) {
        row.querySelector('.is-row-tool').style.display = 'none';
        this.columnTool.style.display = 'none'; // if row protected, then all column protected

        var rowaddtool = row.querySelector('.is-rowadd-tool');
        if (rowaddtool) {
          rowaddtool.style.display = 'none';
        }
      } else {
        this.columnTool.style.display = '';
        //check columnTool buttons if need to show or hide
        var _protected = col.closest('[data-protected]');
        if (_protected) {
          btnAdd.style.display = 'none';
          btnRemove.style.display = 'none';
          btnMore.style.display = 'none';
        } else {
          btnAdd.style.display = '';
          btnRemove.style.display = '';
          btnMore.style.display = '';
        }
      }
      if (col.classList.contains('column-lock')) {
        btnAdd.style.display = 'none';
        btnRemove.style.display = 'none';
      }
    }
  }]);
  return ColumnTool;
}();
/* harmony default export */ const columntool = (ColumnTool);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-css.js
function elementpanel_css_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_css_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_css_typeof(obj); }
function elementpanel_css_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_css_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_css_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_css_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_css_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_css_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_css_toPropertyKey(arg) { var key = elementpanel_css_toPrimitive(arg, "string"); return elementpanel_css_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_css_toPrimitive(input, hint) { if (elementpanel_css_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_css_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var elementpanel_css_dom = new Dom();
var ELementStyleEditor = /*#__PURE__*/function () {
  function ELementStyleEditor(builder) {
    var _this = this;
    elementpanel_css_classCallCheck(this, ELementStyleEditor);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var modalStyles = builderStuff.querySelector('.editstyles');
    if (!modalStyles) {
      var html = "\n            <div class=\"is-modal is-modal-content editstyles\">\n                <div class=\"is-modal-bar is-draggable\">\n                    <div class=\"is-modal-close\" role=\"button\" tabindex=\"0\" title=\"".concat(util.out('Close'), "\">&#10005;</div>\n                </div>\n                <div style=\"padding:12px\">\n                    <div class=\"is-settings\" style=\"display:inline-block;width:100%;margin-bottom:0;\">\n                        <div>").concat(util.out('Style'), ":</div>\n                        <div>\n                            <textarea id=\"inpElmInlineStyle\" style=\"width:100%;height:256px;margin:0px;border:none;font-size: 14px;line-height: 1.5;letter-spacing: 0;\"></textarea>\n                        </div>\n                    </div>\n                    <div class=\"is-settings\" style=\"display:inline-block;width:100%;margin-bottom:0;\">\n                        <div>").concat(util.out('Class'), ":</div>\n                        <div>\n                            <input type=\"text\" id=\"inpElmClassName\" value=\"\" style=\"width:100%;padding-left: 16px;font-family: courier, monospace;font-size: 14px;line-height: 2;letter-spacing: 1px;border:none;\"/>\n                        </div>\n                    </div>\n                </div>\n            </div>           \n            ");
      elementpanel_css_dom.appendHtml(builderStuff, html);
      modalStyles = builderStuff.querySelector('.editstyles');
      var btn = modalStyles.querySelector('.is-modal-close');
      elementpanel_css_dom.addEventListener(btn, 'click', function () {
        elementpanel_css_dom.removeClass(modalStyles, 'active');
        var panel = _this.builderStuff.querySelector('.is-side.elementstyles'); // if all close
        if (!elementpanel_css_dom.hasClass(panel, 'active')) {
          var elms = document.querySelectorAll('[data-saveforundo]');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.removeAttribute('data-saveforundo');
          });
          elms = document.querySelectorAll('.elm-inspected');
          Array.prototype.forEach.call(elms, function (elm) {
            elementpanel_css_dom.removeClass(elm, 'elm-inspected');
          });
        }
      });
      var inp = modalStyles.querySelector('#inpElmClassName');
      inp.addEventListener('keyup', function () {
        var elm = _this.builder.inspectedElement;
        var val = modalStyles.querySelector('#inpElmClassName').value;

        //builder classes
        var bElmActive = false;
        if (elementpanel_css_dom.hasClass(elm, 'elm-active')) {
          bElmActive = true;
        }
        var bCellActive = false;
        if (elementpanel_css_dom.hasClass(elm, 'elm-active')) {
          bCellActive = true;
        }
        var bRowActive = false;
        if (elementpanel_css_dom.hasClass(elm, 'row-active')) {
          bRowActive = true;
        }
        elm.setAttribute('class', val); //update

        //builder classes
        if (bElmActive) elementpanel_css_dom.addClass(elm, 'elm-active');
        if (bCellActive) elementpanel_css_dom.addClass(elm, 'cell-active');
        if (bRowActive) elementpanel_css_dom.addClass(elm, 'row-active');
        elementpanel_css_dom.addClass(elm, 'elm-inspected');

        //Trigger Change event
        _this.builder.opts.onChange();
      });
      inp = modalStyles.querySelector('#inpElmInlineStyle');
      inp.addEventListener('keyup', function () {
        _this.builder.inspectedElement.style.cssText = modalStyles.querySelector('#inpElmInlineStyle').value;

        //Trigger Change event
        _this.builder.opts.onChange();
      });
    }
    this.modalStyles = modalStyles;
  }
  elementpanel_css_createClass(ELementStyleEditor, [{
    key: "toggleStyleEditor",
    value: function toggleStyleEditor() {
      if (!elementpanel_css_dom.hasClass(this.modalStyles, 'active')) {
        elementpanel_css_dom.addClass(this.modalStyles, 'active');
      } else {
        elementpanel_css_dom.removeClass(this.modalStyles, 'active');
      }
    }
  }, {
    key: "refresh",
    value: function refresh() {
      this.modalStyles.querySelector('#inpElmInlineStyle').value = this.builder.inspectedElement.style.cssText;
      var s = this.builder.inspectedElement.getAttribute('class');
      if (s) {
        s = s.replace('elm-active', '');
        s = s.replace('cell-active', '');
        s = s.replace('row-active', '');
        s = s.replace('elm-inspected', '');
        s = s.replace('  ', ' ').trim();
      }
      this.modalStyles.querySelector('#inpElmClassName').value = s;
    }
  }]);
  return ELementStyleEditor;
}();
/* harmony default export */ const elementpanel_css = (ELementStyleEditor);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-general.js
function elementpanel_general_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_general_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_general_typeof(obj); }
function elementpanel_general_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_general_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_general_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_general_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_general_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_general_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_general_toPropertyKey(arg) { var key = elementpanel_general_toPrimitive(arg, "string"); return elementpanel_general_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_general_toPrimitive(input, hint) { if (elementpanel_general_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_general_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }



var elementpanel_general_dom = new Dom();
var ElementGeneralStyles = /*#__PURE__*/function () {
  function ElementGeneralStyles(builder) {
    var _this = this;
    elementpanel_general_classCallCheck(this, ElementGeneralStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementGeneral');
    this.panelStuff = panelStuff;
    var html = "\n                <div class=\"is-settings\" style=\"width: 100%\">\n                    <div class=\"is-label\" style=\"margin:0 0 3px\">".concat(util.out('Background Color'), ":</div>\n                    <div>\n                        <button title=\"").concat(util.out('Background Color'), "\" class=\"input-elm-bgcolor is-btn-color\" style=\"margin-right:15px\"></button>\n                        <button title=\"").concat(util.out('Gradient'), "\" class=\"input-elm-gradient classic\" data-value=\"+\"> ").concat(util.out('Gradient'), " </button>\n                    </div>\n                </div>\n\n                <div style=\"padding-top:20px;padding-bottom: 3px;\">").concat(util.out('Background Image'), ":</div>\n                <div class=\"is-settings\" style=\"width: 100%\">\n                    <div class=\"elm-bgimage-preview\"></div>\n                    <div style=\"display: flex\">\n                        <button title=\"").concat(util.out('Image'), "\" class=\"input-elm-bgimage\">\n                            <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-image\"></use></svg>\n                            <span style=\"margin-left: 5px;\">").concat(util.out('Image'), "</span>\n                        </button>\n                        <button title=\"").concat(util.out('Select'), "\" class=\"input-select\">\n                            ").concat(this.builder.opts.selectIcon, "\n                        </button>\n                        <button title=\"").concat(util.out('Remove'), "\" class=\"input-elm-bgremove\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                        <button title=\"").concat(util.out('Adjust'), "\" class=\"input-elm-bgimageadjust\" style=\"width:40px\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;flex:none\"><use xlink:href=\"#ion-wrench\"></use></svg></button>\n                    </div>\n                </div>\n\n                <div class=\"is-settings\" style=\"padding-top:20px;width: 100%\">\n                    <label class=\"label-elm-grayscale label-checkbox\" for=\"chkElmGrayscale\"><input id=\"chkElmGrayscale\" class=\"chk-elm-grayscale\" type=\"checkbox\" /> ").concat(util.out('Grayscale'), "</label>\n                </div>\n\n                <div class=\"is-separator\" style=\"margin-top:28px;margin-bottom:5px;\"></div>\n                         \n                <div class=\"is-settings\" style=\"padding-top:0;margin-top:0;width: 100%\">\n                    <div class=\"div-target\" style=\"display: flex;justify-content: flex-end;padding: 5px 0 0;\">\n                        <button title=\"").concat(util.out('Desktop'), "\" class=\"input-device on\" data-value=\"\" style=\"width:40px;height:25px;\">\n                            <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;flex:none\"><use xlink:href=\"#icon-device-desktop\"></use></svg>\n                        </button>\n                        <!--<button title=\"").concat(util.out('Laptop/Tablet (Landscape)'), "\" class=\"input-device\" data-value=\"md\" style=\"width:40px;height:25px;\">\n                            <svg class=\"is-icon-flex\" style=\"width:19px;height:19px;flex:none\"><use xlink:href=\"#icon-device-laptop\"></use></svg>\n                        </button>-->\n                        <button title=\"").concat(util.out('Laptop/Tablet (Landscape)'), "\" class=\"input-device\" data-value=\"md\" style=\"width:40px;height:25px;\">\n                            <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;flex:none;transform:rotate(-90deg)\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                        </button>\n                        <button title=\"").concat(util.out('Tablet (Portrait)'), "\" class=\"input-device\" data-value=\"sm\" style=\"width:40px;height:25px;\">\n                            <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;flex:none\"><use xlink:href=\"#icon-device-tablet\"></use></svg>\n                        </button>\n                        <button title=\"").concat(util.out('Mobile'), "\" class=\"input-device\" data-value=\"xs\" style=\"width:40px;height:25px;\">\n                            <svg class=\"is-icon-flex\" style=\"width:13px;height:13px;flex:none\"><use xlink:href=\"#icon-device-mobile\"></use></svg>\n                        </button>\n                    </div>\n\n                    <div style=\"padding-top:0;padding-bottom:3px;\">").concat(util.out('Visibility'), ":</div>\n                    <div class=\"div-visibility\" style=\"display:flex;\">\n                        <button title=\"").concat(util.out('Visible'), "\" class=\"input-visible on\" data-value=\"sm\" style=\"width:100px;height:34px;\">\n                            <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;flex:none\"><use xlink:href=\"#icon-eye\"></use></svg>\n                            <span>").concat(util.out('Visible'), "</span>\n                        </button>\n                        <button title=\"").concat(util.out('Hidden'), "\" class=\"input-hidden\" data-value=\"xs\" style=\"width:100px;height:34px;\">\n                            <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;flex:none\"><use xlink:href=\"#icon-eye-off\"></use></svg>\n                            <span>").concat(util.out('Hidden'), "</span>\n                        </button>\n                    </div>\n                </div>\n\n\n        ");
    elementpanel_general_dom.appendHtml(panelStuff, html);

    // Background color
    var btnElmBgColor = panelStuff.querySelector('.input-elm-bgcolor');
    btnElmBgColor.addEventListener('click', function (e) {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var elm = e.target;
      _this.builder.colorPicker.open(function (color) {
        _this.builder.inspectedElement.style.backgroundColor = color;
        elm.style.backgroundColor = color; // preview

        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, panelStuff.querySelector('.input-elm-bgcolor').style.backgroundColor, function () {
        btnElmBgColor.removeAttribute('data-focus');
        btnElmBgColor.focus();
      });
      btnElmBgColor.setAttribute('data-focus', true);
    });

    // Background gradient
    var gradientPicker = new contentbuilder_gradientpicker({
      colors: this.builder.colors,
      gradientcolors: this.builder.opts.gradientcolors,
      lang: this.builder.opts.lang
    });
    var btnElmGradient = panelStuff.querySelector('.input-elm-gradient');
    btnElmGradient.addEventListener('click', function () {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      gradientPicker.open(_this.builder.inspectedElement, function () {
        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, function (isChanged) {
        if (isChanged) {
          elementStyleEditor.refresh();
        }
        btnElmGradient.removeAttribute('data-focus');
        btnElmGradient.focus();
      });
      btnElmGradient.setAttribute('data-focus', true);
    });

    // Elm Background Image
    var btnElmBgImage = panelStuff.querySelector('.input-elm-bgimage');
    if (btnElmBgImage) elementpanel_general_dom.addEventListener(btnElmBgImage, 'click', function () {
      var elm = _this.builder.inspectedElement;

      //Get current value
      var imgUrl = '';
      if (elm.style.backgroundImage) {
        if (elm.style.backgroundImage.indexOf('url(') !== -1) {
          imgUrl = elm.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
        }
      }
      _this.builder.colTool.openImagePicker(imgUrl, function (url) {
        _this.builder.uo.saveForUndo();
        var elm = _this.builder.inspectedElement;
        _this.builder.uo.saveForUndo();
        elm.style.backgroundImage = "url(\"".concat(url, "\")");
        elm.style.backgroundSize = 'cover';
        elm.style.backgroundRepeat = 'no-repeat';
        var div = panelStuff.querySelector('.elm-bgimage-preview');
        var btnImageAdjust = _this.panelStuff.querySelector('.input-elm-bgimageadjust');
        var btnImageRemove = _this.panelStuff.querySelector('.input-elm-bgremove');
        btnImageAdjust.style.display = 'none';
        btnImageRemove.style.display = 'none';
        if (url !== '') {
          div.innerHTML = "<img src=\"".concat(url, "\">");
          btnImageAdjust.style.display = 'flex';
          btnImageRemove.style.display = 'flex';
        } else {
          div.innerHTML = '';
        }
        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmBgImage);
    });

    // Elm Background Image Adjust
    var btnImageAdjust = panelStuff.querySelector('.input-elm-bgimageadjust');
    if (btnImageAdjust) elementpanel_general_dom.addEventListener(btnImageAdjust, 'click', function () {
      var elm = _this.builder.inspectedElement;
      _this.builder.colTool.openImageAdjust(elm, btnImageAdjust);
    });
    var btnImageRemove = panelStuff.querySelector('.input-elm-bgremove');
    if (btnImageRemove) elementpanel_general_dom.addEventListener(btnImageRemove, 'click', function () {
      var elm = _this.builder.inspectedElement;
      _this.builder.uo.saveForUndo();
      elm.style.backgroundImage = '';
      elm.style.backgroundSize = '';
      elm.style.backgroundRepeat = '';
      elm.style.backgroundPosition = '';
      var div = panelStuff.querySelector('.elm-bgimage-preview');
      var btnImageAdjust = _this.panelStuff.querySelector('.input-elm-bgimageadjust');
      var btnImageRemove = _this.panelStuff.querySelector('.input-elm-bgremove');
      btnImageAdjust.style.display = 'none';
      btnImageRemove.style.display = 'none';
      div.innerHTML = '';
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Elm Background Image Open Asset

    if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
      panelStuff.querySelector('.input-select').style.display = 'none';
    }
    var btnElmBgImageOpenAsset = panelStuff.querySelector('.input-select');
    this.builder.renderSelectAsset(btnElmBgImageOpenAsset, 'image', function (url) {
      var elm = _this.builder.inspectedElement;
      _this.builder.uo.saveForUndo();
      elm.style.backgroundImage = "url(\"".concat(url, "\")");
      elm.style.backgroundSize = 'cover';
      elm.style.backgroundRepeat = 'no-repeat';
      var div = panelStuff.querySelector('.elm-bgimage-preview');
      var btnImageAdjust = _this.panelStuff.querySelector('.input-elm-bgimageadjust');
      var btnImageRemove = _this.panelStuff.querySelector('.input-elm-bgremove');
      btnImageAdjust.style.display = 'none';
      btnImageRemove.style.display = 'none';
      if (url !== '') {
        div.innerHTML = "<img src=\"".concat(url, "\">");
        btnImageAdjust.style.display = 'flex';
        btnImageRemove.style.display = 'flex';
      } else {
        div.innerHTML = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var chkElmGrayscale = panelStuff.querySelector('.chk-elm-grayscale');
    chkElmGrayscale.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      if (chkElmGrayscale.checked) {
        elm.style.filter = 'grayscale(1)';
      } else {
        if (elm.style.filter) {
          elm.style.filter = elm.style.filter.replace('grayscale(1)', '');
        }
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Responsive Visibility

    var btns = panelStuff.querySelectorAll('.input-device');
    btns.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var elm = _this.builder.inspectedElement;
        var elms = panelStuff.querySelectorAll('.input-device');
        elms.forEach(function (elm) {
          elm.classList.remove('on');
        });
        btn.classList.add('on');
        _this.realtimeVisibility(elm);
      });
    });
    var btnVisible = panelStuff.querySelector('.input-visible');
    var btnHidden = panelStuff.querySelector('.input-hidden');
    btnVisible.addEventListener('click', function () {
      var elm = _this.builder.inspectedElement;
      _this.builder.uo.saveForUndo();
      elm.classList.remove('hideonmobile');
      var divTarget = panelStuff.querySelector('.div-target');
      var target = _this.builder.responsive.readTarget(divTarget);
      if (target === 'xs') {
        elm.classList.remove('xs-hidden');
      } else if (target === 'sm') {
        elm.classList.remove('sm-hidden');
      } else if (target === 'md') {
        elm.classList.remove('md-hidden');
      } else if (target === '') {
        elm.classList.remove('desktop-hidden');
      }
      btnVisible.classList.add('on');
      btnHidden.classList.remove('on');

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    btnHidden.addEventListener('click', function () {
      var elm = _this.builder.inspectedElement;
      _this.builder.uo.saveForUndo();
      elm.classList.remove('hideonmobile');
      var divTarget = panelStuff.querySelector('.div-target');
      var target = _this.builder.responsive.readTarget(divTarget);
      if (target === 'xs') {
        elm.classList.add('xs-hidden');
      } else if (target === 'sm') {
        elm.classList.add('sm-hidden');
      } else if (target === 'md') {
        elm.classList.add('md-hidden');
      } else if (target === '') {
        elm.classList.add('desktop-hidden');
      }
      btnVisible.classList.remove('on');
      btnHidden.classList.add('on');

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_general_createClass(ElementGeneralStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;

      // Background color
      var s = elm.style.backgroundColor;
      var btn = panelStuff.querySelector('.input-elm-bgcolor');
      if (s) btn.style.backgroundColor = s;else btn.style.backgroundColor = 'transparent';

      // Background image
      var imgUrl = '';
      var div = panelStuff.querySelector('.elm-bgimage-preview');
      var btnImageAdjust = panelStuff.querySelector('.input-elm-bgimageadjust');
      btnImageAdjust.style.display = 'none';
      var btnImageRemove = panelStuff.querySelector('.input-elm-bgremove');
      btnImageRemove.style.display = 'none';
      if (elm.style.backgroundImage) {
        if (elm.style.backgroundImage.indexOf('url(') !== -1) {
          imgUrl = elm.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
          div.innerHTML = "<img src=\"".concat(imgUrl, "\">");
          btnImageAdjust.style.display = 'flex';
          btnImageRemove.style.display = 'flex';
        } else {
          div.innerHTML = '';
        }
      } else {
        div.innerHTML = '';
      }
      var chkRowGrayscale = panelStuff.querySelector('.chk-elm-grayscale');
      chkRowGrayscale.checked = false;
      if (elm.style.filter) {
        if (elm.style.filter.indexOf('grayscale') !== -1) {
          chkRowGrayscale.checked = true;
        }
      }
      this.realtimeVisibility(elm, true);
    }
  }, {
    key: "realtimeVisibility",
    value: function realtimeVisibility(row, initialOpen) {
      if (initialOpen) {
        var builderStuff = this.builder.builderStuff;
        var modal = builderStuff.querySelector('.is-modal.content-preview.active');
        if (modal) {
          var elms = this.panelStuff.querySelectorAll('.input-device');
          elms.forEach(function (elm) {
            elm.classList.remove('on');
          });
          if (modal.classList.contains('is-screen-1920')) {
            this.panelStuff.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1440')) {
            this.panelStuff.querySelector('.input-device[data-value=""]').classList.add('on');
          } else if (modal.classList.contains('is-screen-1024')) {
            this.panelStuff.querySelector('.input-device[data-value="md"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-768')) {
            this.panelStuff.querySelector('.input-device[data-value="sm"]').classList.add('on');
          } else if (modal.classList.contains('is-screen-375')) {
            this.panelStuff.querySelector('.input-device[data-value="xs"]').classList.add('on');
          }
        }
      }
      var divTarget = this.panelStuff.querySelector('.div-target');
      var divVisibility = this.panelStuff.querySelector('.div-visibility');
      var target = this.builder.responsive.readTarget(divTarget);
      var valVisibility = this.builder.responsive.getVisibility(row, target);
      this.builder.responsive.showVisibility(divVisibility, valVisibility);

      // Live Preview Sync
      if (target === 'xs') {
        if (!initialOpen) this.builder.livePreview.resizePreview(375);
      } else if (target === 'sm') {
        if (!initialOpen) this.builder.livePreview.resizePreview(768);
      } else if (target === 'md') {
        if (!initialOpen) this.builder.livePreview.resizePreview(1024);
      } else {
        if (!initialOpen) this.builder.livePreview.resizePreview(1920);
      }
    }
  }]);
  return ElementGeneralStyles;
}();
/* harmony default export */ const elementpanel_general = (ElementGeneralStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-box.js
function elementpanel_box_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_box_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_box_typeof(obj); }
function elementpanel_box_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_box_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_box_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_box_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_box_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_box_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_box_toPropertyKey(arg) { var key = elementpanel_box_toPrimitive(arg, "string"); return elementpanel_box_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_box_toPrimitive(input, hint) { if (elementpanel_box_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_box_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_box_dom = new Dom();
var ElementBoxStyles = /*#__PURE__*/function () {
  function ElementBoxStyles(builder) {
    var _this = this;
    elementpanel_box_classCallCheck(this, ElementBoxStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementBox');
    this.panelStuff = panelStuff;
    var html = "\n                <div class=\"is-settings\" style=\"width:110px\">\n                    <div><label for=\"inpElmWidth\">".concat(util.out('Width'), ":</label></div>\n                    <div style=\"display:flex\">\n                        <input type=\"text\" id=\"inpElmWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmWidthUnit\"\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"%\">%</option>\n                        </select>\n                    </div>\n                </div>\n                <div class=\"is-settings\" style=\"width:110px;\">\n                    <div><label for=\"inpElmHeight\">").concat(util.out('Height'), ":</label></div>\n                    <div style=\"display:flex\">\n                        <input type=\"text\" id=\"inpElmHeight\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmHeightUnit\"\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"%\">%</option>\n                        </select>\n                    </div>\n                </div>\n                <div class=\"is-settings\" style=\"width:110px;\">\n                    <div><label for=\"inpElmMaxWidth\">").concat(util.out('Max Width'), ":</label></div>\n                    <div style=\"display:flex\">\n                        <input type=\"text\" id=\"inpElmMaxWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmMaxWidthUnit\"\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"%\">%</option>\n                        </select>\n                    </div>\n                </div>\n                <div class=\"is-settings\" style=\"width:110px;\">\n                    <div><label for=\"inpElmMaxHeight\">").concat(util.out('Max Height'), ":</label></div>\n                    <div style=\"display:flex\">\n                        <input type=\"text\" id=\"inpElmMaxHeight\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmMaxHeightUnit\"\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"%\">%</option>\n                        </select>\n                    </div>\n                </div>\n                <div class=\"is-settings\" style=\"width:110px;\">\n                    <div><label for=\"inpElmMinWidth\">").concat(util.out('Min Width'), ":</label></div>\n                    <div style=\"display:flex\">\n                        <input type=\"text\" id=\"inpElmMinWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmMinWidthUnit\"\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"%\">%</option>\n                        </select>\n                    </div>\n                </div>\n                <div class=\"is-settings\" style=\"width:110px;\">\n                    <div><label for=\"inpElmMinHeight\">").concat(util.out('Min Height'), ":</label></div>\n                    <div style=\"display:flex\">\n                        <input type=\"text\" id=\"inpElmMinHeight\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmMinHeightUnit\"\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"%\">%</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class=\"is-settings\" style=\"width:110px;\">\n                    <div>").concat(util.out('Overflow x'), ":</div>\n                    <div>\n                        <select id=\"inpElmOverflowX\"\">\n                            <option value=\"\"></option>\n                            <option value=\"auto\">Auto</option>\n                            <option value=\"hidden\">Hidden</option>\n                        </select>\n                    </div>\n                </div>\n                <div class=\"is-settings\" style=\"width:110px;\">\n                    <div>").concat(util.out('Overflow y'), ":</div>\n                    <div>\n                        <select id=\"inpElmOverflowY\"\">\n                            <option value=\"\"></option>\n                            <option value=\"auto\">Auto</option>\n                            <option value=\"hidden\">Hidden</option>\n                        </select>\n                    </div>\n                </div>\n        ");
    elementpanel_box_dom.appendHtml(panelStuff, html);

    // Others
    var inpElmMaxWidth = panelStuff.querySelector('#inpElmMaxWidth');
    inpElmMaxWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmMaxWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMaxWidth').value;
      var unit = panelStuff.querySelector('#inpElmMaxWidthUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.maxWidth = val + unit;
      } else {
        elm.style.maxWidth = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMaxWidthUnit = panelStuff.querySelector('#inpElmMaxWidthUnit');
    inpElmMaxWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMaxWidth').value;
      var unit = panelStuff.querySelector('#inpElmMaxWidthUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.maxWidth = val + unit;
      } else {
        elm.style.maxWidth = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMaxHeight = panelStuff.querySelector('#inpElmMaxHeight');
    inpElmMaxHeight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmMaxHeight.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMaxHeight').value;
      var unit = panelStuff.querySelector('#inpElmMaxHeightUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.maxHeight = val + unit;
      } else {
        elm.style.maxHeight = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMaxHeightUnit = panelStuff.querySelector('#inpElmMaxHeightUnit');
    inpElmMaxHeightUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMaxHeight').value;
      var unit = panelStuff.querySelector('#inpElmMaxHeightUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.maxHeight = val + unit;
      } else {
        elm.style.maxHeight = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMinWidth = panelStuff.querySelector('#inpElmMinWidth');
    inpElmMinWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmMinWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMinWidth').value;
      var unit = panelStuff.querySelector('#inpElmMinWidthUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.minWidth = val + unit;
      } else {
        elm.style.minWidth = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMinWidthUnit = panelStuff.querySelector('#inpElmMinWidthUnit');
    inpElmMinWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMinWidth').value;
      var unit = panelStuff.querySelector('#inpElmMinWidthUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.minWidth = val + unit;
      } else {
        elm.style.minWidth = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMinHeight = panelStuff.querySelector('#inpElmMinHeight');
    inpElmMinHeight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmMinHeight.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMinHeight').value;
      var unit = panelStuff.querySelector('#inpElmMinHeightUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.minHeight = val + unit;
      } else {
        elm.style.minHeight = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMinHeightUnit = panelStuff.querySelector('#inpElmMinHeightUnit');
    inpElmMinHeightUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmMinHeight').value;
      var unit = panelStuff.querySelector('#inpElmMinHeightUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.minHeight = val + unit;
      } else {
        elm.style.minHeight = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmWidth = panelStuff.querySelector('#inpElmWidth');
    inpElmWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmWidth').value;
      var unit = panelStuff.querySelector('#inpElmWidthUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.width = val + unit;
      } else {
        elm.style.width = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmWidthUnit = panelStuff.querySelector('#inpElmWidthUnit');
    inpElmWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmWidth').value;
      var unit = panelStuff.querySelector('#inpElmWidthUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.width = val + unit;
      } else {
        elm.style.width = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmHeight = panelStuff.querySelector('#inpElmHeight');
    inpElmHeight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmHeight.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmHeight').value;
      var unit = panelStuff.querySelector('#inpElmHeightUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.height = val + unit;
      } else {
        elm.style.height = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmHeightUnit = panelStuff.querySelector('#inpElmHeightUnit');
    inpElmHeightUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmHeight').value;
      var unit = panelStuff.querySelector('#inpElmHeightUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.height = val + unit;
      } else {
        elm.style.height = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmOverflowX = panelStuff.querySelector('#inpElmOverflowX');
    inpElmOverflowX.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmOverflowX').value;
      elm.style.overflowX = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmOverflowY = panelStuff.querySelector('#inpElmOverflowY');
    inpElmOverflowY.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmOverflowY').value;
      elm.style.overflowY = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_box_createClass(ElementBoxStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;

      // Max Width
      var inpElmMaxWidth = panelStuff.querySelector('#inpElmMaxWidth');
      var inpElmMaxWidthUnit = panelStuff.querySelector('#inpElmMaxWidthUnit');
      inpElmMaxWidth.value = '';
      inpElmMaxWidthUnit.value = 'px';
      var s = elm.style.maxWidth;
      var nMaxWidth = parseInt(s);
      if (!isNaN(nMaxWidth)) {
        if (s.indexOf('%') !== -1) inpElmMaxWidthUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMaxWidthUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMaxWidthUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMaxWidthUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMaxWidthUnit.value = 'em';
        inpElmMaxWidth.value = nMaxWidth;
      }

      // Max Height
      var inpElmMaxHeight = panelStuff.querySelector('#inpElmMaxHeight');
      var inpElmMaxHeightUnit = panelStuff.querySelector('#inpElmMaxHeightUnit');
      inpElmMaxHeight.value = '';
      inpElmMaxHeightUnit.value = 'px';
      s = elm.style.maxHeight;
      var nMaxHeight = parseInt(s);
      if (!isNaN(nMaxHeight)) {
        if (s.indexOf('%') !== -1) inpElmMaxHeightUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMaxHeightUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMaxHeightUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMaxHeightUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMaxHeightUnit.value = 'em';
        inpElmMaxHeight.value = nMaxHeight;
      }

      // Min Width
      var inpElmMinWidth = panelStuff.querySelector('#inpElmMinWidth');
      var inpElmMinWidthUnit = panelStuff.querySelector('#inpElmMinWidthUnit');
      inpElmMinWidth.value = '';
      inpElmMinWidthUnit.value = 'px';
      s = elm.style.minWidth;
      var nMinWidth = parseInt(s);
      if (!isNaN(nMinWidth)) {
        if (s.indexOf('%') !== -1) inpElmMinWidthUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMinWidthUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMinWidthUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMinWidthUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMinWidthUnit.value = 'em';
        inpElmMinWidth.value = nMinWidth;
      }

      // Min Height
      var inpElmMinHeight = panelStuff.querySelector('#inpElmMinHeight');
      var inpElmMinHeightUnit = panelStuff.querySelector('#inpElmMinHeightUnit');
      inpElmMinHeight.value = '';
      inpElmMinHeightUnit.value = 'px';
      s = elm.style.minHeight;
      var nMinHeight = parseInt(s);
      if (!isNaN(nMinHeight)) {
        if (s.indexOf('%') !== -1) inpElmMinHeightUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMinHeightUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMinHeightUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMinHeightUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMinHeightUnit.value = 'em';
        inpElmMinHeight.value = nMinHeight;
      }

      // Width
      var inpElmWidth = panelStuff.querySelector('#inpElmWidth');
      var inpElmWidthUnit = panelStuff.querySelector('#inpElmWidthUnit');
      inpElmWidth.value = '';
      inpElmWidthUnit.value = 'px';
      s = elm.style.width;
      var nWidth = parseInt(s);
      if (!isNaN(nWidth)) {
        if (s.indexOf('%') !== -1) inpElmWidthUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmWidthUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmWidthUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmWidthUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmWidthUnit.value = 'em';
        inpElmWidth.value = nWidth;
      }

      // Height
      var inpElmHeight = panelStuff.querySelector('#inpElmHeight');
      var inpElmHeightUnit = panelStuff.querySelector('#inpElmHeightUnit');
      inpElmHeight.value = '';
      inpElmHeightUnit.value = 'px';
      s = elm.style.height;
      var nHeight = parseInt(s);
      if (!isNaN(nHeight)) {
        if (s.indexOf('%') !== -1) inpElmHeightUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmHeightUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmHeightUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmHeightUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmHeightUnit.value = 'em';
        inpElmHeight.value = nHeight;
      }

      // Overflow X
      var inpElmOverflowX = panelStuff.querySelector('#inpElmOverflowX');
      s = elm.style.overflowX;
      inpElmOverflowX.value = s;

      // Overflow Y
      var inpElmOverflowY = panelStuff.querySelector('#inpElmOverflowY');
      s = elm.style.overflowY;
      inpElmOverflowY.value = s;
    }
  }]);
  return ElementBoxStyles;
}();
/* harmony default export */ const elementpanel_box = (ElementBoxStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-spacing.js
function elementpanel_spacing_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_spacing_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_spacing_typeof(obj); }
function elementpanel_spacing_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_spacing_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_spacing_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_spacing_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_spacing_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_spacing_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_spacing_toPropertyKey(arg) { var key = elementpanel_spacing_toPrimitive(arg, "string"); return elementpanel_spacing_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_spacing_toPrimitive(input, hint) { if (elementpanel_spacing_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_spacing_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_spacing_dom = new Dom();
var ElementSpacingStyles = /*#__PURE__*/function () {
  function ElementSpacingStyles(builder) {
    var _this = this;
    elementpanel_spacing_classCallCheck(this, ElementSpacingStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementSpacing');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top: 13px;font-weight: bold;width:100%\">".concat(util.out('Padding'), "</div>\n            \n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Top'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmPaddingTop\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmPaddingTopUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Bottom'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmPaddingBottom\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmPaddingBottomUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Left'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmPaddingLeft\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmPaddingLeftUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Right'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmPaddingRight\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmPaddingRightUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n            \n            <div style=\"margin-top: 25px;font-weight: bold;width:100%\">").concat(util.out('Margin'), "</div>\n            \n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Top'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmMarginTop\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmMarginTopUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                        <option value=\"auto\">auto</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Bottom'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmMarginBottom\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmMarginBottomUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                        <option value=\"auto\">auto</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Left'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmMarginLeft\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmMarginLeftUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                        <option value=\"auto\">auto</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Right'), ":</div>\n                <div style=\"display:flex;\">\n                    <input type=\"text\" id=\"inpElmMarginRight\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmMarginRightUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                        <option value=\"auto\">auto</option>\n                    </select>\n                </div>\n            </div>\n\n            <div style=\"display:none\">\n                <div style=\"margin-top: 25px;font-weight: bold;width:100%\">").concat(util.out('Responsive Positioning'), ":</div>\n                \n                <div class=\"is-settings\" style=\"width:100%;\">\n                    <div>\n                        <label for=\"chkResetMarginLeft\" style=\"letter-spacing: 0.5px;\"><input type=\"checkbox\" id=\"chkResetMarginLeft\" value=\"\" /> ").concat(util.out('Reset margin left on small screen'), " </label>\n                    </div>\n                </div>\n                <div class=\"is-settings\" style=\"margin-top:0;width:100%;\">\n                    <div>\n                        <label for=\"chkResetMarginRight\" style=\"letter-spacing: 0.5px;\"><input type=\"checkbox\" id=\"chkResetMarginRight\" value=\"\" /> ").concat(util.out('Reset margin right on small screen'), " </label>\n                    </div>\n                </div>\n            </div>\n        ");
    elementpanel_spacing_dom.appendHtml(panelStuff, html);

    // Margin
    var inpElmMarginLeft = panelStuff.querySelector('#inpElmMarginLeft');
    inpElmMarginLeft.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmMarginLeftUnit = panelStuff.querySelector('#inpElmMarginLeftUnit');
    inpElmMarginLeft.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginLeft.value;
      var unit = inpElmMarginLeftUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.marginLeft = val + unit;
      } else {
        elm.style.marginLeft = '';
      }
      if (unit === 'auto') {
        elm.style.marginLeft = 'auto';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmMarginLeftUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginLeft.value;
      var unit = inpElmMarginLeftUnit.value;
      if (unit === 'auto') {
        elm.style.marginLeft = 'auto';
        inpElmMarginLeft.value = '';
      } else {
        elm.style.marginLeft = val + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMarginRight = panelStuff.querySelector('#inpElmMarginRight');
    inpElmMarginRight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmMarginRightUnit = panelStuff.querySelector('#inpElmMarginRightUnit');
    inpElmMarginRight.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginRight.value;
      var unit = inpElmMarginRightUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.marginRight = val + unit;
      } else {
        elm.style.marginRight = '';
      }
      if (unit === 'auto') {
        elm.style.marginRight = 'auto';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmMarginRightUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginRight.value;
      var unit = inpElmMarginRightUnit.value;
      if (unit === 'auto') {
        elm.style.marginRight = 'auto';
        inpElmMarginRight.value = '';
      } else {
        elm.style.marginRight = val + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMarginTop = panelStuff.querySelector('#inpElmMarginTop');
    inpElmMarginTop.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmMarginTopUnit = panelStuff.querySelector('#inpElmMarginTopUnit');
    inpElmMarginTop.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginTop.value;
      var unit = inpElmMarginTopUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.marginTop = val + unit;
      } else {
        elm.style.marginTop = '';
      }
      if (unit === 'auto') {
        elm.style.marginTop = 'auto';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmMarginTopUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginTop.value;
      var unit = inpElmMarginTopUnit.value;
      if (unit === 'auto') {
        elm.style.marginTop = 'auto';
        inpElmMarginTop.value = '';
      } else {
        elm.style.marginTop = val + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmMarginBottom = panelStuff.querySelector('#inpElmMarginBottom');
    inpElmMarginBottom.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmMarginBottomUnit = panelStuff.querySelector('#inpElmMarginBottomUnit');
    inpElmMarginBottom.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginBottom.value;
      var unit = inpElmMarginBottomUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.marginBottom = val + unit;
      } else {
        elm.style.marginBottom = '';
      }
      if (unit === 'auto') {
        elm.style.marginBottom = 'auto';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmMarginBottomUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmMarginBottom.value;
      var unit = inpElmMarginBottomUnit.value;
      if (unit === 'auto') {
        elm.style.marginBottom = 'auto';
        inpElmMarginBottom.value = '';
      } else {
        elm.style.marginBottom = val + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Padding
    var inpElmPaddingLeft = panelStuff.querySelector('#inpElmPaddingLeft');
    inpElmPaddingLeft.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmPaddingLeftUnit = panelStuff.querySelector('#inpElmPaddingLeftUnit');
    inpElmPaddingLeft.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingLeft.value;
      var unit = inpElmPaddingLeftUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingLeft = val + unit;
      } else {
        elm.style.paddingLeft = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmPaddingLeftUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingLeft.value;
      var unit = inpElmPaddingLeftUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingLeft = val + unit;
      } else {
        elm.style.paddingLeft = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmPaddingRight = panelStuff.querySelector('#inpElmPaddingRight');
    inpElmPaddingRight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmPaddingRightUnit = panelStuff.querySelector('#inpElmPaddingRightUnit');
    inpElmPaddingRight.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingRight.value;
      var unit = inpElmPaddingRightUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingRight = val + unit;
      } else {
        elm.style.paddingRight = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmPaddingRightUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingRight.value;
      var unit = inpElmPaddingRightUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingRight = val + unit;
      } else {
        elm.style.paddingRight = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmPaddingTop = panelStuff.querySelector('#inpElmPaddingTop');
    inpElmPaddingTop.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmPaddingTopUnit = panelStuff.querySelector('#inpElmPaddingTopUnit');
    inpElmPaddingTop.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingTop.value;
      var unit = inpElmPaddingTopUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingTop = val + unit;
      } else {
        elm.style.paddingTop = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmPaddingTopUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingTop.value;
      var unit = inpElmPaddingTopUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingTop = val + unit;
      } else {
        elm.style.paddingTop = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmPaddingBottom = panelStuff.querySelector('#inpElmPaddingBottom');
    inpElmPaddingBottom.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmPaddingBottomUnit = panelStuff.querySelector('#inpElmPaddingBottomUnit');
    inpElmPaddingBottom.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingBottom.value;
      var unit = inpElmPaddingBottomUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingBottom = val + unit;
      } else {
        elm.style.paddingBottom = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmPaddingBottomUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmPaddingBottom.value;
      var unit = inpElmPaddingBottomUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.paddingBottom = val + unit;
      } else {
        elm.style.paddingBottom = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Responsive positioning
    var chkResetMarginLeft = panelStuff.querySelector('#chkResetMarginLeft');
    chkResetMarginLeft.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      if (chkResetMarginLeft.checked) {
        elementpanel_spacing_dom.addClass(elm, 'margin-left-1024-reset');
      } else {
        elementpanel_spacing_dom.removeClass(elm, 'margin-left-1024-reset');
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var chkResetMarginRight = panelStuff.querySelector('#chkResetMarginRight');
    chkResetMarginRight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      if (chkResetMarginRight.checked) {
        elementpanel_spacing_dom.addClass(elm, 'margin-right-1024-reset');
      } else {
        elementpanel_spacing_dom.removeClass(elm, 'margin-right-1024-reset');
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_spacing_createClass(ElementSpacingStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var s;

      // Margin
      var inpElmMarginTop = panelStuff.querySelector('#inpElmMarginTop');
      var inpElmMarginTopUnit = panelStuff.querySelector('#inpElmMarginTopUnit');
      inpElmMarginTop.value = '';
      inpElmMarginTopUnit.value = 'px';
      s = elm.style.marginTop;
      var nMarginTop = parseInt(s);
      if (!isNaN(nMarginTop)) {
        if (s.indexOf('%') !== -1) inpElmMarginTopUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMarginTopUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMarginTopUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMarginTopUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMarginTopUnit.value = 'em';
        inpElmMarginTop.value = nMarginTop;
      } else {
        if (s) if (s.indexOf('auto') !== -1) {
          inpElmMarginTopUnit.value = 'auto';
          inpElmMarginTop.value = '';
        }
      }
      var inpElmMarginBottom = panelStuff.querySelector('#inpElmMarginBottom');
      var inpElmMarginBottomUnit = panelStuff.querySelector('#inpElmMarginBottomUnit');
      inpElmMarginBottom.value = '';
      inpElmMarginBottomUnit.value = 'px';
      s = elm.style.marginBottom;
      var nMarginBottom = parseInt(s);
      if (!isNaN(nMarginBottom)) {
        if (s.indexOf('%') !== -1) inpElmMarginBottomUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMarginBottomUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMarginBottomUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMarginBottomUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMarginBottomUnit.value = 'em';
        inpElmMarginBottom.value = nMarginBottom;
      } else {
        if (s) if (s.indexOf('auto') !== -1) {
          inpElmMarginBottomUnit.value = 'auto';
          inpElmMarginBottom.value = '';
        }
      }
      var inpElmMarginLeft = panelStuff.querySelector('#inpElmMarginLeft');
      var inpElmMarginLeftUnit = panelStuff.querySelector('#inpElmMarginLeftUnit');
      inpElmMarginLeft.value = '';
      inpElmMarginLeftUnit.value = 'px';
      s = elm.style.marginLeft;
      var nMarginLeft = parseInt(s);
      if (!isNaN(nMarginLeft)) {
        if (s.indexOf('%') !== -1) inpElmMarginLeftUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMarginLeftUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMarginLeftUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMarginLeftUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMarginLeftUnit.value = 'em';
        inpElmMarginLeft.value = nMarginLeft;
      } else {
        if (s) if (s.indexOf('auto') !== -1) {
          inpElmMarginLeftUnit.value = 'auto';
          inpElmMarginLeft.value = '';
        }
      }
      var inpElmMarginRight = panelStuff.querySelector('#inpElmMarginRight');
      var inpElmMarginRightUnit = panelStuff.querySelector('#inpElmMarginRightUnit');
      inpElmMarginRight.value = '';
      inpElmMarginRightUnit.value = 'px';
      s = elm.style.marginRight;
      var nMarginRight = parseInt(s);
      if (!isNaN(nMarginRight)) {
        if (s.indexOf('%') !== -1) inpElmMarginRightUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmMarginRightUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmMarginRightUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmMarginRightUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmMarginRightUnit.value = 'em';
        inpElmMarginRight.value = nMarginRight;
      } else {
        if (s) if (s.indexOf('auto') !== -1) {
          inpElmMarginRightUnit.value = 'auto';
          inpElmMarginRight.value = '';
        }
      }

      // Padding
      var inpElmPaddingTop = panelStuff.querySelector('#inpElmPaddingTop');
      var inpElmPaddingTopUnit = panelStuff.querySelector('#inpElmPaddingTopUnit');
      inpElmPaddingTop.value = '';
      inpElmPaddingTopUnit.value = 'px';
      s = elm.style.paddingTop;
      var nPaddingTop = parseInt(s);
      if (!isNaN(nPaddingTop)) {
        if (s.indexOf('%') !== -1) inpElmPaddingTopUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmPaddingTopUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmPaddingTopUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmPaddingTopUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmPaddingTopUnit.value = 'em';
        inpElmPaddingTop.value = nPaddingTop;
      }
      var inpElmPaddingBottom = panelStuff.querySelector('#inpElmPaddingBottom');
      var inpElmPaddingBottomUnit = panelStuff.querySelector('#inpElmPaddingBottomUnit');
      inpElmPaddingBottom.value = '';
      inpElmPaddingBottomUnit.value = 'px';
      s = elm.style.paddingBottom;
      var nPaddingBottom = parseInt(s);
      if (!isNaN(nPaddingBottom)) {
        if (s.indexOf('%') !== -1) inpElmPaddingBottomUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmPaddingBottomUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmPaddingBottomUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmPaddingBottomUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmPaddingBottomUnit.value = 'em';
        inpElmPaddingBottom.value = nPaddingBottom;
      }
      var inpElmPaddingLeft = panelStuff.querySelector('#inpElmPaddingLeft');
      var inpElmPaddingLeftUnit = panelStuff.querySelector('#inpElmPaddingLeftUnit');
      inpElmPaddingLeft.value = '';
      inpElmPaddingLeftUnit.value = 'px';
      s = elm.style.paddingLeft;
      var nPaddingLeft = parseInt(s);
      if (!isNaN(nPaddingLeft)) {
        if (s.indexOf('%') !== -1) inpElmPaddingLeftUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmPaddingLeftUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmPaddingLeftUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmPaddingLeftUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmPaddingLeftUnit.value = 'em';
        inpElmPaddingLeft.value = nPaddingLeft;
      }
      var inpElmPaddingRight = panelStuff.querySelector('#inpElmPaddingRight');
      var inpElmPaddingRightUnit = panelStuff.querySelector('#inpElmPaddingRightUnit');
      inpElmPaddingRight.value = '';
      inpElmPaddingRightUnit.value = 'px';
      s = elm.style.paddingRight;
      var nPaddingRight = parseInt(s);
      if (!isNaN(nPaddingRight)) {
        if (s.indexOf('%') !== -1) inpElmPaddingRightUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmPaddingRightUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmPaddingRightUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmPaddingRightUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmPaddingRightUnit.value = 'em';
        inpElmPaddingRight.value = nPaddingRight;
      }

      // Responsive Positioning
      if (elementpanel_spacing_dom.hasClass(elm, 'margin-left-1024-reset')) {
        panelStuff.querySelector('#chkResetMarginLeft').checked = true;
      } else {
        panelStuff.querySelector('#chkResetMarginLeft').checked = false;
      }
      if (elementpanel_spacing_dom.hasClass(elm, 'margin-right-1024-reset')) {
        panelStuff.querySelector('#chkResetMarginRight').checked = true;
      } else {
        panelStuff.querySelector('#chkResetMarginRight').checked = false;
      }
    }
  }]);
  return ElementSpacingStyles;
}();
/* harmony default export */ const elementpanel_spacing = (ElementSpacingStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-border.js
function elementpanel_border_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_border_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_border_typeof(obj); }
function elementpanel_border_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_border_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_border_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_border_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_border_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_border_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_border_toPropertyKey(arg) { var key = elementpanel_border_toPrimitive(arg, "string"); return elementpanel_border_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_border_toPrimitive(input, hint) { if (elementpanel_border_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_border_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_border_dom = new Dom();
var ElementBorderStyles = /*#__PURE__*/function () {
  function ElementBorderStyles(builder) {
    var _this = this;
    elementpanel_border_classCallCheck(this, ElementBorderStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementBorder');
    this.panelStuff = panelStuff;
    var html = "\n                <div style=\"margin-top: 13px;font-weight: bold;line-height: 1.7;\">".concat(util.out('Border'), "</div>\n                \n                <div class=\"is-settings\">\n                    <div style=\"display:flex;\">\n                        <input type=\"text\" id=\"inpElmBorderWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmBorderWidthUnit\" style=\"margin-right:15px;\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"none\">none</option>\n                        </select>\n                        <select id=\"inpElmBorderStyle\" style=\"margin-right:15px;\">\n                            <option value=\"\"></option>\n                            <option value=\"solid\">Solid</option>\n                            <option value=\"dashed\">Dashed</option>\n                            <option value=\"dotted\">Dotted</option>\n                        </select>\n                        <button title=\"").concat(util.out('Border Color'), "\" class=\"input-elm-bordercolor is-btn-color\"></button>                             \n                    </div>\n                </div>\n                \n                <div style=\"margin-top: 25px;font-weight: bold;line-height: 1.7;\">").concat(util.out('Individual Sides'), "</div>\n                \n                <div class=\"is-settings\">\n                    <div>").concat(util.out('Border Top'), ":</div>\n                    <div style=\"display:flex;\">\n                        <input type=\"text\" id=\"inpElmBorderTopWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmBorderTopWidthUnit\" style=\"margin-right:15px;\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"none\">none</option>\n                        </select>\n                        <select id=\"inpElmBorderTopStyle\" style=\"margin-right:15px;\">\n                            <option value=\"\"></option>\n                            <option value=\"solid\">Solid</option>\n                            <option value=\"dashed\">Dashed</option>\n                            <option value=\"dotted\">Dotted</option>\n                        </select>\n                        <button title=\"").concat(util.out('Border Top Color'), "\" class=\"input-elm-bordertopcolor is-btn-color\"></button>\n                    </div>\n                </div>\n                \n                <div class=\"is-settings\">\n                    <div>").concat(util.out('Border Bottom'), ":</div>\n                    <div style=\"display:flex;\">\n                        <input type=\"text\" id=\"inpElmBorderBottomWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmBorderBottomWidthUnit\" style=\"margin-right:15px;\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"none\">none</option>\n                        </select>\n                        <select id=\"inpElmBorderBottomStyle\" style=\"margin-right:15px;\">\n                            <option value=\"\"></option>\n                            <option value=\"solid\">Solid</option>\n                            <option value=\"dashed\">Dashed</option>\n                            <option value=\"dotted\">Dotted</option>\n                        </select>\n                        <button title=\"").concat(util.out('Border Bottom Color'), "\" class=\"input-elm-borderbottomcolor is-btn-color\"></button>\n                    </div>\n                </div>\n                \n                <div class=\"is-settings\">\n                    <div>").concat(util.out('Border Left'), ":</div>\n                    <div style=\"display:flex;\">\n                        <input type=\"text\" id=\"inpElmBorderLeftWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmBorderLeftWidthUnit\" style=\"margin-right:15px;\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"none\">none</option>\n                        </select>\n                        <select id=\"inpElmBorderLeftStyle\" style=\"margin-right:15px;\">\n                            <option value=\"\"></option>\n                            <option value=\"solid\">Solid</option>\n                            <option value=\"dashed\">Dashed</option>\n                            <option value=\"dotted\">Dotted</option>\n                        </select>\n                        <button title=\"").concat(util.out('Border Left Color'), "\" class=\"input-elm-borderleftcolor is-btn-color\"></button>\n                    </div>\n                </div>\n                \n                <div class=\"is-settings\">\n                    <div>").concat(util.out('Border Right'), ":</div>\n                    <div style=\"display:flex;\">\n                        <input type=\"text\" id=\"inpElmBorderRightWidth\" value=\"\" style=\"width:45px\"/>\n                        <select id=\"inpElmBorderRightWidthUnit\" style=\"margin-right:15px;\">\n                            <option value=\"px\">px</option>\n                            <option value=\"em\">em</option>\n                            <option value=\"vw\">vw</option>\n                            <option value=\"vh\">vh</option>\n                            <option value=\"none\">none</option>\n                        </select>\n                        <select id=\"inpElmBorderRightStyle\" style=\"margin-right:15px;\">\n                            <option value=\"\"></option>\n                            <option value=\"solid\">Solid</option>\n                            <option value=\"dashed\">Dashed</option>\n                            <option value=\"dotted\">Dotted</option>\n                        </select>\n                        <button title=\"").concat(util.out('Border Right Color'), "\" class=\"input-elm-borderrightcolor is-btn-color\"></button> \n                    </div>\n                </div>                \n        ");
    elementpanel_border_dom.appendHtml(panelStuff, html);

    // Border color
    var btnElmBorderColor = panelStuff.querySelector('.input-elm-bordercolor');
    btnElmBorderColor.addEventListener('click', function (e) {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var elm = e.target;
      _this.builder.colorPicker.open(function (color) {
        _this.builder.inspectedElement.style.borderColor = color;
        elm.style.backgroundColor = color; // preview

        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmBorderColor.style.backgroundColor, function () {
        btnElmBorderColor.removeAttribute('data-focus');
        btnElmBorderColor.focus();
      });
      btnElmBorderColor.setAttribute('data-focus', true);
    });

    // Border top color
    var btnElmBorderTopColor = panelStuff.querySelector('.input-elm-bordertopcolor');
    btnElmBorderTopColor.addEventListener('click', function (e) {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var elm = e.target;
      _this.builder.colorPicker.open(function (color) {
        _this.builder.inspectedElement.style.borderTopColor = color;
        elm.style.backgroundColor = color; // preview

        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmBorderTopColor.style.backgroundColor, function () {
        btnElmBorderTopColor.removeAttribute('data-focus');
        btnElmBorderTopColor.focus();
      });
      btnElmBorderTopColor.setAttribute('data-focus', true);
    });

    // Border bottom color
    var btnElmBorderBottomColor = panelStuff.querySelector('.input-elm-borderbottomcolor');
    btnElmBorderBottomColor.addEventListener('click', function (e) {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var elm = e.target;
      _this.builder.colorPicker.open(function (color) {
        _this.builder.inspectedElement.style.borderBottomColor = color;
        elm.style.backgroundColor = color; // preview

        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmBorderBottomColor.style.backgroundColor, function () {
        btnElmBorderBottomColor.removeAttribute('data-focus');
        btnElmBorderBottomColor.focus();
      });
      btnElmBorderBottomColor.setAttribute('data-focus', true);
    });

    // Border left color
    var btnElmBorderLeftColor = panelStuff.querySelector('.input-elm-borderleftcolor');
    btnElmBorderLeftColor.addEventListener('click', function (e) {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var elm = e.target;
      _this.builder.colorPicker.open(function (color) {
        _this.builder.inspectedElement.style.borderLeftColor = color;
        elm.style.backgroundColor = color; // preview

        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmBorderLeftColor.style.backgroundColor, function () {
        btnElmBorderLeftColor.removeAttribute('data-focus');
        btnElmBorderLeftColor.focus();
      });
      btnElmBorderLeftColor.setAttribute('data-focus', true);
    });

    // Border right color
    var btnElmBorderRightColor = panelStuff.querySelector('.input-elm-borderrightcolor');
    btnElmBorderRightColor.addEventListener('click', function (e) {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var elm = e.target;
      _this.builder.colorPicker.open(function (color) {
        _this.builder.inspectedElement.style.borderRightColor = color;
        elm.style.backgroundColor = color; // preview

        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmBorderRightColor.style.backgroundColor, function () {
        btnElmBorderRightColor.removeAttribute('data-focus');
        btnElmBorderRightColor.focus();
      });
      btnElmBorderRightColor.setAttribute('data-focus', true);
    });

    // Border width
    var inpElmBorderWidth = panelStuff.querySelector('#inpElmBorderWidth');
    inpElmBorderWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderWidth').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderStyle = 'solid'; //refresh
        elm.style.borderWidth = val + panelStuff.querySelector('#inpElmBorderWidthUnit').value;
        elm.style.borderStyle = panelStuff.querySelector('#inpElmBorderStyle').value;
      } else {
        elm.style.borderStyle = 'solid'; //refresh
        elm.style.borderWidth = '';
        elm.style.borderStyle = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border width unit
    var inpElmBorderWidthUnit = panelStuff.querySelector('#inpElmBorderWidthUnit');
    inpElmBorderWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var unit = panelStuff.querySelector('#inpElmBorderWidthUnit').value;
      if (unit === 'none') {
        elm.style.border = 'none';
        elm.style.borderWidth = '';
        elm.style.borderStyle = '';
      } else {
        elm.style.borderWidth = panelStuff.querySelector('#inpElmBorderWidth').value + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border style
    var inpElmBorderStyle = panelStuff.querySelector('#inpElmBorderStyle');
    inpElmBorderStyle.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderStyle').value;
      elm.style.borderStyle = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border top width
    var inpElmBorderTopWidth = panelStuff.querySelector('#inpElmBorderTopWidth');
    inpElmBorderTopWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderTopWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderTopWidth').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderTopStyle = 'solid'; //refresh
        elm.style.borderTopWidth = val + panelStuff.querySelector('#inpElmBorderTopWidthUnit').value;
        elm.style.borderTopStyle = panelStuff.querySelector('#inpElmBorderTopStyle').value;
      } else {
        elm.style.borderTopStyle = 'solid'; //refresh
        elm.style.borderTopWidth = '';
        elm.style.borderTopStyle = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border top width unit
    var inpElmBorderTopWidthUnit = panelStuff.querySelector('#inpElmBorderTopWidthUnit');
    inpElmBorderTopWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var unit = panelStuff.querySelector('#inpElmBorderTopWidthUnit').value;
      if (unit === 'none') {
        elm.style.borderTop = 'none';
        elm.style.borderTopWidth = '';
        elm.style.borderTopStyle = '';
        _this.panelStuff.querySelector('#inpElmBorderTopWidth').value = '';
        _this.panelStuff.querySelector('#inpElmBorderTopStyle').value = '';
      } else {
        elm.style.borderTopWidth = panelStuff.querySelector('#inpElmBorderTopWidth').value + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border top style
    var inpElmBorderTopStyle = panelStuff.querySelector('#inpElmBorderTopStyle');
    inpElmBorderTopStyle.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderTopStyle').value;
      elm.style.borderTopStyle = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border bottom width
    var inpElmBorderBottomWidth = panelStuff.querySelector('#inpElmBorderBottomWidth');
    inpElmBorderBottomWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderBottomWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderBottomWidth').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderBottomStyle = 'solid'; //refresh
        elm.style.borderBottomWidth = val + panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value;
        elm.style.borderBottomStyle = panelStuff.querySelector('#inpElmBorderBottomStyle').value;
      } else {
        elm.style.borderBottomStyle = 'solid'; //refresh
        elm.style.borderBottomWidth = '';
        elm.style.borderBottomStyle = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border bottom width unit
    var inpElmBorderBottomWidthUnit = panelStuff.querySelector('#inpElmBorderBottomWidthUnit');
    inpElmBorderBottomWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var unit = panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value;
      if (unit === 'none') {
        elm.style.borderBottom = 'none';
        elm.style.borderBottomWidth = '';
        elm.style.borderBottomStyle = '';
        _this.panelStuff.querySelector('#inpElmBorderBottomWidth').value = '';
        _this.panelStuff.querySelector('#inpElmBorderBottomStyle').value = '';
      } else {
        elm.style.borderBottomWidth = panelStuff.querySelector('#inpElmBorderBottomWidth').value + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border bottom style
    var inpElmBorderBottomStyle = panelStuff.querySelector('#inpElmBorderBottomStyle');
    inpElmBorderBottomStyle.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderBottomStyle').value;
      elm.style.borderBottomStyle = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border left width
    var inpElmBorderLeftWidth = panelStuff.querySelector('#inpElmBorderLeftWidth');
    inpElmBorderLeftWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderLeftWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderLeftWidth').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderLeftStyle = 'solid'; //refresh
        elm.style.borderLeftWidth = val + panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value;
        elm.style.borderLeftStyle = panelStuff.querySelector('#inpElmBorderLeftStyle').value;
      } else {
        elm.style.borderLeftStyle = 'solid'; //refresh
        elm.style.borderLeftWidth = '';
        elm.style.borderLeftStyle = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border left width unit
    var inpElmBorderLeftWidthUnit = panelStuff.querySelector('#inpElmBorderLeftWidthUnit');
    inpElmBorderLeftWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var unit = panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value;
      if (unit === 'none') {
        elm.style.borderLeft = 'none';
        elm.style.borderLeftWidth = '';
        elm.style.borderLeftStyle = '';
        _this.panelStuff.querySelector('#inpElmBorderLeftWidth').value = '';
        _this.panelStuff.querySelector('#inpElmBorderLeftStyle').value = '';
      } else {
        elm.style.borderLeftWidth = panelStuff.querySelector('#inpElmBorderLeftWidth').value + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border left style
    var inpElmBorderLeftStyle = panelStuff.querySelector('#inpElmBorderLeftStyle');
    inpElmBorderLeftStyle.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderLeftStyle').value;
      elm.style.borderLeftStyle = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border right width
    var inpElmBorderRightWidth = panelStuff.querySelector('#inpElmBorderRightWidth');
    inpElmBorderRightWidth.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderRightWidth.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderRightWidth').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderRightStyle = 'solid'; //refresh
        elm.style.borderRightWidth = val + panelStuff.querySelector('#inpElmBorderRightWidthUnit').value;
        elm.style.borderRightStyle = panelStuff.querySelector('#inpElmBorderRightStyle').value;
      } else {
        elm.style.borderRightStyle = 'solid'; //refresh
        elm.style.borderRightWidth = '';
        elm.style.borderRightStyle = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border right width unit
    var inpElmBorderRightWidthUnit = panelStuff.querySelector('#inpElmBorderRightWidthUnit');
    inpElmBorderRightWidthUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var unit = panelStuff.querySelector('#inpElmBorderRightWidthUnit').value;
      if (unit === 'none') {
        elm.style.borderRight = 'none';
        elm.style.borderRightWidth = '';
        elm.style.borderRightStyle = '';
        _this.panelStuff.querySelector('#inpElmBorderRightWidth').value = '';
        _this.panelStuff.querySelector('#inpElmBorderRightStyle').value = '';
      } else {
        elm.style.borderRightWidth = panelStuff.querySelector('#inpElmBorderRightWidth').value + unit;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });

    // Border right style
    var inpElmBorderRightStyle = panelStuff.querySelector('#inpElmBorderRightStyle');
    inpElmBorderRightStyle.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderRightStyle').value;
      elm.style.borderRightStyle = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_border_createClass(ElementBorderStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      this.panelStuff.querySelector('.input-elm-bordercolor').style.backgroundColor = elm.style.borderColor;
      this.panelStuff.querySelector('.input-elm-bordertopcolor').style.backgroundColor = elm.style.borderTopColor;
      this.panelStuff.querySelector('.input-elm-borderbottomcolor').style.backgroundColor = elm.style.borderBottomColor;
      this.panelStuff.querySelector('.input-elm-borderleftcolor').style.backgroundColor = elm.style.borderLeftColor;
      this.panelStuff.querySelector('.input-elm-borderrightcolor').style.backgroundColor = elm.style.borderRightColor;
      this.panelStuff.querySelector('#inpElmBorderWidth').value = '';
      this.panelStuff.querySelector('#inpElmBorderWidthUnit').value = '';
      this.panelStuff.querySelector('#inpElmBorderStyle').value = '';
      var s = elm.style.borderWidth;
      var nBorderWidth = parseInt(s);
      if (!isNaN(nBorderWidth)) {
        if (s.indexOf('px') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderWidthUnit').value = 'px';
        }
        if (s.indexOf('vw') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderWidthUnit').value = 'vw';
        }
        if (s.indexOf('vh') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderWidthUnit').value = 'vh';
        }
        if (s.indexOf('em') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderWidthUnit').value = 'em';
        }
        this.panelStuff.querySelector('#inpElmBorderWidth').value = nBorderWidth;
        s = elm.style.borderStyle;
        if (s.indexOf('solid') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderStyle').value = 'solid';
        }
        if (s.indexOf('dashed') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderStyle').value = 'dashed';
        }
        if (s.indexOf('dotted') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderStyle').value = 'dotted';
        }
      } else {
        s = elm.style.border;
        if (s.indexOf('none') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderWidthUnit').value = 'none';
          this.panelStuff.querySelector('#inpElmBorderWidth').value = '';
          this.panelStuff.querySelector('#inpElmBorderStyle').value = '';
        }
      }
      this.panelStuff.querySelector('#inpElmBorderTopWidth').value = '';
      this.panelStuff.querySelector('#inpElmBorderTopWidthUnit').value = '';
      this.panelStuff.querySelector('#inpElmBorderTopStyle').value = '';
      s = elm.style.borderTopWidth;
      var nBorderTopWidth = parseInt(s);
      if (!isNaN(nBorderTopWidth)) {
        if (s.indexOf('px') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopWidthUnit').value = 'px';
        }
        if (s.indexOf('vw') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopWidthUnit').value = 'vw';
        }
        if (s.indexOf('vh') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopWidthUnit').value = 'vh';
        }
        if (s.indexOf('em') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopWidthUnit').value = 'em';
        }
        this.panelStuff.querySelector('#inpElmBorderTopWidth').value = nBorderTopWidth;
        if (s.indexOf('solid') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopStyle').value = 'solid';
        }
        if (s.indexOf('dashed') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopStyle').value = 'dashed';
        }
        if (s.indexOf('dotted') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopStyle').value = 'dotted';
        }
      } else {
        s = elm.style.borderTop;
        if (s.indexOf('none') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderTopWidthUnit').value = 'none';
          this.panelStuff.querySelector('#inpElmBorderTopWidth').value = '';
          this.panelStuff.querySelector('#inpElmBorderTopStyle').value = '';
        }
      }
      this.panelStuff.querySelector('#inpElmBorderBottomWidth').value = '';
      this.panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value = '';
      this.panelStuff.querySelector('#inpElmBorderBottomStyle').value = '';
      s = elm.style.borderBottomWidth;
      var nBorderBottomWidth = parseInt(s);
      if (!isNaN(nBorderBottomWidth)) {
        if (s.indexOf('px') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value = 'px';
        }
        if (s.indexOf('vw') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value = 'vw';
        }
        if (s.indexOf('vh') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value = 'vh';
        }
        if (s.indexOf('em') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value = 'em';
        }
        this.panelStuff.querySelector('#inpElmBorderBottomWidth').value = nBorderBottomWidth;
        if (s.indexOf('solid') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomStyle').value = 'solid';
        }
        if (s.indexOf('dashed') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomStyle').value = 'dashed';
        }
        if (s.indexOf('dotted') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomStyle').value = 'dotted';
        }
      } else {
        s = elm.style.borderBottom;
        if (s.indexOf('none') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderBottomWidthUnit').value = 'none';
          this.panelStuff.querySelector('#inpElmBorderBottomWidth').value = '';
          this.panelStuff.querySelector('#inpElmBorderBottomStyle').value = '';
        }
      }
      this.panelStuff.querySelector('#inpElmBorderLeftWidth').value = '';
      this.panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value = '';
      this.panelStuff.querySelector('#inpElmBorderLeftStyle').value = '';
      s = elm.style.borderLeftWidth;
      var nBorderLeftWidth = parseInt(s);
      if (!isNaN(nBorderLeftWidth)) {
        if (s.indexOf('px') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value = 'px';
        }
        if (s.indexOf('vw') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value = 'vw';
        }
        if (s.indexOf('vh') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value = 'vh';
        }
        if (s.indexOf('em') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value = 'em';
        }
        this.panelStuff.querySelector('#inpElmBorderLeftWidth').value = nBorderLeftWidth;
        if (s.indexOf('solid') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftStyle').value = 'solid';
        }
        if (s.indexOf('dashed') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftStyle').value = 'dashed';
        }
        if (s.indexOf('dotted') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftStyle').value = 'dotted';
        }
      } else {
        s = elm.style.borderLeft;
        if (s.indexOf('none') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderLeftWidthUnit').value = 'none';
          this.panelStuff.querySelector('#inpElmBorderLeftWidth').value = '';
          this.panelStuff.querySelector('#inpElmBorderLeftStyle').value = '';
        }
      }
      this.panelStuff.querySelector('#inpElmBorderRightWidth').value = '';
      this.panelStuff.querySelector('#inpElmBorderRightWidthUnit').value = '';
      this.panelStuff.querySelector('#inpElmBorderRightStyle').value = '';
      s = elm.style.borderRightWidth;
      var nBorderRightWidth = parseInt(s);
      if (!isNaN(nBorderRightWidth)) {
        if (s.indexOf('px') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightWidthUnit').value = 'px';
        }
        if (s.indexOf('vw') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightWidthUnit').value = 'vw';
        }
        if (s.indexOf('vh') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightWidthUnit').value = 'vh';
        }
        if (s.indexOf('em') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightWidthUnit').value = 'em';
        }
        this.panelStuff.querySelector('#inpElmBorderRightWidth').value = nBorderRightWidth;
        if (s.indexOf('solid') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightStyle').value = 'solid';
        }
        if (s.indexOf('dashed') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightStyle').value = 'dashed';
        }
        if (s.indexOf('dotted') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightStyle').value = 'dotted';
        }
      } else {
        s = elm.style.borderRight;
        if (s.indexOf('none') !== -1) {
          this.panelStuff.querySelector('#inpElmBorderRightWidthUnit').value = 'none';
          this.panelStuff.querySelector('#inpElmBorderRightWidth').value = '';
          this.panelStuff.querySelector('#inpElmBorderRightStyle').value = '';
        }
      }
    }
  }]);
  return ElementBorderStyles;
}();
/* harmony default export */ const elementpanel_border = (ElementBorderStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-text.js
function elementpanel_text_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_text_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_text_typeof(obj); }
function elementpanel_text_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_text_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_text_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_text_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_text_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_text_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_text_toPropertyKey(arg) { var key = elementpanel_text_toPrimitive(arg, "string"); return elementpanel_text_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_text_toPrimitive(input, hint) { if (elementpanel_text_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_text_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_text_dom = new Dom();
var ElementTextStyles = /*#__PURE__*/function () {
  function ElementTextStyles(builder) {
    var _this = this;
    elementpanel_text_classCallCheck(this, ElementTextStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementText');
    this.panelStuff = panelStuff;
    var html = "\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>Text Color:</div>\n                <div>\n                    <button title=\"".concat(util.out('Text Color'), "\" class=\"input-elm-color is-btn-color\"></button>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Font Size'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmFontSize\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmFontSizeUnit\">\n                        <option value=\"\"></option>\n                        <option value=\"px\">px</option>\n                        <option value=\"pt\">pt</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"vmin\">vmin</option>\n                        <option value=\"vmax\">vmax</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Text Align'), ":</div>\n                <div>\n                    <select id=\"inpElmTextAlign\">\n                        <option value=\"\"></option>\n                        <option value=\"left\">").concat(util.out('Left'), "</option>\n                        <option value=\"center\">").concat(util.out('Center'), "</option>\n                        <option value=\"right\">").concat(util.out('Right'), "</option>\n                        <option value=\"justify\">").concat(util.out('Full'), "</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Line Height'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmLineHeight\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmLineHeightUnit\">\n                        <option value=\"\"></option>\n                        <option value=\"px\">px</option>\n                        <option value=\"pt\">pt</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Font Weight'), ":</div>\n                <div>\n                    <select id=\"inpElmFontWeight\">\n                        <option value=\"\"></option>\n                        <option value=\"100\">100</option>\n                        <option value=\"200\">200</option>\n                        <option value=\"300\">300</option>\n                        <option value=\"400\">400</option>\n                        <option value=\"500\">500</option>\n                        <option value=\"600\">600</option>\n                        <option value=\"700\">700</option>\n                        <option value=\"800\">800</option>\n                        <option value=\"900\">900</option>\n                        <option value=\"bold\">").concat(util.out('Bold'), "</option>\n                        <option value=\"normal\">").concat(util.out('Normal'), "</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Font Style'), ":</div>\n                <div>\n                    <select id=\"inpElmFontStyle\">\n                        <option value=\"\"></option>\n                        <option value=\"italic\">").concat(util.out('Italic'), "</option>\n                        <option value=\"normal\">").concat(util.out('Normal'), "</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Text Transform'), ":</div>\n                <div>\n                    <select id=\"inpElmTextTransform\">\n                        <option value=\"\"></option>\n                        <option value=\"uppercase\">").concat(util.out('Uppercase'), "</option>\n                        <option value=\"lowercase\">").concat(util.out('Lowercase'), "</option>\n                        <option value=\"capitalize\">").concat(util.out('Capitalize'), "</option>\n                        <option value=\"none\">").concat(util.out('None'), "</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Text Decoration'), ":</div>\n                <div>\n                    <select id=\"inpElmTextDecoration\">\n                        <option value=\"\"></option>\n                        <option value=\"underline\">").concat(util.out('Underline'), "</option>\n                        <option value=\"line-through\">").concat(util.out('Line Through'), "</option>\n                        <option value=\"overline\">").concat(util.out('Overline'), "</option>\n                        <option value=\"none\">").concat(util.out('None'), "</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Letter Spacing'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmLetterSpacing\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:115px;\">\n                <div>").concat(util.out('Word Spacing'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmWordSpacing\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n        ");
    elementpanel_text_dom.appendHtml(panelStuff, html);

    // Text color
    var btnElmTextColor = panelStuff.querySelector('.input-elm-color');
    btnElmTextColor.addEventListener('click', function (e) {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var elm = e.target;
      _this.builder.colorPicker.open(function (color) {
        _this.builder.inspectedElement.style.color = color;
        elm.style.backgroundColor = color; // preview

        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmTextColor.style.backgroundColor, function () {
        btnElmTextColor.removeAttribute('data-focus');
        btnElmTextColor.focus();
      });
      btnElmTextColor.setAttribute('data-focus', true);
    });

    /*
        Text Style
        by Tinara
    */

    var inpElmTextAlign = panelStuff.querySelector('#inpElmTextAlign');
    inpElmTextAlign.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmTextAlign').value;
      elm.style.textAlign = val;
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmFontWeight = panelStuff.querySelector('#inpElmFontWeight');
    inpElmFontWeight.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmFontWeight').value;
      elm.style.fontWeight = val;
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmFontStyle = panelStuff.querySelector('#inpElmFontStyle');
    inpElmFontStyle.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmFontStyle').value;
      elm.style.fontStyle = val;
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmTextTransform = panelStuff.querySelector('#inpElmTextTransform');
    inpElmTextTransform.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmTextTransform').value;
      elm.style.textTransform = val;
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmTextDecoration = panelStuff.querySelector('#inpElmTextDecoration');
    inpElmTextDecoration.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmTextDecoration').value;
      elm.style.textDecoration = val;
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmFontSize = panelStuff.querySelector('#inpElmFontSize');
    inpElmFontSize.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmFontSize.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmFontSize').value;
      if (val === '') {
        elm.style.fontSize = '';
        return;
      }
      var unit = panelStuff.querySelector('#inpElmFontSizeUnit').value;
      if (unit === '') {
        panelStuff.querySelector('#inpElmFontSizeUnit').value = 'px';
        unit = 'px';
      }
      if (!isNaN(val) && val !== '') {
        elm.style.fontSize = val + unit;
      } else {
        elm.style.fontSize = '';
      }

      // Get current class size & remove all class size from the element
      var arrSizes = _this.builder.opts.fontSizeClassValues;
      for (var i = 0; i <= arrSizes.length - 1; i++) {
        if (elementpanel_text_dom.hasClass(elm, 'size-' + arrSizes[i])) {
          elementpanel_text_dom.removeClass(elm, 'size-' + arrSizes[i]);
        }
      }
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmFontSizeUnit = panelStuff.querySelector('#inpElmFontSizeUnit');
    inpElmFontSizeUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmFontSize').value;
      var unit = panelStuff.querySelector('#inpElmFontSizeUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.fontSize = val + unit;
      } else {
        elm.style.fontSize = '';
      }
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmLineHeight = panelStuff.querySelector('#inpElmLineHeight');
    inpElmLineHeight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmLineHeight.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmLineHeight').value;
      var unit = panelStuff.querySelector('#inpElmLineHeightUnit').value;
      if (!isNaN(val) && val !== '') {
        elm.style.lineHeight = val + unit;
      } else {
        elm.style.lineHeight = '';
      }
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmLineHeightUnit = panelStuff.querySelector('#inpElmLineHeightUnit');
    inpElmLineHeightUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var unit = panelStuff.querySelector('#inpElmLineHeightUnit').value;
      var val = panelStuff.querySelector('#inpElmLineHeight').value;
      if (!isNaN(val) && val !== '') {
        elm.style.lineHeight = val + unit;
      } else {
        elm.style.lineHeight = '';
      }
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmLetterSpacing = panelStuff.querySelector('#inpElmLetterSpacing');
    inpElmLetterSpacing.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmLetterSpacing.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmLetterSpacing').value;
      if (!isNaN(val) && val !== '') {
        elm.style.letterSpacing = val + 'px';
      } else {
        elm.style.letterSpacing = '';
      }
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
    var inpElmWordSpacing = panelStuff.querySelector('#inpElmWordSpacing');
    inpElmWordSpacing.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmWordSpacing.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmWordSpacing').value;
      if (!isNaN(val) && val !== '') {
        elm.style.wordSpacing = val + 'px';
      } else {
        elm.style.wordSpacing = '';
      }
      elementStyleEditor.refresh();
      _this.builder.opts.onChange();
    });
  }
  elementpanel_text_createClass(ElementTextStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      this.panelStuff.querySelector('.input-elm-color').style.backgroundColor = elm.style.color;

      /*
          Text Style
          by Tinara
      */

      this.panelStuff.querySelector('#inpElmTextAlign').value = '';
      var sTextAlign = elm.style.textAlign;
      this.panelStuff.querySelector('#inpElmTextAlign').value = sTextAlign;
      this.panelStuff.querySelector('#inpElmFontSize').value = '';
      var nFontSize = parseFloat(elm.style.fontSize);
      if (!isNaN(nFontSize)) {
        this.panelStuff.querySelector('#inpElmFontSize').value = nFontSize;
      }
      var sFontSizeUnit;
      this.panelStuff.querySelector('#inpElmFontSizeUnit').value = 'px';
      var s = elm.style.fontSize;
      if (s.indexOf('px') !== -1) {
        sFontSizeUnit = 'px';
      }
      if (s.indexOf('pt') !== -1) {
        sFontSizeUnit = 'pt';
      }
      if (s.indexOf('em') !== -1) {
        sFontSizeUnit = 'em';
      }
      if (s.indexOf('vw') !== -1) {
        sFontSizeUnit = 'vw';
      }
      if (s.indexOf('vh') !== -1) {
        sFontSizeUnit = 'vh';
      }
      if (s.indexOf('vmin') !== -1) {
        sFontSizeUnit = 'vmin';
      }
      if (s.indexOf('vmax') !== -1) {
        sFontSizeUnit = 'vmax';
      }
      if (s.indexOf('%') !== -1) {
        sFontSizeUnit = '%';
      }
      this.panelStuff.querySelector('#inpElmFontSizeUnit').value = sFontSizeUnit;
      this.panelStuff.querySelector('#inpElmFontWeight').value = '';
      var sFontWeight = elm.style.fontWeight;
      this.panelStuff.querySelector('#inpElmFontWeight').value = sFontWeight;
      this.panelStuff.querySelector('#inpElmFontStyle').value = '';
      var sFontStyle = elm.style.fontStyle;
      this.panelStuff.querySelector('#inpElmFontStyle').value = sFontStyle;
      this.panelStuff.querySelector('#inpElmTextTransform').value = '';
      var sTextTransform = elm.style.textTransform;
      this.panelStuff.querySelector('#inpElmTextTransform').value = sTextTransform;
      this.panelStuff.querySelector('#inpElmTextDecoration').value = '';
      var sTextDecoration = elm.style.textDecoration;
      this.panelStuff.querySelector('#inpElmTextDecoration').value = sTextDecoration;
      this.panelStuff.querySelector('#inpElmLineHeight').value = '';
      if (!isNaN(elm.style.lineHeight)) {
        this.panelStuff.querySelector('#inpElmLineHeight').value = elm.style.lineHeight;
      } else {
        var nLineHeight = parseFloat(elm.style.lineHeight);
        if (!isNaN(nLineHeight)) {
          this.panelStuff.querySelector('#inpElmLineHeight').value = nLineHeight;
        }
      }
      var sLineHeightUnit;
      this.panelStuff.querySelector('#inpElmLineHeightUnit').value = '';
      s = elm.style.lineHeight;
      if (s.indexOf('px') !== -1) {
        sLineHeightUnit = 'px';
      }
      if (s.indexOf('pt') !== -1) {
        sLineHeightUnit = 'pt';
      }
      this.panelStuff.querySelector('#inpElmLineHeightUnit').value = sLineHeightUnit;
      this.panelStuff.querySelector('#inpElmLetterSpacing').value = '';
      var nLetterSpacing = parseFloat(elm.style.letterSpacing);
      if (!isNaN(nLetterSpacing)) {
        this.panelStuff.querySelector('#inpElmLetterSpacing').value = nLetterSpacing;
      }
      this.panelStuff.querySelector('#inpElmWordSpacing').value = '';
      var nWordSpacing = parseFloat(elm.style.wordSpacing);
      if (!isNaN(nWordSpacing)) {
        this.panelStuff.querySelector('#inpElmWordSpacing').value = nWordSpacing;
      }
    }
  }]);
  return ElementTextStyles;
}();
/* harmony default export */ const elementpanel_text = (ElementTextStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-corner.js
function elementpanel_corner_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_corner_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_corner_typeof(obj); }
function elementpanel_corner_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_corner_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_corner_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_corner_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_corner_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_corner_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_corner_toPropertyKey(arg) { var key = elementpanel_corner_toPrimitive(arg, "string"); return elementpanel_corner_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_corner_toPrimitive(input, hint) { if (elementpanel_corner_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_corner_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_corner_dom = new Dom();
var ElementCornerStyles = /*#__PURE__*/function () {
  function ElementCornerStyles(builder) {
    var _this = this;
    elementpanel_corner_classCallCheck(this, ElementCornerStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementCorner');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top: 13px;font-weight: bold;width:100%;\">".concat(util.out('Corners'), "</div>\n\n            <div class=\"is-settings\" style=\"width:100%;margin-bottom:9px;\">\n                <div>").concat(util.out('Border Radius'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmBorderRadius\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n\n            <div style=\"margin-top: 25px;font-weight: bold;width:100%;\">").concat(util.out('Individual Corners'), "</div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Top Left'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmBorderTopLeftRadius\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Top Right'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmBorderTopRightRadius\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Bottom Left'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmBorderBottomLeftRadius\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Bottom Right'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmBorderBottomRightRadius\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n        ");
    elementpanel_corner_dom.appendHtml(panelStuff, html);
    var inpElmBorderRadius = panelStuff.querySelector('#inpElmBorderRadius');
    inpElmBorderRadius.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderRadius.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderRadius').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderRadius = val + 'px';
      } else {
        elm.style.borderRadius = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmBorderTopLeftRadius = panelStuff.querySelector('#inpElmBorderTopLeftRadius');
    inpElmBorderTopLeftRadius.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderTopLeftRadius.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderTopLeftRadius').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderTopLeftRadius = val + 'px';
      } else {
        elm.style.borderTopLeftRadius = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmBorderTopRightRadius = panelStuff.querySelector('#inpElmBorderTopRightRadius');
    inpElmBorderTopRightRadius.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderTopRightRadius.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderTopRightRadius').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderTopRightRadius = val + 'px';
      } else {
        elm.style.borderTopRightRadius = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmBorderBottomLeftRadius = panelStuff.querySelector('#inpElmBorderBottomLeftRadius');
    inpElmBorderBottomLeftRadius.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderBottomLeftRadius.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderBottomLeftRadius').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderBottomLeftRadius = val + 'px';
      } else {
        elm.style.borderBottomLeftRadius = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmBorderBottomRightRadius = panelStuff.querySelector('#inpElmBorderBottomRightRadius');
    inpElmBorderBottomRightRadius.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBorderBottomRightRadius.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBorderBottomRightRadius').value;
      if (!isNaN(val) && val !== '') {
        elm.style.borderBottomRightRadius = val + 'px';
      } else {
        elm.style.borderBottomRightRadius = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_corner_createClass(ElementCornerStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var inpElmBorderRadius = panelStuff.querySelector('#inpElmBorderRadius');
      inpElmBorderRadius.value = '';
      var s = elm.style.borderRadius;
      var nBorderRadius = parseInt(s);
      if (!isNaN(nBorderRadius)) {
        inpElmBorderRadius.value = nBorderRadius;
      }
      var inpElmBorderTopLeftRadius = panelStuff.querySelector('#inpElmBorderTopLeftRadius');
      inpElmBorderTopLeftRadius.value = '';
      s = elm.style.borderTopLeftRadius;
      var nBorderTopLeftRadius = parseInt(s);
      if (!isNaN(nBorderTopLeftRadius)) {
        inpElmBorderTopLeftRadius.value = nBorderTopLeftRadius;
      }
      var inpElmBorderTopRightRadius = panelStuff.querySelector('#inpElmBorderTopRightRadius');
      inpElmBorderTopRightRadius.value = '';
      s = elm.style.borderTopRightRadius;
      var nBorderTopRightRadius = parseInt(s);
      if (!isNaN(nBorderTopRightRadius)) {
        inpElmBorderTopRightRadius.value = nBorderTopRightRadius;
      }
      var inpElmBorderBottomLeftRadius = panelStuff.querySelector('#inpElmBorderBottomLeftRadius');
      inpElmBorderBottomLeftRadius.value = '';
      s = elm.style.borderBottomLeftRadius;
      var nBorderBottomLeftRadius = parseInt(s);
      if (!isNaN(nBorderBottomLeftRadius)) {
        inpElmBorderBottomLeftRadius.value = nBorderBottomLeftRadius;
      }
      var inpElmBorderBottomRightRadius = panelStuff.querySelector('#inpElmBorderBottomRightRadius');
      inpElmBorderBottomRightRadius.value = '';
      s = elm.style.borderBottomRightRadius;
      var nBorderBottomRightRadius = parseInt(s);
      if (!isNaN(nBorderBottomRightRadius)) {
        inpElmBorderBottomRightRadius.value = nBorderBottomRightRadius;
      }
    }
  }]);
  return ElementCornerStyles;
}();
/* harmony default export */ const elementpanel_corner = (ElementCornerStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-shadow.js
function elementpanel_shadow_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_shadow_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_shadow_typeof(obj); }
function elementpanel_shadow_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_shadow_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_shadow_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_shadow_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_shadow_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_shadow_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_shadow_toPropertyKey(arg) { var key = elementpanel_shadow_toPrimitive(arg, "string"); return elementpanel_shadow_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_shadow_toPrimitive(input, hint) { if (elementpanel_shadow_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_shadow_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_shadow_dom = new Dom();
var ElementShadowStyles = /*#__PURE__*/function () {
  function ElementShadowStyles(builder) {
    var _this = this;
    elementpanel_shadow_classCallCheck(this, ElementShadowStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementShadow');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top:13px;font-weight:bold;width:100%;\">".concat(util.out('Shadow'), "</div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('x Offset'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmBoxShadowX\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmBoxShadowXUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('y Offset'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmBoxShadowY\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmBoxShadowYUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Blur'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmBoxShadowBlur\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmBoxShadowBlurUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Spread'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmBoxShadowSpread\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmBoxShadowSpreadUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div>").concat(util.out('Shadow Color'), ":</div>\n                <div>\n                <button title=\"").concat(util.out('Shadow Color'), "\" class=\"input-elm-shadowcolor is-btn-color\"></button>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div>").concat(util.out('Outer/Inner Shadow'), ":</div>\n                <div>\n                    <select id=\"inpElmBoxShadowInset\">\n                        <option value=\"\">Outset</option>\n                        <option value=\"inset\">Inset</option>\n                    </select>\n                </div>\n            </div>\n        ");
    elementpanel_shadow_dom.appendHtml(panelStuff, html);

    // Shadow color
    var btnElmShadowColor = panelStuff.querySelector('.input-elm-shadowcolor');
    btnElmShadowColor.addEventListener('click', function () {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      _this.builder.colorPicker.open(function (color) {
        btnElmShadowColor.style.backgroundColor = color; // preview

        _this.updateShadow(_this.builder.inspectedElement);
        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      }, btnElmShadowColor.style.backgroundColor, function () {
        btnElmShadowColor.removeAttribute('data-focus');
        btnElmShadowColor.focus();
      });
      btnElmShadowColor.setAttribute('data-focus', true);
    });
    var inps = panelStuff.querySelectorAll('#inpElmBoxShadowX,#inpElmBoxShadowY,#inpElmBoxShadowBlur,#inpElmBoxShadowSpread');
    Array.prototype.forEach.call(inps, function (inp) {
      inp.addEventListener('click', function () {
        _this.builder.uo.saveForUndo();
      });
      inp.addEventListener('keyup', function () {
        var elm = _this.builder.inspectedElement;
        _this.updateShadow(elm);
        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      });
    });
    inps = panelStuff.querySelectorAll('#inpElmBoxShadowXUnit,#inpElmBoxShadowYUnit,#inpElmBoxShadowBlurUnit,#inpElmBoxShadowSpreadUnit');
    Array.prototype.forEach.call(inps, function (inp) {
      inp.addEventListener('change', function () {
        _this.builder.uo.saveForUndo();
        var elm = _this.builder.inspectedElement;
        _this.updateShadow(elm);
        elementStyleEditor.refresh();

        //Trigger Change event
        _this.builder.opts.onChange();
      });
    });
    var inpElmBoxShadowInset = panelStuff.querySelector('#inpElmBoxShadowInset');
    inpElmBoxShadowInset.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      _this.updateShadow(elm);
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_shadow_createClass(ElementShadowStyles, [{
    key: "updateShadow",
    value: function updateShadow(elm) {
      var panelStuff = this.panelStuff;
      var shadowColor = panelStuff.querySelector('.input-elm-shadowcolor').style.backgroundColor;
      var shadowInset = panelStuff.querySelector('#inpElmBoxShadowInset').value;
      var val = panelStuff.querySelector('#inpElmBoxShadowX').value;
      var unit = panelStuff.querySelector('#inpElmBoxShadowXUnit').value;
      var offX = '';
      if (!isNaN(val) && val !== '') {
        offX = val + unit;
      }
      val = panelStuff.querySelector('#inpElmBoxShadowY').value;
      unit = panelStuff.querySelector('#inpElmBoxShadowYUnit').value;
      var offY = '';
      if (!isNaN(val) && val !== '') {
        offY = val + unit;
      }
      val = panelStuff.querySelector('#inpElmBoxShadowBlur').value;
      unit = panelStuff.querySelector('#inpElmBoxShadowBlurUnit').value;
      var blur = '';
      if (!isNaN(val) && val !== '') {
        blur = val + unit;
      }
      val = panelStuff.querySelector('#inpElmBoxShadowSpread').value;
      unit = panelStuff.querySelector('#inpElmBoxShadowSpreadUnit').value;
      var spread = '';
      if (!isNaN(val) && val !== '') {
        spread = val + unit;
      }
      elm.style.boxShadow = (offX + ' ' + offY + ' ' + blur + ' ' + spread + ' ' + shadowColor + ' ' + shadowInset).trim();
    }
  }, {
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var color, n;
      var sBoxShadow = elm.style.boxShadow;
      var inps = panelStuff.querySelectorAll('#inpElmBoxShadowX,#inpElmBoxShadowY,#inpElmBoxShadowBlur,#inpElmBoxShadowSpread');
      Array.prototype.forEach.call(inps, function (inp) {
        inp.value = '';
      });
      inps = panelStuff.querySelectorAll('#inpElmBoxShadowXUnit,#inpElmBoxShadowYUnit,#inpElmBoxShadowBlurUnit,#inpElmBoxShadowSpreadUnit');
      Array.prototype.forEach.call(inps, function (inp) {
        inp.value = 'px';
      });
      panelStuff.querySelector('#inpElmBoxShadowInset').value = '';
      if (sBoxShadow.indexOf('inset') !== -1) {
        panelStuff.querySelector('#inpElmBoxShadowInset').value = 'inset';
        sBoxShadow = sBoxShadow.replace('inset', '');
      }
      if (sBoxShadow !== '') {
        if (sBoxShadow.indexOf('rgb') !== -1) {
          //always get rgb value, not hex
          color = sBoxShadow.substr(sBoxShadow.indexOf('rgb'));
          color = color.substr(0, color.indexOf(')') + 1);
          panelStuff.querySelector('.input-elm-shadowcolor').style.backgroundColor = color;
          n = sBoxShadow.split('rgb')[1].indexOf(')');
          sBoxShadow = sBoxShadow.split('rgb')[0] + sBoxShadow.split('rgb')[1].substr(n + 2);
        }
        if (sBoxShadow.indexOf('#') !== -1) {
          //never executed
          color = sBoxShadow.substr(sBoxShadow.indexOf('#'));
          color = color.substr(0, color.indexOf(' '));
          panelStuff.querySelector('.input-elm-shadowcolor').style.backgroundColor = color;
          n = sBoxShadow.split('#')[1].indexOf(' ');
          sBoxShadow = sBoxShadow.split('#')[0] + sBoxShadow.split('#')[1].substr(n + 2);
        }
        var array = sBoxShadow.split(' ');
        var length = array.length;
        n = 1;
        for (var i = 0; i < length; i++) {
          if (n === 1) {
            panelStuff.querySelector('#inpElmBoxShadowX').value = parseInt(array[i]);
            if (array[i].indexOf('px') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowXUnit').value = 'px';
            } else if (array[i].indexOf('em') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowXUnit').value = 'em';
            } else {
              panelStuff.querySelector('#inpElmBoxShadowX').value = '';
            }
          }
          if (n === 2) {
            panelStuff.querySelector('#inpElmBoxShadowY').value = parseInt(array[i]);
            if (array[i].indexOf('px') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowYUnit').value = 'px';
            } else if (array[i].indexOf('em') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowYUnit').value = 'em';
            } else {
              panelStuff.querySelector('#inpElmBoxShadowY').value = '';
            }
          }
          if (n === 3) {
            panelStuff.querySelector('#inpElmBoxShadowBlur').value = parseInt(array[i]);
            if (array[i].indexOf('px') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowBlurUnit').value = 'px';
            } else if (array[i].indexOf('em') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowBlurUnit').value = 'em';
            } else {
              panelStuff.querySelector('#inpElmBoxShadowBlur').value = '';
            }
          }
          if (n === 4) {
            panelStuff.querySelector('#inpElmBoxShadowSpread').value = parseInt(array[i]);
            if (array[i].indexOf('px') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowSpreadUnit').value = 'px';
            } else if (array[i].indexOf('em') !== -1) {
              panelStuff.querySelector('#inpElmBoxShadowSpreadUnit').value = 'em';
            } else {
              panelStuff.querySelector('#inpElmBoxShadowSpread').value = '';
            }
          }
          n++;
        }
      }
    }
  }]);
  return ElementShadowStyles;
}();
/* harmony default export */ const elementpanel_shadow = (ElementShadowStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-display.js
function elementpanel_display_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_display_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_display_typeof(obj); }
function elementpanel_display_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_display_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_display_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_display_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_display_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_display_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_display_toPropertyKey(arg) { var key = elementpanel_display_toPrimitive(arg, "string"); return elementpanel_display_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_display_toPrimitive(input, hint) { if (elementpanel_display_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_display_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_display_dom = new Dom();
var ElementDisplayStyles = /*#__PURE__*/function () {
  function ElementDisplayStyles(builder) {
    var _this = this;
    elementpanel_display_classCallCheck(this, ElementDisplayStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementDisplay');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top:13px;font-weight:bold;\">".concat(util.out('Display'), "</div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div style=\"display:flex\">\n                    <select id=\"inpElmDisplay\" style=\"width:110px;\">\n                        <option value=\"\"></option>\n                        <option value=\"block\">Block</option>\n                        <option value=\"inline-block\">Inline Block</option>\n                        <option value=\"inline\">Inline</option>\n                        <option value=\"flex\">Flex</option>\n                        <option value=\"none\">None</option>\n                    </select>\n                </div>\n            </div>\n\n            <div style=\"margin-top:25px;font-weight:bold;width:100%;\">").concat(util.out('Flex'), "</div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Direction'), ":</div>\n                <div style=\"display:flex\">\n                    <select id=\"inpElmFlexDirection\" style=\"width:110px;\">\n                        <option value=\"\"></option>\n                        <option value=\"row\">Row</option>\n                        <option value=\"row-reverse\">Row Reverse</option>\n                        <option value=\"column\">Column</option>\n                        <option value=\"column-reverse\">Column Reverse</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Wrap'), ":</div>\n                <div style=\"display:flex\">\n                    <select id=\"inpElmFlexWrap\" style=\"width:110px;\">\n                        <option value=\"\"></option>\n                        <option value=\"no-wrap\">No Wrap</option>\n                        <option value=\"wrap\">Wrap</option>\n                        <option value=\"wrap-reverse\">Wrap Reverse</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div>").concat(util.out('Justify Content'), ":</div>\n                <div style=\"display:flex\">\n                    <select id=\"inpElmJustifyContent\" style=\"width:110px;\">\n                        <option value=\"\"></option>\n                        <option value=\"center\">Center</option>\n                        <option value=\"flex-start\">Flex Start</option>\n                        <option value=\"flex-end\">Flex End</option>\n                        <option value=\"space-around\">Space Around</option>\n                        <option value=\"space-between\">Space Between</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Align Items'), ":</div>\n                <div style=\"display:flex\">\n                    <select id=\"inpElmAlignItems\" style=\"width:110px;\">\n                        <option value=\"\"></option>\n                        <option value=\"center\">Center</option>\n                        <option value=\"flex-start\">Flex Start</option>\n                        <option value=\"flex-end\">Flex End</option>\n                        <option value=\"stretch\">Stretch</option>\n                        <option value=\"baseline\">Baseline</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Align Content'), ":</div>\n                <div style=\"display:flex\">\n                    <select id=\"inpElmAlignContent\" style=\"width:110px;\">\n                        <option value=\"\"></option>\n                        <option value=\"center\">Center</option>\n                        <option value=\"flex-start\">Flex Start</option>\n                        <option value=\"flex-end\">Flex End</option>\n                        <option value=\"stretch\">Stretch</option>\n                        <option value=\"space-around\">Space Around</option>\n                        <option value=\"space-between\">Space Between</option>\n                    </select>\n                </div>\n            </div>\n        ");
    elementpanel_display_dom.appendHtml(panelStuff, html);
    var inpElmDisplay = panelStuff.querySelector('#inpElmDisplay');
    inpElmDisplay.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmDisplay').value;
      elm.style.display = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmFlexDirection = panelStuff.querySelector('#inpElmFlexDirection');
    inpElmFlexDirection.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmFlexDirection').value;
      elm.style.flexDirection = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmFlexWrap = panelStuff.querySelector('#inpElmFlexWrap');
    inpElmFlexWrap.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmFlexWrap').value;
      elm.style.flexWrap = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmJustifyContent = panelStuff.querySelector('#inpElmJustifyContent');
    inpElmJustifyContent.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmJustifyContent').value;
      elm.style.justifyContent = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmAlignItems = panelStuff.querySelector('#inpElmAlignItems');
    inpElmAlignItems.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmAlignItems').value;
      elm.style.alignItems = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmAlignContent = panelStuff.querySelector('#inpElmAlignContent');
    inpElmAlignContent.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmAlignContent').value;
      elm.style.alignContent = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_display_createClass(ElementDisplayStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var inpElmDisplay = panelStuff.querySelector('#inpElmDisplay');
      inpElmDisplay.value = '';
      var s = elm.style.display;
      if (s) inpElmDisplay.value = s;
      var inpElmFlexDirection = panelStuff.querySelector('#inpElmFlexDirection');
      inpElmFlexDirection.value = '';
      s = elm.style.flexDirection;
      if (s) inpElmFlexDirection.value = s;
      var inpElmFlexWrap = panelStuff.querySelector('#inpElmFlexWrap');
      inpElmFlexWrap.value = '';
      s = elm.style.flexWrap;
      if (s) inpElmFlexWrap.value = s;
      var inpElmJustifyContent = panelStuff.querySelector('#inpElmJustifyContent');
      inpElmJustifyContent.value = '';
      s = elm.style.justifyContent;
      if (s) inpElmJustifyContent.value = s;
      var inpElmAlignItems = panelStuff.querySelector('#inpElmAlignItems');
      inpElmAlignItems.value = '';
      s = elm.style.alignItems;
      if (s) inpElmAlignItems.value = s;
      var inpElmAlignContent = panelStuff.querySelector('#inpElmAlignContent');
      inpElmAlignContent.value = '';
      s = elm.style.alignContent;
      if (s) inpElmAlignContent.value = s;
    }
  }]);
  return ElementDisplayStyles;
}();
/* harmony default export */ const elementpanel_display = (ElementDisplayStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-position.js
function elementpanel_position_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_position_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_position_typeof(obj); }
function elementpanel_position_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_position_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_position_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_position_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_position_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_position_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_position_toPropertyKey(arg) { var key = elementpanel_position_toPrimitive(arg, "string"); return elementpanel_position_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_position_toPrimitive(input, hint) { if (elementpanel_position_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_position_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_position_dom = new Dom();
var ElementPositionStyles = /*#__PURE__*/function () {
  function ElementPositionStyles(builder) {
    var _this = this;
    elementpanel_position_classCallCheck(this, ElementPositionStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementPosition');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top:13px;font-weight:bold;width:100%;\">".concat(util.out('Position'), "</div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div style=\"display:flex\">\n                    <select id=\"inpElmPosition\">\n                        <option value=\"\"></option>\n                        <option value=\"relative\">Relative</option>\n                        <option value=\"absolute\">Absolute</option>\n                        <option value=\"fixed\">Fixed</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Top'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmTop\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmTopUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Left'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmLeft\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmLeftUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Bottom'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmBottom\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmBottomUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div>").concat(util.out('Right'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmRight\" value=\"\" style=\"width:45px\"/>\n                    <select id=\"inpElmRightUnit\">\n                        <option value=\"px\">px</option>\n                        <option value=\"em\">em</option>\n                        <option value=\"vw\">vw</option>\n                        <option value=\"vh\">vh</option>\n                        <option value=\"%\">%</option>\n                    </select>\n                </div>\n            </div>\n\n            <div style=\"margin-top: 25px;font-weight: bold;width:100%;\">").concat(util.out('Float'), "</div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div style=\"display:flex\">\n                    <select id=\"inpElmFloat\">\n                        <option value=\"\"></option>\n                        <option value=\"left\">Left</option>\n                        <option value=\"right\">Right</option>\n                        <option value=\"none\">None</option>\n                    </select>\n                </div>\n            </div>\n        ");
    elementpanel_position_dom.appendHtml(panelStuff, html);
    var inpElmPosition = panelStuff.querySelector('#inpElmPosition');
    inpElmPosition.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmPosition').value;
      elm.style.position = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmFloat = panelStuff.querySelector('#inpElmFloat');
    inpElmFloat.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmFloat').value;
      elm.style["float"] = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmTop = panelStuff.querySelector('#inpElmTop');
    inpElmTop.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmTopUnit = panelStuff.querySelector('#inpElmTopUnit');
    inpElmTop.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmTop.value;
      var unit = inpElmTopUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.top = val + unit;
      } else {
        elm.style.top = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmTopUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmTop.value;
      var unit = inpElmTopUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.top = val + unit;
      } else {
        elm.style.top = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmBottom = panelStuff.querySelector('#inpElmBottom');
    inpElmBottom.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmBottomUnit = panelStuff.querySelector('#inpElmBottomUnit');
    inpElmBottom.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmBottom.value;
      var unit = inpElmBottomUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.bottom = val + unit;
      } else {
        elm.style.bottom = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmBottomUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmBottom.value;
      var unit = inpElmBottomUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.bottom = val + unit;
      } else {
        elm.style.bottom = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmLeft = panelStuff.querySelector('#inpElmLeft');
    inpElmLeft.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmLeftUnit = panelStuff.querySelector('#inpElmLeftUnit');
    inpElmLeft.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmLeft.value;
      var unit = inpElmLeftUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.left = val + unit;
      } else {
        elm.style.left = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmLeftUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmLeft.value;
      var unit = inpElmLeftUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.left = val + unit;
      } else {
        elm.style.left = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmRight = panelStuff.querySelector('#inpElmRight');
    inpElmRight.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    var inpElmRightUnit = panelStuff.querySelector('#inpElmRightUnit');
    inpElmRight.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = inpElmRight.value;
      var unit = inpElmRightUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.right = val + unit;
      } else {
        elm.style.right = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inpElmRightUnit.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = inpElmRight.value;
      var unit = inpElmRightUnit.value;
      if (!isNaN(val) && val !== '') {
        elm.style.right = val + unit;
      } else {
        elm.style.right = '';
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_position_createClass(ElementPositionStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var inpElmPosition = panelStuff.querySelector('#inpElmPosition');
      inpElmPosition.value = '';
      var s = elm.style.position;
      inpElmPosition.value = s;
      var inpElmFloat = panelStuff.querySelector('#inpElmFloat');
      inpElmFloat.value = '';
      s = elm.style["float"];
      inpElmFloat.value = s;
      var inpElmTop = panelStuff.querySelector('#inpElmTop');
      var inpElmTopUnit = panelStuff.querySelector('#inpElmTopUnit');
      inpElmTop.value = '';
      inpElmTopUnit.value = 'px';
      s = elm.style.top;
      var nTop = parseInt(s);
      if (!isNaN(nTop)) {
        if (s.indexOf('%') !== -1) inpElmTopUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmTopUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmTopUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmTopUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmTopUnit.value = 'em';
        inpElmTop.value = nTop;
      }
      var inpElmBottom = panelStuff.querySelector('#inpElmBottom');
      var inpElmBottomUnit = panelStuff.querySelector('#inpElmBottomUnit');
      inpElmBottom.value = '';
      inpElmBottomUnit.value = 'px';
      s = elm.style.bottom;
      var nBottom = parseInt(s);
      if (!isNaN(nBottom)) {
        if (s.indexOf('%') !== -1) inpElmBottomUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmBottomUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmBottomUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmBottomUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmBottomUnit.value = 'em';
        inpElmBottom.value = nBottom;
      }
      var inpElmLeft = panelStuff.querySelector('#inpElmLeft');
      var inpElmLeftUnit = panelStuff.querySelector('#inpElmLeftUnit');
      inpElmLeft.value = '';
      inpElmLeftUnit.value = 'px';
      s = elm.style.left;
      var nLeft = parseInt(s);
      if (!isNaN(nLeft)) {
        if (s.indexOf('%') !== -1) inpElmLeftUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmLeftUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmLeftUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmLeftUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmLeftUnit.value = 'em';
        inpElmLeft.value = nLeft;
      }
      var inpElmRight = panelStuff.querySelector('#inpElmRight');
      var inpElmRightUnit = panelStuff.querySelector('#inpElmRightUnit');
      inpElmRight.value = '';
      inpElmRightUnit.value = 'px';
      s = elm.style.right;
      var nRight = parseInt(s);
      if (!isNaN(nRight)) {
        if (s.indexOf('%') !== -1) inpElmRightUnit.value = '%';
        if (s.indexOf('px') !== -1) inpElmRightUnit.value = 'px';
        if (s.indexOf('vw') !== -1) inpElmRightUnit.value = 'vw';
        if (s.indexOf('vh') !== -1) inpElmRightUnit.value = 'vh';
        if (s.indexOf('em') !== -1) inpElmRightUnit.value = 'em';
        inpElmRight.value = nRight;
      }
    }
  }]);
  return ElementPositionStyles;
}();
/* harmony default export */ const elementpanel_position = (ElementPositionStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-effect.js
function elementpanel_effect_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_effect_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_effect_typeof(obj); }
function elementpanel_effect_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_effect_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_effect_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_effect_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_effect_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_effect_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_effect_toPropertyKey(arg) { var key = elementpanel_effect_toPrimitive(arg, "string"); return elementpanel_effect_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_effect_toPrimitive(input, hint) { if (elementpanel_effect_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_effect_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var elementpanel_effect_dom = new Dom();
var ElementEffectStyles = /*#__PURE__*/function () {
  function ElementEffectStyles(builder) {
    var _this = this;
    elementpanel_effect_classCallCheck(this, ElementEffectStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var elementStyleEditor = new elementpanel_css(builder);
    var panelStuff = builderStuff.querySelector('#divElementEffect');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top:13px;font-weight:bold;\">".concat(util.out('Effects'), "</div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div>").concat(util.out('Opacity'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmOpacity\" value=\"\" style=\"width:45px\"/>\n                </div>\n            </div>\n\n            <div style=\"margin-top:25px;font-weight:bold;width:100%;\">").concat(util.out('Filters'), "</div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Blur'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmBlur\" value=\"\" style=\"width:45px\"/> &nbsp;px\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Brightness'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmBrightness\" value=\"\" style=\"width:45px\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Contrast'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmContrast\" value=\"\" style=\"width:45px\"/> &nbsp;%\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Grayscale'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmGrayscale\" value=\"\" style=\"width:45px\"/> &nbsp;%\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Hue Rotate'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmHueRotate\" value=\"\" style=\"width:45px\"/> &nbsp;<span style=\"font-size:12px\">deg</span>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Invert'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmInvert\" value=\"\" style=\"width:45px\"/> &nbsp;%\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Saturate'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmSaturate\" value=\"\" style=\"width:45px\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div>").concat(util.out('Sepia'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmSepia\" value=\"\" style=\"width:45px\"/> &nbsp;%\n                </div>\n            </div>\n        ");
    elementpanel_effect_dom.appendHtml(panelStuff, html);
    var inpElmOpacity = panelStuff.querySelector('#inpElmOpacity');
    inpElmOpacity.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmOpacity.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmOpacity').value;
      elm.style.opacity = val;
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var i;
    var inpElmBlur = panelStuff.querySelector('#inpElmBlur');
    inpElmBlur.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBlur.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBlur').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('blur') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'blur(' + val + 'px)';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' blur(' + val + 'px)';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmBrightness = panelStuff.querySelector('#inpElmBrightness');
    inpElmBrightness.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmBrightness.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmBrightness').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('brightness') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'brightness(' + val + ')';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' brightness(' + val + ')';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmContrast = panelStuff.querySelector('#inpElmContrast');
    inpElmContrast.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmContrast.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmContrast').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('contrast') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'contrast(' + val + '%)';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' contrast(' + val + '%)';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmGrayscale = panelStuff.querySelector('#inpElmGrayscale');
    inpElmGrayscale.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmGrayscale.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmGrayscale').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('grayscale') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'grayscale(' + val + '%)';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' grayscale(' + val + '%)';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmHueRotate = panelStuff.querySelector('#inpElmHueRotate');
    inpElmHueRotate.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmHueRotate.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmHueRotate').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('hue-rotate') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'hue-rotate(' + val + 'deg)';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' hue-rotate(' + val + 'deg)';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmInvert = panelStuff.querySelector('#inpElmInvert');
    inpElmInvert.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmInvert.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmInvert').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('invert') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'invert(' + val + '%)';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' invert(' + val + '%)';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmSaturate = panelStuff.querySelector('#inpElmSaturate');
    inpElmSaturate.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmSaturate.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmSaturate').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('saturate') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'saturate(' + val + ')';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' saturate(' + val + ')';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmSepia = panelStuff.querySelector('#inpElmSepia');
    inpElmSepia.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
    });
    inpElmSepia.addEventListener('keyup', function () {
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#inpElmSepia').value;
      var sFilter = elm.style.filter;
      sFilter = sFilter.replace('none', '');
      var arr = sFilter.split(' ');
      var exist = false;
      for (i = 0; i < arr.length; i++) {
        var s = arr[i];
        if (s.indexOf('sepia') !== -1) {
          if (!isNaN(val) && val !== '') {
            arr[i] = 'sepia(' + val + '%)';
          } else {
            arr[i] = '';
          }
          exist = true;
        }
      }
      if (!exist) {
        sFilter = sFilter + ' sepia(' + val + '%)';
      } else {
        sFilter = '';
        for (i = 0; i < arr.length; i++) {
          sFilter += ' ' + arr[i];
        }
      }
      if (sFilter.trim() === '') {
        elm.style.filter = 'none';
      } else {
        elm.style.filter = sFilter;
      }
      elementStyleEditor.refresh();

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_effect_createClass(ElementEffectStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var inpElmOpacity = panelStuff.querySelector('#inpElmOpacity');
      inpElmOpacity.value = '';
      var s = elm.style.opacity;
      if (s) inpElmOpacity.value = s;

      //filter
      var sFilter = elm.style.filter; // brightness(2) blur(1px) contrast(100%)'

      var arr = sFilter.split(' ');
      var inpElmBlur = panelStuff.querySelector('#inpElmBlur');
      inpElmBlur.value = '';
      var inpElmBrightness = panelStuff.querySelector('#inpElmBrightness');
      inpElmBrightness.value = '';
      var inpElmGrayscale = panelStuff.querySelector('#inpElmGrayscale');
      inpElmGrayscale.value = '';
      var inpElmContrast = panelStuff.querySelector('#inpElmContrast');
      inpElmContrast.value = '';
      var inpElmHueRotate = panelStuff.querySelector('#inpElmHueRotate');
      inpElmHueRotate.value = '';
      var inpElmInvert = panelStuff.querySelector('#inpElmInvert');
      inpElmInvert.value = '';
      var inpElmSaturate = panelStuff.querySelector('#inpElmSaturate');
      inpElmSaturate.value = '';
      var inpElmSepia = panelStuff.querySelector('#inpElmSepia');
      inpElmSepia.value = '';
      var val;
      for (var i = 0; i < arr.length; i++) {
        s = arr[i];
        if (s.indexOf('blur') !== -1) {
          //blur exists
          val = s.replace('blur(', '').replace(')', '');
          val = parseInt(val);
          inpElmBlur.value = val;
        }
        if (s.indexOf('brightness') !== -1) {
          //brightness exists
          val = s.replace('brightness(', '').replace(')', '');
          val = parseInt(val);
          inpElmBrightness.value = val;
        }
        if (s.indexOf('grayscale') !== -1) {
          //grayscale exists
          val = s.replace('grayscale(', '').replace(')', '');
          val = parseInt(val);
          inpElmGrayscale.value = val;
        }
        if (s.indexOf('contrast') !== -1) {
          //contrast exists
          val = s.replace('contrast(', '').replace(')', '');
          val = parseInt(val);
          inpElmContrast.value = val;
        }
        if (s.indexOf('hue-rotate') !== -1) {
          //hue-rotate exists
          val = s.replace('hue-rotate(', '').replace(')', '');
          val = parseInt(val);
          inpElmHueRotate.value = val;
        }
        if (s.indexOf('invert') !== -1) {
          //invert exists
          val = s.replace('invert(', '').replace(')', '');
          val = parseInt(val);
          inpElmInvert.value = val;
        }
        if (s.indexOf('saturate') !== -1) {
          //saturate exists
          val = s.replace('saturate(', '').replace(')', '');
          val = parseInt(val);
          inpElmSaturate.value = val;
        }
        if (s.indexOf('sepia') !== -1) {
          //sepia exists
          val = s.replace('sepia(', '').replace(')', '');
          val = parseInt(val);
          inpElmSepia.value = val;
        }
      }
    }
  }]);
  return ElementEffectStyles;
}();
/* harmony default export */ const elementpanel_effect = (ElementEffectStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-attribute.js
function elementpanel_attribute_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_attribute_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_attribute_typeof(obj); }
function elementpanel_attribute_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_attribute_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_attribute_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_attribute_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_attribute_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_attribute_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_attribute_toPropertyKey(arg) { var key = elementpanel_attribute_toPrimitive(arg, "string"); return elementpanel_attribute_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_attribute_toPrimitive(input, hint) { if (elementpanel_attribute_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_attribute_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var elementpanel_attribute_dom = new Dom();
var ElementAttributeStyles = /*#__PURE__*/function () {
  function ElementAttributeStyles(builder) {
    var _this = this;
    elementpanel_attribute_classCallCheck(this, ElementAttributeStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var panelStuff = builderStuff.querySelector('#divElementAttribute');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top:13px;font-weight:bold;width:100%;\">".concat(util.out('Attributes'), "</div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"width:100%\">").concat(util.out('Names'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttr1\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"width:100%\">").concat(util.out('Values'), ":</div>\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttrVal1\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttr2\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttrVal2\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttr3\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttrVal3\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttr4\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttrVal4\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttr5\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:120px;float:left;\">\n                <div style=\"display:flex\">\n                    <input type=\"text\" id=\"inpElmAttrVal5\" value=\"\" style=\"width:90%\"/>\n                </div>\n            </div>\n        ");
    elementpanel_attribute_dom.appendHtml(panelStuff, html);
    var inps = panelStuff.querySelectorAll('#inpElmAttr1,#inpElmAttr2,#inpElmAttr3,#inpElmAttr4,#inpElmAttr5,#inpElmAttrVal1,#inpElmAttrVal2,#inpElmAttrVal3,#inpElmAttrVal4,#inpElmAttrVal5');
    Array.prototype.forEach.call(inps, function (inp) {
      inp.addEventListener('click', function () {
        _this.builder.uo.saveForUndo();
      });
      inp.addEventListener('keyup', function () {
        var elm = _this.builder.inspectedElement;
        _this.updateAttributes(elm);

        //Trigger Change event
        _this.builder.opts.onChange();
      });
    });
  }
  elementpanel_attribute_createClass(ElementAttributeStyles, [{
    key: "updateAttributes",
    value: function updateAttributes(elm) {
      // Remove all attributes
      var attrs = {};
      Array.prototype.forEach.call(elm.attributes, function (attribute) {
        attrs[attribute.name] = attribute.value;
      });
      for (var k in attrs) {
        if (Object.prototype.hasOwnProperty.call(attrs, k)) {
          if (k !== 'id' && k !== 'style' && k !== 'class' && k !== 'href' && k !== 'src' && k !== 'contenteditable' && k !== 'data-filename') {
            elm.removeAttribute(k);
          }
        }
      }

      // Update
      var panelStuff = this.panelStuff;
      var attrname, val;
      attrname = panelStuff.querySelector('#inpElmAttr1').value;
      val = panelStuff.querySelector('#inpElmAttrVal1').value;
      if (attrname !== '') elm.setAttribute(attrname, val);
      attrname = panelStuff.querySelector('#inpElmAttr2').value;
      val = panelStuff.querySelector('#inpElmAttrVal2').value;
      if (attrname !== '') elm.setAttribute(attrname, val);
      attrname = panelStuff.querySelector('#inpElmAttr3').value;
      val = panelStuff.querySelector('#inpElmAttrVal3').value;
      if (attrname !== '') elm.setAttribute(attrname, val);
      attrname = panelStuff.querySelector('#inpElmAttr4').value;
      val = panelStuff.querySelector('#inpElmAttrVal4').value;
      if (attrname !== '') elm.setAttribute(attrname, val);
      attrname = panelStuff.querySelector('#inpElmAttr5').value;
      val = panelStuff.querySelector('#inpElmAttrVal5').value;
      if (attrname !== '') elm.setAttribute(attrname, val);
    }
  }, {
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var inps = panelStuff.querySelectorAll('#inpElmAttr1,#inpElmAttr2,#inpElmAttr3,#inpElmAttr4,#inpElmAttr5,#inpElmAttrVal1,#inpElmAttrVal2,#inpElmAttrVal3,#inpElmAttrVal4,#inpElmAttrVal5');
      Array.prototype.forEach.call(inps, function (inp) {
        inp.value = '';
      });
      var indx = 1;
      Array.prototype.forEach.call(elm.attributes, function (attribute) {
        if (attribute.name !== 'id' && attribute.name !== 'style' && attribute.name !== 'class' && attribute.name !== 'href' && attribute.name !== 'src' && attribute.name !== 'contenteditable' && attribute.name !== 'data-filename' && attribute.name !== 'data-saveforundo') {
          panelStuff.querySelector('#inpElmAttr' + indx).value = attribute.name;
          panelStuff.querySelector('#inpElmAttrVal' + indx).value = attribute.value;
          indx = indx + 1;
        }
      });
    }
  }]);
  return ElementAttributeStyles;
}();
/* harmony default export */ const elementpanel_attribute = (ElementAttributeStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-more.js
function elementpanel_more_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_more_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_more_typeof(obj); }
function elementpanel_more_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_more_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_more_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_more_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_more_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_more_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_more_toPropertyKey(arg) { var key = elementpanel_more_toPrimitive(arg, "string"); return elementpanel_more_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_more_toPrimitive(input, hint) { if (elementpanel_more_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_more_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var elementpanel_more_dom = new Dom();
var ElementMoreStyles = /*#__PURE__*/function () {
  function ElementMoreStyles(builder) {
    var _this = this;
    elementpanel_more_classCallCheck(this, ElementMoreStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var panelStuff = builderStuff.querySelector('#divElementMore');
    this.panelStuff = panelStuff;
    var html = "\n\n            <div class=\"is-settings\" style=\"width:100%;margin-bottom:9px;\">\n                <div>".concat(util.out('Add Element ID'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmId\" value=\"\" style=\"width:100%\"/>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:100%;margin-bottom:9px;\">\n                <div>").concat(util.out('Add Css Classes'), ":</div>\n                <div>\n                    <input type=\"text\" id=\"inpElmCssClasses\" value=\"\" style=\"width:100%\"/>\n                </div>\n            </div>\n\n        ");
    elementpanel_more_dom.appendHtml(panelStuff, html);
    var inpElmId = panelStuff.querySelector('#inpElmId');
    inpElmId.addEventListener('change', function () {
      var elm = _this.builder.inspectedElement;
      _this.builder.uo.saveForUndo();
      if (inpElmId.value !== '') {
        elm.setAttribute('id', inpElmId.value);
      } else {
        elm.removeAttribute('id');
      }

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var inpElmCssClasses = panelStuff.querySelector('#inpElmCssClasses');
    inpElmCssClasses.addEventListener('change', function () {
      var elm = _this.builder.inspectedElement;
      _this.builder.uo.saveForUndo();
      var arrCurrentClasses = [];
      var currentClasses = elm.getAttribute('data-class');
      if (currentClasses) arrCurrentClasses = currentClasses.split(' ');
      var arrNewClasses = [];
      var newClasses = inpElmCssClasses.value;
      arrNewClasses = newClasses.split(' ');
      arrCurrentClasses.forEach(function (item) {
        if (!arrNewClasses.includes(item)) {
          elm.classList.remove(item);
        }
      });
      arrNewClasses.forEach(function (item) {
        if (item !== '') elm.classList.add(item);
      });

      // save
      elm.setAttribute('data-class', newClasses);
      if (elm.getAttribute('data-class') === '') elm.removeAttribute('data-class');

      //Trigger Change event
      _this.builder.opts.onChange();
    });
  }
  elementpanel_more_createClass(ElementMoreStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      var panelStuff = this.panelStuff;
      var inpElmId = panelStuff.querySelector('#inpElmId');
      inpElmId.value = '';
      var rowId = elm.getAttribute('id');
      if (rowId) {
        inpElmId.value = rowId;
      }
      var inpElmCssClasses = panelStuff.querySelector('#inpElmCssClasses');
      inpElmCssClasses.value = '';
      var classes = elm.getAttribute('data-class');
      inpElmCssClasses.value = classes;
    }
  }]);
  return ElementMoreStyles;
}();
/* harmony default export */ const elementpanel_more = (ElementMoreStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel-animation.js
function elementpanel_animation_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_animation_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_animation_typeof(obj); }
function elementpanel_animation_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_animation_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_animation_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_animation_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_animation_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_animation_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_animation_toPropertyKey(arg) { var key = elementpanel_animation_toPrimitive(arg, "string"); return elementpanel_animation_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_animation_toPrimitive(input, hint) { if (elementpanel_animation_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_animation_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var elementpanel_animation_dom = new Dom();
var ElementAnimationStyles = /*#__PURE__*/function () {
  function ElementAnimationStyles(builder) {
    var _this = this;
    elementpanel_animation_classCallCheck(this, ElementAnimationStyles);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var panelStuff = builderStuff.querySelector('#divElementAnimation');
    this.panelStuff = panelStuff;
    var html = "\n            <div style=\"margin-top:13px;font-weight:bold;\">".concat(util.out('Animate'), "</div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div style=\"display:flex\">\n                    <select id=\"selElmAnim\">\n                        <option value=\"\"></option>\n                        <option value=\"fade\">fade</option>\n                        <option value=\"fade-up\">fade-up</option>\n                        <option value=\"fade-down\">fade-down</option>\n                        <option value=\"fade-left\">fade-left</option>\n                        <option value=\"fade-right\">fade-right</option>\n                        <option value=\"fade-up-right\">fade-up-right</option>\n                        <option value=\"fade-up-left\">fade-up-left</option>\n                        <option value=\"fade-down-right\">fade-down-right</option>\n                        <option value=\"fade-down-left\">fade-down-left</option>\n                        <option value=\"flip-up\">flip-up</option>\n                        <option value=\"flip-down\">flip-down</option>\n                        <option value=\"flip-left\">flip-left</option>\n                        <option value=\"flip-right\">flip-right</option>\n                        <option value=\"slide-up\">slide-up</option>\n                        <option value=\"slide-down\">slide-down</option>\n                        <option value=\"slide-left\">slide-left</option>\n                        <option value=\"slide-right\">slide-right</option>\n                        <option value=\"zoom-in\">zoom-in</option>\n                        <option value=\"zoom-in-up\">zoom-in-up</option>\n                        <option value=\"zoom-in-down\">zoom-in-down</option>\n                        <option value=\"zoom-in-left\">zoom-in-left</option>\n                        <option value=\"zoom-in-right\">zoom-in-right</option>\n                        <option value=\"zoom-out\">zoom-out</option>\n                        <option value=\"zoom-out-up\">zoom-out-up</option>\n                        <option value=\"zoom-out-down\">zoom-out-down</option>\n                        <option value=\"zoom-out-left\">zoom-out-left</option>\n                        <option value=\"zoom-out-right\">zoom-out-right</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div> ").concat(util.out('Delay'), ":</div>\n                <div>\n                    <select id=\"selElmAnimDelay\">\n                        <option value=\"\"></option>\n                        <option value=\"0\">0</option>\n                        <option value=\"100\">100</option>\n                        <option value=\"200\">200</option>\n                        <option value=\"300\">300</option>\n                        <option value=\"400\">400</option>\n                        <option value=\"500\">500</option>\n                        <option value=\"600\">600</option>\n                        <option value=\"700\">700</option>\n                        <option value=\"800\">800</option>\n                        <option value=\"900\">900</option>\n                        <option value=\"1000\">1000</option>\n                        <option value=\"1100\">1100</option>\n                        <option value=\"1200\">1200</option>\n                        <option value=\"1300\">1300</option>\n                        <option value=\"1400\">1400</option>\n                        <option value=\"1500\">1500</option>\n                        <option value=\"1600\">1600</option>\n                        <option value=\"1700\">1700</option>\n                        <option value=\"1800\">1800</option>\n                        <option value=\"1900\">1900</option>\n                        <option value=\"2000\">2000</option>\n                        <option value=\"2100\">2100</option>\n                        <option value=\"2200\">2200</option>\n                        <option value=\"2300\">2300</option>\n                        <option value=\"2400\">2400</option>\n                        <option value=\"2500\">2500</option>\n                        <option value=\"2600\">2600</option>\n                        <option value=\"2700\">2700</option>\n                        <option value=\"2800\">2800</option>\n                        <option value=\"2900\">2900</option>\n                        <option value=\"3000\">3000</option>\n                    </select> &nbsp;ms\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:110px;\">\n                <div> ").concat(util.out('Duration'), ":</div>\n                <div>\n                    <select id=\"selElmAnimDuration\">\n                        <option value=\"\"></option>\n                        <option value=\"0\">0</option>\n                        <option value=\"100\">100</option>\n                        <option value=\"200\">200</option>\n                        <option value=\"300\">300</option>\n                        <option value=\"400\">400</option>\n                        <option value=\"500\">500</option>\n                        <option value=\"600\">600</option>\n                        <option value=\"700\">700</option>\n                        <option value=\"800\">800</option>\n                        <option value=\"900\">900</option>\n                        <option value=\"1000\">1000</option>\n                        <option value=\"1100\">1100</option>\n                        <option value=\"1200\">1200</option>\n                        <option value=\"1300\">1300</option>\n                        <option value=\"1400\">1400</option>\n                        <option value=\"1500\">1500</option>\n                        <option value=\"1600\">1600</option>\n                        <option value=\"1700\">1700</option>\n                        <option value=\"1800\">1800</option>\n                        <option value=\"1900\">1900</option>\n                        <option value=\"2000\">2000</option>\n                        <option value=\"2100\">2100</option>\n                        <option value=\"2200\">2200</option>\n                        <option value=\"2300\">2300</option>\n                        <option value=\"2400\">2400</option>\n                        <option value=\"2500\">2500</option>\n                        <option value=\"2600\">2600</option>\n                        <option value=\"2700\">2700</option>\n                        <option value=\"2800\">2800</option>\n                        <option value=\"2900\">2900</option>\n                        <option value=\"3000\">3000</option>\n                    </select> &nbsp;ms\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div style=\"margin-top:15px\">\n                    <label for=\"chkAnimateOnce\"><input type=\"checkbox\" id=\"chkAnimateOnce\" value=\"\"> ").concat(util.out('Animate Once'), " </label>\n                </div>\n            </div>\n\n            <div class=\"is-settings\" style=\"width:100%;\">\n                <div style=\"display:flex\">\n                    <button title=\"").concat(util.out('Test'), "\" id=\"btnPreviewAnim\" class=\"classic\" value=\"\"> ").concat(util.out('TEST'), " </button>\n                </div>\n            </div>\n        ");
    elementpanel_animation_dom.appendHtml(panelStuff, html);
    var inp = panelStuff.querySelector('#selElmAnim');
    inp.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#selElmAnim').value;
      if (val === '') {
        elm.removeAttribute('data-aos');
      } else {
        elm.setAttribute('data-aos', val);
        panelStuff.querySelector('#btnPreviewAnim').click();
      }

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inp = panelStuff.querySelector('#selElmAnimDelay');
    inp.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#selElmAnimDelay').value;
      if (val === '') {
        elm.removeAttribute('data-aos-delay');
      } else {
        elm.setAttribute('data-aos-delay', val);
      }

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    inp = panelStuff.querySelector('#selElmAnimDuration');
    inp.addEventListener('change', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      var val = panelStuff.querySelector('#selElmAnimDuration').value;
      if (val === '') {
        elm.removeAttribute('data-aos-duration');
      } else {
        elm.setAttribute('data-aos-duration', val);
      }

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    var btn = panelStuff.querySelector('#chkAnimateOnce');
    btn.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.inspectedElement;
      if (panelStuff.querySelector('#chkAnimateOnce').checked) {
        elm.setAttribute('data-aos-once', 'true');
      } else {
        elm.removeAttribute('data-aos-once');
      }

      //Trigger Change event
      _this.builder.opts.onChange();
    });
    btn = panelStuff.querySelector('#btnPreviewAnim');
    btn.addEventListener('click', function () {
      var elm = _this.builder.inspectedElement;
      var animduration = elm.getAttribute('data-aos-duration');
      elm.removeAttribute('data-aos-duration'); //can cause preview problem

      elm.style.visibility = 'hidden';
      if (window.AOS) window.AOS.init({
        duration: 1
      });
      elementpanel_animation_dom.removeClass(elm, 'aos-init');
      elementpanel_animation_dom.removeClass(elm, 'aos-animate');
      setTimeout(function () {
        elm.style.visibility = '';
        if (window.AOS) window.AOS.init({
          duration: 1200
        });
        if (animduration) {
          elm.setAttribute('data-aos-duration', animduration);
        }
      }, 10);
    });
  }
  elementpanel_animation_createClass(ElementAnimationStyles, [{
    key: "readElementStyles",
    value: function readElementStyles(elm) {
      this.panelStuff.querySelector('#selElmAnimDelay').value = '';
      var animname = elm.getAttribute('data-aos-delay');
      this.panelStuff.querySelector('#selElmAnimDelay').value = animname;
      this.panelStuff.querySelector('#selElmAnimDuration').value = '';
      animname = elm.getAttribute('data-aos-duration');
      this.panelStuff.querySelector('#selElmAnimDuration').value = animname;
      this.panelStuff.querySelector('#chkAnimateOnce').checked = false;
      var animateonce = elm.getAttribute('data-aos-once');
      if (animateonce) {
        if (animateonce === 'true') {
          this.panelStuff.querySelector('#chkAnimateOnce').checked = true;
        }
      }
      this.panelStuff.querySelector('#selElmAnim').value = '';
      animname = elm.getAttribute('data-aos');
      this.panelStuff.querySelector('#selElmAnim').value = animname;
    }
  }]);
  return ElementAnimationStyles;
}();
/* harmony default export */ const elementpanel_animation = (ElementAnimationStyles);
;// CONCATENATED MODULE: ./src/contentbuilder/elementpanel.js
function elementpanel_typeof(obj) { "@babel/helpers - typeof"; return elementpanel_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementpanel_typeof(obj); }
function elementpanel_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementpanel_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementpanel_toPropertyKey(descriptor.key), descriptor); } }
function elementpanel_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementpanel_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementpanel_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementpanel_toPropertyKey(arg) { var key = elementpanel_toPrimitive(arg, "string"); return elementpanel_typeof(key) === "symbol" ? key : String(key); }
function elementpanel_toPrimitive(input, hint) { if (elementpanel_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementpanel_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
















var elementpanel_dom = new Dom();
var arrElms = [];
var ElementPanel = /*#__PURE__*/function () {
  function ElementPanel(builder) {
    elementpanel_classCallCheck(this, ElementPanel);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
  }
  elementpanel_createClass(ElementPanel, [{
    key: "renderPanel",
    value: function renderPanel() {
      var _this = this;
      var util = this.util;
      var builderStuff = this.builderStuff;
      var builder = this.builder;
      var panel = builderStuff.querySelector('.elementstyles');
      if (!panel) {
        var html = "\n            <div class=\"is-side".concat(this.builder.opts.sidePanel === 'right' ? '' : ' fromleft', " elementstyles\" style=\"display:none;\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                    <div class=\"elm-list\" style=\"z-index:1;width:100%;height:100px;position:absolute;top:0px;left:0px;box-sizing:border-box;display:flex;align-items:center;flex-wrap: wrap;padding:10px 23px 10px 18px;\"></div>\n                    \n                    <button tabindex=\"-1\" title=\"").concat(util.out('Close'), "\" class=\"is-side-close\" style=\"z-index:1;background:transparent;width:25px;height:25px;position:absolute;top:10px;right:13px;box-sizing:border-box;padding:0;line-height:25px;font-size: 12px;text-align:center;cursor:pointer;\"><svg class=\"is-icon-flex\" style=\"width:25px;height:25px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                    \n                    <div style=\"position: absolute;bottom:7px;right:7px;width:40px;height:25px;z-index:1;display:flex\">\n                        <button title=\"").concat(util.out('css'), "\" class=\"elm-editstyle classic\" style=\"width: 40px;height: 25px;font-family: sans-serif;font-size: 10px;padding: 0px;font-weight: bold;\">").concat(util.out('css'), "</button>\n                    </div>\n                        \n                    <div style=\"width:100%;height:100%;overflow-y:auto;overflow-x:hidden;position:absolute;top:0px;left:0px;box-sizing:border-box;border-top:100px solid transparent;padding:0px;\">\n                            \n                        <div class=\"is-tabs\" data-group=\"element\" style=\"padding-right:0;padding-bottom:0;\">\n                            <a title=\"").concat(util.out('General'), "\" id=\"tabElementGeneral\" href=\"\" data-content=\"divElementGeneral\" class=\"active\">").concat(util.out('General'), "</a>\n                            <a title=\"").concat(util.out('Box'), "\" id=\"tabElementBox\" href=\"\" data-content=\"divElementBox\">").concat(util.out('Box'), "</a>\n                            <a title=\"").concat(util.out('Spacing'), "\" id=\"tabElementSpacing\" href=\"\" data-content=\"divElementSpacing\">").concat(util.out('Spacing'), "</a>\n                            <a title=\"").concat(util.out('Text'), "\" id=\"tabElementText\" href=\"\" data-content=\"divElementText\">").concat(util.out('Text'), "</a>\n                            <a title=\"").concat(util.out('More'), "\" id=\"tabElementMore\" data-menu=\"divElementMoreItems\" href=\"\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-more\"></use></svg></a>\n                        </div>\n                        \n                        <ul id=\"divElementMoreItems\" style=\"top: 50px;left: 140px;\" class=\"is-tabs-more\" data-group=\"element\" tabindex=\"-1\" aria-modal=\"true\" aria-hidden=\"true\">\n                            <li title=\"").concat(util.out('Border'), "\" id=\"tabElementBorder\" data-content=\"divElementBorder\" tabindex=\"0\">").concat(util.out('Border'), "</li>\n                            <li title=\"").concat(util.out('Corners'), "\" id=\"tabElementCorner\" data-content=\"divElementCorner\" tabindex=\"0\">").concat(util.out('Corners'), "</li>\n                            <li title=\"").concat(util.out('Shadow'), "\" id=\"tabElementShadow\" data-content=\"divElementShadow\" tabindex=\"0\">").concat(util.out('Shadow'), "</li>\n                            <li title=\"").concat(util.out('Display'), "\" id=\"tabElementDisplay\" data-content=\"divElementDisplay\" tabindex=\"0\">").concat(util.out('Display'), "</li>\n                            <li title=\"").concat(util.out('Position'), "\" id=\"tabElementPosition\" data-content=\"divElementPosition\" tabindex=\"0\">").concat(util.out('Position'), "</li>\n                            <li title=\"").concat(util.out('Effects'), "\" id=\"tabElementEffect\" data-content=\"divElementEffect\" tabindex=\"0\">").concat(util.out('Effects'), "</li>\n                            <li style=\"display:none\" title=\"").concat(util.out('Attributes'), "\" id=\"tabElementAttribute\" data-content=\"divElementAttribute\" tabindex=\"0\">").concat(util.out('Attributes'), "</li>\n                            ").concat(this.builder.opts.elementAnimate === true ? "<li title=\"".concat(util.out('Animation'), "\" id=\"tabElementAnimation\" data-content=\"divElementAnimation\" tabindex=\"0\">").concat(util.out('Animation'), "</li>") : '', "\n                            <li title=\"").concat(util.out('More'), "\" id=\"tabElementMore\" data-content=\"divElementMore\" tabindex=\"0\">").concat(util.out('More'), "</li>\n                        </ul>\n                        \n                        <div id=\"divElementGeneral\" class=\"is-tab-content active\" tabindex=\"-1\" data-group=\"element\" style=\"display:flex;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n                        \n                        <div id=\"divElementBox\" class=\"is-tab-content active\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n\n                        <div id=\"divElementSpacing\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n\n                        <div id=\"divElementBorder\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n\n                        <div id=\"divElementText\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n\n                        <div id=\"divElementCorner\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n\n                        <div id=\"divElementShadow\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n                        \n                        <div id=\"divElementDisplay\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n                        \n                        <div id=\"divElementPosition\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n                        \n                        <div id=\"divElementEffect\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n                        \n                        <div id=\"divElementAttribute\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n                        \n                        <div id=\"divElementAnimation\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n\n                        <div id=\"divElementMore\" class=\"is-tab-content\" tabindex=\"-1\" data-group=\"element\" style=\"display:none;flex-flow:wrap;padding:12px 20px;\">\n                        </div>\n                    </div>\n            </div>              \n            ");
        elementpanel_dom.appendHtml(builderStuff, html);
        this.elementStyleEditor = new elementpanel_css(builder);
        panel = builderStuff.querySelector('.elementstyles');
        var btn = panel.querySelector('.is-side-close');
        elementpanel_dom.addEventListener(btn, 'click', function () {
          _this.hidePanel();
        });
        btn = panel.querySelector('.elm-editstyle');
        elementpanel_dom.addEventListener(btn, 'click', function () {
          _this.elementStyleEditor.toggleStyleEditor();
        });
        this.panel = panel;
        var elementBoxStyles = new elementpanel_box(builder);
        this.elementBoxStyles = elementBoxStyles;
        var elementGeneralStyles = new elementpanel_general(builder);
        this.elementGeneralStyles = elementGeneralStyles;
        var elementSpacingStyles = new elementpanel_spacing(builder);
        this.elementSpacingStyles = elementSpacingStyles;
        var elementBorderStyles = new elementpanel_border(builder);
        this.elementBorderStyles = elementBorderStyles;
        var elementTextStyles = new elementpanel_text(builder);
        this.elementTextStyles = elementTextStyles;
        var elementCornerStyles = new elementpanel_corner(builder);
        this.elementCornerStyles = elementCornerStyles;
        var elementShadowStyles = new elementpanel_shadow(builder);
        this.elementShadowStyles = elementShadowStyles;
        var elementDisplayStyles = new elementpanel_display(builder);
        this.elementDisplayStyles = elementDisplayStyles;
        var elementPositionStyles = new elementpanel_position(builder);
        this.elementPositionStyles = elementPositionStyles;
        var elementEffectStyles = new elementpanel_effect(builder);
        this.elementEffectStyles = elementEffectStyles;
        var elementAttributeStyles = new elementpanel_attribute(builder);
        this.elementAttributeStyles = elementAttributeStyles;
        var elementMoreStyles = new elementpanel_more(builder);
        this.elementMoreStyles = elementMoreStyles;
        var elementAnimationStyles = new elementpanel_animation(builder);
        this.elementAnimationStyles = elementAnimationStyles;
        this.tabs = new tabs({
          element: this.panel
        });
      }
    }
  }, {
    key: "click",
    value: function click() {
      if (!this.panel) return;
      if (elementpanel_dom.hasClass(this.panel, 'active') || elementpanel_dom.hasClass(this.elementStyleEditor.modalStyles, 'active')) {
        this.inspect(this.builder.inspectedElement);
      }
    }
  }, {
    key: "inspect",
    value: function inspect(elm) {
      var _this2 = this;
      this.elementGeneralStyles.readElementStyles(elm);
      this.elementBoxStyles.readElementStyles(elm);
      this.elementSpacingStyles.readElementStyles(elm);
      this.elementBorderStyles.readElementStyles(elm);
      this.elementTextStyles.readElementStyles(elm);
      this.elementCornerStyles.readElementStyles(elm);
      this.elementShadowStyles.readElementStyles(elm);
      this.elementDisplayStyles.readElementStyles(elm);
      this.elementPositionStyles.readElementStyles(elm);
      this.elementEffectStyles.readElementStyles(elm);
      this.elementAttributeStyles.readElementStyles(elm);
      this.elementMoreStyles.readElementStyles(elm);
      this.elementAnimationStyles.readElementStyles(elm);
      var panel = this.panel;
      var elms = this.builder.doc.querySelectorAll('[data-saveforundo]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.removeAttribute('data-saveforundo');
      });
      elm.setAttribute('data-saveforundo', '');
      elms = this.builder.doc.querySelectorAll('.elm-inspected');
      Array.prototype.forEach.call(elms, function (elm) {
        elementpanel_dom.removeClass(elm, 'elm-inspected');
      });
      setTimeout(function () {
        elementpanel_dom.addClass(elm, 'elm-inspected');
      }, 10);
      panel.querySelector('.elm-list').innerHTML = '';
      var element = elm;
      var i = 0;
      arrElms = [];
      while (!elementpanel_dom.hasClass(element, 'is-builder')) {
        arrElms.push(element);
        if (!element) {
          // This should not happen. But on quick user click (ex. undo then redo quickly), an element can lost, so checking is needed
          break;
        }
        if (!element.tagName) {
          break;
        }
        var tagName = element.tagName.toLowerCase();
        var a = elementpanel_dom.createElement('a');
        a.setAttribute('data-index', i);
        i++;
        a.setAttribute('href', '#');
        a.innerHTML = tagName;
        if (panel.querySelector('.elm-list').innerHTML === '') {
          elementpanel_dom.addClass(a, 'active');
          panel.querySelector('.elm-list').insertAdjacentHTML('afterbegin', a.outerHTML);
        } else {
          panel.querySelector('.elm-list').insertAdjacentHTML('afterbegin', '&nbsp;>&nbsp; ');
          panel.querySelector('.elm-list').insertAdjacentHTML('afterbegin', a.outerHTML);
        }
        element = element.parentNode;
      }
      var links = panel.querySelectorAll('.elm-list a');
      Array.prototype.forEach.call(links, function (link) {
        elementpanel_dom.addEventListener(link, 'click', function (e) {
          var index = link.getAttribute('data-index');
          _this2.builder.inspectedElement = arrElms[index];
          _this2.inspect(arrElms[index]);
          if (!_this2.builder.doc.querySelector('.elm-inspected.elm-active')) {
            // hide element tool if inspected element is not active element
            _this2.builderStuff.querySelector('.is-element-tool').style.display = 'none';
          }
          e.preventDefault();
          e.stopImmediatePropagation(); // a must
        });
      });

      this.elementStyleEditor.refresh();
    }
  }, {
    key: "showPanel",
    value: function showPanel() {
      var _this3 = this;
      this.renderPanel();
      var panel = this.builderStuff.querySelector('.is-side.elementstyles');
      panel.style.display = 'block'; // this is needed because the elementstyles panel's display is set 'none' (to prevent warning as the panel is actually not visible at first)

      var panels = this.builderStuff.querySelectorAll('.is-side');
      Array.prototype.forEach.call(panels, function (panel) {
        elementpanel_dom.removeClass(panel, 'active');
      });
      setTimeout(function () {
        elementpanel_dom.addClass(panel, 'active'); // add 10ms delay after display is set 'block' for visible animation

        // Focus
        var content = panel.querySelector('.is-tab-content.active');
        content.focus();
        _this3.builder.tabs.setupTabKey(content);
        var handleKeyDown = function handleKeyDown(e) {
          if (e.keyCode === 27) {
            // escape key
            _this3.hidePanel();
          }
        };
        panel.addEventListener('keydown', handleKeyDown);
      }, 10);
      this.inspect(this.builder.inspectedElement);
    }
  }, {
    key: "hidePanel",
    value: function hidePanel() {
      var panel = this.builderStuff.querySelector('.is-side.elementstyles');
      elementpanel_dom.removeClass(panel, 'active');
      var elms = this.builder.doc.querySelectorAll('[data-saveforundo]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.removeAttribute('data-saveforundo');
      });
      elms = this.builder.doc.querySelectorAll('.elm-inspected');
      Array.prototype.forEach.call(elms, function (elm) {
        elementpanel_dom.removeClass(elm, 'elm-inspected');
      });
    }
  }]);
  return ElementPanel;
}();
/* harmony default export */ const elementpanel = (ElementPanel);
;// CONCATENATED MODULE: ./src/contentbuilder/elementtool.js
function elementtool_typeof(obj) { "@babel/helpers - typeof"; return elementtool_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, elementtool_typeof(obj); }
function elementtool_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function elementtool_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, elementtool_toPropertyKey(descriptor.key), descriptor); } }
function elementtool_createClass(Constructor, protoProps, staticProps) { if (protoProps) elementtool_defineProperties(Constructor.prototype, protoProps); if (staticProps) elementtool_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function elementtool_toPropertyKey(arg) { var key = elementtool_toPrimitive(arg, "string"); return elementtool_typeof(key) === "symbol" ? key : String(key); }
function elementtool_toPrimitive(input, hint) { if (elementtool_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (elementtool_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var ElementTool = /*#__PURE__*/function () {
  function ElementTool(builder) {
    var _this = this;
    elementtool_classCallCheck(this, ElementTool);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
    if (!this.builder.controlPanel) {
      var elementPanel = new elementpanel(builder);
      this.elementPanel = elementPanel;
    }
    var elementTool = builderStuff.querySelector('.is-element-tool');
    var elementMore = builderStuff.querySelector('.elmmore');
    if (!elementTool) {
      var html = "<div class=\"is-tool is-element-tool\">\n                <button type=\"button\" tabindex=\"-1\" title=\"".concat(util.out('Add'), "\" class=\"elm-add\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('More'), "\" class=\"elm-more\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-more\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Delete'), "\" class=\"elm-remove\"><svg class=\"is-icon-flex\" style=\"margin-left:-1px\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Settings'), "\" class=\"elm-settings\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n            </div>\n            <div class=\"is-pop elmmore\" style=\"z-index:10002;\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div style=\"display:flex;flex-flow:wrap;\">\n                    <button type=\"button\" title=\"").concat(util.out('Move Up'), "\" class=\"elm-up\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-up\"></use></svg></span>").concat(util.out('Move Up'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Move Down'), "\" class=\"elm-down\"><span><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#ion-ios-arrow-thin-down\"></use></svg></span>").concat(util.out('Move Down'), "</button>\n                    <button type=\"button\" title=\"").concat(util.out('Duplicate'), "\" class=\"elm-duplicate\"><span><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></span>").concat(util.out('Duplicate'), "</button>\n                    ").concat(this.builder.opts.elementEditor ? "\n                    <button type=\"button\" title=\"".concat(util.out('Settings'), "\" class=\"elm-settings\"><span><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-ios-gear\"></use></svg></span>").concat(util.out('Settings'), "</button>\n                    ") : '', " \n                </div>\n            </div>\n            ");
      dom.appendHtml(builderStuff, html);
      if (!this.builder.iframe) {
        elementTool = builderStuff.querySelector('.is-element-tool');
      } else {
        elementTool = this.builder.contentStuff.querySelector('.is-element-tool');
      }
      elementMore = builderStuff.querySelector('.elmmore');

      // Prepare for tooltip
      var elms = elementTool.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
    }
    this.elementTool = elementTool;
    this.elementMore = elementMore;

    // Add element
    var elmAdd = elementTool.querySelector('.elm-add');
    dom.addEventListener(elmAdd, 'click', function () {
      var quickadd = contentbuilder_quickadd(builder);
      var tabs = quickadd.querySelector('.is-pop-tabs');
      tabs.style.display = 'none';
      var viewportHeight = window.innerHeight;

      /*
      let top, left;
      if(!this.builder.iframe) {
          top = elmAdd.getBoundingClientRect().top;
          left = elmAdd.getBoundingClientRect().left;
      } else {
          let adjY = this.builder.iframe.getBoundingClientRect().top;// + window.pageYOffset;
          let adjX = this.builder.iframe.getBoundingClientRect().left;// + window.pageXOffset;
           top = elmAdd.getBoundingClientRect().top + adjY ;
          left = elmAdd.getBoundingClientRect().left + adjX;
      }
      */
      var newPos = _this.builder.util.getElementPosition(elmAdd);
      var top = newPos.top;
      var left = newPos.left;

      // quickadd.style.display = 'flex';
      util.showPop(quickadd, false, elmAdd);
      var w = quickadd.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = quickadd.offsetHeight;
      if (viewportHeight - top > h) {
        quickadd.style.top = top + window.pageYOffset + 27 + 'px';
        quickadd.style.left = left - w / 2 + 10 + 'px';
        dom.removeClass(quickadd, 'arrow-bottom');
        dom.removeClass(quickadd, 'arrow-right');
        dom.removeClass(quickadd, 'arrow-left');
        dom.removeClass(quickadd, 'center');
        dom.addClass(quickadd, 'arrow-top');
        dom.addClass(quickadd, 'center');
      } else {
        quickadd.style.top = top + window.pageYOffset - h - 8 + 'px';
        quickadd.style.left = left - w / 2 + 10 + 'px';
        dom.removeClass(quickadd, 'arrow-top');
        dom.removeClass(quickadd, 'arrow-right');
        dom.removeClass(quickadd, 'arrow-left');
        dom.removeClass(quickadd, 'center');
        dom.addClass(quickadd, 'arrow-bottom');
        dom.addClass(quickadd, 'center');
      }
      quickadd.setAttribute('data-mode', 'elm');

      //handleQuickAddClickOut
      var handleQuickAddClickOut = function handleQuickAddClickOut(e) {
        // console.log('handleQuickAddClickOut');
        var elm = e.target;
        if (!elm) return;
        if (!elm.closest('.quickadd') && !elm.closest('.row-add') && !elm.closest('.is-rowadd-tool') && !elm.closest('.cell-add') && !elm.closest('.elm-add') && !elm.closest('.row-add-initial')) {
          // click outside

          // hide
          var _quickadd = builderStuff.querySelector('.quickadd');
          util.hidePop(_quickadd);
          // console.log('HIDE');

          // clear events
          document.removeEventListener('click', handleQuickAddClickOut);
          if (_this.builder.iframeDocument) {
            _this.builder.doc.removeEventListener('click', handleQuickAddClickOut);
          }
          _this.builder.handleQuickAddClickOut_ = false;
        }
      };
      if (!_this.builder.handleQuickAddClickOut_) {
        document.addEventListener('click', handleQuickAddClickOut);
        if (_this.builder.iframeDocument) {
          _this.builder.doc.addEventListener('click', handleQuickAddClickOut);
        }
        _this.builder.handleQuickAddClickOut_ = true;
      }
    });
    var elmRemove = elementTool.querySelector('.elm-remove');
    dom.addEventListener(elmRemove, 'click', function () {
      util.confirm(util.out('Are you sure you want to delete this element?'), function (ok) {
        if (ok) {
          _this.builder.uo.saveForUndo();
          var elm = _this.builder.activeElement;
          var subblock = false;
          if (elm.closest('.is-subblock')) {
            subblock = true;
          }

          /*
          if(dom.hasClass(elm.parentNode, 'cell-active') || elm.parentNode.hasAttribute('data-subblock')) {
              // Level 1
              elm.parentNode.removeChild(elm);
          } else {
              // Deeper
              if(elm.parentNode.childElementCount > 1) {
                  elm.parentNode.removeChild(elm);
              } else {
                  let element = elm;
                  if(!dom.parentsHasAttribute(element, 'data-subblock')) {
                      
                      while(!dom.hasClass(element.parentNode, 'cell-active') && elm.parentNode.childElementCount === 1) {
                          element = element.parentNode;
                      }
                   } else {
                       while(!element.parentNode.hasAttribute('data-subblock') && elm.parentNode.childElementCount === 1) {
                          element = element.parentNode;
                      }
                   }
                  element.parentNode.removeChild(element);
              }
          }
          */

          // elm.parentNode.removeChild(elm);
          var elmParent = elm.parentNode;
          elm.remove();
          var childs = dom.elementChildren(elmParent);
          if (!elmParent.classList.contains('cell-active') && childs.length === 0) {
            elmParent.remove(); // remove empty div.display
          }

          _this.elementTool.style.display = 'none';
          var cell = _this.builder.activeCol;
          if (cell) {
            var row = cell.parentNode;
            if (cell.childElementCount === 0 && row.childElementCount === 4) {
              // 4 => col + tools

              row.parentNode.removeChild(row);
              util.checkEmpty();
            } else if (cell.childElementCount === 0) {
              row.removeChild(cell);
              util.fixLayout(row);
            }
          }

          // Add spacer to empty subblock
          var subblocks = _this.builder.doc.querySelectorAll('.is-subblock');
          Array.prototype.forEach.call(subblocks, function (subblock) {
            var rows = dom.elementChildren(subblock);
            var empty = true;
            rows.forEach(function () {
              empty = false;
            });
            if (empty) {
              subblock.innerHTML = '<div class="spacer height-40" contentEditable="false"></div>';
            }
          });
          util.clearControls();
          if (subblock) {
            var block = _this.builder.activeCol;
            var _subblocks = block.querySelectorAll('[data-subblock]');
            var index = 1;
            Array.prototype.forEach.call(_subblocks, function (subblock) {
              if (subblock.closest('.glide__slide--clone')) return;
              var html = subblock.innerHTML;
              block.setAttribute('data-html-' + index, encodeURIComponent(html));
              index++;
            });
            util.refreshModuleLayout(block);
          }

          //Trigger Change event
          _this.builder.opts.onChange();
          if (_this.builder.onSelectChange) _this.builder.onSelectChange();
        }
      });
    });
    var btnMore = elementTool.querySelector('.elm-more');
    dom.addEventListener(btnMore, 'click', function () {
      var viewportHeight = window.innerHeight;

      /*
      let top, left;
      if(!this.builder.iframe) {
          top = btnMore.getBoundingClientRect().top;
          left = btnMore.getBoundingClientRect().left;
      } else {
          let adjY = this.builder.iframe.getBoundingClientRect().top;// + window.pageYOffset;
          let adjX = this.builder.iframe.getBoundingClientRect().left;// + window.pageXOffset;
           top = btnMore.getBoundingClientRect().top + adjY;
          left = btnMore.getBoundingClientRect().left + adjX;
      }
      */
      var newPos = _this.builder.util.getElementPosition(btnMore);
      var top = newPos.top;
      var left = newPos.left;

      // elementMore.style.display = 'flex';
      util.showPop(elementMore, false, btnMore);
      var w = elementMore.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = elementMore.offsetHeight;
      if (viewportHeight - top > h) {
        elementMore.style.top = top + window.pageYOffset + 27 + 'px';
        elementMore.style.left = left - w / 2 + 10 + 'px';
        dom.removeClass(elementMore, 'arrow-bottom');
        dom.removeClass(elementMore, 'arrow-right');
        dom.removeClass(elementMore, 'arrow-left');
        dom.removeClass(elementMore, 'center');
        dom.addClass(elementMore, 'arrow-top');
        dom.addClass(elementMore, 'center');
      } else {
        elementMore.style.top = top + window.pageYOffset - h - 8 + 'px';
        elementMore.style.left = left - w / 2 + 10 + 'px';
        dom.removeClass(elementMore, 'arrow-top');
        dom.removeClass(elementMore, 'arrow-right');
        dom.removeClass(elementMore, 'arrow-left');
        dom.removeClass(elementMore, 'center');
        dom.addClass(elementMore, 'arrow-bottom');
        dom.addClass(elementMore, 'center');
      }
    });
    var elmUp = elementMore.querySelector('.elm-up');
    dom.addEventListener(elmUp, 'click', function () {
      var elm = _this.builder.activeElement;
      if (elm.previousElementSibling) {
        _this.builder.uo.saveForUndo();
        elm.parentNode.insertBefore(elm, elm.previousElementSibling);

        // elm.click();
        // this.position(elm);
        setTimeout(function () {
          _this.position();
        }, 30);

        //Trigger Change event
        _this.builder.opts.onChange();
      } else {
        // Try move the parent
        var element = elm;
        while (!dom.hasClass(element.parentNode, 'cell-active') && !element.parentNode.hasAttribute('data-subblock')) {
          element = element.parentNode;
        }
        if (element.previousElementSibling && element !== elm) {
          _this.builder.uo.saveForUndo();
          element.parentNode.insertBefore(element, element.previousElementSibling);

          // elm.click();
          // this.position(elm);
          setTimeout(function () {
            _this.position();
          }, 30);

          //Trigger Change event
          _this.builder.opts.onChange();
        }
      }
      // elm.click();
      // elementTool.querySelector('.elm-more').click();
    });

    var elmDown = elementMore.querySelector('.elm-down');
    dom.addEventListener(elmDown, 'click', function () {
      var elm = _this.builder.activeElement;
      if (elm.nextElementSibling) {
        _this.builder.uo.saveForUndo();
        elm.parentNode.insertBefore(elm.nextElementSibling, elm);

        // elm.click();
        // this.position(elm);
        setTimeout(function () {
          _this.position();
        }, 30);

        //Trigger Change event
        _this.builder.opts.onChange();
      } else {
        // Try move the parent
        var element = elm;
        while (!dom.hasClass(element.parentNode, 'cell-active') && !element.parentNode.hasAttribute('data-subblock')) {
          element = element.parentNode;
        }
        if (element.nextElementSibling && element !== elm) {
          _this.builder.uo.saveForUndo();
          element.parentNode.insertBefore(element.nextElementSibling, element);

          // elm.click();
          // this.position(elm);
          setTimeout(function () {
            _this.position();
          }, 30);

          //Trigger Change event
          _this.builder.opts.onChange();
        }
      }
    });
    var elmDuplicate = elementMore.querySelector('.elm-duplicate');
    dom.addEventListener(elmDuplicate, 'click', function () {
      _this.builder.uo.saveForUndo();
      var elm = _this.builder.activeElement;

      //Clone row & cleanup attached tool & event
      var newelm = elm.cloneNode(true);
      dom.moveAfter(newelm, elm);
      setTimeout(function () {
        newelm.click();
        _this.position(newelm);
        var builderActive = _this.builder.doc.querySelector('.builder-active');
        if (builderActive) _this.builder.applyBehaviorOn(builderActive);

        //Trigger Change event
        _this.builder.opts.onChange();
      }, 100); //Timeout needed by Safari
    });

    var elmSettings = elementTool.querySelector('.elm-settings');
    if (elmSettings) dom.addEventListener(elmSettings, 'click', function () {
      util.hidePop(elementMore);
      if (_this.builder.controlPanel) {
        _this.builder.controlpanel.objDialogElement.open();
      } else {
        _this.elementPanel.showPanel();
      }
    });
    var elmSettings2 = elementMore.querySelector('.elm-settings');
    if (elmSettings2) dom.addEventListener(elmSettings2, 'click', function () {
      util.hidePop(elementMore);
      if (_this.builder.controlPanel) {
        _this.builder.controlpanel.objDialogElement.open();
      } else {
        _this.elementPanel.showPanel();
      }
    });

    // document.addEventListener('mousedown', (e) => {
    //     e = e || window.event;
    //     var target = e.target || e.srcElement;  

    //     if(elementMore.style.display === 'flex') {
    //         let a = dom.parentsHasClass(target, 'elmmore');
    //         let b = dom.parentsHasClass(target, 'elm-more');
    //         if(a||b) {
    //             return;
    //         }
    //         else {
    //             // elementMore.style.display = '';
    //             util.hidePop(elementMore);
    //         }
    //     }
    // });
  }
  elementtool_createClass(ElementTool, [{
    key: "hide",
    value: function hide() {
      var dom = this.dom;
      this.elementTool.style.display = '';
      var elms = this.builder.doc.querySelectorAll('.elm-active');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'elm-active');
      });
    }
  }, {
    key: "position",
    value: function position() {
      var dom = this.dom;
      var elementTool = this.elementTool;
      var elementMore = this.elementMore;
      dom.addClass(elementMore, 'transition1');
      var elmMore = elementTool.querySelector('.elm-more');
      var viewportHeight = window.innerHeight;

      /*
      let top, left;
      if(!this.builder.iframe) {
          top = elmMore.getBoundingClientRect().top;
          left = elmMore.getBoundingClientRect().left;
      } else {
          let adjY = this.builder.iframe.getBoundingClientRect().top;
          let adjX = this.builder.iframe.getBoundingClientRect().left;
           top = elmMore.getBoundingClientRect().top;
          left = elmMore.getBoundingClientRect().left;
          top = top + adjY;
          left = left + adjX;
      }
      */
      var newPos = this.builder.util.getElementPosition(elmMore);
      var top = newPos.top;
      var left = newPos.left;

      // elementMore.style.display = 'flex';
      var btnMore = elementTool.querySelector('.elm-more');
      this.util.showPop(elementMore, false, btnMore);
      var w = elementMore.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = elementMore.offsetHeight;
      if (viewportHeight - top > h) {
        elementMore.style.top = top + window.pageYOffset + 27 + 'px';
        elementMore.style.left = left - w / 2 + 10 + 'px';
        dom.removeClass(elementMore, 'arrow-bottom');
        dom.removeClass(elementMore, 'arrow-right');
        dom.removeClass(elementMore, 'arrow-left');
        dom.removeClass(elementMore, 'center');
        dom.addClass(elementMore, 'arrow-top');
        dom.addClass(elementMore, 'center');
      } else {
        elementMore.style.top = top + window.pageYOffset - h - 8 + 'px';
        elementMore.style.left = left - w / 2 + 10 + 'px';
        dom.removeClass(elementMore, 'arrow-top');
        dom.removeClass(elementMore, 'arrow-right');
        dom.removeClass(elementMore, 'arrow-left');
        dom.removeClass(elementMore, 'center');
        dom.addClass(elementMore, 'arrow-bottom');
        dom.addClass(elementMore, 'center');
      }
      setTimeout(function () {
        dom.removeClass(elementMore, 'transition1');
      }, 300);
    }
  }, {
    key: "click",
    value: function click(col, e) {
      // old: 12808
      var dom = this.dom;
      var elm = e.target;
      var elementTool = this.elementTool;
      elementTool.style.display = 'none';
      var elms = this.builder.doc.querySelectorAll('.elm-active');
      Array.prototype.forEach.call(elms, function (elm) {
        dom.removeClass(elm, 'elm-active');
      });
      var activeElement = null;
      var noedit = false;
      if (col.hasAttribute('data-noedit')) {
        // Column is not (text) editable.
        noedit = true;
      }
      var _protected = false;
      if (col.hasAttribute('data-protected')) {
        // Column is not (text) editable and also: cannot be deleted, moved or duplicated.
        _protected = true;
      }
      var customcode = false;
      if (col.hasAttribute('data-html')) {
        // Column contains custom code.
        customcode = true;
      }
      var subblock = false;
      //if(dom.parentsHasAttribute(elm, 'data-subblock')) {
      if (dom.parentsHasClass(elm, 'is-subblock')) {
        subblock = true;
      }
      if ((customcode || noedit || _protected) && !subblock) {

        // Do Nothing
      } else {
        var tagName = elm.tagName.toLowerCase();
        // LATER: label, code, figcaption ?
        if (!elm.classList.contains('cell-active') && (tagName === 'h1' || tagName === 'h2' || tagName === 'h3' || tagName === 'h4' || tagName === 'h5' || tagName === 'h6' || tagName === 'p' || tagName === 'div' || tagName === 'pre' || tagName === 'blockquote' || tagName === 'li' || tagName === 'img' || tagName === 'iframe')) {
          activeElement = elm; //set active element

          if (tagName === 'img') {
            if (dom.hasClass(elm.parentNode, 'img-circular')) {
              activeElement = elm.parentNode;
            }
            var link = dom.getParentByTag(elm, 'a');
            if (link) {
              activeElement = elm.parentNode;
            }
          }
        } else {
          /*
          <div class="cell-active">
               ..level 0
              <p>
                  ..level 1
                  <b>..deeper level..</b>
              </p>
               <div class="display">
                  ..level 1
                  <h1>..<b>..deeper level..</b>..</h1>
                  <p>..<b>..deeper level..</b>..</p>
              </div>
          </div>                            
          */
          if (dom.hasClass(elm, 'cell-active') || elm.hasAttribute('data-subblock')) {

            // Level 0
            // Do Nothing
          } else if (dom.hasClass(elm, 'cell-active') || elm.parentNode.hasAttribute('data-subblock')) {
            // Level 1
            activeElement = elm;
          } else {
            // Deeper level
            var element = elm;
            while (element.tagName !== 'BODY' && element.tagName !== 'HTML') {
              var s = element.tagName.toLowerCase();
              if (dom.hasClass(element, 'spacer') || s === 'h1' || s === 'h2' || s === 'h3' || s === 'h4' || s === 'h5' || s === 'h6' || s === 'p' || s === 'pre' || s === 'blockquote' || s === 'li' || s === 'img' || s === 'iframe') {
                activeElement = element; //set active element

                break;
              } else {
                if (dom.hasClass(element.parentNode, 'cell-active') || element.parentNode.hasAttribute('data-subblock')) {
                  activeElement = element; //set active element
                  break;
                }
              }
              element = element.parentNode;
            }
          }
        }
      }
      this.builder.activeElement = activeElement;
      if (activeElement) {
        var _elm = activeElement;

        // const top = elm.getBoundingClientRect().top + window.pageYOffset;
        // const left = elm.getBoundingClientRect().left + window.pageXOffset;
        // const w = elm.offsetWidth;
        // const h = elm.offsetHeight;
        // elementTool.style.display = 'flex';
        // elementTool.style.top = (top + h) + 'px';
        // elementTool.style.left = (left + w - elementTool.offsetWidth) + 'px';

        // const viewportWidth = window.innerWidth;
        // if((left + w)>viewportWidth) {
        //     elementTool.style.left = (viewportWidth - elementTool.offsetWidth) + 'px';
        // }
        this.pos();
        dom.addClass(_elm, 'elm-active');
      }
      this.builder.inspectedElement = e.target;

      // console.log(this.builder.inspectedElement);
      // console.log(this.builder.activeElement);

      if (!this.builder.controlPanel) {
        this.elementPanel.click(e);
      }
    }
  }, {
    key: "refresh",
    value: function refresh() {
      var _this2 = this;
      if (this.builder.activeElement) {
        var elementTool = this.elementTool;
        elementTool.style.display = '';
        setTimeout(function () {
          // let elm = this.builder.activeElement;
          // const top = elm.getBoundingClientRect().top + window.pageYOffset;
          // const left = elm.getBoundingClientRect().left + window.pageXOffset;
          // const w = elm.offsetWidth;
          // const h = elm.offsetHeight;
          // elementTool.style.display = 'flex';
          // elementTool.style.top = (top + h) + 'px';
          // elementTool.style.left = (left + w - elementTool.offsetWidth) + 'px';

          // const viewportWidth = window.innerWidth;
          // if((left + w)>viewportWidth) {
          //     elementTool.style.left = (viewportWidth - elementTool.offsetWidth) + 'px';
          // }
          _this2.pos();
        }, 300);
      }
    }
  }, {
    key: "repositionElementTool",
    value: function repositionElementTool(check) {
      // = refresh(), but without delay
      if (this.builder.activeElement) {
        try {
          // use try to prevent unspecified error in IE

          // let elementTool = this.elementTool;

          // let elm = this.builder.activeElement;
          // const top = elm.getBoundingClientRect().top + window.pageYOffset;
          // const left = elm.getBoundingClientRect().left + window.pageXOffset;
          // const w = elm.offsetWidth;
          // const h = elm.offsetHeight;
          // elementTool.style.display = 'flex';
          // elementTool.style.top = (top + h) + 'px';
          // elementTool.style.left = (left + w - elementTool.offsetWidth) + 'px';

          // const viewportWidth = window.innerWidth;
          // if((left + w)>viewportWidth) {
          //     elementTool.style.left = (viewportWidth - elementTool.offsetWidth) + 'px';
          // }
          if (check) {
            // Check tool visibility (flex or none). Only run pos() if the tool is visible.
            var elementTool = this.elementTool;
            if (elementTool.style.display === 'flex') {
              this.pos();
            } else {
              // Do Nothingr
            }
          } else {
            this.pos();
          }
        } catch (e) {
          // Do Nothing
        }
      }
    }
  }, {
    key: "pos",
    value: function pos() {
      var elementTool = this.elementTool;
      var elm = this.builder.activeElement;
      if (!elm) return;
      if (elm.closest('.is-dock')) return;
      var top, left;
      if (!this.builder.iframe) {
        top = elm.getBoundingClientRect().top + window.pageYOffset;
        left = elm.getBoundingClientRect().left + window.pageXOffset;
      } else {
        top = elm.getBoundingClientRect().top + this.builder.win.pageYOffset;
        left = elm.getBoundingClientRect().left + this.builder.win.pageXOffset;
      }
      var w = elm.offsetWidth * this.builder.opts.zoom;
      var h = elm.offsetHeight * this.builder.opts.zoom;
      elementTool.style.display = 'flex';
      elementTool.style.top = top + h + 'px';
      elementTool.style.left = left + w - elementTool.offsetWidth + 'px';
      var viewportWidth = window.innerWidth;
      if (left + w > viewportWidth) {
        elementTool.style.left = viewportWidth - elementTool.offsetWidth + 'px';
      }
    }
  }]);
  return ElementTool;
}();
/* harmony default export */ const elementtool = (ElementTool);
;// CONCATENATED MODULE: ./src/contentbuilder/preferences.js
function preferences_typeof(obj) { "@babel/helpers - typeof"; return preferences_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, preferences_typeof(obj); }
function preferences_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function preferences_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, preferences_toPropertyKey(descriptor.key), descriptor); } }
function preferences_createClass(Constructor, protoProps, staticProps) { if (protoProps) preferences_defineProperties(Constructor.prototype, protoProps); if (staticProps) preferences_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function preferences_toPropertyKey(arg) { var key = preferences_toPrimitive(arg, "string"); return preferences_typeof(key) === "symbol" ? key : String(key); }
function preferences_toPrimitive(input, hint) { if (preferences_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (preferences_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var Preferences = /*#__PURE__*/function () {
  function Preferences(builder) {
    var _this = this;
    preferences_classCallCheck(this, Preferences);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
    var htmlThemes = '';
    if (this.builder.themes) {
      htmlThemes = '<div class="div-themes" style="margin-top:3px">';
      var n = 0;
      this.builder.themes.forEach(function (item) {
        if (item[1] === '') {
          htmlThemes += "<button type=\"button\" title=\"".concat(util.out('Set theme'), "\" class=\"input-setcolor\" data-index=\"").concat(n, "\" style=\"background:").concat(item[0], ";border:rgba(0,0,0,0.15) 1px solid;\"></button>");
        } else if (item[1] === 'light') {
          htmlThemes += "<button type=\"button\" title=\"".concat(util.out('Set theme'), "\" class=\"input-setcolor\" data-index=\"").concat(n, "\" style=\"background:").concat(item[0], ";border:rgb(132 132 132 / 16%) 1px solid;\"></button>");
        } else {
          htmlThemes += "<button type=\"button\" title=\"".concat(util.out('Set theme'), "\" class=\"input-setcolor\" data-index=\"").concat(n, "\" style=\"background:").concat(item[0], ";\"></button>");
        }
        n++;
      });
      htmlThemes += '</div>';
    }
    var config = builderStuff.querySelector('.viewconfig');
    if (!config) {
      var html = "<div class=\"is-modal viewconfig\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n                    <div class=\"is-modal-bar is-draggable\">".concat(util.out('Preferences'), "</div>\n                \n                    <div style=\"display:flex;flex-wrap:wrap;width:100%;padding-top:32px;\">\n                        <div style=\"width:50%\">\n                            <label id=\"divBuilderMode\" style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Builder Mode'), ":&nbsp;\n                                <select class=\"select-buildermode\" id=\"__select_builderode\">\n                                    <option value=\"\">").concat(util.out('Default'), "</option>\n                                    <option value=\"minimal\">").concat(util.out('Minimal'), "</option>\n                                    <option value=\"clean\">").concat(util.out('Clean'), "</option>\n                                </select>\n                            </label>\n                            \n                            <label id=\"divOutlineMode\" style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Outline Mode'), ":&nbsp;\n                                <select class=\"select-outlinemode\" id=\"__select_outlinemode\">\n                                    <option value=\"\">").concat(util.out('Row & column'), "</option>\n                                    <option value=\"row\">").concat(util.out('Row only'), "</option>\n                                </select>\n                            </label>\n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Outline Style'), ":&nbsp;\n                                <select class=\"select-outlinestyle\" id=\"__select_outlinestyle\">>\n                                    <option value=\"\">").concat(util.out('Colored'), "</option>\n                                    <option value=\"grayoutline\">").concat(util.out('Gray'), "</option>\n                                </select>\n                            </label>\n                            \n                            <label style=\"display:block;margin-top:10px;margin-bottom:10px;\">\n                                <input class=\"input-hiderowcoloutline\" id=\"__input_hiderowcoloutline\" type=\"checkbox\" /> ").concat(util.out('Hide Outline'), "&nbsp;\n                            </label>  \n\n                            <label id=\"divHideCellTool\" style=\"display:block;margin-top:10px;margin-bottom:10px;\">\n                                <input class=\"input-hidecelltool\" id=\"__input_hidecelltool\" type=\"checkbox\" />  ").concat(util.out('Hide Column Tool'), "&nbsp;\n                            </label>\n\n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:10px;\">\n                                <input class=\"input-hidesnippetaddtool\" id=\"__input_hidesnippetaddtool\" type=\"checkbox\" />  ").concat(util.out('Hide Snippet (+) Tool'), "&nbsp;\n                            </label>\n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:10px;\">\n                                <input class=\"input-hideelementtool\" id=\"__input_hideelementtool\" type=\"checkbox\" /> ").concat(util.out('Hide element tool'), "&nbsp;\n                            </label>  \n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:10px;\">\n                                <input class=\"input-hideelementhighlight\" id=\"__input_hideelementhighlight\" type=\"checkbox\" /> ").concat(util.out('Hide element highlight'), "&nbsp;\n                            </label>  \n                            <label style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Row Tool Position'), ":&nbsp;\n                                <select class=\"select-rowtool\" id=\"__select_rowtool\">\n                                    <option value=\"right\">").concat(util.out('Right'), "</option>\n                                    <option value=\"left\">").concat(util.out('Left'), "</option>\n                                </select>\n                            </label>   \n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Tool Style'), ":&nbsp;\n                                <select class=\"select-toolstyle\" id=\"__select_toolstyle\">\n                                    <option value=\"\">").concat(util.out('Colored'), "</option>\n                                    <option value=\"gray\">").concat(util.out('Mono'), "</option>\n                                </select>\n                            </label>  \n\n                        </div>\n                        <div style=\"width:50%\">\n\n                            <label class=\"option-opensnippets\" style=\"display:block;margin-top:10px;margin-bottom:10px;\">\n                                <input class=\"input-opensnippets\" id=\"__input_opensnippets\" type=\"checkbox\" />  ").concat(util.out('Open snippets sidebar on start'), "&nbsp;\n                            </label>\n\n                            <label style=\"display:").concat(builder.opts.snippetList === '#divSnippetList' ? 'block' : 'none', ";margin-top:10px;margin-bottom:5px;\">\n                               ").concat(util.out('Snippets sidebar visibility'), ":&nbsp;\n                                <select class=\"select-snippetssidebardisplay\" id=\"__select_snippetssidebardisplay\">\n                                    <option value=\"auto\">").concat(util.out('Auto'), "</option>\n                                    <option value=\"always\">").concat(util.out('Always Visible'), "</option>\n                                </select>\n                            </label>\n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Toolbar visibility'), ":&nbsp;\n                                <select class=\"select-editingtoolbardisplay\" id=\"__select_editingtoolbardisplay\">\n                                    <option value=\"auto\">").concat(util.out('Auto'), "</option>\n                                    <option value=\"always\">").concat(util.out('Always Visible'), "</option>\n                                </select>\n                            </label>\n\n                            <label style=\"").concat(this.builder.isTouchSupport ? 'display:none;' : 'display:block;', "margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Toolbar position'), ":&nbsp;\n                                <select class=\"select-editingtoolbar\" id=\"__select_editingtoolbar\">\n                                    <option value=\"topfull\">").concat(util.out('Top (Full Width)'), "</option>\n                                    <option value=\"top\">").concat(util.out('Top'), "</option>\n                                    <option value=\"left\">").concat(util.out('Left'), "</option>\n                                    <option value=\"right\">").concat(util.out('Right'), "</option>\n                                </select>\n                            </label> \n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('Paste result'), ":&nbsp;\n                                <select class=\"select-pasteresult\" id=\"__select_pasteresult\">\n                                    <option value=\"html-without-styles\">").concat(util.out('HTML (without styles)'), "</option>\n                                    <option value=\"html\">").concat(util.out('HTML (with styles)'), "</option>\n                                    <option value=\"text\">").concat(util.out('Text only'), "</option>\n                                </select>\n                            </label>  \n\n                            <label style=\"display:block;margin-top:10px;margin-bottom:5px;\">\n                                ").concat(util.out('HTML View'), ":&nbsp;\n                                <select class=\"select-htmlview\" id=\"__select_htmlview\">\n                                    <option value=\"shorten\">").concat(util.out('Shorten HTML'), "</option>\n                                    <option value=\"actual\">").concat(util.out('Actual'), "</option>\n                                </select>\n                            </label>  \n\n                            ").concat(this.builder.themes ? "\n                                <label style=\"".concat(this.builder.isTouchSupport ? 'display:none;' : 'display:block;', "margin-top:10px;margin-bottom:5px;\">\n                                    ").concat(util.out('Theme'), ":&nbsp;\n                                    ").concat(htmlThemes, "\n                                </label> \n                            ") : '', "\n\n                        </div>\n                    </div>\n                    <div style=\"text-align:right;margin-top:30px\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>");
      dom.appendHtml(builderStuff, html);
      config = builderStuff.querySelector('.viewconfig');
      if (!(builder.opts.snippetList === '#divSnippetList' && builder.opts.snippetJSON.snippets.length > 0)) {
        config.querySelector('.option-opensnippets').style.display = 'none';
      }
      var elm = config.querySelector('.input-cancel');
      dom.addEventListener(elm, 'click', function () {
        util.hideModal(config);
      });
      elm = config.querySelector('.input-ok');
      dom.addEventListener(elm, 'click', function () {
        _this.update();
        util.hideModal(config);
      });

      // On first load, apply preferences (check if there are stored values)
      if (localStorage.getItem('_hiderowcoloutline') !== null) {
        if (localStorage.getItem('_hiderowcoloutline') === '1') {
          this.builder.opts.rowcolOutline = false;
        } else {
          this.builder.opts.rowcolOutline = true;
        }
      }
      this.setOutline(!this.builder.opts.rowcolOutline);
      if (localStorage.getItem('_outlinemode') !== null) {
        this.builder.opts.outlineMode = localStorage.getItem('_outlinemode');
      }
      this.setOutlineMode(this.builder.opts.outlineMode);
      if (localStorage.getItem('_outlinestyle') !== null) {
        this.builder.opts.outlineStyle = localStorage.getItem('_outlinestyle');
      }
      this.setOutlineStyle(this.builder.opts.outlineStyle);
      if (localStorage.getItem('_pasteresult') !== null) {
        this.builder.opts.paste = localStorage.getItem('_pasteresult');
      }
      if (localStorage.getItem('_htmlview') !== null) {
        var htmlView = localStorage.getItem('_htmlview');
        if (htmlView === 'shorten') {
          this.builder.opts.shortenHTML = true;
        } else {
          this.builder.opts.shortenHTML = false;
        }
      }
      if (localStorage.getItem('_hidecelltool') !== null) {
        if (localStorage.getItem('_hidecelltool') === '1') {
          this.builder.opts.columnTool = false;
        } else {
          this.builder.opts.columnTool = true;
        }
      }
      this.setColumnTool(!this.builder.opts.columnTool);
      if (localStorage.getItem('_hidesnippetaddtool') !== null) {
        if (localStorage.getItem('_hidesnippetaddtool') === '1') {
          this.builder.opts.snippetAddTool = false;
        } else {
          this.builder.opts.snippetAddTool = true;
        }
      }
      this.setSnippetAddTool(!this.builder.opts.snippetAddTool);
      if (localStorage.getItem('_hideelementtool') !== null) {
        if (localStorage.getItem('_hideelementtool') === '1') {
          this.builder.opts.elementTool = false;
        } else {
          this.builder.opts.elementTool = true;
        }
      }
      this.setElementTool(!this.builder.opts.elementTool);
      if (localStorage.getItem('_hideelementhighlight') !== null) {
        if (localStorage.getItem('_hideelementhighlight') === '1') {
          this.builder.opts.elementHighlight = false;
        } else {
          this.builder.opts.elementHighlight = true;
        }
      }
      this.setElementHighlight(!this.builder.opts.elementHighlight);
      if (localStorage.getItem('_opensnippets') !== null) {
        if (localStorage.getItem('_opensnippets') === '1') {
          this.builder.opts.snippetOpen = true;
        } else {
          this.builder.opts.snippetOpen = false;
        }
      }
      if (localStorage.getItem('_buildermode') !== null) {
        this.builder.opts.builderMode = localStorage.getItem('_buildermode');
      }
      this.setBuilderMode(this.builder.opts.builderMode);
      if (localStorage.getItem('_rowtool') !== null) {
        this.builder.opts.rowTool = localStorage.getItem('_rowtool');
      }
      this.setRowToolPosition(this.builder.opts.rowTool);
      if (localStorage.getItem('_toolstyle') !== null) {
        this.builder.opts.toolStyle = localStorage.getItem('_toolstyle');
      }
      this.setToolStyle(this.builder.opts.toolStyle);

      // Always Auto
      if (localStorage.getItem('_editingtoolbardisplay') !== null) {
        this.builder.opts.toolbarDisplay = localStorage.getItem('_editingtoolbardisplay');
      }
      // this.builder.opts.toolbarDisplay = 'auto';
      // this.setToolbarDisplay(this.builder.opts.toolbarDisplay);

      if (localStorage.getItem('_snippetssidebardisplay') !== null) {
        this.builder.opts.snippetsSidebarDisplay = localStorage.getItem('_snippetssidebardisplay');
      }
      if (localStorage.getItem('_editingtoolbar') != null) {
        this.builder.opts.toolbar = localStorage.getItem('_editingtoolbar');
      }
      this.setToolbar(this.builder.opts.toolbar);
      if (localStorage.getItem('_theme') != null) {
        var _n = localStorage.getItem('_theme');
        this.builder.themeIndex = _n;
        if (this.builder.themes) {
          if (this.builder.themes.length > 0) {
            var item = this.builder.themes[_n];
            if (item) {
              this.builder.setUIColor(item[1], item[2]);
              this.builder.renderIframeLater = true;
            }
          }
        }
      } else {
        this.builder.setUIColor('', '');
        this.builder.renderIframeLater = true;
      }
      if (!this.builder.renderIframeLater) {
        // means setUIColor() not called, so we need to call getUIStyles() manually
        util.getUIStyles();
      }

      // Email Mode
      if (this.builder.opts.emailMode) {
        this.builder.opts.outlineMode = 'row';
        this.builder.opts.columnTool = false;
        this.builder.opts.builderMode = '';
        if (localStorage.getItem('_outlinemode') != null) {
          localStorage.setItem('_outlinemode', 'row');
        }
        if (localStorage.getItem('_hidecelltool') !== null) {
          localStorage.setItem('_hidecelltool', '1');
        }
        if (localStorage.getItem('_buildermode') !== null) {
          localStorage.setItem('_buildermode', '');
        }
        this.setColumnTool(true);
        this.setBuilderMode('');
        this.setEmailMode();
        builderStuff.querySelector('#divHideCellTool').style.display = 'none';
        builderStuff.querySelector('#divOutlineMode').style.display = 'none';
        builderStuff.querySelector('#divBuilderMode').style.display = 'none';
      }
    }
    this.config = config;
    var btns = document.querySelectorAll('.input-setcolor');
    btns.forEach(function (btn) {
      btn.addEventListener('click', function (e) {
        var n = btn.getAttribute('data-index');
        var item = _this.builder.themes[n];
        _this.builder.setUIColor(item[1], item[2]);
        _this.builder.themeIndex = n;
        e.preventDefault();
        e.stopImmediatePropagation();
      });
    });
  }
  preferences_createClass(Preferences, [{
    key: "view",
    value: function view() {
      var util = new Util(this.builder);
      var modal = this.config;
      util.showModal(modal, false, null, false);

      // Display values
      if (this.builder.opts.rowcolOutline) {
        modal.querySelector('.input-hiderowcoloutline').checked = false;
      } else {
        modal.querySelector('.input-hiderowcoloutline').checked = true;
      }
      if (this.builder.opts.columnTool) {
        modal.querySelector('.input-hidecelltool').checked = false;
      } else {
        modal.querySelector('.input-hidecelltool').checked = true;
      }
      if (this.builder.opts.snippetAddTool) {
        modal.querySelector('.input-hidesnippetaddtool').checked = false;
      } else {
        modal.querySelector('.input-hidesnippetaddtool').checked = true;
      }
      if (this.builder.opts.elementTool) {
        modal.querySelector('.input-hideelementtool').checked = false;
      } else {
        modal.querySelector('.input-hideelementtool').checked = true;
      }
      if (this.builder.opts.elementHighlight) {
        modal.querySelector('.input-hideelementhighlight').checked = false;
      } else {
        modal.querySelector('.input-hideelementhighlight').checked = true;
      }
      if (this.builder.opts.snippetOpen) {
        modal.querySelector('.input-opensnippets').checked = true;
      } else {
        modal.querySelector('.input-opensnippets').checked = false;
      }
      this.config.querySelector('.select-buildermode').value = this.builder.opts.builderMode;
      this.config.querySelector('.select-rowtool').value = this.builder.opts.rowTool;
      this.config.querySelector('.select-outlinemode').value = this.builder.opts.outlineMode;
      this.config.querySelector('.select-outlinestyle').value = this.builder.opts.outlineStyle;
      this.config.querySelector('.select-toolstyle').value = this.builder.opts.toolStyle;
      this.config.querySelector('.select-pasteresult').value = this.builder.opts.paste;
      this.config.querySelector('.select-editingtoolbardisplay').value = this.builder.opts.toolbarDisplay;
      this.config.querySelector('.select-editingtoolbar').value = this.builder.opts.toolbar;
      this.config.querySelector('.select-snippetssidebardisplay').value = this.builder.opts.snippetsSidebarDisplay;
      if (this.builder.opts.shortenHTML) {
        this.config.querySelector('.select-htmlview').value = 'shorten';
      } else {
        this.config.querySelector('.select-htmlview').value = 'actual';
      }
    }
  }, {
    key: "update",
    value: function update() {
      // Update values
      var hideoutline = this.config.querySelector('.input-hiderowcoloutline').checked;
      if (hideoutline) {
        this.builder.opts.rowcolOutline = false;
        localStorage.setItem('_hiderowcoloutline', '1');
      } else {
        this.builder.opts.rowcolOutline = true;
        localStorage.setItem('_hiderowcoloutline', '0');
      }
      this.setOutline(hideoutline);
      var hidecolumntool = this.config.querySelector('.input-hidecelltool').checked;
      if (hidecolumntool) {
        this.builder.opts.columnTool = false;
        localStorage.setItem('_hidecelltool', '1');
        this.setColumnTool(true);
      } else {
        this.builder.opts.columnTool = true;
        localStorage.setItem('_hidecelltool', '0');
        this.setColumnTool(false);
      }
      var hidesnippetaddtool = this.config.querySelector('.input-hidesnippetaddtool').checked;
      if (hidesnippetaddtool) {
        this.builder.opts.snippetAddTool = false;
        localStorage.setItem('_hidesnippetaddtool', '1');
        this.setSnippetAddTool(true);
      } else {
        this.builder.opts.snippetAddTool = true;
        localStorage.setItem('_hidesnippetaddtool', '0');
        this.setSnippetAddTool(false);
      }
      var hideelementtool = this.config.querySelector('.input-hideelementtool').checked;
      if (hideelementtool) {
        this.builder.opts.elementTool = false;
        localStorage.setItem('_hideelementtool', '1');
        this.setElementTool(true);
      } else {
        this.builder.opts.elementTool = true;
        localStorage.setItem('_hideelementtool', '0');
        this.setElementTool(false);
      }
      var hideelementhighlight = this.config.querySelector('.input-hideelementhighlight').checked;
      if (hideelementhighlight) {
        this.builder.opts.elementHighlight = false;
        localStorage.setItem('_hideelementhighlight', '1');
        this.setElementHighlight(true);
      } else {
        this.builder.opts.elementHighlight = true;
        localStorage.setItem('_hideelementhighlight', '0');
        this.setElementHighlight(false);
      }
      var snippetopen = this.config.querySelector('.input-opensnippets').checked;
      if (snippetopen) {
        this.builder.opts.snippetOpen = true;
        localStorage.setItem('_opensnippets', '1');
      } else {
        this.builder.opts.snippetOpen = false;
        localStorage.setItem('_opensnippets', '0');
      }
      var builderMode = this.config.querySelector('.select-buildermode').value;
      this.builder.opts.builderMode = builderMode;
      localStorage.setItem('_buildermode', builderMode);
      this.setBuilderMode(builderMode);
      var rowTool = this.config.querySelector('.select-rowtool').value;
      this.builder.opts.rowTool = rowTool;
      localStorage.setItem('_rowtool', rowTool);
      this.setRowToolPosition(rowTool);
      var outlineMode = this.config.querySelector('.select-outlinemode').value;
      this.builder.opts.outlineMode = outlineMode;
      localStorage.setItem('_outlinemode', outlineMode);
      this.setOutlineMode(outlineMode);
      var outlineStyle = this.config.querySelector('.select-outlinestyle').value;
      this.builder.opts.outlineStyle = outlineStyle;
      localStorage.setItem('_outlinestyle', outlineStyle);
      this.setOutlineStyle(outlineStyle);
      var toolStyle = this.config.querySelector('.select-toolstyle').value;
      this.builder.opts.toolStyle = toolStyle;
      localStorage.setItem('_toolstyle', toolStyle);
      this.setToolStyle(toolStyle);
      var pasteResult = this.config.querySelector('.select-pasteresult').value;
      this.builder.opts.paste = pasteResult;
      localStorage.setItem('_pasteresult', pasteResult);
      var toolbarDisplay = this.config.querySelector('.select-editingtoolbardisplay').value;
      this.builder.opts.toolbarDisplay = toolbarDisplay;
      localStorage.setItem('_editingtoolbardisplay', toolbarDisplay);
      // this.setToolbarDisplay(toolbarDisplay);

      var snippetsSidebarDisplay = this.config.querySelector('.select-snippetssidebardisplay').value;
      this.builder.opts.snippetsSidebarDisplay = snippetsSidebarDisplay;
      localStorage.setItem('_snippetssidebardisplay', snippetsSidebarDisplay);
      var toolbar = this.config.querySelector('.select-editingtoolbar').value;
      this.builder.opts.toolbar = toolbar;
      localStorage.setItem('_editingtoolbar', toolbar);
      this.setToolbar(toolbar);
      var htmlView = this.config.querySelector('.select-htmlview').value;
      if (htmlView === 'shorten') {
        this.builder.opts.shortenHTML = true;
      } else {
        this.builder.opts.shortenHTML = false;
      }
      localStorage.setItem('_htmlview', htmlView);
      if (this.builder.themes) {
        var n = this.builder.themeIndex;
        if (this.builder.themeIndex) localStorage.setItem('_theme', n);
      }

      // clear/hide rte pops
      var builderStuff = this.builder.builderStuff;
      var rtepops = builderStuff.querySelectorAll('.is-rte-pop');
      Array.prototype.forEach.call(rtepops, function (rtepop) {
        rtepop.style.display = '';
      });
    }
  }, {
    key: "setToolbar",
    value: function setToolbar(toolbar) {
      var dom = this.dom;
      var builderStuff = this.builder.builderStuff;
      var contentStuff = this.builder.contentStuff;
      if (toolbar === 'topfull') {
        builderStuff.setAttribute('toolbarfull', '');
        builderStuff.removeAttribute('toolbarleft', '');
        builderStuff.removeAttribute('toolbarright', '');
        if (this.builder.iframe) {
          contentStuff.removeAttribute('toolbarleft', '');
          contentStuff.removeAttribute('toolbarright', '');
        }
      } else if (toolbar === 'top') {
        builderStuff.removeAttribute('toolbarleft', '');
        builderStuff.removeAttribute('toolbarright', '');
        builderStuff.removeAttribute('toolbarfull', '');
        if (this.builder.iframe) {
          contentStuff.removeAttribute('toolbarleft', '');
          contentStuff.removeAttribute('toolbarright', '');
        }
      } else if (toolbar === 'left') {
        builderStuff.setAttribute('toolbarleft', '');
        builderStuff.removeAttribute('toolbarright', '');
        builderStuff.removeAttribute('toolbarfull', '');
        if (this.builder.iframe) {
          contentStuff.setAttribute('toolbarleft', '');
          contentStuff.removeAttribute('toolbarright', '');
        }
      } else if (toolbar === 'right') {
        builderStuff.setAttribute('toolbarright', '');
        builderStuff.removeAttribute('toolbarleft', '');
        builderStuff.removeAttribute('toolbarfull', '');
        if (this.builder.iframe) {
          contentStuff.setAttribute('toolbarright', '');
          contentStuff.removeAttribute('toolbarleft', '');
        }
      }

      // this.positionToolbar();
      var rteTool = builderStuff.querySelector('.is-rte-tool');
      var rteMoreOptions = builderStuff.querySelector('.rte-more-options');
      var elementRteMoreOptions = builderStuff.querySelector('.elementrte-more-options');
      if (rteTool) this.builder.rte.positionToolbar();
      if (rteMoreOptions) {
        dom.removeClass(rteMoreOptions, 'active');
        dom.addClass(rteMoreOptions, 'deactive');
        dom.removeClass(elementRteMoreOptions, 'active');
        dom.addClass(elementRteMoreOptions, 'deactive');
      }
    }
  }, {
    key: "setEmailMode",
    value: function setEmailMode() {
      var builderStuff = this.builder.builderStuff;
      builderStuff.setAttribute('emailmode', '');
      if (this.builder.iframe) {
        var contentStuff = this.builder.contentStuff;
        contentStuff.setAttribute('emailmode', '');
      }
    }

    /*
    positionToolbar() { // direct
        let builderStuff = document.querySelector('#_cbhtml');
        const rteTool = builderStuff.querySelector('.is-rte-tool');
        const rteMoreOptions = builderStuff.querySelector('.rte-more-options');
        if(rteTool){ // check in case rte stuff hasn't rendered yet
             const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
             if(this.builder.opts.toolbar === 'left' || this.builder.opts.toolbar === 'right') {
    
                let h = rteTool.offsetHeight;
    
                let top = (viewportHeight/2) - (h/2);
    
                rteTool.style.left = '';
                rteTool.style.top = top + 'px';
                
            } else {
    
                let w = rteTool.offsetWidth;
        
                let left = (viewportWidth/2) - (w/2);
        
                rteTool.style.top = '';
                rteTool.style.left = left + 'px';
    
            }
        }
        if(rteMoreOptions) {
            //rteMoreOptions.style.display = '';
            dom.removeClass(rteMoreOptions,'active');
            dom.addClass(rteMoreOptions, 'deactive');
        }
    }
     setToolbarDisplay(toolbardisplay) {
        let builderStuff = document.querySelector('#_cbhtml');
        if(toolbardisplay==='auto'){
             builderStuff.removeAttribute('toolbarstay','');
             // direct
            const rteTool = builderStuff.querySelector('.is-rte-tool');
            if(rteTool) { // check in case rte stuff hasn't rendered yet
                rteTool.style.display = '';
            }
         } else {
             builderStuff.setAttribute('toolbarstay','');
             // direct
            const viewportWidth = window.innerWidth;
            const rteTool = builderStuff.querySelector('.is-rte-tool');
            if(rteTool) { // check in case rte stuff hasn't rendered yet
                let w = rteTool.offsetWidth;
                let left = (viewportWidth/2) - (w/2);
                rteTool.style.left = left + 'px';
            }
         }
    }
    */
  }, {
    key: "setElementTool",
    value: function setElementTool(hideelementtool) {
      var builderStuff = this.builder.builderStuff;
      if (hideelementtool) {
        builderStuff.setAttribute('hideelementtool', '');
      } else {
        builderStuff.removeAttribute('hideelementtool', '');
      }
      if (this.builder.iframe) {
        var contentStuff = this.builder.contentStuff;
        if (hideelementtool) {
          contentStuff.setAttribute('hideelementtool', '');
        } else {
          contentStuff.removeAttribute('hideelementtool', '');
        }
      }
    }
  }, {
    key: "setElementHighlight",
    value: function setElementHighlight(hideelementhighlight) {
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (hideelementhighlight) {
          builder.setAttribute('hideelementhighlight', '');
        } else {
          builder.removeAttribute('hideelementhighlight', '');
        }
      });
    }
  }, {
    key: "setOutlineStyle",
    value: function setOutlineStyle(outlineStyle) {
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (outlineStyle === 'grayoutline') {
          builder.setAttribute('grayoutline', '');
        } else {
          builder.removeAttribute('grayoutline');
        }
      });
    }
  }, {
    key: "setColumnTool",
    value: function setColumnTool(hidecolumntool) {
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      if (hidecolumntool) {
        Array.prototype.forEach.call(builders, function (builder) {
          builder.setAttribute('hidecolumntool', '');
        });
      } else {
        Array.prototype.forEach.call(builders, function (builder) {
          builder.removeAttribute('hidecolumntool');
        });
      }
    }
  }, {
    key: "setSnippetAddTool",
    value: function setSnippetAddTool(hidesnippetaddtool) {
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (hidesnippetaddtool) {
          builder.setAttribute('hidesnippetaddtool', '');
        } else {
          builder.removeAttribute('hidesnippetaddtool', '');
        }
      });
    }
  }, {
    key: "setToolStyle",
    value: function setToolStyle(toolStyle) {
      var builderStuff = this.builder.builderStuff;
      if (toolStyle === 'gray') {
        builderStuff.setAttribute('gray', '');
      } else {
        builderStuff.removeAttribute('gray', '');
      }
      if (this.builder.iframe) {
        var contentStuff = this.builder.contentStuff;
        if (toolStyle === 'gray') {
          contentStuff.setAttribute('gray', '');
        } else {
          contentStuff.removeAttribute('gray', '');
        }
      }
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (toolStyle === 'gray') {
          builder.setAttribute('gray', '');
        } else {
          builder.removeAttribute('gray');
        }
      });
    }
  }, {
    key: "setOutlineMode",
    value: function setOutlineMode(outlineMode) {
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (outlineMode === 'row') {
          builder.setAttribute('rowoutline', '');
        } else {
          builder.removeAttribute('rowoutline');
        }
      });
    }
  }, {
    key: "setOutline",
    value: function setOutline(hideoutline) {
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (hideoutline) {
          builder.setAttribute('hideoutline', '');
        } else {
          builder.removeAttribute('hideoutline');
        }
      });
    }
  }, {
    key: "setRowToolPosition",
    value: function setRowToolPosition(rowTool) {
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (rowTool === 'right') {
          builder.removeAttribute('leftrowtool');
        } else {
          builder.setAttribute('leftrowtool', '');
        }
      });
    }
  }, {
    key: "setBuilderMode",
    value: function setBuilderMode(builderMode) {
      var builderStuff = this.builder.builderStuff;
      if (builderMode === '') {
        builderStuff.removeAttribute('minimal');
        builderStuff.removeAttribute('clean');
      } else if (builderMode === 'minimal') {
        builderStuff.setAttribute('minimal', '');
        builderStuff.removeAttribute('clean');
      } else if (builderMode === 'clean') {
        builderStuff.setAttribute('clean', '');
        builderStuff.removeAttribute('minimal');
      }
      if (this.builder.iframe) {
        var contentStuff = this.builder.contentStuff;
        if (builderMode === '') {
          contentStuff.removeAttribute('minimal');
          contentStuff.removeAttribute('clean');
        } else if (builderMode === 'minimal') {
          contentStuff.setAttribute('minimal', '');
          contentStuff.removeAttribute('clean');
        } else if (builderMode === 'clean') {
          contentStuff.setAttribute('clean', '');
          contentStuff.removeAttribute('minimal');
        }
      }
      var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        if (builderMode === '') {
          builder.removeAttribute('minimal');
          builder.removeAttribute('clean');
        } else if (builderMode === 'minimal') {
          builder.setAttribute('minimal', '');
          builder.removeAttribute('clean');
        } else if (builderMode === 'clean') {
          builder.setAttribute('clean', '');
          builder.removeAttribute('minimal');
        }
      });
    }
  }, {
    key: "initBuilder",
    value: function initBuilder(builder) {
      var builderMode = this.builder.opts.builderMode;
      if (builderMode === '') {
        builder.removeAttribute('minimal');
        builder.removeAttribute('clean');
      } else if (builderMode === 'minimal') {
        builder.setAttribute('minimal', '');
        builder.removeAttribute('clean');
      } else if (builderMode === 'clean') {
        builder.setAttribute('clean', '');
        builder.removeAttribute('minimal');
      }
      var rowTool = this.builder.opts.rowTool;
      if (rowTool === 'right') {
        builder.removeAttribute('leftrowtool');
      } else {
        builder.setAttribute('leftrowtool', '');
      }
      var hideoutline = !this.builder.opts.rowcolOutline;
      if (hideoutline) {
        builder.setAttribute('hideoutline', '');
      } else {
        builder.removeAttribute('hideoutline');
      }
      var outlineMode = this.builder.opts.outlineMode;
      if (outlineMode === 'row') {
        builder.setAttribute('rowoutline', '');
      } else {
        builder.removeAttribute('rowoutline');
      }
      var toolStyle = this.builder.opts.toolStyle;
      if (toolStyle === 'gray') {
        builder.setAttribute('gray', '');
      } else {
        builder.removeAttribute('gray');
      }
      var hidesnippetaddtool = !this.builder.opts.snippetAddTool;
      if (hidesnippetaddtool) {
        builder.setAttribute('hidesnippetaddtool', '');
      } else {
        builder.removeAttribute('hidesnippetaddtool', '');
      }
      var outlineStyle = this.builder.opts.outlineStyle;
      if (outlineStyle === 'grayoutline') {
        builder.setAttribute('grayoutline', '');
      } else {
        builder.removeAttribute('grayoutline');
      }
      var hideelementhighlight = !this.builder.opts.elementHighlight;
      if (hideelementhighlight) {
        builder.setAttribute('hideelementhighlight', '');
      } else {
        builder.removeAttribute('hideelementhighlight', '');
      }
    }
  }]);
  return Preferences;
}();
/* harmony default export */ const preferences = (Preferences);
;// CONCATENATED MODULE: ./src/contentbuilder/fonts.js
var fontList = [{
  value: '',
  label: '',
  fontFamily: '',
  fontStyle: '',
  fontDisplay: '',
  provider: ''
}, {
  value: 'helvetica neue',
  // Arial
  label: '<img src="%path%arial.png">',
  fontFamily: '\'Helvetica Neue\', \'Arial Nova\', \'Nimbus Sans\', Arial, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: ''
}, {
  value: 'nimbus mono ps',
  // Courier
  label: '<img src="%path%courier.png">',
  fontFamily: '\'Nimbus Mono PS\', \'Courier New\', monospace',
  fontStyle: '',
  fontDisplay: '',
  provider: ''
}, {
  value: 'superclarendon',
  // Georgia
  label: '<img src="%path%georgia.png">',
  fontFamily: 'Superclarendon, \'Bookman Old Style\', \'URW Bookman\', \'URW Bookman L\', \'Georgia Pro\', Georgia, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: ''
}, {
  value: 'ui-monospace',
  // monospace
  label: '<img src="%path%monospace.png">',
  fontFamily: 'ui-monospace, \'Cascadia Code\', \'Source Code Pro\', Menlo, Consolas, \'DejaVu Sans Mono\', monospace',
  fontStyle: '',
  fontDisplay: '',
  provider: ''
}, {
  value: 'system-ui',
  // sans-serif
  label: '<img src="%path%sans_serif.png">',
  fontFamily: 'system-ui, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: ''
}, {
  value: 'charter',
  // serif
  label: '<img src="%path%serif.png">',
  fontFamily: 'Charter, \'Bitstream Charter\', \'Sitka Text\', Cambria, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: ''
}, {
  value: 'abel',
  label: '<img src="%path%abel.png">',
  fontFamily: 'Abel, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'abril fatface',
  label: '<img src="%path%abril_fatface.png">',
  fontFamily: 'Abril Fatface',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'advent pro',
  label: '<img src="%path%advent_pro.png">',
  fontFamily: 'Advent Pro, sans-serif',
  fontStyle: 'wght@100;200;300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'aladin',
  label: '<img src="%path%aladin.png">',
  fontFamily: 'Aladin, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'alegreya',
  label: '<img src="%path%alegreya.png">',
  fontFamily: 'Alegreya, serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'alegreya sc',
  label: '<img src="%path%alegreya_sc.png">',
  fontFamily: 'Alegreya SC, serif',
  fontStyle: 'ital,wght@0,400;0,500;0,700;0,800;0,900;1,400;1,500;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'alice',
  label: '<img src="%path%alice.png">',
  fontFamily: 'Alice, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'allerta stencil',
  label: '<img src="%path%allerta_stencil.png">',
  fontFamily: 'Allerta Stencil, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'allura',
  label: '<img src="%path%allura.png">',
  fontFamily: 'Allura, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'almendra display',
  label: '<img src="%path%almendra_display.png">',
  fontFamily: 'Almendra Display, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'amatic sc',
  label: '<img src="%path%amatic_sc.png">',
  fontFamily: 'Amatic SC, cursive',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'andika',
  label: '<img src="%path%andika.png">',
  fontFamily: 'Andika, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'anonymous pro',
  label: '<img src="%path%anonymous_pro.png">',
  fontFamily: 'Anonymous Pro, monospace',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'architects daughter',
  label: '<img src="%path%architects_daughter.png">',
  fontFamily: 'Architects Daughter, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'arimo',
  label: '<img src="%path%arimo.png">',
  fontFamily: 'Arimo, sans-serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'arsenal',
  label: '<img src="%path%arsenal.png">',
  fontFamily: 'Arsenal, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'assistant',
  label: '<img src="%path%assistant.png">',
  fontFamily: 'Assistant',
  fontStyle: 'wght@200;300;400;500;600;700;800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'aubrey',
  label: '<img src="%path%aubrey.png">',
  fontFamily: 'Aubrey, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'anton',
  label: '<img src="%path%anton.png">',
  fontFamily: 'Anton, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'archivo narrow',
  label: '<img src="%path%archivo_narrow.png">',
  fontFamily: 'Archivo Narrow, sans-serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'bad script',
  label: '<img src="%path%bad_script.png">',
  fontFamily: 'Bad Script, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'benchNine',
  label: '<img src="%path%benchNine.png">',
  fontFamily: 'BenchNine, sans-serif',
  fontStyle: 'wght@300;400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'bevan',
  label: '<img src="%path%bevan.png">',
  fontFamily: 'Bevan, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'bigelow rules',
  label: '<img src="%path%bigelow_rules.png">',
  fontFamily: 'Bigelow Rules, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'bilbo',
  label: '<img src="%path%bilbo.png">',
  fontFamily: 'Bilbo, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'bonbon',
  label: '<img src="%path%bonbon.png">',
  fontFamily: 'Bonbon, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'bowlby one sc',
  label: '<img src="%path%bowlby_one_sc.png">',
  fontFamily: 'Bowlby One SC, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cabin condensed',
  label: '<img src="%path%cabin_condensed.png">',
  fontFamily: 'Cabin Condensed, sans-serif',
  fontStyle: 'wght@400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'carrois gothic sc',
  label: '<img src="%path%carrois_gothic_sc.png">',
  fontFamily: 'Carrois Gothic SC, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'caveat',
  label: '<img src="%path%caveat.png">',
  fontFamily: 'Caveat, cursive',
  fontStyle: 'wght@400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'chewy',
  label: '<img src="%path%chewy.png">',
  fontFamily: 'Chewy, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cinzel',
  label: '<img src="%path%cinzel.png">',
  fontFamily: 'Cinzel, serif',
  fontStyle: 'wght@400;500;600;700;800;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'comfortaa',
  label: '<img src="%path%comfortaa.png">',
  fontFamily: 'Comfortaa, cursive',
  fontStyle: 'wght@300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'concert one',
  label: '<img src="%path%concert_one.png">',
  fontFamily: 'Concert One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cormorant',
  label: '<img src="%path%cormorant.png">',
  fontFamily: 'Cormorant, serif',
  fontStyle: 'ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cormorant garamond',
  label: '<img src="%path%cormorant_garamond.png">',
  fontFamily: 'Cormorant Garamond, serif',
  fontStyle: 'ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cormorant infant',
  label: '<img src="%path%cormorant_infant.png">',
  fontFamily: 'Cormorant Infant, serif',
  fontStyle: 'ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cormorant sc',
  label: '<img src="%path%cormorant_sc.png">',
  fontFamily: 'Cormorant SC, serif',
  fontStyle: 'wght@300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cormorant unicase',
  label: '<img src="%path%cormorant_unicase.png">',
  fontFamily: 'Cormorant Unicase, serif',
  fontStyle: 'wght@300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cousine',
  label: '<img src="%path%cousine.png">',
  fontFamily: 'Cousine',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'crafty girls',
  label: '<img src="%path%crafty_girls.png">',
  fontFamily: 'Crafty Girls, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cuprum',
  label: '<img src="%path%cuprum.png">',
  fontFamily: 'Cuprum, sans-serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'cutive mono',
  label: '<img src="%path%cutive_mono.png">',
  fontFamily: 'Cutive Mono, monospace',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'devonshire',
  label: '<img src="%path%devonshire.png">',
  fontFamily: 'Devonshire, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'didact gothic',
  label: '<img src="%path%didact_gothic.png">',
  fontFamily: 'Didact Gothic, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'diplomata sc',
  label: '<img src="%path%diplomata_sc.png">',
  fontFamily: 'Diplomata SC, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'dosis',
  label: '<img src="%path%dosis.png">',
  fontFamily: 'Dosis, sans-serif',
  fontStyle: 'wght@200;300;400;500;600;700;800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'eb garamond',
  label: '<img src="%path%eb_garamond.png">',
  fontFamily: 'EB Garamond, serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500;1,600;1,700;1,800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'el messiri',
  label: '<img src="%path%el_messiri.png">',
  fontFamily: 'El Messiri, sans-serif',
  fontStyle: 'wght@400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'elsie',
  label: '<img src="%path%elsie.png">',
  fontFamily: 'Elsie, cursive',
  fontStyle: 'wght@400;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'encode sans',
  label: '<img src="%path%encode_sans.png">',
  fontFamily: 'Encode Sans, sans-serif',
  fontStyle: 'wght@100;200;300;400;500;600;700;800;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'exo',
  label: '<img src="%path%exo.png">',
  fontFamily: 'Exo, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'exo 2',
  label: '<img src="%path%exo_2.png">',
  fontFamily: '\'Exo 2\', sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'felipa',
  label: '<img src="%path%felipa.png">',
  fontFamily: 'Felipa, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'fira code',
  label: '<img src="%path%fira_code.png">',
  fontFamily: 'Fira Code, monospace',
  fontStyle: 'wght@300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'fira mono',
  label: '<img src="%path%fira_mono.png">',
  fontFamily: 'Fira Mono, monospace',
  fontStyle: 'wght@400;500;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'fira sans',
  label: '<img src="%path%fira_sans.png">',
  fontFamily: 'Fira Sans, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'fira sans condensed',
  label: '<img src="%path%fira_sans_condensed.png">',
  fontFamily: 'Fira Sans Condensed, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'fira sans extra condensed',
  label: '<img src="%path%fira_sans_extra_condensed.png">',
  fontFamily: 'Fira Sans Extra Condensed, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'fjalla one',
  label: '<img src="%path%fjalla_one.png">',
  fontFamily: 'Fjalla One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'forum',
  label: '<img src="%path%forum.png">',
  fontFamily: 'Forum, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'frank ruhl libre',
  label: '<img src="%path%frank_ruhl_libre.png">',
  fontFamily: 'Frank Ruhl Libre',
  fontStyle: 'wght@300;400;500;700;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'fredericka the great',
  label: '<img src="%path%fredericka_the_great.png">',
  fontFamily: 'Fredericka the Great, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'gabriela',
  label: '<img src="%path%gabriela.png">',
  fontFamily: 'Gabriela, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'gilda display',
  label: '<img src="%path%gilda_display.png">',
  fontFamily: 'Gilda Display, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'give you glory',
  label: '<img src="%path%give_you_glory.png">',
  fontFamily: 'Give You Glory, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'handlee',
  label: '<img src="%path%handlee.png">',
  fontFamily: 'Handlee, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'happy monkey',
  label: '<img src="%path%happy_monkey.png">',
  fontFamily: 'Happy Monkey, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'hind',
  label: '<img src="%path%hind.png">',
  fontFamily: 'Hind',
  fontStyle: 'wght@300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ibm plex mono',
  label: '<img src="%path%ibm_plex_mono.png">',
  fontFamily: 'IBM Plex Mono, monospace',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ibm plex sans',
  label: '<img src="%path%ibm_plex_sans.png">',
  fontFamily: 'IBM Plex Sans, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ibm plex serif',
  label: '<img src="%path%ibm_plex_serif.png">',
  fontFamily: 'IBM Plex Serif, serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'iceland',
  label: '<img src="%path%iceland.png">',
  fontFamily: 'Iceland, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'inconsolata',
  label: '<img src="%path%inconsolata.png">',
  fontFamily: 'Inconsolata, monospace',
  fontStyle: 'wght@200;300;400;500;600;700;800;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'istok web',
  label: '<img src="%path%istok_web.png">',
  fontFamily: 'Istok Web, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'josefin sans',
  label: '<img src="%path%josefin_sans.png">',
  fontFamily: 'Josefin Sans, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'julee',
  label: '<img src="%path%julee.png">',
  fontFamily: 'Julee, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'julius sans one',
  label: '<img src="%path%julius_sans_one.png">',
  fontFamily: 'Julius Sans One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'junge',
  label: '<img src="%path%junge.png">',
  fontFamily: 'Junge, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'jura',
  label: '<img src="%path%jura.png">',
  fontFamily: 'Jura, sans-serif',
  fontStyle: 'wght@300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'just me again down here',
  label: '<img src="%path%just_me_again_down_here.png">',
  fontFamily: 'Just Me Again Down Here, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'kaushan script',
  label: '<img src="%path%kaushan_script.png">',
  fontFamily: 'Kaushan Script, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'kelly slab',
  label: '<img src="%path%kelly_slab.png">',
  fontFamily: 'Kelly Slab, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'kite one',
  label: '<img src="%path%kite_one.png">',
  fontFamily: 'Kite One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'kosugi',
  label: '<img src="%path%kosugi.png">',
  fontFamily: 'Kosugi, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'kosugi maru',
  label: '<img src="%path%kosugi_maru.png">',
  fontFamily: 'Kosugi Maru, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'kurale',
  label: '<img src="%path%kurale.png">',
  fontFamily: 'Kurale, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'lato',
  label: '<img src="%path%lato.png">',
  fontFamily: 'Lato, sans-serif',
  fontStyle: 'ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ledger',
  label: '<img src="%path%ledger.png">',
  fontFamily: 'Ledger, serif',
  fontStyle: '',
  fontDisplay: 'swap',
  provider: 'google'
}, {
  value: 'lekton',
  label: '<img src="%path%lekton.png">',
  fontFamily: 'Lekton, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'life savers',
  label: '<img src="%path%life_savers.png">',
  fontFamily: 'Life Savers, cursive',
  fontStyle: 'wght@400;700;800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'literata',
  label: '<img src="%path%literata.png">',
  fontFamily: 'Literata, serif',
  fontStyle: 'ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'lobster',
  label: '<img src="%path%lobster.png">',
  fontFamily: 'Lobster, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'lobster two',
  label: '<img src="%path%lobster_two.png">',
  fontFamily: 'Lobster Two, cursive',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'londrina shadow',
  label: '<img src="%path%londrina_shadow.png">',
  fontFamily: 'Londrina Shadow, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'lora',
  label: '<img src="%path%lora.png">',
  fontFamily: 'Lora, serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'lovers quarrel',
  label: '<img src="%path%lovers_quarrel.png">',
  fontFamily: 'Lovers Quarrel, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'm plus 1p',
  label: '<img src="%path%m_plus_1p.png">',
  fontFamily: '\'M PLUS 1p\', sans-serif',
  fontStyle: 'wght@100;300;400;500;700;800;900',
  fontDisplay: 'swap',
  provider: 'google'
}, {
  value: 'm plus rounded 1c',
  label: '<img src="%path%m_plus_rounded_1c.png">',
  fontFamily: '\'M PLUS Rounded 1c\', sans-serif',
  fontStyle: 'wght@100;300;400;500;700;800;900',
  fontDisplay: 'swap',
  provider: 'google'
}, {
  value: 'macondo',
  label: '<img src="%path%macondo.png">',
  fontFamily: 'Macondo, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'marcellus sc',
  label: '<img src="%path%marcellus_sc.png">',
  fontFamily: 'Marcellus SC, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'marck script',
  label: '<img src="%path%marck_script.png">',
  fontFamily: 'Marck Script, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'martel',
  label: '<img src="%path%martel.png">',
  fontFamily: 'Martel, serif',
  fontStyle: 'wght@200;300;400;600;700;800;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'maven pro',
  label: '<img src="%path%maven_pro.png">',
  fontFamily: 'Maven Pro, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'merriweather',
  label: '<img src="%path%merriweather.png">',
  fontFamily: 'Merriweather, serif',
  fontStyle: 'ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'merriweather sans',
  label: '<img src="%path%merriweather_sans.png">',
  fontFamily: 'Merriweather Sans',
  fontStyle: 'ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'mogra',
  label: '<img src="%path%mogra.png">',
  fontFamily: 'Mogra, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'monoton',
  label: '<img src="%path%monoton.png">',
  fontFamily: 'Monoton, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'montez',
  label: '<img src="%path%montez.png">',
  fontFamily: 'Montez, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'montserrat',
  label: '<img src="%path%montserrat.png">',
  fontFamily: 'Montserrat, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'montserrat alternates',
  label: '<img src="%path%montserrat_alternates.png">',
  fontFamily: 'Montserrat Alternates, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'montserrat subrayada',
  label: '<img src="%path%montserrat_subrayada.png">',
  fontFamily: 'Montserrat Subrayada, sans-serif',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'neucha',
  label: '<img src="%path%neucha.png">',
  fontFamily: 'Neucha, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'neuton',
  label: '<img src="%path%neuton.png">',
  fontFamily: 'Neuton, serif',
  fontStyle: 'ital,wght@0,200;0,300;0,400;0,700;0,800;1,400',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'nixie one',
  label: '<img src="%path%nixie_one.png">',
  fontFamily: 'Nixie One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'nothing you could do',
  label: '<img src="%path%nothing_you_could_do.png">',
  fontFamily: 'Nothing You Could Do, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'noto sans',
  label: '<img src="%path%noto_sans.png">',
  fontFamily: 'Noto Sans, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'noto sans sc',
  label: '<img src="%path%noto_sans_sc.png">',
  fontFamily: 'Noto Sans SC, sans-serif',
  fontStyle: 'wght@100;300;400;500;700;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'noto serif',
  label: '<img src="%path%noto_serif.png">',
  fontFamily: 'Noto Serif, serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'noto serif tc',
  label: '<img src="%path%noto_serif_tc.png">',
  fontFamily: 'Noto Serif TC, serif',
  fontStyle: 'wght@200;300;400;500;600;700;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'nunito',
  label: '<img src="%path%nunito.png">',
  fontFamily: 'Nunito, sans-serif',
  fontStyle: 'ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;0,1000;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900;1,1000',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'old standard tt',
  label: '<img src="%path%old_standard_tt.png">',
  fontFamily: 'Old Standard TT, serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'open sans',
  label: '<img src="%path%open_sans.png">',
  fontFamily: 'Open Sans, sans-serif',
  fontStyle: 'ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'oranienbaum',
  label: '<img src="%path%oranienbaum.png">',
  fontFamily: 'Oranienbaum, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'oswald',
  label: '<img src="%path%oswald.png">',
  fontFamily: 'Oswald, sans-serif',
  fontStyle: 'wght@200;300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'oxygen',
  label: '<img src="%path%oxygen.png">',
  fontFamily: 'Oxygen, sans-serif',
  fontStyle: 'wght@300;400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pacifico',
  label: '<img src="%path%pacifico.png">',
  fontFamily: 'Pacifico, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pangolin',
  label: '<img src="%path%pangolin.png">',
  fontFamily: 'Pangolin, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'passion one',
  label: '<img src="%path%passion_one.png">',
  fontFamily: 'Passion One, cursive',
  fontStyle: 'wght@400;700;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pathway gothic one',
  label: '<img src="%path%pathway_gothic_one.png">',
  fontFamily: 'Pathway Gothic One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pattaya',
  label: '<img src="%path%pattaya.png">',
  fontFamily: 'Pattaya, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'petit formal script',
  label: '<img src="%path%petit_formal_script.png">',
  fontFamily: 'Petit Formal Script, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'philosopher',
  label: '<img src="%path%philosopher.png">',
  fontFamily: 'Philosopher, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'play',
  label: '<img src="%path%play.png">',
  fontFamily: 'Play, sans-serif',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'playfair display',
  label: '<img src="%path%playfair_display.png">',
  fontFamily: 'Playfair Display, serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'playfair display sc',
  label: '<img src="%path%playfair_display_sc.png">',
  fontFamily: 'Playfair Display SC, serif',
  fontStyle: 'ital,wght@0,400;0,700;0,900;1,400;1,700;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'podkova',
  label: '<img src="%path%podkova.png">',
  fontFamily: 'Podkova, serif',
  fontStyle: 'wght@400;500;600;700;800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'poiret one',
  label: '<img src="%path%poiret_one.png">',
  fontFamily: 'Poiret One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pompiere',
  label: '<img src="%path%pompiere.png">',
  fontFamily: 'Pompiere, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'poppins',
  label: '<img src="%path%poppins.png">',
  fontFamily: 'Poppins, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'prata',
  label: '<img src="%path%prata.png">',
  fontFamily: 'Prata, serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'press start 2p',
  label: '<img src="%path%press_start_2p.png">',
  fontFamily: '\'Press Start 2P\', cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'prosto one',
  label: '<img src="%path%prosto_one.png">',
  fontFamily: 'Prosto One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pt mono',
  label: '<img src="%path%pt_mono.png">',
  fontFamily: 'PT Mono, monospace',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pt sans',
  label: '<img src="%path%pt_sans.png">',
  fontFamily: 'PT Sans, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pt sans caption',
  label: '<img src="%path%pt_sans_caption.png">',
  fontFamily: 'PT Sans Caption, sans-serif',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pt sans narrow',
  label: '<img src="%path%pt_sans_narrow.png">',
  fontFamily: 'PT Sans Narrow, sans-serif',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pt serif',
  label: '<img src="%path%pt_serif.png">',
  fontFamily: 'PT Serif, serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'pt serif caption',
  label: '<img src="%path%pt_serif_caption.png">',
  fontFamily: 'PT Serif Caption, serif',
  fontStyle: 'ital@0;1',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'quattrocento sans',
  label: '<img src="%path%quattrocento_sans.png">',
  fontFamily: 'Quattrocento Sans, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'quattrocento',
  label: '<img src="%path%quattrocento.png">',
  fontFamily: 'Quattrocento, serif',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'quicksand',
  label: '<img src="%path%quicksand.png">',
  fontFamily: 'Quicksand, sans-serif',
  fontStyle: 'wght@300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'qwigley',
  label: '<img src="%path%qwigley.png">',
  fontFamily: 'Qwigley, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'raleway',
  label: '<img src="%path%raleway.png">',
  fontFamily: 'Raleway, sans-serif',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'raleway dots',
  label: '<img src="%path%raleway_dots.png">',
  fontFamily: 'Raleway Dots, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'redressed',
  label: '<img src="%path%redressed.png">',
  fontFamily: 'Redressed, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ribeye marrow',
  label: '<img src="%path%ribeye_marrow.png">',
  fontFamily: 'Ribeye Marrow, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'righteous',
  label: '<img src="%path%righteous.png">',
  fontFamily: 'Righteous, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'roboto',
  label: '<img src="%path%roboto.png">',
  fontFamily: 'Roboto, sans-serif',
  fontStyle: 'ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'roboto condensed',
  label: '<img src="%path%roboto_condensed.png">',
  fontFamily: 'Roboto Condensed, sans-serif',
  fontStyle: 'ital,wght@0,300;0,400;0,700;1,300;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'roboto mono',
  label: '<img src="%path%roboto_mono.png">',
  fontFamily: 'Roboto Mono, monospace',
  fontStyle: 'ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'roboto slab',
  label: '<img src="%path%roboto_slab.png">',
  fontFamily: 'Roboto Slab, serif',
  fontStyle: 'wght@100;200;300;400;500;600;700;800;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'rochester',
  label: '<img src="%path%rochester.png">',
  fontFamily: 'Rochester, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'rouge script',
  label: '<img src="%path%rouge_script.png">',
  fontFamily: 'Rouge Script, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'rubik',
  label: '<img src="%path%rubik.png">',
  fontFamily: 'Rubik, sans-serif',
  fontStyle: 'ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'rubik mono one',
  label: '<img src="%path%rubik_mono_one.png">',
  fontFamily: 'Rubik Mono One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ruslan display',
  label: '<img src="%path%ruslan_display.png">',
  fontFamily: 'Ruslan Display, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'russo one',
  label: '<img src="%path%russo_one.png">',
  fontFamily: 'Russo One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'sacramento',
  label: '<img src="%path%sacramento.png">',
  fontFamily: 'Sacramento, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'sanchez',
  label: '<img src="%path%sanchez.png">',
  fontFamily: 'Sanchez, serif',
  fontStyle: 'ital@0;1',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'satisfy',
  label: '<img src="%path%satisfy.png">',
  fontFamily: 'Satisfy, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'sawarabi gothic',
  label: '<img src="%path%sawarabi_gothic.png">',
  fontFamily: 'Sawarabi Gothic, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'scada',
  label: '<img src="%path%scada.png">',
  fontFamily: 'Scada, sans-serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'seaweed script',
  label: '<img src="%path%seaweed_script.png">',
  fontFamily: 'Seaweed Script, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'seymour one',
  label: '<img src="%path%seymour_one.png">',
  fontFamily: 'Seymour One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'shadows into light two',
  label: '<img src="%path%shadows_into_light_two.png">',
  fontFamily: 'Shadows Into Light Two, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'six caps',
  label: '<img src="%path%six_caps.png">',
  fontFamily: 'Six Caps, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'snowburst one',
  label: '<img src="%path%snowburst_one.png">',
  fontFamily: 'Snowburst One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'source code pro',
  label: '<img src="%path%source_code_pro.png">',
  fontFamily: 'Source Code Pro, monospace',
  fontStyle: 'ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'source sans pro',
  label: '<img src="%path%source_sans_pro.png">',
  fontFamily: 'Source Sans Pro, sans-serif',
  fontStyle: 'ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'special elite',
  label: '<img src="%path%special_elite.png">',
  fontFamily: 'Special Elite, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'spectral',
  label: '<img src="%path%spectral.png">',
  fontFamily: 'Spectral, serif',
  fontStyle: 'ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'spectral_sc',
  label: '<img src="%path%spectral_sc.png">',
  fontFamily: 'Spectral SC, serif',
  fontStyle: 'ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'squada one',
  label: '<img src="%path%squada_one.png">',
  fontFamily: 'Squada One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'stalinist one',
  label: '<img src="%path%stalinist_one.png">',
  fontFamily: 'Stalinist One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'stint ultra expanded',
  label: '<img src="%path%stint_ultra_expanded.png">',
  fontFamily: 'Stint Ultra Expanded, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'syncopate',
  label: '<img src="%path%syncopate.png">',
  fontFamily: 'Syncopate, sans-serif',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'tangerine',
  label: '<img src="%path%tangerine.png">',
  fontFamily: 'Tangerine, cursive',
  fontStyle: 'wght@400;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'tenor sans',
  label: '<img src="%path%tenor_sans.png">',
  fontFamily: 'Tenor Sans, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'tinos',
  label: '<img src="%path%tinos.png">',
  fontFamily: 'Tinos, serif',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ubuntu',
  label: '<img src="%path%ubuntu.png">',
  fontFamily: 'Ubuntu, sans-serif',
  fontStyle: 'ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ubuntu condensed',
  label: '<img src="%path%ubuntu_condensed.png">',
  fontFamily: 'Ubuntu Condensed, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'ubuntu mono',
  label: '<img src="%path%ubuntu_mono.png">',
  fontFamily: 'Ubuntu Mono, monospace',
  fontStyle: 'ital,wght@0,400;0,700;1,400;1,700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'underdog',
  label: '<img src="%path%underdog.png">',
  fontFamily: 'Underdog, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'unifrakturmaguntia',
  label: '<img src="%path%unifrakturmaguntia.png">',
  fontFamily: 'UnifrakturMaguntia, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'vast shadow',
  label: '<img src="%path%vast_shadow.png">',
  fontFamily: 'Vast Shadow, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'viga',
  label: '<img src="%path%viga.png">',
  fontFamily: 'Viga, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'vollkorn',
  label: '<img src="%path%vollkorn.png">',
  fontFamily: 'Vollkorn, serif',
  fontStyle: 'ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'vollkorn sc',
  label: '<img src="%path%vollkorn_sc.png">',
  fontFamily: 'Vollkorn SC, serif',
  fontStyle: 'wght@400;600;700;900',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'voltaire',
  label: '<img src="%path%voltaire.png">',
  fontFamily: 'Voltaire, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'wire one',
  label: '<img src="%path%wire_one.png">',
  fontFamily: 'Wire One, sans-serif',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'yanone kaffeesatz',
  label: '<img src="%path%yanone_kaffeesatz.png">',
  fontFamily: 'Yanone Kaffeesatz, sans-serif',
  fontStyle: 'wght@200;300;400;500;600;700',
  fontDisplay: '',
  provider: 'google'
}, {
  value: 'yeseva one',
  label: '<img src="%path%yeseva_one.png">',
  fontFamily: 'Yeseva One, cursive',
  fontStyle: '',
  fontDisplay: '',
  provider: 'google'
}];
/* harmony default export */ const fonts = (fontList);
;// CONCATENATED MODULE: ./src/contentbuilder/rte.js
function rte_typeof(obj) { "@babel/helpers - typeof"; return rte_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, rte_typeof(obj); }
function rte_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function rte_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, rte_toPropertyKey(descriptor.key), descriptor); } }
function rte_createClass(Constructor, protoProps, staticProps) { if (protoProps) rte_defineProperties(Constructor.prototype, protoProps); if (staticProps) rte_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function rte_toPropertyKey(arg) { var key = rte_toPrimitive(arg, "string"); return rte_typeof(key) === "symbol" ? key : String(key); }
function rte_toPrimitive(input, hint) { if (rte_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (rte_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }





var Rte = /*#__PURE__*/function () {
  function Rte(builder) {
    var _this = this;
    rte_classCallCheck(this, Rte);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    this.dom = this.builder.dom;
    var dom = this.dom;
    this.elementStyleEditor = new elementpanel_css(builder);
    this.hyperlink = new elementhyperlink(builder);
    var rteTool = builderStuff.querySelector('#divRteTool');
    var elementRteTool;
    var rteAlignOptions;
    var rteFormattingOptions;
    var rteColorPicker;
    var rteListOptions;
    var rteFontFamilyOptions;
    var rteParagraphOptions;
    var rteMoreOptions;
    var elementRteMoreOptions;
    var rteTextSettingOptions;
    var rteZoomOptions;
    var rteIconOptions;
    var rteCustomTagOptions;
    var rteZoomSlider;
    var inpZoomSlider;
    if (!rteTool) {
      var zoomMax = 100;
      if (this.builder.canvas && !this.builder.isContentBox && this.builder.docContainer && !this.builder.iframe) {
        // freeform
        zoomMax = 200;
      }

      // if(builder.plugins.length>0) {
      var allButtons = ['|', 'addsnippet', 'bold', 'italic', 'underline', 'formatting', 'color', 'removeformat', 'align', 'textsettings', 'createlink', 'tags', 'undo', 'redo', 'zoom', 'livepreview', 'icon', 'image', 'list', 'font', 'formatpara', 'gridtool', 'html', 'preferences', 'more', 'left', 'center', 'right', 'full', 'group', 'ungroup', 'duplicate', 'addblock', 'front', 'backward', 'moveup', 'movedown', 'delete', 'blocksettings', 'aiassistant', 'snippets', 'svg', 'pageoptions', 'print'];
      var filterButtons = function filterButtons(myArray) {
        var newArray = myArray;
        myArray.forEach(function (item) {
          item = item.toLowerCase();
          var result = allButtons.filter(function (btnName) {
            return btnName === item;
          });
          if (result.length === 0) {
            // a plugin
            result = builder.plugins.filter(function (plugin) {
              // check if plugin registered.
              return plugin.name === item;
            });
            if (result.length === 0) {
              // plugin not registered
              newArray = newArray.filter(function (e) {
                return e !== item;
              });
            }
          }
        });

        // if(!this.builder.previewURL && newArray.indexOf('livepreview')!==-1) {
        //     newArray = newArray.filter((item)=>{
        //         return item !== 'livepreview';
        //     });
        // }

        if (!_this.builder.sendCommandUrl && newArray.indexOf('aiassistant') !== -1) {
          newArray = newArray.filter(function (item) {
            return item !== 'aiassistant';
          });
        }
        if (!_this.builder.snippetModal && newArray.indexOf('snippets') !== -1) {
          newArray = newArray.filter(function (item) {
            return item !== 'snippets';
          });
        }
        return newArray;
      };
      builder.opts.buttons = filterButtons(builder.opts.buttons);
      builder.opts.buttonsMore = filterButtons(builder.opts.buttonsMore);
      builder.opts.elementButtons = filterButtons(builder.opts.elementButtons);
      builder.opts.elementButtonsMore = filterButtons(builder.opts.elementButtonsMore);
      builder.opts.iconButtons = filterButtons(builder.opts.iconButtons);
      builder.opts.iconButtonsMore = filterButtons(builder.opts.iconButtonsMore);
      // }

      var customtag_button = '';
      var customTagsHtml = '';
      if (builder.opts.customTags.length > 0) {
        customtag_button = "<button tabindex=\"-1\" title=\"".concat(util.out('Tags'), "\" class=\"rte-tags\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px\"><use xlink:href=\"#ion-code-working\"></use></svg></button>");
        for (var _j = 0; _j < builder.opts.customTags.length; _j++) {
          customTagsHtml += "<button data-value=\"".concat(builder.opts.customTags[_j][1], "\"> ").concat(builder.opts.customTags[_j][0], " </button>");
        }
      }
      var html_rtemore = '';
      for (var j = 0; j < builder.opts.buttonsMore.length; j++) {
        var btn = builder.opts.buttonsMore[j].toLowerCase();
        if (btn === 'createlink') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Hyperlink'), "\" class=\"rte-link\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#ion-link\"></use></svg></button>");else if (btn === 'icon' && !this.builder.opts.emailMode) html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Icon'), "\" class=\"rte-icon\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;margin-top:2px;\"><use xlink:href=\"#ion-android-happy\"></use></svg></button>");else if (btn === 'svg' && !this.builder.opts.emailMode) html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('SVG'), "\" class=\"rte-svg\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;margin-top:2px;\"><use xlink:href=\"#icon-svg\"></use></svg></button>");else if (btn === 'removeformat') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Clean'), "\" class=\"rte-clean\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>");else if (btn === 'bold') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Bold'), "\" class=\"rte-format\" data-command=\"bold\"><span style=\"font-family:serif;font-size:14px;\">B</span></button>");else if (btn === 'italic') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Italic'), "\" class=\"rte-format\" data-command=\"italic\"><span style=\"font-family:serif;font-size:16px;font-style:italic;\">i</span></button>");else if (btn === 'underline') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Underline'), "\" class=\"rte-format\" data-command=\"underline\"><span style=\"font-family:serif;font-size:14px;text-decoration:underline;\">U</span></button>");
        // else if(btn==='createlink') html_rtemore += `<button tabindex="-1" title="${util.out('Hyperlink')}" class="rte-link"><svg class="is-icon-flex" style="width:14px;height:14px;"><use xlink:href="#ion-link"></use></svg></button>`; 
        else if (btn === 'align') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Align'), "\" class=\"rte-align\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;margin-top:-2px;\"><use xlink:href=\"#icon-align-full\"></use></svg></button>");else if (btn === 'list') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('List'), "\" class=\"rte-list\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#icon-list-bullet\"></use></svg></button>");else if (btn === 'color') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Color'), "\" class=\"rte-color\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-contrast\"></use></svg></button>");else if (btn === 'formatting') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Formatting'), "\" class=\"rte-formatting\"><span style=\"font-family:serif;font-size:15px;display:inline-block;\">A</span></button>");else if (btn === 'tags') html_rtemore += customtag_button;else if (btn === 'image') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Image'), "\" class=\"rte-image\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-image\"></use></svg></button>");else if (btn === 'gridtool') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Grid Tool'), "\" class=\"rte-grideditor\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;\"><use xlink:href=\"#ion-grid\"></use></svg></button>");else if (btn === 'html') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"rte-html\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></button>");else if (btn === 'preferences') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Preferences'), "\" class=\"rte-preferences\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-wrench\"></use></svg></button>");else if (btn === 'addsnippet') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>");else if (btn === 'formatpara') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Paragraph'), "\" class=\"rte-paragraph\"><span style=\"font-family:serif;font-size:14px;display:inline-block;margin-top:2px;\">H</span></button>");else if (btn === 'font') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Font'), "\" class=\"rte-fontfamily\"><span style=\"font-family:serif;font-size:18px;text-transform:none;display:inline-block;margin-top: -3px;\">a</span></button>");else if (btn === 'textsettings') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Text Settings'), "\" class=\"rte-textsettings\"><svg class=\"is-icon-flex\" style=\"width:16px;height:16px;\"><use xlink:href=\"#ion-ios-settings\"></use></svg></button>");else if (btn === 'undo') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Undo'), "\" class=\"rte-undo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-undo\"></use></svg></button>");else if (btn === 'redo') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Redo'), "\" class=\"rte-redo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-redo\"></use></svg></button>");else if (btn === 'aiassistant') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('AI Assistant'), "\" class=\"rte-ai\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-message\"></use></svg></button>");else if (btn === 'snippets') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Snippets'), "\" class=\"rte-snippets\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#icon-snippets\"></use></svg></button>");else if (btn === 'pageoptions') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Page Options'), "\" class=\"rte-pageoptions\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-pagesize\"></use></svg></button>");else if (btn === 'print') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Print'), "\" class=\"rte-print\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#icon-print\"></use></svg></button>");else if (btn === 'zoom') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Zoom'), "\" class=\"rte-zoom\"><svg class=\"is-icon-flex\" style=\"margin-top:1px;width:15px;height:15px;\"><use xlink:href=\"#icon-zoom-in\"></use></svg></button>");else if (btn === 'livepreview') html_rtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Live Preview'), "\" class=\"rte-livepreview\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-device-desktop\"></use></svg></button>");else if (btn === '|') {
          html_rtemore += '<div class="rte-separator"></div>';
        } else {
          html_rtemore += "<button tabindex=\"-1\" title=\"button not found\" data-plugin=\"".concat(btn, "\"></button>"); //temporary (later will be replaced with plugin button)
        }
      }

      var html_rte = '';
      for (j = 0; j < builder.opts.buttons.length; j++) {
        btn = builder.opts.buttons[j].toLowerCase();
        if (btn === 'bold') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Bold'), "\" class=\"rte-format\" data-command=\"bold\"><span style=\"font-family:serif;font-size:14px;\">B</span></button>");else if (btn === 'italic') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Italic'), "\" class=\"rte-format\" data-command=\"italic\"><span style=\"font-family:serif;font-size:16px;font-style:italic;\">i</span></button>");else if (btn === 'underline') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Underline'), "\" class=\"rte-format\" data-command=\"underline\"><span style=\"font-family:serif;font-size:14px;text-decoration:underline;\">U</span></button>");else if (btn === 'createlink') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Hyperlink'), "\" class=\"rte-link\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#ion-link\"></use></svg></button>");else if (btn === 'align') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Align'), "\" class=\"rte-align\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;margin-top:-2px;\"><use xlink:href=\"#icon-align-full\"></use></svg></button>");else if (btn === 'formatpara') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Paragraph'), "\" class=\"rte-paragraph\"><span style=\"font-family:serif;font-size:14px;display:inline-block;margin-top:2px;\">H</span></button>");else if (btn === 'color') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Color'), "\" class=\"rte-color\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-contrast\"></use></svg></button>");else if (btn === 'formatting') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Formatting'), "\" class=\"rte-formatting\"><span style=\"font-family:serif;font-size:15px;display:inline-block;\">A</span></button>");else if (btn === 'list') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('List'), "\" class=\"rte-list\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#icon-list-bullet\"></use></svg></button>");else if (btn === 'textsettings') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Text Settings'), "\" class=\"rte-textsettings\"><svg class=\"is-icon-flex\" style=\"width:16px;height:16px;\"><use xlink:href=\"#ion-ios-settings\"></use></svg></button>");else if (btn === 'icon' && !this.builder.opts.emailMode) html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Icon'), "\" class=\"rte-icon\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;margin-top:2px\"><use xlink:href=\"#ion-android-happy\"></use></svg></button>");else if (btn === 'svg' && !this.builder.opts.emailMode) html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('SVG'), "\" class=\"rte-svg\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;margin-top:2px\"><use xlink:href=\"#icon-svg\"></use></svg></button>");else if (btn === 'tags') html_rte += customtag_button;else if (btn === 'removeformat') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Clean'), "\" class=\"rte-format\" data-command=\"clean\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>");else if (btn === 'font') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Font'), "\" class=\"rte-fontfamily\"><span style=\"font-family:serif;font-size:18px;text-transform:none;display:inline-block;margin-top: -3px;\">a</span></button>");else if (btn === 'image') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Image'), "\" class=\"rte-image\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-image\"></use></svg></button>");else if (btn === 'gridtool') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Grid Tool'), "\" class=\"rte-grideditor\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:17px;height:17px;\"><use xlink:href=\"#ion-grid\"></use></svg></button>");else if (btn === 'html') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"rte-html\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></button>");else if (btn === 'preferences') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Preferences'), "\" class=\"rte-preferences\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-wrench\"></use></svg></button>");else if (btn === 'addsnippet') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>");else if (btn === 'undo') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Undo'), "\" class=\"rte-undo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-undo\"></use></svg></button>");else if (btn === 'redo') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Redo'), "\" class=\"rte-redo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-redo\"></use></svg></button>");else if (btn === 'aiassistant') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('AI Assistant'), "\" class=\"rte-ai\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-message\"></use></svg></button>");else if (btn === 'snippets') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Snippets'), "\" class=\"rte-snippets\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#icon-snippets\"></use></svg></button>");else if (btn === 'more' && html_rtemore !== '') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>");else if (btn === 'pageoptions') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Page Options'), "\" class=\"rte-pageoptions\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-pagesize\"></use></svg></button>");else if (btn === 'print') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Print'), "\" class=\"rte-print\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#icon-print\"></use></svg></button>");else if (btn === 'zoom') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Zoom'), "\" class=\"rte-zoom\"><svg class=\"is-icon-flex\" style=\"margin-top:1px;width:15px;height:15px;\"><use xlink:href=\"#icon-zoom-in\"></use></svg></button>");else if (btn === 'livepreview') html_rte += "<button tabindex=\"-1\" title=\"".concat(util.out('Live Preview'), "\" class=\"rte-livepreview\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-device-desktop\"></use></svg></button>");else if (btn === '|') {
          html_rte += '<div class="rte-separator"></div>';
        } else {
          html_rte += "<button tabindex=\"-1\" title=\"button not found\" data-plugin=\"".concat(btn, "\"></button>"); //temporary (later will be replaced with plugin button)
        }
      }

      if (this.builder.opts.toolbarAddSnippetButton && html_rte.indexOf('rte-addsnippet') === -1 && html_rtemore.indexOf('rte-addsnippet') === -1) {
        html_rte = "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>") + html_rte;
      }
      if (html_rtemore !== '' && html_rte.indexOf('rte-more') === -1) {
        html_rte = html_rte + "<button tabindex=\"-1\" title=\"".concat(util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>");
      }

      // Element Toolbar
      var html_elementrtemore = '';
      for (j = 0; j < builder.opts.elementButtonsMore.length; j++) {
        btn = builder.opts.elementButtonsMore[j].toLowerCase();
        if (btn === 'left') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Left'), "\" data-align=\"left\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-left\"></use></svg></button>");else if (btn === 'center') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Center'), "\" data-align=\"center\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-center\"></use></svg></button>");else if (btn === 'right') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Right'), "\" data-align=\"right\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-right\"></use></svg></button>");else if (btn === 'full') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Full'), "\" data-align=\"justify\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-full\"></use></svg></button>");else if (btn === 'gridtool') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Grid Tool'), "\" class=\"rte-grideditor\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;\"><use xlink:href=\"#ion-grid\"></use></svg></button>");else if (btn === 'html') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"rte-html\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></button>");else if (btn === 'preferences') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Preferences'), "\" class=\"rte-preferences\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-wrench\"></use></svg></button>");else if (btn === 'addsnippet') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>");else if (btn === 'undo') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Undo'), "\" class=\"rte-undo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-undo\"></use></svg></button>");else if (btn === 'redo') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Redo'), "\" class=\"rte-redo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-redo\"></use></svg></button>");else if (btn === 'aiassistant') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('AI Assistant'), "\" class=\"rte-ai\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-message\"></use></svg></button>");else if (btn === 'snippets') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Snippets'), "\" class=\"rte-snippets\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#icon-snippets\"></use></svg></button>");else if (btn === 'pageoptions') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Page Options'), "\" class=\"rte-pageoptions\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-pagesize\"></use></svg></button>");else if (btn === 'print') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Print'), "\" class=\"rte-print\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#icon-print\"></use></svg></button>");else if (btn === 'zoom') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Zoom'), "\" class=\"rte-zoom\"><svg class=\"is-icon-flex\" style=\"margin-top:1px;width:15px;height:15px;\"><use xlink:href=\"#icon-zoom-in\"></use></svg></button>");else if (btn === 'livepreview') html_elementrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Live Preview'), "\" class=\"rte-livepreview\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-device-desktop\"></use></svg></button>");else if (btn === '|') {
          html_elementrtemore += '<div class="rte-separator"></div>';
        } else {
          html_elementrtemore += "<button tabindex=\"-1\" title=\"button not found\" data-plugin=\"".concat(btn, "\"></button>"); //temporary (later will be replaced with plugin button)
        }
      }

      var html_elementrte = '';
      for (j = 0; j < builder.opts.elementButtons.length; j++) {
        btn = builder.opts.elementButtons[j].toLowerCase();
        if (btn === 'left') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Left'), "\" data-align=\"left\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-left\"></use></svg></button>");else if (btn === 'center') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Center'), "\" data-align=\"center\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-center\"></use></svg></button>");else if (btn === 'right') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Right'), "\" data-align=\"right\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-right\"></use></svg></button>");else if (btn === 'full') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Align Full'), "\" data-align=\"justify\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-full\"></use></svg></button>");else if (btn === 'gridtool') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Grid Tool'), "\" class=\"rte-grideditor\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:17px;height:17px;\"><use xlink:href=\"#ion-grid\"></use></svg></button>");else if (btn === 'html') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"rte-html\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></button>");else if (btn === 'preferences') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Preferences'), "\" class=\"rte-preferences\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-wrench\"></use></svg></button>");else if (btn === 'addsnippet') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>");else if (btn === 'group') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Group'), "\" class=\"rte-group\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;margin-top:-1px;\"><use xlink:href=\"#icon-group\"></use></svg></button>");else if (btn === 'ungroup') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Ungroup'), "\" class=\"rte-ungroup\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;margin-top:-1px;\"><use xlink:href=\"#icon-ungroup\"></use></svg></button>");else if (btn === 'duplicate') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Duplicate'), "\" class=\"rte-duplicate\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;margin-top:-1px;\"><use xlink:href=\"#icon-duplicate\"></use></svg></button>");else if (btn === 'front') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Bring to Front'), "\" class=\"rte-front\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#icon-stack-forward\"></use></svg></button>");else if (btn === 'backward') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Send to Back'), "\" class=\"rte-backward\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#icon-stack-backward\"></use></svg></button>");else if (btn === 'moveup') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Move Up'), "\" class=\"rte-moveup\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#icon-arrow-up\"></use></svg></button>");else if (btn === 'movedown') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Move Down'), "\" class=\"rte-movedown\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#icon-arrow-down\"></use></svg></button>");else if (btn === 'delete') html_elementrte += "<button style=\"display:none\" tabindex=\"-1\" title=\"".concat(util.out('Delete'), "\" class=\"rte-delete\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#icon-trash\"></use></svg></button>");else if (btn === 'blocksettings' && this.builder.canvas) html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Block Settings'), "\" class=\"rte-blocksettings\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-settings\"></use></svg></button>");else if (btn === 'undo') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Undo'), "\" class=\"rte-undo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-undo\"></use></svg></button>");else if (btn === 'redo') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Redo'), "\" class=\"rte-redo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-redo\"></use></svg></button>");else if (btn === 'aiassistant') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('AI Assistant'), "\" class=\"rte-ai\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-message\"></use></svg></button>");else if (btn === 'snippets') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Snippets'), "\" class=\"rte-snippets\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#icon-snippets\"></use></svg></button>");else if (btn === 'more' && html_elementrtemore !== '') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>");else if (btn === 'pageoptions') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Page Options'), "\" class=\"rte-pageoptions\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-pagesize\"></use></svg></button>");else if (btn === 'print') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Print'), "\" class=\"rte-print\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#icon-print\"></use></svg></button>");else if (btn === 'zoom') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Zoom'), "\" class=\"rte-zoom\"><svg class=\"is-icon-flex\" style=\"margin-top:1px;width:15px;height:15px;\"><use xlink:href=\"#icon-zoom-in\"></use></svg></button>");else if (btn === 'livepreview') html_elementrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Live Preview'), "\" class=\"rte-livepreview\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-device-desktop\"></use></svg></button>");else if (btn === '|') {
          html_elementrte += '<div class="rte-separator"></div>';
        } else {
          html_elementrte += "<button tabindex=\"-1\" title=\"button not found\" data-plugin=\"".concat(btn, "\"></button>"); //temporary (later will be replaced with plugin button)
        }
      }

      if (this.builder.opts.toolbarAddSnippetButton && html_elementrte.indexOf('rte-addsnippet') === -1 && html_elementrtemore.indexOf('rte-addsnippet') === -1) {
        html_elementrte = "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>") + html_elementrte; //html_rte;
      }

      if (html_elementrtemore !== '' && html_elementrte.indexOf('rte-more') === -1) {
        html_elementrte = html_elementrte + "<button title=\"".concat(util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>");
      }

      /* Icon Buttons */
      var html_iconrtemore = '';
      var html_iconrte = '';
      for (j = 0; j < builder.opts.iconButtonsMore.length; j++) {
        btn = builder.opts.iconButtonsMore[j].toLowerCase();
        if (btn === 'createlink') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Hyperlink'), "\" class=\"rte-link\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#ion-link\"></use></svg></button>");else if (btn === 'icon' && !this.builder.opts.emailMode) html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Icon'), "\" class=\"rte-icon\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;margin-top:2px;\"><use xlink:href=\"#ion-android-happy\"></use></svg></button>");else if (btn === 'svg' && !this.builder.opts.emailMode) html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('SVG'), "\" class=\"rte-svg\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;margin-top:2px;\"><use xlink:href=\"#icon-svg\"></use></svg></button>");else if (btn === 'align') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Align'), "\" class=\"rte-align\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;margin-top:-2px;\"><use xlink:href=\"#icon-align-full\"></use></svg></button>");else if (btn === 'color') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Color'), "\" class=\"rte-color\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-contrast\"></use></svg></button>");else if (btn === 'gridtool') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Grid Tool'), "\" class=\"rte-grideditor\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;\"><use xlink:href=\"#ion-grid\"></use></svg></button>");else if (btn === 'html') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"rte-html\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></button>");else if (btn === 'preferences') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Preferences'), "\" class=\"rte-preferences\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-wrench\"></use></svg></button>");else if (btn === 'addsnippet') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>");else if (btn === 'textsettings') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Text Settings'), "\" class=\"rte-textsettings\"><svg class=\"is-icon-flex\" style=\"width:16px;height:16px;\"><use xlink:href=\"#ion-ios-settings\"></use></svg></button>");else if (btn === 'undo') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Undo'), "\" class=\"rte-undo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-undo\"></use></svg></button>");else if (btn === 'redo') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Redo'), "\" class=\"rte-redo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-redo\"></use></svg></button>");else if (btn === 'aiassistant') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('AI Assistant'), "\" class=\"rte-ai\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-message\"></use></svg></button>");else if (btn === 'snippets') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Snippets'), "\" class=\"rte-snippets\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#icon-snippets\"></use></svg></button>");else if (btn === 'pageoptions') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Page Options'), "\" class=\"rte-pageoptions\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-pagesize\"></use></svg></button>");else if (btn === 'print') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Print'), "\" class=\"rte-print\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#icon-print\"></use></svg></button>");else if (btn === 'zoom') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Zoom'), "\" class=\"rte-zoom\"><svg class=\"is-icon-flex\" style=\"margin-top:1px;width:15px;height:15px;\"><use xlink:href=\"#icon-zoom-in\"></use></svg></button>");else if (btn === 'livepreview') html_iconrtemore += "<button tabindex=\"-1\" title=\"".concat(util.out('Live Preview'), "\" class=\"rte-livepreview\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-device-desktop\"></use></svg></button>");else if (btn === '|') {
          html_iconrtemore += '<div class="rte-separator"></div>';
        } else {
          html_iconrtemore += "<button tabindex=\"-1\" title=\"button not found\" data-plugin=\"".concat(btn, "\"></button>"); //temporary (later will be replaced with plugin button)
        }
      }

      for (j = 0; j < builder.opts.iconButtons.length; j++) {
        btn = builder.opts.iconButtons[j].toLowerCase();
        if (btn === 'createlink') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Hyperlink'), "\" class=\"rte-link\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#ion-link\"></use></svg></button>");else if (btn === 'icon' && !this.builder.opts.emailMode) html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Icon'), "\" class=\"rte-icon\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;margin-top:2px;\"><use xlink:href=\"#ion-android-happy\"></use></svg></button>");else if (btn === 'svg' && !this.builder.opts.emailMode) html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('SVG'), "\" class=\"rte-svg\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;margin-top:2px;\"><use xlink:href=\"#icon-svg\"></use></svg></button>");else if (btn === 'align') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Align'), "\" class=\"rte-align\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;margin-top:-2px;\"><use xlink:href=\"#icon-align-full\"></use></svg></button>");else if (btn === 'color') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Color'), "\" class=\"rte-color\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-contrast\"></use></svg></button>");else if (btn === 'gridtool') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Grid Tool'), "\" class=\"rte-grideditor\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;\"><use xlink:href=\"#ion-grid\"></use></svg></button>");else if (btn === 'html') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('HTML'), "\" class=\"rte-html\"><svg class=\"is-icon-flex\" style=\"margin-right:-3px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-left\"></use></svg><svg class=\"is-icon-flex\" style=\"margin-left:-2px;width:14px;height:14px;\"><use xlink:href=\"#ion-ios-arrow-right\"></use></svg></button>");else if (btn === 'preferences') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Preferences'), "\" class=\"rte-preferences\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-wrench\"></use></svg></button>");else if (btn === 'addsnippet') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>");else if (btn === 'textsettings') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Text Settings'), "\" class=\"rte-textsettings\"><svg class=\"is-icon-flex\" style=\"width:16px;height:16px;\"><use xlink:href=\"#ion-ios-settings\"></use></svg></button>");else if (btn === 'undo') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Undo'), "\" class=\"rte-undo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-undo\"></use></svg></button>");else if (btn === 'redo') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Redo'), "\" class=\"rte-redo\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#ion-ios-redo\"></use></svg></button>");else if (btn === 'aiassistant') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('AI Assistant'), "\" class=\"rte-ai\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-message\"></use></svg></button>");else if (btn === 'snippets') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Snippets'), "\" class=\"rte-snippets\"><svg class=\"is-icon-flex\" style=\"width:19px;height:19px;\"><use xlink:href=\"#icon-snippets\"></use></svg></button>");else if (btn === 'pageoptions') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Page Options'), "\" class=\"rte-pageoptions\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-pagesize\"></use></svg></button>");else if (btn === 'print') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Print'), "\" class=\"rte-print\"><svg class=\"is-icon-flex\" style=\"width:15px;height:15px;\"><use xlink:href=\"#icon-print\"></use></svg></button>");else if (btn === 'zoom') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Zoom'), "\" class=\"rte-zoom\"><svg class=\"is-icon-flex\" style=\"margin-top:1px;width:15px;height:15px;\"><use xlink:href=\"#icon-zoom-in\"></use></svg></button>");else if (btn === 'livepreview') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('Live Preview'), "\" class=\"rte-livepreview\"><svg class=\"is-icon-flex\" style=\"margin-top:2px;width:15px;height:15px;\"><use xlink:href=\"#icon-device-desktop\"></use></svg></button>");else if (btn === 'more' && html_rtemore !== '') html_iconrte += "<button tabindex=\"-1\" title=\"".concat(util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>");else if (btn === '|') {
          html_iconrte += '<div class="rte-separator"></div>';
        } else {
          html_iconrte += "<button tabindex=\"-1\" title=\"button not found\" data-plugin=\"".concat(btn, "\"></button>"); //temporary (later will be replaced with plugin button)
        }
      }

      if (this.builder.opts.toolbarAddSnippetButton && html_iconrte.indexOf('rte-addsnippet') === -1 && html_iconrtemore.indexOf('rte-addsnippet') === -1) {
        html_iconrte = "<button tabindex=\"-1\" title=\"".concat(util.out('Add Snippet'), "\" class=\"rte-addsnippet\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top:-1px;\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>") + html_iconrte; //html_rte;
      }

      if (html_iconrtemore !== '' && html_iconrte.indexOf('rte-more') === -1) {
        html_iconrte = html_iconrte + "<button tabindex=\"-1\" title=\"".concat(util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>");
      }
      /* /Icon Buttons */

      var html_fontsizes = '';
      for (j = 0; j < builder.opts.defaultFontSizes.length; j++) {
        html_fontsizes += "<button title=\"".concat(builder.opts.defaultFontSizes[j], "px\" data-value=\"").concat(builder.opts.defaultFontSizes[j], "\">").concat(builder.opts.defaultFontSizes[j], "</button>");
      }
      var html_leading = '';
      this.builder.leadingPreset.forEach(function (val) {
        html_leading += "<button title=\"".concat(val, "\" data-value=\"").concat(val, "\">").concat(val, "</button>");
      });

      // <div class="is-draggable" style="width: 5px;height: 45pxpx;background:#fff;cursor: move;"></div>
      // <div style="height:55px;background:#fff;border-top:#f5f5f5 1px solid;">
      // </div>
      var html = "<div class=\"is-rte-tool\" style=\"position:fixed;flex-direction:column;display:none;\">\n                <div class=\"rte-for-text\" style=\"display:flex\">\n                    ".concat(html_rte, "\n                </div>\n                <div class=\"rte-for-icon\" class=\"\" style=\"display:flex\">\n                    ").concat(html_iconrte, "\n                </div>\n            </div>\n\n            <div class=\"is-elementrte-tool\" style=\"position:fixed;flex-direction:column;display:none;\">\n                <div style=\"display:flex\">\n                    ").concat(html_elementrte, "\n                </div>\n            </div>\n\n            <div class=\"rte-formatting-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Strikethrough'), "\" class=\"rte-format\" data-command=\"strikethrough\" style=\"float:left\"><svg class=\"is-icon-flex\" style=\"width:17px;height:17px;\"><use xlink:href=\"#icon-strike\"></use></svg></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Superscript'), "\" class=\"rte-format\" data-command=\"superscript\" style=\"float:left\"><span style=\"font-family:serif;font-size:13px;\">x</span><sup style=\"font-size:10px\">2</sup></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Subscript'), "\" class=\"rte-format\" data-command=\"subscript\" style=\"float:left\"><span style=\"font-family:serif;font-size:13px;\">x</span><sub style=\"font-size:10px\">2</sub></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Uppercase'), "\" class=\"rte-format\" data-command=\"uppercase\" style=\"float:left\"><span style=\"font-family:serif;font-size:14px;display:inline-block;text-transform: none;\">Aa</span></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Clean'), "\" class=\"rte-format\" data-command=\"clean\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                </div>\n            </div>\n\n            <div class=\"rte-align-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Align Left'), "\" data-align=\"left\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-left\"></use></svg></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Align Center'), "\" data-align=\"center\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-center\"></use></svg></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Align Right'), "\" data-align=\"right\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-right\"></use></svg></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Align Full'), "\" data-align=\"justify\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-align-full\"></use></svg></button>\n                </div>\n            </div>\n\n            <div class=\"rte-list-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Bullets'), "\" data-action=\"insertUnorderedList\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-list-bullet\"></use></svg></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Numbering'), "\" data-action=\"insertOrderedList\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-list-number\"></use></svg></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Indent'), "\" data-action=\"indent\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-indent\"></use></svg></button>\n                    <button tabindex=\"-1\" title=\"").concat(util.out('Outdent'), "\" data-action=\"outdent\"><svg class=\"is-icon-flex\" style=\"width:14px;height:14px;\"><use xlink:href=\"#icon-outdent\"></use></svg></use></svg></svg></button>\n                </div>\n            </div>\n\n            <div class=\"rte-paragraph-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <ul>\n                    <li style=\"height:58px\" title=\"").concat(util.out('Heading 1'), "\" data-block=\"h1\" tabindex=\"0\"><h1>Heading 1</h1></li>\n                    <li style=\"height:50px\" title=\"").concat(util.out('Heading 2'), "\" data-block=\"h2\" tabindex=\"0\"><h2>Heading 2</h2></li>\n                    <li style=\"height:45px\" title=\"").concat(util.out('Heading 3'), "\" data-block=\"h3\" tabindex=\"0\"><h3>Heading 3</h3></li>\n                    <li style=\"height:40px\" title=\"").concat(util.out('Heading 4'), "\" data-block=\"h4\" tabindex=\"0\"><h4>Heading 4</h4></li>\n                    <li style=\"height:28px\" title=\"").concat(util.out('Paragraph'), "\" data-block=\"p\" tabindex=\"0\"><p>Paragraph</p></li>\n                    <li style=\"height:28px\" title=\"").concat(util.out('DIV'), "\" data-block=\"div\" tabindex=\"0\"><p>div</p></li>\n                    <li style=\"height:28px\" title=\"").concat(util.out('Preformatted'), "\" data-block=\"pre\" tabindex=\"0\"><p style=\"font-family:courier, monospace;\">Preformatted</p></li>\n                </ul>\n            </div>\n\n            <div class=\"rte-fontfamily-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"scroll\">\n                    <input id=\"inpRteFontSearch\" type=\"text\" placeholder=\"").concat(util.out('Type to search...'), "\">\n                    <div class=\"div-font-list\"></div>\n                </div>\n            </div>\n\n            <div class=\"rte-color-picker is-rte-pop\" data-command=\"forecolor\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-pop-tabs\">\n                    <div class=\"is-pop-tab-item active\" data-value=\"forecolor\">").concat(util.out('Forecolor'), "</div>\n                    <div class=\"is-pop-tab-item\" data-value=\"backcolor\">").concat(util.out('Backcolor'), "</div>\n                </div>\n                <div class=\"rte-color-picker-area\"></div>\n            </div>\n            \n            <div class=\"rte-textsetting-options ").concat(this.builder.simpleTextSettings ? 'simple' : '', " is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div>\n                    <div class=\"is-label\">").concat(util.out('Font Size'), "</div>\n                    <div class=\"rte-fontsize-options\" style=\"display: flex;flex-flow: wrap;\">\n                        ").concat(html_fontsizes, "\n\n                        <button title=\"").concat(util.out('Decrease'), "\" data-value=\"-\" style=\"font-size:13px\">-</button>\n                        <button title=\"").concat(util.out('Increase'), "\" data-value=\"+\" style=\"font-size:13px\">+</button>\n                        <button title=\"").concat(util.out('Clear'), "\" data-value=\"\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                    </div>\n                    <div class=\"is-label separator label-fontweight\">").concat(util.out('Font Weight'), "</div>\n                    <div class=\"rte-fontweight-options\" style=\"display: flex;flex-flow: wrap;\">\n                        <button title=\"100\" data-value=\"100\">100</button>\n                        <button title=\"200\" data-value=\"200\">200</button>\n                        <button title=\"300\" data-value=\"300\">300</button>\n                        <button title=\"400\" data-value=\"400\">400</button>\n                        <button title=\"500\" data-value=\"500\">500</button>\n                        <button title=\"600\" data-value=\"600\">600</button>\n                        <button title=\"700\" data-value=\"700\">700</button>\n                        <button title=\"800\" data-value=\"800\">800</button>\n                        <button title=\"900\" data-value=\"900\">900</button>\n                        <button title=\"").concat(util.out('Clear'), "\" data-value=\"\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                    </div>\n                    <div class=\"is-label separator\">").concat(util.out('Line Spacing'), "</div>\n                    <div class=\"rte-lineheight-options\" style=\"display: flex;flex-flow: wrap;\">\n                        \n                        ").concat(html_leading, "\n\n                        <button title=\"").concat(util.out('Decrease'), "\" data-value=\"-\" style=\"font-size:13px\">-</button>\n                        <button title=\"").concat(util.out('Increase'), "\" data-value=\"+\" style=\"font-size:13px\">+</button>\n                        <button title=\"").concat(util.out('Clear'), "\" data-value=\"\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                    </div>\n                    <div class=\"is-label separator\">").concat(util.out('Letter Spacing'), "</div>\n                    <div class=\"rte-letterspacing-options\" style=\"display: flex;flex-flow: wrap;\">\n                        <button title=\"1\" data-value=\"1\">1</button>\n                        <button title=\"2\" data-value=\"2\">2</button>\n                        <button title=\"").concat(util.out('Decrease'), "\" data-value=\"-\" style=\"font-size:13px\">-</button>\n                        <button title=\"").concat(util.out('Increase'), "\" data-value=\"+\" style=\"font-size:13px\">+</button>\n                        <button title=\"").concat(util.out('Clear'), "\" data-value=\"\"><svg class=\"is-icon-flex\" style=\"width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"rte-zoom-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div>\n                    <div class=\"is-label\">").concat(util.out('Zoom'), "</div>\n                    <div style=\"padding-top:4px\">\n                        <input type=\"range\" min=\"50\" max=\"").concat(zoomMax, "\" value=\"1\" class=\"rte-zoom-slider is-rangeslider\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"is-modal viewzoom\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"max-width:250px;height:150px;display:flex;flex-flow:column;justify-content:center;\">\n                    <div class=\"is-modal-bar is-draggable\">").concat(util.out('Zoom'), "</div>\n                \n                    <div style=\"display:flex;flex-wrap:wrap;width:100%;padding-top:32px;\">\n                        <input type=\"range\" min=\"50\" max=\"100\" value=\"1\" class=\"inp-zoom-slider is-rangeslider\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"is-modal insertimage\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"max-width:560px;\">\n                    <div class=\"is-browse-area\">\n                        <div class=\"is-drop-area\">\n                            <input id=\"fileInsertImage\" type=\"file\" accept=\"image/*\" />\n                            <div class=\"drag-text\">\n                                <p style=\"display:flex;justify-content:center;align-items:center;\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;\"><use xlink:href=\"#ion-camera\"></use></svg> <span style=\"margin-left:5px;margin-top:3px;\"> ").concat(util.out('Drag and drop an image or click to browse.'), " </span></p>\n                            </div>\n                        </div>\n                        <div class=\"is-preview-area\">\n                            <div><img id=\"imgInsertImagePreview\" alt=\"\" /><button><i class=\"ion-ios-close-empty\"></i></button></div>\n                        </div>\n                    </div>    \n                    <label for=\"inpInsertImageSrc\" style=\"margin:10px 0 5px;display:block;\">").concat(util.out('Or Specify Image Source'), ":</label>\n                    ").concat((this.builder.opts.onImageSelectClick + '').replace(/\s/g, '') !== 'function(){}' || this.builder.opts.imageselect !== '' ? "<div class=\"image-src\" style=\"margin-bottom: 12px;\"><input id=\"inpInsertImageSrc\" class=\"input-src\" type=\"text\" placeholder=\"".concat(util.out('Source'), "\">\n                    <button title=\"").concat(util.out('Select'), "\" class=\"input-select\" style=\"flex:none;\">\n                        ").concat(this.builder.opts.selectIcon, "\n                    </button></div>") : "<div class=\"image-src\" style=\"margin-bottom: 12px;\"><input id=\"inpInsertImageSrc\" class=\"input-src\" type=\"text\" placeholder=\"".concat(util.out('Source'), "\"></div>"), "\n                    <div style=\"text-align:right\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"rte-icon-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"scroll\">\n                    <input id=\"inpRteIconSearch\" type=\"text\" placeholder=\"").concat(util.out('Type to search...'), "\">\n                    <div class=\"div-icon-list\"></div>\n                </div>\n            </div>\n\n            <div class=\"rte-customtag-options is-rte-pop scroll\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div>").concat(customTagsHtml, "</div>\n            </div>\n\n            <div class=\"rte-more-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"rte-for-text\">\n                ").concat(html_rtemore, "\n                </div>\n                <div class=\"rte-for-icon\">\n                ").concat(html_iconrtemore, "\n                </div>\n            </div>\n\n            <div class=\"elementrte-more-options is-rte-pop\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div>\n                ").concat(html_elementrtemore, "\n                </div>\n            </div>\n            ");
      dom.appendHtml(builderStuff, html);
      rteTool = builderStuff.querySelector('.is-rte-tool');
      elementRteTool = builderStuff.querySelector('.is-elementrte-tool');
      rteMoreOptions = builderStuff.querySelector('.rte-more-options');
      elementRteMoreOptions = builderStuff.querySelector('.elementrte-more-options');
      rteAlignOptions = builderStuff.querySelector('.rte-align-options');
      rteFormattingOptions = builderStuff.querySelector('.rte-formatting-options');
      rteColorPicker = builderStuff.querySelector('.rte-color-picker');
      rteListOptions = builderStuff.querySelector('.rte-list-options');
      rteFontFamilyOptions = builderStuff.querySelector('.rte-fontfamily-options');
      rteParagraphOptions = builderStuff.querySelector('.rte-paragraph-options');
      rteTextSettingOptions = builderStuff.querySelector('.rte-textsetting-options');
      rteZoomOptions = builderStuff.querySelector('.rte-zoom-options');
      rteIconOptions = builderStuff.querySelector('.rte-icon-options');
      rteCustomTagOptions = builderStuff.querySelector('.rte-customtag-options');
      rteZoomSlider = builderStuff.querySelector('.rte-zoom-slider');
      inpZoomSlider = builderStuff.querySelector('.inp-zoom-slider');

      // Prepare for tooltip
      var elms = rteTool.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
      elms = elementRteTool.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
      elms = rteAlignOptions.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
      elms = rteFormattingOptions.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
      elms = rteListOptions.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
      elms = rteMoreOptions.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
      elms = elementRteMoreOptions.querySelectorAll('[title]');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.setAttribute('data-title', elm.getAttribute('title'));
      });
      if (this.builder.isTouchSupport) {
        // On iPad, on double click text to select word, getSelected() won't return the word, instead it returns empty
        // So this is needed to call getSelected() after 'selectionchange' that is triggered after double click a text.
        this.builder.doc.addEventListener('selectionchange', function () {
          if (dom.checkEditable()) {
            var text = dom.getSelected();
            if (text.trim() !== '') {
              //save selection
              util.saveSelection();
            }
          }
        }, false);
      }
    }
    this.rteTool = rteTool;
    this.elementRteTool = elementRteTool;
    this.rteAlignOptions = rteAlignOptions;
    this.rteFormattingOptions = rteFormattingOptions;
    this.rteColorPicker = rteColorPicker;
    this.rteListOptions = rteListOptions;
    this.rteFontFamilyOptions = rteFontFamilyOptions;
    this.rteParagraphOptions = rteParagraphOptions;
    this.rteMoreOptions = rteMoreOptions;
    this.elementRteMoreOptions = elementRteMoreOptions;
    this.rteTextSettingOptions = rteTextSettingOptions;
    this.rteZoomOptions = rteZoomOptions;
    this.rteIconOptions = rteIconOptions;
    this.rteCustomTagOptions = rteCustomTagOptions;
    this.rteZoomSlider = rteZoomSlider;
    this.inpZoomSlider = inpZoomSlider;
    this.positionToolbar();
    var inpIconSearch = this.rteIconOptions.querySelector('#inpRteIconSearch');
    inpIconSearch.addEventListener('input', function () {
      var searchInput = inpIconSearch.value.toLowerCase();
      var buttons = _this.rteIconOptions.querySelectorAll('.div-icon-list button');
      buttons.forEach(function (button) {
        var iconName = button.querySelector('i').className;
        if (iconName.toLowerCase().includes(searchInput)) {
          button.style.display = '';
        } else {
          button.style.display = 'none';
        }
      });
    });
    var inpFontSearch = this.rteFontFamilyOptions.querySelector('#inpRteFontSearch');
    inpFontSearch.addEventListener('input', function () {
      var searchInput = inpFontSearch.value.toLowerCase();
      var buttons = _this.rteFontFamilyOptions.querySelectorAll('.div-font-list button');
      buttons.forEach(function (button) {
        var fontName = button.getAttribute('data-font-family');
        if (fontName.toLowerCase().includes(searchInput)) {
          button.classList.remove('hidden');
          button.classList.add('flex');
        } else {
          button.classList.add('hidden');
          button.classList.remove('flex');
        }
      });
    });
    var handleSearchKeyDown = function handleSearchKeyDown(e) {
      var btnActive = _this.rteFontFamilyOptions.querySelector('.div-font-list button.on');
      if (!btnActive) btnActive = _this.rteFontFamilyOptions.querySelector('.div-font-list button.flex');
      if (e.keyCode === 40) {
        // down
        btnActive.focus();
        e.preventDefault();
        e.stopImmediatePropagation();
      }
    };
    inpFontSearch.addEventListener('keydown', handleSearchKeyDown);

    // Formatting
    var btnRteFormatting = builderStuff.querySelectorAll('button.rte-formatting');
    btnRteFormatting.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var pop = _this.rteFormattingOptions;
        var top = btn.getBoundingClientRect().top;
        var left = btn.getBoundingClientRect().left;
        pop.style.display = 'flex';
        var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
        var h = pop.offsetHeight;
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
            pop.focus();
          }, btn);
        } else {
          _this.util.hideRtePop(pop);
        }
      });
    });

    // Align
    var btnRteAlign = builderStuff.querySelectorAll('button.rte-align');
    btnRteAlign.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var pop = _this.rteAlignOptions;
        var top = btn.getBoundingClientRect().top;
        var left = btn.getBoundingClientRect().left;
        pop.style.display = 'flex';
        var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
        var h = pop.offsetHeight;
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
            pop.focus();
          }, btn);
        } else {
          _this.util.hideRtePop(pop);
        }
      });
    });

    // List
    var btnRteList = builderStuff.querySelectorAll('button.rte-list');
    btnRteList.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var pop = _this.rteListOptions;
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            var top = btn.getBoundingClientRect().top;
            var left = btn.getBoundingClientRect().left;
            var w = pop.offsetWidth;
            var h = pop.offsetHeight;
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
            pop.focus();
          }, btn);
        } else {
          dom.removeClass(pop, 'active');
          dom.addClass(pop, 'deactive');
        }
      });
    });

    // Custom Tags

    var setTagValue = function setTagValue(btn) {
      _this.builder.uo.saveForUndo();

      //restore selection
      util.restoreSelection(); //a must

      var tag = btn.getAttribute('data-value');
      util.pasteHtmlAtCaret(tag, true);
      _this.util.hideRtePop(_this.rteCustomTagOptions);
      if (_this.builder.onTextChange) _this.builder.onTextChange();
    };
    var handleTagItemClick = function handleTagItemClick(e) {
      e.preventDefault();
      setTagValue(e.target);
    };
    var handleTagItemKeyDown = function handleTagItemKeyDown(e) {
      e.preventDefault();
      e.stopImmediatePropagation();
      if (e.keyCode === 38 && e.target.previousElementSibling) {
        // up
        e.target.previousElementSibling.focus();
      } else if (e.keyCode === 40 && e.target.nextElementSibling) {
        // down
        e.target.nextElementSibling.focus();
      } else if (e.keyCode === 27) {
        // esc
        _this.util.hideRtePop(_this.rteCustomTagOptions);
      } else if (e.keyCode === 13 || e.keyCode === 32) {
        // enter or spacebar key
        setTagValue(e.target);
      }
    };
    var tagItems = builderStuff.querySelectorAll('.rte-customtag-options button');
    tagItems.forEach(function (elm) {
      elm.addEventListener('keydown', handleTagItemKeyDown);
      elm.addEventListener('click', handleTagItemClick);
    });
    this.rteCustomTagOptions.addEventListener('keydown', function (e) {
      if (e.keyCode === 40 && e.target.nextElementSibling) {
        // down
        var firstButton = _this.rteCustomTagOptions.querySelector('button');
        firstButton.focus();
      }
    });
    var btnTags = this.rteCustomTagOptions.querySelectorAll('[data-value]');
    Array.prototype.forEach.call(btnTags, function (btn) {
      dom.addEventListener(btn, 'click', function (e) {
        setTagValue(e.target);
      });
    });
    var btnRteTags = builderStuff.querySelectorAll('button.rte-tags');
    btnRteTags.forEach(function (btn) {
      btn.addEventListener('click', function () {
        //save selection
        util.saveSelection();
        var pop = _this.rteCustomTagOptions;
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            var top = btn.getBoundingClientRect().top;
            var left = btn.getBoundingClientRect().left;
            var w = pop.offsetWidth;
            var h = pop.offsetHeight;
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
            if (dom.parentsHasClass(btn, 'rte-more-options')) {
              // Adjustment if button is placed on 2nd bar (div.rte-more-options)
              if (_this.builder.opts.toolbar === 'left') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = left + 54 + 'px';
                pop.style.right = 'auto';
              } else if (_this.builder.opts.toolbar === 'right') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = 'auto';
                var _viewportWidth = document.body.clientWidth; //window.innerWidth;
                pop.style.right = _viewportWidth - left + 9 + 'px';
              } else {
                pop.style.top = top + 54 - 6 + 'px';
                if (btn.getBoundingClientRect().left + 45 - parseInt(_this.rteMoreOptions.style.left) < pop.offsetWidth) {
                  pop.style.left = parseInt(_this.rteMoreOptions.style.left) + 'px';
                } else if (parseInt(_this.rteMoreOptions.style.left) + _this.rteMoreOptions.offsetWidth - btn.getBoundingClientRect().left + 45 < pop.offsetWidth) {
                  pop.style.left = parseInt(_this.rteMoreOptions.style.left) + _this.rteMoreOptions.offsetWidth - w + 'px';
                } else {
                  // Do Nothing
                }
                pop.style.right = 'auto';
              }
            }
            pop.focus();
          }, btn);
        } else {
          _this.util.hideRtePop(pop);
        }
      });
    });

    // Paragraph

    var setParagraphValue = function setParagraphValue(item) {
      _this.builder.uo.saveForUndo();
      util.restoreSelection(); //a must

      var command = item.getAttribute('data-block'); //h1, h2, h3, h4, p, pre  

      /*
      let block = this.builder.doc.queryCommandValue('FormatBlock');
      block = block.toLowerCase();
      if (block === 'pre') {
          let elm = dom.textSelection();
          if(elm) {
              let pre = elm.closest('pre');
              if(pre) {
                  let newnode = pre.cloneNode(true);
                  let s = newnode.outerHTML.replace('<pre', '<' + command);
                  s = s.replace('</pre>', '</' + command + '>');
                  pre.outerHTML = s;
              }
              pre.focus();
          }
      } else {
          this.builder.doc.execCommand('formatBlock', false, '<' + command + '>'); //Needs contenteditable.         
      }
      */

      var selection = dom.getSelection();
      if (!selection) return;
      var anchorNode = selection.anchorNode;
      var container;
      if (anchorNode) {
        container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
      }
      if (!container) return;
      var element = container.closest('h1') || container.closest('h2') || container.closest('h3') || container.closest('h4') || container.closest('h5') || container.closest('h6') || container.closest('pre') || container.closest('p') || container.closest('div');
      if (element) {
        // const tagName = element.tagName.toLowerCase();

        element.setAttribute('data-replacetagname', '1');
        var newElement = _this.builder.doc.createElement(command);

        // Copy the attributes
        for (var i = 0, l = element.attributes.length; i < l; ++i) {
          var nodeName = element.attributes.item(i).nodeName;
          var nodeValue = element.attributes.item(i).nodeValue;
          newElement.setAttribute(nodeName, nodeValue);
        }

        // move all elements in the other container.
        while (element.firstChild) {
          newElement.appendChild(element.firstChild);
        }
        element.parentNode.replaceChild(newElement, element);
        var result = _this.builder.doc.querySelector('[data-replacetagname="1"]');
        if (result) {
          result.removeAttribute('data-replacetagname');
          dom.selectElementContents(result);
        }
      } else {
        // Do Nothing
        // console.log('no paragraph');
      }

      //save selection
      util.saveSelection();

      //Trigger Change event
      _this.builder.opts.onChange();

      // Focus
      var elms = builderStuff.querySelectorAll('.rte-paragraph-options li');
      elms.forEach(function (elm) {
        elm.classList.remove('on');
      });
      item.classList.add('on');
      item.focus();
      if (_this.builder.onTextChange) _this.builder.onTextChange();
    };
    var handleParagraphItemClick = function handleParagraphItemClick(e) {
      e.preventDefault();
      var item = e.target;
      setParagraphValue(item);
    };
    var handleParagraphItemKeyDown = function handleParagraphItemKeyDown(e) {
      e.preventDefault();
      if (e.keyCode === 38 && e.target.previousElementSibling) {
        // up
        e.target.previousElementSibling.focus();
      } else if (e.keyCode === 40 && e.target.nextElementSibling) {
        // down
        e.target.nextElementSibling.focus();
      } else if (e.keyCode === 13 || e.keyCode === 32) {
        // enter or spacebar key
        setParagraphValue(e.target);
      }
    };
    var paragraphItems = builderStuff.querySelectorAll('.rte-paragraph-options li');
    paragraphItems.forEach(function (elm) {
      elm.addEventListener('keydown', handleParagraphItemKeyDown);
      elm.addEventListener('click', handleParagraphItemClick);
    });
    var btnRteParagraph = builderStuff.querySelectorAll('button.rte-paragraph');
    btnRteParagraph.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var pop = _this.rteParagraphOptions;
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            var top = btn.getBoundingClientRect().top;
            var left = btn.getBoundingClientRect().left;
            var w = pop.offsetWidth;
            var h = pop.offsetHeight;
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
            if (dom.parentsHasClass(btn, 'rte-more-options')) {
              // Adjustment if button is placed on 2nd bar (div.rte-more-options)
              if (_this.builder.opts.toolbar === 'left') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = left + 54 + 'px';
                pop.style.right = 'auto';
              } else if (_this.builder.opts.toolbar === 'right') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = 'auto';
                var _viewportWidth2 = document.body.clientWidth; //window.innerWidth;
                pop.style.right = _viewportWidth2 - left + 9 + 'px';
              } else {
                pop.style.top = top + 54 - 6 + 'px';
                pop.style.left = parseInt(_this.rteMoreOptions.style.left) + _this.rteMoreOptions.offsetWidth - w + 'px';
                pop.style.right = 'auto';
              }
            }
          }, btn);
        } else {
          _this.util.hideRtePop(pop);
        }
        _this.getState();

        //Focus
        var target = pop.querySelector('.on');
        if (target) {
          target.focus();
        }
      });
    });

    // Font Family

    var btnRteFontFamily = builderStuff.querySelectorAll('button.rte-fontfamily');
    btnRteFontFamily.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var pop = _this.rteFontFamilyOptions;
        var divFontList = pop.querySelector('.div-font-list');
        if (divFontList.innerHTML.trim() === '') {
          var path = _this.builder.fontAssetPath;
          var s = '';
          fonts.forEach(function (choice) {
            choice.label = choice.label.replace('%path%', path);
            if (choice.label === '') choice.label = _this.util.out('None');
            s += "<button class=\"flex\" data-provider=\"".concat(choice.provider, "\" data-font-family=\"").concat(choice.fontFamily, "\" \n                        data-font-style=\"").concat(choice.fontStyle, "\"\n                        data-font-display=\"").concat(choice.fontDisplay, "\">\n                        ").concat(choice.label, "\n                        </button>");
          });
          divFontList.innerHTML = s;
          var setValue = function setValue(item) {
            var provider = item.getAttribute('data-provider');
            var fontfamily = item.getAttribute('data-font-family');
            var fontstyle = item.getAttribute('data-font-style');
            var fontdisplay = item.getAttribute('data-font-display');
            _this.setFont(fontfamily, fontstyle, fontdisplay, provider);
            var elms = pop.querySelectorAll('.div-font-list > button');
            elms.forEach(function (elm) {
              elm.classList.remove('on');
            });
            item.classList.add('on');
          };
          var handleItemClick = function handleItemClick(e) {
            e.preventDefault();
            var item = e.target;
            setValue(item);
            item.focus();
          };
          var handleItemKeyDown = function handleItemKeyDown(e) {
            var prevElm, nextElm;
            var elms = _this.rteFontFamilyOptions.querySelectorAll('.div-font-list button.flex');
            for (var i = 0; i < elms.length; i++) {
              if (elms[i] === e.target) {
                if (i === 0) {
                  prevElm = null;
                } else {
                  prevElm = elms[i - 1];
                }
                if (i === elms.length - 1) {
                  nextElm = null;
                } else {
                  nextElm = elms[i + 1];
                }
              }
            }
            if (e.keyCode === 38) {
              // up
              e.preventDefault();
              if (prevElm) {
                prevElm.focus();
              } else {
                var _inpFontSearch = _this.rteFontFamilyOptions.querySelector('#inpRteFontSearch');
                _inpFontSearch.focus();
              }
            } else if (e.keyCode === 40) {
              // down
              e.preventDefault();
              if (nextElm) nextElm.focus();
            }
          };
          var _elms = pop.querySelectorAll('.div-font-list > button');
          _elms.forEach(function (elm) {
            elm.addEventListener('keydown', handleItemKeyDown);
            elm.addEventListener('click', handleItemClick);
          });
        }
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            var top = btn.getBoundingClientRect().top;
            var left = btn.getBoundingClientRect().left;
            var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
            var h = pop.offsetHeight;
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
            if (dom.parentsHasClass(btn, 'rte-more-options')) {
              // Adjustment if button is placed on 2nd bar (div.rte-more-options)
              if (_this.builder.opts.toolbar === 'left') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = left + 54 + 'px';
                pop.style.right = 'auto';
              } else if (_this.builder.opts.toolbar === 'right') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = 'auto';
                var _viewportWidth3 = document.body.clientWidth; //window.innerWidth;
                pop.style.right = _viewportWidth3 - left + 9 + 'px';
              } else {
                pop.style.top = top + 54 - 6 + 'px';
                pop.style.left = parseInt(_this.rteMoreOptions.style.left) + _this.rteMoreOptions.offsetWidth - w + 'px';
                pop.style.right = 'auto';
              }
            }
          }, btn);
          _this.getState();
          var _inpFontSearch2 = _this.rteFontFamilyOptions.querySelector('#inpRteFontSearch');
          _inpFontSearch2.focus();
        } else {
          _this.util.hideRtePop(pop);
        }
      });
    });

    // Icons

    var btnRteIcons = builderStuff.querySelectorAll('button.rte-icon');
    btnRteIcons.forEach(function (btn) {
      btn.addEventListener('click', function (e) {
        //save selection
        util.saveSelection();
        Promise.resolve().then(function () {
          _this.openIcon(e);
        });
      });
    });
    var btnRteSvgs = builderStuff.querySelectorAll('button.rte-svg');
    btnRteSvgs.forEach(function (btn) {
      btn.addEventListener('click', function () {
        //save selection
        util.saveSelection();
        _this.builder.element.svg.edit();
      });
    });

    // Color
    var btnRteColor = builderStuff.querySelectorAll('button.rte-color');
    btnRteColor.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var pop = _this.rteColorPicker;
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            var top = btn.getBoundingClientRect().top;
            var left = btn.getBoundingClientRect().left;
            var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = _this.rteTool.style.top; //(top - (h/2) + 20) + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = _this.rteTool.style.top; //(top - (h/2) + 20) + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
          }, btn);
          _this.builder.uo.saveForUndo(true); // checkLater = true

          //Focus
          var input = pop.querySelector('.input-text');
          input.focus();
        } else {
          _this.util.hideRtePop(pop);
        }
      });
    });

    // Preferences
    var btnRtePreferences = builderStuff.querySelectorAll('button.rte-preferences');
    btnRtePreferences.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.viewPreferences();
      });
    });

    // View HTML
    var btnRteHtml = builderStuff.querySelectorAll('button.rte-html');
    btnRteHtml.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.viewHtml();
      });
    });

    // Grid Editor
    var btnRteGridEditor = builderStuff.querySelectorAll('button.rte-grideditor');
    btnRteGridEditor.forEach(function (btn) {
      btn.addEventListener('click', function () {
        // direct
        var grideditor = _this.builderStuff.querySelector('.grideditor');
        dom.addClass(grideditor, 'active');
        var builders = _this.builder.doc.querySelectorAll(_this.builder.opts.container);
        Array.prototype.forEach.call(builders, function (builder) {
          builder.setAttribute('grideditor', '');
        });
      });
    });

    // Undo
    var btnRteUndo = builderStuff.querySelectorAll('button.rte-undo');
    btnRteUndo.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.uo.doUndo();
      });
    });

    // Redo
    var btnRteRedo = builderStuff.querySelectorAll('button.rte-redo');
    btnRteRedo.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.uo.doRedo();
      });
    });

    // Add Snippet
    var btnRteAddSnippet = builderStuff.querySelectorAll('button.rte-addsnippet');
    btnRteAddSnippet.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.viewSnippets();
      });
    });

    // AI Assistant
    var btnRteAI = builderStuff.querySelectorAll('button.rte-ai');
    btnRteAI.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.toggleAIAssistant();
      });
    });

    // Snippets Modal
    var btnSnippets = builderStuff.querySelectorAll('button.rte-snippets');
    btnSnippets.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.toggleSnippetModal();
      });
    });

    // Link
    var btnRteLink = builderStuff.querySelectorAll('button.rte-link');
    btnRteLink.forEach(function (btn) {
      btn.addEventListener('click', function () {
        // const util = new Util(this.builder);
        // util.clearActiveCell();
        _this.hyperlink.createLink();
      });
    });

    // Image
    var btnRteImage = builderStuff.querySelectorAll('button.rte-image');
    btnRteImage.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.insertImage();
      });
    });
    var modalInsertImage = this.builderStuff.querySelector('.insertimage');
    var fileInsertImage = modalInsertImage.querySelector('#fileInsertImage');
    dom.addEventListener(fileInsertImage, 'change', function (e) {
      var input = e.target;
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          modalInsertImage.querySelector('.is-drop-area').style.display = 'none';
          modalInsertImage.querySelector('#imgInsertImagePreview').src = e.target.result;
          modalInsertImage.querySelector('.is-preview-area').style.display = 'block';
          fileInsertImage.setAttribute('disabled', 'disabled');
          var fileToInsert = input.files[0].name;
          modalInsertImage.querySelector('#imgInsertImagePreview').setAttribute('data-filename', fileToInsert);

          //modalInsertImage.querySelector('.image-title').innerHTML = input.files[0].name;
        };

        reader.readAsDataURL(input.files[0]);
        modalInsertImage.querySelector('.input-src').value = ''; //Clear manually specified image soure
      }
    });

    var btnInsertImageOk = modalInsertImage.querySelector('.input-ok');
    dom.addEventListener(btnInsertImageOk, 'click', function () {
      if (!_this.builder.activeCol) {
        util.hideModal(modalInsertImage);
        return;
      }
      _this.builder.uo.saveForUndo();
      util.restoreSelection(); //a must

      var val = '';
      if (modalInsertImage.querySelector('.is-drop-area').style.display === 'none') {
        val = modalInsertImage.querySelector('#imgInsertImagePreview').src;
      } else {
        val = modalInsertImage.querySelector('.input-src').value;
      }
      if (val === '') return;
      var fileToInsert = modalInsertImage.querySelector('#imgInsertImagePreview').getAttribute('data-filename');
      util.pasteHtmlAtCaret('<img data-filename="' + fileToInsert + '" src="' + val + '" alt="" />', false);
      util.hideModal(modalInsertImage);
      var builderActive = _this.builder.doc.querySelector('.builder-active');
      if (builderActive) _this.builder.applyBehaviorOn(builderActive);

      //save selection
      util.saveSelection();

      //Trigger Change event
      _this.builder.opts.onChange();

      //Trigger Render event
      _this.builder.opts.onRender();
    });
    var btnInsertImageCancel = modalInsertImage.querySelector('.input-cancel');
    dom.addEventListener(btnInsertImageCancel, 'click', function () {
      util.hideModal(modalInsertImage);
    });
    var dropArea = modalInsertImage.querySelector('.is-drop-area');
    dom.addEventListener(dropArea, 'dragover', function () {
      dom.addClass(dropArea, 'image-dropping');
    });
    dom.addEventListener(dropArea, 'dragleave', function () {
      dom.removeClass(dropArea, 'image-dropping');
    });
    var delImageInsert = modalInsertImage.querySelector('.is-preview-area button');
    dom.addEventListener(delImageInsert, 'click', function () {
      //Clear drop image area
      modalInsertImage.querySelector('#fileInsertImage').value = ''; // clear
      modalInsertImage.querySelector('.is-preview-area').style.display = 'none';
      fileInsertImage.removeAttribute('disabled');
      dropArea.style.display = 'block';
      dom.removeClass(dropArea, 'image-dropping');
    });
    var inputImageInsertSrc = modalInsertImage.querySelector('.input-src');
    dom.addEventListener(inputImageInsertSrc, 'keyup', function () {
      if (inputImageInsertSrc.value === '') return;
      //Clear drop image area
      modalInsertImage.querySelector('#fileInsertImage').value = ''; // clear
      modalInsertImage.querySelector('.is-preview-area').style.display = 'none';
      fileInsertImage.removeAttribute('disabled');
      dropArea.style.display = 'block';
      dom.removeClass(dropArea, 'image-dropping');
    });
    if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
      modalInsertImage.querySelector('.input-select').style.display = 'none';
    }
    if (this.builder.opts.onImageSelectClick || this.builder.opts.imageselect !== '') {
      dom.addClass(modalInsertImage.querySelector('.image-src'), 'image-select');

      //Open Custom Image Select
      var inputImageSelect = modalInsertImage.querySelector('.input-select');
      if (inputImageSelect) dom.addEventListener(inputImageSelect, 'click', function () {
        if (_this.builder.opts.onImageSelectClick) {
          _this.builder.opts.onImageSelectClick({
            targetInput: modalInsertImage.querySelector('.input-src'),
            theTrigger: inputImageSelect
          });
        } else {
          var modalImageSelect = _this.builderStuff.querySelector('.is-modal.imageselect');
          var iframe = modalImageSelect.querySelector('iframe');
          if (_this.builder.opts.assetRefresh) {
            iframe.src = _this.builder.opts.imageselect;
            _this.builder.opts.assetRefresh = false;
          }
          if (iframe.src === 'about:blank') {
            iframe.src = _this.builder.opts.imageselect;
          }
          util.showModal(modalImageSelect, false, function () {
            inputImageSelect.removeAttribute('data-focus');
            inputImageSelect.focus();
          }, false, _this.builder.assetPanelFullScreen);
        }
        _this.builder.targetInput = modalInsertImage.querySelector('.input-src'); // used by selectAsset() (see contentbuilder.js)
        _this.builder.targetCallback = null;
        _this.builder.targetAssetType = 'image';
      });
    } else {
      dom.removeClass(inputImageInsertSrc, 'image-select');
    }

    // Live Preview
    var livePreviewButton = builderStuff.querySelectorAll('button.rte-livepreview');
    livePreviewButton.forEach(function (btn) {
      dom.addEventListener(btn, 'click', function () {
        var modal = builderStuff.querySelector('.is-modal.content-preview');
        if (modal.classList.contains('active')) {
          _this.builder.closePreview();
        } else {
          _this.builder.livePreview.resizePreview(1440);
          _this.builder.openPreview();
        }
      });
    });

    // Page Options
    var btnPageOptions = builderStuff.querySelectorAll('button.rte-pageoptions');
    btnPageOptions.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.openPageOptions();
      });
    });

    // Print
    var btnPrint = builderStuff.querySelectorAll('button.rte-print');
    btnPrint.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.print();
      });
    });

    // Zoom Settings
    var zoomButton = builderStuff.querySelectorAll('button.rte-zoom');
    zoomButton.forEach(function (btn) {
      dom.addEventListener(btn, 'click', function () {
        _this.rteZoomSlider.value = _this.builder.opts.zoom * 100;
        var pop = _this.rteZoomOptions;
        var top = btn.getBoundingClientRect().top;
        var left = btn.getBoundingClientRect().left;
        pop.style.display = 'flex';
        var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
        var h = pop.offsetHeight;
        if (!dom.hasClass(pop, 'active')) {
          _this.util.showRtePop(pop, function () {
            if (_this.rteTool.style.display !== 'none') {
              if (_this.builder.opts.toolbar === 'left') {
                pop.style.top = top - h / 2 + 20 + 'px';
                pop.style.left = left + 54 + 'px';
                pop.style.right = 'auto';
              } else if (_this.builder.opts.toolbar === 'right') {
                pop.style.top = top - h / 2 + 20 + 'px';
                pop.style.left = 'auto';
                var viewportWidth = document.body.clientWidth; //window.innerWidth;
                pop.style.right = viewportWidth - left + 9 + 'px';
              } else {
                pop.style.top = top + 54 - 6 + 'px';
                var n1 = parseInt(_this.rteTool.style.left) + _this.rteTool.offsetWidth;
                var n2 = left - w / 2 + 23 + w;
                var adj = 0;
                if (n2 > n1) {
                  pop.style.left = parseInt(_this.rteTool.style.left) + _this.rteTool.offsetWidth - w + adj + 'px';
                } else {
                  pop.style.left = left - w / 2 + 23 + 'px';
                }
                pop.style.right = 'auto';
              }
              if (dom.parentsHasClass(btn, 'rte-more-options')) {
                // Adjustment if button is placed on 2nd bar (div.rte-more-options)
                if (_this.builder.opts.toolbar === 'left') {
                  pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                  pop.style.left = left + 54 + 'px';
                  pop.style.right = 'auto';
                } else if (_this.builder.opts.toolbar === 'right') {
                  pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                  pop.style.left = 'auto';
                  var _viewportWidth4 = document.body.clientWidth; //window.innerWidth;
                  pop.style.right = _viewportWidth4 - left + 9 + 'px';
                } else {
                  pop.style.top = top + 54 - 6 + 'px';
                  // pop.style.left = (left -(w/2)+23) + 'px'; 
                  pop.style.left = parseInt(_this.rteMoreOptions.style.left) + _this.rteMoreOptions.offsetWidth - w + 'px';
                  pop.style.right = 'auto';
                }
              }
            } else {
              if (_this.builder.opts.toolbar === 'left') {
                pop.style.top = top - h / 2 + 20 + 'px';
                pop.style.left = left + 54 + 'px';
                pop.style.right = 'auto';
              } else if (_this.builder.opts.toolbar === 'right') {
                pop.style.top = top - h / 2 + 20 + 'px';
                pop.style.left = 'auto';
                var _viewportWidth5 = document.body.clientWidth; //window.innerWidth;
                pop.style.right = _viewportWidth5 - left + 9 + 'px';
              } else {
                pop.style.top = top + 54 - 6 + 'px';
                var _n = parseInt(_this.elementRteTool.style.left) + _this.elementRteTool.offsetWidth;
                var _n2 = left - w / 2 + 23 + w;
                if (_n2 > _n) {
                  pop.style.left = parseInt(_this.elementRteTool.style.left) + _this.elementRteTool.offsetWidth - w + 'px';
                } else {
                  pop.style.left = left - w / 2 + 23 + 'px';
                }
                pop.style.right = 'auto';
              }
              if (dom.parentsHasClass(btn, 'elementrte-more-optionss')) {
                // Adjustment if button is placed on 2nd bar (div.elementrte-more-optionss)
                if (_this.builder.opts.toolbar === 'left') {
                  pop.style.top = parseInt(_this.elementRteMoreOptions.style.top) + _this.elementRteMoreOptions.offsetHeight - h + 'px';
                  pop.style.left = left + 54 + 'px';
                  pop.style.right = 'auto';
                } else if (_this.builder.opts.toolbar === 'right') {
                  pop.style.top = parseInt(_this.elementRteMoreOptions.style.top) + _this.elementRteMoreOptions.offsetHeight - h + 'px';
                  pop.style.left = 'auto';
                  var _viewportWidth6 = document.body.clientWidth; //window.innerWidth;
                  pop.style.right = _viewportWidth6 - left + 9 + 'px';
                } else {
                  pop.style.top = top + 54 - 6 + 'px';
                  // pop.style.left = (left -(w/2)+23) + 'px'; 
                  pop.style.left = parseInt(_this.elementRteMoreOptions.style.left) + _this.elementRteMoreOptions.offsetWidth - w + 'px';
                  pop.style.right = 'auto';
                }
              }
            }
            pop.focus();
          }, btn);
        } else {
          _this.util.hideRtePop(pop);
        }
      });
    });

    // Zoom
    var hideTools = function hideTools() {
      // hide tools
      var tools = _this.builder.doc.querySelectorAll('.is-tool');
      Array.prototype.forEach.call(tools, function (tool) {
        tool.style.display = '';
      });
      tools = _this.builder.doc.querySelectorAll('.is-row-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = _this.builder.doc.querySelectorAll('.is-col-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = _this.builder.doc.querySelectorAll('.is-canvas-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = _this.builder.doc.querySelectorAll('.is-canvasadd-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = _this.builder.doc.querySelectorAll('.is-rowadd-tool');
      tools.forEach(function (tool) {
        tool.style.opacity = 0;
      });
    };
    var showTools = function showTools() {
      setTimeout(function () {
        // show & reposition
        _this.builder.elmTool.repositionElementTool();
        var tools = _this.builder.doc.querySelectorAll('.is-row-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-rowadd-tool');
        tools.forEach(function (tool) {
          tool.style.opacity = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-col-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-canvas-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-canvasadd-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
      }, 350);
    };
    this.rteZoomSlider.value = this.builder.opts.zoom * 100;
    this.rteZoomSlider.onfocus = function () {
      if (_this.builder.onZoomStart) {
        _this.builder.onZoomStart();
      }

      // this.rteZoomSlider.blur();
      // const pop = document.querySelector('.rte-zoom-options.active');
      // pop.focus(); // enable esc to close
    };

    this.rteZoomSlider.oninput = function () {
      //scale: 0.5 - 1
      //val: 50 - 100
      var val = _this.rteZoomSlider.value;
      var scale = val / 100;
      _this.builder.opts.zoom = scale;
      localStorage.setItem('_zoom', scale); // Save

      // setZoomOnArea
      _this.builder.setZoomOnArea();

      // hide tools
      hideTools();
      if (_this.builder.onZoom) {
        var _val = _this.rteZoomSlider.value;
        var _scale = _val / 100;
        _this.builder.onZoom(_scale);
      }
    };
    this.rteZoomSlider.onchange = function () {
      setTimeout(function () {
        // setZoomOnControl
        if (_this.builder.isContentBox) {
          var wrapper = _this.builder.doc.querySelector(_this.builder.opts.page);
          _this.builder.setZoomOnControl(wrapper);
        } else if (_this.builder.canvas && !_this.builder.isContentBox && _this.builder.docContainer) {
          // freeform
          var docContainer = _this.builder.doc.querySelector(_this.builder.docContainer);
          _this.builder.setZoomOnControl(docContainer);
        } else {
          var builders = _this.builder.doc.querySelectorAll(_this.builder.opts.container);
          builders.forEach(function (builder) {
            _this.builder.setZoomOnControl(builder);
          });
        }
        if (_this.builder.onZoomEnd) {
          var val = _this.rteZoomSlider.value;
          var scale = val / 100;
          _this.builder.onZoomEnd(scale);
        }
      }, 350);
    };
    this.rteZoomSlider.addEventListener('mouseup', function () {
      showTools();
    });
    this.rteZoomSlider.addEventListener('touchend', function () {
      showTools();
    });

    // Zoom Modal
    this.inpZoomSlider.onfocus = function () {
      if (_this.builder.onZoomStart) {
        _this.builder.onZoomStart();
      }
      // this.inpZoomSlider.blur();
    };

    this.inpZoomSlider.oninput = function () {
      //scale: 0.5 - 1
      //val: 50 - 100
      var val = _this.inpZoomSlider.value;
      var scale = val / 100;
      _this.builder.opts.zoom = scale;
      localStorage.setItem('_zoom', scale); // Save

      // setZoomOnArea
      _this.builder.setZoomOnArea();

      // hide tools
      hideTools();
      if (_this.builder.onZoom) {
        var _val2 = _this.inpZoomSlider.value;
        var _scale2 = _val2 / 100;
        _this.builder.onZoom(_scale2);
      }
    };
    this.inpZoomSlider.onchange = function () {
      setTimeout(function () {
        // setZoomOnControl
        if (_this.builder.isContentBox) {
          var wrapper = _this.builder.doc.querySelector(_this.builder.opts.page);
          _this.builder.setZoomOnControl(wrapper);
        } else if (_this.builder.canvas && !_this.builder.isContentBox && _this.builder.docContainer) {
          // freeform
          var docContainer = _this.builder.doc.querySelector(_this.builder.docContainer);
          _this.builder.setZoomOnControl(docContainer);
        } else {
          var builders = _this.builder.doc.querySelectorAll(_this.builder.opts.container);
          builders.forEach(function (builder) {
            _this.builder.setZoomOnControl(builder);
          });
        }

        // show & reposition
        _this.builder.elmTool.repositionElementTool();
        var tools = _this.builder.doc.querySelectorAll('.is-row-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-rowadd-tool');
        tools.forEach(function (tool) {
          tool.style.opacity = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-col-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-canvas-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this.builder.doc.querySelectorAll('.is-canvasadd-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        if (_this.builder.onZoomEnd) {
          var val = _this.rteZoomSlider.value;
          var scale = val / 100;
          _this.builder.onZoomEnd(scale);
        }
        if (_this.builder.onZoomEnd) {
          var _val3 = _this.inpZoomSlider.value;
          var _scale3 = _val3 / 100;
          _this.builder.onZoomEnd(_scale3);
        }
        _this.rteZoomSlider.value = _this.inpZoomSlider.value;
      }, 300);
    };
    this.inpZoomSlider.addEventListener('mouseup', function () {
      showTools();
    });
    this.inpZoomSlider.addEventListener('touchend', function () {
      showTools();
    });

    // Text Settings
    var btnRteTextSettings = builderStuff.querySelectorAll('button.rte-textsettings');
    btnRteTextSettings.forEach(function (btn) {
      dom.addEventListener(btn, 'click', function () {
        var pop = _this.rteTextSettingOptions;
        var top = btn.getBoundingClientRect().top;
        var left = btn.getBoundingClientRect().left;
        pop.style.display = 'flex';
        var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
        var h = pop.offsetHeight;
        if (!dom.hasClass(pop, 'active')) {
          _this.getTextSettingsState();
          _this.util.showRtePop(pop, function () {
            if (_this.builder.opts.toolbar === 'left') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this.builder.opts.toolbar === 'right') {
              pop.style.top = top - h / 2 + 20 + 'px';
              pop.style.left = 'auto';
              var viewportWidth = document.body.clientWidth; //window.innerWidth;
              pop.style.right = viewportWidth - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              pop.style.left = left - w / 2 + 23 + 'px';
              pop.style.right = 'auto';
            }
            if (dom.parentsHasClass(btn, 'rte-more-options')) {
              // Adjustment if button is placed on 2nd bar (div.rte-more-options)
              if (_this.builder.opts.toolbar === 'left') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = left + 54 + 'px';
                pop.style.right = 'auto';
              } else if (_this.builder.opts.toolbar === 'right') {
                pop.style.top = parseInt(_this.rteMoreOptions.style.top) + _this.rteMoreOptions.offsetHeight - h + 'px';
                pop.style.left = 'auto';
                var _viewportWidth7 = document.body.clientWidth; //window.innerWidth;
                pop.style.right = _viewportWidth7 - left + 9 + 'px';
              } else {
                pop.style.top = top + 54 - 6 + 'px';
                pop.style.left = left - w / 2 + 23 + 'px'; //(parseInt(this.rteMoreOptions.style.left) + this.rteMoreOptions.offsetWidth - w) + 'px';
                pop.style.right = 'auto';
              }
            }
            pop.focus();
          }, btn);
        } else {
          _this.util.hideRtePop(pop);
        }
      });
    });
    var handleTextSettingsKeyDown = function handleTextSettingsKeyDown(e) {
      if (e.which === 9 && !e.shiftKey) {
        // tab key pressed
        if (e.target === document.querySelector('.rte-letterspacing-options button:last-child')) {
          document.querySelector('.rte-textsetting-options button').focus();
          e.preventDefault();
        }
      } else if (e.which === 9 && e.shiftKey) {
        // tab + shift key pressed
        if (e.target === document.querySelector('.rte-textsetting-options button')) {
          document.querySelector('.rte-letterspacing-options button:last-child').focus();
          e.preventDefault();
        }
      }
    };
    btns = rteTextSettingOptions.querySelectorAll('button');
    btns.forEach(function (elm) {
      elm.addEventListener('keydown', handleTextSettingsKeyDown);
    });

    // More
    var btnRteMore = this.rteTool.querySelectorAll('button.rte-more');
    btnRteMore.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.showRteMore();
      });
    });
    var btnElementRteMore = this.elementRteTool.querySelector('button.rte-more');
    if (btnElementRteMore) dom.addEventListener(btnElementRteMore, 'click', function () {
      _this.showElementRteMore();
    });

    // -----------------------------

    // Formatting
    var btns = Array.prototype.slice.call(this.rteTool.querySelectorAll('.rte-format')).concat(Array.prototype.slice.call(this.rteFormattingOptions.querySelectorAll('.rte-format'))).concat(Array.prototype.slice.call(this.rteMoreOptions.querySelectorAll('.rte-format')));
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        // old 8368

        _this.builder.uo.saveForUndo();
        var command = btn.getAttribute('data-command');
        var text = dom.getSelected();
        _this.formatText(command);

        //save selection (only for desktop)
        if (!_this.builder.isTouchSupport) {
          util.saveSelection(); //Needed because after format, a tag is added (ex. <b>,<i>), so, make selection again. 
        }

        if (text.trim() === '') {
          util.restoreSelection(); //place cursor back after formatting (bold, italic, ...)

          if (_this.builder.isTouchSupport) {
            //prevent keyboard open
            var btnFocus = _this.rteTool.querySelector('button');
            btnFocus.focus();
          }
        }

        // Or can be placed here:
        // if(this.builder.isTouchSupport) { //prevent keyboard open
        //     const btnFocus = this.rteTool.querySelector('button'); 
        //     btnFocus.focus();
        // }

        //Trigger Change event
        _this.builder.opts.onChange();
        if (_this.builder.onTextChange) _this.builder.onTextChange();
      });
    });

    // Align
    btns = this.rteAlignOptions.querySelectorAll('button[data-align]');
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        _this.builder.uo.saveForUndo();
        util.restoreSelection(); //a must

        if (_this.builder.isTouchSupport) {
          //prevent keyboard open
          var btnFocus = _this.rteTool.querySelector('button');
          btnFocus.focus();
        }
        var command = btn.getAttribute('data-align');
        var elm;
        try {
          var curr;
          if (_this.builder.win.getSelection) {
            curr = _this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
            if (curr.nodeType === 3) {
              //text node
              elm = curr.parentNode;
            } else {
              elm = curr;
            }
          } else if (_this.builder.doc.selection) {
            curr = _this.builder.doc.selection.createRange();
            elm = _this.builder.doc.selection.createRange().parentElement();
          }
        } catch (e) {
          return;
        }
        var element = elm;

        /*
        getSelection works only if element selectable. If not, it uses previous selected element which is incorrect.
        So we check if activeElement is different with getSelection() => means incorrect
        */
        if (_this.builder.activeElement.contains(element)) {
          // console.log(container);
          // Do Nothing
        } else {
          element = _this.builder.activeElement; // If incorrect, uses activeElement
        }

        //if element is button in email mode
        //mod by Jack
        var tbl_button = element.closest('table.button');
        if (tbl_button) {
          if (command === 'center') {
            if (tbl_button.parentNode.tagName.toLowerCase() !== 'center') {
              //wrap with center
              var centerEl = document.createElement('CENTER');
              tbl_button.parentNode.insertBefore(centerEl, tbl_button);
              centerEl.appendChild(tbl_button);
            } else {
              tbl_button.setAttribute('align', '');
            }
          } else {
            tbl_button.setAttribute('align', command);
          }
          dom.removeClass(tbl_button, 'float-center');
        } else {
          while (element.tagName.toLowerCase() !== 'p' && element.tagName.toLowerCase() !== 'h1' && element.tagName.toLowerCase() !== 'h2' && element.tagName.toLowerCase() !== 'h3' && element.tagName.toLowerCase() !== 'h4' && element.tagName.toLowerCase() !== 'h5' && element.tagName.toLowerCase() !== 'h6' && element.tagName.toLowerCase() !== 'pre' && element.tagName.toLowerCase() !== 'blockquote' && element.tagName.toLowerCase() !== 'div' && element.tagName.toLowerCase() !== 'td' && element.tagName.toLowerCase() !== 'th') {
            element = element.parentNode;
          }
          if (_this.builder.useCssClasses) {
            element.style.textAlign = '';
            dom.removeClass(element, _this.builder.cssClasses.textAlign.left);
            dom.removeClass(element, _this.builder.cssClasses.textAlign.center);
            dom.removeClass(element, _this.builder.cssClasses.textAlign.right);
            dom.removeClass(element, _this.builder.cssClasses.textAlign.justify);
            if (command === 'left') dom.addClass(element, _this.builder.cssClasses.textAlign.left);
            if (command === 'center') dom.addClass(element, _this.builder.cssClasses.textAlign.center);
            if (command === 'right') dom.addClass(element, _this.builder.cssClasses.textAlign.right);
            if (command === 'justify') dom.addClass(element, _this.builder.cssClasses.textAlign.justify);
          } else {
            element.style.textAlign = command;
          }
        }
        _this.getState();

        //save selection
        util.saveSelection();

        //Trigger Change event
        _this.builder.opts.onChange();
        if (_this.builder.onTextChange) _this.builder.onTextChange();
      });
    });
    btns = this.elementRteTool.querySelectorAll('button[data-align]');
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        _this.builder.uo.saveForUndo();

        //util.restoreSelection(); //a must

        // if(this.builder.isTouchSupport) { //prevent keyboard open
        //     const btnFocus = this.rteTool.querySelector('button'); 
        //     btnFocus.focus();
        // }

        var command = btn.getAttribute('data-align');

        // let elm;
        // try{
        //     let curr;
        //     if (this.builder.win.getSelection) {
        //         curr = this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
        //         if (curr.nodeType === 3) {  //text node
        //             elm = curr.parentNode;
        //         } else {
        //             elm = curr;
        //         }
        //     }
        //     else if (this.builder.doc.selection) {
        //         curr = this.builder.doc.selection.createRange();
        //         elm = this.builder.doc.selection.createRange().parentElement();
        //     }
        // } catch(e) {return;}

        var elm = _this.builder.inspectedElement;
        var element = elm;
        while (element.tagName.toLowerCase() !== 'p' && element.tagName.toLowerCase() !== 'h1' && element.tagName.toLowerCase() !== 'h2' && element.tagName.toLowerCase() !== 'h3' && element.tagName.toLowerCase() !== 'h4' && element.tagName.toLowerCase() !== 'h5' && element.tagName.toLowerCase() !== 'h6' && element.tagName.toLowerCase() !== 'pre' && element.tagName.toLowerCase() !== 'blockquote' && element.tagName.toLowerCase() !== 'div' && element.tagName.toLowerCase() !== 'td' && element.tagName.toLowerCase() !== 'th') {
          element = element.parentNode;
        }
        if (_this.builder.useCssClasses) {
          element.style.textAlign = '';
          dom.removeClass(element, _this.builder.cssClasses.textAlign.left);
          dom.removeClass(element, _this.builder.cssClasses.textAlign.center);
          dom.removeClass(element, _this.builder.cssClasses.textAlign.right);
          dom.removeClass(element, _this.builder.cssClasses.textAlign.justify);
          if (command === 'left') dom.addClass(element, _this.builder.cssClasses.textAlign.left);
          if (command === 'center') dom.addClass(element, _this.builder.cssClasses.textAlign.center);
          if (command === 'right') dom.addClass(element, _this.builder.cssClasses.textAlign.right);
          if (command === 'justify') dom.addClass(element, _this.builder.cssClasses.textAlign.justify);
        } else {
          element.style.textAlign = command;
        }
        _this.getState();

        //save selection
        // util.saveSelection();

        //Trigger Change event
        _this.builder.opts.onChange();
        if (_this.builder.onTextChange) _this.builder.onTextChange();
      });
    });
    btns = this.elementRteMoreOptions.querySelectorAll('button[data-align]'); // new
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        _this.builder.uo.saveForUndo();
        var command = btn.getAttribute('data-align');
        var elm = _this.builder.inspectedElement;
        var element = elm;
        while (element.tagName.toLowerCase() !== 'p' && element.tagName.toLowerCase() !== 'h1' && element.tagName.toLowerCase() !== 'h2' && element.tagName.toLowerCase() !== 'h3' && element.tagName.toLowerCase() !== 'h4' && element.tagName.toLowerCase() !== 'h5' && element.tagName.toLowerCase() !== 'h6' && element.tagName.toLowerCase() !== 'pre' && element.tagName.toLowerCase() !== 'blockquote' && element.tagName.toLowerCase() !== 'div' && element.tagName.toLowerCase() !== 'td' && element.tagName.toLowerCase() !== 'th') {
          element = element.parentNode;
        }
        if (_this.builder.useCssClasses) {
          element.style.textAlign = '';
          dom.removeClass(element, _this.builder.cssClasses.textAlign.left);
          dom.removeClass(element, _this.builder.cssClasses.textAlign.center);
          dom.removeClass(element, _this.builder.cssClasses.textAlign.right);
          dom.removeClass(element, _this.builder.cssClasses.textAlign.justify);
          if (command === 'left') dom.addClass(element, _this.builder.cssClasses.textAlign.left);
          if (command === 'center') dom.addClass(element, _this.builder.cssClasses.textAlign.center);
          if (command === 'right') dom.addClass(element, _this.builder.cssClasses.textAlign.right);
          if (command === 'justify') dom.addClass(element, _this.builder.cssClasses.textAlign.justify);
        } else {
          element.style.textAlign = command;
        }
        _this.getState();

        //Trigger Change event
        _this.builder.opts.onChange();
        if (_this.builder.onTextChange) _this.builder.onTextChange();
      });
    });

    // List
    btns = this.rteListOptions.querySelectorAll('button[data-action]');
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        _this.builder.uo.saveForUndo();
        util.restoreSelection(); //a must

        // cleanup span with style
        var activeCol = _this.builder.activeCol;
        var spans = activeCol.querySelectorAll('span');
        Array.prototype.forEach.call(spans, function (span) {
          span.setAttribute('data-keep', '');
        });
        var command = btn.getAttribute('data-action'); //insertUnorderedList, insertOrderedList, indent, outdent           
        _this.builder.doc.execCommand(command, false, null);

        // cleanup span with style
        activeCol = _this.builder.activeCol;
        spans = activeCol.querySelectorAll('span');
        Array.prototype.forEach.call(spans, function (span) {
          var attr = span.getAttribute('data-keep');
          if (!attr) {
            span.outerHTML = span.innerHTML;
          }
        });
        Array.prototype.forEach.call(spans, function (span) {
          var attr = span.getAttribute('data-keep');
          if (attr) {
            dom.removeAttribute(span, 'data-keep');
          }
        });
        _this.getState();

        //save selection
        util.saveSelection();

        //Trigger Change event
        _this.builder.opts.onChange();
        if (_this.builder.isTouchSupport) {
          //prevent keyboard open
          var btnFocus = _this.rteTool.querySelector('button');
          btnFocus.focus();
        }
      });
    });

    // Color
    var tabs = rteColorPicker.querySelectorAll('.is-pop-tab-item');
    Array.prototype.forEach.call(tabs, function (tab) {
      dom.addEventListener(tab, 'click', function (e) {
        _this.builder.uo.saveForUndo(true); // checkLater = true

        var elms = rteColorPicker.querySelectorAll('.is-pop-tab-item');
        Array.prototype.forEach.call(elms, function (elm) {
          dom.removeClass(elm, 'active');
        });
        dom.addClass(e.target, 'active');
        var val = rteColorPicker.querySelector('.active').getAttribute('data-value');
        if (val === 'forecolor') {
          rteColorPicker.setAttribute('data-command', 'forecolor');
        } else {
          rteColorPicker.setAttribute('data-command', 'backcolor');
        }
      });
    });
    new contentbuilder_colorpicker({
      colors: this.builder.opts.colors,
      onPick: function onPick(color) {
        util.restoreSelection(); //a must

        var elm;
        try {
          var curr;
          if (_this.builder.win.getSelection) {
            curr = _this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
            if (curr.nodeType === 3) {
              //text node
              elm = curr.parentNode;
            } else {
              elm = curr;
            }
          } else if (_this.builder.doc.selection) {
            curr = _this.builder.doc.selection.createRange();
            elm = _this.builder.doc.selection.createRange().parentElement();
          }
        } catch (e) {
          if (_this.builder.activeIcon) {
            // If icon is selected, the selection will not be a text selection
            elm = _this.builder.activeIcon;
          } else {
            return;
          }
        }

        // If icon is selected
        if (_this.builder.activeIcon) {
          elm = _this.builder.activeIcon;
        }
        var command = rteColorPicker.getAttribute('data-command');

        // If svg is selected
        if (_this.builder.activeSvg) {
          elm = _this.builder.activeSvg;
          if (command === 'forecolor') {
            if (elm.style.fill) {
              elm.style.fill = color;
            } else {
              elm.style.color = color;
            }
          } else {
            elm.style.backgroundColor = color;
          }

          // if(!this.builder.isTouchSupport) {
          //     util.saveSelection(); //Needed because after format, a tag is added (ex. <b>,<i>), so, make selection again. 
          // }

          _this.builder.opts.onChange();
          if (_this.builder.onTextChange) _this.builder.onTextChange();
          if (_this.builder.onIconChange) _this.builder.onIconChange();
          return;
        }
        var text = dom.getSelected();
        if (text.trim() === '') {
          if (command === 'forecolor') {
            elm.style.color = color;
          } else {
            elm.style.backgroundColor = color;
          }
        } else {
          if (elm.innerText === text) {
            if (command === 'forecolor') {
              elm.style.color = color;
            } else {
              elm.style.backgroundColor = color;
            }
          } else {
            if (command === 'forecolor') {
              _this.builder.doc.execCommand('ForeColor', false, color);
            } else {
              _this.builder.doc.execCommand('BackColor', false, color);
            }

            //Cleanup FONTs
            var fontElements = _this.builder.doc.getElementsByTagName('font');
            for (var i = 0, len = fontElements.length; i < len; ++i) {
              var s = fontElements[i].color;
              if (s !== '') {
                if (command === 'forecolor') {
                  fontElements[i].removeAttribute('color');
                  fontElements[i].style.color = color; //s;
                }
              }
            }
          }
        }

        //save selection (only for desktop)
        if (!_this.builder.isTouchSupport) {
          util.saveSelection(); //Needed because after format, a tag is added (ex. <b>,<i>), so, make selection again. 
        }

        if (text.trim() === '') {
          util.restoreSelection(); //place cursor back after formatting (bold, italic, ...)
        }

        if (_this.builder.isTouchSupport) {
          //prevent keyboard open
          var btnFocus = _this.rteTool.querySelector('button');
          btnFocus.focus();
        }
        //Trigger Change event
        _this.builder.opts.onChange();
        if (_this.builder.onTextChange) _this.builder.onTextChange();
        if (_this.builder.onIconChange) _this.builder.onIconChange();
      },
      renderOn: '.rte-color-picker-area',
      animateModal: this.builder.opts.animateModal,
      elementToAnimate: this.builder.opts.container,
      lang: this.builder.opts.lang
    });

    // Font Size (new execCommand)
    btns = rteTextSettingOptions.querySelectorAll('.rte-fontsize-options button');
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        // old 9135

        var num = btn.getAttribute('data-value');
        util.restoreSelection(); //a must

        _this.builder.uo.saveForUndo();
        var selection = dom.getSelection();
        if (!selection) return;
        var anchorNode = selection.anchorNode;
        var currentFontSize = 1;
        if (anchorNode) {
          var container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
          currentFontSize = Number(window.getComputedStyle(container).getPropertyValue('font-size').match(/\d+/)[0]);
        }
        var btns = rteTextSettingOptions.querySelectorAll('.rte-fontsize-options button');
        Array.prototype.forEach.call(btns, function (btn) {
          btn.classList.remove('on'); // clear selection
        });

        dom.execCommand('font-size', currentFontSize + 1 + 'px', function (ok, container) {
          // 1px is dummy so that it won't be cleaned in util.js (checkStyleIfSameAsParent) because of same size

          if (!ok) {
            // If icon is selected
            if (_this.builder.activeIcon) {
              var elm = _this.builder.activeIcon;
              if (_this.builder.opts.fontSizeClassValues.length > 0) {
                _this.applyClassFontSize(elm, num);
              } else {
                _this.applyInlineFontSize(elm, num);
              }
            }
          }
          if (container) {
            if (_this.builder.opts.fontSizeClassValues.length > 0) {
              _this.applyClassFontSize(container, num);
            } else {
              _this.applyInlineFontSize(container, num);
            }
            container.style.fontSize = '';
          }
          if (_this.builder.onTextChange) _this.builder.onTextChange();
          if (_this.builder.onIconChange) _this.builder.onIconChange();
        });

        //save selection
        util.saveSelection();

        // this.getState();
        _this.getTextSettingsState();

        //Trigger Change event
        _this.builder.opts.onChange();

        // if(this.builder.isTouchSupport) { //prevent keyboard open
        //     const btnFocus = this.rteTool.querySelector('button'); 
        //     btnFocus.focus();
        // }

        // btn.focus();
      });
    });

    // Font Weight (new execCommand)
    btns = rteTextSettingOptions.querySelectorAll('.rte-fontweight-options button');
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        // old 9135

        var num = btn.getAttribute('data-value');
        util.restoreSelection(); //a must

        _this.builder.uo.saveForUndo();
        var btns = rteTextSettingOptions.querySelectorAll('.rte-fontweight-options button');
        Array.prototype.forEach.call(btns, function (btn) {
          btn.classList.remove('on'); // clear selection
        });

        dom.execCommand('font-weight', num, function (ok, container) {
          if (_this.builder.useCssClasses) {
            if (container) {
              _this.applyClassFontWeight(container, num);
            }
          }
        });

        //save selection
        util.saveSelection();
        _this.getState();
        _this.getTextSettingsState();

        //Trigger Change event
        _this.builder.opts.onChange();

        // if(this.builder.isTouchSupport) { //prevent keyboard open
        //     const btnFocus = this.rteTool.querySelector('button'); 
        //     btnFocus.focus();
        // }

        // btn.focus();

        if (_this.builder.onTextChange) _this.builder.onTextChange();
      });
    });

    // Line Height
    btns = rteTextSettingOptions.querySelectorAll('.rte-lineheight-options button');
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        var num = btn.getAttribute('data-value');
        util.restoreSelection(); //a must

        _this.builder.uo.saveForUndo();
        var btns = rteTextSettingOptions.querySelectorAll('.rte-lineheight-options button');
        Array.prototype.forEach.call(btns, function (btn) {
          btn.classList.remove('on'); // clear selection
        });

        if (_this.builder.useCssClasses) {
          var selection = dom.getSelection();
          if (!selection) return;
          var anchorNode = selection.anchorNode;
          var container;
          if (anchorNode) {
            container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
          }
          if (!container) return; // ex. when selecting an icon

          var newClassName;
          var classes = _this.builder.cssClasses.leading;
          if (num === '') {
            // clean
            newClassName = '';
          } else if (num === '+' || num === '-') {
            for (var i = 0; i < Object.keys(classes).length; i++) {
              var className = Object.values(classes)[i];
              if (container.closest(".".concat(className))) {
                if (num === '+') {
                  if (i + 1 === Object.keys(classes).length) return;
                  newClassName = Object.values(classes)[i + 1];
                  break;
                } else if (num === '-') {
                  if (i - 1 < 0) return;
                  newClassName = Object.values(classes)[i - 1];
                  break;
                }
              }
            }
          } else {
            if (num === '0.8') {
              newClassName = classes.leading_8;
            } else if (num === '0.9') {
              newClassName = classes.leading_9;
            } else if (num === '1') {
              newClassName = classes.leading_10;
            } else if (num === '1.1') {
              newClassName = classes.leading_11;
            } else if (num === '1.2') {
              newClassName = classes.leading_12;
            } else if (num === '1.3') {
              newClassName = classes.leading_13;
            } else if (num === '1.4') {
              newClassName = classes.leading_14;
            } else if (num === '1.5') {
              newClassName = classes.leading_15;
            } else if (num === '1.6') {
              newClassName = classes.leading_16;
            } else if (num === '1.7') {
              newClassName = classes.leading_17;
            } else if (num === '1.8') {
              newClassName = classes.leading_18;
            } else if (num === '1.9') {
              newClassName = classes.leading_19;
            } else if (num === '2') {
              newClassName = classes.leading_20;
            } else if (num === '2.1') {
              newClassName = classes.leading_21;
            } else if (num === '2.2') {
              newClassName = classes.leading_22;
            }
          }
          if (!newClassName) {
            if (num === '+') {
              newClassName = classes.leading_16;
            } else if (num === '-') {
              newClassName = classes.leading_14;
            }
          }
          var elm = dom.getParentBlock(container);
          if (elm) elm.style.lineHeight = ''; // Clean inline style

          dom.execCommandClass(newClassName, classes, true, 'block');
        } else {
          var _elm;
          try {
            var curr;
            if (_this.builder.win.getSelection) {
              curr = _this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
              if (curr.nodeType === 3) {
                //text node
                _elm = curr.parentNode;
              } else {
                _elm = curr;
              }
            } else if (_this.builder.doc.selection) {
              curr = _this.builder.doc.selection.createRange();
              _elm = _this.builder.doc.selection.createRange().parentElement();
            }
          } catch (e) {
            if (_this.builder.activeIcon) {
              // If icon is selected, the selection will not be a text selection
              _elm = _this.builder.activeIcon;
            } else {
              return;
            }
          }

          // If icon is selected
          if (_this.builder.activeIcon) {
            _elm = _this.builder.activeIcon;
          }

          // Find block element (line-height only works on block element)
          var element = _elm;
          while (element) {
            if (element.tagName === 'BODY' || element.tagName === 'HTML') return false;
            if (window.getComputedStyle(element).getPropertyValue('display') !== 'inline') {
              _elm = element;
              break;
            }
            element = element.parentNode;
          }

          // var text = dom.getSelected();

          // let currentLineHeight = Number(window.getComputedStyle(elm).getPropertyValue('line-height').match(/\d+/)[0]);
          var isInPx = false;
          var currentLineHeight = _elm.style.lineHeight;
          if (currentLineHeight) {
            if (currentLineHeight.indexOf('px') === -1) {
              currentLineHeight = parseFloat(currentLineHeight);
            } else {
              isInPx = true;
            }
          } else {
            isInPx = true;
          }
          if (isInPx) {
            var fontSize = Number(window.getComputedStyle(_elm).getPropertyValue('font-size').match(/\d+/)[0]);
            currentLineHeight = Number(window.getComputedStyle(_elm).getPropertyValue('line-height').match(/\d+/)[0]);
            if (fontSize > currentLineHeight) {
              currentLineHeight = fontSize / currentLineHeight;
            } else if (fontSize < currentLineHeight) {
              currentLineHeight = currentLineHeight / fontSize;
            } else {
              currentLineHeight = 1;
            }
          }
          var lineheight;
          if (num === '+') {
            lineheight = currentLineHeight + 0.1;
          } else if (num === '-') {
            lineheight = currentLineHeight - 0.1;
            if (lineheight < 0.2) lineheight = 0.2; // prevent very small number
          } else if (num === '') {
            lineheight = '';
          } else {
            lineheight = num;
          }

          /** mod by Jack */
          //elm.style.lineHeight = lineheight;
          dom.doFunction(_elm, function (theEl) {
            // apply to block element only
            if (window.getComputedStyle(theEl).getPropertyValue('display') !== 'inline') {
              theEl.style.lineHeight = lineheight;
            }
          }, true);
        }

        //save selection
        util.saveSelection();

        // this.getState();
        _this.getTextSettingsState();

        //Trigger Change event
        _this.builder.opts.onChange();

        // if(this.builder.isTouchSupport) { //prevent keyboard open
        //     const btnFocus = this.rteTool.querySelector('button'); 
        //     btnFocus.focus();
        // }

        // btn.focus();

        if (_this.builder.onTextChange) _this.builder.onTextChange();
      });
    });

    // Letter Spacing
    btns = rteTextSettingOptions.querySelectorAll('.rte-letterspacing-options button');
    Array.prototype.forEach.call(btns, function (btn) {
      dom.addEventListener(btn, 'click', function () {
        var num = btn.getAttribute('data-value');
        util.restoreSelection(); //a must

        _this.builder.uo.saveForUndo();
        var btns = rteTextSettingOptions.querySelectorAll('.rte-letterspacing-options button');
        Array.prototype.forEach.call(btns, function (btn) {
          btn.classList.remove('on'); // clear selection
        });

        if (_this.builder.useCssClasses) {
          var selection = dom.getSelection();
          if (!selection) return;
          var anchorNode = selection.anchorNode;
          var container;
          if (anchorNode) {
            container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
          }
          if (!container) return; // ex. when selecting an icon

          var newClassName;
          var classes = _this.builder.cssClasses.tracking;
          if (num === '') {
            // clean
            newClassName = '';
          } else if (num === '+' || num === '-') {
            for (var i = 0; i < Object.keys(classes).length; i++) {
              var className = Object.values(classes)[i];
              if (container.closest('.' + className) && !container.classList.contains('is-builder')) {
                if (num === '+') {
                  if (i + 1 === Object.keys(classes).length) return;
                  newClassName = Object.values(classes)[i + 1];
                  break;
                } else if (num === '-') {
                  if (i - 1 < 0) return;
                  newClassName = Object.values(classes)[i - 1];
                  break;
                }
              }
            }
          } else {
            if (num === '1') {
              newClassName = classes.tracking_025;
            }
            if (num === '2') {
              newClassName = classes.tracking_050;
            }
          }
          if (!newClassName) {
            if (num === '+') {
              newClassName = classes.tracking_025;
            } else if (num === '-') {
              newClassName = classes.tracking__025;
            }
          }
          if (_this.builder.activeElement) _this.builder.activeElement.style.letterSpacing = '';
          container.style.letterSpacing = ''; // Clean inline style

          if (newClassName === classes.tracking_000) newClassName = ''; // clear for normal tracking
          dom.execCommandClass(newClassName, classes);
        } else {
          var elm;
          try {
            var curr;
            if (_this.builder.win.getSelection) {
              curr = _this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
              if (curr.nodeType === 3) {
                //text node
                elm = curr.parentNode;
              } else {
                elm = curr;
              }
            } else if (_this.builder.doc.selection) {
              curr = _this.builder.doc.selection.createRange();
              elm = _this.builder.doc.selection.createRange().parentElement();
            }
          } catch (e) {
            if (_this.builder.activeIcon) {
              // If icon is selected, the selection will not be a text selection
              elm = _this.builder.activeIcon;
            } else {
              return;
            }
          }

          // If icon is selected
          if (_this.builder.activeIcon) {
            elm = _this.builder.activeIcon;
          }
          var currentLetterSpacing = parseInt(window.getComputedStyle(elm).getPropertyValue('letter-spacing'));
          if (isNaN(currentLetterSpacing)) currentLetterSpacing = 0;
          var letterspacing;
          if (num === '+') {
            letterspacing = currentLetterSpacing + 1 + 'px';
          } else if (num === '-') {
            letterspacing = currentLetterSpacing - 1 + 'px';
          } else if (num === '') {
            letterspacing = '';
          } else {
            letterspacing = num + 'px';
          }
          /** mod by Jack */
          //elm.style.letterSpacing = letterspacing;
          dom.doFunction(elm, function (theEl) {
            theEl.style.letterSpacing = letterspacing;
          }, true);
        }

        //save selection
        util.saveSelection();

        // this.getState();
        _this.getTextSettingsState();

        //Trigger Change event
        _this.builder.opts.onChange();

        // if(this.builder.isTouchSupport) { //prevent keyboard open
        //     const btnFocus = this.rteTool.querySelector('button'); 
        //     btnFocus.focus();
        // }

        // btn.focus();

        if (_this.builder.onTextChange) _this.builder.onTextChange();
      });
    });

    // freeform

    var btnGroup = builderStuff.querySelectorAll('button.rte-group');
    btnGroup.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.group();
        builderStuff.querySelectorAll('button.rte-group').forEach(function (elm) {
          return elm.style.display = 'none';
        });
        builderStuff.querySelectorAll('button.rte-ungroup').forEach(function (elm) {
          return elm.style.display = '';
        });
      });
    });
    var btnUnGroup = builderStuff.querySelectorAll('button.rte-ungroup');
    btnUnGroup.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.unGroup();
        builderStuff.querySelectorAll('button.rte-group').forEach(function (elm) {
          return elm.style.display = '';
        });
        builderStuff.querySelectorAll('button.rte-ungroup').forEach(function (elm) {
          return elm.style.display = 'none';
        });
      });
    });
    var btnDelete = builderStuff.querySelectorAll('button.rte-delete');
    btnDelete.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder["delete"]();
      });
    });
    var btnBlockSettings = builderStuff.querySelectorAll('button.rte-blocksettings');
    btnBlockSettings.forEach(function (btn) {
      btn.addEventListener('click', function () {
        _this.builder.blockmodal.show();
      });
    });
    var btnFront = builderStuff.querySelectorAll('button.rte-front');
    btnFront.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var activeBlock = _this.builder.doc.querySelector('.is-block.cloned');
        if (!activeBlock) return;
        _this.builder.forward(activeBlock);
      });
    });
    var btnBackward = builderStuff.querySelectorAll('button.rte-backward');
    btnBackward.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var activeBlock = _this.builder.doc.querySelector('.is-block.cloned');
        if (!activeBlock) return;
        if (activeBlock.style.zIndex === '0') {
          _this.builder.moveUp(activeBlock);
        }
        _this.builder.backward(activeBlock);
      });
    });
    var btnMoveUp = builderStuff.querySelectorAll('button.rte-moveup');
    btnMoveUp.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var activeBlock = _this.builder.doc.querySelector('.is-block.active');
        if (!activeBlock) return;
        _this.builder.moveUp(activeBlock);
      });
    });
    var btnMoveDown = builderStuff.querySelectorAll('button.rte-movedown');
    btnMoveDown.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var activeBlock = _this.builder.doc.querySelector('.is-block.active');
        if (!activeBlock) return;
        _this.builder.moveDown(activeBlock);
      });
    });
    var btnDuplicate = builderStuff.querySelectorAll('button.rte-duplicate');
    btnDuplicate.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var activeBlock = _this.builder.doc.querySelector('.is-block.cloned');
        if (!activeBlock) return;
        _this.builder.duplicate(activeBlock);
      });
    });

    // Backward compatible
    this.builderStuff.insertAdjacentHTML('afterbegin', "\n        <style>\n            #_cbhtml[toolbarfull] .is-rte-tool,\n            #_cbhtml[toolbarfull] .is-elementrte-tool {\n                top: 0;\n                left: 0;\n                width: 100vw;\n                align-items: center;\n                box-shadow: rgba(0, 0, 0, 0.07) -1px 1px 0px 0px;\n            }\n            #_cbhtml[toolbarfull] .is-rte-pop {\n                box-shadow: rgba(0, 0, 0, 0.05) 0px 1px 0px 1px;\n            }\n        </style>\n        ");
    if (this.builder.toolbarDisplay !== 'auto') {
      this.showDefaultToolbar(); // first time
    }
  } //contructor
  rte_createClass(Rte, [{
    key: "zoomStart",
    value: function zoomStart() {
      if (this.builder.onZoomStart) {
        this.builder.onZoomStart();
      }
    }
  }, {
    key: "zoom",
    value: function zoom(inp) {
      //scale: 0.5 - 1
      //val: 50 - 100
      var val = inp.value;
      var scale = val / 100;
      this.builder.opts.zoom = scale;
      localStorage.setItem('_zoom', scale); // Save

      // setZoomOnArea
      this.builder.setZoomOnArea();

      // hide tools
      var tools = this.builder.doc.querySelectorAll('.is-tool');
      Array.prototype.forEach.call(tools, function (tool) {
        tool.style.display = '';
      });
      tools = this.builder.doc.querySelectorAll('.is-row-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = this.builder.doc.querySelectorAll('.is-col-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = this.builder.doc.querySelectorAll('.is-canvas-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = this.builder.doc.querySelectorAll('.is-canvasadd-tool');
      tools.forEach(function (tool) {
        tool.style.display = 'none';
      });
      tools = this.builder.doc.querySelectorAll('.is-rowadd-tool');
      tools.forEach(function (tool) {
        tool.style.opacity = 0;
      });
      if (this.builder.onZoom) {
        var _val4 = inp.value;
        var _scale4 = _val4 / 100;
        this.builder.onZoom(_scale4);
      }
    }
  }, {
    key: "zoomEnd",
    value: function zoomEnd(inp) {
      var _this2 = this;
      setTimeout(function () {
        // setZoomOnControl
        if (_this2.builder.isContentBox) {
          var wrapper = _this2.builder.doc.querySelector(_this2.builder.opts.page);
          _this2.builder.setZoomOnControl(wrapper);
        } else if (_this2.builder.canvas && !_this2.builder.isContentBox && _this2.builder.docContainer) {
          // freeform
          var docContainer = _this2.builder.doc.querySelector(_this2.builder.docContainer);
          _this2.builder.setZoomOnControl(docContainer);
        } else {
          var builders = _this2.builder.doc.querySelectorAll(_this2.builder.opts.container);
          builders.forEach(function (builder) {
            _this2.builder.setZoomOnControl(builder);
          });
        }

        // show & reposition
        _this2.builder.elmTool.repositionElementTool();
        var tools = _this2.builder.doc.querySelectorAll('.is-row-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this2.builder.doc.querySelectorAll('.is-rowadd-tool');
        tools.forEach(function (tool) {
          tool.style.opacity = '';
        });
        tools = _this2.builder.doc.querySelectorAll('.is-col-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this2.builder.doc.querySelectorAll('.is-canvas-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        tools = _this2.builder.doc.querySelectorAll('.is-canvasadd-tool');
        tools.forEach(function (tool) {
          tool.style.display = '';
        });
        if (_this2.builder.onZoomEnd) {
          var val = inp.value;
          var scale = val / 100;
          _this2.builder.onZoomEnd(scale);
        }
      }, 300);
    }
  }, {
    key: "formatText",
    value: function formatText(command) {
      var dom = this.builder.dom;
      var elm;
      try {
        var curr;
        if (this.builder.win.getSelection) {
          curr = this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
          if (curr.nodeType === 3) {
            //text node
            elm = curr.parentNode;
          } else {
            elm = curr;
          }
        } else if (this.builder.doc.selection) {
          curr = this.builder.doc.selection.createRange();
          elm = this.builder.doc.selection.createRange().parentElement();
        }
      } catch (e) {
        return;
      }
      var text = dom.getSelected();
      if (command === 'bold') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('fontWeight', '', this.builder.cssClasses);
        } else {
          if (text.trim() === '') {
            var tagname = elm.tagName.toLowerCase();
            if (tagname === 'b') {
              dom.selectElementContents(elm);
              this.builder.doc.execCommand('bold', false, null);
            } else {
              if (elm.style.fontWeight === 'bold' || elm.style.fontWeight > 400) {
                elm.style.fontWeight = '';
              } else {
                elm.style.fontWeight = 'bold';
              }
            }
          } else {
            this.builder.doc.execCommand('bold', false, null);
          }
        }
      }
      if (command === 'italic') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('fontStyle', '', this.builder.cssClasses);
        } else {
          if (text.trim() === '') {
            tagname = elm.tagName.toLowerCase();
            if (tagname === 'i') {
              dom.selectElementContents(elm);
              this.builder.doc.execCommand('italic', false, null);
            } else {
              var fontStyle = window.getComputedStyle(elm).getPropertyValue('font-style');
              if (fontStyle === 'italic') {
                elm.style.fontStyle = 'normal';
              } else {
                elm.style.fontStyle = 'italic';
              }
            }
          } else {
            this.builder.doc.execCommand('italic', false, null);
          }
        }
      }
      if (command === 'underline') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('textUnderline', '', this.builder.cssClasses);
        } else {
          if (text.trim() === '') {
            tagname = elm.tagName.toLowerCase();
            if (tagname === 'u') {
              dom.selectElementContents(elm);
              this.builder.doc.execCommand('underline', false, null);
            } else {
              if (elm.style.textDecoration.indexOf('underline') !== -1) {
                elm.style.textDecoration = '';
              } else {
                elm.style.textDecoration = 'underline';
              }
            }
          } else {
            this.builder.doc.execCommand('underline', false, null);
          }
        }
      }
      if (command === 'strikethrough') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('textLinethrough', '', this.builder.cssClasses);
        } else {
          if (text.trim() === '') {
            tagname = elm.tagName.toLowerCase();
            if (tagname === 'strike') {
              dom.selectElementContents(elm);
              this.builder.doc.execCommand('strikethrough', false, null);
            } else {
              if (elm.style.textDecoration.indexOf('line-through') !== -1) {
                elm.style.textDecoration = '';
              } else {
                elm.style.textDecoration = 'line-through';
              }
            }
          } else {
            this.builder.doc.execCommand('strikethrough', false, null);
          }
        }
      }
      if (command === 'superscript') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('extend', 'superscript', this.builder.cssClasses);
        } else {
          this.builder.doc.execCommand('superscript', false, null);
        }
      }
      if (command === 'subscript') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('extend', 'subscript', this.builder.cssClasses);
        } else {
          this.builder.doc.execCommand('subscript', false, null);
        }
      }
      if (command === 'uppercase') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('textTransform', '', this.builder.cssClasses);
        } else {
          var textTransform = window.getComputedStyle(elm).getPropertyValue('text-transform');
          if (textTransform === 'uppercase') {
            elm.style.textTransform = 'lowercase';
          } else if (textTransform === 'lowercase') {
            elm.style.textTransform = 'capitalize';
          } else if (textTransform === 'capitalize') {
            elm.style.textTransform = 'none';
          } else if (textTransform === 'none') {
            elm.style.textTransform = 'uppercase';
          } else {
            elm.style.textTransform = 'none';
          }
        }
      }
      if (command === 'clean') {
        if (this.builder.useCssClasses) {
          this.builder.doc.execCommand('removeFormat', false, null); // optional: backward compatible (for cleaning old b, i tags)
          dom.execCommandToggle('clean', '', this.builder.cssClasses);
        } else {
          if (text.trim() === '') {
            elm.style.cssText = '';
            elm.className = '';
          } else {
            if (elm.innerText.replace(/(\r\n|\n|\r)/gm, '') === text.trim().replace(/(\r\n|\n|\r)/gm, '')) {
              elm.style.cssText = '';
              elm.className = '';
              this.builder.doc.execCommand('removeFormat', false, null);
              this.builder.doc.execCommand('removeFormat', false, null);
            } else {
              this.builder.doc.execCommand('removeFormat', false, null);
              this.builder.doc.execCommand('removeFormat', false, null);
            }
          }
        }
      }
      this.getState();
    }
  }, {
    key: "formatTextNonToggle",
    value: function formatTextNonToggle(command) {
      var _this3 = this;
      var dom = this.builder.dom;
      var elm;
      try {
        var curr;
        if (this.builder.win.getSelection) {
          curr = this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
          if (curr.nodeType === 3) {
            //text node
            elm = curr.parentNode;
          } else {
            elm = curr;
          }
        } else if (this.builder.doc.selection) {
          curr = this.builder.doc.selection.createRange();
          elm = this.builder.doc.selection.createRange().parentElement();
        }
      } catch (e) {
        return;
      }
      var text = dom.getSelected();
      if (command === 'bold') {
        dom.execCommand('text-weight', 'bold', function (ok, container) {
          if (_this3.builder.useCssClasses) {
            if (container) {
              var config = _this3.builder.cssClasses;
              container.classList.remove(config.fontWeight.thin);
              container.classList.remove(config.fontWeight.extralight);
              container.classList.remove(config.fontWeight.light);
              container.classList.remove(config.fontWeight.normal);
              container.classList.remove(config.fontWeight.semibold);
              container.classList.remove(config.fontWeight.bold);
              container.classList.remove(config.fontWeight.extrabold);
              container.classList.remove(config.fontWeight.black);
              container.classList.remove(config.fontWeight.defaultBold);
              container.classList.remove(config.fontWeight.defaultNormal);
              container.classList.add(config.fontWeight.semibold);
              dom.doFunction(container, function (theEl) {
                theEl.style.fontWeight = '';
              }, true);
            }
          }
        });
      }
      if (command === 'italic') {
        dom.execCommand('text-style', 'italic', function (ok, container) {
          if (_this3.builder.useCssClasses) {
            if (container) {
              var config = _this3.builder.cssClasses;
              container.classList.remove(config.fontStyle.italic);
              container.classList.remove(config.fontStyle.normal);
              container.classList.add(config.fontStyle.italic);
              dom.doFunction(container, function (theEl) {
                theEl.style.fontStyle = '';
              }, true);
            }
          }
        });
      }
      if (command === 'underline') {
        dom.execCommand('text-decoration', 'underline', function (ok, container) {
          if (_this3.builder.useCssClasses) {
            if (container) {
              var config = _this3.builder.cssClasses;
              container.classList.remove(config.textDecoration.underline);
              container.classList.remove(config.textDecoration.linethrough);
              container.classList.remove(config.textDecoration.normal);
              container.classList.add(config.textDecoration.underline);
              dom.doFunction(container, function (theEl) {
                theEl.style.textDecoration = '';
              }, true);
            }
          }
        });
      }
      if (command === 'strikethrough') {
        dom.execCommand('text-decoration', 'line-through', function (ok, container) {
          if (_this3.builder.useCssClasses) {
            if (container) {
              var config = _this3.builder.cssClasses;
              container.classList.remove(config.textDecoration.underline);
              container.classList.remove(config.textDecoration.linethrough);
              container.classList.remove(config.textDecoration.normal);
              container.classList.add(config.textDecoration.linethrough);
              dom.doFunction(container, function (theEl) {
                theEl.style.textDecoration = '';
              }, true);
            }
          }
        });
      }
      if (command === 'superscript') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('extend', 'superscript', this.builder.cssClasses);
        } else {
          this.builder.doc.execCommand('superscript', false, null);
        }
      }
      if (command === 'subscript') {
        if (this.builder.useCssClasses) {
          dom.execCommandToggle('extend', 'subscript', this.builder.cssClasses);
        } else {
          this.builder.doc.execCommand('subscript', false, null);
        }
      }
      if (command === 'uppercase') {
        dom.execCommand('text-transform', 'uppercase', function (ok, container) {
          if (_this3.builder.useCssClasses) {
            if (container) {
              var config = _this3.builder.cssClasses;
              container.classList.remove(config.textTransform.uppercase);
              container.classList.remove(config.textTransform.lowercase);
              container.classList.remove(config.textTransform.capitalize);
              container.classList.remove(config.textTransform.normal);
              container.classList.add(config.textTransform.uppercase);
              dom.doFunction(container, function (theEl) {
                theEl.style.textTransform = '';
              }, true);
            }
          }
        });
      }
      if (command === 'lowercase') {
        dom.execCommand('text-transform', 'lowercase', function (ok, container) {
          if (_this3.builder.useCssClasses) {
            if (container) {
              var config = _this3.builder.cssClasses;
              container.classList.remove(config.textTransform.uppercase);
              container.classList.remove(config.textTransform.lowercase);
              container.classList.remove(config.textTransform.capitalize);
              container.classList.remove(config.textTransform.normal);
              container.classList.add(config.textTransform.lowercase);
              dom.doFunction(container, function (theEl) {
                theEl.style.textTransform = '';
              }, true);
            }
          }
        });
      }
      if (command === 'capitalize') {
        dom.execCommand('text-transform', 'capitalize', function (ok, container) {
          if (_this3.builder.useCssClasses) {
            if (container) {
              var config = _this3.builder.cssClasses;
              container.classList.remove(config.textTransform.uppercase);
              container.classList.remove(config.textTransform.lowercase);
              container.classList.remove(config.textTransform.capitalize);
              container.classList.remove(config.textTransform.normal);
              container.classList.add(config.textTransform.capitalize);
              dom.doFunction(container, function (theEl) {
                theEl.style.textTransform = '';
              }, true);
            }
          }
        });
      }
      if (command === 'clean') {
        if (this.builder.useCssClasses) {
          this.builder.doc.execCommand('removeFormat', false, null); // optional: backward compatible (for cleaning old b, i tags)
          dom.execCommandToggle('clean', '', this.builder.cssClasses);
        } else {
          if (text.trim() === '') {
            elm.style.cssText = '';
            elm.className = '';
          } else {
            if (elm.innerText.replace(/(\r\n|\n|\r)/gm, '') === text.trim().replace(/(\r\n|\n|\r)/gm, '')) {
              elm.style.cssText = '';
              elm.className = '';
              this.builder.doc.execCommand('removeFormat', false, null);
              this.builder.doc.execCommand('removeFormat', false, null);
            } else {
              this.builder.doc.execCommand('removeFormat', false, null);
              this.builder.doc.execCommand('removeFormat', false, null);
            }
          }
        }
      }
      this.getState();
    }
  }, {
    key: "insertImage",
    value: function insertImage() {
      var dom = this.dom;
      var modalInsertImage = this.builderStuff.querySelector('.insertimage');
      var fileInsertImage = modalInsertImage.querySelector('#fileInsertImage');
      var modal = this.builderStuff.querySelector('.insertimage');
      this.util.showModal(modal, true, function () {
        //if(!this.builder.isTouchSupport) util.restoreSelection();
      }, false);
      modal.querySelector('#inpInsertImageSrc').focus();

      //Clear previous
      modal.querySelector('#fileInsertImage').value = ''; // clear
      modal.querySelector('.is-preview-area').style.display = 'none';
      fileInsertImage.removeAttribute('disabled');
      modal.querySelector('.is-drop-area').style.display = 'block';
      dom.removeClass(modal.querySelector('.is-drop-area'), 'image-dropping');

      //Clear image source input
      modal.querySelector('.input-src').value = '';
    }
  }, {
    key: "viewSnippets",
    value: function viewSnippets() {
      var snippets = new contentbuilder_snippets(this.builder);
      var modal = this.builderStuff.querySelector('.snippets');
      this.util.showModal(modal, false, null, false);

      // let iframe = modal.querySelector('iframe');
      // if(iframe.src==='about:blank') {
      //     iframe.src = builder.opts.snippetData;
      // }
      var ifr = modal.querySelector('iframe');
      var doc = ifr.contentWindow.document;
      if (doc.body.innerHTML === '') {
        doc.open();
        doc.write(snippets.getSnippetsHtml());
        doc.close();
      }
    }
  }, {
    key: "openIcon",
    value: function openIcon(e) {
      var _this4 = this;
      var pop = this.rteIconOptions;
      var divIconList = pop.querySelector('.div-icon-list');
      if (divIconList.innerHTML.trim() === '') {
        Promise.resolve().then(function () {
          var bootstrapInc = !_this4.builder.disableBootstrapIcons;
          if (bootstrapInc) {
            divIconList.innerHTML = _this4.getIcons2() + _this4.getIcons();
          } else {
            divIconList.innerHTML = _this4.getIcons();
          }
          divIconList.querySelectorAll('button').forEach(function (btn) {
            btn.addEventListener('click', function () {
              _this4.builder.addIcon(btn.querySelector('i').className);
              btn.focus();
            });
          });
        });
      }
      var dom = this.dom;
      var btnRteIcons = e.target;
      var top = btnRteIcons.getBoundingClientRect().top;
      var left = btnRteIcons.getBoundingClientRect().left;
      pop.style.display = 'flex';
      var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = pop.offsetHeight;
      if (!dom.hasClass(pop, 'active')) {
        this.util.showRtePop(pop, function () {
          if (_this4.builder.opts.toolbar === 'left') {
            pop.style.top = top - h / 2 + 20 + 'px';
            pop.style.left = left + 54 + 'px';
            pop.style.right = 'auto';
          } else if (_this4.builder.opts.toolbar === 'right') {
            pop.style.top = top - h / 2 + 20 + 'px';
            pop.style.left = 'auto';
            var viewportWidth = document.body.clientWidth; //window.innerWidth;
            pop.style.right = viewportWidth - left + 9 + 'px';
          } else {
            pop.style.top = top + 54 - 6 + 'px';
            pop.style.left = left - w / 2 + 23 + 'px';
            pop.style.right = 'auto';
            if (btnRteIcons.getBoundingClientRect().left + 45 - parseInt(_this4.rteTool.style.left) < pop.offsetWidth) {
              pop.style.left = parseInt(_this4.rteTool.style.left) + 'px';
            } else if (parseInt(_this4.rteTool.style.left) + _this4.rteTool.offsetWidth - btnRteIcons.getBoundingClientRect().left + 45 < pop.offsetWidth) {
              pop.style.left = parseInt(_this4.rteTool.style.left) + _this4.rteTool.offsetWidth - w + 'px';
            } else {
              // Do Nothing
            }
            // if(dom.hasClass(this.builder.inspectedElement,'icon')) {
            //     pop.style.left = (parseInt(this.rteTool.style.left) + this.rteTool.offsetWidth - w) + 'px';
            // }
          }

          if (dom.parentsHasClass(btnRteIcons, 'rte-more-options')) {
            // Adjustment if button is placed on 2nd bar (div.rte-more-options)
            if (_this4.builder.opts.toolbar === 'left') {
              pop.style.top = parseInt(_this4.rteMoreOptions.style.top) + _this4.rteMoreOptions.offsetHeight - h + 'px';
              pop.style.left = left + 54 + 'px';
              pop.style.right = 'auto';
            } else if (_this4.builder.opts.toolbar === 'right') {
              pop.style.top = parseInt(_this4.rteMoreOptions.style.top) + _this4.rteMoreOptions.offsetHeight - h + 'px';
              pop.style.left = 'auto';
              var _viewportWidth8 = document.body.clientWidth; //window.innerWidth;
              pop.style.right = _viewportWidth8 - left + 9 + 'px';
            } else {
              pop.style.top = top + 54 - 6 + 'px';
              if (btnRteIcons.getBoundingClientRect().left + 45 - parseInt(_this4.rteMoreOptions.style.left) < pop.offsetWidth) {
                pop.style.left = parseInt(_this4.rteMoreOptions.style.left) + 'px';
              } else if (parseInt(_this4.rteMoreOptions.style.left) + _this4.rteMoreOptions.offsetWidth - btnRteIcons.getBoundingClientRect().left + 45 < pop.offsetWidth) {
                pop.style.left = parseInt(_this4.rteMoreOptions.style.left) + _this4.rteMoreOptions.offsetWidth - w + 'px';
              } else {
                // Do Nothing
              }
              if (dom.hasClass(_this4.builder.inspectedElement, 'icon')) {
                pop.style.left = parseInt(_this4.rteMoreOptions.style.left) + _this4.rteMoreOptions.offsetWidth - w + 'px';
              }
              pop.style.right = 'auto';
            }
          }
        }, btnRteIcons);
        var inpIconSearch = this.rteIconOptions.querySelector('#inpRteIconSearch');
        inpIconSearch.focus();
      } else {
        this.util.hideRtePop(pop);
      }
    }
  }, {
    key: "showRteMore",
    value: function showRteMore() {
      var dom = this.dom;
      var pop = this.rteMoreOptions;
      if (!dom.hasClass(pop, 'active')) {
        this.positionRteMore();
        dom.removeClass(pop, 'deactive');
        dom.addClass(pop, 'active');
        // this.util.showRtePop(pop, ()=>{}, btn);
      } else {
        dom.removeClass(pop, 'active');
        dom.addClass(pop, 'deactive');
        // this.util.hideRtePop(pop);
      }
    }
  }, {
    key: "positionRteMore",
    value: function positionRteMore() {
      var top;
      var left;
      var btnRteMore = this.rteTool.querySelectorAll('button.rte-more');
      var btnWidth = 0;
      btnRteMore.forEach(function (btn) {
        if (btn.getBoundingClientRect().top > 0) {
          top = btn.getBoundingClientRect().top;
          left = btn.getBoundingClientRect().left;
          btnWidth = btn.offsetWidth;
        }
      });
      var pop = this.rteMoreOptions;
      pop.style.display = 'flex';
      var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = pop.offsetHeight;
      if (this.builder.opts.toolbar === 'left') {
        pop.style.top = parseFloat(this.rteTool.style.top) + this.rteTool.offsetHeight - h + 'px'; //(top - (h/2) + 20) + 'px';
        pop.style.left = left + 54 + 'px';
        pop.style.right = 'auto';
      } else if (this.builder.opts.toolbar === 'right') {
        pop.style.top = parseFloat(this.rteTool.style.top) + this.rteTool.offsetHeight - h + 'px'; //(top - (h/2) + 20) + 'px';
        pop.style.left = 'auto';
        var viewportWidth = document.body.clientWidth; //window.innerWidth;
        pop.style.right = viewportWidth - left + 9 + 'px';
      } else {
        var adj = 0;
        pop.style.top = top + 54 - 6 + 'px';
        pop.style.left = parseFloat(this.rteTool.style.left) + this.rteTool.offsetWidth - w + adj + 'px'; //(left -(w/2)+23) + 'px';
        pop.style.right = 'auto';
        if (this.builderStuff.hasAttribute('toolbarfull')) {
          pop.style.left = left - w + btnWidth + 'px';
        }
      }
    }

    // showElementRteMore() {
    //     const btnElementRteMore = this.elementRteTool.querySelector('button.rte-more'); 
    //     const pop = this.elementRteMoreOptions;
    //     const top = btnElementRteMore.getBoundingClientRect().top; // + window.pageYOffset;
    //     const left = btnElementRteMore.getBoundingClientRect().left; // + window.pageXOffset;
    //     pop.style.display = 'flex';
    //     const w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
    //     const h = pop.offsetHeight;

    //     if(!dom.hasClass(pop,'active')){  
    //         if(this.builder.opts.toolbar === 'left') {
    //             pop.style.top = (parseInt(this.elementRteTool.style.top) + this.elementRteTool.offsetHeight - h) + 'px'; //(top - (h/2) + 20) + 'px';
    //             pop.style.left = (left + 54) + 'px';     
    //             pop.style.right = 'auto';              
    //         } else if(this.builder.opts.toolbar === 'right') {
    //             pop.style.top = (parseInt(this.elementRteTool.style.top) + this.elementRteTool.offsetHeight - h) + 'px'; //(top - (h/2) + 20) + 'px';
    //             pop.style.left = 'auto';
    //             const viewportWidth = document.body.clientWidth;//window.innerWidth;
    //             pop.style.right = (viewportWidth - left + 9) + 'px';  
    //         } else {
    //             pop.style.top = (top + 54 - 6) + 'px';
    //             pop.style.left = (parseInt(this.elementRteTool.style.left) + this.elementRteTool.offsetWidth - w) + 'px'; //(left -(w/2)+23) + 'px';
    //             pop.style.right = 'auto';   
    //         }

    //         dom.removeClass(pop,'deactive');
    //         dom.addClass(pop, 'active');  
    //     } else {
    //         dom.removeClass(pop,'active');
    //         dom.addClass(pop, 'deactive');
    //     }
    // }
  }, {
    key: "showElementRteMore",
    value: function showElementRteMore() {
      var dom = this.dom;
      var pop = this.elementRteMoreOptions;
      if (!dom.hasClass(pop, 'active')) {
        this.positionElementRteMore();
        dom.removeClass(pop, 'deactive');
        dom.addClass(pop, 'active');
        // this.util.showRtePop(pop, ()=>{}, btn);
      } else {
        dom.removeClass(pop, 'active');
        dom.addClass(pop, 'deactive');
        // this.util.hideRtePop(pop);
      }
    }
  }, {
    key: "positionElementRteMore",
    value: function positionElementRteMore() {
      var btnElementRteMore = this.elementRteTool.querySelector('button.rte-more');
      var pop = this.elementRteMoreOptions;
      var top = btnElementRteMore.getBoundingClientRect().top;
      var left = btnElementRteMore.getBoundingClientRect().left;
      pop.style.display = 'flex';
      var w = pop.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
      var h = pop.offsetHeight;
      if (this.builder.opts.toolbar === 'left') {
        pop.style.top = parseFloat(this.elementRteTool.style.top) + this.elementRteTool.offsetHeight - h + 'px'; //(top - (h/2) + 20) + 'px';
        pop.style.left = left + 54 + 'px';
        pop.style.right = 'auto';
      } else if (this.builder.opts.toolbar === 'right') {
        pop.style.top = parseFloat(this.elementRteTool.style.top) + this.elementRteTool.offsetHeight - h + 'px'; //(top - (h/2) + 20) + 'px';
        pop.style.left = 'auto';
        var viewportWidth = document.body.clientWidth; //window.innerWidth;
        pop.style.right = viewportWidth - left + 9 + 'px';
      } else {
        var adj = 0;
        pop.style.top = top + 54 - 6 + 'px';
        pop.style.left = parseFloat(this.elementRteTool.style.left) + this.elementRteTool.offsetWidth - w + adj + 'px'; //(left -(w/2)+23) + 'px';
        pop.style.right = 'auto';
        if (this.builderStuff.hasAttribute('toolbarfull')) {
          pop.style.left = left - w + btnElementRteMore.offsetWidth + 'px';
        }
      }
    }
  }, {
    key: "applyInlineFontSize",
    value: function applyInlineFontSize(elm, num) {
      var dom = this.dom;
      var currentFontSize = Number(window.getComputedStyle(elm).getPropertyValue('font-size').match(/\d+/)[0]);
      var fontsize;
      if (num === '+') {
        fontsize = currentFontSize + 1 + 'px';
      } else if (num === '-') {
        fontsize = currentFontSize - 1 + 'px';
      } else if (num === '') {
        fontsize = '';
      } else {
        fontsize = num + 'px';
      }
      /** mod by Jack */
      //elm.style.fontSize = fontsize;
      dom.doFunction(elm, function (theEl) {
        theEl.style.fontSize = fontsize;
      }, true);
    }
  }, {
    key: "applyClassFontSize",
    value: function applyClassFontSize(elm, num) {
      var prefix = '';
      var screenMode = this.builder.screenMode;
      if (screenMode === 'desktop') {
        prefix = '';
      } else if (screenMode === 'tablet-landscape') {
        prefix = 'md-';
      } else if (screenMode === 'tablet') {
        prefix = 'sm-';
      } else if (screenMode === 'mobile') {
        prefix = 'xs-';
      }
      var dom = this.dom;
      var currentFontSize = Number(window.getComputedStyle(elm).getPropertyValue('font-size').match(/\d+/)[0]);
      var classname = '';
      if (num === '+' || num === '-' || num === '') classname = num;else classname = prefix + 'size-' + num;
      var arrSizes = this.builder.opts.fontSizeClassValues;

      // Get current class size & remove all class size from the element
      var currentClassSize = '';
      for (var i = 0; i <= arrSizes.length - 1; i++) {
        if (dom.hasClass(elm, prefix + 'size-' + arrSizes[i])) {
          (function () {
            currentClassSize = prefix + 'size-' + arrSizes[i];
            /** mod by Jack */
            //dom.removeClass(elm, 'size-'+arrSizes[i]);
            var n = arrSizes[i];
            dom.doFunction(elm, function (theEl) {
              dom.removeClass(theEl, prefix + 'size-' + n);
            }, true);
          })();
        } else {
          (function () {
            /** mod by Jack */
            var n = arrSizes[i];
            dom.doFunction(elm, function (theEl) {
              dom.removeClass(theEl, prefix + 'size-' + n);
            }, true);
          })();
        }
      }

      // If no class size found AND + or - is clicked, get equivalent class size
      if (currentClassSize === '' && (classname === '+' || classname === '-')) {
        for (i = 0; i <= arrSizes.length - 1; i++) {
          if (currentFontSize >= arrSizes[i] & currentFontSize < arrSizes[i + 1]) {
            currentClassSize = prefix + 'size-' + arrSizes[i];
          }
        }
      }
      if (classname === '+') {
        i = currentClassSize.replace(prefix + 'size-', '') * 1;
        var idx = arrSizes.indexOf(i);
        if (idx < arrSizes.length - 1) {
          currentClassSize = prefix + 'size-' + arrSizes[idx + 1];
        }
        /** mod by Jack */
        //dom.addClass(elm, currentClassSize);
        dom.doFunction(elm, function (theEl) {
          dom.addClass(theEl, currentClassSize);
        }, true);
      } else if (classname === '-') {
        i = currentClassSize.replace(prefix + 'size-', '') * 1;
        idx = arrSizes.indexOf(i);
        if (idx >= 1) {
          currentClassSize = prefix + 'size-' + arrSizes[idx - 1];
        }
        /** mod by Jack */
        //dom.addClass(elm, currentClassSize);
        dom.doFunction(elm, function (theEl) {
          dom.addClass(theEl, currentClassSize);
        }, true);
      } else if (classname === '') {
        // all current class size already removed
      } else {
        /** mod by Jack */
        //dom.addClass(elm, classname);
        dom.doFunction(elm, function (theEl) {
          dom.addClass(theEl, classname);
        }, true);
      }

      /** mod by Jack */
      //elm.style.fontSize = '';
      dom.doFunction(elm, function (theEl) {
        theEl.style.fontSize = '';
      }, true);
      dom.cleanClassSize(elm, classname);
      // dom.cleanUnusedSpan(elm); // will remove empty spans that makes selection changes
    }
  }, {
    key: "applyClassFontWeight",
    value: function applyClassFontWeight(elm, num) {
      var dom = this.dom;
      var classes = this.builder.cssClasses.fontWeight;
      var _loop = function _loop(i) {
        var className = Object.values(classes)[i];
        if (dom.hasClass(elm, className)) {
          dom.removeClass(elm, className);
        }
        dom.doFunction(elm, function (theEl) {
          if (dom.hasClass(theEl, className)) {
            dom.removeClass(theEl, className);
          }
        }, true);
      };
      for (var i = 0; i < Object.keys(classes).length; i++) {
        _loop(i);
      }
      var classname = '';
      if (num === '100') classname = this.builder.cssClasses.fontWeight.thin;
      if (num === '200') classname = this.builder.cssClasses.fontWeight.extralight;
      if (num === '300') classname = this.builder.cssClasses.fontWeight.light;
      if (num === '400') classname = this.builder.cssClasses.fontWeight.normal;
      if (num === '500') classname = this.builder.cssClasses.fontWeight.medium;
      if (num === '600') classname = this.builder.cssClasses.fontWeight.semibold;
      if (num === '700') classname = this.builder.cssClasses.fontWeight.bold;
      if (num === '800') classname = this.builder.cssClasses.fontWeight.extrabold;
      if (num === '900') classname = this.builder.cssClasses.fontWeight.black;
      if (classname === '') {
        // all current class weight already removed
      } else {
        dom.addClass(elm, classname);
      }
      dom.doFunction(elm, function (theEl) {
        theEl.style.fontWeight = '';
      }, true);
      dom.cleanClassSize(elm, classname);
      // dom.cleanUnusedSpan(elm); // will remove empty spans that makes selection changes
    }
  }, {
    key: "hideAlignButtons",
    value: function hideAlignButtons() {
      var btns = this.elementRteTool.querySelectorAll('button[data-align]');
      var separator1;
      var separator2;
      Array.prototype.forEach.call(btns, function (btn) {
        btn.style.display = 'none';
        if (btn.previousElementSibling) {
          if (btn.previousElementSibling.classList.contains('rte-separator')) {
            separator1 = btn.previousElementSibling;
          }
        }
        if (btn.nextElementSibling) {
          if (btn.nextElementSibling.classList.contains('rte-separator')) {
            separator2 = btn.nextElementSibling;
          }
        }
      });
      if (separator1 && separator2) {
        separator2.style.display = 'none';
      }
      btns = this.elementRteMoreOptions.querySelectorAll('button[data-align]'); //new
      Array.prototype.forEach.call(btns, function (btn) {
        btn.style.display = 'none';
      });
    }
  }, {
    key: "hideBlockButtons",
    value: function hideBlockButtons() {
      var elms = this.elementRteTool.querySelectorAll('.rte-group');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      elms = this.elementRteTool.querySelectorAll('.rte-ungroup');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      elms = this.elementRteTool.querySelectorAll('.rte-duplicate');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      elms = this.elementRteTool.querySelectorAll('.rte-front');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      elms = this.elementRteTool.querySelectorAll('.rte-backward');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      elms = this.elementRteTool.querySelectorAll('.rte-moveup');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      elms = this.elementRteTool.querySelectorAll('.rte-movedown');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      elms = this.elementRteTool.querySelectorAll('.rte-delete');
      Array.prototype.forEach.call(elms, function (elm) {
        elm.style.display = 'none';
      });
      // elms = this.elementRteTool.querySelectorAll('.rte-blocksettings'); 
      // Array.prototype.forEach.call(elms, (elm) => {
      //     elm.style.display = 'none';
      // });
    }
  }, {
    key: "showAlignButtons",
    value: function showAlignButtons() {
      var separators = this.elementRteTool.querySelectorAll('.rte-separator');
      Array.prototype.forEach.call(separators, function (separator) {
        separator.style.display = '';
      });
      var btns = this.elementRteTool.querySelectorAll('button[data-align]');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.style.display = '';
      });
      btns = this.elementRteMoreOptions.querySelectorAll('button[data-align]'); //new
      Array.prototype.forEach.call(btns, function (btn) {
        btn.style.display = '';
      });
    }
  }, {
    key: "showDefaultToolbar",
    value: function showDefaultToolbar() {
      if (this.builder.controlPanel) return;
      this.elementRteTool.style.display = 'flex';
      this.rteTool.style.display = 'none';
      this.hideAlignButtons();
      this.positionToolbar();
    }
  }, {
    key: "click",
    value: function click(col) {
      var dom = this.dom;
      var elm = this.builder.inspectedElement;
      this.rteTool.style.display = 'none';
      this.elementRteTool.style.display = 'none';
      var noedit = false;
      if (col.hasAttribute('data-noedit')) {
        // Column is not (text) editable.
        noedit = true;
      }
      var _protected = false;
      if (col.hasAttribute('data-protected')) {
        // Column is not (text) editable and also: cannot be deleted, moved or duplicated.
        _protected = true;
      }
      var customcode = false;
      var subblock = false;
      if (col.hasAttribute('data-html')) {
        // Column contains custom code.
        customcode = true;
        if (elm.closest('.is-subblock')) {
          // dom.parentsHasAttribute(elm, 'data-subblock')
          subblock = true;
        }
      }
      if (this.builder.canvas) this.hideBlockButtons();

      // default state
      var toolbarText = this.rteTool.querySelector('.rte-for-text');
      var toolbarIcon = this.rteTool.querySelector('.rte-for-icon');
      toolbarText.style.display = 'flex';
      toolbarIcon.style.display = 'none';
      var toolbarMoreText = this.rteMoreOptions.querySelector('.rte-for-text');
      var toolbarMoreIcon = this.rteMoreOptions.querySelector('.rte-for-icon');
      toolbarMoreText.style.display = 'flex';
      toolbarMoreIcon.style.display = 'none';
      var btnIcon = toolbarIcon.querySelector('.rte-icon');
      var btnTextSettings = toolbarIcon.querySelector('.rte-textsettings');
      var btnLink = toolbarIcon.querySelector('.rte-link');
      var btnSymbol = toolbarMoreIcon.querySelector('.insertsymbol-button');
      if (btnIcon) btnIcon.style.display = '';
      if (btnTextSettings) btnTextSettings.style.display = '';
      if (btnLink) btnLink.style.display = '';
      if (btnSymbol) btnSymbol.style.display = '';
      if (!customcode && !noedit && !_protected || subblock) {
        if ((elm.tagName.toLowerCase() === 'img' || dom.hasClass(elm, 'is-social') || dom.hasClass(elm, 'is-rounded-button-medium') || dom.hasClass(elm, 'cell-active')) && !dom.getSelected()) {
          if (this.elementRteTool.style.display === 'none' || this.elementRteTool.style.display === '') {
            this.elementRteTool.style.display = 'flex';
            this.rteTool.style.display = 'none';
            this.showAlignButtons();
            this.positionToolbar();
          }
        } else if (dom.hasClass(elm, 'spacer') || elm.tagName.toLowerCase() === 'video' || dom.hasClass(elm, 'ovl') || col.getAttribute('data-html') && !subblock) {
          //|| col===elm

          if (this.elementRteTool.style.display === 'none' || this.elementRteTool.style.display === '') {
            this.elementRteTool.style.display = 'flex';
            this.rteTool.style.display = 'none';
            this.hideAlignButtons();
            this.positionToolbar();
          }
        } else if (dom.hasClass(elm, 'icon') || dom.hasClass(elm, 'bi')) {
          if (this.rteTool.style.display === 'none' || this.rteTool.style.display === '') {
            this.rteTool.style.display = 'flex';
            this.elementRteTool.style.display = 'none';
            toolbarText.style.display = 'none';
            toolbarIcon.style.display = 'flex';
            toolbarMoreText.style.display = 'none';
            toolbarMoreIcon.style.display = 'flex';
            if (btnSymbol) btnSymbol.style.display = 'none';
            this.positionToolbar();
          }
        } else if (elm.closest('svg')) {
          if (this.rteTool.style.display === 'none' || this.rteTool.style.display === '') {
            this.rteTool.style.display = 'flex';
            this.elementRteTool.style.display = 'none';
            toolbarText.style.display = 'none';
            toolbarIcon.style.display = 'flex';
            toolbarMoreText.style.display = 'none';
            toolbarMoreIcon.style.display = 'flex';
            if (btnIcon) btnIcon.style.display = 'none';
            if (btnTextSettings) btnTextSettings.style.display = 'none';
            if (btnLink) btnLink.style.display = 'none';
            if (btnSymbol) btnSymbol.style.display = 'none';
            this.positionToolbar();
          }
        } else {
          if (dom.textSelection()) {
            if (this.rteTool.style.display === 'none' || this.rteTool.style.display === '') {
              this.rteTool.style.display = 'flex';
              this.elementRteTool.style.display = 'none';
              this.positionToolbar();
            }
          } else {
            if (this.elementRteTool.style.display === 'none' || this.elementRteTool.style.display === '') {
              this.elementRteTool.style.display = 'flex';
              this.rteTool.style.display = 'none';
              this.showAlignButtons();
              this.positionToolbar();
            }
          }
        }
      } else {
        if (this.elementRteTool.style.display === 'none' || this.elementRteTool.style.display === '') {
          this.elementRteTool.style.display = 'flex';
          this.rteTool.style.display = 'none';
          this.hideAlignButtons();
          this.positionToolbar();
        }
      }
      this.util.saveSelection();
      this.getState();
    }
  }, {
    key: "getState",
    value: function getState() {
      // old 14140

      var dom = this.dom;
      if (this.builder.doc.queryCommandState('bold')) {
        dom.addClass(this.rteTool.querySelector('button[data-command=bold]'), 'on');
      } else {
        dom.removeClass(this.rteTool.querySelector('button[data-command=bold]'), 'on');
      }
      if (this.builder.doc.queryCommandState('italic')) {
        dom.addClass(this.rteTool.querySelector('button[data-command=italic]'), 'on');
      } else {
        dom.removeClass(this.rteTool.querySelector('button[data-command=italic]'), 'on');
      }
      if (this.builder.doc.queryCommandState('underline')) {
        dom.addClass(this.rteTool.querySelector('button[data-command=underline]'), 'on');
      } else {
        dom.removeClass(this.rteTool.querySelector('button[data-command=underline]'), 'on');
      }
      if (this.builder.doc.queryCommandState('strikethrough')) {
        dom.addClass(this.rteFormattingOptions.querySelector('[data-command=strikethrough]'), 'on');
      } else {
        dom.removeClass(this.rteFormattingOptions.querySelector('[data-command=strikethrough]'), 'on');
      }
      if (this.builder.doc.queryCommandState('superscript')) {
        dom.addClass(this.rteFormattingOptions.querySelector('[data-command=superscript]'), 'on');
      } else {
        dom.removeClass(this.rteFormattingOptions.querySelector('[data-command=superscript]'), 'on');
      }
      if (this.builder.doc.queryCommandState('subscript')) {
        dom.addClass(this.rteFormattingOptions.querySelector('[data-command=subscript]'), 'on');
      } else {
        dom.removeClass(this.rteFormattingOptions.querySelector('[data-command=subscript]'), 'on');
      }
      var elm = dom.textSelection();
      if (elm) {
        if (elm.style.textTransform === 'uppercase') {
          dom.addClass(this.rteFormattingOptions.querySelector('[data-command=uppercase]'), 'on');
        } else {
          dom.removeClass(this.rteFormattingOptions.querySelector('[data-command=uppercase]'), 'on');
        }
      } else {
        // Do Nothing
        // return; // Without this, the line below generates error on first image click (FF). In addition, getState is for text. 
      }

      // Alignment
      this.rteAlignOptions.querySelectorAll('[data-align]').forEach(function (elm) {
        return elm.classList.remove('on');
      });
      if (this.builder.doc.queryCommandState('JustifyFull')) {
        this.rteAlignOptions.querySelector('button[data-align=justify]').classList.add('on');
      }
      if (this.builder.doc.queryCommandState('JustifyLeft')) {
        this.rteAlignOptions.querySelector('button[data-align=left]').classList.add('on');
      }
      if (this.builder.doc.queryCommandState('JustifyRight')) {
        this.rteAlignOptions.querySelector('button[data-align=right]').classList.add('on');
      }
      if (this.builder.doc.queryCommandState('JustifyCenter')) {
        this.rteAlignOptions.querySelector('button[data-align=center]').classList.add('on');
      }
      var blocks = this.builder.dom.getSelectedBlocks();
      if (blocks.length === 0) {
        var activeElement = this.builder.activeElement;
        if (activeElement) {
          this.rteAlignOptions.querySelectorAll('[data-align]').forEach(function (elm) {
            return elm.classList.remove('on');
          });
          if (activeElement.classList.contains('text-left')) {
            this.rteAlignOptions.querySelector('button[data-align=left]').classList.add('on');
          } else if (activeElement.classList.contains('text-center')) {
            this.rteAlignOptions.querySelector('button[data-align=center]').classList.add('on');
          } else if (activeElement.classList.contains('text-right')) {
            this.rteAlignOptions.querySelector('button[data-align=right]').classList.add('on');
          } else if (activeElement.classList.contains('text-justify')) {
            this.rteAlignOptions.querySelector('button[data-align=justify]').classList.add('on');
          }
          var btnAlignLeft = this.elementRteTool.querySelector('button[data-align=left]');
          var btnAlignCenter = this.elementRteTool.querySelector('button[data-align=center]');
          var btnAlignRight = this.elementRteTool.querySelector('button[data-align=right]');
          var btnAlignJustify = this.elementRteTool.querySelector('button[data-align=justify]');
          this.elementRteTool.querySelectorAll('[data-align]').forEach(function (elm) {
            return elm.classList.remove('on');
          });
          if (activeElement.classList.contains('text-left')) {
            if (btnAlignLeft) btnAlignLeft.classList.add('on');
          } else if (activeElement.classList.contains('text-center')) {
            if (btnAlignCenter) btnAlignCenter.classList.add('on');
          } else if (activeElement.classList.contains('text-right')) {
            if (btnAlignRight) btnAlignRight.classList.add('on');
          } else if (activeElement.classList.contains('text-justify')) {
            if (btnAlignJustify) btnAlignJustify.classList.add('on');
          }
        }
      }
      var s = this.builder.doc.queryCommandValue('FontName');
      var fontname = s.split(',')[0];
      fontname = fontname.replace(/"/g, '');
      fontname = fontname.replace(/'/g, ''); //NEW 4.0.5
      fontname = fontname.replace(/&quot;/g, ''); //NEW 4.0.5
      fontname = fontname.trim().toLowerCase();
      var btnRteFontFamily = this.rteTool.querySelector('button.rte-fontfamily');
      btnRteFontFamily = btnRteFontFamily ? btnRteFontFamily : this.rteMoreOptions.querySelector('button.rte-fontfamily');
      if (btnRteFontFamily) {
        var divFontList = this.rteFontFamilyOptions.querySelector('.div-font-list');
        var _btns = this.rteFontFamilyOptions.querySelectorAll('.div-font-list button');
        _btns.forEach(function (btn) {
          var f = btn.getAttribute('data-font-family');
          f = f.split(',')[0];
          f = f.replace(/'/g, ''); // NEW 4.0.5
          f = f.trim().toLowerCase();
          if (f === fontname && f !== '') {
            btn.classList.add('on');
            var scrollTopPosition = btn.offsetTop - divFontList.offsetTop;
            divFontList.scrollTop = scrollTopPosition;
          } else {
            btn.classList.remove('on');
          }
        });
      }
      var btns = this.rteParagraphOptions.querySelectorAll('[data-block]');
      Array.prototype.forEach.call(btns, function (btn) {
        dom.removeClass(btn, 'on');
      });
      var block = this.builder.doc.queryCommandValue('FormatBlock');
      block = block.toLowerCase();
      if (block === 'normal') block = 'p';
      if (block === 'heading 1') block = 'h1';
      if (block === 'heading 2') block = 'h2';
      if (block === 'heading 3') block = 'h3';
      if (block === 'heading 4') block = 'h4';
      if (block === 'formatted') block = 'pre';
      if (block === 'p' || block === 'h1' || block === 'h2' || block === 'h3' || block === 'h4' || block === 'div' || block === 'pre') {
        dom.addClass(this.rteParagraphOptions.querySelector('[data-block="' + block + '"]'), 'on');
      }
    }
  }, {
    key: "getTextSettingsState",
    value: function getTextSettingsState() {
      var _this5 = this;
      var prefix = '';
      var screenMode = this.builder.screenMode;
      if (screenMode === 'desktop') {
        prefix = '';
      } else if (screenMode === 'tablet-landscape') {
        prefix = 'md-';
      } else if (screenMode === 'tablet') {
        prefix = 'sm-';
      } else if (screenMode === 'mobile') {
        prefix = 'xs-';
      }
      var dom = this.dom;
      var pop = this.rteTextSettingOptions;

      // Get realtime status
      var selection = dom.getSelection();
      if (!selection) return;
      var anchorNode = selection.anchorNode;
      var container;
      if (anchorNode) {
        container = anchorNode.nodeType !== Node.TEXT_NODE && anchorNode.nodeType !== Node.COMMENT_NODE ? anchorNode : anchorNode.parentElement;
      }
      var btns = pop.querySelectorAll('.rte-fontsize-options button');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.classList.remove('on'); // clear selection
      });

      if (!container && this.builder.activeIcon) {
        container = this.builder.activeIcon;
      }
      if (container) {
        (function () {
          var arrSizes = _this5.builder.opts.fontSizeClassValues;
          var found = false;
          // Check if size is defined for specific screenMode
          if (prefix !== '') {
            var _loop2 = function _loop2(i) {
              if (dom.hasClass(container, prefix + 'size-' + arrSizes[i])) {
                // Get current class

                found = true;
                var _btns2 = pop.querySelectorAll('.rte-fontsize-options button');
                Array.prototype.forEach.call(_btns2, function (btn) {
                  var num = btn.getAttribute('data-value');
                  if (parseInt(num) === arrSizes[i]) {
                    btn.classList.add('on');
                  }
                });
              }
            };
            for (var i = 0; i <= arrSizes.length - 1; i++) {
              _loop2(i);
            }
          }
          if (!found) {
            var _loop3 = function _loop3(_i) {
              if (dom.hasClass(container, 'size-' + arrSizes[_i])) {
                // Get current class
                var _btns3 = pop.querySelectorAll('.rte-fontsize-options button');
                Array.prototype.forEach.call(_btns3, function (btn) {
                  var num = btn.getAttribute('data-value');
                  if (parseInt(num) === arrSizes[_i]) {
                    btn.classList.add('on');
                  }
                });
              }
            };
            // Use default (desktop) defined size
            for (var _i = 0; _i <= arrSizes.length - 1; _i++) {
              _loop3(_i);
            }
          }
        })();
      }
      btns = pop.querySelectorAll('.rte-fontweight-options button');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.classList.remove('on'); // clear selection
      });

      if (container) {
        (function () {
          var classes = _this5.builder.cssClasses.fontWeight;
          var _loop4 = function _loop4(i) {
            var className = Object.values(classes)[i];
            if (dom.hasClass(container, className)) {
              var _btns4 = pop.querySelectorAll('.rte-fontweight-options button');
              Array.prototype.forEach.call(_btns4, function (btn) {
                var num = btn.getAttribute('data-value');
                var val;
                if (className === classes.thin) val = '100';
                if (className === classes.extralight) val = '200';
                if (className === classes.light) val = '300';
                if (className === classes.normal) val = '400';
                if (className === classes.medium) val = '500';
                if (className === classes.semibold) val = '600';
                if (className === classes.bold) val = '700';
                if (className === classes.extrabold) val = '800';
                if (className === classes.black) val = '900';
                if (num === val) {
                  btn.classList.add('on');
                }
              });
            }
          };
          for (var i = 0; i < Object.keys(classes).length; i++) {
            _loop4(i);
          }
        })();
      }
      btns = pop.querySelectorAll('.rte-lineheight-options button');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.classList.remove('on'); // clear selection
      });

      var block = dom.getParentBlock(container);
      if (block) {
        (function () {
          var classes = _this5.builder.cssClasses.leading;
          var _loop5 = function _loop5(i) {
            var className = Object.values(classes)[i];
            if (dom.hasClass(block, className)) {
              var _btns5 = pop.querySelectorAll('.rte-lineheight-options button');
              Array.prototype.forEach.call(_btns5, function (btn) {
                var num = btn.getAttribute('data-value');
                var val;
                if (className === classes.leading_8) val = '0.8';
                if (className === classes.leading_9) val = '0.9';
                if (className === classes.leading_10) val = '1';
                if (className === classes.leading_11) val = '1.1';
                if (className === classes.leading_12) val = '1.2';
                if (className === classes.leading_13) val = '1.3';
                if (className === classes.leading_14) val = '1.4';
                if (className === classes.leading_15) val = '1.5';
                if (className === classes.leading_16) val = '1.6';
                if (className === classes.leading_17) val = '1.7';
                if (className === classes.leading_18) val = '1.8';
                if (className === classes.leading_19) val = '1.9';
                if (className === classes.leading_20) val = '2';
                if (className === classes.leading_21) val = '2.1';
                if (className === classes.leading_22) val = '2.2';
                if (num === val) {
                  btn.classList.add('on');
                }
              });
            }
          };
          for (var i = 0; i < Object.keys(classes).length; i++) {
            _loop5(i);
          }
        })();
      }
      btns = pop.querySelectorAll('.rte-letterspacing-options button');
      Array.prototype.forEach.call(btns, function (btn) {
        btn.classList.remove('on'); // clear selection
      });

      if (container) {
        (function () {
          var classes = _this5.builder.cssClasses.tracking;
          var _loop6 = function _loop6(i) {
            var className = Object.values(classes)[i];
            if (dom.hasClass(container, className)) {
              var _btns6 = pop.querySelectorAll('.rte-letterspacing-options button');
              Array.prototype.forEach.call(_btns6, function (btn) {
                var num = btn.getAttribute('data-value');
                var val;
                if (className === classes.tracking_025) val = '1';
                if (className === classes.tracking_050) val = '2';
                if (num === val) {
                  btn.classList.add('on');
                }
              });
            }
          };
          for (var i = 0; i < Object.keys(classes).length; i++) {
            _loop6(i);
          }
        })();
      }
      // /Get realtime status
    }
  }, {
    key: "getIconsStyle",
    value: function getIconsStyle() {
      var css = "\n            html, body {height:100%}\n            body {overflow:hidden;margin:0;\n                font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n                font-size:100%; \n                line-height:1.7;\n            }\n            button {\n                border: none;\n                background: transparent;\n                border-radius: 1px;\n            }\n            #divIcons {display:flex;align-content:flex-start;flex-direction:row;flex-wrap:wrap;margin:0;padding:9px 11px 9px 9px;height:100%;overflow-y:scroll !important;box-sizing:border-box;}\n            #divIcons > button {\n                width:38px;height:36px;font-size:14px;cursor:pointer;overflow:hidden;\n                text-align:center;position:relative;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                margin: 1px;\n            }                \n            // #divIcons > button:hover {background:#f5f5f5;}\n\n            #divIcons {\n                background: ".concat(this.builder.styleToolBackground, ";\n            }\n            #divIcons > button {\n                color: ").concat(this.builder.styleButtonColor, ";\n            }\n            #divIcons > button * {\n                pointer-events: none;\n            }\n            #divIcons > button svg {\n                fill: ").concat(this.builder.styleButtonSvgFill, ";\n            }\n\n            #divIcons > button:hover {\n                background: ").concat(this.builder.styleButtonBackgroundHover, ";\n            }\n            #divIcons > button:focus {\n                // outline: ").concat(this.builder.styleOutlineColor, " 2px solid;\n                outline: none;\n                background: ").concat(this.builder.styleButtonBackgroundHover, ";\n            }\n\n            input[type=text] {\n                width: 100%;\n                height: 35px;\n                box-sizing: border-box;\n                margin: 0;\n                font-family: sans-serif;\n                font-size: 15px;\n                letter-spacing: 1px;\n                padding: 0;\n                padding-left: 10px;\n                color: ").concat(this.builder.styleRteInputColor, ";\n                display: inline-block;\n                border: none;\n                border-bottom: none;\n                border-radius: 1px;\n                background-color: ").concat(this.builder.styleInputBackground, ";\n            }\n            input[type=text]:focus {\n                outline: #3e93f7 2px solid;\n                outline-offset: -2px;\n            }\n            ::placeholder {\n                color: ").concat(this.builder.styleRteInputColor, ";\n            }\n\n            .dark #divIcons > button {\n                opacity: 0.93;\n            }\n\n            /* Scrollbar for toolbar/RTE, not modal */\n\n            .dark * {\n                scrollbar-width: thin;\n                scrollbar-color: rgba(255, 255, 255, 0.3) auto;\n            }\n            .dark *::-webkit-scrollbar {\n                width: 12px;\n            }\n            .dark *::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .dark *::-webkit-scrollbar-thumb {\n                background-color:rgba(255, 255, 255, 0.3);\n            } \n\n            .colored-dark * {\n                scrollbar-width: thin;\n                scrollbar-color: rgb(100, 100, 100) auto;\n            }\n            .colored-dark *::-webkit-scrollbar {\n                width: 12px;\n            }\n            .colored-dark *::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .colored-dark *::-webkit-scrollbar-thumb {\n                background-color:rgb(100, 100, 100);\n            } \n\n            .colored * {\n                scrollbar-width: thin;\n                scrollbar-color: rgba(0, 0, 0, 0.4) auto;\n            }\n            .colored *::-webkit-scrollbar {\n                width: 12px;\n            }\n            .colored *::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .colored *::-webkit-scrollbar-thumb {\n                background-color: rgba(0, 0, 0, 0.4);\n            } \n\n            .light * {\n                scrollbar-width: thin;\n                scrollbar-color: rgba(0, 0, 0, 0.4) auto;\n            }\n            .light *::-webkit-scrollbar {\n                width: 12px;\n            }\n            .light *::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .light *::-webkit-scrollbar-thumb {\n                background-color: rgba(0, 0, 0, 0.4);\n            }");
      return css;
    }
  }, {
    key: "getIcons2",
    value: function getIcons2() {
      var html = "\n<button><i class=\"bi bi-123\"></i></button>\n<button><i class=\"bi bi-alarm-fill\"></i></button>\n<button><i class=\"bi bi-alarm\"></i></button>\n<button><i class=\"bi bi-align-bottom\"></i></button>\n<button><i class=\"bi bi-align-center\"></i></button>\n<button><i class=\"bi bi-align-end\"></i></button>\n<button><i class=\"bi bi-align-middle\"></i></button>\n<button><i class=\"bi bi-align-start\"></i></button>\n<button><i class=\"bi bi-align-top\"></i></button>\n<button><i class=\"bi bi-alt\"></i></button>\n<button><i class=\"bi bi-app-indicator\"></i></button>\n<button><i class=\"bi bi-app\"></i></button>\n<button><i class=\"bi bi-archive-fill\"></i></button>\n<button><i class=\"bi bi-archive\"></i></button>\n<button><i class=\"bi bi-arrow-90deg-down\"></i></button>\n<button><i class=\"bi bi-arrow-90deg-left\"></i></button>\n<button><i class=\"bi bi-arrow-90deg-right\"></i></button>\n<button><i class=\"bi bi-arrow-90deg-up\"></i></button>\n<button><i class=\"bi bi-arrow-bar-down\"></i></button>\n<button><i class=\"bi bi-arrow-bar-left\"></i></button>\n<button><i class=\"bi bi-arrow-bar-right\"></i></button>\n<button><i class=\"bi bi-arrow-bar-up\"></i></button>\n<button><i class=\"bi bi-arrow-clockwise\"></i></button>\n<button><i class=\"bi bi-arrow-counterclockwise\"></i></button>\n<button><i class=\"bi bi-arrow-down-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-down-circle\"></i></button>\n<button><i class=\"bi bi-arrow-down-left-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-down-left-circle\"></i></button>\n<button><i class=\"bi bi-arrow-down-left-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-down-left-square\"></i></button>\n<button><i class=\"bi bi-arrow-down-left\"></i></button>\n<button><i class=\"bi bi-arrow-down-right-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-down-right-circle\"></i></button>\n<button><i class=\"bi bi-arrow-down-right-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-down-right-square\"></i></button>\n<button><i class=\"bi bi-arrow-down-right\"></i></button>";
      html += "\n<button><i class=\"bi bi-arrow-down-short\"></i></button>\n<button><i class=\"bi bi-arrow-down-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-down-square\"></i></button>\n<button><i class=\"bi bi-arrow-down-up\"></i></button>\n<button><i class=\"bi bi-arrow-down\"></i></button>\n<button><i class=\"bi bi-arrow-left-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-left-circle\"></i></button>\n<button><i class=\"bi bi-arrow-left-right\"></i></button>\n<button><i class=\"bi bi-arrow-left-short\"></i></button>\n<button><i class=\"bi bi-arrow-left-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-left-square\"></i></button>\n<button><i class=\"bi bi-arrow-left\"></i></button>\n<button><i class=\"bi bi-arrow-repeat\"></i></button>\n<button><i class=\"bi bi-arrow-return-left\"></i></button>\n<button><i class=\"bi bi-arrow-return-right\"></i></button>\n<button><i class=\"bi bi-arrow-right-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-right-circle\"></i></button>\n<button><i class=\"bi bi-arrow-right-short\"></i></button>\n<button><i class=\"bi bi-arrow-right-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-right-square\"></i></button>\n<button><i class=\"bi bi-arrow-right\"></i></button>\n<button><i class=\"bi bi-arrow-up-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-up-circle\"></i></button>\n<button><i class=\"bi bi-arrow-up-left-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-up-left-circle\"></i></button>\n<button><i class=\"bi bi-arrow-up-left-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-up-left-square\"></i></button>\n<button><i class=\"bi bi-arrow-up-left\"></i></button>\n<button><i class=\"bi bi-arrow-up-right-circle-fill\"></i></button>\n<button><i class=\"bi bi-arrow-up-right-circle\"></i></button>\n<button><i class=\"bi bi-arrow-up-right-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-up-right-square\"></i></button>\n<button><i class=\"bi bi-arrow-up-right\"></i></button>\n<button><i class=\"bi bi-arrow-up-short\"></i></button>\n<button><i class=\"bi bi-arrow-up-square-fill\"></i></button>\n<button><i class=\"bi bi-arrow-up-square\"></i></button>\n<button><i class=\"bi bi-arrow-up\"></i></button>\n<button><i class=\"bi bi-arrows-angle-contract\"></i></button>\n<button><i class=\"bi bi-arrows-angle-expand\"></i></button>\n<button><i class=\"bi bi-arrows-collapse\"></i></button>\n<button><i class=\"bi bi-arrows-expand\"></i></button>\n<button><i class=\"bi bi-arrows-fullscreen\"></i></button>\n<button><i class=\"bi bi-arrows-move\"></i></button>\n<button><i class=\"bi bi-aspect-ratio-fill\"></i></button>\n<button><i class=\"bi bi-aspect-ratio\"></i></button>\n<button><i class=\"bi bi-asterisk\"></i></button>\n<button><i class=\"bi bi-at\"></i></button>\n<button><i class=\"bi bi-award-fill\"></i></button>\n<button><i class=\"bi bi-award\"></i></button>\n<button><i class=\"bi bi-back\"></i></button>\n<button><i class=\"bi bi-backspace-fill\"></i></button>\n<button><i class=\"bi bi-backspace-reverse-fill\"></i></button>\n<button><i class=\"bi bi-backspace-reverse\"></i></button>\n<button><i class=\"bi bi-backspace\"></i></button>\n<button><i class=\"bi bi-badge-3d-fill\"></i></button>\n<button><i class=\"bi bi-badge-3d\"></i></button>\n<button><i class=\"bi bi-badge-4k-fill\"></i></button>\n<button><i class=\"bi bi-badge-4k\"></i></button>\n<button><i class=\"bi bi-badge-8k-fill\"></i></button>\n<button><i class=\"bi bi-badge-8k\"></i></button>\n<button><i class=\"bi bi-badge-ad-fill\"></i></button>\n<button><i class=\"bi bi-badge-ad\"></i></button>\n<button><i class=\"bi bi-badge-ar-fill\"></i></button>\n<button><i class=\"bi bi-badge-ar\"></i></button>\n<button><i class=\"bi bi-badge-cc-fill\"></i></button>\n<button><i class=\"bi bi-badge-cc\"></i></button>\n<button><i class=\"bi bi-badge-hd-fill\"></i></button>\n<button><i class=\"bi bi-badge-hd\"></i></button>\n<button><i class=\"bi bi-badge-tm-fill\"></i></button>\n<button><i class=\"bi bi-badge-tm\"></i></button>\n<button><i class=\"bi bi-badge-vo-fill\"></i></button>\n<button><i class=\"bi bi-badge-vo\"></i></button>\n<button><i class=\"bi bi-badge-vr-fill\"></i></button>\n<button><i class=\"bi bi-badge-vr\"></i></button>\n<button><i class=\"bi bi-badge-wc-fill\"></i></button>\n<button><i class=\"bi bi-badge-wc\"></i></button>\n<button><i class=\"bi bi-bag-check-fill\"></i></button>\n<button><i class=\"bi bi-bag-check\"></i></button>\n<button><i class=\"bi bi-bag-dash-fill\"></i></button>\n<button><i class=\"bi bi-bag-dash\"></i></button>\n<button><i class=\"bi bi-bag-fill\"></i></button>\n<button><i class=\"bi bi-bag-plus-fill\"></i></button>\n<button><i class=\"bi bi-bag-plus\"></i></button>\n<button><i class=\"bi bi-bag-x-fill\"></i></button>\n<button><i class=\"bi bi-bag-x\"></i></button>\n<button><i class=\"bi bi-bag\"></i></button>\n<button><i class=\"bi bi-bar-chart-fill\"></i></button>\n<button><i class=\"bi bi-bar-chart-line-fill\"></i></button>\n<button><i class=\"bi bi-bar-chart-line\"></i></button>\n<button><i class=\"bi bi-bar-chart-steps\"></i></button>\n<button><i class=\"bi bi-bar-chart\"></i></button>\n<button><i class=\"bi bi-basket-fill\"></i></button>\n<button><i class=\"bi bi-basket\"></i></button>\n<button><i class=\"bi bi-basket2-fill\"></i></button>\n<button><i class=\"bi bi-basket2\"></i></button>\n<button><i class=\"bi bi-basket3-fill\"></i></button>\n<button><i class=\"bi bi-basket3\"></i></button>\n<button><i class=\"bi bi-battery-charging\"></i></button>\n<button><i class=\"bi bi-battery-full\"></i></button>";
      html += "\n<button><i class=\"bi bi-battery-half\"></i></button>\n<button><i class=\"bi bi-battery\"></i></button>\n<button><i class=\"bi bi-bell-fill\"></i></button>\n<button><i class=\"bi bi-bell\"></i></button>\n<button><i class=\"bi bi-bezier\"></i></button>\n<button><i class=\"bi bi-bezier2\"></i></button>\n<button><i class=\"bi bi-bicycle\"></i></button>\n<button><i class=\"bi bi-binoculars-fill\"></i></button>\n<button><i class=\"bi bi-binoculars\"></i></button>\n<button><i class=\"bi bi-blockquote-left\"></i></button>\n<button><i class=\"bi bi-blockquote-right\"></i></button>\n<button><i class=\"bi bi-book-fill\"></i></button>\n<button><i class=\"bi bi-book-half\"></i></button>\n<button><i class=\"bi bi-book\"></i></button>\n<button><i class=\"bi bi-bookmark-check-fill\"></i></button>\n<button><i class=\"bi bi-bookmark-check\"></i></button>\n<button><i class=\"bi bi-bookmark-dash-fill\"></i></button>\n<button><i class=\"bi bi-bookmark-dash\"></i></button>\n<button><i class=\"bi bi-bookmark-fill\"></i></button>\n<button><i class=\"bi bi-bookmark-heart-fill\"></i></button>\n<button><i class=\"bi bi-bookmark-heart\"></i></button>\n<button><i class=\"bi bi-bookmark-plus-fill\"></i></button>\n<button><i class=\"bi bi-bookmark-plus\"></i></button>\n<button><i class=\"bi bi-bookmark-star-fill\"></i></button>\n<button><i class=\"bi bi-bookmark-star\"></i></button>\n<button><i class=\"bi bi-bookmark-x-fill\"></i></button>\n<button><i class=\"bi bi-bookmark-x\"></i></button>\n<button><i class=\"bi bi-bookmark\"></i></button>\n<button><i class=\"bi bi-bookmarks-fill\"></i></button>\n<button><i class=\"bi bi-bookmarks\"></i></button>\n<button><i class=\"bi bi-bookshelf\"></i></button>\n<button><i class=\"bi bi-bootstrap-fill\"></i></button>\n<button><i class=\"bi bi-bootstrap-reboot\"></i></button>\n<button><i class=\"bi bi-bootstrap\"></i></button>\n<button><i class=\"bi bi-border-all\"></i></button>\n<button><i class=\"bi bi-border-bottom\"></i></button>\n<button><i class=\"bi bi-border-center\"></i></button>\n<button><i class=\"bi bi-border-inner\"></i></button>\n<button><i class=\"bi bi-border-left\"></i></button>\n<button><i class=\"bi bi-border-middle\"></i></button>\n<button><i class=\"bi bi-border-outer\"></i></button>\n<button><i class=\"bi bi-border-right\"></i></button>\n<button><i class=\"bi bi-border-style\"></i></button>\n<button><i class=\"bi bi-border-top\"></i></button>\n<button><i class=\"bi bi-border-width\"></i></button>\n<button><i class=\"bi bi-border\"></i></button>\n<button><i class=\"bi bi-bounding-box-circles\"></i></button>\n<button><i class=\"bi bi-bounding-box\"></i></button>\n<button><i class=\"bi bi-box-arrow-down-left\"></i></button>\n<button><i class=\"bi bi-box-arrow-down-right\"></i></button>\n<button><i class=\"bi bi-box-arrow-down\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-down-left\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-down-right\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-down\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-left\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-right\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-up-left\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-up-right\"></i></button>\n<button><i class=\"bi bi-box-arrow-in-up\"></i></button>\n<button><i class=\"bi bi-box-arrow-left\"></i></button>\n<button><i class=\"bi bi-box-arrow-right\"></i></button>\n<button><i class=\"bi bi-box-arrow-up-left\"></i></button>\n<button><i class=\"bi bi-box-arrow-up-right\"></i></button>\n<button><i class=\"bi bi-box-arrow-up\"></i></button>\n<button><i class=\"bi bi-box-seam\"></i></button>\n<button><i class=\"bi bi-box\"></i></button>\n<button><i class=\"bi bi-braces\"></i></button>\n<button><i class=\"bi bi-bricks\"></i></button>\n<button><i class=\"bi bi-briefcase-fill\"></i></button>\n<button><i class=\"bi bi-briefcase\"></i></button>\n<button><i class=\"bi bi-brightness-alt-high-fill\"></i></button>\n<button><i class=\"bi bi-brightness-alt-high\"></i></button>\n<button><i class=\"bi bi-brightness-alt-low-fill\"></i></button>\n<button><i class=\"bi bi-brightness-alt-low\"></i></button>\n<button><i class=\"bi bi-brightness-high-fill\"></i></button>\n<button><i class=\"bi bi-brightness-high\"></i></button>\n<button><i class=\"bi bi-brightness-low-fill\"></i></button>\n<button><i class=\"bi bi-brightness-low\"></i></button>\n<button><i class=\"bi bi-broadcast-pin\"></i></button>\n<button><i class=\"bi bi-broadcast\"></i></button>\n<button><i class=\"bi bi-brush-fill\"></i></button>\n<button><i class=\"bi bi-brush\"></i></button>\n<button><i class=\"bi bi-bucket-fill\"></i></button>\n<button><i class=\"bi bi-bucket\"></i></button>\n<button><i class=\"bi bi-bug-fill\"></i></button>\n<button><i class=\"bi bi-bug\"></i></button>\n<button><i class=\"bi bi-building\"></i></button>\n<button><i class=\"bi bi-bullseye\"></i></button>\n<button><i class=\"bi bi-calculator-fill\"></i></button>\n<button><i class=\"bi bi-calculator\"></i></button>\n<button><i class=\"bi bi-calendar-check-fill\"></i></button>\n<button><i class=\"bi bi-calendar-check\"></i></button>\n<button><i class=\"bi bi-calendar-date-fill\"></i></button>\n<button><i class=\"bi bi-calendar-date\"></i></button>\n<button><i class=\"bi bi-calendar-day-fill\"></i></button>\n<button><i class=\"bi bi-calendar-day\"></i></button>\n<button><i class=\"bi bi-calendar-event-fill\"></i></button>\n<button><i class=\"bi bi-calendar-event\"></i></button>\n<button><i class=\"bi bi-calendar-fill\"></i></button>";
      html += "\n<button><i class=\"bi bi-calendar-minus-fill\"></i></button>\n<button><i class=\"bi bi-calendar-minus\"></i></button>\n<button><i class=\"bi bi-calendar-month-fill\"></i></button>\n<button><i class=\"bi bi-calendar-month\"></i></button>\n<button><i class=\"bi bi-calendar-plus-fill\"></i></button>\n<button><i class=\"bi bi-calendar-plus\"></i></button>\n<button><i class=\"bi bi-calendar-range-fill\"></i></button>\n<button><i class=\"bi bi-calendar-range\"></i></button>\n<button><i class=\"bi bi-calendar-week-fill\"></i></button>\n<button><i class=\"bi bi-calendar-week\"></i></button>\n<button><i class=\"bi bi-calendar-x-fill\"></i></button>\n<button><i class=\"bi bi-calendar-x\"></i></button>\n<button><i class=\"bi bi-calendar\"></i></button>\n<button><i class=\"bi bi-calendar2-check-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-check\"></i></button>\n<button><i class=\"bi bi-calendar2-date-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-date\"></i></button>\n<button><i class=\"bi bi-calendar2-day-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-day\"></i></button>\n<button><i class=\"bi bi-calendar2-event-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-event\"></i></button>\n<button><i class=\"bi bi-calendar2-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-minus-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-minus\"></i></button>\n<button><i class=\"bi bi-calendar2-month-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-month\"></i></button>\n<button><i class=\"bi bi-calendar2-plus-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-plus\"></i></button>\n<button><i class=\"bi bi-calendar2-range-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-range\"></i></button>\n<button><i class=\"bi bi-calendar2-week-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-week\"></i></button>\n<button><i class=\"bi bi-calendar2-x-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-x\"></i></button>\n<button><i class=\"bi bi-calendar2\"></i></button>\n<button><i class=\"bi bi-calendar3-event-fill\"></i></button>\n<button><i class=\"bi bi-calendar3-event\"></i></button>\n<button><i class=\"bi bi-calendar3-fill\"></i></button>\n<button><i class=\"bi bi-calendar3-range-fill\"></i></button>\n<button><i class=\"bi bi-calendar3-range\"></i></button>\n<button><i class=\"bi bi-calendar3-week-fill\"></i></button>\n<button><i class=\"bi bi-calendar3-week\"></i></button>\n<button><i class=\"bi bi-calendar3\"></i></button>\n<button><i class=\"bi bi-calendar4-event\"></i></button>\n<button><i class=\"bi bi-calendar4-range\"></i></button>\n<button><i class=\"bi bi-calendar4-week\"></i></button>\n<button><i class=\"bi bi-calendar4\"></i></button>\n<button><i class=\"bi bi-camera-fill\"></i></button>\n<button><i class=\"bi bi-camera-reels-fill\"></i></button>\n<button><i class=\"bi bi-camera-reels\"></i></button>\n<button><i class=\"bi bi-camera-video-fill\"></i></button>\n<button><i class=\"bi bi-camera-video-off-fill\"></i></button>\n<button><i class=\"bi bi-camera-video-off\"></i></button>\n<button><i class=\"bi bi-camera-video\"></i></button>\n<button><i class=\"bi bi-camera\"></i></button>\n<button><i class=\"bi bi-camera2\"></i></button>\n<button><i class=\"bi bi-capslock-fill\"></i></button>\n<button><i class=\"bi bi-capslock\"></i></button>\n<button><i class=\"bi bi-card-checklist\"></i></button>\n<button><i class=\"bi bi-card-heading\"></i></button>\n<button><i class=\"bi bi-card-image\"></i></button>\n<button><i class=\"bi bi-card-list\"></i></button>\n<button><i class=\"bi bi-card-text\"></i></button>\n<button><i class=\"bi bi-caret-down-fill\"></i></button>\n<button><i class=\"bi bi-caret-down-square-fill\"></i></button>\n<button><i class=\"bi bi-caret-down-square\"></i></button>\n<button><i class=\"bi bi-caret-down\"></i></button>\n<button><i class=\"bi bi-caret-left-fill\"></i></button>\n<button><i class=\"bi bi-caret-left-square-fill\"></i></button>\n<button><i class=\"bi bi-caret-left-square\"></i></button>\n<button><i class=\"bi bi-caret-left\"></i></button>\n<button><i class=\"bi bi-caret-right-fill\"></i></button>\n<button><i class=\"bi bi-caret-right-square-fill\"></i></button>\n<button><i class=\"bi bi-caret-right-square\"></i></button>\n<button><i class=\"bi bi-caret-right\"></i></button>\n<button><i class=\"bi bi-caret-up-fill\"></i></button>\n<button><i class=\"bi bi-caret-up-square-fill\"></i></button>\n<button><i class=\"bi bi-caret-up-square\"></i></button>\n<button><i class=\"bi bi-caret-up\"></i></button>\n<button><i class=\"bi bi-cart-check-fill\"></i></button>\n<button><i class=\"bi bi-cart-check\"></i></button>\n<button><i class=\"bi bi-cart-dash-fill\"></i></button>\n<button><i class=\"bi bi-cart-dash\"></i></button>\n<button><i class=\"bi bi-cart-fill\"></i></button>\n<button><i class=\"bi bi-cart-plus-fill\"></i></button>\n<button><i class=\"bi bi-cart-plus\"></i></button>\n<button><i class=\"bi bi-cart-x-fill\"></i></button>\n<button><i class=\"bi bi-cart-x\"></i></button>\n<button><i class=\"bi bi-cart\"></i></button>\n<button><i class=\"bi bi-cart2\"></i></button>\n<button><i class=\"bi bi-cart3\"></i></button>\n<button><i class=\"bi bi-cart4\"></i></button>\n<button><i class=\"bi bi-cash-stack\"></i></button>\n<button><i class=\"bi bi-cash\"></i></button>\n<button><i class=\"bi bi-cast\"></i></button>\n<button><i class=\"bi bi-chat-dots-fill\"></i></button>\n<button><i class=\"bi bi-chat-dots\"></i></button>\n<button><i class=\"bi bi-chat-fill\"></i></button>\n<button><i class=\"bi bi-chat-left-dots-fill\"></i></button>";
      html += "\n<button><i class=\"bi bi-chat-left-dots\"></i></button>\n<button><i class=\"bi bi-chat-left-fill\"></i></button>\n<button><i class=\"bi bi-chat-left-quote-fill\"></i></button>\n<button><i class=\"bi bi-chat-left-quote\"></i></button>\n<button><i class=\"bi bi-chat-left-text-fill\"></i></button>\n<button><i class=\"bi bi-chat-left-text\"></i></button>\n<button><i class=\"bi bi-chat-left\"></i></button>\n<button><i class=\"bi bi-chat-quote-fill\"></i></button>\n<button><i class=\"bi bi-chat-quote\"></i></button>\n<button><i class=\"bi bi-chat-right-dots-fill\"></i></button>\n<button><i class=\"bi bi-chat-right-dots\"></i></button>\n<button><i class=\"bi bi-chat-right-fill\"></i></button>\n<button><i class=\"bi bi-chat-right-quote-fill\"></i></button>\n<button><i class=\"bi bi-chat-right-quote\"></i></button>\n<button><i class=\"bi bi-chat-right-text-fill\"></i></button>\n<button><i class=\"bi bi-chat-right-text\"></i></button>\n<button><i class=\"bi bi-chat-right\"></i></button>\n<button><i class=\"bi bi-chat-square-dots-fill\"></i></button>\n<button><i class=\"bi bi-chat-square-dots\"></i></button>\n<button><i class=\"bi bi-chat-square-fill\"></i></button>\n<button><i class=\"bi bi-chat-square-quote-fill\"></i></button>\n<button><i class=\"bi bi-chat-square-quote\"></i></button>\n<button><i class=\"bi bi-chat-square-text-fill\"></i></button>\n<button><i class=\"bi bi-chat-square-text\"></i></button>\n<button><i class=\"bi bi-chat-square\"></i></button>\n<button><i class=\"bi bi-chat-text-fill\"></i></button>\n<button><i class=\"bi bi-chat-text\"></i></button>\n<button><i class=\"bi bi-chat\"></i></button>\n<button><i class=\"bi bi-check-all\"></i></button>\n<button><i class=\"bi bi-check-circle-fill\"></i></button>\n<button><i class=\"bi bi-check-circle\"></i></button>\n<button><i class=\"bi bi-check-square-fill\"></i></button>\n<button><i class=\"bi bi-check-square\"></i></button>\n<button><i class=\"bi bi-check\"></i></button>\n<button><i class=\"bi bi-check2-all\"></i></button>\n<button><i class=\"bi bi-check2-circle\"></i></button>\n<button><i class=\"bi bi-check2-square\"></i></button>\n<button><i class=\"bi bi-check2\"></i></button>\n<button><i class=\"bi bi-chevron-bar-contract\"></i></button>\n<button><i class=\"bi bi-chevron-bar-down\"></i></button>\n<button><i class=\"bi bi-chevron-bar-expand\"></i></button>\n<button><i class=\"bi bi-chevron-bar-left\"></i></button>\n<button><i class=\"bi bi-chevron-bar-right\"></i></button>\n<button><i class=\"bi bi-chevron-bar-up\"></i></button>\n<button><i class=\"bi bi-chevron-compact-down\"></i></button>\n<button><i class=\"bi bi-chevron-compact-left\"></i></button>\n<button><i class=\"bi bi-chevron-compact-right\"></i></button>\n<button><i class=\"bi bi-chevron-compact-up\"></i></button>\n<button><i class=\"bi bi-chevron-contract\"></i></button>\n<button><i class=\"bi bi-chevron-double-down\"></i></button>\n<button><i class=\"bi bi-chevron-double-left\"></i></button>\n<button><i class=\"bi bi-chevron-double-right\"></i></button>\n<button><i class=\"bi bi-chevron-double-up\"></i></button>\n<button><i class=\"bi bi-chevron-down\"></i></button>\n<button><i class=\"bi bi-chevron-expand\"></i></button>\n<button><i class=\"bi bi-chevron-left\"></i></button>\n<button><i class=\"bi bi-chevron-right\"></i></button>\n<button><i class=\"bi bi-chevron-up\"></i></button>\n<button><i class=\"bi bi-circle-fill\"></i></button>\n<button><i class=\"bi bi-circle-half\"></i></button>\n<button><i class=\"bi bi-circle-square\"></i></button>\n<button><i class=\"bi bi-circle\"></i></button>\n<button><i class=\"bi bi-clipboard-check\"></i></button>\n<button><i class=\"bi bi-clipboard-data\"></i></button>\n<button><i class=\"bi bi-clipboard-minus\"></i></button>\n<button><i class=\"bi bi-clipboard-plus\"></i></button>\n<button><i class=\"bi bi-clipboard-x\"></i></button>\n<button><i class=\"bi bi-clipboard\"></i></button>\n<button><i class=\"bi bi-clock-fill\"></i></button>\n<button><i class=\"bi bi-clock-history\"></i></button>\n<button><i class=\"bi bi-clock\"></i></button>\n<button><i class=\"bi bi-cloud-arrow-down-fill\"></i></button>\n<button><i class=\"bi bi-cloud-arrow-down\"></i></button>\n<button><i class=\"bi bi-cloud-arrow-up-fill\"></i></button>\n<button><i class=\"bi bi-cloud-arrow-up\"></i></button>\n<button><i class=\"bi bi-cloud-check-fill\"></i></button>\n<button><i class=\"bi bi-cloud-check\"></i></button>\n<button><i class=\"bi bi-cloud-download-fill\"></i></button>\n<button><i class=\"bi bi-cloud-download\"></i></button>\n<button><i class=\"bi bi-cloud-drizzle-fill\"></i></button>\n<button><i class=\"bi bi-cloud-drizzle\"></i></button>\n<button><i class=\"bi bi-cloud-fill\"></i></button>\n<button><i class=\"bi bi-cloud-fog-fill\"></i></button>\n<button><i class=\"bi bi-cloud-fog\"></i></button>\n<button><i class=\"bi bi-cloud-fog2-fill\"></i></button>\n<button><i class=\"bi bi-cloud-fog2\"></i></button>\n<button><i class=\"bi bi-cloud-hail-fill\"></i></button>\n<button><i class=\"bi bi-cloud-hail\"></i></button>\n<button><i class=\"bi bi-cloud-haze-fill\"></i></button>\n<button><i class=\"bi bi-cloud-haze\"></i></button>\n<button><i class=\"bi bi-cloud-haze2-fill\"></i></button>\n<button><i class=\"bi bi-cloud-lightning-fill\"></i></button>\n<button><i class=\"bi bi-cloud-lightning-rain-fill\"></i></button>\n<button><i class=\"bi bi-cloud-lightning-rain\"></i></button>\n<button><i class=\"bi bi-cloud-lightning\"></i></button>\n<button><i class=\"bi bi-cloud-minus-fill\"></i></button>\n<button><i class=\"bi bi-cloud-minus\"></i></button>\n<button><i class=\"bi bi-cloud-moon-fill\"></i></button>\n<button><i class=\"bi bi-cloud-moon\"></i></button>";
      html += "\n<button><i class=\"bi bi-cloud-plus-fill\"></i></button>\n<button><i class=\"bi bi-cloud-plus\"></i></button>\n<button><i class=\"bi bi-cloud-rain-fill\"></i></button>\n<button><i class=\"bi bi-cloud-rain-heavy-fill\"></i></button>\n<button><i class=\"bi bi-cloud-rain-heavy\"></i></button>\n<button><i class=\"bi bi-cloud-rain\"></i></button>\n<button><i class=\"bi bi-cloud-slash-fill\"></i></button>\n<button><i class=\"bi bi-cloud-slash\"></i></button>\n<button><i class=\"bi bi-cloud-sleet-fill\"></i></button>\n<button><i class=\"bi bi-cloud-sleet\"></i></button>\n<button><i class=\"bi bi-cloud-snow-fill\"></i></button>\n<button><i class=\"bi bi-cloud-snow\"></i></button>\n<button><i class=\"bi bi-cloud-sun-fill\"></i></button>\n<button><i class=\"bi bi-cloud-sun\"></i></button>\n<button><i class=\"bi bi-cloud-upload-fill\"></i></button>\n<button><i class=\"bi bi-cloud-upload\"></i></button>\n<button><i class=\"bi bi-cloud\"></i></button>\n<button><i class=\"bi bi-clouds-fill\"></i></button>\n<button><i class=\"bi bi-clouds\"></i></button>\n<button><i class=\"bi bi-cloudy-fill\"></i></button>\n<button><i class=\"bi bi-cloudy\"></i></button>\n<button><i class=\"bi bi-code-slash\"></i></button>\n<button><i class=\"bi bi-code-square\"></i></button>\n<button><i class=\"bi bi-code\"></i></button>\n<button><i class=\"bi bi-collection-fill\"></i></button>\n<button><i class=\"bi bi-collection-play-fill\"></i></button>\n<button><i class=\"bi bi-collection-play\"></i></button>\n<button><i class=\"bi bi-collection\"></i></button>\n<button><i class=\"bi bi-columns-gap\"></i></button>\n<button><i class=\"bi bi-columns\"></i></button>\n<button><i class=\"bi bi-command\"></i></button>\n<button><i class=\"bi bi-compass-fill\"></i></button>\n<button><i class=\"bi bi-compass\"></i></button>\n<button><i class=\"bi bi-cone-striped\"></i></button>\n<button><i class=\"bi bi-cone\"></i></button>\n<button><i class=\"bi bi-controller\"></i></button>\n<button><i class=\"bi bi-cpu-fill\"></i></button>\n<button><i class=\"bi bi-cpu\"></i></button>\n<button><i class=\"bi bi-credit-card-2-back-fill\"></i></button>\n<button><i class=\"bi bi-credit-card-2-back\"></i></button>\n<button><i class=\"bi bi-credit-card-2-front-fill\"></i></button>\n<button><i class=\"bi bi-credit-card-2-front\"></i></button>\n<button><i class=\"bi bi-credit-card-fill\"></i></button>\n<button><i class=\"bi bi-credit-card\"></i></button>\n<button><i class=\"bi bi-crop\"></i></button>\n<button><i class=\"bi bi-cup-fill\"></i></button>\n<button><i class=\"bi bi-cup-straw\"></i></button>\n<button><i class=\"bi bi-cup\"></i></button>\n<button><i class=\"bi bi-cursor-fill\"></i></button>\n<button><i class=\"bi bi-cursor-text\"></i></button>\n<button><i class=\"bi bi-cursor\"></i></button>\n<button><i class=\"bi bi-dash-circle-dotted\"></i></button>\n<button><i class=\"bi bi-dash-circle-fill\"></i></button>\n<button><i class=\"bi bi-dash-circle\"></i></button>\n<button><i class=\"bi bi-dash-square-dotted\"></i></button>\n<button><i class=\"bi bi-dash-square-fill\"></i></button>\n<button><i class=\"bi bi-dash-square\"></i></button>\n<button><i class=\"bi bi-dash\"></i></button>\n<button><i class=\"bi bi-diagram-2-fill\"></i></button>\n<button><i class=\"bi bi-diagram-2\"></i></button>\n<button><i class=\"bi bi-diagram-3-fill\"></i></button>\n<button><i class=\"bi bi-diagram-3\"></i></button>\n<button><i class=\"bi bi-diamond-fill\"></i></button>\n<button><i class=\"bi bi-diamond-half\"></i></button>\n<button><i class=\"bi bi-diamond\"></i></button>\n<button><i class=\"bi bi-dice-1-fill\"></i></button>\n<button><i class=\"bi bi-dice-1\"></i></button>\n<button><i class=\"bi bi-dice-2-fill\"></i></button>\n<button><i class=\"bi bi-dice-2\"></i></button>\n<button><i class=\"bi bi-dice-3-fill\"></i></button>\n<button><i class=\"bi bi-dice-3\"></i></button>\n<button><i class=\"bi bi-dice-4-fill\"></i></button>\n<button><i class=\"bi bi-dice-4\"></i></button>\n<button><i class=\"bi bi-dice-5-fill\"></i></button>\n<button><i class=\"bi bi-dice-5\"></i></button>\n<button><i class=\"bi bi-dice-6-fill\"></i></button>\n<button><i class=\"bi bi-dice-6\"></i></button>\n<button><i class=\"bi bi-disc-fill\"></i></button>\n<button><i class=\"bi bi-disc\"></i></button>\n<button><i class=\"bi bi-discord\"></i></button>\n<button><i class=\"bi bi-display-fill\"></i></button>\n<button><i class=\"bi bi-display\"></i></button>\n<button><i class=\"bi bi-distribute-horizontal\"></i></button>\n<button><i class=\"bi bi-distribute-vertical\"></i></button>\n<button><i class=\"bi bi-door-closed-fill\"></i></button>\n<button><i class=\"bi bi-door-closed\"></i></button>\n<button><i class=\"bi bi-door-open-fill\"></i></button>\n<button><i class=\"bi bi-door-open\"></i></button>\n<button><i class=\"bi bi-dot\"></i></button>\n<button><i class=\"bi bi-download\"></i></button>\n<button><i class=\"bi bi-droplet-fill\"></i></button>\n<button><i class=\"bi bi-droplet-half\"></i></button>\n<button><i class=\"bi bi-droplet\"></i></button>\n<button><i class=\"bi bi-earbuds\"></i></button>\n<button><i class=\"bi bi-easel-fill\"></i></button>\n<button><i class=\"bi bi-easel\"></i></button>\n<button><i class=\"bi bi-egg-fill\"></i></button>\n<button><i class=\"bi bi-egg-fried\"></i></button>\n<button><i class=\"bi bi-egg\"></i></button>";
      html += "\n<button><i class=\"bi bi-eject-fill\"></i></button>\n<button><i class=\"bi bi-eject\"></i></button>\n<button><i class=\"bi bi-emoji-angry-fill\"></i></button>\n<button><i class=\"bi bi-emoji-angry\"></i></button>\n<button><i class=\"bi bi-emoji-dizzy-fill\"></i></button>\n<button><i class=\"bi bi-emoji-dizzy\"></i></button>\n<button><i class=\"bi bi-emoji-expressionless-fill\"></i></button>\n<button><i class=\"bi bi-emoji-expressionless\"></i></button>\n<button><i class=\"bi bi-emoji-frown-fill\"></i></button>\n<button><i class=\"bi bi-emoji-frown\"></i></button>\n<button><i class=\"bi bi-emoji-heart-eyes-fill\"></i></button>\n<button><i class=\"bi bi-emoji-heart-eyes\"></i></button>\n<button><i class=\"bi bi-emoji-laughing-fill\"></i></button>\n<button><i class=\"bi bi-emoji-laughing\"></i></button>\n<button><i class=\"bi bi-emoji-neutral-fill\"></i></button>\n<button><i class=\"bi bi-emoji-neutral\"></i></button>\n<button><i class=\"bi bi-emoji-smile-fill\"></i></button>\n<button><i class=\"bi bi-emoji-smile-upside-down-fill\"></i></button>\n<button><i class=\"bi bi-emoji-smile-upside-down\"></i></button>\n<button><i class=\"bi bi-emoji-smile\"></i></button>\n<button><i class=\"bi bi-emoji-sunglasses-fill\"></i></button>\n<button><i class=\"bi bi-emoji-sunglasses\"></i></button>\n<button><i class=\"bi bi-emoji-wink-fill\"></i></button>\n<button><i class=\"bi bi-emoji-wink\"></i></button>\n<button><i class=\"bi bi-envelope-fill\"></i></button>\n<button><i class=\"bi bi-envelope-open-fill\"></i></button>\n<button><i class=\"bi bi-envelope-open\"></i></button>\n<button><i class=\"bi bi-envelope\"></i></button>\n<button><i class=\"bi bi-eraser-fill\"></i></button>\n<button><i class=\"bi bi-eraser\"></i></button>\n<button><i class=\"bi bi-exclamation-circle-fill\"></i></button>\n<button><i class=\"bi bi-exclamation-circle\"></i></button>\n<button><i class=\"bi bi-exclamation-diamond-fill\"></i></button>\n<button><i class=\"bi bi-exclamation-diamond\"></i></button>\n<button><i class=\"bi bi-exclamation-octagon-fill\"></i></button>\n<button><i class=\"bi bi-exclamation-octagon\"></i></button>\n<button><i class=\"bi bi-exclamation-square-fill\"></i></button>\n<button><i class=\"bi bi-exclamation-square\"></i></button>\n<button><i class=\"bi bi-exclamation-triangle-fill\"></i></button>\n<button><i class=\"bi bi-exclamation-triangle\"></i></button>\n<button><i class=\"bi bi-exclamation\"></i></button>\n<button><i class=\"bi bi-exclude\"></i></button>\n<button><i class=\"bi bi-eye-fill\"></i></button>\n<button><i class=\"bi bi-eye-slash-fill\"></i></button>\n<button><i class=\"bi bi-eye-slash\"></i></button>\n<button><i class=\"bi bi-eye\"></i></button>\n<button><i class=\"bi bi-eyedropper\"></i></button>\n<button><i class=\"bi bi-eyeglasses\"></i></button>\n<button><i class=\"bi bi-facebook\"></i></button>\n<button><i class=\"bi bi-file-arrow-down-fill\"></i></button>\n<button><i class=\"bi bi-file-arrow-down\"></i></button>\n<button><i class=\"bi bi-file-arrow-up-fill\"></i></button>\n<button><i class=\"bi bi-file-arrow-up\"></i></button>\n<button><i class=\"bi bi-file-bar-graph-fill\"></i></button>\n<button><i class=\"bi bi-file-bar-graph\"></i></button>\n<button><i class=\"bi bi-file-binary-fill\"></i></button>\n<button><i class=\"bi bi-file-binary\"></i></button>\n<button><i class=\"bi bi-file-break-fill\"></i></button>\n<button><i class=\"bi bi-file-break\"></i></button>\n<button><i class=\"bi bi-file-check-fill\"></i></button>\n<button><i class=\"bi bi-file-check\"></i></button>\n<button><i class=\"bi bi-file-code-fill\"></i></button>\n<button><i class=\"bi bi-file-code\"></i></button>\n<button><i class=\"bi bi-file-diff-fill\"></i></button>\n<button><i class=\"bi bi-file-diff\"></i></button>\n<button><i class=\"bi bi-file-earmark-arrow-down-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-arrow-down\"></i></button>\n<button><i class=\"bi bi-file-earmark-arrow-up-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-arrow-up\"></i></button>\n<button><i class=\"bi bi-file-earmark-bar-graph-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-bar-graph\"></i></button>\n<button><i class=\"bi bi-file-earmark-binary-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-binary\"></i></button>\n<button><i class=\"bi bi-file-earmark-break-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-break\"></i></button>\n<button><i class=\"bi bi-file-earmark-check-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-check\"></i></button>\n<button><i class=\"bi bi-file-earmark-code-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-code\"></i></button>\n<button><i class=\"bi bi-file-earmark-diff-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-diff\"></i></button>\n<button><i class=\"bi bi-file-earmark-easel-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-easel\"></i></button>\n<button><i class=\"bi bi-file-earmark-excel-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-excel\"></i></button>\n<button><i class=\"bi bi-file-earmark-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-font-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-font\"></i></button>\n<button><i class=\"bi bi-file-earmark-image-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-image\"></i></button>\n<button><i class=\"bi bi-file-earmark-lock-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-lock\"></i></button>\n<button><i class=\"bi bi-file-earmark-lock2-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-lock2\"></i></button>\n<button><i class=\"bi bi-file-earmark-medical-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-medical\"></i></button>\n<button><i class=\"bi bi-file-earmark-minus-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-minus\"></i></button>\n<button><i class=\"bi bi-file-earmark-music-fill\"></i></button>";
      html += "\n<button><i class=\"bi bi-file-earmark-music\"></i></button>\n<button><i class=\"bi bi-file-earmark-person-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-person\"></i></button>\n<button><i class=\"bi bi-file-earmark-play-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-play\"></i></button>\n<button><i class=\"bi bi-file-earmark-plus-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-plus\"></i></button>\n<button><i class=\"bi bi-file-earmark-post-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-post\"></i></button>\n<button><i class=\"bi bi-file-earmark-ppt-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-ppt\"></i></button>\n<button><i class=\"bi bi-file-earmark-richtext-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-richtext\"></i></button>\n<button><i class=\"bi bi-file-earmark-ruled-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-ruled\"></i></button>\n<button><i class=\"bi bi-file-earmark-slides-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-slides\"></i></button>\n<button><i class=\"bi bi-file-earmark-spreadsheet-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-spreadsheet\"></i></button>\n<button><i class=\"bi bi-file-earmark-text-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-text\"></i></button>\n<button><i class=\"bi bi-file-earmark-word-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-word\"></i></button>\n<button><i class=\"bi bi-file-earmark-x-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-x\"></i></button>\n<button><i class=\"bi bi-file-earmark-zip-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-zip\"></i></button>\n<button><i class=\"bi bi-file-earmark\"></i></button>\n<button><i class=\"bi bi-file-easel-fill\"></i></button>\n<button><i class=\"bi bi-file-easel\"></i></button>\n<button><i class=\"bi bi-file-excel-fill\"></i></button>\n<button><i class=\"bi bi-file-excel\"></i></button>\n<button><i class=\"bi bi-file-fill\"></i></button>\n<button><i class=\"bi bi-file-font-fill\"></i></button>\n<button><i class=\"bi bi-file-font\"></i></button>\n<button><i class=\"bi bi-file-image-fill\"></i></button>\n<button><i class=\"bi bi-file-image\"></i></button>\n<button><i class=\"bi bi-file-lock-fill\"></i></button>\n<button><i class=\"bi bi-file-lock\"></i></button>\n<button><i class=\"bi bi-file-lock2-fill\"></i></button>\n<button><i class=\"bi bi-file-lock2\"></i></button>\n<button><i class=\"bi bi-file-medical-fill\"></i></button>\n<button><i class=\"bi bi-file-medical\"></i></button>\n<button><i class=\"bi bi-file-minus-fill\"></i></button>\n<button><i class=\"bi bi-file-minus\"></i></button>\n<button><i class=\"bi bi-file-music-fill\"></i></button>\n<button><i class=\"bi bi-file-music\"></i></button>\n<button><i class=\"bi bi-file-person-fill\"></i></button>\n<button><i class=\"bi bi-file-person\"></i></button>\n<button><i class=\"bi bi-file-play-fill\"></i></button>\n<button><i class=\"bi bi-file-play\"></i></button>\n<button><i class=\"bi bi-file-plus-fill\"></i></button>\n<button><i class=\"bi bi-file-plus\"></i></button>\n<button><i class=\"bi bi-file-post-fill\"></i></button>\n<button><i class=\"bi bi-file-post\"></i></button>\n<button><i class=\"bi bi-file-ppt-fill\"></i></button>\n<button><i class=\"bi bi-file-ppt\"></i></button>\n<button><i class=\"bi bi-file-richtext-fill\"></i></button>\n<button><i class=\"bi bi-file-richtext\"></i></button>\n<button><i class=\"bi bi-file-ruled-fill\"></i></button>\n<button><i class=\"bi bi-file-ruled\"></i></button>\n<button><i class=\"bi bi-file-slides-fill\"></i></button>\n<button><i class=\"bi bi-file-slides\"></i></button>\n<button><i class=\"bi bi-file-spreadsheet-fill\"></i></button>\n<button><i class=\"bi bi-file-spreadsheet\"></i></button>\n<button><i class=\"bi bi-file-text-fill\"></i></button>\n<button><i class=\"bi bi-file-text\"></i></button>\n<button><i class=\"bi bi-file-word-fill\"></i></button>\n<button><i class=\"bi bi-file-word\"></i></button>\n<button><i class=\"bi bi-file-x-fill\"></i></button>\n<button><i class=\"bi bi-file-x\"></i></button>\n<button><i class=\"bi bi-file-zip-fill\"></i></button>\n<button><i class=\"bi bi-file-zip\"></i></button>\n<button><i class=\"bi bi-file\"></i></button>\n<button><i class=\"bi bi-files-alt\"></i></button>\n<button><i class=\"bi bi-files\"></i></button>\n<button><i class=\"bi bi-film\"></i></button>\n<button><i class=\"bi bi-filter-circle-fill\"></i></button>\n<button><i class=\"bi bi-filter-circle\"></i></button>\n<button><i class=\"bi bi-filter-left\"></i></button>\n<button><i class=\"bi bi-filter-right\"></i></button>\n<button><i class=\"bi bi-filter-square-fill\"></i></button>\n<button><i class=\"bi bi-filter-square\"></i></button>\n<button><i class=\"bi bi-filter\"></i></button>\n<button><i class=\"bi bi-flag-fill\"></i></button>\n<button><i class=\"bi bi-flag\"></i></button>\n<button><i class=\"bi bi-flower1\"></i></button>\n<button><i class=\"bi bi-flower2\"></i></button>\n<button><i class=\"bi bi-flower3\"></i></button>\n<button><i class=\"bi bi-folder-check\"></i></button>\n<button><i class=\"bi bi-folder-fill\"></i></button>\n<button><i class=\"bi bi-folder-minus\"></i></button>\n<button><i class=\"bi bi-folder-plus\"></i></button>\n<button><i class=\"bi bi-folder-symlink-fill\"></i></button>\n<button><i class=\"bi bi-folder-symlink\"></i></button>\n<button><i class=\"bi bi-folder-x\"></i></button>\n<button><i class=\"bi bi-folder\"></i></button>\n<button><i class=\"bi bi-folder2-open\"></i></button>\n<button><i class=\"bi bi-folder2\"></i></button>";
      html += "\n<button><i class=\"bi bi-fonts\"></i></button>\n<button><i class=\"bi bi-forward-fill\"></i></button>\n<button><i class=\"bi bi-forward\"></i></button>\n<button><i class=\"bi bi-front\"></i></button>\n<button><i class=\"bi bi-fullscreen-exit\"></i></button>\n<button><i class=\"bi bi-fullscreen\"></i></button>\n<button><i class=\"bi bi-funnel-fill\"></i></button>\n<button><i class=\"bi bi-funnel\"></i></button>\n<button><i class=\"bi bi-gear-fill\"></i></button>\n<button><i class=\"bi bi-gear-wide-connected\"></i></button>\n<button><i class=\"bi bi-gear-wide\"></i></button>\n<button><i class=\"bi bi-gear\"></i></button>\n<button><i class=\"bi bi-gem\"></i></button>\n<button><i class=\"bi bi-geo-alt-fill\"></i></button>\n<button><i class=\"bi bi-geo-alt\"></i></button>\n<button><i class=\"bi bi-geo-fill\"></i></button>\n<button><i class=\"bi bi-geo\"></i></button>\n<button><i class=\"bi bi-gift-fill\"></i></button>\n<button><i class=\"bi bi-gift\"></i></button>\n<button><i class=\"bi bi-github\"></i></button>\n<button><i class=\"bi bi-globe\"></i></button>\n<button><i class=\"bi bi-globe2\"></i></button>\n<button><i class=\"bi bi-google\"></i></button>\n<button><i class=\"bi bi-graph-down\"></i></button>\n<button><i class=\"bi bi-graph-up\"></i></button>\n<button><i class=\"bi bi-grid-1x2-fill\"></i></button>\n<button><i class=\"bi bi-grid-1x2\"></i></button>\n<button><i class=\"bi bi-grid-3x2-gap-fill\"></i></button>\n<button><i class=\"bi bi-grid-3x2-gap\"></i></button>\n<button><i class=\"bi bi-grid-3x2\"></i></button>\n<button><i class=\"bi bi-grid-3x3-gap-fill\"></i></button>\n<button><i class=\"bi bi-grid-3x3-gap\"></i></button>\n<button><i class=\"bi bi-grid-3x3\"></i></button>\n<button><i class=\"bi bi-grid-fill\"></i></button>\n<button><i class=\"bi bi-grid\"></i></button>\n<button><i class=\"bi bi-grip-horizontal\"></i></button>\n<button><i class=\"bi bi-grip-vertical\"></i></button>\n<button><i class=\"bi bi-hammer\"></i></button>\n<button><i class=\"bi bi-hand-index-fill\"></i></button>\n<button><i class=\"bi bi-hand-index-thumb-fill\"></i></button>\n<button><i class=\"bi bi-hand-index-thumb\"></i></button>\n<button><i class=\"bi bi-hand-index\"></i></button>\n<button><i class=\"bi bi-hand-thumbs-down-fill\"></i></button>\n<button><i class=\"bi bi-hand-thumbs-down\"></i></button>\n<button><i class=\"bi bi-hand-thumbs-up-fill\"></i></button>\n<button><i class=\"bi bi-hand-thumbs-up\"></i></button>\n<button><i class=\"bi bi-handbag-fill\"></i></button>\n<button><i class=\"bi bi-handbag\"></i></button>\n<button><i class=\"bi bi-hash\"></i></button>\n<button><i class=\"bi bi-hdd-fill\"></i></button>\n<button><i class=\"bi bi-hdd-network-fill\"></i></button>\n<button><i class=\"bi bi-hdd-network\"></i></button>\n<button><i class=\"bi bi-hdd-rack-fill\"></i></button>\n<button><i class=\"bi bi-hdd-rack\"></i></button>\n<button><i class=\"bi bi-hdd-stack-fill\"></i></button>\n<button><i class=\"bi bi-hdd-stack\"></i></button>\n<button><i class=\"bi bi-hdd\"></i></button>\n<button><i class=\"bi bi-headphones\"></i></button>\n<button><i class=\"bi bi-headset\"></i></button>\n<button><i class=\"bi bi-heart-fill\"></i></button>\n<button><i class=\"bi bi-heart-half\"></i></button>\n<button><i class=\"bi bi-heart\"></i></button>\n<button><i class=\"bi bi-heptagon-fill\"></i></button>\n<button><i class=\"bi bi-heptagon-half\"></i></button>\n<button><i class=\"bi bi-heptagon\"></i></button>\n<button><i class=\"bi bi-hexagon-fill\"></i></button>\n<button><i class=\"bi bi-hexagon-half\"></i></button>\n<button><i class=\"bi bi-hexagon\"></i></button>\n<button><i class=\"bi bi-hourglass-bottom\"></i></button>\n<button><i class=\"bi bi-hourglass-split\"></i></button>\n<button><i class=\"bi bi-hourglass-top\"></i></button>\n<button><i class=\"bi bi-hourglass\"></i></button>\n<button><i class=\"bi bi-house-door-fill\"></i></button>\n<button><i class=\"bi bi-house-door\"></i></button>\n<button><i class=\"bi bi-house-fill\"></i></button>\n<button><i class=\"bi bi-house\"></i></button>\n<button><i class=\"bi bi-hr\"></i></button>\n<button><i class=\"bi bi-hurricane\"></i></button>\n<button><i class=\"bi bi-image-alt\"></i></button>\n<button><i class=\"bi bi-image-fill\"></i></button>\n<button><i class=\"bi bi-image\"></i></button>\n<button><i class=\"bi bi-images\"></i></button>\n<button><i class=\"bi bi-inbox-fill\"></i></button>\n<button><i class=\"bi bi-inbox\"></i></button>\n<button><i class=\"bi bi-inboxes-fill\"></i></button>\n<button><i class=\"bi bi-inboxes\"></i></button>\n<button><i class=\"bi bi-info-circle-fill\"></i></button>\n<button><i class=\"bi bi-info-circle\"></i></button>\n<button><i class=\"bi bi-info-square-fill\"></i></button>\n<button><i class=\"bi bi-info-square\"></i></button>\n<button><i class=\"bi bi-info\"></i></button>\n<button><i class=\"bi bi-input-cursor-text\"></i></button>\n<button><i class=\"bi bi-input-cursor\"></i></button>\n<button><i class=\"bi bi-instagram\"></i></button>\n<button><i class=\"bi bi-intersect\"></i></button>\n<button><i class=\"bi bi-journal-album\"></i></button>\n<button><i class=\"bi bi-journal-arrow-down\"></i></button>\n<button><i class=\"bi bi-journal-arrow-up\"></i></button>\n<button><i class=\"bi bi-journal-bookmark-fill\"></i></button>";
      html += "\n<button><i class=\"bi bi-journal-bookmark\"></i></button>\n<button><i class=\"bi bi-journal-check\"></i></button>\n<button><i class=\"bi bi-journal-code\"></i></button>\n<button><i class=\"bi bi-journal-medical\"></i></button>\n<button><i class=\"bi bi-journal-minus\"></i></button>\n<button><i class=\"bi bi-journal-plus\"></i></button>\n<button><i class=\"bi bi-journal-richtext\"></i></button>\n<button><i class=\"bi bi-journal-text\"></i></button>\n<button><i class=\"bi bi-journal-x\"></i></button>\n<button><i class=\"bi bi-journal\"></i></button>\n<button><i class=\"bi bi-journals\"></i></button>\n<button><i class=\"bi bi-joystick\"></i></button>\n<button><i class=\"bi bi-justify-left\"></i></button>\n<button><i class=\"bi bi-justify-right\"></i></button>\n<button><i class=\"bi bi-justify\"></i></button>\n<button><i class=\"bi bi-kanban-fill\"></i></button>\n<button><i class=\"bi bi-kanban\"></i></button>\n<button><i class=\"bi bi-key-fill\"></i></button>\n<button><i class=\"bi bi-key\"></i></button>\n<button><i class=\"bi bi-keyboard-fill\"></i></button>\n<button><i class=\"bi bi-keyboard\"></i></button>\n<button><i class=\"bi bi-ladder\"></i></button>\n<button><i class=\"bi bi-lamp-fill\"></i></button>\n<button><i class=\"bi bi-lamp\"></i></button>\n<button><i class=\"bi bi-laptop-fill\"></i></button>\n<button><i class=\"bi bi-laptop\"></i></button>\n<button><i class=\"bi bi-layer-backward\"></i></button>\n<button><i class=\"bi bi-layer-forward\"></i></button>\n<button><i class=\"bi bi-layers-fill\"></i></button>\n<button><i class=\"bi bi-layers-half\"></i></button>\n<button><i class=\"bi bi-layers\"></i></button>\n<button><i class=\"bi bi-layout-sidebar-inset-reverse\"></i></button>\n<button><i class=\"bi bi-layout-sidebar-inset\"></i></button>\n<button><i class=\"bi bi-layout-sidebar-reverse\"></i></button>\n<button><i class=\"bi bi-layout-sidebar\"></i></button>\n<button><i class=\"bi bi-layout-split\"></i></button>\n<button><i class=\"bi bi-layout-text-sidebar-reverse\"></i></button>\n<button><i class=\"bi bi-layout-text-sidebar\"></i></button>\n<button><i class=\"bi bi-layout-text-window-reverse\"></i></button>\n<button><i class=\"bi bi-layout-text-window\"></i></button>\n<button><i class=\"bi bi-layout-three-columns\"></i></button>\n<button><i class=\"bi bi-layout-wtf\"></i></button>\n<button><i class=\"bi bi-life-preserver\"></i></button>\n<button><i class=\"bi bi-lightbulb-fill\"></i></button>\n<button><i class=\"bi bi-lightbulb-off-fill\"></i></button>\n<button><i class=\"bi bi-lightbulb-off\"></i></button>\n<button><i class=\"bi bi-lightbulb\"></i></button>\n<button><i class=\"bi bi-lightning-charge-fill\"></i></button>\n<button><i class=\"bi bi-lightning-charge\"></i></button>\n<button><i class=\"bi bi-lightning-fill\"></i></button>\n<button><i class=\"bi bi-lightning\"></i></button>\n<button><i class=\"bi bi-link-45deg\"></i></button>\n<button><i class=\"bi bi-link\"></i></button>\n<button><i class=\"bi bi-linkedin\"></i></button>\n<button><i class=\"bi bi-list-check\"></i></button>\n<button><i class=\"bi bi-list-nested\"></i></button>\n<button><i class=\"bi bi-list-ol\"></i></button>\n<button><i class=\"bi bi-list-stars\"></i></button>\n<button><i class=\"bi bi-list-task\"></i></button>\n<button><i class=\"bi bi-list-ul\"></i></button>\n<button><i class=\"bi bi-list\"></i></button>\n<button><i class=\"bi bi-lock-fill\"></i></button>\n<button><i class=\"bi bi-lock\"></i></button>\n<button><i class=\"bi bi-mailbox\"></i></button>\n<button><i class=\"bi bi-mailbox2\"></i></button>\n<button><i class=\"bi bi-map-fill\"></i></button>\n<button><i class=\"bi bi-map\"></i></button>\n<button><i class=\"bi bi-markdown-fill\"></i></button>\n<button><i class=\"bi bi-markdown\"></i></button>\n<button><i class=\"bi bi-mask\"></i></button>\n<button><i class=\"bi bi-megaphone-fill\"></i></button>\n<button><i class=\"bi bi-megaphone\"></i></button>\n<button><i class=\"bi bi-menu-app-fill\"></i></button>\n<button><i class=\"bi bi-menu-app\"></i></button>\n<button><i class=\"bi bi-menu-button-fill\"></i></button>\n<button><i class=\"bi bi-menu-button-wide-fill\"></i></button>\n<button><i class=\"bi bi-menu-button-wide\"></i></button>\n<button><i class=\"bi bi-menu-button\"></i></button>\n<button><i class=\"bi bi-menu-down\"></i></button>\n<button><i class=\"bi bi-menu-up\"></i></button>\n<button><i class=\"bi bi-mic-fill\"></i></button>\n<button><i class=\"bi bi-mic-mute-fill\"></i></button>\n<button><i class=\"bi bi-mic-mute\"></i></button>\n<button><i class=\"bi bi-mic\"></i></button>\n<button><i class=\"bi bi-minecart-loaded\"></i></button>\n<button><i class=\"bi bi-minecart\"></i></button>\n<button><i class=\"bi bi-moisture\"></i></button>\n<button><i class=\"bi bi-moon-fill\"></i></button>\n<button><i class=\"bi bi-moon-stars-fill\"></i></button>\n<button><i class=\"bi bi-moon-stars\"></i></button>\n<button><i class=\"bi bi-moon\"></i></button>\n<button><i class=\"bi bi-mouse-fill\"></i></button>\n<button><i class=\"bi bi-mouse\"></i></button>\n<button><i class=\"bi bi-mouse2-fill\"></i></button>\n<button><i class=\"bi bi-mouse2\"></i></button>\n<button><i class=\"bi bi-mouse3-fill\"></i></button>\n<button><i class=\"bi bi-mouse3\"></i></button>\n<button><i class=\"bi bi-music-note-beamed\"></i></button>\n<button><i class=\"bi bi-music-note-list\"></i></button>";
      html += "\n<button><i class=\"bi bi-music-note\"></i></button>\n<button><i class=\"bi bi-music-player-fill\"></i></button>\n<button><i class=\"bi bi-music-player\"></i></button>\n<button><i class=\"bi bi-newspaper\"></i></button>\n<button><i class=\"bi bi-node-minus-fill\"></i></button>\n<button><i class=\"bi bi-node-minus\"></i></button>\n<button><i class=\"bi bi-node-plus-fill\"></i></button>\n<button><i class=\"bi bi-node-plus\"></i></button>\n<button><i class=\"bi bi-nut-fill\"></i></button>\n<button><i class=\"bi bi-nut\"></i></button>\n<button><i class=\"bi bi-octagon-fill\"></i></button>\n<button><i class=\"bi bi-octagon-half\"></i></button>\n<button><i class=\"bi bi-octagon\"></i></button>\n<button><i class=\"bi bi-option\"></i></button>\n<button><i class=\"bi bi-outlet\"></i></button>\n<button><i class=\"bi bi-paint-bucket\"></i></button>\n<button><i class=\"bi bi-palette-fill\"></i></button>\n<button><i class=\"bi bi-palette\"></i></button>\n<button><i class=\"bi bi-palette2\"></i></button>\n<button><i class=\"bi bi-paperclip\"></i></button>\n<button><i class=\"bi bi-paragraph\"></i></button>\n<button><i class=\"bi bi-patch-check-fill\"></i></button>\n<button><i class=\"bi bi-patch-check\"></i></button>\n<button><i class=\"bi bi-patch-exclamation-fill\"></i></button>\n<button><i class=\"bi bi-patch-exclamation\"></i></button>\n<button><i class=\"bi bi-patch-minus-fill\"></i></button>\n<button><i class=\"bi bi-patch-minus\"></i></button>\n<button><i class=\"bi bi-patch-plus-fill\"></i></button>\n<button><i class=\"bi bi-patch-plus\"></i></button>\n<button><i class=\"bi bi-patch-question-fill\"></i></button>\n<button><i class=\"bi bi-patch-question\"></i></button>\n<button><i class=\"bi bi-pause-btn-fill\"></i></button>\n<button><i class=\"bi bi-pause-btn\"></i></button>\n<button><i class=\"bi bi-pause-circle-fill\"></i></button>\n<button><i class=\"bi bi-pause-circle\"></i></button>\n<button><i class=\"bi bi-pause-fill\"></i></button>\n<button><i class=\"bi bi-pause\"></i></button>\n<button><i class=\"bi bi-peace-fill\"></i></button>\n<button><i class=\"bi bi-peace\"></i></button>\n<button><i class=\"bi bi-pen-fill\"></i></button>\n<button><i class=\"bi bi-pen\"></i></button>\n<button><i class=\"bi bi-pencil-fill\"></i></button>\n<button><i class=\"bi bi-pencil-square\"></i></button>\n<button><i class=\"bi bi-pencil\"></i></button>\n<button><i class=\"bi bi-pentagon-fill\"></i></button>\n<button><i class=\"bi bi-pentagon-half\"></i></button>\n<button><i class=\"bi bi-pentagon\"></i></button>\n<button><i class=\"bi bi-people-fill\"></i></button>\n<button><i class=\"bi bi-people\"></i></button>\n<button><i class=\"bi bi-percent\"></i></button>\n<button><i class=\"bi bi-person-badge-fill\"></i></button>\n<button><i class=\"bi bi-person-badge\"></i></button>\n<button><i class=\"bi bi-person-bounding-box\"></i></button>\n<button><i class=\"bi bi-person-check-fill\"></i></button>\n<button><i class=\"bi bi-person-check\"></i></button>\n<button><i class=\"bi bi-person-circle\"></i></button>\n<button><i class=\"bi bi-person-dash-fill\"></i></button>\n<button><i class=\"bi bi-person-dash\"></i></button>\n<button><i class=\"bi bi-person-fill\"></i></button>\n<button><i class=\"bi bi-person-lines-fill\"></i></button>\n<button><i class=\"bi bi-person-plus-fill\"></i></button>\n<button><i class=\"bi bi-person-plus\"></i></button>\n<button><i class=\"bi bi-person-square\"></i></button>\n<button><i class=\"bi bi-person-x-fill\"></i></button>\n<button><i class=\"bi bi-person-x\"></i></button>\n<button><i class=\"bi bi-person\"></i></button>\n<button><i class=\"bi bi-phone-fill\"></i></button>\n<button><i class=\"bi bi-phone-landscape-fill\"></i></button>\n<button><i class=\"bi bi-phone-landscape\"></i></button>\n<button><i class=\"bi bi-phone-vibrate-fill\"></i></button>\n<button><i class=\"bi bi-phone-vibrate\"></i></button>\n<button><i class=\"bi bi-phone\"></i></button>\n<button><i class=\"bi bi-pie-chart-fill\"></i></button>\n<button><i class=\"bi bi-pie-chart\"></i></button>\n<button><i class=\"bi bi-pin-angle-fill\"></i></button>\n<button><i class=\"bi bi-pin-angle\"></i></button>\n<button><i class=\"bi bi-pin-fill\"></i></button>\n<button><i class=\"bi bi-pin\"></i></button>\n<button><i class=\"bi bi-pip-fill\"></i></button>\n<button><i class=\"bi bi-pip\"></i></button>\n<button><i class=\"bi bi-play-btn-fill\"></i></button>\n<button><i class=\"bi bi-play-btn\"></i></button>\n<button><i class=\"bi bi-play-circle-fill\"></i></button>\n<button><i class=\"bi bi-play-circle\"></i></button>\n<button><i class=\"bi bi-play-fill\"></i></button>\n<button><i class=\"bi bi-play\"></i></button>\n<button><i class=\"bi bi-plug-fill\"></i></button>\n<button><i class=\"bi bi-plug\"></i></button>\n<button><i class=\"bi bi-plus-circle-dotted\"></i></button>\n<button><i class=\"bi bi-plus-circle-fill\"></i></button>\n<button><i class=\"bi bi-plus-circle\"></i></button>\n<button><i class=\"bi bi-plus-square-dotted\"></i></button>\n<button><i class=\"bi bi-plus-square-fill\"></i></button>\n<button><i class=\"bi bi-plus-square\"></i></button>\n<button><i class=\"bi bi-plus\"></i></button>\n<button><i class=\"bi bi-power\"></i></button>\n<button><i class=\"bi bi-printer-fill\"></i></button>\n<button><i class=\"bi bi-printer\"></i></button>\n<button><i class=\"bi bi-puzzle-fill\"></i></button>";
      html += "\n<button><i class=\"bi bi-puzzle\"></i></button>\n<button><i class=\"bi bi-question-circle-fill\"></i></button>\n<button><i class=\"bi bi-question-circle\"></i></button>\n<button><i class=\"bi bi-question-diamond-fill\"></i></button>\n<button><i class=\"bi bi-question-diamond\"></i></button>\n<button><i class=\"bi bi-question-octagon-fill\"></i></button>\n<button><i class=\"bi bi-question-octagon\"></i></button>\n<button><i class=\"bi bi-question-square-fill\"></i></button>\n<button><i class=\"bi bi-question-square\"></i></button>\n<button><i class=\"bi bi-question\"></i></button>\n<button><i class=\"bi bi-rainbow\"></i></button>\n<button><i class=\"bi bi-receipt-cutoff\"></i></button>\n<button><i class=\"bi bi-receipt\"></i></button>\n<button><i class=\"bi bi-reception-0\"></i></button>\n<button><i class=\"bi bi-reception-1\"></i></button>\n<button><i class=\"bi bi-reception-2\"></i></button>\n<button><i class=\"bi bi-reception-3\"></i></button>\n<button><i class=\"bi bi-reception-4\"></i></button>\n<button><i class=\"bi bi-record-btn-fill\"></i></button>\n<button><i class=\"bi bi-record-btn\"></i></button>\n<button><i class=\"bi bi-record-circle-fill\"></i></button>\n<button><i class=\"bi bi-record-circle\"></i></button>\n<button><i class=\"bi bi-record-fill\"></i></button>\n<button><i class=\"bi bi-record\"></i></button>\n<button><i class=\"bi bi-record2-fill\"></i></button>\n<button><i class=\"bi bi-record2\"></i></button>\n<button><i class=\"bi bi-reply-all-fill\"></i></button>\n<button><i class=\"bi bi-reply-all\"></i></button>\n<button><i class=\"bi bi-reply-fill\"></i></button>\n<button><i class=\"bi bi-reply\"></i></button>\n<button><i class=\"bi bi-rss-fill\"></i></button>\n<button><i class=\"bi bi-rss\"></i></button>\n<button><i class=\"bi bi-rulers\"></i></button>\n<button><i class=\"bi bi-save-fill\"></i></button>\n<button><i class=\"bi bi-save\"></i></button>\n<button><i class=\"bi bi-save2-fill\"></i></button>\n<button><i class=\"bi bi-save2\"></i></button>\n<button><i class=\"bi bi-scissors\"></i></button>\n<button><i class=\"bi bi-screwdriver\"></i></button>\n<button><i class=\"bi bi-search\"></i></button>\n<button><i class=\"bi bi-segmented-nav\"></i></button>\n<button><i class=\"bi bi-server\"></i></button>\n<button><i class=\"bi bi-share-fill\"></i></button>\n<button><i class=\"bi bi-share\"></i></button>\n<button><i class=\"bi bi-shield-check\"></i></button>\n<button><i class=\"bi bi-shield-exclamation\"></i></button>\n<button><i class=\"bi bi-shield-fill-check\"></i></button>\n<button><i class=\"bi bi-shield-fill-exclamation\"></i></button>\n<button><i class=\"bi bi-shield-fill-minus\"></i></button>\n<button><i class=\"bi bi-shield-fill-plus\"></i></button>\n<button><i class=\"bi bi-shield-fill-x\"></i></button>\n<button><i class=\"bi bi-shield-fill\"></i></button>\n<button><i class=\"bi bi-shield-lock-fill\"></i></button>\n<button><i class=\"bi bi-shield-lock\"></i></button>\n<button><i class=\"bi bi-shield-minus\"></i></button>\n<button><i class=\"bi bi-shield-plus\"></i></button>\n<button><i class=\"bi bi-shield-shaded\"></i></button>\n<button><i class=\"bi bi-shield-slash-fill\"></i></button>\n<button><i class=\"bi bi-shield-slash\"></i></button>\n<button><i class=\"bi bi-shield-x\"></i></button>\n<button><i class=\"bi bi-shield\"></i></button>\n<button><i class=\"bi bi-shift-fill\"></i></button>\n<button><i class=\"bi bi-shift\"></i></button>\n<button><i class=\"bi bi-shop-window\"></i></button>\n<button><i class=\"bi bi-shop\"></i></button>\n<button><i class=\"bi bi-shuffle\"></i></button>\n<button><i class=\"bi bi-signpost-2-fill\"></i></button>\n<button><i class=\"bi bi-signpost-2\"></i></button>\n<button><i class=\"bi bi-signpost-fill\"></i></button>\n<button><i class=\"bi bi-signpost-split-fill\"></i></button>\n<button><i class=\"bi bi-signpost-split\"></i></button>\n<button><i class=\"bi bi-signpost\"></i></button>\n<button><i class=\"bi bi-sim-fill\"></i></button>\n<button><i class=\"bi bi-sim\"></i></button>\n<button><i class=\"bi bi-skip-backward-btn-fill\"></i></button>\n<button><i class=\"bi bi-skip-backward-btn\"></i></button>\n<button><i class=\"bi bi-skip-backward-circle-fill\"></i></button>\n<button><i class=\"bi bi-skip-backward-circle\"></i></button>\n<button><i class=\"bi bi-skip-backward-fill\"></i></button>\n<button><i class=\"bi bi-skip-backward\"></i></button>\n<button><i class=\"bi bi-skip-end-btn-fill\"></i></button>\n<button><i class=\"bi bi-skip-end-btn\"></i></button>\n<button><i class=\"bi bi-skip-end-circle-fill\"></i></button>\n<button><i class=\"bi bi-skip-end-circle\"></i></button>\n<button><i class=\"bi bi-skip-end-fill\"></i></button>\n<button><i class=\"bi bi-skip-end\"></i></button>\n<button><i class=\"bi bi-skip-forward-btn-fill\"></i></button>\n<button><i class=\"bi bi-skip-forward-btn\"></i></button>\n<button><i class=\"bi bi-skip-forward-circle-fill\"></i></button>\n<button><i class=\"bi bi-skip-forward-circle\"></i></button>\n<button><i class=\"bi bi-skip-forward-fill\"></i></button>\n<button><i class=\"bi bi-skip-forward\"></i></button>\n<button><i class=\"bi bi-skip-start-btn-fill\"></i></button>\n<button><i class=\"bi bi-skip-start-btn\"></i></button>\n<button><i class=\"bi bi-skip-start-circle-fill\"></i></button>\n<button><i class=\"bi bi-skip-start-circle\"></i></button>\n<button><i class=\"bi bi-skip-start-fill\"></i></button>\n<button><i class=\"bi bi-skip-start\"></i></button>\n<button><i class=\"bi bi-slack\"></i></button>";
      html += "\n<button><i class=\"bi bi-slash-circle-fill\"></i></button>\n<button><i class=\"bi bi-slash-circle\"></i></button>\n<button><i class=\"bi bi-slash-square-fill\"></i></button>\n<button><i class=\"bi bi-slash-square\"></i></button>\n<button><i class=\"bi bi-slash\"></i></button>\n<button><i class=\"bi bi-sliders\"></i></button>\n<button><i class=\"bi bi-smartwatch\"></i></button>\n<button><i class=\"bi bi-snow\"></i></button>\n<button><i class=\"bi bi-snow2\"></i></button>\n<button><i class=\"bi bi-snow3\"></i></button>\n<button><i class=\"bi bi-sort-alpha-down-alt\"></i></button>\n<button><i class=\"bi bi-sort-alpha-down\"></i></button>\n<button><i class=\"bi bi-sort-alpha-up-alt\"></i></button>\n<button><i class=\"bi bi-sort-alpha-up\"></i></button>\n<button><i class=\"bi bi-sort-down-alt\"></i></button>\n<button><i class=\"bi bi-sort-down\"></i></button>\n<button><i class=\"bi bi-sort-numeric-down-alt\"></i></button>\n<button><i class=\"bi bi-sort-numeric-down\"></i></button>\n<button><i class=\"bi bi-sort-numeric-up-alt\"></i></button>\n<button><i class=\"bi bi-sort-numeric-up\"></i></button>\n<button><i class=\"bi bi-sort-up-alt\"></i></button>\n<button><i class=\"bi bi-sort-up\"></i></button>\n<button><i class=\"bi bi-soundwave\"></i></button>\n<button><i class=\"bi bi-speaker-fill\"></i></button>\n<button><i class=\"bi bi-speaker\"></i></button>\n<button><i class=\"bi bi-speedometer\"></i></button>\n<button><i class=\"bi bi-speedometer2\"></i></button>\n<button><i class=\"bi bi-spellcheck\"></i></button>\n<button><i class=\"bi bi-square-fill\"></i></button>\n<button><i class=\"bi bi-square-half\"></i></button>\n<button><i class=\"bi bi-square\"></i></button>\n<button><i class=\"bi bi-stack\"></i></button>\n<button><i class=\"bi bi-star-fill\"></i></button>\n<button><i class=\"bi bi-star-half\"></i></button>\n<button><i class=\"bi bi-star\"></i></button>\n<button><i class=\"bi bi-stars\"></i></button>\n<button><i class=\"bi bi-stickies-fill\"></i></button>\n<button><i class=\"bi bi-stickies\"></i></button>\n<button><i class=\"bi bi-sticky-fill\"></i></button>\n<button><i class=\"bi bi-sticky\"></i></button>\n<button><i class=\"bi bi-stop-btn-fill\"></i></button>\n<button><i class=\"bi bi-stop-btn\"></i></button>\n<button><i class=\"bi bi-stop-circle-fill\"></i></button>\n<button><i class=\"bi bi-stop-circle\"></i></button>\n<button><i class=\"bi bi-stop-fill\"></i></button>\n<button><i class=\"bi bi-stop\"></i></button>\n<button><i class=\"bi bi-stoplights-fill\"></i></button>\n<button><i class=\"bi bi-stoplights\"></i></button>\n<button><i class=\"bi bi-stopwatch-fill\"></i></button>\n<button><i class=\"bi bi-stopwatch\"></i></button>\n<button><i class=\"bi bi-subtract\"></i></button>\n<button><i class=\"bi bi-suit-club-fill\"></i></button>\n<button><i class=\"bi bi-suit-club\"></i></button>\n<button><i class=\"bi bi-suit-diamond-fill\"></i></button>\n<button><i class=\"bi bi-suit-diamond\"></i></button>\n<button><i class=\"bi bi-suit-heart-fill\"></i></button>\n<button><i class=\"bi bi-suit-heart\"></i></button>\n<button><i class=\"bi bi-suit-spade-fill\"></i></button>\n<button><i class=\"bi bi-suit-spade\"></i></button>\n<button><i class=\"bi bi-sun-fill\"></i></button>\n<button><i class=\"bi bi-sun\"></i></button>\n<button><i class=\"bi bi-sunglasses\"></i></button>\n<button><i class=\"bi bi-sunrise-fill\"></i></button>\n<button><i class=\"bi bi-sunrise\"></i></button>\n<button><i class=\"bi bi-sunset-fill\"></i></button>\n<button><i class=\"bi bi-sunset\"></i></button>\n<button><i class=\"bi bi-symmetry-horizontal\"></i></button>\n<button><i class=\"bi bi-symmetry-vertical\"></i></button>\n<button><i class=\"bi bi-table\"></i></button>\n<button><i class=\"bi bi-tablet-fill\"></i></button>\n<button><i class=\"bi bi-tablet-landscape-fill\"></i></button>\n<button><i class=\"bi bi-tablet-landscape\"></i></button>\n<button><i class=\"bi bi-tablet\"></i></button>\n<button><i class=\"bi bi-tag-fill\"></i></button>\n<button><i class=\"bi bi-tag\"></i></button>\n<button><i class=\"bi bi-tags-fill\"></i></button>\n<button><i class=\"bi bi-tags\"></i></button>\n<button><i class=\"bi bi-telegram\"></i></button>\n<button><i class=\"bi bi-telephone-fill\"></i></button>\n<button><i class=\"bi bi-telephone-forward-fill\"></i></button>\n<button><i class=\"bi bi-telephone-forward\"></i></button>\n<button><i class=\"bi bi-telephone-inbound-fill\"></i></button>\n<button><i class=\"bi bi-telephone-inbound\"></i></button>\n<button><i class=\"bi bi-telephone-minus-fill\"></i></button>\n<button><i class=\"bi bi-telephone-minus\"></i></button>\n<button><i class=\"bi bi-telephone-outbound-fill\"></i></button>\n<button><i class=\"bi bi-telephone-outbound\"></i></button>\n<button><i class=\"bi bi-telephone-plus-fill\"></i></button>\n<button><i class=\"bi bi-telephone-plus\"></i></button>\n<button><i class=\"bi bi-telephone-x-fill\"></i></button>\n<button><i class=\"bi bi-telephone-x\"></i></button>\n<button><i class=\"bi bi-telephone\"></i></button>\n<button><i class=\"bi bi-terminal-fill\"></i></button>\n<button><i class=\"bi bi-terminal\"></i></button>\n<button><i class=\"bi bi-text-center\"></i></button>\n<button><i class=\"bi bi-text-indent-left\"></i></button>\n<button><i class=\"bi bi-text-indent-right\"></i></button>\n<button><i class=\"bi bi-text-left\"></i></button>\n<button><i class=\"bi bi-text-paragraph\"></i></button>";
      html += "\n<button><i class=\"bi bi-text-right\"></i></button>\n<button><i class=\"bi bi-textarea-resize\"></i></button>\n<button><i class=\"bi bi-textarea-t\"></i></button>\n<button><i class=\"bi bi-textarea\"></i></button>\n<button><i class=\"bi bi-thermometer-half\"></i></button>\n<button><i class=\"bi bi-thermometer-high\"></i></button>\n<button><i class=\"bi bi-thermometer-low\"></i></button>\n<button><i class=\"bi bi-thermometer-snow\"></i></button>\n<button><i class=\"bi bi-thermometer-sun\"></i></button>\n<button><i class=\"bi bi-thermometer\"></i></button>\n<button><i class=\"bi bi-three-dots-vertical\"></i></button>\n<button><i class=\"bi bi-three-dots\"></i></button>\n<button><i class=\"bi bi-toggle-off\"></i></button>\n<button><i class=\"bi bi-toggle-on\"></i></button>\n<button><i class=\"bi bi-toggle2-off\"></i></button>\n<button><i class=\"bi bi-toggle2-on\"></i></button>\n<button><i class=\"bi bi-toggles\"></i></button>\n<button><i class=\"bi bi-toggles2\"></i></button>\n<button><i class=\"bi bi-tools\"></i></button>\n<button><i class=\"bi bi-tornado\"></i></button>\n<button><i class=\"bi bi-trash-fill\"></i></button>\n<button><i class=\"bi bi-trash\"></i></button>\n<button><i class=\"bi bi-trash2-fill\"></i></button>\n<button><i class=\"bi bi-trash2\"></i></button>\n<button><i class=\"bi bi-tree-fill\"></i></button>\n<button><i class=\"bi bi-tree\"></i></button>\n<button><i class=\"bi bi-triangle-fill\"></i></button>\n<button><i class=\"bi bi-triangle-half\"></i></button>\n<button><i class=\"bi bi-triangle\"></i></button>\n<button><i class=\"bi bi-trophy-fill\"></i></button>\n<button><i class=\"bi bi-trophy\"></i></button>\n<button><i class=\"bi bi-tropical-storm\"></i></button>\n<button><i class=\"bi bi-truck-flatbed\"></i></button>\n<button><i class=\"bi bi-truck\"></i></button>\n<button><i class=\"bi bi-tsunami\"></i></button>\n<button><i class=\"bi bi-tv-fill\"></i></button>\n<button><i class=\"bi bi-tv\"></i></button>\n<button><i class=\"bi bi-twitch\"></i></button>\n<button><i class=\"bi bi-twitter\"></i></button>\n<button><i class=\"bi bi-type-bold\"></i></button>\n<button><i class=\"bi bi-type-h1\"></i></button>\n<button><i class=\"bi bi-type-h2\"></i></button>\n<button><i class=\"bi bi-type-h3\"></i></button>\n<button><i class=\"bi bi-type-italic\"></i></button>\n<button><i class=\"bi bi-type-strikethrough\"></i></button>\n<button><i class=\"bi bi-type-underline\"></i></button>\n<button><i class=\"bi bi-type\"></i></button>\n<button><i class=\"bi bi-ui-checks-grid\"></i></button>\n<button><i class=\"bi bi-ui-checks\"></i></button>\n<button><i class=\"bi bi-ui-radios-grid\"></i></button>\n<button><i class=\"bi bi-ui-radios\"></i></button>\n<button><i class=\"bi bi-umbrella-fill\"></i></button>\n<button><i class=\"bi bi-umbrella\"></i></button>\n<button><i class=\"bi bi-union\"></i></button>\n<button><i class=\"bi bi-unlock-fill\"></i></button>\n<button><i class=\"bi bi-unlock\"></i></button>\n<button><i class=\"bi bi-upc-scan\"></i></button>\n<button><i class=\"bi bi-upc\"></i></button>\n<button><i class=\"bi bi-upload\"></i></button>\n<button><i class=\"bi bi-vector-pen\"></i></button>\n<button><i class=\"bi bi-view-list\"></i></button>\n<button><i class=\"bi bi-view-stacked\"></i></button>\n<button><i class=\"bi bi-vinyl-fill\"></i></button>\n<button><i class=\"bi bi-vinyl\"></i></button>\n<button><i class=\"bi bi-voicemail\"></i></button>\n<button><i class=\"bi bi-volume-down-fill\"></i></button>\n<button><i class=\"bi bi-volume-down\"></i></button>\n<button><i class=\"bi bi-volume-mute-fill\"></i></button>\n<button><i class=\"bi bi-volume-mute\"></i></button>\n<button><i class=\"bi bi-volume-off-fill\"></i></button>\n<button><i class=\"bi bi-volume-off\"></i></button>\n<button><i class=\"bi bi-volume-up-fill\"></i></button>\n<button><i class=\"bi bi-volume-up\"></i></button>\n<button><i class=\"bi bi-vr\"></i></button>\n<button><i class=\"bi bi-wallet-fill\"></i></button>\n<button><i class=\"bi bi-wallet\"></i></button>\n<button><i class=\"bi bi-wallet2\"></i></button>\n<button><i class=\"bi bi-watch\"></i></button>\n<button><i class=\"bi bi-water\"></i></button>\n<button><i class=\"bi bi-whatsapp\"></i></button>\n<button><i class=\"bi bi-wifi-1\"></i></button>\n<button><i class=\"bi bi-wifi-2\"></i></button>\n<button><i class=\"bi bi-wifi-off\"></i></button>\n<button><i class=\"bi bi-wifi\"></i></button>\n<button><i class=\"bi bi-wind\"></i></button>\n<button><i class=\"bi bi-window-dock\"></i></button>\n<button><i class=\"bi bi-window-sidebar\"></i></button>\n<button><i class=\"bi bi-window\"></i></button>\n<button><i class=\"bi bi-wrench\"></i></button>\n<button><i class=\"bi bi-x-circle-fill\"></i></button>\n<button><i class=\"bi bi-x-circle\"></i></button>\n<button><i class=\"bi bi-x-diamond-fill\"></i></button>\n<button><i class=\"bi bi-x-diamond\"></i></button>\n<button><i class=\"bi bi-x-octagon-fill\"></i></button>\n<button><i class=\"bi bi-x-octagon\"></i></button>\n<button><i class=\"bi bi-x-square-fill\"></i></button>\n<button><i class=\"bi bi-x-square\"></i></button>\n<button><i class=\"bi bi-x\"></i></button>\n<button><i class=\"bi bi-youtube\"></i></button>";
      html += "\n<button><i class=\"bi bi-zoom-in\"></i></button>\n<button><i class=\"bi bi-zoom-out\"></i></button>\n<button><i class=\"bi bi-bank\"></i></button>\n<button><i class=\"bi bi-bank2\"></i></button>\n<button><i class=\"bi bi-bell-slash-fill\"></i></button>\n<button><i class=\"bi bi-bell-slash\"></i></button>\n<button><i class=\"bi bi-cash-coin\"></i></button>\n<button><i class=\"bi bi-check-lg\"></i></button>\n<button><i class=\"bi bi-coin\"></i></button>\n<button><i class=\"bi bi-currency-bitcoin\"></i></button>\n<button><i class=\"bi bi-currency-dollar\"></i></button>\n<button><i class=\"bi bi-currency-euro\"></i></button>\n<button><i class=\"bi bi-currency-exchange\"></i></button>\n<button><i class=\"bi bi-currency-pound\"></i></button>\n<button><i class=\"bi bi-currency-yen\"></i></button>\n<button><i class=\"bi bi-dash-lg\"></i></button>\n<button><i class=\"bi bi-exclamation-lg\"></i></button>\n<button><i class=\"bi bi-file-earmark-pdf-fill\"></i></button>\n<button><i class=\"bi bi-file-earmark-pdf\"></i></button>\n<button><i class=\"bi bi-file-pdf-fill\"></i></button>\n<button><i class=\"bi bi-file-pdf\"></i></button>\n<button><i class=\"bi bi-gender-ambiguous\"></i></button>\n<button><i class=\"bi bi-gender-female\"></i></button>\n<button><i class=\"bi bi-gender-male\"></i></button>\n<button><i class=\"bi bi-gender-trans\"></i></button>\n<button><i class=\"bi bi-headset-vr\"></i></button>\n<button><i class=\"bi bi-info-lg\"></i></button>\n<button><i class=\"bi bi-mastodon\"></i></button>\n<button><i class=\"bi bi-messenger\"></i></button>\n<button><i class=\"bi bi-piggy-bank-fill\"></i></button>\n<button><i class=\"bi bi-piggy-bank\"></i></button>\n<button><i class=\"bi bi-pin-map-fill\"></i></button>\n<button><i class=\"bi bi-pin-map\"></i></button>\n<button><i class=\"bi bi-plus-lg\"></i></button>\n<button><i class=\"bi bi-question-lg\"></i></button>\n<button><i class=\"bi bi-recycle\"></i></button>\n<button><i class=\"bi bi-reddit\"></i></button>\n<button><i class=\"bi bi-safe-fill\"></i></button>\n<button><i class=\"bi bi-safe2-fill\"></i></button>\n<button><i class=\"bi bi-safe2\"></i></button>\n<button><i class=\"bi bi-sd-card-fill\"></i></button>\n<button><i class=\"bi bi-sd-card\"></i></button>\n<button><i class=\"bi bi-skype\"></i></button>\n<button><i class=\"bi bi-slash-lg\"></i></button>\n<button><i class=\"bi bi-translate\"></i></button>\n<button><i class=\"bi bi-x-lg\"></i></button>\n<button><i class=\"bi bi-safe\"></i></button>\n<button><i class=\"bi bi-apple\"></i></button>\n<button><i class=\"bi bi-microsoft\"></i></button>\n<button><i class=\"bi bi-windows\"></i></button>\n<button><i class=\"bi bi-behance\"></i></button>\n<button><i class=\"bi bi-dribbble\"></i></button>\n<button><i class=\"bi bi-line\"></i></button>\n<button><i class=\"bi bi-medium\"></i></button>\n<button><i class=\"bi bi-paypal\"></i></button>\n<button><i class=\"bi bi-pinterest\"></i></button>\n<button><i class=\"bi bi-signal\"></i></button>\n<button><i class=\"bi bi-snapchat\"></i></button>\n<button><i class=\"bi bi-spotify\"></i></button>\n<button><i class=\"bi bi-stack-overflow\"></i></button>\n<button><i class=\"bi bi-strava\"></i></button>\n<button><i class=\"bi bi-wordpress\"></i></button>\n<button><i class=\"bi bi-vimeo\"></i></button>\n<button><i class=\"bi bi-activity\"></i></button>\n<button><i class=\"bi bi-easel2-fill\"></i></button>\n<button><i class=\"bi bi-easel2\"></i></button>\n<button><i class=\"bi bi-easel3-fill\"></i></button>\n<button><i class=\"bi bi-easel3\"></i></button>\n<button><i class=\"bi bi-fan\"></i></button>\n<button><i class=\"bi bi-fingerprint\"></i></button>\n<button><i class=\"bi bi-graph-down-arrow\"></i></button>\n<button><i class=\"bi bi-graph-up-arrow\"></i></button>\n<button><i class=\"bi bi-hypnotize\"></i></button>\n<button><i class=\"bi bi-magic\"></i></button>\n<button><i class=\"bi bi-person-rolodex\"></i></button>\n<button><i class=\"bi bi-person-video\"></i></button>\n<button><i class=\"bi bi-person-video2\"></i></button>\n<button><i class=\"bi bi-person-video3\"></i></button>\n<button><i class=\"bi bi-person-workspace\"></i></button>\n<button><i class=\"bi bi-radioactive\"></i></button>\n<button><i class=\"bi bi-webcam-fill\"></i></button>\n<button><i class=\"bi bi-webcam\"></i></button>\n<button><i class=\"bi bi-yin-yang\"></i></button>\n<button><i class=\"bi bi-bandaid-fill\"></i></button>\n<button><i class=\"bi bi-bandaid\"></i></button>\n<button><i class=\"bi bi-bluetooth\"></i></button>\n<button><i class=\"bi bi-body-text\"></i></button>\n<button><i class=\"bi bi-boombox\"></i></button>\n<button><i class=\"bi bi-boxes\"></i></button>\n<button><i class=\"bi bi-dpad-fill\"></i></button>\n<button><i class=\"bi bi-dpad\"></i></button>\n<button><i class=\"bi bi-ear-fill\"></i></button>\n<button><i class=\"bi bi-ear\"></i></button>\n<button><i class=\"bi bi-envelope-check-fill\"></i></button>\n<button><i class=\"bi bi-envelope-check\"></i></button>\n<button><i class=\"bi bi-envelope-dash-fill\"></i></button>\n<button><i class=\"bi bi-envelope-dash\"></i></button>\n<button><i class=\"bi bi-envelope-exclamation-fill\"></i></button>\n<button><i class=\"bi bi-envelope-exclamation\"></i></button>";
      html += "\n<button><i class=\"bi bi-envelope-plus-fill\"></i></button>\n<button><i class=\"bi bi-envelope-plus\"></i></button>\n<button><i class=\"bi bi-envelope-slash-fill\"></i></button>\n<button><i class=\"bi bi-envelope-slash\"></i></button>\n<button><i class=\"bi bi-envelope-x-fill\"></i></button>\n<button><i class=\"bi bi-envelope-x\"></i></button>\n<button><i class=\"bi bi-explicit-fill\"></i></button>\n<button><i class=\"bi bi-explicit\"></i></button>\n<button><i class=\"bi bi-git\"></i></button>\n<button><i class=\"bi bi-infinity\"></i></button>\n<button><i class=\"bi bi-list-columns-reverse\"></i></button>\n<button><i class=\"bi bi-list-columns\"></i></button>\n<button><i class=\"bi bi-meta\"></i></button>\n<button><i class=\"bi bi-nintendo-switch\"></i></button>\n<button><i class=\"bi bi-pc-display-horizontal\"></i></button>\n<button><i class=\"bi bi-pc-display\"></i></button>\n<button><i class=\"bi bi-pc-horizontal\"></i></button>\n<button><i class=\"bi bi-pc\"></i></button>\n<button><i class=\"bi bi-playstation\"></i></button>\n<button><i class=\"bi bi-plus-slash-minus\"></i></button>\n<button><i class=\"bi bi-projector-fill\"></i></button>\n<button><i class=\"bi bi-projector\"></i></button>\n<button><i class=\"bi bi-qr-code-scan\"></i></button>\n<button><i class=\"bi bi-qr-code\"></i></button>\n<button><i class=\"bi bi-quora\"></i></button>\n<button><i class=\"bi bi-quote\"></i></button>\n<button><i class=\"bi bi-robot\"></i></button>\n<button><i class=\"bi bi-send-check-fill\"></i></button>\n<button><i class=\"bi bi-send-check\"></i></button>\n<button><i class=\"bi bi-send-dash-fill\"></i></button>\n<button><i class=\"bi bi-send-dash\"></i></button>\n<button><i class=\"bi bi-send-exclamation-fill\"></i></button>\n<button><i class=\"bi bi-send-exclamation\"></i></button>\n<button><i class=\"bi bi-send-fill\"></i></button>\n<button><i class=\"bi bi-send-plus-fill\"></i></button>\n<button><i class=\"bi bi-send-plus\"></i></button>\n<button><i class=\"bi bi-send-slash-fill\"></i></button>\n<button><i class=\"bi bi-send-slash\"></i></button>\n<button><i class=\"bi bi-send-x-fill\"></i></button>\n<button><i class=\"bi bi-send-x\"></i></button>\n<button><i class=\"bi bi-send\"></i></button>\n<button><i class=\"bi bi-steam\"></i></button>\n<button><i class=\"bi bi-terminal-dash\"></i></button>\n<button><i class=\"bi bi-terminal-plus\"></i></button>\n<button><i class=\"bi bi-terminal-split\"></i></button>\n<button><i class=\"bi bi-ticket-detailed-fill\"></i></button>\n<button><i class=\"bi bi-ticket-detailed\"></i></button>\n<button><i class=\"bi bi-ticket-fill\"></i></button>\n<button><i class=\"bi bi-ticket-perforated-fill\"></i></button>\n<button><i class=\"bi bi-ticket-perforated\"></i></button>\n<button><i class=\"bi bi-ticket\"></i></button>\n<button><i class=\"bi bi-tiktok\"></i></button>\n<button><i class=\"bi bi-window-dash\"></i></button>\n<button><i class=\"bi bi-window-desktop\"></i></button>\n<button><i class=\"bi bi-window-fullscreen\"></i></button>\n<button><i class=\"bi bi-window-plus\"></i></button>\n<button><i class=\"bi bi-window-split\"></i></button>\n<button><i class=\"bi bi-window-stack\"></i></button>\n<button><i class=\"bi bi-window-x\"></i></button>\n<button><i class=\"bi bi-xbox\"></i></button>\n<button><i class=\"bi bi-ethernet\"></i></button>\n<button><i class=\"bi bi-hdmi-fill\"></i></button>\n<button><i class=\"bi bi-hdmi\"></i></button>\n<button><i class=\"bi bi-usb-c-fill\"></i></button>\n<button><i class=\"bi bi-usb-c\"></i></button>\n<button><i class=\"bi bi-usb-fill\"></i></button>\n<button><i class=\"bi bi-usb-plug-fill\"></i></button>\n<button><i class=\"bi bi-usb-plug\"></i></button>\n<button><i class=\"bi bi-usb-symbol\"></i></button>\n<button><i class=\"bi bi-usb\"></i></button>\n<button><i class=\"bi bi-boombox-fill\"></i></button>\n<button><i class=\"bi bi-displayport\"></i></button>\n<button><i class=\"bi bi-gpu-card\"></i></button>\n<button><i class=\"bi bi-memory\"></i></button>\n<button><i class=\"bi bi-modem-fill\"></i></button>\n<button><i class=\"bi bi-modem\"></i></button>\n<button><i class=\"bi bi-motherboard-fill\"></i></button>\n<button><i class=\"bi bi-motherboard\"></i></button>\n<button><i class=\"bi bi-optical-audio-fill\"></i></button>\n<button><i class=\"bi bi-optical-audio\"></i></button>\n<button><i class=\"bi bi-pci-card\"></i></button>\n<button><i class=\"bi bi-router-fill\"></i></button>\n<button><i class=\"bi bi-router\"></i></button>\n<button><i class=\"bi bi-thunderbolt-fill\"></i></button>\n<button><i class=\"bi bi-thunderbolt\"></i></button>\n<button><i class=\"bi bi-usb-drive-fill\"></i></button>\n<button><i class=\"bi bi-usb-drive\"></i></button>\n<button><i class=\"bi bi-usb-micro-fill\"></i></button>\n<button><i class=\"bi bi-usb-micro\"></i></button>\n<button><i class=\"bi bi-usb-mini-fill\"></i></button>\n<button><i class=\"bi bi-usb-mini\"></i></button>\n<button><i class=\"bi bi-cloud-haze2\"></i></button>\n<button><i class=\"bi bi-device-hdd-fill\"></i></button>\n<button><i class=\"bi bi-device-hdd\"></i></button>\n<button><i class=\"bi bi-device-ssd-fill\"></i></button>\n<button><i class=\"bi bi-device-ssd\"></i></button>\n<button><i class=\"bi bi-displayport-fill\"></i></button>\n<button><i class=\"bi bi-mortarboard-fill\"></i></button>\n<button><i class=\"bi bi-mortarboard\"></i></button>";
      html += "\n<button><i class=\"bi bi-terminal-x\"></i></button>\n<button><i class=\"bi bi-arrow-through-heart-fill\"></i></button>\n<button><i class=\"bi bi-arrow-through-heart\"></i></button>\n<button><i class=\"bi bi-badge-sd-fill\"></i></button>\n<button><i class=\"bi bi-badge-sd\"></i></button>\n<button><i class=\"bi bi-bag-heart-fill\"></i></button>\n<button><i class=\"bi bi-bag-heart\"></i></button>\n<button><i class=\"bi bi-balloon-fill\"></i></button>\n<button><i class=\"bi bi-balloon-heart-fill\"></i></button>\n<button><i class=\"bi bi-balloon-heart\"></i></button>\n<button><i class=\"bi bi-balloon\"></i></button>\n<button><i class=\"bi bi-box2-fill\"></i></button>\n<button><i class=\"bi bi-box2-heart-fill\"></i></button>\n<button><i class=\"bi bi-box2-heart\"></i></button>\n<button><i class=\"bi bi-box2\"></i></button>\n<button><i class=\"bi bi-braces-asterisk\"></i></button>\n<button><i class=\"bi bi-calendar-heart-fill\"></i></button>\n<button><i class=\"bi bi-calendar-heart\"></i></button>\n<button><i class=\"bi bi-calendar2-heart-fill\"></i></button>\n<button><i class=\"bi bi-calendar2-heart\"></i></button>\n<button><i class=\"bi bi-chat-heart-fill\"></i></button>\n<button><i class=\"bi bi-chat-heart\"></i></button>\n<button><i class=\"bi bi-chat-left-heart-fill\"></i></button>\n<button><i class=\"bi bi-chat-left-heart\"></i></button>\n<button><i class=\"bi bi-chat-right-heart-fill\"></i></button>\n<button><i class=\"bi bi-chat-right-heart\"></i></button>\n<button><i class=\"bi bi-chat-square-heart-fill\"></i></button>\n<button><i class=\"bi bi-chat-square-heart\"></i></button>\n<button><i class=\"bi bi-clipboard-check-fill\"></i></button>\n<button><i class=\"bi bi-clipboard-data-fill\"></i></button>\n<button><i class=\"bi bi-clipboard-fill\"></i></button>\n<button><i class=\"bi bi-clipboard-heart-fill\"></i></button>\n<button><i class=\"bi bi-clipboard-heart\"></i></button>\n<button><i class=\"bi bi-clipboard-minus-fill\"></i></button>\n<button><i class=\"bi bi-clipboard-plus-fill\"></i></button>\n<button><i class=\"bi bi-clipboard-pulse\"></i></button>\n<button><i class=\"bi bi-clipboard-x-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-check-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-check\"></i></button>\n<button><i class=\"bi bi-clipboard2-data-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-data\"></i></button>\n<button><i class=\"bi bi-clipboard2-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-heart-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-heart\"></i></button>\n<button><i class=\"bi bi-clipboard2-minus-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-minus\"></i></button>\n<button><i class=\"bi bi-clipboard2-plus-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-plus\"></i></button>\n<button><i class=\"bi bi-clipboard2-pulse-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-pulse\"></i></button>\n<button><i class=\"bi bi-clipboard2-x-fill\"></i></button>\n<button><i class=\"bi bi-clipboard2-x\"></i></button>\n<button><i class=\"bi bi-clipboard2\"></i></button>\n<button><i class=\"bi bi-emoji-kiss-fill\"></i></button>\n<button><i class=\"bi bi-emoji-kiss\"></i></button>\n<button><i class=\"bi bi-envelope-heart-fill\"></i></button>\n<button><i class=\"bi bi-envelope-heart\"></i></button>\n<button><i class=\"bi bi-envelope-open-heart-fill\"></i></button>\n<button><i class=\"bi bi-envelope-open-heart\"></i></button>\n<button><i class=\"bi bi-envelope-paper-fill\"></i></button>\n<button><i class=\"bi bi-envelope-paper-heart-fill\"></i></button>\n<button><i class=\"bi bi-envelope-paper-heart\"></i></button>\n<button><i class=\"bi bi-envelope-paper\"></i></button>\n<button><i class=\"bi bi-filetype-aac\"></i></button>\n<button><i class=\"bi bi-filetype-ai\"></i></button>\n<button><i class=\"bi bi-filetype-bmp\"></i></button>\n<button><i class=\"bi bi-filetype-cs\"></i></button>\n<button><i class=\"bi bi-filetype-css\"></i></button>\n<button><i class=\"bi bi-filetype-csv\"></i></button>\n<button><i class=\"bi bi-filetype-doc\"></i></button>\n<button><i class=\"bi bi-filetype-docx\"></i></button>\n<button><i class=\"bi bi-filetype-exe\"></i></button>\n<button><i class=\"bi bi-filetype-gif\"></i></button>\n<button><i class=\"bi bi-filetype-heic\"></i></button>\n<button><i class=\"bi bi-filetype-html\"></i></button>\n<button><i class=\"bi bi-filetype-java\"></i></button>\n<button><i class=\"bi bi-filetype-jpg\"></i></button>\n<button><i class=\"bi bi-filetype-js\"></i></button>\n<button><i class=\"bi bi-filetype-jsx\"></i></button>\n<button><i class=\"bi bi-filetype-key\"></i></button>\n<button><i class=\"bi bi-filetype-m4p\"></i></button>\n<button><i class=\"bi bi-filetype-md\"></i></button>\n<button><i class=\"bi bi-filetype-mdx\"></i></button>\n<button><i class=\"bi bi-filetype-mov\"></i></button>\n<button><i class=\"bi bi-filetype-mp3\"></i></button>\n<button><i class=\"bi bi-filetype-mp4\"></i></button>\n<button><i class=\"bi bi-filetype-otf\"></i></button>\n<button><i class=\"bi bi-filetype-pdf\"></i></button>\n<button><i class=\"bi bi-filetype-php\"></i></button>\n<button><i class=\"bi bi-filetype-png\"></i></button>\n<button><i class=\"bi bi-filetype-ppt\"></i></button>\n<button><i class=\"bi bi-filetype-psd\"></i></button>\n<button><i class=\"bi bi-filetype-py\"></i></button>\n<button><i class=\"bi bi-filetype-raw\"></i></button>\n<button><i class=\"bi bi-filetype-rb\"></i></button>\n<button><i class=\"bi bi-filetype-sass\"></i></button>\n<button><i class=\"bi bi-filetype-scss\"></i></button>\n<button><i class=\"bi bi-filetype-sh\"></i></button>\n<button><i class=\"bi bi-filetype-svg\"></i></button>";
      html += "\n<button><i class=\"bi bi-filetype-tiff\"></i></button>\n<button><i class=\"bi bi-filetype-tsx\"></i></button>\n<button><i class=\"bi bi-filetype-ttf\"></i></button>\n<button><i class=\"bi bi-filetype-txt\"></i></button>\n<button><i class=\"bi bi-filetype-wav\"></i></button>\n<button><i class=\"bi bi-filetype-woff\"></i></button>\n<button><i class=\"bi bi-filetype-xls\"></i></button>\n<button><i class=\"bi bi-filetype-xml\"></i></button>\n<button><i class=\"bi bi-filetype-yml\"></i></button>\n<button><i class=\"bi bi-heart-arrow\"></i></button>\n<button><i class=\"bi bi-heart-pulse-fill\"></i></button>\n<button><i class=\"bi bi-heart-pulse\"></i></button>\n<button><i class=\"bi bi-heartbreak-fill\"></i></button>\n<button><i class=\"bi bi-heartbreak\"></i></button>\n<button><i class=\"bi bi-hearts\"></i></button>\n<button><i class=\"bi bi-hospital-fill\"></i></button>\n<button><i class=\"bi bi-hospital\"></i></button>\n<button><i class=\"bi bi-house-heart-fill\"></i></button>\n<button><i class=\"bi bi-house-heart\"></i></button>\n<button><i class=\"bi bi-incognito\"></i></button>\n<button><i class=\"bi bi-magnet-fill\"></i></button>\n<button><i class=\"bi bi-magnet\"></i></button>\n<button><i class=\"bi bi-person-heart\"></i></button>\n<button><i class=\"bi bi-person-hearts\"></i></button>\n<button><i class=\"bi bi-phone-flip\"></i></button>\n<button><i class=\"bi bi-plugin\"></i></button>\n<button><i class=\"bi bi-postage-fill\"></i></button>\n<button><i class=\"bi bi-postage-heart-fill\"></i></button>\n<button><i class=\"bi bi-postage-heart\"></i></button>\n<button><i class=\"bi bi-postage\"></i></button>\n<button><i class=\"bi bi-postcard-fill\"></i></button>\n<button><i class=\"bi bi-postcard-heart-fill\"></i></button>\n<button><i class=\"bi bi-postcard-heart\"></i></button>\n<button><i class=\"bi bi-postcard\"></i></button>\n<button><i class=\"bi bi-search-heart-fill\"></i></button>\n<button><i class=\"bi bi-search-heart\"></i></button>\n<button><i class=\"bi bi-sliders2-vertical\"></i></button>\n<button><i class=\"bi bi-sliders2\"></i></button>\n<button><i class=\"bi bi-trash3-fill\"></i></button>\n<button><i class=\"bi bi-trash3\"></i></button>\n<button><i class=\"bi bi-valentine\"></i></button>\n<button><i class=\"bi bi-valentine2\"></i></button>\n<button><i class=\"bi bi-wrench-adjustable-circle-fill\"></i></button>\n<button><i class=\"bi bi-wrench-adjustable-circle\"></i></button>\n<button><i class=\"bi bi-wrench-adjustable\"></i></button>\n<button><i class=\"bi bi-filetype-json\"></i></button>\n<button><i class=\"bi bi-filetype-pptx\"></i></button>\n<button><i class=\"bi bi-filetype-xlsx\"></i></button>\n<button><i class=\"bi bi-1-circle-fill\"></i></button>\n<button><i class=\"bi bi-1-circle\"></i></button>\n<button><i class=\"bi bi-1-square-fill\"></i></button>\n<button><i class=\"bi bi-1-square\"></i></button>\n<button><i class=\"bi bi-2-circle-fill\"></i></button>\n<button><i class=\"bi bi-2-circle\"></i></button>\n<button><i class=\"bi bi-2-square-fill\"></i></button>\n<button><i class=\"bi bi-2-square\"></i></button>\n<button><i class=\"bi bi-3-circle-fill\"></i></button>\n<button><i class=\"bi bi-3-circle\"></i></button>\n<button><i class=\"bi bi-3-square-fill\"></i></button>\n<button><i class=\"bi bi-3-square\"></i></button>\n<button><i class=\"bi bi-4-circle-fill\"></i></button>\n<button><i class=\"bi bi-4-circle\"></i></button>\n<button><i class=\"bi bi-4-square-fill\"></i></button>\n<button><i class=\"bi bi-4-square\"></i></button>\n<button><i class=\"bi bi-5-circle-fill\"></i></button>\n<button><i class=\"bi bi-5-circle\"></i></button>\n<button><i class=\"bi bi-5-square-fill\"></i></button>\n<button><i class=\"bi bi-5-square\"></i></button>\n<button><i class=\"bi bi-6-circle-fill\"></i></button>\n<button><i class=\"bi bi-6-circle\"></i></button>\n<button><i class=\"bi bi-6-square-fill\"></i></button>\n<button><i class=\"bi bi-6-square\"></i></button>\n<button><i class=\"bi bi-7-circle-fill\"></i></button>\n<button><i class=\"bi bi-7-circle\"></i></button>\n<button><i class=\"bi bi-7-square-fill\"></i></button>\n<button><i class=\"bi bi-7-square\"></i></button>\n<button><i class=\"bi bi-8-circle-fill\"></i></button>\n<button><i class=\"bi bi-8-circle\"></i></button>\n<button><i class=\"bi bi-8-square-fill\"></i></button>\n<button><i class=\"bi bi-8-square\"></i></button>\n<button><i class=\"bi bi-9-circle-fill\"></i></button>\n<button><i class=\"bi bi-9-circle\"></i></button>\n<button><i class=\"bi bi-9-square-fill\"></i></button>\n<button><i class=\"bi bi-9-square\"></i></button>\n<button><i class=\"bi bi-airplane-engines-fill\"></i></button>\n<button><i class=\"bi bi-airplane-engines\"></i></button>\n<button><i class=\"bi bi-airplane-fill\"></i></button>\n<button><i class=\"bi bi-airplane\"></i></button>\n<button><i class=\"bi bi-alexa\"></i></button>\n<button><i class=\"bi bi-alipay\"></i></button>\n<button><i class=\"bi bi-android\"></i></button>\n<button><i class=\"bi bi-android2\"></i></button>\n<button><i class=\"bi bi-box-fill\"></i></button>\n<button><i class=\"bi bi-box-seam-fill\"></i></button>\n<button><i class=\"bi bi-browser-chrome\"></i></button>\n<button><i class=\"bi bi-browser-edge\"></i></button>\n<button><i class=\"bi bi-browser-firefox\"></i></button>\n<button><i class=\"bi bi-browser-safari\"></i></button>\n<button><i class=\"bi bi-c-circle-fill\"></i></button>";
      html += "\n<button><i class=\"bi bi-c-circle\"></i></button>\n<button><i class=\"bi bi-c-square-fill\"></i></button>\n<button><i class=\"bi bi-c-square\"></i></button>\n<button><i class=\"bi bi-capsule-pill\"></i></button>\n<button><i class=\"bi bi-capsule\"></i></button>\n<button><i class=\"bi bi-car-front-fill\"></i></button>\n<button><i class=\"bi bi-car-front\"></i></button>\n<button><i class=\"bi bi-cassette-fill\"></i></button>\n<button><i class=\"bi bi-cassette\"></i></button>\n<button><i class=\"bi bi-cc-circle-fill\"></i></button>\n<button><i class=\"bi bi-cc-circle\"></i></button>\n<button><i class=\"bi bi-cc-square-fill\"></i></button>\n<button><i class=\"bi bi-cc-square\"></i></button>\n<button><i class=\"bi bi-cup-hot-fill\"></i></button>\n<button><i class=\"bi bi-cup-hot\"></i></button>\n<button><i class=\"bi bi-currency-rupee\"></i></button>\n<button><i class=\"bi bi-dropbox\"></i></button>\n<button><i class=\"bi bi-escape\"></i></button>\n<button><i class=\"bi bi-fast-forward-btn-fill\"></i></button>\n<button><i class=\"bi bi-fast-forward-btn\"></i></button>\n<button><i class=\"bi bi-fast-forward-circle-fill\"></i></button>\n<button><i class=\"bi bi-fast-forward-circle\"></i></button>\n<button><i class=\"bi bi-fast-forward-fill\"></i></button>\n<button><i class=\"bi bi-fast-forward\"></i></button>\n<button><i class=\"bi bi-filetype-sql\"></i></button>\n<button><i class=\"bi bi-fire\"></i></button>\n<button><i class=\"bi bi-google-play\"></i></button>\n<button><i class=\"bi bi-h-circle-fill\"></i></button>\n<button><i class=\"bi bi-h-circle\"></i></button>\n<button><i class=\"bi bi-h-square-fill\"></i></button>\n<button><i class=\"bi bi-h-square\"></i></button>\n<button><i class=\"bi bi-indent\"></i></button>\n<button><i class=\"bi bi-lungs-fill\"></i></button>\n<button><i class=\"bi bi-lungs\"></i></button>\n<button><i class=\"bi bi-microsoft-teams\"></i></button>\n<button><i class=\"bi bi-p-circle-fill\"></i></button>\n<button><i class=\"bi bi-p-circle\"></i></button>\n<button><i class=\"bi bi-p-square-fill\"></i></button>\n<button><i class=\"bi bi-p-square\"></i></button>\n<button><i class=\"bi bi-pass-fill\"></i></button>\n<button><i class=\"bi bi-pass\"></i></button>\n<button><i class=\"bi bi-prescription\"></i></button>\n<button><i class=\"bi bi-prescription2\"></i></button>\n<button><i class=\"bi bi-r-circle-fill\"></i></button>\n<button><i class=\"bi bi-r-circle\"></i></button>\n<button><i class=\"bi bi-r-square-fill\"></i></button>\n<button><i class=\"bi bi-r-square\"></i></button>\n<button><i class=\"bi bi-repeat-1\"></i></button>\n<button><i class=\"bi bi-repeat\"></i></button>\n<button><i class=\"bi bi-rewind-btn-fill\"></i></button>\n<button><i class=\"bi bi-rewind-btn\"></i></button>\n<button><i class=\"bi bi-rewind-circle-fill\"></i></button>\n<button><i class=\"bi bi-rewind-circle\"></i></button>\n<button><i class=\"bi bi-rewind-fill\"></i></button>\n<button><i class=\"bi bi-rewind\"></i></button>\n<button><i class=\"bi bi-train-freight-front-fill\"></i></button>\n<button><i class=\"bi bi-train-freight-front\"></i></button>\n<button><i class=\"bi bi-train-front-fill\"></i></button>\n<button><i class=\"bi bi-train-front\"></i></button>\n<button><i class=\"bi bi-train-lightrail-front-fill\"></i></button>\n<button><i class=\"bi bi-train-lightrail-front\"></i></button>\n<button><i class=\"bi bi-truck-front-fill\"></i></button>\n<button><i class=\"bi bi-truck-front\"></i></button>\n<button><i class=\"bi bi-ubuntu\"></i></button>\n<button><i class=\"bi bi-unindent\"></i></button>\n<button><i class=\"bi bi-unity\"></i></button>\n<button><i class=\"bi bi-universal-access-circle\"></i></button>\n<button><i class=\"bi bi-universal-access\"></i></button>\n<button><i class=\"bi bi-virus\"></i></button>\n<button><i class=\"bi bi-virus2\"></i></button>\n<button><i class=\"bi bi-wechat\"></i></button>\n<button><i class=\"bi bi-yelp\"></i></button>\n<button><i class=\"bi bi-sign-stop-fill\"></i></button>\n<button><i class=\"bi bi-sign-stop-lights-fill\"></i></button>\n<button><i class=\"bi bi-sign-stop-lights\"></i></button>\n<button><i class=\"bi bi-sign-stop\"></i></button>\n<button><i class=\"bi bi-sign-turn-left-fill\"></i></button>\n<button><i class=\"bi bi-sign-turn-left\"></i></button>\n<button><i class=\"bi bi-sign-turn-right-fill\"></i></button>\n<button><i class=\"bi bi-sign-turn-right\"></i></button>\n<button><i class=\"bi bi-sign-turn-slight-left-fill\"></i></button>\n<button><i class=\"bi bi-sign-turn-slight-left\"></i></button>\n<button><i class=\"bi bi-sign-turn-slight-right-fill\"></i></button>\n<button><i class=\"bi bi-sign-turn-slight-right\"></i></button>\n<button><i class=\"bi bi-sign-yield-fill\"></i></button>\n<button><i class=\"bi bi-sign-yield\"></i></button>\n<button><i class=\"bi bi-ev-station-fill\"></i></button>\n<button><i class=\"bi bi-ev-station\"></i></button>\n<button><i class=\"bi bi-fuel-pump-diesel-fill\"></i></button>\n<button><i class=\"bi bi-fuel-pump-diesel\"></i></button>\n<button><i class=\"bi bi-fuel-pump-fill\"></i></button>\n<button><i class=\"bi bi-fuel-pump\"></i></button>\n<button><i class=\"bi bi-0-circle-fill\"></i></button>\n<button><i class=\"bi bi-0-circle\"></i></button>\n<button><i class=\"bi bi-0-square-fill\"></i></button>\n<button><i class=\"bi bi-0-square\"></i></button>\n<button><i class=\"bi bi-rocket-fill\"></i></button>\n<button><i class=\"bi bi-rocket-takeoff-fill\"></i></button>\n<button><i class=\"bi bi-rocket-takeoff\"></i></button>";
      html += "\n<button><i class=\"bi bi-rocket\"></i></button>\n<button><i class=\"bi bi-stripe\"></i></button>\n<button><i class=\"bi bi-subscript\"></i></button>\n<button><i class=\"bi bi-superscript\"></i></button>\n<button><i class=\"bi bi-trello\"></i></button>\n<button><i class=\"bi bi-envelope-at-fill\"></i></button>\n<button><i class=\"bi bi-envelope-at\"></i></button>\n<button><i class=\"bi bi-regex\"></i></button>\n<button><i class=\"bi bi-text-wrap\"></i></button>\n<button><i class=\"bi bi-sign-dead-end-fill\"></i></button>\n<button><i class=\"bi bi-sign-dead-end\"></i></button>\n<button><i class=\"bi bi-sign-do-not-enter-fill\"></i></button>\n<button><i class=\"bi bi-sign-do-not-enter\"></i></button>\n<button><i class=\"bi bi-sign-intersection-fill\"></i></button>\n<button><i class=\"bi bi-sign-intersection-side-fill\"></i></button>\n<button><i class=\"bi bi-sign-intersection-side\"></i></button>\n<button><i class=\"bi bi-sign-intersection-t-fill\"></i></button>\n<button><i class=\"bi bi-sign-intersection-t\"></i></button>\n<button><i class=\"bi bi-sign-intersection-y-fill\"></i></button>\n<button><i class=\"bi bi-sign-intersection-y\"></i></button>\n<button><i class=\"bi bi-sign-intersection\"></i></button>\n<button><i class=\"bi bi-sign-merge-left-fill\"></i></button>\n<button><i class=\"bi bi-sign-merge-left\"></i></button>\n<button><i class=\"bi bi-sign-merge-right-fill\"></i></button>\n<button><i class=\"bi bi-sign-merge-right\"></i></button>\n<button><i class=\"bi bi-sign-no-left-turn-fill\"></i></button>\n<button><i class=\"bi bi-sign-no-left-turn\"></i></button>\n<button><i class=\"bi bi-sign-no-parking-fill\"></i></button>\n<button><i class=\"bi bi-sign-no-parking\"></i></button>\n<button><i class=\"bi bi-sign-no-right-turn-fill\"></i></button>\n<button><i class=\"bi bi-sign-no-right-turn\"></i></button>\n<button><i class=\"bi bi-sign-railroad-fill\"></i></button>\n<button><i class=\"bi bi-sign-railroad\"></i></button>\n<button><i class=\"bi bi-building-add\"></i></button>\n<button><i class=\"bi bi-building-check\"></i></button>\n<button><i class=\"bi bi-building-dash\"></i></button>\n<button><i class=\"bi bi-building-down\"></i></button>\n<button><i class=\"bi bi-building-exclamation\"></i></button>\n<button><i class=\"bi bi-building-fill-add\"></i></button>\n<button><i class=\"bi bi-building-fill-check\"></i></button>\n<button><i class=\"bi bi-building-fill-dash\"></i></button>\n<button><i class=\"bi bi-building-fill-down\"></i></button>\n<button><i class=\"bi bi-building-fill-exclamation\"></i></button>\n<button><i class=\"bi bi-building-fill-gear\"></i></button>\n<button><i class=\"bi bi-building-fill-lock\"></i></button>\n<button><i class=\"bi bi-building-fill-slash\"></i></button>\n<button><i class=\"bi bi-building-fill-up\"></i></button>\n<button><i class=\"bi bi-building-fill-x\"></i></button>\n<button><i class=\"bi bi-building-fill\"></i></button>\n<button><i class=\"bi bi-building-gear\"></i></button>\n<button><i class=\"bi bi-building-lock\"></i></button>\n<button><i class=\"bi bi-building-slash\"></i></button>\n<button><i class=\"bi bi-building-up\"></i></button>\n<button><i class=\"bi bi-building-x\"></i></button>\n<button><i class=\"bi bi-buildings-fill\"></i></button>\n<button><i class=\"bi bi-buildings\"></i></button>\n<button><i class=\"bi bi-bus-front-fill\"></i></button>\n<button><i class=\"bi bi-bus-front\"></i></button>\n<button><i class=\"bi bi-ev-front-fill\"></i></button>\n<button><i class=\"bi bi-ev-front\"></i></button>\n<button><i class=\"bi bi-globe-americas\"></i></button>\n<button><i class=\"bi bi-globe-asia-australia\"></i></button>\n<button><i class=\"bi bi-globe-central-south-asia\"></i></button>\n<button><i class=\"bi bi-globe-europe-africa\"></i></button>\n<button><i class=\"bi bi-house-add-fill\"></i></button>\n<button><i class=\"bi bi-house-add\"></i></button>\n<button><i class=\"bi bi-house-check-fill\"></i></button>\n<button><i class=\"bi bi-house-check\"></i></button>\n<button><i class=\"bi bi-house-dash-fill\"></i></button>\n<button><i class=\"bi bi-house-dash\"></i></button>\n<button><i class=\"bi bi-house-down-fill\"></i></button>\n<button><i class=\"bi bi-house-down\"></i></button>\n<button><i class=\"bi bi-house-exclamation-fill\"></i></button>\n<button><i class=\"bi bi-house-exclamation\"></i></button>\n<button><i class=\"bi bi-house-gear-fill\"></i></button>\n<button><i class=\"bi bi-house-gear\"></i></button>\n<button><i class=\"bi bi-house-lock-fill\"></i></button>\n<button><i class=\"bi bi-house-lock\"></i></button>\n<button><i class=\"bi bi-house-slash-fill\"></i></button>\n<button><i class=\"bi bi-house-slash\"></i></button>\n<button><i class=\"bi bi-house-up-fill\"></i></button>\n<button><i class=\"bi bi-house-up\"></i></button>\n<button><i class=\"bi bi-house-x-fill\"></i></button>\n<button><i class=\"bi bi-house-x\"></i></button>\n<button><i class=\"bi bi-person-add\"></i></button>\n<button><i class=\"bi bi-person-down\"></i></button>\n<button><i class=\"bi bi-person-exclamation\"></i></button>\n<button><i class=\"bi bi-person-fill-add\"></i></button>\n<button><i class=\"bi bi-person-fill-check\"></i></button>\n<button><i class=\"bi bi-person-fill-dash\"></i></button>\n<button><i class=\"bi bi-person-fill-down\"></i></button>\n<button><i class=\"bi bi-person-fill-exclamation\"></i></button>\n<button><i class=\"bi bi-person-fill-gear\"></i></button>\n<button><i class=\"bi bi-person-fill-lock\"></i></button>\n<button><i class=\"bi bi-person-fill-slash\"></i></button>\n<button><i class=\"bi bi-person-fill-up\"></i></button>\n<button><i class=\"bi bi-person-fill-x\"></i></button>\n<button><i class=\"bi bi-person-gear\"></i></button>\n<button><i class=\"bi bi-person-lock\"></i></button>";
      html += "\n<button><i class=\"bi bi-person-slash\"></i></button>\n<button><i class=\"bi bi-person-up\"></i></button>\n<button><i class=\"bi bi-scooter\"></i></button>\n<button><i class=\"bi bi-taxi-front-fill\"></i></button>\n<button><i class=\"bi bi-taxi-front\"></i></button>\n<button><i class=\"bi bi-amd\"></i></button>\n<button><i class=\"bi bi-database-add\"></i></button>\n<button><i class=\"bi bi-database-check\"></i></button>\n<button><i class=\"bi bi-database-dash\"></i></button>\n<button><i class=\"bi bi-database-down\"></i></button>\n<button><i class=\"bi bi-database-exclamation\"></i></button>\n<button><i class=\"bi bi-database-fill-add\"></i></button>\n<button><i class=\"bi bi-database-fill-check\"></i></button>\n<button><i class=\"bi bi-database-fill-dash\"></i></button>\n<button><i class=\"bi bi-database-fill-down\"></i></button>\n<button><i class=\"bi bi-database-fill-exclamation\"></i></button>\n<button><i class=\"bi bi-database-fill-gear\"></i></button>\n<button><i class=\"bi bi-database-fill-lock\"></i></button>\n<button><i class=\"bi bi-database-fill-slash\"></i></button>\n<button><i class=\"bi bi-database-fill-up\"></i></button>\n<button><i class=\"bi bi-database-fill-x\"></i></button>\n<button><i class=\"bi bi-database-fill\"></i></button>\n<button><i class=\"bi bi-database-gear\"></i></button>\n<button><i class=\"bi bi-database-lock\"></i></button>\n<button><i class=\"bi bi-database-slash\"></i></button>\n<button><i class=\"bi bi-database-up\"></i></button>\n<button><i class=\"bi bi-database-x\"></i></button>\n<button><i class=\"bi bi-database\"></i></button>\n<button><i class=\"bi bi-houses-fill\"></i></button>\n<button><i class=\"bi bi-houses\"></i></button>\n<button><i class=\"bi bi-nvidia\"></i></button>\n<button><i class=\"bi bi-person-vcard-fill\"></i></button>\n<button><i class=\"bi bi-person-vcard\"></i></button>\n<button><i class=\"bi bi-sina-weibo\"></i></button>\n<button><i class=\"bi bi-tencent-qq\"></i></button>\n<button><i class=\"bi bi-wikipedia\"></i></button>\n<button><i class=\"bi bi-alphabet-uppercase\"></i></button>\n<button><i class=\"bi bi-alphabet\"></i></button>\n<button><i class=\"bi bi-amazon\"></i></button>\n<button><i class=\"bi bi-arrows-collapse-vertical\"></i></button>\n<button><i class=\"bi bi-arrows-expand-vertical\"></i></button>\n<button><i class=\"bi bi-arrows-vertical\"></i></button>\n<button><i class=\"bi bi-arrows\"></i></button>\n<button><i class=\"bi bi-ban-fill\"></i></button>\n<button><i class=\"bi bi-ban\"></i></button>\n<button><i class=\"bi bi-bing\"></i></button>\n<button><i class=\"bi bi-cake\"></i></button>\n<button><i class=\"bi bi-cake2\"></i></button>\n<button><i class=\"bi bi-cookie\"></i></button>\n<button><i class=\"bi bi-copy\"></i></button>\n<button><i class=\"bi bi-crosshair\"></i></button>\n<button><i class=\"bi bi-crosshair2\"></i></button>\n<button><i class=\"bi bi-emoji-astonished-fill\"></i></button>\n<button><i class=\"bi bi-emoji-astonished\"></i></button>\n<button><i class=\"bi bi-emoji-grimace-fill\"></i></button>\n<button><i class=\"bi bi-emoji-grimace\"></i></button>\n<button><i class=\"bi bi-emoji-grin-fill\"></i></button>\n<button><i class=\"bi bi-emoji-grin\"></i></button>\n<button><i class=\"bi bi-emoji-surprise-fill\"></i></button>\n<button><i class=\"bi bi-emoji-surprise\"></i></button>\n<button><i class=\"bi bi-emoji-tear-fill\"></i></button>\n<button><i class=\"bi bi-emoji-tear\"></i></button>\n<button><i class=\"bi bi-envelope-arrow-down-fill\"></i></button>\n<button><i class=\"bi bi-envelope-arrow-down\"></i></button>\n<button><i class=\"bi bi-envelope-arrow-up-fill\"></i></button>\n<button><i class=\"bi bi-envelope-arrow-up\"></i></button>\n<button><i class=\"bi bi-feather\"></i></button>\n<button><i class=\"bi bi-feather2\"></i></button>\n<button><i class=\"bi bi-floppy-fill\"></i></button>\n<button><i class=\"bi bi-floppy\"></i></button>\n<button><i class=\"bi bi-floppy2-fill\"></i></button>\n<button><i class=\"bi bi-floppy2\"></i></button>\n<button><i class=\"bi bi-gitlab\"></i></button>\n<button><i class=\"bi bi-highlighter\"></i></button>\n<button><i class=\"bi bi-marker-tip\"></i></button>\n<button><i class=\"bi bi-nvme-fill\"></i></button>\n<button><i class=\"bi bi-nvme\"></i></button>\n<button><i class=\"bi bi-opencollective\"></i></button>\n<button><i class=\"bi bi-pci-card-network\"></i></button>\n<button><i class=\"bi bi-pci-card-sound\"></i></button>\n<button><i class=\"bi bi-radar\"></i></button>\n<button><i class=\"bi bi-send-arrow-down-fill\"></i></button>\n<button><i class=\"bi bi-send-arrow-down\"></i></button>\n<button><i class=\"bi bi-send-arrow-up-fill\"></i></button>\n<button><i class=\"bi bi-send-arrow-up\"></i></button>\n<button><i class=\"bi bi-sim-slash-fill\"></i></button>\n<button><i class=\"bi bi-sim-slash\"></i></button>\n<button><i class=\"bi bi-sourceforge\"></i></button>\n<button><i class=\"bi bi-substack\"></i></button>\n<button><i class=\"bi bi-threads-fill\"></i></button>\n<button><i class=\"bi bi-threads\"></i></button>\n<button><i class=\"bi bi-transparency\"></i></button>\n<button><i class=\"bi bi-twitter-x\"></i></button>\n<button><i class=\"bi bi-type-h4\"></i></button>\n<button><i class=\"bi bi-type-h5\"></i></button>\n<button><i class=\"bi bi-type-h6\"></i></button>\n<button><i class=\"bi bi-backpack-fill\"></i></button>\n<button><i class=\"bi bi-backpack\"></i></button>\n<button><i class=\"bi bi-backpack2-fill\"></i></button>";
      html += "\n<button><i class=\"bi bi-backpack2\"></i></button>\n<button><i class=\"bi bi-backpack3-fill\"></i></button>\n<button><i class=\"bi bi-backpack3\"></i></button>\n<button><i class=\"bi bi-backpack4-fill\"></i></button>\n<button><i class=\"bi bi-backpack4\"></i></button>\n<button><i class=\"bi bi-brilliance\"></i></button>\n<button><i class=\"bi bi-cake-fill\"></i></button>\n<button><i class=\"bi bi-cake2-fill\"></i></button>\n<button><i class=\"bi bi-duffle-fill\"></i></button>\n<button><i class=\"bi bi-duffle\"></i></button>\n<button><i class=\"bi bi-exposure\"></i></button>\n<button><i class=\"bi bi-gender-neuter\"></i></button>\n<button><i class=\"bi bi-highlights\"></i></button>\n<button><i class=\"bi bi-luggage-fill\"></i></button>\n<button><i class=\"bi bi-luggage\"></i></button>\n<button><i class=\"bi bi-mailbox-flag\"></i></button>\n<button><i class=\"bi bi-mailbox2-flag\"></i></button>\n<button><i class=\"bi bi-noise-reduction\"></i></button>\n<button><i class=\"bi bi-passport-fill\"></i></button>\n<button><i class=\"bi bi-passport\"></i></button>\n<button><i class=\"bi bi-person-arms-up\"></i></button>\n<button><i class=\"bi bi-person-raised-hand\"></i></button>\n<button><i class=\"bi bi-person-standing-dress\"></i></button>\n<button><i class=\"bi bi-person-standing\"></i></button>\n<button><i class=\"bi bi-person-walking\"></i></button>\n<button><i class=\"bi bi-person-wheelchair\"></i></button>\n<button><i class=\"bi bi-shadows\"></i></button>\n<button><i class=\"bi bi-suitcase-fill\"></i></button>\n<button><i class=\"bi bi-suitcase-lg-fill\"></i></button>\n<button><i class=\"bi bi-suitcase-lg\"></i></button>\n<button><i class=\"bi bi-suitcase\"></i></button>\n<button><i class=\"bi bi-suitcase2-fill\"></i></button>\n<button><i class=\"bi bi-suitcase2\"></i></button>\n<button><i class=\"bi bi-vignette\"></i></button>\n        ";
      return html;
    }
  }, {
    key: "getIcons",
    value: function getIcons() {
      var html = "\n<button><i class=\"icon ion-alert\"> </i></button>\n<button><i class=\"icon ion-alert-circled\"> </i></button>\n<button><i class=\"icon ion-android-add\"> </i></button>\n<button><i class=\"icon ion-android-add-circle\"> </i></button>\n<button><i class=\"icon ion-android-alarm-clock\"> </i></button>\n<button><i class=\"icon ion-android-alert\"> </i></button>\n<button><i class=\"icon ion-android-apps\"> </i></button>\n<button><i class=\"icon ion-android-archive\"> </i></button>\n<button><i class=\"icon ion-android-arrow-back\"> </i></button>\n<button><i class=\"icon ion-android-arrow-down\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropdown\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropdown-circle\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropleft\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropleft-circle\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropright\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropright-circle\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropup\"> </i></button>\n<button><i class=\"icon ion-android-arrow-dropup-circle\"> </i></button>\n<button><i class=\"icon ion-android-arrow-forward\"> </i></button>\n<button><i class=\"icon ion-android-arrow-up\"> </i></button>\n<button><i class=\"icon ion-android-attach\"> </i></button>\n<button><i class=\"icon ion-android-bar\"> </i></button>\n<button><i class=\"icon ion-android-bicycle\"> </i></button>\n<button><i class=\"icon ion-android-boat\"> </i></button>\n<button><i class=\"icon ion-android-bookmark\"> </i></button>\n<button><i class=\"icon ion-android-bulb\"> </i></button>\n<button><i class=\"icon ion-android-bus\"> </i></button>\n<button><i class=\"icon ion-android-calendar\"> </i></button>\n<button><i class=\"icon ion-android-call\"> </i></button>\n<button><i class=\"icon ion-android-camera\"> </i></button>\n<button><i class=\"icon ion-android-cancel\"> </i></button>\n<button><i class=\"icon ion-android-car\"> </i></button>\n<button><i class=\"icon ion-android-cart\"> </i></button>\n<button><i class=\"icon ion-android-chat\"> </i></button>\n<button><i class=\"icon ion-android-checkbox\"> </i></button>\n<button><i class=\"icon ion-android-checkbox-blank\"> </i></button>\n<button><i class=\"icon ion-android-checkbox-outline\"> </i></button>\n<button><i class=\"icon ion-android-checkbox-outline-blank\"> </i></button>\n<button><i class=\"icon ion-android-checkmark-circle\"> </i></button>\n<button><i class=\"icon ion-android-clipboard\"> </i></button>\n<button><i class=\"icon ion-android-close\"> </i></button>\n<button><i class=\"icon ion-android-cloud\"> </i></button>\n<button><i class=\"icon ion-android-cloud-circle\"> </i></button>\n<button><i class=\"icon ion-android-cloud-done\"> </i></button>\n<button><i class=\"icon ion-android-cloud-outline\"> </i></button>\n<button><i class=\"icon ion-android-color-palette\"> </i></button>\n<button><i class=\"icon ion-android-compass\"> </i></button>\n<button><i class=\"icon ion-android-contact\"> </i></button>\n<button><i class=\"icon ion-android-contacts\"> </i></button>\n<button><i class=\"icon ion-android-contract\"> </i></button>\n<button><i class=\"icon ion-android-create\"> </i></button>\n<button><i class=\"icon ion-android-delete\"> </i></button>\n<button><i class=\"icon ion-android-desktop\"> </i></button>\n<button><i class=\"icon ion-android-document\"> </i></button>\n<button><i class=\"icon ion-android-done\"> </i></button>\n<button><i class=\"icon ion-android-done-all\"> </i></button>\n<button><i class=\"icon ion-android-download\"> </i></button>\n<button><i class=\"icon ion-android-drafts\"> </i></button>\n<button><i class=\"icon ion-android-exit\"> </i></button>\n<button><i class=\"icon ion-android-expand\"> </i></button>\n<button><i class=\"icon ion-android-favorite\"> </i></button>\n<button><i class=\"icon ion-android-favorite-outline\"> </i></button>\n<button><i class=\"icon ion-android-film\"> </i></button>\n<button><i class=\"icon ion-android-folder\"> </i></button>\n<button><i class=\"icon ion-android-folder-open\"> </i></button>\n<button><i class=\"icon ion-android-funnel\"> </i></button>\n<button><i class=\"icon ion-android-globe\"> </i></button>\n<button><i class=\"icon ion-android-hand\"> </i></button>\n<button><i class=\"icon ion-android-hangout\"> </i></button>\n<button><i class=\"icon ion-android-happy\"> </i></button>\n<button><i class=\"icon ion-android-home\"> </i></button>\n<button><i class=\"icon ion-android-image\"> </i></button>\n<button><i class=\"icon ion-android-laptop\"> </i></button>\n<button><i class=\"icon ion-android-list\"> </i></button>\n<button><i class=\"icon ion-android-locate\"> </i></button>\n<button><i class=\"icon ion-android-lock\"> </i></button>\n<button><i class=\"icon ion-android-mail\"> </i></button>\n<button><i class=\"icon ion-android-map\"> </i></button>\n<button><i class=\"icon ion-android-menu\"> </i></button>\n<button><i class=\"icon ion-android-microphone\"> </i></button>\n<button><i class=\"icon ion-android-microphone-off\"> </i></button>\n<button><i class=\"icon ion-android-more-horizontal\"> </i></button>\n<button><i class=\"icon ion-android-more-vertical\"> </i></button>\n<button><i class=\"icon ion-android-navigate\"> </i></button>\n<button><i class=\"icon ion-android-notifications\"> </i></button>\n<button><i class=\"icon ion-android-notifications-none\"> </i></button>\n<button><i class=\"icon ion-android-notifications-off\"> </i></button>\n<button><i class=\"icon ion-android-open\"> </i></button>\n<button><i class=\"icon ion-android-options\"> </i></button>\n<button><i class=\"icon ion-android-people\"> </i></button>\n<button><i class=\"icon ion-android-person\"> </i></button>\n<button><i class=\"icon ion-android-person-add\"> </i></button>\n<button><i class=\"icon ion-android-phone-landscape\"> </i></button>\n<button><i class=\"icon ion-android-phone-portrait\"> </i></button>\n<button><i class=\"icon ion-android-pin\"> </i></button>\n<button><i class=\"icon ion-android-plane\"> </i></button>\n<button><i class=\"icon ion-android-playstore\"> </i></button>\n<button><i class=\"icon ion-android-print\"> </i></button>\n<button><i class=\"icon ion-android-radio-button-off\"> </i></button>\n<button><i class=\"icon ion-android-radio-button-on\"> </i></button>\n<button><i class=\"icon ion-android-refresh\"> </i></button>\n<button><i class=\"icon ion-android-remove\"> </i></button>\n<button><i class=\"icon ion-android-remove-circle\"> </i></button>\n<button><i class=\"icon ion-android-restaurant\"> </i></button>\n<button><i class=\"icon ion-android-sad\"> </i></button>\n<button><i class=\"icon ion-android-search\"> </i></button>\n<button><i class=\"icon ion-android-send\"> </i></button>\n<button><i class=\"icon ion-android-settings\"> </i></button>\n<button><i class=\"icon ion-android-share\"> </i></button>\n<button><i class=\"icon ion-android-share-alt\"> </i></button>\n<button><i class=\"icon ion-android-star\"> </i></button>\n<button><i class=\"icon ion-android-star-half\"> </i></button>\n<button><i class=\"icon ion-android-star-outline\"> </i></button>\n<button><i class=\"icon ion-android-stopwatch\"> </i></button>\n<button><i class=\"icon ion-android-subway\"> </i></button>\n<button><i class=\"icon ion-android-sunny\"> </i></button>\n<button><i class=\"icon ion-android-sync\"> </i></button>\n<button><i class=\"icon ion-android-textsms\"> </i></button>";
      html += "\n<button><i class=\"icon ion-android-time\"> </i></button>\n<button><i class=\"icon ion-android-train\"> </i></button>\n<button><i class=\"icon ion-android-unlock\"> </i></button>\n<button><i class=\"icon ion-android-upload\"> </i></button>\n<button><i class=\"icon ion-android-volume-down\"> </i></button>\n<button><i class=\"icon ion-android-volume-mute\"> </i></button>\n<button><i class=\"icon ion-android-volume-off\"> </i></button>\n<button><i class=\"icon ion-android-volume-up\"> </i></button>\n<button><i class=\"icon ion-android-walk\"> </i></button>\n<button><i class=\"icon ion-android-warning\"> </i></button>\n<button><i class=\"icon ion-android-watch\"> </i></button>\n<button><i class=\"icon ion-android-wifi\"> </i></button>\n<button><i class=\"icon ion-aperture\"> </i></button>\n<button><i class=\"icon ion-archive\"> </i></button>\n<button><i class=\"icon ion-arrow-down-a\"> </i></button>\n<button><i class=\"icon ion-arrow-down-b\"> </i></button>\n<button><i class=\"icon ion-arrow-down-c\"> </i></button>\n<button><i class=\"icon ion-arrow-expand\"> </i></button>\n<button><i class=\"icon ion-arrow-graph-down-left\"> </i></button>\n<button><i class=\"icon ion-arrow-graph-down-right\"> </i></button>\n<button><i class=\"icon ion-arrow-graph-up-left\"> </i></button>\n<button><i class=\"icon ion-arrow-graph-up-right\"> </i></button>\n<button><i class=\"icon ion-arrow-left-a\"> </i></button>\n<button><i class=\"icon ion-arrow-left-b\"> </i></button>\n<button><i class=\"icon ion-arrow-left-c\"> </i></button>\n<button><i class=\"icon ion-arrow-move\"> </i></button>\n<button><i class=\"icon ion-arrow-resize\"> </i></button>\n<button><i class=\"icon ion-arrow-return-left\"> </i></button>\n<button><i class=\"icon ion-arrow-return-right\"> </i></button>\n<button><i class=\"icon ion-arrow-right-a\"> </i></button>\n<button><i class=\"icon ion-arrow-right-b\"> </i></button>\n<button><i class=\"icon ion-arrow-right-c\"> </i></button>\n<button><i class=\"icon ion-arrow-shrink\"> </i></button>\n<button><i class=\"icon ion-arrow-swap\"> </i></button>\n<button><i class=\"icon ion-arrow-up-a\"> </i></button>\n<button><i class=\"icon ion-arrow-up-b\"> </i></button>\n<button><i class=\"icon ion-arrow-up-c\"> </i></button>\n<button><i class=\"icon ion-asterisk\"> </i></button>\n<button><i class=\"icon ion-at\"> </i></button>\n<button><i class=\"icon ion-backspace\"> </i></button>\n<button><i class=\"icon ion-backspace-outline\"> </i></button>\n<button><i class=\"icon ion-bag\"> </i></button>\n<button><i class=\"icon ion-battery-charging\"> </i></button>\n<button><i class=\"icon ion-battery-empty\"> </i></button>\n<button><i class=\"icon ion-battery-full\"> </i></button>\n<button><i class=\"icon ion-battery-half\"> </i></button>\n<button><i class=\"icon ion-battery-low\"> </i></button>\n<button><i class=\"icon ion-beaker\"> </i></button>\n<button><i class=\"icon ion-beer\"> </i></button>\n<button><i class=\"icon ion-bluetooth\"> </i></button>\n<button><i class=\"icon ion-bonfire\"> </i></button>\n<button><i class=\"icon ion-bookmark\"> </i></button>\n<button><i class=\"icon ion-bowtie\"> </i></button>\n<button><i class=\"icon ion-briefcase\"> </i></button>\n<button><i class=\"icon ion-bug\"> </i></button>\n<button><i class=\"icon ion-calculator\"> </i></button>\n<button><i class=\"icon ion-calendar\"> </i></button>\n<button><i class=\"icon ion-camera\"> </i></button>\n<button><i class=\"icon ion-card\"> </i></button>\n<button><i class=\"icon ion-cash\"> </i></button>\n<button><i class=\"icon ion-chatbox\"> </i></button>\n<button><i class=\"icon ion-chatbox-working\"> </i></button>\n<button><i class=\"icon ion-chatboxes\"> </i></button>\n<button><i class=\"icon ion-chatbubble\"> </i></button>\n<button><i class=\"icon ion-chatbubble-working\"> </i></button>\n<button><i class=\"icon ion-chatbubbles\"> </i></button>\n<button><i class=\"icon ion-checkmark\"> </i></button>\n<button><i class=\"icon ion-checkmark-circled\"> </i></button>\n<button><i class=\"icon ion-checkmark-round\"> </i></button>\n<button><i class=\"icon ion-chevron-down\"> </i></button>\n<button><i class=\"icon ion-chevron-left\"> </i></button>\n<button><i class=\"icon ion-chevron-right\"> </i></button>\n<button><i class=\"icon ion-chevron-up\"> </i></button>\n<button><i class=\"icon ion-clipboard\"> </i></button>\n<button><i class=\"icon ion-clock\"> </i></button>\n<button><i class=\"icon ion-close\"> </i></button>\n<button><i class=\"icon ion-close-circled\"> </i></button>\n<button><i class=\"icon ion-close-round\"> </i></button>\n<button><i class=\"icon ion-closed-captioning\"> </i></button>\n<button><i class=\"icon ion-cloud\"> </i></button>\n<button><i class=\"icon ion-code\"> </i></button>\n<button><i class=\"icon ion-code-download\"> </i></button>\n<button><i class=\"icon ion-code-working\"> </i></button>\n<button><i class=\"icon ion-coffee\"> </i></button>\n<button><i class=\"icon ion-compass\"> </i></button>\n<button><i class=\"icon ion-compose\"> </i></button>\n<button><i class=\"icon ion-connection-bars\"> </i></button>\n<button><i class=\"icon ion-contrast\"> </i></button>\n<button><i class=\"icon ion-crop\"> </i></button>\n<button><i class=\"icon ion-cube\"> </i></button>\n<button><i class=\"icon ion-disc\"> </i></button>\n<button><i class=\"icon ion-document\"> </i></button>\n<button><i class=\"icon ion-document-text\"> </i></button>\n<button><i class=\"icon ion-drag\"> </i></button>\n<button><i class=\"icon ion-earth\"> </i></button>\n<button><i class=\"icon ion-easel\"> </i></button>\n<button><i class=\"icon ion-edit\"> </i></button>\n<button><i class=\"icon ion-egg\"> </i></button>\n<button><i class=\"icon ion-eject\"> </i></button>\n<button><i class=\"icon ion-email\"> </i></button>\n<button><i class=\"icon ion-email-unread\"> </i></button>\n<button><i class=\"icon ion-erlenmeyer-flask\"> </i></button>\n<button><i class=\"icon ion-erlenmeyer-flask-bubbles\"> </i></button>\n<button><i class=\"icon ion-eye\"> </i></button>\n<button><i class=\"icon ion-eye-disabled\"> </i></button>\n<button><i class=\"icon ion-female\"> </i></button>\n<button><i class=\"icon ion-filing\"> </i></button>\n<button><i class=\"icon ion-film-marker\"> </i></button>\n<button><i class=\"icon ion-fireball\"> </i></button>\n<button><i class=\"icon ion-flag\"> </i></button>\n<button><i class=\"icon ion-flame\"> </i></button>\n<button><i class=\"icon ion-flash\"> </i></button>\n<button><i class=\"icon ion-flash-off\"> </i></button>\n<button><i class=\"icon ion-folder\"> </i></button>\n<button><i class=\"icon ion-fork\"> </i></button>\n<button><i class=\"icon ion-fork-repo\"> </i></button>\n<button><i class=\"icon ion-forward\"> </i></button>\n<button><i class=\"icon ion-funnel\"> </i></button>\n<button><i class=\"icon ion-gear-a\"> </i></button>\n<button><i class=\"icon ion-gear-b\"> </i></button>\n<button><i class=\"icon ion-grid\"> </i></button>\n<button><i class=\"icon ion-hammer\"> </i></button>\n<button><i class=\"icon ion-happy\"> </i></button>\n<button><i class=\"icon ion-happy-outline\"> </i></button>\n<button><i class=\"icon ion-headphone\"> </i></button>\n<button><i class=\"icon ion-heart\"> </i></button>\n<button><i class=\"icon ion-heart-broken\"> </i></button>\n<button><i class=\"icon ion-help\"> </i></button>\n<button><i class=\"icon ion-help-buoy\"> </i></button>\n<button><i class=\"icon ion-help-circled\"> </i></button>\n<button><i class=\"icon ion-home\"> </i></button>\n<button><i class=\"icon ion-icecream\"> </i></button>\n<button><i class=\"icon ion-image\"> </i></button>\n<button><i class=\"icon ion-images\"> </i></button>\n<button><i class=\"icon ion-information\"> </i></button>\n<button><i class=\"icon ion-information-circled\"> </i></button>\n<button><i class=\"icon ion-ionic\"> </i></button>\n<button><i class=\"icon ion-ios-alarm\"> </i></button>\n<button><i class=\"icon ion-ios-alarm-outline\"> </i></button>\n<button><i class=\"icon ion-ios-albums\"> </i></button>\n<button><i class=\"icon ion-ios-albums-outline\"> </i></button>\n<button><i class=\"icon ion-ios-americanfootball\"> </i></button>\n<button><i class=\"icon ion-ios-americanfootball-outline\"> </i></button>\n<button><i class=\"icon ion-ios-analytics\"> </i></button>\n<button><i class=\"icon ion-ios-analytics-outline\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-back\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-down\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-forward\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-left\"> </i></button>";
      html += "\n<button><i class=\"icon ion-ios-arrow-right\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-thin-down\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-thin-left\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-thin-right\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-thin-up\"> </i></button>\n<button><i class=\"icon ion-ios-arrow-up\"> </i></button>\n<button><i class=\"icon ion-ios-at\"> </i></button>\n<button><i class=\"icon ion-ios-at-outline\"> </i></button>\n<button><i class=\"icon ion-ios-barcode\"> </i></button>\n<button><i class=\"icon ion-ios-barcode-outline\"> </i></button>\n<button><i class=\"icon ion-ios-baseball\"> </i></button>\n<button><i class=\"icon ion-ios-baseball-outline\"> </i></button>\n<button><i class=\"icon ion-ios-basketball\"> </i></button>\n<button><i class=\"icon ion-ios-basketball-outline\"> </i></button>\n<button><i class=\"icon ion-ios-bell\"> </i></button>\n<button><i class=\"icon ion-ios-bell-outline\"> </i></button>\n<button><i class=\"icon ion-ios-body\"> </i></button>\n<button><i class=\"icon ion-ios-body-outline\"> </i></button>\n<button><i class=\"icon ion-ios-bolt\"> </i></button>\n<button><i class=\"icon ion-ios-bolt-outline\"> </i></button>\n<button><i class=\"icon ion-ios-book\"> </i></button>\n<button><i class=\"icon ion-ios-book-outline\"> </i></button>\n<button><i class=\"icon ion-ios-bookmarks\"> </i></button>\n<button><i class=\"icon ion-ios-bookmarks-outline\"> </i></button>\n<button><i class=\"icon ion-ios-box\"> </i></button>\n<button><i class=\"icon ion-ios-box-outline\"> </i></button>\n<button><i class=\"icon ion-ios-briefcase\"> </i></button>\n<button><i class=\"icon ion-ios-briefcase-outline\"> </i></button>\n<button><i class=\"icon ion-ios-browsers\"> </i></button>\n<button><i class=\"icon ion-ios-browsers-outline\"> </i></button>\n<button><i class=\"icon ion-ios-calculator\"> </i></button>\n<button><i class=\"icon ion-ios-calculator-outline\"> </i></button>\n<button><i class=\"icon ion-ios-calendar\"> </i></button>\n<button><i class=\"icon ion-ios-calendar-outline\"> </i></button>\n<button><i class=\"icon ion-ios-camera\"> </i></button>\n<button><i class=\"icon ion-ios-camera-outline\"> </i></button>\n<button><i class=\"icon ion-ios-cart\"> </i></button>\n<button><i class=\"icon ion-ios-cart-outline\"> </i></button>\n<button><i class=\"icon ion-ios-chatboxes\"> </i></button>\n<button><i class=\"icon ion-ios-chatboxes-outline\"> </i></button>\n<button><i class=\"icon ion-ios-chatbubble\"> </i></button>\n<button><i class=\"icon ion-ios-chatbubble-outline\"> </i></button>\n<button><i class=\"icon ion-ios-checkmark\"> </i></button>\n<button><i class=\"icon ion-ios-checkmark-empty\"> </i></button>\n<button><i class=\"icon ion-ios-checkmark-outline\"> </i></button>\n<button><i class=\"icon ion-ios-circle-filled\"> </i></button>\n<button><i class=\"icon ion-ios-circle-outline\"> </i></button>\n<button><i class=\"icon ion-ios-clock\"> </i></button>\n<button><i class=\"icon ion-ios-clock-outline\"> </i></button>\n<button><i class=\"icon ion-ios-close\"> </i></button>\n<button><i class=\"icon ion-ios-close-empty\"> </i></button>\n<button><i class=\"icon ion-ios-close-outline\"> </i></button>\n<button><i class=\"icon ion-ios-cloud\"> </i></button>\n<button><i class=\"icon ion-ios-cloud-download\"> </i></button>\n<button><i class=\"icon ion-ios-cloud-download-outline\"> </i></button>\n<button><i class=\"icon ion-ios-cloud-outline\"> </i></button>\n<button><i class=\"icon ion-ios-cloud-upload\"> </i></button>\n<button><i class=\"icon ion-ios-cloud-upload-outline\"> </i></button>\n<button><i class=\"icon ion-ios-cloudy\"> </i></button>\n<button><i class=\"icon ion-ios-cloudy-night\"> </i></button>\n<button><i class=\"icon ion-ios-cloudy-night-outline\"> </i></button>\n<button><i class=\"icon ion-ios-cloudy-outline\"> </i></button>\n<button><i class=\"icon ion-ios-cog\"> </i></button>\n<button><i class=\"icon ion-ios-cog-outline\"> </i></button>\n<button><i class=\"icon ion-ios-color-filter\"> </i></button>\n<button><i class=\"icon ion-ios-color-filter-outline\"> </i></button>\n<button><i class=\"icon ion-ios-color-wand\"> </i></button>\n<button><i class=\"icon ion-ios-color-wand-outline\"> </i></button>\n<button><i class=\"icon ion-ios-compose\"> </i></button>\n<button><i class=\"icon ion-ios-compose-outline\"> </i></button>\n<button><i class=\"icon ion-ios-contact\"> </i></button>\n<button><i class=\"icon ion-ios-contact-outline\"> </i></button>\n<button><i class=\"icon ion-ios-copy\"> </i></button>\n<button><i class=\"icon ion-ios-copy-outline\"> </i></button>\n<button><i class=\"icon ion-ios-crop\"> </i></button>\n<button><i class=\"icon ion-ios-crop-strong\"> </i></button>\n<button><i class=\"icon ion-ios-download\"> </i></button>\n<button><i class=\"icon ion-ios-download-outline\"> </i></button>\n<button><i class=\"icon ion-ios-drag\"> </i></button>\n<button><i class=\"icon ion-ios-email\"> </i></button>\n<button><i class=\"icon ion-ios-email-outline\"> </i></button>\n<button><i class=\"icon ion-ios-eye\"> </i></button>\n<button><i class=\"icon ion-ios-eye-outline\"> </i></button>\n<button><i class=\"icon ion-ios-fastforward\"> </i></button>\n<button><i class=\"icon ion-ios-fastforward-outline\"> </i></button>\n<button><i class=\"icon ion-ios-filing\"> </i></button>\n<button><i class=\"icon ion-ios-filing-outline\"> </i></button>\n<button><i class=\"icon ion-ios-film\"> </i></button>\n<button><i class=\"icon ion-ios-film-outline\"> </i></button>\n<button><i class=\"icon ion-ios-flag\"> </i></button>\n<button><i class=\"icon ion-ios-flag-outline\"> </i></button>\n<button><i class=\"icon ion-ios-flame\"> </i></button>\n<button><i class=\"icon ion-ios-flame-outline\"> </i></button>\n<button><i class=\"icon ion-ios-flask\"> </i></button>\n<button><i class=\"icon ion-ios-flask-outline\"> </i></button>\n<button><i class=\"icon ion-ios-flower\"> </i></button>\n<button><i class=\"icon ion-ios-flower-outline\"> </i></button>\n<button><i class=\"icon ion-ios-folder\"> </i></button>\n<button><i class=\"icon ion-ios-folder-outline\"> </i></button>\n<button><i class=\"icon ion-ios-football\"> </i></button>\n<button><i class=\"icon ion-ios-football-outline\"> </i></button>\n<button><i class=\"icon ion-ios-game-controller-a\"> </i></button>\n<button><i class=\"icon ion-ios-game-controller-a-outline\"> </i></button>\n<button><i class=\"icon ion-ios-game-controller-b\"> </i></button>\n<button><i class=\"icon ion-ios-game-controller-b-outline\"> </i></button>\n<button><i class=\"icon ion-ios-gear\"> </i></button>\n<button><i class=\"icon ion-ios-gear-outline\"> </i></button>\n<button><i class=\"icon ion-ios-glasses\"> </i></button>\n<button><i class=\"icon ion-ios-glasses-outline\"> </i></button>\n<button><i class=\"icon ion-ios-grid-view\"> </i></button>\n<button><i class=\"icon ion-ios-grid-view-outline\"> </i></button>\n<button><i class=\"icon ion-ios-heart\"> </i></button>\n<button><i class=\"icon ion-ios-heart-outline\"> </i></button>\n<button><i class=\"icon ion-ios-help\"> </i></button>\n<button><i class=\"icon ion-ios-help-empty\"> </i></button>\n<button><i class=\"icon ion-ios-help-outline\"> </i></button>\n<button><i class=\"icon ion-ios-home\"> </i></button>\n<button><i class=\"icon ion-ios-home-outline\"> </i></button>\n<button><i class=\"icon ion-ios-infinite\"> </i></button>\n<button><i class=\"icon ion-ios-infinite-outline\"> </i></button>\n<button><i class=\"icon ion-ios-information\"> </i></button>\n<button><i class=\"icon ion-ios-information-empty\"> </i></button>\n<button><i class=\"icon ion-ios-information-outline\"> </i></button>\n<button><i class=\"icon ion-ios-ionic-outline\"> </i></button>\n<button><i class=\"icon ion-ios-keypad\"> </i></button>\n<button><i class=\"icon ion-ios-keypad-outline\"> </i></button>\n<button><i class=\"icon ion-ios-lightbulb\"> </i></button>\n<button><i class=\"icon ion-ios-lightbulb-outline\"> </i></button>\n<button><i class=\"icon ion-ios-list\"> </i></button>\n<button><i class=\"icon ion-ios-list-outline\"> </i></button>\n<button><i class=\"icon ion-ios-location\"> </i></button>\n<button><i class=\"icon ion-ios-location-outline\"> </i></button>\n<button><i class=\"icon ion-ios-locked\"> </i></button>\n<button><i class=\"icon ion-ios-locked-outline\"> </i></button>\n<button><i class=\"icon ion-ios-loop\"> </i></button>\n<button><i class=\"icon ion-ios-loop-strong\"> </i></button>\n<button><i class=\"icon ion-ios-medical\"> </i></button>\n<button><i class=\"icon ion-ios-medical-outline\"> </i></button>\n<button><i class=\"icon ion-ios-medkit\"> </i></button>\n<button><i class=\"icon ion-ios-medkit-outline\"> </i></button>\n<button><i class=\"icon ion-ios-mic\"> </i></button>\n<button><i class=\"icon ion-ios-mic-off\"> </i></button>\n<button><i class=\"icon ion-ios-mic-outline\"> </i></button>\n<button><i class=\"icon ion-ios-minus\"> </i></button>\n<button><i class=\"icon ion-ios-minus-empty\"> </i></button>\n<button><i class=\"icon ion-ios-minus-outline\"> </i></button>\n<button><i class=\"icon ion-ios-monitor\"> </i></button>\n<button><i class=\"icon ion-ios-monitor-outline\"> </i></button>";
      html += "\n<button><i class=\"icon ion-ios-moon\"> </i></button>\n<button><i class=\"icon ion-ios-moon-outline\"> </i></button>\n<button><i class=\"icon ion-ios-more\"> </i></button>\n<button><i class=\"icon ion-ios-more-outline\"> </i></button>\n<button><i class=\"icon ion-ios-musical-note\"> </i></button>\n<button><i class=\"icon ion-ios-musical-notes\"> </i></button>\n<button><i class=\"icon ion-ios-navigate\"> </i></button>\n<button><i class=\"icon ion-ios-navigate-outline\"> </i></button>\n<button><i class=\"icon ion-ios-nutrition\"> </i></button>\n<button><i class=\"icon ion-ios-nutrition-outline\"> </i></button>\n<button><i class=\"icon ion-ios-paper\"> </i></button>\n<button><i class=\"icon ion-ios-paper-outline\"> </i></button>\n<button><i class=\"icon ion-ios-paperplane\"> </i></button>\n<button><i class=\"icon ion-ios-paperplane-outline\"> </i></button>\n<button><i class=\"icon ion-ios-partlysunny\"> </i></button>\n<button><i class=\"icon ion-ios-partlysunny-outline\"> </i></button>\n<button><i class=\"icon ion-ios-pause\"> </i></button>\n<button><i class=\"icon ion-ios-pause-outline\"> </i></button>\n<button><i class=\"icon ion-ios-paw\"> </i></button>\n<button><i class=\"icon ion-ios-paw-outline\"> </i></button>\n<button><i class=\"icon ion-ios-people\"> </i></button>\n<button><i class=\"icon ion-ios-people-outline\"> </i></button>\n<button><i class=\"icon ion-ios-person\"> </i></button>\n<button><i class=\"icon ion-ios-person-outline\"> </i></button>\n<button><i class=\"icon ion-ios-personadd\"> </i></button>\n<button><i class=\"icon ion-ios-personadd-outline\"> </i></button>\n<button><i class=\"icon ion-ios-photos\"> </i></button>\n<button><i class=\"icon ion-ios-photos-outline\"> </i></button>\n<button><i class=\"icon ion-ios-pie\"> </i></button>\n<button><i class=\"icon ion-ios-pie-outline\"> </i></button>\n<button><i class=\"icon ion-ios-pint\"> </i></button>\n<button><i class=\"icon ion-ios-pint-outline\"> </i></button>\n<button><i class=\"icon ion-ios-play\"> </i></button>\n<button><i class=\"icon ion-ios-play-outline\"> </i></button>\n<button><i class=\"icon ion-ios-plus\"> </i></button>\n<button><i class=\"icon ion-ios-plus-empty\"> </i></button>\n<button><i class=\"icon ion-ios-plus-outline\"> </i></button>\n<button><i class=\"icon ion-ios-pricetag\"> </i></button>\n<button><i class=\"icon ion-ios-pricetag-outline\"> </i></button>\n<button><i class=\"icon ion-ios-pricetags\"> </i></button>\n<button><i class=\"icon ion-ios-pricetags-outline\"> </i></button>\n<button><i class=\"icon ion-ios-printer\"> </i></button>\n<button><i class=\"icon ion-ios-printer-outline\"> </i></button>\n<button><i class=\"icon ion-ios-pulse\"> </i></button>\n<button><i class=\"icon ion-ios-pulse-strong\"> </i></button>\n<button><i class=\"icon ion-ios-rainy\"> </i></button>\n<button><i class=\"icon ion-ios-rainy-outline\"> </i></button>\n<button><i class=\"icon ion-ios-recording\"> </i></button>\n<button><i class=\"icon ion-ios-recording-outline\"> </i></button>\n<button><i class=\"icon ion-ios-redo\"> </i></button>\n<button><i class=\"icon ion-ios-redo-outline\"> </i></button>\n<button><i class=\"icon ion-ios-refresh\"> </i></button>\n<button><i class=\"icon ion-ios-refresh-empty\"> </i></button>\n<button><i class=\"icon ion-ios-refresh-outline\"> </i></button>\n<button><i class=\"icon ion-ios-reload\"> </i></button>\n<button><i class=\"icon ion-ios-reverse-camera\"> </i></button>\n<button><i class=\"icon ion-ios-reverse-camera-outline\"> </i></button>\n<button><i class=\"icon ion-ios-rewind\"> </i></button>\n<button><i class=\"icon ion-ios-rewind-outline\"> </i></button>\n<button><i class=\"icon ion-ios-rose\"> </i></button>\n<button><i class=\"icon ion-ios-rose-outline\"> </i></button>\n<button><i class=\"icon ion-ios-search\"> </i></button>\n<button><i class=\"icon ion-ios-search-strong\"> </i></button>\n<button><i class=\"icon ion-ios-settings\"> </i></button>\n<button><i class=\"icon ion-ios-settings-strong\"> </i></button>\n<button><i class=\"icon ion-ios-shuffle\"> </i></button>\n<button><i class=\"icon ion-ios-shuffle-strong\"> </i></button>\n<button><i class=\"icon ion-ios-skipbackward\"> </i></button>\n<button><i class=\"icon ion-ios-skipbackward-outline\"> </i></button>\n<button><i class=\"icon ion-ios-skipforward\"> </i></button>\n<button><i class=\"icon ion-ios-skipforward-outline\"> </i></button>\n<button><i class=\"icon ion-ios-snowy\"> </i></button>\n<button><i class=\"icon ion-ios-speedometer\"> </i></button>\n<button><i class=\"icon ion-ios-speedometer-outline\"> </i></button>\n<button><i class=\"icon ion-ios-star\"> </i></button>\n<button><i class=\"icon ion-ios-star-half\"> </i></button>\n<button><i class=\"icon ion-ios-star-outline\"> </i></button>\n<button><i class=\"icon ion-ios-stopwatch\"> </i></button>\n<button><i class=\"icon ion-ios-stopwatch-outline\"> </i></button>\n<button><i class=\"icon ion-ios-sunny\"> </i></button>\n<button><i class=\"icon ion-ios-sunny-outline\"> </i></button>\n<button><i class=\"icon ion-ios-telephone\"> </i></button>\n<button><i class=\"icon ion-ios-telephone-outline\"> </i></button>\n<button><i class=\"icon ion-ios-tennisball\"> </i></button>\n<button><i class=\"icon ion-ios-tennisball-outline\"> </i></button>\n<button><i class=\"icon ion-ios-thunderstorm\"> </i></button>\n<button><i class=\"icon ion-ios-thunderstorm-outline\"> </i></button>\n<button><i class=\"icon ion-ios-time\"> </i></button>\n<button><i class=\"icon ion-ios-time-outline\"> </i></button>\n<button><i class=\"icon ion-ios-timer\"> </i></button>\n<button><i class=\"icon ion-ios-timer-outline\"> </i></button>\n<button><i class=\"icon ion-ios-toggle\"> </i></button>\n<button><i class=\"icon ion-ios-toggle-outline\"> </i></button>\n<button><i class=\"icon ion-ios-trash\"> </i></button>\n<button><i class=\"icon ion-ios-trash-outline\"> </i></button>\n<button><i class=\"icon ion-ios-undo\"> </i></button>\n<button><i class=\"icon ion-ios-undo-outline\"> </i></button>\n<button><i class=\"icon ion-ios-unlocked\"> </i></button>\n<button><i class=\"icon ion-ios-unlocked-outline\"> </i></button>\n<button><i class=\"icon ion-ios-upload\"> </i></button>\n<button><i class=\"icon ion-ios-upload-outline\"> </i></button>\n<button><i class=\"icon ion-ios-videocam\"> </i></button>\n<button><i class=\"icon ion-ios-videocam-outline\"> </i></button>\n<button><i class=\"icon ion-ios-volume-high\"> </i></button>\n<button><i class=\"icon ion-ios-volume-low\"> </i></button>\n<button><i class=\"icon ion-ios-wineglass\"> </i></button>\n<button><i class=\"icon ion-ios-wineglass-outline\"> </i></button>\n<button><i class=\"icon ion-ios-world\"> </i></button>\n<button><i class=\"icon ion-ios-world-outline\"> </i></button>\n<button><i class=\"icon ion-ipad\"> </i></button>\n<button><i class=\"icon ion-iphone\"> </i></button>\n<button><i class=\"icon ion-ipod\"> </i></button>\n<button><i class=\"icon ion-jet\"> </i></button>\n<button><i class=\"icon ion-key\"> </i></button>\n<button><i class=\"icon ion-knife\"> </i></button>\n<button><i class=\"icon ion-laptop\"> </i></button>\n<button><i class=\"icon ion-leaf\"> </i></button>\n<button><i class=\"icon ion-levels\"> </i></button>\n<button><i class=\"icon ion-lightbulb\"> </i></button>\n<button><i class=\"icon ion-link\"> </i></button>\n<button><i class=\"icon ion-load-a\"> </i></button>\n<button><i class=\"icon ion-load-b\"> </i></button>\n<button><i class=\"icon ion-load-c\"> </i></button>\n<button><i class=\"icon ion-load-d\"> </i></button>\n<button><i class=\"icon ion-location\"> </i></button>\n<button><i class=\"icon ion-lock-combination\"> </i></button>\n<button><i class=\"icon ion-locked\"> </i></button>\n<button><i class=\"icon ion-log-in\"> </i></button>\n<button><i class=\"icon ion-log-out\"> </i></button>\n<button><i class=\"icon ion-loop\"> </i></button>\n<button><i class=\"icon ion-magnet\"> </i></button>\n<button><i class=\"icon ion-male\"> </i></button>\n<button><i class=\"icon ion-man\"> </i></button>\n<button><i class=\"icon ion-map\"> </i></button>\n<button><i class=\"icon ion-medkit\"> </i></button>\n<button><i class=\"icon ion-merge\"> </i></button>\n<button><i class=\"icon ion-mic-a\"> </i></button>\n<button><i class=\"icon ion-mic-b\"> </i></button>\n<button><i class=\"icon ion-mic-c\"> </i></button>\n<button><i class=\"icon ion-minus\"> </i></button>\n<button><i class=\"icon ion-minus-circled\"> </i></button>\n<button><i class=\"icon ion-minus-round\"> </i></button>\n<button><i class=\"icon ion-model-s\"> </i></button>\n<button><i class=\"icon ion-monitor\"> </i></button>\n<button><i class=\"icon ion-more\"> </i></button>\n<button><i class=\"icon ion-mouse\"> </i></button>\n<button><i class=\"icon ion-music-note\"> </i></button>\n<button><i class=\"icon ion-navicon\"> </i></button>\n<button><i class=\"icon ion-navicon-round\"> </i></button>\n<button><i class=\"icon ion-navigate\"> </i></button>";
      html += "\n<button><i class=\"icon ion-network\"> </i></button>\n<button><i class=\"icon ion-no-smoking\"> </i></button>\n<button><i class=\"icon ion-nuclear\"> </i></button>\n<button><i class=\"icon ion-outlet\"> </i></button>\n<button><i class=\"icon ion-paintbrush\"> </i></button>\n<button><i class=\"icon ion-paintbucket\"> </i></button>\n<button><i class=\"icon ion-paper-airplane\"> </i></button>\n<button><i class=\"icon ion-paperclip\"> </i></button>\n<button><i class=\"icon ion-pause\"> </i></button>\n<button><i class=\"icon ion-person\"> </i></button>\n<button><i class=\"icon ion-person-add\"> </i></button>\n<button><i class=\"icon ion-person-stalker\"> </i></button>\n<button><i class=\"icon ion-pie-graph\"> </i></button>\n<button><i class=\"icon ion-pin\"> </i></button>\n<button><i class=\"icon ion-pinpoint\"> </i></button>\n<button><i class=\"icon ion-pizza\"> </i></button>\n<button><i class=\"icon ion-plane\"> </i></button>\n<button><i class=\"icon ion-planet\"> </i></button>\n<button><i class=\"icon ion-play\"> </i></button>\n<button><i class=\"icon ion-playstation\"> </i></button>\n<button><i class=\"icon ion-plus\"> </i></button>\n<button><i class=\"icon ion-plus-circled\"> </i></button>\n<button><i class=\"icon ion-plus-round\"> </i></button>\n<button><i class=\"icon ion-podium\"> </i></button>\n<button><i class=\"icon ion-pound\"> </i></button>\n<button><i class=\"icon ion-power\"> </i></button>\n<button><i class=\"icon ion-pricetag\"> </i></button>\n<button><i class=\"icon ion-pricetags\"> </i></button>\n<button><i class=\"icon ion-printer\"> </i></button>\n<button><i class=\"icon ion-pull-request\"> </i></button>\n<button><i class=\"icon ion-qr-scanner\"> </i></button>\n<button><i class=\"icon ion-quote\"> </i></button>\n<button><i class=\"icon ion-radio-waves\"> </i></button>\n<button><i class=\"icon ion-record\"> </i></button>\n<button><i class=\"icon ion-refresh\"> </i></button>\n<button><i class=\"icon ion-reply\"> </i></button>\n<button><i class=\"icon ion-reply-all\"> </i></button>\n<button><i class=\"icon ion-ribbon-a\"> </i></button>\n<button><i class=\"icon ion-ribbon-b\"> </i></button>\n<button><i class=\"icon ion-sad\"> </i></button>\n<button><i class=\"icon ion-sad-outline\"> </i></button>\n<button><i class=\"icon ion-scissors\"> </i></button>\n<button><i class=\"icon ion-search\"> </i></button>\n<button><i class=\"icon ion-settings\"> </i></button>\n<button><i class=\"icon ion-share\"> </i></button>\n<button><i class=\"icon ion-shuffle\"> </i></button>\n<button><i class=\"icon ion-skip-backward\"> </i></button>\n<button><i class=\"icon ion-skip-forward\"> </i></button>\n<button><i class=\"icon ion-social-android\"> </i></button>\n<button><i class=\"icon ion-social-android-outline\"> </i></button>\n<button><i class=\"icon ion-social-angular\"> </i></button>\n<button><i class=\"icon ion-social-angular-outline\"> </i></button>\n<button><i class=\"icon ion-social-apple\"> </i></button>\n<button><i class=\"icon ion-social-apple-outline\"> </i></button>\n<button><i class=\"icon ion-social-bitcoin\"> </i></button>\n<button><i class=\"icon ion-social-bitcoin-outline\"> </i></button>\n<button><i class=\"icon ion-social-buffer\"> </i></button>\n<button><i class=\"icon ion-social-buffer-outline\"> </i></button>\n<button><i class=\"icon ion-social-chrome\"> </i></button>\n<button><i class=\"icon ion-social-chrome-outline\"> </i></button>\n<button><i class=\"icon ion-social-codepen\"> </i></button>\n<button><i class=\"icon ion-social-codepen-outline\"> </i></button>\n<button><i class=\"icon ion-social-css3\"> </i></button>\n<button><i class=\"icon ion-social-css3-outline\"> </i></button>\n<button><i class=\"icon ion-social-designernews\"> </i></button>\n<button><i class=\"icon ion-social-designernews-outline\"> </i></button>\n<button><i class=\"icon ion-social-dribbble\"> </i></button>\n<button><i class=\"icon ion-social-dribbble-outline\"> </i></button>\n<button><i class=\"icon ion-social-dropbox\"> </i></button>\n<button><i class=\"icon ion-social-dropbox-outline\"> </i></button>\n<button><i class=\"icon ion-social-euro\"> </i></button>\n<button><i class=\"icon ion-social-euro-outline\"> </i></button>\n<button><i class=\"icon ion-social-facebook\"> </i></button>\n<button><i class=\"icon ion-social-facebook-outline\"> </i></button>\n<button><i class=\"icon ion-social-foursquare\"> </i></button>\n<button><i class=\"icon ion-social-foursquare-outline\"> </i></button>\n<button><i class=\"icon ion-social-freebsd-devil\"> </i></button>\n<button><i class=\"icon ion-social-github\"> </i></button>\n<button><i class=\"icon ion-social-github-outline\"> </i></button>\n<button><i class=\"icon ion-social-google\"> </i></button>\n<button><i class=\"icon ion-social-google-outline\"> </i></button>\n<button><i class=\"icon ion-social-googleplus\"> </i></button>\n<button><i class=\"icon ion-social-googleplus-outline\"> </i></button>\n<button><i class=\"icon ion-social-hackernews\"> </i></button>\n<button><i class=\"icon ion-social-hackernews-outline\"> </i></button>\n<button><i class=\"icon ion-social-html5\"> </i></button>\n<button><i class=\"icon ion-social-html5-outline\"> </i></button>\n<button><i class=\"icon ion-social-instagram\"> </i></button>\n<button><i class=\"icon ion-social-instagram-outline\"> </i></button>\n<button><i class=\"icon ion-social-javascript\"> </i></button>\n<button><i class=\"icon ion-social-javascript-outline\"> </i></button>\n<button><i class=\"icon ion-social-linkedin\"> </i></button>\n<button><i class=\"icon ion-social-linkedin-outline\"> </i></button>\n<button><i class=\"icon ion-social-markdown\"> </i></button>\n<button><i class=\"icon ion-social-nodejs\"> </i></button>\n<button><i class=\"icon ion-social-octocat\"> </i></button>\n<button><i class=\"icon ion-social-pinterest\"> </i></button>\n<button><i class=\"icon ion-social-pinterest-outline\"> </i></button>\n<button><i class=\"icon ion-social-python\"> </i></button>\n<button><i class=\"icon ion-social-reddit\"> </i></button>\n<button><i class=\"icon ion-social-reddit-outline\"> </i></button>\n<button><i class=\"icon ion-social-rss\"> </i></button>\n<button><i class=\"icon ion-social-rss-outline\"> </i></button>\n<button><i class=\"icon ion-social-sass\"> </i></button>\n<button><i class=\"icon ion-social-skype\"> </i></button>\n<button><i class=\"icon ion-social-skype-outline\"> </i></button>\n<button><i class=\"icon ion-social-snapchat\"> </i></button>\n<button><i class=\"icon ion-social-snapchat-outline\"> </i></button>\n<button><i class=\"icon ion-social-tumblr\"> </i></button>\n<button><i class=\"icon ion-social-tumblr-outline\"> </i></button>\n<button><i class=\"icon ion-social-tux\"> </i></button>\n<button><i class=\"icon ion-social-twitch\"> </i></button>\n<button><i class=\"icon ion-social-twitch-outline\"> </i></button>\n<button><i class=\"icon ion-social-twitter\"> </i></button>\n<button><i class=\"icon ion-social-twitter-outline\"> </i></button>\n<button><i class=\"icon ion-social-usd\"> </i></button>\n<button><i class=\"icon ion-social-usd-outline\"> </i></button>\n<button><i class=\"icon ion-social-vimeo\"> </i></button>\n<button><i class=\"icon ion-social-vimeo-outline\"> </i></button>\n<button><i class=\"icon ion-social-whatsapp\"> </i></button>\n<button><i class=\"icon ion-social-whatsapp-outline\"> </i></button>\n<button><i class=\"icon ion-social-windows\"> </i></button>\n<button><i class=\"icon ion-social-windows-outline\"> </i></button>\n<button><i class=\"icon ion-social-wordpress\"> </i></button>\n<button><i class=\"icon ion-social-wordpress-outline\"> </i></button>\n<button><i class=\"icon ion-social-yahoo\"> </i></button>\n<button><i class=\"icon ion-social-yahoo-outline\"> </i></button>\n<button><i class=\"icon ion-social-yen\"> </i></button>\n<button><i class=\"icon ion-social-yen-outline\"> </i></button>\n<button><i class=\"icon ion-social-youtube\"> </i></button>\n<button><i class=\"icon ion-social-youtube-outline\"> </i></button>\n<button><i class=\"icon ion-soup-can\"> </i></button>\n<button><i class=\"icon ion-soup-can-outline\"> </i></button>\n<button><i class=\"icon ion-speakerphone\"> </i></button>\n<button><i class=\"icon ion-speedometer\"> </i></button>\n<button><i class=\"icon ion-spoon\"> </i></button>\n<button><i class=\"icon ion-star\"> </i></button>\n<button><i class=\"icon ion-stats-bars\"> </i></button>\n<button><i class=\"icon ion-steam\"> </i></button>\n<button><i class=\"icon ion-stop\"> </i></button>\n<button><i class=\"icon ion-thermometer\"> </i></button>\n<button><i class=\"icon ion-thumbsdown\"> </i></button>\n<button><i class=\"icon ion-thumbsup\"> </i></button>\n<button><i class=\"icon ion-toggle\"> </i></button>\n<button><i class=\"icon ion-toggle-filled\"> </i></button>\n<button><i class=\"icon ion-transgender\"> </i></button>\n<button><i class=\"icon ion-trash-a\"> </i></button>\n<button><i class=\"icon ion-trash-b\"> </i></button>\n<button><i class=\"icon ion-trophy\"> </i></button>\n<button><i class=\"icon ion-tshirt\"> </i></button>\n<button><i class=\"icon ion-tshirt-outline\"> </i></button>\n<button><i class=\"icon ion-umbrella\"> </i></button>\n<button><i class=\"icon ion-university\"> </i></button>\n<button><i class=\"icon ion-unlocked\"> </i></button>\n<button><i class=\"icon ion-upload\"> </i></button>\n<button><i class=\"icon ion-usb\"> </i></button>\n<button><i class=\"icon ion-videocamera\"> </i></button>\n<button><i class=\"icon ion-volume-high\"> </i></button>\n<button><i class=\"icon ion-volume-low\"> </i></button>\n<button><i class=\"icon ion-volume-medium\"> </i></button>\n<button><i class=\"icon ion-volume-mute\"> </i></button>\n<button><i class=\"icon ion-wand\"> </i></button>\n<button><i class=\"icon ion-waterdrop\"> </i></button>\n<button><i class=\"icon ion-wifi\"> </i></button>\n<button><i class=\"icon ion-wineglass\"> </i></button>\n<button><i class=\"icon ion-woman\"> </i></button>\n<button><i class=\"icon ion-wrench\"> </i></button>\n<button><i class=\"icon ion-xbox\"> </i></button>        \n        ";
      return html;
    }
  }, {
    key: "isBootstrapIconsIncluded",
    value: function isBootstrapIconsIncluded() {
      var stylesheets = this.builder.doc.styleSheets;
      for (var i = 0; i < stylesheets.length; i++) {
        var stylesheet = stylesheets[i];
        try {
          var rules = stylesheet.rules || stylesheet.cssRules;
          for (var j = 0; j < rules.length; j++) {
            var rule = rules[j];
            if (rule.cssText.includes('bootstrap-icons')) {
              return true;
            }
          }
        } catch (error) {
          // Accessing some stylesheets may throw a security error due to cross-origin restrictions
          // Do Nothing
        }
      }
      return false;
    }
  }, {
    key: "addIcon",
    value: function addIcon(classname) {
      var _this6 = this;
      var dom = this.dom;
      this.util.restoreSelection();
      if (this.builder.activeIcon && this.builder.doc.contains(this.builder.activeIcon)) {
        this.builder.uo.saveForUndo();

        /*
        const arrSizes = this.builder.opts.fontSizeClassValues;
         // Get current class size
        var currentClassSize = '';
        for(var i=0;i<=arrSizes.length-1;i++){
            if (dom.hasClass(this.builder.activeIcon, 'size-'+arrSizes[i])) {
                currentClassSize = 'size-'+arrSizes[i];
            }
        }
         this.builder.activeIcon.className = classname + (currentClassSize!==''? ' ' + currentClassSize: '');
        dom.addClass(this.builder.activeIcon, 'icon-active');
        */
        var currentClasses = '';
        this.builder.activeIcon.classList.forEach(function (item) {
          if (item === 'icon' || item.includes('ion-') || item === 'bi' || item.includes('bi-')) {
            _this6.builder.activeIcon.classList.remove(item);
          } else {
            currentClasses += ' ' + item;
          }
        });
        this.builder.activeIcon.className = classname + currentClasses;
        dom.addClass(this.builder.activeIcon, 'icon-active');
        dom.selectElementContents(this.builder.activeIcon);
        this.util.saveSelection();
      } else {
        if (!dom.textSelection()) return;
        this.builder.uo.saveForUndo();
        this.util.pasteHtmlAtCaret('<i class="' + classname + ' icon-active"></i>', true);
        this.builder.activeIcon = this.builder.doc.querySelector('.icon-active');

        // this.util.pasteHtmlAtCaret('<i class="icon-active"></i>', true); 
        // const newIcon = this.builder.doc.querySelector('.icon-active');
        // newIcon.className = classname + ' icon-active';
        // this.builder.activeIcon = newIcon;

        dom.selectElementContents(this.builder.activeIcon);
        this.util.saveSelection();
      }

      //Trigger Change event
      this.builder.opts.onChange();

      //Trigger Render event
      this.builder.opts.onRender();
    }
  }, {
    key: "clearFont",
    value: function clearFont() {
      this.builder.uo.saveForUndo();
      this.applyFont('', '', '');
    }
  }, {
    key: "applyFont",
    value: function applyFont(fontfamily, fontstyle, provider) {
      var _this7 = this;
      var dom = this.dom;
      var elm;
      var panel = this.builderStuff.querySelector('.is-side.elementstyles');
      if (dom.hasClass(panel, 'active')) {
        this.builder.uo.saveForUndo();
        elm = this.builder.inspectedElement;
        elm.style.fontFamily = fontfamily;
        this.builderStuff.querySelector('#inpElmFontFamily').value = fontfamily; //direct (see elementpanel-text.js)

        this.elementStyleEditor.refresh();
      } else {
        try {
          var curr;
          if (this.builder.win.getSelection) {
            curr = this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
            if (curr.nodeType === 3) {
              //text node
              elm = curr.parentNode;
            } else {
              elm = curr;
            }
            if (elm.tagName !== 'H1' && elm.tagName !== 'H2' && elm.tagName !== 'H3' && elm.tagName !== 'H4' && elm.tagName !== 'H5' && elm.tagName !== 'H6' && elm.tagName !== 'P') {
              elm = elm.parentNode;
            }
          } else if (this.builder.doc.selection) {
            curr = this.builder.doc.selection.createRange();
            elm = this.builder.doc.selection.createRange().parentElement();
            if (elm.tagName !== 'H1' && elm.tagName !== 'H2' && elm.tagName !== 'H3' && elm.tagName !== 'H4' && elm.tagName !== 'H5' && elm.tagName !== 'H6' && elm.tagName !== 'P') {
              elm = elm.parentElement();
            }
          }
        } catch (e) {
          return;
        }
        this.builder.uo.saveForUndo();
        var text = dom.getSelected();
        if (text.trim() !== '' && elm.innerText !== text) {
          this.builder.doc.execCommand('fontName', false, fontfamily);
          var fontElements = this.builder.doc.getElementsByTagName('font');
          for (var i = 0, len = fontElements.length; i < len; ++i) {
            if (fontElements[i].face === fontfamily) {
              fontElements[i].removeAttribute('face');
              fontElements[i].style.fontFamily = fontfamily;
              dom.selectElementContents(fontElements[i]);
            }
          }
        } else if (text.trim() !== '' && elm.innerText === text) {
          //selection fully mode on text AND element. Use element then.
          elm.style.fontFamily = fontfamily;
        } else {
          elm.style.fontFamily = fontfamily;
        }
      }
      var o = fontstyle;
      if (!o) {
        o = '';
      } else {
        o = ':' + o;
      }
      var fontname = fontfamily.split(',')[0];
      if (provider === 'google') {
        var bExist = false;
        var links = this.builder.doc.getElementsByTagName('link');
        for (i = 0; i < links.length; i++) {
          var sSrc = links[i].href.toLowerCase();
          sSrc = sSrc.replace(/\+/g, ' ').replace(/%20/g, ' ');
          if (sSrc.indexOf(fontname.toLowerCase()) !== -1) bExist = true;
        }
        if (!bExist) {
          var element = elm;
          while (!dom.hasClass(element, 'is-builder')) {
            element = element.parentNode;
          }
          dom.appendHtml(element, '<link href="//fonts.googleapis.com/css2?family=' + fontname + o + '" rel="stylesheet" property="stylesheet">');
        }
      }
      if (!this.builder.inspectedElement) {
        //save selection
        this.util.saveSelection(); //Needed because after format, a tag is added (ex. <span>), so, make selection again. 

        if (this.builder.isTouchSupport) {
          //prevent keyboard open
          var btnFocus = this.rteTool.querySelector('button');
          btnFocus.focus();
        }
        this.getState();
      }

      //Trigger Change event
      this.builder.opts.onChange();
      setTimeout(function () {
        _this7.builder.opts.onChange();
      }, 300);

      //LATER: make function
      //Cleanup Google font css link

      links = this.builder.doc.getElementsByTagName('link');
      for (i = 0; i < links.length; i++) {
        sSrc = links[i].href.toLowerCase();
        if (sSrc.indexOf('googleapis') !== -1) {
          //get fontname
          sSrc = sSrc.replace(/\+/g, ' ').replace(/%20/g, ' ');
          fontname = sSrc.substr(sSrc.indexOf('family=') + 7);
          if (fontname.indexOf(':') !== -1) {
            fontname = fontname.split(':')[0];
          }
          if (fontname.indexOf('|') !== -1) {
            fontname = fontname.split('|')[0];
          }
          //check if fontname used in content
          var tmp = this.builder.doc.body.innerHTML.toLowerCase();
          var count = tmp.split(fontname).length;
          if (count < 3) {
            //not used     
            var attr = links[i].getAttribute('data-protect');
            if (!attr) {
              links[i].setAttribute('data-rel', '_del');
            }
          }
        }
      }
      [].forEach.call(this.builder.doc.querySelectorAll('link[data-rel="_del"]'), function (e) {
        e.parentNode.removeChild(e);
      });
      if (this.builder.onTextChange) this.builder.onTextChange();
    }
  }, {
    key: "setFont",
    value: function setFont(fontfamily, fontstyle, fontdisplay, provider) {
      // NEW 4.0.5

      var dom = this.dom;
      var elm;
      var panel = this.builderStuff.querySelector('.is-side.elementstyles');
      if (dom.hasClass(panel, 'active')) {
        this.builder.uo.saveForUndo();
        elm = this.builder.inspectedElement;
        elm.style.fontFamily = fontfamily;
        this.builderStuff.querySelector('#inpElmFontFamily').value = fontfamily; //direct (see elementpanel-text.js)

        this.elementStyleEditor.refresh();
      } else {
        // if(this.builder.isIE) this.util.restoreSelection(); //a must (IE)
        this.util.restoreSelection();
        try {
          var curr;
          if (this.builder.win.getSelection) {
            curr = this.builder.win.getSelection().getRangeAt(0).commonAncestorContainer;
            if (curr.nodeType === 3) {
              //text node
              elm = curr.parentNode;
            } else {
              elm = curr;
            }
            if (elm.tagName !== 'H1' && elm.tagName !== 'H2' && elm.tagName !== 'H3' && elm.tagName !== 'H4' && elm.tagName !== 'H5' && elm.tagName !== 'H6' && elm.tagName !== 'P') {
              elm = elm.parentNode;
            }
          } else if (this.builder.doc.selection) {
            curr = this.builder.doc.selection.createRange();
            elm = this.builder.doc.selection.createRange().parentElement();
            if (elm.tagName !== 'H1' && elm.tagName !== 'H2' && elm.tagName !== 'H3' && elm.tagName !== 'H4' && elm.tagName !== 'H5' && elm.tagName !== 'H6' && elm.tagName !== 'P') {
              elm = elm.parentElement();
            }
          }
        } catch (e) {
          return;
        }
        this.builder.uo.saveForUndo();
        var text = dom.getSelected();
        if (text.trim() !== '' && elm.innerText !== text) {
          this.builder.doc.execCommand('fontName', false, fontfamily); // this removes all quotes, so needs to make valid later (below).
          var fontElements = this.builder.doc.getElementsByTagName('font');
          for (var i = 0, len = fontElements.length; i < len; ++i) {
            // fontElements[i].face = Press Start 2p, cursive => no quotes here
            // fontfamily = 'Press Start 2p', cursive
            if (fontElements[i].face.replace(/'/g, '') === fontfamily.replace(/'/g, '')) {
              fontElements[i].removeAttribute('face');
              fontElements[i].style.fontFamily = fontfamily;
              dom.selectElementContents(fontElements[i]);
            }
          }

          //cleaning added <span face="">.
          // example: 
          // <p style="text-align: justify;"><span style="font-family: &quot;Press Start 2p&quot;, cursive;">Lorem </span>
          // <span style="font-family: &quot;M PLUS Rounded 1c&quot;, sans-serif;">Ipsum</span>
          // <span face="Press Start 2p, cursive;"> is simply dummy text of the printing and typesetting industry...</span></p>
          fontElements = this.builder.doc.querySelectorAll('[face]');
          for (i = 0, len = fontElements.length; i < len; ++i) {
            // Make valid (adding quotes):
            var tmp = fontElements[i].getAttribute('face');
            if (tmp.indexOf(',') !== -1) {
              var f1 = tmp.split(',')[0];
              var f2 = tmp.split(',')[1];
              if (f1.indexOf(' ') !== -1) {
                tmp = "'".concat(f1, "',").concat(f2);
              }
            }
            fontElements[i].style.fontFamily = tmp;
            fontElements[i].removeAttribute('face');
          }
        } else if (text.trim() !== '' && elm.innerText === text) {
          //selection fully mode on text AND element. Use element then.
          elm.style.fontFamily = fontfamily;
          var allfonts = elm.querySelectorAll('*');
          Array.prototype.forEach.call(allfonts, function (item) {
            if (item.style.fontFamily !== '') {
              item.style.fontFamily = '';
            }
          });
        } else {
          elm.style.fontFamily = fontfamily;
        }
      }
      var o = fontstyle;
      if (!o) {
        o = '';
      } else {
        o = ':' + o;
      }
      var d = ''; // NEW 4.0.5
      if (fontdisplay) {
        d = '&display=swap';
      }
      var fontname = fontfamily.split(',')[0];
      fontname = fontname.replace(/'/g, ''); // NEW 4.0.5 (replace quotes in font family)

      if (provider === 'google') {
        var bExist = false;
        bExist = this.checkIfFontCssLinkExists(fontfamily);
        if (!bExist) {
          var element = elm;
          while (!dom.hasClass(element, 'is-builder')) {
            element = element.parentNode;
          }
          var cssUrl = '';
          if (this.builder.fontPath) {
            var cssFileName = fontfamily.split(',')[0].toLowerCase().replace(/'/g, '').replace(/"/g, '').replace(/\s/g, '-') + '.css';
            cssUrl = this.builder.fontPath + cssFileName;
            dom.appendHtml(element, "<link data-name=\"fontfamily\" href=\"".concat(cssUrl, "\" rel=\"stylesheet\" property=\"stylesheet\">"));
          } else {
            dom.appendHtml(element, '<link href="//fonts.googleapis.com/css2?family=' + fontname + d + o + '" rel="stylesheet" property="stylesheet">');
          }
        }
      }
      if (provider === 'others') {
        var _bExist = false;
        _bExist = this.checkIfFontCssLinkExists(fontfamily);
        if (!_bExist) {
          var _element = elm;
          while (!dom.hasClass(_element, 'is-builder')) {
            _element = _element.parentNode;
          }
          var _cssUrl = '';
          if (this.builder.fontPath) {
            var _cssFileName = fontfamily.split(',')[0].toLowerCase().replace(/'/g, '').replace(/"/g, '').replace(/\s/g, '-') + '.css';
            _cssUrl = this.builder.fontPath + _cssFileName;
            dom.appendHtml(_element, "<link data-name=\"fontfamily\" href=\"".concat(_cssUrl, "\" rel=\"stylesheet\" property=\"stylesheet\">"));
          }
        }
      }
      if (!this.builder.inspectedElement) {
        //save selection
        this.util.saveSelection(); //Needed because after format, a tag is added (ex. <span>), so, make selection again. 

        if (this.builder.isTouchSupport) {
          //prevent keyboard open
          var btnFocus = this.rteTool.querySelector('button');
          btnFocus.focus();
        }
        this.getState();
      }

      //Trigger Change event
      this.builder.opts.onChange();

      //Cleanup Google font css link
      this.cleanupFontCssLink();
      if (this.builder.onTextChange) this.builder.onTextChange();
    }
  }, {
    key: "cleanupFontCssLink",
    value: function cleanupFontCssLink() {
      var fonts = [];
      if (this.builder.opts.page !== '') {
        var wrapper = this.builder.doc.querySelector(this.builder.opts.page);
        wrapper.querySelectorAll('*').forEach(function (element) {
          var fontFamily = window.getComputedStyle(element).getPropertyValue('font-family');
          if (fonts.indexOf(fontFamily) === -1) fonts.push(fontFamily);
        });
      } else {
        var builders = this.builder.doc.querySelectorAll(this.builder.opts.container);
        builders.forEach(function (builder) {
          builder.querySelectorAll('*').forEach(function (element) {
            var fontFamily = window.getComputedStyle(element).getPropertyValue('font-family');
            if (fonts.indexOf(fontFamily) === -1) fonts.push(fontFamily);
          });
        });
      }

      // Cleanup
      var links = this.builder.doc.getElementsByTagName('link');
      var _loop7 = function _loop7(i) {
        var sSrc = links[i].href.toLowerCase();
        if (sSrc.indexOf('googleapis') !== -1) {
          //get fontname
          sSrc = sSrc.replace(/\+/g, ' ').replace(/%20/g, ' ');
          var linkFontName = sSrc.substr(sSrc.indexOf('family=') + 7);
          if (linkFontName.indexOf(':') !== -1) {
            linkFontName = linkFontName.split(':')[0];
          }
          if (linkFontName.indexOf('|') !== -1) {
            linkFontName = linkFontName.split('|')[0];
          }
          linkFontName = linkFontName.replace('&display=swap', ''); // NEW 4.0.5

          // console.log(linkFontName);
          // check if fontname used in content

          var used = false;
          fonts.forEach(function (item) {
            var currentContentFont = item.split(',')[0].replace(/"/g, '').replace(/'/g, '').toLowerCase();
            if (linkFontName === currentContentFont) {
              used = true;
            } else {
              // Do Nothing
            }
            // if(item.toLowerCase().indexOf(linkFontName.toLowerCase())===-1) {
            //     // Do Nothing
            // } else {
            //     used=true;
            // }
          });

          if (!used) {
            //not used
            var attr = links[i].getAttribute('data-protect');
            if (!attr) {
              links[i].setAttribute('data-rel', '_del');
            }
          }
        } else if (links[i].getAttribute('data-name') === 'fontfamily') {
          var _used = false;
          fonts.forEach(function (item) {
            var cssFileName = item.split(',')[0].replace(/'/g, '').replace(/"/g, '').replace(/\s/g, '-').toLowerCase() + '.css';
            if (sSrc.toLowerCase().indexOf('/' + cssFileName) === -1) {
              // Do Nothing
            } else {
              _used = true;
            }
          });
          if (!_used) {
            //not used
            var _attr = links[i].getAttribute('data-protect');
            if (!_attr) {
              links[i].setAttribute('data-rel', '_del');
            }
          }
        }
      };
      for (var i = 0; i < links.length; i++) {
        _loop7(i);
      }
      [].forEach.call(this.builder.doc.querySelectorAll('link[data-rel="_del"]'), function (e) {
        e.parentNode.removeChild(e);
      });
    }
  }, {
    key: "checkIfFontCssLinkExists",
    value: function checkIfFontCssLinkExists(fontfamily) {
      var bExist = false;
      var fontname = fontfamily.split(',')[0];
      fontname = fontname.replace(/'/g, '');
      fontname = fontname.replace(/"/g, ''); // (replace double quotes in font family)
      fontname = fontname.toLowerCase();
      var links = this.builder.doc.getElementsByTagName('link');
      for (var i = 0; i < links.length; i++) {
        var sSrc = links[i].href.toLowerCase();
        if (sSrc.indexOf('googleapis') !== -1) {
          if (!this.builder.fontPath) {
            //get fontname
            sSrc = sSrc.replace(/\+/g, ' ').replace(/%20/g, ' ');
            var linkFontName = sSrc.substr(sSrc.indexOf('family=') + 7);
            if (linkFontName.indexOf(':') !== -1) {
              linkFontName = linkFontName.split(':')[0];
            }
            if (linkFontName.indexOf('|') !== -1) {
              linkFontName = linkFontName.split('|')[0];
            }
            linkFontName = linkFontName.replace('&display=swap', ''); // NEW 4.0.5

            //check if fontname used in content
            // let tmp = this.builder.doc.body.innerHTML.toLowerCase();
            if (linkFontName === fontname.toLowerCase()) {
              bExist = true;
              // console.log(fontname.toLowerCase() + '-' +linkFontName);
            }
          }
        } else if (links[i].getAttribute('data-name') === 'fontfamily') {
          if (this.builder.fontPath) {
            var cssFile = fontname.replace(/\s/g, '-').toLowerCase() + '.css';
            if (sSrc.toLowerCase().indexOf('/' + cssFile) !== -1) {
              bExist = true;
            }
          }
        }
      }
      return bExist;
    }
  }, {
    key: "positionToolbar",
    value: function positionToolbar() {
      var leftSidebarAdj = this.builder.leftSidebarAdj || 0;
      var leftSidebarAdj2 = this.builder.leftSidebarAdj2 || 0;
      if (document.body.classList.contains('controlpanel')) {
        leftSidebarAdj = leftSidebarAdj - 290 / 2;
        leftSidebarAdj2 = leftSidebarAdj2 - 290 / 2;
      }
      var viewportWidth = document.body.clientWidth; //window.innerWidth;
      var viewportHeight = window.innerHeight;
      if (this.builder.opts.toolbar === 'right') {
        var h = this.rteTool.offsetHeight;
        var top = viewportHeight / 2 - h / 2;
        this.rteTool.style.left = '';
        this.rteTool.style.top = top + 'px';

        // Element Toolbar
        h = this.elementRteTool.offsetHeight;
        top = viewportHeight / 2 - h / 2;
        this.elementRteTool.style.left = '';
        this.elementRteTool.style.top = top + 'px';
      } else if (this.builder.opts.toolbar === 'left') {
        var _h = this.rteTool.offsetHeight;
        var _top = viewportHeight / 2 - _h / 2;
        this.rteTool.style.left = leftSidebarAdj2 + 'px';
        this.rteTool.style.top = _top + 'px';

        // Element Toolbar
        _h = this.elementRteTool.offsetHeight;
        _top = viewportHeight / 2 - _h / 2;
        this.elementRteTool.style.left = leftSidebarAdj2 + 'px';
        this.elementRteTool.style.top = _top + 'px';
      } else {
        var w = this.rteTool.offsetWidth;
        var left = viewportWidth / 2 - w / 2 + leftSidebarAdj;
        this.rteTool.style.top = '';
        this.rteTool.style.left = left + 'px';

        // Element Toolbar
        w = this.elementRteTool.offsetWidth;
        left = viewportWidth / 2 - w / 2 + leftSidebarAdj;
        this.elementRteTool.style.top = '';
        this.elementRteTool.style.left = left + 'px';
      }
    }
  }, {
    key: "viewZoom",
    value: function viewZoom() {
      var _this8 = this;
      if (this.builder.onZoomOpen) this.builder.onZoomOpen();
      this.inpZoomSlider.value = this.builder.opts.zoom * 100;
      if (document.activeElement) this.elmFocus = document.activeElement;
      var modal = this.builderStuff.querySelector('.viewzoom');
      this.util.showModal(modal, false, function () {
        if (_this8.elmFocus) _this8.elmFocus.focus();
      }, false);
    }
  }]);
  return Rte;
}();
/* harmony default export */ const rte = (Rte);
;// CONCATENATED MODULE: ./src/contentbuilder/saveimages.js
function saveimages_typeof(obj) { "@babel/helpers - typeof"; return saveimages_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, saveimages_typeof(obj); }
function saveimages_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function saveimages_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, saveimages_toPropertyKey(descriptor.key), descriptor); } }
function saveimages_createClass(Constructor, protoProps, staticProps) { if (protoProps) saveimages_defineProperties(Constructor.prototype, protoProps); if (staticProps) saveimages_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function saveimages_toPropertyKey(arg) { var key = saveimages_toPrimitive(arg, "string"); return saveimages_typeof(key) === "symbol" ? key : String(key); }
function saveimages_toPrimitive(input, hint) { if (saveimages_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (saveimages_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var SaveImages = /*#__PURE__*/function () {
  function SaveImages() {
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var builder = arguments.length > 1 ? arguments[1] : undefined;
    saveimages_classCallCheck(this, SaveImages);
    var defaults = {
      page: '',
      container: '.container',
      handler: 'saveimage.php',
      onComplete: function onComplete() {},
      customval: '',
      stuffPlacement: '#_cbhtml',
      hiquality: false
      // onBase64Upload: function () { },
    };

    this.opts = Object.assign(this, defaults, opts);
    this.builder = builder;
    var dom = this.builder.dom;
    this.dom = dom;
    this.count = 0;
    var builderStuff = document.querySelector(this.opts.stuffPlacement);
    if (!builderStuff) {
      builderStuff = document.createElement('div');
      builderStuff.id = '_cbhtml';
      builderStuff.className = 'is-ui';
      dom.appendChild(document.body, builderStuff);
    }
    this.builderStuff = builderStuff;
  }
  saveimages_createClass(SaveImages, [{
    key: "save",
    value: function save() {
      var _this = this;
      if (this.opts.page !== '') {
        var area = this.builder.doc.querySelector(this.opts.page);
        this.uploadImages(area);
      } else {
        var areas = this.builder.doc.querySelectorAll(this.opts.container);
        Array.prototype.forEach.call(areas, function (area) {
          _this.uploadImages(area);
        });
      }

      //Check per 2 sec if all images have been changed with the new saved images.
      var _int = setInterval(function () {
        var finished = true;
        if (_this.opts.page !== '') {
          var _area = _this.builder.doc.querySelector(_this.opts.page);
          finished = _this.checkImages(_area);
        } else {
          var _areas = _this.builder.doc.querySelectorAll(_this.opts.container);
          Array.prototype.forEach.call(_areas, function (area) {
            if (_this.checkImages(area) === false) {
              finished = false;
            }
          });
        }
        if (finished) {
          try {
            _this.opts.onComplete();
          } catch (e) {
            // Do Nothing
          }
          window.clearInterval(_int);

          // No need to remove hidden iframes
          // //remove unused forms (previously used for submitting images)
          // for (var i = 1; i <= this.count; i++) {
          //     let frm = this.builderStuff.querySelector('#form-' + i);
          //     frm.parentNode.removeChild(frm);
          // }
        }
      }, 2000);
    }
  }, {
    key: "checkImages",
    value: function checkImages(area) {
      var images = area.querySelectorAll('img');
      var returnVal = true;
      Array.prototype.forEach.call(images, function (img) {
        var src = img.getAttribute('src');
        if (saveimages_typeof(src) !== ( true ? "undefined" : 0) && src !== false) {
          if (src.indexOf('base64') !== -1) {
            //if there is still base64 image, means not yet finished.
            returnVal = false;
          }
        }
      });
      return returnVal;
    }
  }, {
    key: "uploadImages",
    value: function uploadImages(area) {
      var _this2 = this;
      if (!area) return;

      //Check all images

      var divs = area.querySelectorAll('.is-overlay-bg,.is-container > div > div,.is-lightbox,.block-click');
      divs.forEach(function (div) {
        var src = '';
        if (div.style.backgroundImage && div.style.backgroundImage.includes('base64')) {
          if (div.style.backgroundImage.indexOf('url(') !== -1) {
            src = div.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
          }
        } else if (div.classList.contains('is-lightbox') && div.getAttribute('href').includes('base64')) {
          src = div.getAttribute('href');
        } else if (div.classList.contains('block-click') && div.style.backgroundImage && !div.style.backgroundImage.includes('base64')) {
          src = div.getAttribute('data-modal-url');
        }
        if (src.includes('base64')) {
          if (_this2.opts.onBase64Upload) {
            var ext = 'jpg';
            if (src.includes('image/png')) {
              ext = 'png';
            }

            //Read image (base64 string)
            var image = src;
            image = image.replace(/^data:image\/(png|svg\+xml|jpeg);base64,/, '');
            var filename;
            if (div.hasAttribute('data-filename')) {
              filename = div.getAttribute('data-filename');
            } else {
              filename = _this2.builder.util.makeId() + '.' + ext;
            }

            // console.log(div)
            _this2.opts.onBase64Upload(div, image, filename); // target image, base64 string, filename
          }
        }
      });

      var images = area.querySelectorAll('img');
      Array.prototype.forEach.call(images, function (img) {
        var src = img.getAttribute('src');
        if (saveimages_typeof(src) !== ( true ? "undefined" : 0) && src !== false) {
          if (src.indexOf('base64') !== -1) {
            // let customcode = false;
            // if(dom.parentsHasAttribute(img, 'data-html')){
            //     customcode = true;
            // }
            // let subblock = false;
            // if(dom.parentsHasAttribute(img, 'data-subblock')){
            //     subblock = true;
            // }
            // if(!customcode || (customcode && subblock)) {

            // }

            if (_this2.opts.onBase64Upload) {
              //Read image (base64 string)
              var image = src;
              image = image.replace(/^data:image\/(png|svg\+xml|jpeg);base64,/, '');
              var filename = img.getAttribute('data-filename');
              _this2.opts.onBase64Upload(img, image, filename); // target image, base64 string, filename
            } else {
              _this2.count++;

              //Read image (base64 string)
              var _image = src;
              _image = _image.replace(/^data:image\/(png|svg\+xml|jpeg);base64,/, '');

              //Prepare form to submit image
              if (!_this2.builderStuff.querySelector('#form-' + _this2.count)) {
                var html = '<form id="form-' + _this2.count + '" target="frame-' + _this2.count + '" method="post" enctype="multipart/form-data">' + '<input id="hidimg-' + _this2.count + '" name="hidimg-' + _this2.count + '" type="hidden" />' + '<input id="hidname-' + _this2.count + '" name="hidname-' + _this2.count + '" type="hidden" />' + '<input id="hidtype-' + _this2.count + '" name="hidtype-' + _this2.count + '" type="hidden" />' + '<input id="hidcustomval-' + _this2.count + '" name="hidcustomval-' + _this2.count + '" type="hidden" />' + '' + '<input name="count" value="' + _this2.count + '" type="hidden" />' + '<iframe tabindex="0" id="frame-' + _this2.count + '" name="frame-' + _this2.count + '" style="width:1px;height:1px;border:none;position:absolute;z-index:-100000;left:-5px;"></iframe>' + '</form>';
                _this2.builderStuff.insertAdjacentHTML('beforeend', html);
              }

              //Give ID to image
              img.setAttribute('id', 'img-' + _this2.count);

              //Set hidden field with image (base64 string) to be submitted
              _this2.builderStuff.querySelector('#hidimg-' + _this2.count).value = _image;

              //Set hidden field with custom value to be submitted
              _this2.builderStuff.querySelector('#hidcustomval-' + _this2.count).value = _this2.customval;

              //Set hidden field with file name to be submitted
              var _filename = img.getAttribute('data-filename');
              if (_filename) {
                var filename_without_ext = _filename.substr(0, _filename.lastIndexOf('.')) || _filename;
                filename_without_ext = filename_without_ext.toLowerCase().replace(/ /g, '-');
                _this2.builderStuff.querySelector('#hidname-' + _this2.count).value = filename_without_ext;
              }

              //Set hidden field with file extension to be submitted
              if (_this2.opts.hiquality) {
                //If high quality is set true, set image as png
                _this2.builderStuff.querySelector('#hidtype-' + _this2.count).value = 'png'; //high quality
              } else {
                //If high quality is set false, depend on image extension
                var extension = _filename.substr(_filename.lastIndexOf('.') + 1);
                extension = extension.toLowerCase();
                if (extension === 'jpg' || extension === 'jpeg') {
                  _this2.builderStuff.querySelector('#hidtype-' + _this2.count).value = 'jpg';
                } else {
                  _this2.builderStuff.querySelector('#hidtype-' + _this2.count).value = 'png';
                }
              }

              //Submit form
              _this2.builderStuff.querySelector('#form-' + _this2.count).setAttribute('action', _this2.opts.handler + (_this2.opts.handler.indexOf('?') >= 0 ? '&' : '?') + 'count=' + _this2.count);
              _this2.builderStuff.querySelector('#form-' + _this2.count).submit();

              //Note: the submitted image will be saved on the server 
              //by saveimage.php (if using PHP) or saveimage.ashx (if using .NET)
              //and the image src will be changed with the new saved image.
            }
          }
        }
      });
    }
  }]);
  return SaveImages;
}();
/* harmony default export */ const saveimages = (SaveImages);
;// CONCATENATED MODULE: ./src/contentbuilder/tooltip.js
function tooltip_typeof(obj) { "@babel/helpers - typeof"; return tooltip_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, tooltip_typeof(obj); }
function tooltip_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function tooltip_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, tooltip_toPropertyKey(descriptor.key), descriptor); } }
function tooltip_createClass(Constructor, protoProps, staticProps) { if (protoProps) tooltip_defineProperties(Constructor.prototype, protoProps); if (staticProps) tooltip_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function tooltip_toPropertyKey(arg) { var key = tooltip_toPrimitive(arg, "string"); return tooltip_typeof(key) === "symbol" ? key : String(key); }
function tooltip_toPrimitive(input, hint) { if (tooltip_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (tooltip_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var tooltip_dom = new Dom();
var Tooltip = /*#__PURE__*/function () {
  function Tooltip(builder) {
    tooltip_classCallCheck(this, Tooltip);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var tooltip = builderStuff.querySelector('.is-tooltip');
    if (!tooltip) {
      var html = '<div class="is-tooltip"></div>';
      tooltip_dom.appendHtml(builderStuff, html);
      tooltip = builderStuff.querySelector('.is-tooltip');
    }
    this.tooltip = tooltip;
  }
  tooltip_createClass(Tooltip, [{
    key: "setAll",
    value: function setAll(o) {
      var _this = this;
      var area;
      if (!o) area = this.builderStuff;else area = o;
      //let elms = Array.prototype.slice.call(this.builderStuff.querySelectorAll('[data-title]')).concat(Array.prototype.slice.call(document.querySelectorAll('.is-builder .is-tool [data-title]')));
      var elms = area.querySelectorAll('[data-title]');
      Array.prototype.forEach.call(elms, function (elm) {
        _this.set(elm, 0, 0);
      });
      if (this.builder.iframe) {
        if (!o) {
          var _elms = this.builder.contentStuff.querySelectorAll('[data-title]');
          Array.prototype.forEach.call(_elms, function (elm) {
            _this.set(elm, 0, 0, true);
          });
        }
      }
    }
  }, {
    key: "set",
    value: function set(elm, topadj, leftadj, iframe) {
      var _this2 = this;
      if (!topadj) topadj = 0;
      if (!leftadj) leftadj = 0;
      var tooltip = this.tooltip;
      elm.addEventListener('mouseover', function (e) {
        var relTarget = e.relatedTarget;
        if (_this2 === relTarget || isAChildOf(_this2, relTarget)) return;
        var style = window.getComputedStyle(elm.parentNode);
        var direction = style.getPropertyValue('flex-direction');
        //console.log(style.flexDirection); 

        var s = elm.getAttribute('data-title');
        tooltip.innerHTML = s;
        var top, left;
        top = elm.getBoundingClientRect().top + window.pageYOffset;
        left = elm.getBoundingClientRect().left + window.pageXOffset;

        /*
        if(iframe) {
            let adjY = this.builder.iframe.getBoundingClientRect().top + window.pageYOffset;
            let adjX = this.builder.iframe.getBoundingClientRect().left + window.pageXOffset;
             top = elm.getBoundingClientRect().top + adjY;
            left = elm.getBoundingClientRect().left + adjX;
        }
        */

        if (iframe) {
          var newPos = _this2.util.getElementPosition(elm);
          top = newPos.top;
          left = newPos.left;
        }

        //console.log(top + ' - ' + left);
        tooltip.style.display = 'flex';
        tooltip.style.whiteSpace = 'nowrap';
        var w = elm.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
        var h = elm.offsetHeight;
        tooltip.style.marginRight = ''; //reset

        var viewportWidth = window.innerWidth;
        tooltip.style.top = top + h + 5 + topadj + 'px';
        if (h < 30) {
          tooltip.style.top = top + h + 2 + topadj + 'px';
        }
        if (direction === 'column') {
          tooltip.style.top = top + h / 2 - tooltip.offsetHeight / 2 + topadj + 'px';
          tooltip.style.left = left + w + 3 + leftadj + 'px';
          if (viewportWidth - (left + w) < 100) {
            // 100 or tooltip.offsetWidth
            tooltip.style.left = left - tooltip.offsetWidth - 3 + leftadj + 'px';
          }
        } else {
          var tooltipLeft = left + w / 2 - tooltip.offsetWidth / 2 + leftadj;
          tooltip.style.left = tooltipLeft + 'px'; // center

          // Adjustment for snippet handle tooltip (or any other that is outside viewport)
          var rightedge = tooltipLeft + tooltip.offsetWidth;
          if (rightedge > viewportWidth) {
            var adj = rightedge - viewportWidth;
            tooltip.style.left = tooltipLeft - adj - 3 + 'px'; //3 = additional adjustment

            if (tooltip.offsetHeight > 25) tooltip.style.marginRight = '5px'; // to fix incorrect position if tooltip has more than 1 line
          }

          if (tooltipLeft < 0) {
            tooltip.style.left = '3px';
          }
        }

        // overide
        var tipOnTop = elm.hasAttribute('data-tooltip-top');
        if (tipOnTop) {
          tooltip.style.top = top - tooltip.offsetHeight - 3 + 'px'; //10 = additional adjustment
        }

        elm.removeAttribute('title');
      }, false);
      elm.addEventListener('mouseout', function (e) {
        var relTarget = e.relatedTarget;
        if (_this2 === relTarget || isAChildOf(_this2, relTarget)) return;
        elm.setAttribute('title', elm.getAttribute('data-title'));
        tooltip.style.display = 'none';
      }, false);
      elm.addEventListener('click', function (e) {
        var relTarget = e.relatedTarget;
        if (_this2 === relTarget || isAChildOf(_this2, relTarget)) return;
        elm.setAttribute('title', elm.getAttribute('data-title'));
        tooltip.style.display = 'none';
      }, false);
    }
  }, {
    key: "set2",
    value: function set2(elm, topadj, leftadj) {
      var _this3 = this;
      if (!topadj) topadj = 0;
      if (!leftadj) leftadj = 0;
      var tooltip = this.tooltip;
      elm.addEventListener('mouseover', function (e) {
        var relTarget = e.relatedTarget;
        if (_this3 === relTarget || isAChildOf(_this3, relTarget)) return;
        var style = window.getComputedStyle(elm.parentNode);
        var direction = style.getPropertyValue('flex-direction');
        //console.log(style.flexDirection); 

        var s = elm.getAttribute('data-title');
        tooltip.innerHTML = s;
        var top = elm.getBoundingClientRect().top + window.pageYOffset;
        var left = elm.getBoundingClientRect().left + window.pageXOffset;
        //console.log(top + ' - ' + left);
        tooltip.style.display = 'flex';
        tooltip.style.whiteSpace = 'nowrap';
        var w = elm.offsetWidth; //to get value, element must not hidden (display:none). So set display:flex before this.
        var h = elm.offsetHeight;
        tooltip.style.marginRight = ''; //reset

        var viewportWidth = window.innerWidth;
        tooltip.style.top = top + h + 5 + topadj + 'px';
        if (h < 30) {
          tooltip.style.top = top + h + 2 + topadj + 'px';
        }
        if (direction === 'column') {
          tooltip.style.top = top + h / 2 - tooltip.offsetHeight / 2 + topadj + 'px';
          tooltip.style.left = left + w + 3 + leftadj + 'px';
          if (viewportWidth - (left + w) < 100) {
            // 100 or tooltip.offsetWidth
            tooltip.style.left = left - tooltip.offsetWidth - 3 + leftadj + 'px';
          }
        } else {
          var tooltipLeft = left + w / 2 - tooltip.offsetWidth / 2 + leftadj;
          tooltip.style.left = tooltipLeft + 'px'; // center

          // Adjustment for snippet handle tooltip (or any other that is outside viewport)
          var rightedge = tooltipLeft + tooltip.offsetWidth;
          if (rightedge > viewportWidth) {
            var adj = rightedge - viewportWidth;
            tooltip.style.left = tooltipLeft - adj - 3 + 'px'; //3 = additional adjustment

            if (tooltip.offsetHeight > 25) tooltip.style.marginRight = '5px'; // to fix incorrect position if tooltip has more than 1 line
          }

          if (tooltipLeft < 0) {
            tooltip.style.left = '3px';
          }
        }

        // overide
        var tipOnTop = elm.hasAttribute('data-tooltip-top');
        if (tipOnTop) {
          tooltip.style.top = top - tooltip.offsetHeight - 3 + 'px'; //10 = additional adjustment
        }

        elm.removeAttribute('title');
      }, false);
      elm.addEventListener('mouseout', function (e) {
        var relTarget = e.relatedTarget;
        if (_this3 === relTarget || isAChildOf(_this3, relTarget)) return;
        elm.setAttribute('title', elm.getAttribute('data-title'));
        tooltip.style.display = 'none';
      }, false);
      elm.addEventListener('click', function (e) {
        var relTarget = e.relatedTarget;
        if (_this3 === relTarget || isAChildOf(_this3, relTarget)) return;
        elm.setAttribute('title', elm.getAttribute('data-title'));
        tooltip.style.display = 'none';
      }, false);
    }
  }]);
  return Tooltip;
}(); // https://stackoverflow.com/questions/8399408/mouseover-mouseout-eventlistener-inheriting-to-child-nodes
function isAChildOf(parent, child) {
  if (parent === child) {
    return false;
  }
  while (child && child !== parent) {
    child = child.parentNode;
  }
  return child === parent;
}
/* harmony default export */ const tooltip = (Tooltip);
;// CONCATENATED MODULE: ./src/contentbuilder/lightbox.js
function lightbox_typeof(obj) { "@babel/helpers - typeof"; return lightbox_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, lightbox_typeof(obj); }
function lightbox_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function lightbox_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, lightbox_toPropertyKey(descriptor.key), descriptor); } }
function lightbox_createClass(Constructor, protoProps, staticProps) { if (protoProps) lightbox_defineProperties(Constructor.prototype, protoProps); if (staticProps) lightbox_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function lightbox_toPropertyKey(arg) { var key = lightbox_toPrimitive(arg, "string"); return lightbox_typeof(key) === "symbol" ? key : String(key); }
function lightbox_toPrimitive(input, hint) { if (lightbox_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (lightbox_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Lightbox = /*#__PURE__*/function () {
  function Lightbox(builder) {
    var _this = this;
    lightbox_classCallCheck(this, Lightbox);
    this.builder = builder;
    this.arrow = this.builder.lightboxArrow;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;

    // let builderStuff = document.querySelector('#_cbhtml'); // All editing controls will be placed within <div id="_cbhtml">...</div>
    // if(!builderStuff) {
    //     builderStuff = dom.createElement('div');
    //     builderStuff.id = '_cbhtml';
    //     builderStuff.className = 'is-ui';
    //     dom.appendChild(document.body, builderStuff);
    // } 
    // this.builderStuff = builderStuff;

    this.id = this.makeid();

    // let html = `
    //     <div class="is-lightbox lightbox-externalvideo-edit" tabindex="-1" role="dialog" aria-modal="true" aria-hidden="true">
    //         <button class="cmd-lightbox-close" title="${util.out('Close')}" type="button" style="flex:none;position:absolute;top:0;right:0;background:none;z-index:1;">
    //             <svg><use xlink:href="#_${this.id}svgIconClose"></use></svg>
    //         </button>
    //         <div class="lightbox-content" style="width:100%;">
    //             <div class="embed-responsive embed-responsive-16by9" style="width:100%;">
    //             <iframe tabindex="0" width="560" height="315" src="about:blank" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    //             </div>
    //         </div>
    //     </div>
    //     <div class="is-lightbox lightbox-video-edit light" tabindex="-1" role="dialog" aria-modal="true" aria-hidden="true">
    //         <button class="cmd-lightbox-close" title="${util.out('Close')}" type="button" style="flex:none;position:absolute;top:0;right:0;background:none;z-index:1;">
    //             <svg><use xlink:href="#_${this.id}svgIconClose"></use></svg>
    //         </button>
    //         <div class="lightbox-content" style="width:100%;"></div>
    //     </div>
    //     <div class="is-lightbox lightbox-image-edit light" tabindex="-1" role="dialog" aria-modal="true" aria-hidden="true">
    //         <button class="cmd-lightbox-close" title="${util.out('Close')}" type="button" style="flex:none;position:absolute;top:0;right:0;background:none;z-index:1;">
    //             <svg><use xlink:href="#_${this.id}svgIconClose"></use></svg>
    //         </button>
    //         <div class="lightbox-content" style="width:100%;"></div>
    //     </div>
    //     <svg width="0" height="0" style="position:absolute;display:none;">
    //         <defs>
    //             <symbol viewBox="0 0 24 24" id="_${this.id}svgIconClose" stroke-width="0.7" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    //                 <path stroke="none" d="M0 0h24v24H0z" fill="none"></path><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
    //             </symbol>
    //         </defs>
    //     </svg>
    // `;

    var html = "\n\n                <div class=\"is-lightbox lightbox-edit\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                    <button class=\"cmd-lightbox-close\" title=\"".concat(util.out('Close'), "\" type=\"button\">\n                        <svg><use xlink:href=\"#__").concat(this.id, "svgLightboxClose\"></use></svg>\n                    </button>\n\n                    <div class=\"lightbox-content\" style=\"width:100%;\">\n                    </div>\n\n                    <button class=\"cmd-lightbox-prev\" title=\"").concat(util.out('Previous'), "\" type=\"button\" style=\"top:50%;left:3px;\">\n                        <svg><use xlink:href=\"#__").concat(this.id, "svgLightboxLeft\"></use></svg>\n                    </button>\n                    <button class=\"cmd-lightbox-next\" title=\"").concat(util.out('Next'), "\" type=\"button\" style=\"top:50%;left:auto;right:3px\">\n                        <svg><use xlink:href=\"#__").concat(this.id, "svgLightboxRight\"></use></svg>\n                    </button>\n                </div>\n\n                <svg width=\"0\" height=\"0\" style=\"position:absolute;display:none;\">\n                    <defs>\n                        <symbol viewBox=\"0 0 24 24\" id=\"__").concat(this.id, "svgLightboxClose\" stroke-width=\"0.7\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n                        </symbol>\n                        <symbol viewBox=\"0 0 24 24\" id=\"__").concat(this.id, "svgLightboxLeft\" stroke-width=\"0.7\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                            <polyline points=\"15 6 9 12 15 18\"></polyline>\n                        </symbol>\n                        <symbol viewBox=\"0 0 24 24\" id=\"__").concat(this.id, "svgLightboxRight\" stroke-width=\"0.7\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                            <polyline points=\"9 6 15 12 9 18\"></polyline>\n                        </symbol>\n                    </defs>\n                </svg>\n            ");
    dom.appendHtml(this.builderStuff, html);
    var close = function close() {
      var lightbox = document.querySelector('.is-lightbox.lightbox-edit.active');
      dom.removeClass(lightbox, 'active');
      var btnClose = lightbox.querySelector('.cmd-lightbox-close');
      btnClose.style.opacity = 0;
      document.body.style.overflowY = '';
      setTimeout(function () {
        var iframe = lightbox.querySelector('iframe');
        if (iframe) {
          iframe.setAttribute('src', 'about:blank');
        }
        var div = lightbox.querySelector('.lightbox-content');
        if (lightbox.querySelector('video')) div.innerHTML = '';
        lightbox.style.display = '';
        _this.builder.preserveSelection = false;
        if (_this.elmFocus) _this.elmFocus.focus();
      }, 300);
    };
    var prev = function prev() {
      var list = _this.getList();
      var lightbox = document.querySelector('.is-lightbox.lightbox-edit.active');
      var url = lightbox.getAttribute('data-url');
      list.forEach(function (item) {
        if (url === item.url) {
          var currentIndex = list.indexOf(item);
          var prevIndex;
          prevIndex = (currentIndex - 1) % list.length;
          if (prevIndex === -1) {
            prevIndex = list.length - 1;
          }
          _this.openThen(list[prevIndex]);
          var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
          btnPrev.focus();
        }
      });
    };
    var next = function next() {
      var list = _this.getList();
      var lightbox = document.querySelector('.is-lightbox.lightbox-edit.active');
      var url = lightbox.getAttribute('data-url');
      list.forEach(function (item) {
        if (url === item.url) {
          var currentIndex = list.indexOf(item);
          var nextIndex = (currentIndex + 1) % list.length;
          _this.openThen(list[nextIndex]);
          var btnNext = lightbox.querySelector('.cmd-lightbox-next');
          btnNext.focus();
        }
      });
    };
    var handleItemKeyDown = function handleItemKeyDown(e) {
      if (e.keyCode === 27) {
        // escape key
        close();
        e.preventDefault();
      } /*else if ((e.which === 9 && !e.shiftKey)) { // tab key pressed
          let lightbox = document.querySelector('.is-lightbox.active');
          const btnClose = lightbox.querySelector('.cmd-lightbox-close');
          btnClose.focus();
          e.preventDefault();
        }*/

      if (_this.arrow) {
        if (e.which === 37 && !e.shiftKey) {
          // left
          prev();
        }
        if (e.which === 39 && !e.shiftKey) {
          // right
          next();
        }
      }
    };
    var lightboxes = this.builderStuff.querySelectorAll('div.lightbox-edit');
    lightboxes.forEach(function (lightbox) {
      lightbox.addEventListener('keydown', handleItemKeyDown);
      var btnClose = lightbox.querySelector('.cmd-lightbox-close');
      btnClose.addEventListener('click', function (e) {
        close();
        e.preventDefault();
        e.stopImmediatePropagation();
      });
      btnClose.addEventListener('keydown', function (e) {
        if (e.keyCode === 13 || e.keyCode === 32) {
          // enter or spacebar key
          close();
        }
        e.preventDefault();
        e.stopImmediatePropagation();
      });
      var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
      if (btnPrev) btnPrev.addEventListener('click', function (e) {
        prev();
        e.preventDefault();
        e.stopImmediatePropagation();
      });
      if (btnPrev) btnPrev.addEventListener('keydown', function (e) {
        if (e.keyCode === 13 || e.keyCode === 32) {
          // enter or spacebar key
          prev();
          e.preventDefault();
        }
      });
      var btnNext = lightbox.querySelector('.cmd-lightbox-next');
      if (btnNext) btnNext.addEventListener('click', function (e) {
        next();
        e.preventDefault();
        e.stopImmediatePropagation();
      });
      if (btnNext) btnNext.addEventListener('keydown', function (e) {
        if (e.keyCode === 13 || e.keyCode === 32) {
          // enter or spacebar key
          next();
          e.preventDefault();
        }
      });
    });

    // this.init();
  } //constructor

  /*
  init() {
       // Find all elements that have .block-click & .button-click class.
      // Then read data attributes:
      //  - data-modal-theme: dark or light
      //  - data-modal-color (background color)
      //  - data-modal-image (image url)
      //  - data-modal-video (video url)
      //  - data-modal-externalvideo (ex. youtube url)
      const blockClickables = document.querySelectorAll('.is-lightbox'); //.block-click,.button-click
      blockClickables.forEach((block)=>{
          block.addEventListener('click', (e)=>{
              let url;
              let extension;
               if(block.tagName.toLowerCase() === 'a') {
                  url = block.getAttribute('href');
                  extension = url.split('.').pop();
              } else {
                  return;
              }
               let theme = block.getAttribute('data-modal-theme');
              if(!theme) theme='light';
               const color = block.getAttribute('data-modal-color');
               if(extension==='jpg'||extension==='jpeg'||extension==='png'||extension==='gif'||extension==='webm') {
                  this.openImage(url, theme, color);
              } 
              if(extension==='mp4') {
                  this.openVideo(url, 'dark', color);
              } 
               if(url.toLowerCase().indexOf('youtube.com')!==-1 ||
              url.toLowerCase().indexOf('vimeo.com')!==-1) {
                  this.openExternalVideo(url, 'dark', color);
              } 
               if(block.getAttribute('data-modal-image')) {
                  url = block.getAttribute('data-modal-image');
                  this.openImage(url, theme, color);
              }
              if(block.getAttribute('data-modal-video')) {
                  url = block.getAttribute('data-modal-video');
                  this.openVideo(url, 'dark', color);
              }
              if(block.getAttribute('data-modal-externalvideo')) {
                  url = block.getAttribute('data-modal-externalvideo');
                  this.openExternalVideo(url, 'dark', color);
              }
               e.preventDefault();
          });
      });
   } //init
  */
  lightbox_createClass(Lightbox, [{
    key: "openThen",
    value: function openThen(item) {
      if (item.type === 'image') {
        this.programmatically = true;
        this.openImage(item.url, item.theme, item.color);
      }
      if (item.type === 'video') {
        this.programmatically = true;
        this.openVideo(item.url, item.theme, item.color);
      }
      if (item.type === 'externalvideo') {
        this.programmatically = true;
        this.openExternalVideo(item.url, item.theme, item.color);
      }
    }
  }, {
    key: "openImage",
    value: function openImage(url, theme, color) {
      var dom = this.dom;
      if (this.builder.doc.activeElement) {
        this.elmFocus = this.builder.doc.activeElement;
        if (!this.programmatically) {
          var parent = this.builder.doc.activeElement.closest('[data-gallery]');
          this.parent = parent;
        }
      }
      this.builder.preserveSelection = true;
      var lightbox = document.querySelector('.is-lightbox.lightbox-edit');

      // in case opened in an iframe (ex. preview)
      if (window.frameElement && !lightbox) {
        lightbox = window.parent.document.querySelector('.is-lightbox.lightbox-edit');
      }
      if (!this.programmatically) {
        var list = this.getList();
        var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
        btnPrev.style.opacity = 0;
        var btnNext = lightbox.querySelector('.cmd-lightbox-next');
        btnNext.style.opacity = 0;
        btnPrev.style.display = 'none';
        btnNext.style.display = 'none';
        if (list.length > 1 && this.arrow) {
          btnPrev.style.display = 'flex';
          btnNext.style.display = 'flex';
          setTimeout(function () {
            var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
            btnPrev.style.opacity = 1;
            var btnNext = lightbox.querySelector('.cmd-lightbox-next');
            btnNext.style.opacity = 1;
          }, 500);
        }
        var btnClose = lightbox.querySelector('.cmd-lightbox-close');
        btnClose.style.opacity = 0;
        setTimeout(function () {
          dom.addClass(lightbox, 'active');
          setTimeout(function () {
            btnClose.style.opacity = 1;
          }, 450);
        }, 10);
      }
      lightbox.setAttribute('data-url', url);
      lightbox.classList.remove('lightbox-video');
      lightbox.classList.remove('lightbox-externalvideo');
      lightbox.classList.add('lightbox-image');
      if (color) lightbox.style.backgroundColor = color;
      var div = lightbox.querySelector('.lightbox-content');
      if (!this.programmatically) {
        div.innerHTML = "<img src=\"".concat(url, "\">");
      } else {
        div.style.transition = 'all 200ms ease';
        div.style.opacity = '0';
        setTimeout(function () {
          div.innerHTML = "<img src=\"".concat(url, "\">");
          div.style.opacity = '1';
        }, 200);
      }
      if (theme === 'light') {
        dom.addClass(lightbox, 'light');
        dom.removeClass(lightbox, 'dark');
      } else {
        dom.addClass(lightbox, 'dark');
        dom.removeClass(lightbox, 'light');
      }
      lightbox.style.display = 'flex';
      if (!window.frameElement) document.body.style.overflowY = 'hidden';
      lightbox.focus({
        preventScroll: true
      });
      this.programmatically = false;
    }
  }, {
    key: "openVideo",
    value: function openVideo(url, theme, color) {
      var dom = this.dom;
      if (this.builder.doc.activeElement) {
        this.elmFocus = this.builder.doc.activeElement;
        if (!this.programmatically) {
          var parent = this.builder.doc.activeElement.closest('[data-gallery]');
          this.parent = parent;
        }
      }
      this.builder.preserveSelection = true;
      var lightbox = document.querySelector('.is-lightbox.lightbox-edit');

      // in case opened in an iframe (ex. preview)
      if (window.frameElement && !lightbox) {
        lightbox = window.parent.document.querySelector('.is-lightbox.lightbox-edit');
      }
      if (!this.programmatically) {
        var list = this.getList();
        var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
        btnPrev.style.opacity = 0;
        var btnNext = lightbox.querySelector('.cmd-lightbox-next');
        btnNext.style.opacity = 0;
        btnPrev.style.display = 'none';
        btnNext.style.display = 'none';
        if (list.length > 1 && this.arrow) {
          btnPrev.style.display = 'flex';
          btnNext.style.display = 'flex';
          setTimeout(function () {
            var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
            btnPrev.style.opacity = 1;
            var btnNext = lightbox.querySelector('.cmd-lightbox-next');
            btnNext.style.opacity = 1;
          }, 500);
        }
        var btnClose = lightbox.querySelector('.cmd-lightbox-close');
        btnClose.style.opacity = 0;
        setTimeout(function () {
          dom.addClass(lightbox, 'active');
          setTimeout(function () {
            btnClose.style.opacity = 1;
          }, 450);
        }, 10);
      }
      lightbox.setAttribute('data-url', url);
      lightbox.classList.add('lightbox-video');
      lightbox.classList.remove('lightbox-externalvideo');
      lightbox.classList.remove('lightbox-image');
      if (color) lightbox.style.backgroundColor = color;
      var div = lightbox.querySelector('.lightbox-content');
      if (!this.programmatically) {
        div.innerHTML = "<video playsinline controls autoplay width=\"100%\">\n                <source src=\"".concat(url, "\" type=\"video/mp4\">\n            </video>");
      } else {
        div.style.transition = 'all 200ms ease';
        div.style.opacity = '0';
        setTimeout(function () {
          div.innerHTML = "<video playsinline controls autoplay width=\"100%\">\n                    <source src=\"".concat(url, "\" type=\"video/mp4\">\n                </video>");
          div.style.opacity = '1';
        }, 200);
      }
      if (theme === 'light') {
        dom.addClass(lightbox, 'light');
        dom.removeClass(lightbox, 'dark');
      } else {
        dom.addClass(lightbox, 'dark');
        dom.removeClass(lightbox, 'light');
      }
      lightbox.style.display = 'flex';
      if (!window.frameElement) document.body.style.overflowY = 'hidden';
      lightbox.focus({
        preventScroll: true
      });
      this.programmatically = false;
    }
  }, {
    key: "openExternalVideo",
    value: function openExternalVideo(url, theme, color) {
      var _this2 = this;
      var dom = this.dom;
      if (this.builder.doc.activeElement) {
        this.elmFocus = this.builder.doc.activeElement;
        if (!this.programmatically) {
          var parent = this.builder.doc.activeElement.closest('[data-gallery]');
          this.parent = parent;
        }
      }
      this.builder.preserveSelection = true;
      var lightbox = document.querySelector('.is-lightbox.lightbox-edit');

      // in case opened in an iframe (ex. preview)
      if (window.frameElement && !lightbox) {
        lightbox = window.parent.document.querySelector('.is-lightbox.lightbox-edit');
      }
      if (!this.programmatically) {
        var list = this.getList();
        var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
        btnPrev.style.opacity = 0;
        var btnNext = lightbox.querySelector('.cmd-lightbox-next');
        btnNext.style.opacity = 0;
        btnPrev.style.display = 'none';
        btnNext.style.display = 'none';
        if (list.length > 1 && this.arrow) {
          btnPrev.style.display = 'flex';
          btnNext.style.display = 'flex';
          setTimeout(function () {
            var btnPrev = lightbox.querySelector('.cmd-lightbox-prev');
            btnPrev.style.opacity = 1;
            var btnNext = lightbox.querySelector('.cmd-lightbox-next');
            btnNext.style.opacity = 1;
          }, 500);
        }
        var btnClose = lightbox.querySelector('.cmd-lightbox-close');
        btnClose.style.opacity = 0;
        setTimeout(function () {
          dom.addClass(lightbox, 'active');
          setTimeout(function () {
            btnClose.style.opacity = 1;
          }, 450);
        }, 10);
      }
      lightbox.setAttribute('data-url', url);
      lightbox.classList.remove('lightbox-video');
      lightbox.classList.add('lightbox-externalvideo');
      lightbox.classList.remove('lightbox-image');
      if (color) lightbox.style.backgroundColor = color;
      if (theme === 'light') {
        dom.addClass(lightbox, 'light');
        dom.removeClass(lightbox, 'dark');
      } else {
        dom.addClass(lightbox, 'dark');
        dom.removeClass(lightbox, 'light');
      }
      var div = lightbox.querySelector('.lightbox-content');
      if (!this.programmatically) {
        div.innerHTML = "<div class=\"embed-responsive embed-responsive-16by9\" style=\"width:100%;\">\n                <iframe width=\"560\" height=\"315\" src=\"about:blank\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n            </div>";
        var iframe = lightbox.querySelector('iframe');
        url = this.getIframeVideoUrl(url);
        if (url !== '') iframe.setAttribute('src', url);
      } else {
        div.style.transition = 'all 200ms ease';
        div.style.opacity = '0';
        setTimeout(function () {
          div.innerHTML = "<div class=\"embed-responsive embed-responsive-16by9\" style=\"width:100%;\">\n                    <iframe width=\"560\" height=\"315\" src=\"about:blank\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n                </div>";
          div.style.opacity = '1';
          var iframe = lightbox.querySelector('iframe');
          url = _this2.getIframeVideoUrl(url);
          if (url !== '') iframe.setAttribute('src', url);
        }, 200);
      }
      lightbox.style.display = 'flex';
      if (!window.frameElement) document.body.style.overflowY = 'hidden';

      // const div = lightbox.querySelector('.lightbox-content');
      // div.style.width=((div.offsetHeight*16)/9) + 'px';

      lightbox.focus({
        preventScroll: true
      });
      this.programmatically = false;
    }
  }, {
    key: "getIframeVideoUrl",
    value: function getIframeVideoUrl(src) {
      // https://regex101.com/library/OY96XI
      // https://stackoverflow.com/questions/3452546/how-do-i-get-the-youtube-video-id-from-a-url
      // let youRegex = /^http[s]?:\/\/(((www.youtube.com\/watch\?(feature=player_detailpage&)?)v=)|(youtu.be\/))([^#&?]*)/;
      var youRegex = /^.*(?:https?:)?(?:\/\/)?(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\/\S*?[^\w\s-])((?!videoseries)[\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/;
      var vimeoRegex = /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/)|(video\/))?([0-9]+)\/?/;
      // let youRegexMatches = youRegex.exec(src);
      var youRegexMatches = src.match(youRegex);
      var vimeoRegexMatches = vimeoRegex.exec(src);
      // if (youRegexMatches !== null || vimeoRegexMatches !== null) {
      if ((youRegexMatches !== null || vimeoRegexMatches !== null) && src.indexOf('player.vimeo.com') === -1 && src.indexOf('youtube.com/embed/') === -1 && src.indexOf('youtube-nocookie.com/embed/') === -1) {
        if (youRegexMatches !== null) {
          // && youRegexMatches.length >= 7) {
          // let youMatch = youRegexMatches[6];
          var youMatch = youRegexMatches[1];

          // src = 'https://www.youtube.com/embed/' + youMatch + '?rel=0&autoplay=1&color=white';
          src = 'https://www.youtube-nocookie.com/embed/' + youMatch + '?rel=0&autoplay=1&color=white';
        }
        if (vimeoRegexMatches !== null && vimeoRegexMatches.length >= 7) {
          var vimeoMatch = vimeoRegexMatches[6];
          src = 'https://player.vimeo.com/video/' + vimeoMatch;
        }
      } else {
        if (src.indexOf('youtube-nocookie.com/embed/') !== -1) {
          if (src.indexOf('?') === -1) {
            src += '?rel=0&autoplay=1&color=white';
          }
        }
      }
      return src;
    }
  }, {
    key: "makeid",
    value: function makeid() {
      var text = '';
      var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      for (var i = 0; i < 2; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      var text2 = '';
      var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      for (var _i = 0; _i < 5; _i++) {
        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
      }
      return text + text2;
    }
  }, {
    key: "getList",
    value: function getList() {
      var _this3 = this;
      var arrGallery = [];
      var blockClickables = this.builder.doc.querySelectorAll('.block-click,.button-click,.is-lightbox');
      if (this.parent) {
        blockClickables = this.parent.querySelectorAll('.block-click,.button-click,.is-lightbox');
      }
      blockClickables.forEach(function (block) {
        if (!_this3.parent) {
          if (block.closest('[data-gallery')) return;
        }
        var url;
        var extension;
        if (block.tagName.toLowerCase() === 'a') {
          url = block.getAttribute('href');
          extension = url.split('.').pop().split('?')[0].split('#')[0];
        } else if (block.getAttribute('data-modal-url')) {
          url = block.getAttribute('data-modal-url');
          extension = url.split('.').pop().split('?')[0].split('#')[0];
        }
        var theme = block.getAttribute('data-modal-theme');
        if (!theme) theme = 'light';
        var color = block.getAttribute('data-modal-color');
        if (url) {
          if (extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp') {
            arrGallery.push({
              type: 'image',
              url: url,
              theme: theme,
              color: color
            });
          } else if (extension === 'mp4') {
            arrGallery.push({
              type: 'video',
              url: url,
              theme: 'dark',
              color: color
            });
          } else if (url.toLowerCase().indexOf('youtube.com') !== -1 || url.toLowerCase().indexOf('youtube-nocookie.com') !== -1 || url.toLowerCase().indexOf('vimeo.com') !== -1) {
            arrGallery.push({
              type: 'externalvideo',
              url: url,
              theme: 'dark',
              color: color
            });
          }
        }
        if (block.getAttribute('data-modal-image')) {
          url = block.getAttribute('data-modal-image');
          arrGallery.push({
            type: 'image',
            url: url,
            theme: theme,
            color: color
          });
        } else if (block.getAttribute('data-modal-video')) {
          url = block.getAttribute('data-modal-video');
          arrGallery.push({
            type: 'video',
            url: url,
            theme: 'dark',
            color: color
          });
        } else if (block.getAttribute('data-modal-externalvideo')) {
          url = block.getAttribute('data-modal-externalvideo');
          arrGallery.push({
            type: 'externalvideo',
            url: url,
            theme: 'dark',
            color: color
          });
        }
      });
      return arrGallery;
    }
  }]);
  return Lightbox;
}(); //Lightbox
/* harmony default export */ const lightbox = (Lightbox);
;// CONCATENATED MODULE: ./src/contentbuilder/shortcutinfo.js
function shortcutinfo_typeof(obj) { "@babel/helpers - typeof"; return shortcutinfo_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, shortcutinfo_typeof(obj); }
function shortcutinfo_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function shortcutinfo_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, shortcutinfo_toPropertyKey(descriptor.key), descriptor); } }
function shortcutinfo_createClass(Constructor, protoProps, staticProps) { if (protoProps) shortcutinfo_defineProperties(Constructor.prototype, protoProps); if (staticProps) shortcutinfo_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function shortcutinfo_toPropertyKey(arg) { var key = shortcutinfo_toPrimitive(arg, "string"); return shortcutinfo_typeof(key) === "symbol" ? key : String(key); }
function shortcutinfo_toPrimitive(input, hint) { if (shortcutinfo_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (shortcutinfo_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var ShortcutInfo = /*#__PURE__*/function () {
  function ShortcutInfo(builder) {
    shortcutinfo_classCallCheck(this, ShortcutInfo);
    this.builder = builder;
    var util = this.builder.util;
    this.util = util;
    var dom = this.builder.dom;
    this.dom = dom;
    var builderStuff = this.builder.builderStuff;
    this.builderStuff = builderStuff;
    var shortcutModal = builderStuff.querySelector('.is-modal.shortcuts');
    if (!shortcutModal) {
      var html = "<div class=\"is-modal shortcuts\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\">\n                <div class=\"is-modal-bar is-draggable\">".concat(util.out('Shortcuts'), "</div>\n\n                <table>\n                    <tr>\n                        <td class=\"shortcut-title\" colspan=\"2\">").concat(util.out('Basic'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Copy'), "</td><td>\u2318C</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Cut'), "</td><td>\u2318X</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Paste'), "</td><td>\u2318V</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Undo'), "</td><td>\u2318Z</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Redo'), "</td><td>\u2318Shift+Z</td>\n                    </tr>\n\n                    <tr>\n                        <td class=\"shortcut-title\" colspan=\"2\">").concat(util.out('Editing'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Bold'), "</td><td>\u2318B</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Italic'), "</td><td>\u2318I</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Underline'), "</td><td>\u2318U</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Strikethrough'), "</td><td>\u2318S</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Indent'), "</td><td>\u2318]</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Outdent'), "</td><td>\u2318[</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Insert Link'), "</td><td>\u2318K</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Insert Image'), "</td><td>\u2318P</td>\n                    </tr>\n\n                    <tr>\n                        <td class=\"shortcut-title\" colspan=\"2\">").concat(util.out('Navigation'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Show shortcut info'), "</td><td>\u2318/</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Navigate to the next control'), "</td><td>").concat(util.out('Tab'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Navigate to the previous control'), "</td><td>").concat(util.out('Shift'), "+").concat(util.out('Tab'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Select control that has focus'), "<br></td><td>").concat(util.out('Enter'), " ").concat(util.out('or'), " ").concat(util.out('Spacebar'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Select option that has focus (eg. checkbox)'), "<br></td><td>").concat(util.out('Spacebar'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Move up in selection list or menu'), "</td><td>").concat(util.out('Up arrow'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Move down in selection list or menu'), "</td><td>").concat(util.out('Down arrow'), "</td>\n                    </tr>\n                    <tr>\n                        <td>").concat(util.out('Close modal or popup'), "</td><td>").concat(util.out('Esc'), "</td>\n                    </tr>\n                </table>\n            \n            </div>\n            </div>\n            ");
      dom.appendHtml(builderStuff, html);
      shortcutModal = builderStuff.querySelector('.is-modal.shortcuts');
      var btnClose = shortcutModal.querySelector('.is-modal-close');
      dom.addEventListener(btnClose, 'click', function () {
        dom.removeClass(shortcutModal, 'active');
      });
    }
    this.shortcutModal = shortcutModal;
  }
  shortcutinfo_createClass(ShortcutInfo, [{
    key: "open",
    value: function open() {
      var util = this.builder.util;
      util.showModal(this.shortcutModal, false);
    }
  }]);
  return ShortcutInfo;
}();
/* harmony default export */ const shortcutinfo = (ShortcutInfo);
;// CONCATENATED MODULE: ./src/contentbuilder/resizeable.js
function resizeable_typeof(obj) { "@babel/helpers - typeof"; return resizeable_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, resizeable_typeof(obj); }
function resizeable_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function resizeable_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, resizeable_toPropertyKey(descriptor.key), descriptor); } }
function resizeable_createClass(Constructor, protoProps, staticProps) { if (protoProps) resizeable_defineProperties(Constructor.prototype, protoProps); if (staticProps) resizeable_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function resizeable_toPropertyKey(arg) { var key = resizeable_toPrimitive(arg, "string"); return resizeable_typeof(key) === "symbol" ? key : String(key); }
function resizeable_toPrimitive(input, hint) { if (resizeable_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (resizeable_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Resizeable = /*#__PURE__*/function () {
  function Resizeable() {
    var _this = this;
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    resizeable_classCallCheck(this, Resizeable);
    var defaults = {
      treshholds: 13,
      minWidth: 50,
      minHeight: 50,
      adj: 4,
      onResize: function onResize() {},
      resizeHeight: false
    };
    this.opts = Object.assign(this, defaults, opts);
    var pane = this.pane;
    var container = pane.closest('.is-builder');
    var scale = this.getScale(container);
    if (!scale) {
      var wrapper = container.closest('.is-wrapper');
      if (wrapper) scale = this.getScale(wrapper);else scale = 1;
    }

    // Minimum resize
    var minWidth = this.minWidth;
    var minHeight = this.minHeight;

    // Thresholds
    var treshholds = this.treshholds; //4;
    var adj = this.adj;

    // End of what's configurable.
    var clicked = null;
    var onRightEdge, onBottomEdge, onLeftEdge, onTopEdge;
    var b, x, y;
    var redraw = false;
    var calc = function calc(e) {
      b = _this.pane.getBoundingClientRect();
      x = e.clientX - b.left;
      y = e.clientY - b.top;
      onTopEdge = y < treshholds;
      onLeftEdge = x < treshholds;
      onRightEdge = x >= b.width - treshholds;
      onBottomEdge = y >= b.height - treshholds;
    };
    var onDown = function onDown(e) {
      calc(e);
      if (e.target.closest('.glide__arrows')) return false;
      var isResizing = onRightEdge || onBottomEdge || onTopEdge || onLeftEdge;
      clicked = {
        x: x,
        y: y,
        cx: e.clientX,
        cy: e.clientY,
        w: b.width,
        h: b.height,
        isResizing: isResizing,
        onTopEdge: onTopEdge,
        onLeftEdge: onLeftEdge,
        onRightEdge: onRightEdge,
        onBottomEdge: onBottomEdge
      };
    };
    var onMouseDown = function onMouseDown(e) {
      onDown(e);
      // e.preventDefault();
    };

    var onTouchDown = function onTouchDown(e) {
      onDown(e.touches[0]);
      // e.preventDefault();
    };

    var ee;
    function onMove(e) {
      calc(e);
      ee = e;
      redraw = true;
      if (clicked) {
        if (clicked.isResizing) {
          // Prevent text selection
          if (e.stopPropagation) e.stopPropagation();
          if (e.preventDefault) e.preventDefault();
          e.cancelBubble = true;
          e.returnValue = false;
          return false;
        }
      }
    }
    var onTouchMove = function onTouchMove(e) {
      onMove(e.touches[0]);
    };
    var onUp = function onUp(e) {
      var isResizing = clicked ? clicked.isResizing : false;
      calc(e);
      clicked = null;
      if (isResizing) if (_this.resizeEnd) _this.resizeEnd();
    };
    var onTouchEnd = function onTouchEnd(e) {
      if (e.touches.length == 0) onUp(e.changedTouches[0]);
    };
    this.onMouseDown = onMouseDown;
    this.onMove = onMove;
    this.onUp = onUp;
    this.onTouchDown = onTouchDown;
    this.onTouchMove = onTouchMove;
    this.onTouchEnd = onTouchEnd;
    pane.addEventListener('mousedown', onMouseDown);
    pane.ownerDocument.addEventListener('mousemove', onMove);
    pane.ownerDocument.addEventListener('mouseup', onUp);

    // pane.addEventListener('touchstart', onTouchDown);
    pane.addEventListener('touchstart', onTouchDown, {
      passive: true
    });
    pane.ownerDocument.addEventListener('touchmove', onTouchMove);
    pane.ownerDocument.addEventListener('touchend', onTouchEnd);
    var resizing = function resizing() {
      requestAnimationFrame(resizing);
      if (!redraw) return;
      redraw = false;
      if (clicked && clicked.isResizing) {
        var newWidth;
        var newWHeight;
        if (_this.resizeHeight) if (clicked.onBottomEdge) {
          newWHeight = Math.max(y / scale, minHeight) + adj;
          pane.style.height = newWHeight + 'px';
        }
        if (clicked.onRightEdge) {
          var currentWidth = Math.max(ee.clientX - clicked.cx + clicked.w, minWidth);
          if (currentWidth > minWidth) {
            newWidth = currentWidth / scale;
            pane.style.width = newWidth + 'px';
          }
        }
        if (clicked.onLeftEdge) {
          var _currentWidth = Math.max(clicked.cx - ee.clientX + clicked.w, minWidth);
          if (_currentWidth > minWidth) {
            newWidth = _currentWidth / scale;
            pane.style.width = newWidth + 'px';
          }
        }
        _this.onResize(newWidth, newWHeight);
        return;
      }

      // mouseover
      if (onRightEdge && onBottomEdge) {
        if (_this.resizeHeight) pane.style.cursor = 'nwse-resize';
      } else if (onBottomEdge && onLeftEdge) {
        if (_this.resizeHeight) pane.style.cursor = 'nesw-resize';
      } else if (onRightEdge || onLeftEdge) {
        pane.style.cursor = 'ew-resize';
      } else if (onBottomEdge) {
        if (_this.resizeHeight) pane.style.cursor = 'ns-resize';
      } else {
        pane.style.cursor = '';
      }
    };
    resizing();
  }
  resizeable_createClass(Resizeable, [{
    key: "getScale",
    value: function getScale(container) {
      var matrix = window.getComputedStyle(container).transform;
      if (matrix === 'none') return false;
      var values = matrix.split('(')[1];
      values = values.split(')')[0];
      values = values.split(',');
      var a = values[0];
      var b = values[1];
      var scale = Math.sqrt(a * a + b * b);
      return scale;
    }
  }, {
    key: "destroy",
    value: function destroy() {
      var pane = this.pane;
      pane.removeEventListener('mousedown', this.onMouseDown);
      pane.ownerDocument.removeEventListener('mousemove', this.onMove);
      pane.ownerDocument.removeEventListener('mouseup', this.onUp);
      pane.removeEventListener('touchstart', this.onTouchDown);
      pane.ownerDocument.removeEventListener('touchmove', this.onTouchMove);
      pane.ownerDocument.removeEventListener('touchend', this.onTouchEnd);
      pane.style.cursor = '';
    }
  }]);
  return Resizeable;
}();
/* harmony default export */ const resizeable = (Resizeable);
;// CONCATENATED MODULE: ./src/contentbuilder/resize.js
function resize_typeof(obj) { "@babel/helpers - typeof"; return resize_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, resize_typeof(obj); }
function resize_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function resize_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, resize_toPropertyKey(descriptor.key), descriptor); } }
function resize_createClass(Constructor, protoProps, staticProps) { if (protoProps) resize_defineProperties(Constructor.prototype, protoProps); if (staticProps) resize_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function resize_toPropertyKey(arg) { var key = resize_toPrimitive(arg, "string"); return resize_typeof(key) === "symbol" ? key : String(key); }
function resize_toPrimitive(input, hint) { if (resize_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (resize_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var Resize = /*#__PURE__*/function () {
  function Resize(element, builder) {
    var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    resize_classCallCheck(this, Resize);
    var defaults = {
      filterSiblingClass: 'is-row-tool'
    };
    this.opts = Object.assign(this, defaults, opts);
    this.builder = builder;
    this.element = element;
  }
  resize_createClass(Resize, [{
    key: "enable",
    value: function enable() {
      var _this = this;
      var col = this.element;
      var row = col.parentNode;
      this.resize = new resizeable({
        pane: col,
        resizeHeight: this.builder.resizeHeight,
        onResize: function onResize(width, height) {
          _this.builder.util.hideControls();
          var numOfCols = 1;
          Array.from(col.parentNode.children).map(function (item) {
            if (item.classList.contains('is-row-tool')) return;
            if (item.classList.contains('is-rowadd-tool')) return;
            if (item.classList.contains('is-col-tool')) return;
            if (item === col) return;
            numOfCols++;
          });
          if (width) {
            col.style.flex = 'none';
            col.style.width = "".concat(width, "px");

            // adjust others
            var maxWidth = function maxWidth() {
              var otherWidth = 0;
              Array.from(col.parentNode.children).map(function (item) {
                if (item.classList.contains('is-row-tool')) return;
                if (item.classList.contains('is-rowadd-tool')) return;
                if (item.classList.contains('is-col-tool')) return;
                // if(this.opts.filterSibling) if(item.classList.contains(this.opts.filterSibling)) return;

                if (item === col) return;
                otherWidth += item.offsetWidth;
              });
              return row.offsetWidth - otherWidth;
            };
            var max = maxWidth();
            if (parseInt(col.style.width) > max) {
              // Adjust to max
              // percentage = (max / row.offsetWidth) * 100;
              // Or make others auto

              Array.from(col.parentNode.children).map(function (item) {
                if (item.classList.contains('is-row-tool')) return;
                if (item.classList.contains('is-rowadd-tool')) return;
                if (item.classList.contains('is-col-tool')) return;
                // if(this.opts.filterSibling) if(item.classList.contains(this.opts.filterSibling)) return;

                if (item === col) return;

                // // item.style.width = '100%';
                // if(!item.getAttribute('data-html')) item.style.width = '100%';
                // item.style.flex = '';
                if (numOfCols === 2) {
                  if (!item.getAttribute('data-html')) {
                    item.style.width = '100%';
                    item.style.flex = '';
                  }
                } /*else {
                    // if(!item.getAttribute('data-html') && !item.style.width) {
                    //     item.style.width = '100%';
                    //     item.style.flex = '';
                    // }
                    if(!item.getAttribute('data-html') && item===col.nextElementSibling) {
                        item.style.width = '100%';
                        item.style.flex = '';
                    }
                  }*/

                /* New: Specify width for module only, and only if num of columns = 2 */
                if (numOfCols === 2) {
                  if (item.getAttribute('data-html')) {
                    var percentage = col.offsetWidth / col.parentNode.offsetWidth * 100;
                    item.style.width = 100 - percentage + '%';
                    item.style.flex = '0 0 auto';
                  }
                }
              });
              if (numOfCols === 1) {
                col.style.width = '100%';
              }
            } else {
              // New: if other cols has no width, set to 100%
              Array.from(col.parentNode.children).map(function (item) {
                if (item.classList.contains('is-row-tool')) return;
                if (item.classList.contains('is-rowadd-tool')) return;
                if (item.classList.contains('is-col-tool')) return;
                // if(this.opts.filterSibling) if(item.classList.contains(this.opts.filterSibling)) return;

                if (item === col) return;
                if (item.style.width === '') {
                  // item.style.width = '100%';
                  if (!item.getAttribute('data-html')) item.style.width = '100%';
                  item.style.flex = '';
                }

                /* New: Specify width for module only, and only if num of columns = 2 */
                if (numOfCols === 2) {
                  if (item.getAttribute('data-html')) {
                    var percentage = col.offsetWidth / col.parentNode.offsetWidth * 100;
                    item.style.width = 100 - percentage + '%';
                    item.style.flex = '0 0 auto';
                  }
                }
              });
            }
            // /adjust others
          }

          if (height) {
            col.style.height = "".concat(height, "px");
            col.style.minHeight = '';
          }
        },
        resizeEnd: function resizeEnd() {
          var numOfCols = 1;
          Array.from(col.parentNode.children).map(function (item) {
            if (item.classList.contains('is-row-tool')) return;
            if (item.classList.contains('is-rowadd-tool')) return;
            if (item.classList.contains('is-col-tool')) return;
            if (item === col) return;
            numOfCols++;
          });
          if (col.style.width) {
            col.style.width = col.offsetWidth + 'px'; // change from % to px

            var percentage = parseInt(col.style.width) / row.offsetWidth * 100;

            // adjust others
            var maxWidth = function maxWidth() {
              var otherWidth = 0;
              Array.from(col.parentNode.children).map(function (item) {
                if (item.classList.contains('is-row-tool')) return;
                if (item.classList.contains('is-rowadd-tool')) return;
                if (item.classList.contains('is-col-tool')) return;
                // if(this.opts.filterSibling) if(item.classList.contains(this.opts.filterSibling)) return;

                if (item.classList.contains('row-tool')) return;
                if (item === col) return;
                otherWidth += item.offsetWidth;
              });
              return row.offsetWidth - otherWidth;
            };
            var max = maxWidth();
            if (parseInt(col.style.width) > max) {
              // Adjust to max
              // percentage = (max / row.offsetWidth) * 100;
              // Or make others auto

              Array.from(col.parentNode.children).map(function (item) {
                if (item.classList.contains('is-row-tool')) return;
                if (item.classList.contains('is-rowadd-tool')) return;
                if (item.classList.contains('is-col-tool')) return;
                // if(this.opts.filterSibling) if(item.classList.contains(this.opts.filterSibling)) return;

                if (item === col) return;

                // // item.style.width = '100%';
                // if(!item.getAttribute('data-html')) item.style.width = '100%';
                // item.style.flex = '';
                if (numOfCols === 2) {
                  if (!item.getAttribute('data-html')) {
                    item.style.width = '100%';
                    item.style.flex = '';
                  }
                } /*else {
                    // if(!item.getAttribute('data-html') && !item.style.width) {
                    //     item.style.width = '100%';
                    //     item.style.flex = '';
                    // }
                    if(!item.getAttribute('data-html') && item===col.nextElementSibling) {
                        item.style.width = '100%';
                        item.style.flex = '';
                    }
                  }*/
              });
            }
            // /adjust others

            // New: Final fix (if column resized exceeds its max)
            var othersWidth = 0;
            var activeColumnWidth = 0;
            Array.from(col.parentNode.children).map(function (item) {
              if (item.classList.contains('is-row-tool')) return;
              if (item.classList.contains('is-rowadd-tool')) return;
              if (item.classList.contains('is-col-tool')) return;
              // if(this.opts.filterSibling) if(item.classList.contains(this.opts.filterSibling)) return;

              // // Refresh Module
              // if(item.getAttribute('data-html')) {
              //     this.builder.util.refreshModuleLayout(item);
              // }

              if (item === col) {
                activeColumnWidth = item.offsetWidth;
              } else {
                othersWidth += item.offsetWidth;
              }
            });
            var maxResult = row.offsetWidth - othersWidth;
            if (activeColumnWidth > maxResult) {
              percentage = maxResult / row.offsetWidth * 100;
            }
            col.style.width = percentage + '%';

            // Refresh Module
            Array.from(col.parentNode.children).map(function (item) {
              if (item.classList.contains('is-row-tool')) return;
              if (item.classList.contains('is-rowadd-tool')) return;
              if (item.classList.contains('is-col-tool')) return;
              if (item.getAttribute('data-html')) {
                var moduleWidth = item.offsetWidth / row.offsetWidth * 100;
                item.style.width = moduleWidth + '%';
                item.style.flex = 'none';
                if (!item.hasAttribute('data-norefresh')) _this.builder.util.refreshModuleLayout(item);
              }
            });
          }
          if (col.style.height) {
            col.style.minHeight = col.style.height;
            col.style.height = '';
            Array.from(col.parentNode.children).map(function (item) {
              if (item.classList.contains('is-row-tool')) return;
              if (item.classList.contains('is-rowadd-tool')) return;
              if (item.classList.contains('is-col-tool')) return;
              // if(this.opts.filterSibling) if(item.classList.contains(this.opts.filterSibling)) return;

              if (item === col) return;
              item.style.height = '';
              item.style.minHeight = '';
            });
          }

          // // To position columnTool correctly, add delay.
          // setTimeout(()=>{
          //     col.click();
          // },30);

          //Trigger Change event
          _this.builder.opts.onChange();
        }
      });
    }
  }, {
    key: "destroy",
    value: function destroy() {
      this.resize.destroy();
    }
  }]);
  return Resize;
}();
/* harmony default export */ const resize = (Resize);
;// CONCATENATED MODULE: ./src/contentbuilder/contentstuff.js
function contentstuff_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
var ContentStuff = function ContentStuff(builder) {
  contentstuff_classCallCheck(this, ContentStuff);
  this.builder = builder;
  var util = builder.util;
  var html = "<div class=\"is-tool is-column-tool\">\n            <button type=\"button\" tabindex=\"-1\" title=\"".concat(util.out('Add'), "\" class=\"cell-add\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n            <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('More'), "\" class=\"cell-more\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-more\"></use></svg></button>\n            <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Delete'), "\" class=\"cell-remove\"><svg class=\"is-icon-flex\" style=\"margin-left:-1px\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-element-tool\">\n            <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Add'), "\" class=\"elm-add\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n            <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('More'), "\" class=\"elm-more\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-more\"></use></svg></button>\n            <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Delete'), "\" class=\"elm-remove\"><svg class=\"is-icon-flex\" style=\"margin-left:-1px\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n            <button type=\"button\" tabindex=\"-1\" title=\"").concat(util.out('Settings'), "\" class=\"elm-settings\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n\n        <div id=\"divButtonTool\" class=\"is-tool\">\n            <button title=\"").concat(util.out('Edit Button'), "\" data-title=\"").concat(util.out('Edit Button'), "\" class=\"button-edit\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-android-create\"></use></svg></button>\n            <button title=\"").concat(util.out('Duplicate'), "\" data-title=\"").concat(util.out('Duplicate'), "\" class=\"button-duplicate\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></button>\n            <button title=\"").concat(util.out('Delete'), "\" data-title=\"").concat(util.out('Delete'), "\" class=\"button-remove\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-code-tool\">\n            <button title=\"").concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n        <div id=\"divLinkTool\" class=\"is-tool\">\n            <button title=\"").concat(util.out('Edit Button'), "\" data-title=\"").concat(util.out('Edit Button'), "\" class=\"link-button-edit\" style=\"display:none;\"><svg class=\"is-icon-flex\" style=\"width:12px;height:12px;\"><use xlink:href=\"#ion-android-create\"></use></svg></button>\n            <button title=\"").concat(util.out('Link'), "\" data-title=\"").concat(util.out('Link'), "\" class=\"link-edit\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-link\"></use></svg></button>\n            <button title=\"").concat(util.out('Duplicate'), "\" data-title=\"").concat(util.out('Duplicate'), "\" class=\"link-duplicate\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#ion-ios-photos-outline\"></use></svg></button>\n            <button title=\"").concat(util.out('Delete'), "\" data-title=\"").concat(util.out('Delete'), "\" class=\"link-remove\"><svg class=\"is-icon-flex\" style=\"width:20px;height:20px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-iframe-tool\">\n            <button title=\"").concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;background:none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-module-tool\">\n            <button class=\"btn-module-refresh\" title=\"").concat(util.out('Refresh'), "\" data-title=\"").concat(util.out('Refresh'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-reload\"></use></svg></button>\n            <button class=\"btn-module-settings\" title=\"").concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-svg-tool\">\n            <button class=\"btn-svg-settings\" title=\"").concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n        <div id=\"divSpacerTool\" class=\"is-tool is-spacer-tool\">\n            <button title=\"").concat(util.out('Decrease'), "\" data-value=\"-\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-minus-empty\"></use></svg></button>\n            <button title=\"").concat(util.out('Increase'), "\" data-value=\"+\" style=\"border-left: none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-plus-empty\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-table-tool\">\n            <button title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-video-tool\">\n            <button title=\"").concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:40px;height:40px;background:none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n        <div class=\"is-tool is-audio-tool\">\n            <button title=\"").concat(util.out('Settings'), "\" data-title=\"").concat(util.out('Settings'), "\" style=\"width:37px;height:37px;background:none;\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-gear\"></use></svg></button>\n        </div>\n        \n\n        <div class=\"is-locked-indicator\">\n            <svg class=\"is-icon-flex\"><use xlink:href=\"#icon-lock\"></use></svg>\n        </div>\n\n        <svg width=\"0\" height=\"0\" style=\"position:absolute;display:none;\">\n            <defs>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-left\"><path d=\"M352 115.4L331.3 96 160 256l171.3 160 20.7-19.3L201.5 256z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-right\"><path d=\"M160 115.4L180.7 96 352 256 180.7 416 160 396.7 310.5 256z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-plus-outline\"><path d=\"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm0 398.7c-105.1 0-190.7-85.5-190.7-190.7S150.9 65.3 256 65.3 446.7 150.9 446.7 256 361.1 446.7 256 446.7z\"></path><path d=\"M264.1 128h-16.8v119.9H128v16.8h119.3V384h16.8V264.7H384v-16.8H264.1z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-image\"><path d=\"M368 224c26.5 0 48-21.5 48-48s-21.5-48-48-48-48 21.5-48 48 21.5 48 48 48z\"></path><path d=\"M452 64H60c-15.6 0-28 12.7-28 28.3v327.4c0 15.6 12.4 28.3 28 28.3h392c15.6 0 28-12.7 28-28.3V92.3c0-15.6-12.4-28.3-28-28.3zM348.9 261.7c-3-3.5-7.6-6.2-12.8-6.2-5.1 0-8.7 2.4-12.8 5.7L304.6 277c-3.9 2.8-7 4.7-11.5 4.7-4.3 0-8.2-1.6-11-4.1-1-.9-2.8-2.6-4.3-4.1L224 215.3c-4-4.6-10-7.5-16.7-7.5-6.7 0-12.9 3.3-16.8 7.8L64 368.2V107.7c1-6.8 6.3-11.7 13.1-11.7h357.7c6.9 0 12.5 5.1 12.9 12l.3 260.4-99.1-106.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-photos-outline\"><path d=\"M96 128v320h384V128H96zm368 304H112V144h352v288z\"></path><path d=\"M32 64v320h48v-16H48V80h352v32h16V64z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-settings-strong\"><path d=\"M32 376h283.35c6.186-14.112 20.281-24 36.65-24s30.465 9.888 36.65 24H480v32h-91.35c-6.186 14.112-20.281 24-36.65 24s-30.465-9.888-36.65-24H32M32 240h91.35c6.186-14.112 20.281-24 36.65-24s30.465 9.888 36.65 24H480v32H196.65c-6.186 14.112-20.281 24-36.65 24s-30.465-9.888-36.65-24H32M32 104h283.35c6.186-14.112 20.281-24 36.65-24s30.465 9.888 36.65 24H480v32h-91.35c-6.186 14.112-20.281 24-36.65 24s-30.465-9.888-36.65-24H32\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-settings\"><path d=\"M352 104c8.837 0 16 7.163 16 16s-7.163 16-16 16-16-7.163-16-16 7.163-16 16-16m0-16c-17.645 0-32 14.355-32 32s14.355 32 32 32 32-14.355 32-32-14.355-32-32-32zM352 376c8.837 0 16 7.163 16 16s-7.163 16-16 16-16-7.163-16-16 7.163-16 16-16m0-16c-17.645 0-32 14.355-32 32s14.355 32 32 32 32-14.355 32-32-14.355-32-32-32zM160 240c8.837 0 16 7.163 16 16s-7.163 16-16 16-16-7.163-16-16 7.163-16 16-16m0-16c-17.645 0-32 14.355-32 32s14.355 32 32 32 32-14.355 32-32-14.355-32-32-32zM207.32 248H480v16H207.32c.439-2.604.68-5.273.68-8s-.24-5.396-.68-8zM112 256c0 2.727.24 5.396.68 8H32v-16h80.68a47.955 47.955 0 0 0-.68 8zM399.32 384H480v16h-80.68c.439-2.604.68-5.273.68-8s-.24-5.396-.68-8zM304 392c0 2.727.24 5.396.68 8H32v-16h272.68a47.955 47.955 0 0 0-.68 8zM399.32 112H480v16h-80.68c.439-2.604.68-5.273.68-8s-.24-5.396-.68-8zM304.68 112c-.439 2.604-.68 5.273-.68 8s.24 5.396.68 8H32v-16h272.68z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-options\"><path d=\"M32 384h272v32H32zM400 384h80v32h-80zM384 447.5c0 17.949-14.327 32.5-32 32.5-17.673 0-32-14.551-32-32.5v-95c0-17.949 14.327-32.5 32-32.5 17.673 0 32 14.551 32 32.5v95z\"></path><g><path d=\"M32 240h80v32H32zM208 240h272v32H208zM192 303.5c0 17.949-14.327 32.5-32 32.5-17.673 0-32-14.551-32-32.5v-95c0-17.949 14.327-32.5 32-32.5 17.673 0 32 14.551 32 32.5v95z\"></path></g><g><path d=\"M32 96h272v32H32zM400 96h80v32h-80zM384 159.5c0 17.949-14.327 32.5-32 32.5-17.673 0-32-14.551-32-32.5v-95c0-17.949 14.327-32.5 32-32.5 17.673 0 32 14.551 32 32.5v95z\"></path></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-list-number\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-1043.45,1024 C-1039.25,946.283 -1023.18,878.648 -995.249,821.096 C-967.313,763.544 -912.806,711.242 -831.728,664.192 L-710.742,594.247 C-656.55,562.74 -618.532,535.854 -596.687,513.589 C-562.24,478.722 -545.016,438.813 -545.016,393.863 C-545.016,341.352 -560.769,299.658 -592.276,268.781 C-623.783,237.904 -665.792,222.466 -718.304,222.466 C-796.02,222.466 -849.792,251.873 -879.619,310.685 C-895.582,342.192 -904.404,385.882 -906.084,441.754 L-1021.4,441.754 C-1020.14,363.197 -1005.65,299.133 -977.92,249.562 C-928.769,162.183 -842.02,118.494 -717.673,118.494 C-614.331,118.494 -538.82,146.43 -491.139,202.302 C-443.459,258.174 -419.619,320.347 -419.619,388.822 C-419.619,461.078 -445.034,522.831 -495.865,574.082 C-525.272,603.909 -577.993,640.037 -654.03,682.466 L-740.358,730.356 C-781.527,753.041 -813.874,774.676 -837.399,795.26 C-879.408,831.808 -905.874,872.347 -916.797,916.877 L-424.03,916.877 L-424.03,1024 L-1043.45,1024 Z \"  /><path d=\"M-922.391,-764.384 L-922.391,-851.343 C-840.474,-859.324 -783.341,-872.662 -750.994,-891.356 C-718.647,-910.05 -694.492,-954.265 -678.529,-1024 L-589.049,-1024 L-589.049,-125.425 L-710.035,-125.425 L-710.035,-764.384 L-922.391,-764.384 Z \"  /><path d=\"M-198.618,-510.942 L-198.618,-667.156 L1004.57,-667.156 L1004.57,-510.942 L-198.618,-510.942 Z \"  /><path d=\"M-198.618,78.1071 L-198.618,-78.1071 L1004.57,-78.1071 L1004.57,78.1071 L-198.618,78.1071 Z \"  /><path d=\"M-179.185,649.354 L-179.185,493.14 L1024,493.14 L1024,649.354 L-179.185,649.354 Z \"  /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-list-bullet\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-379.801,-514.33 L-379.801,-670.545 L914.662,-670.545 L914.662,-514.33 L-379.801,-514.33 Z \"  /><path d=\"M-379.801,78.1071 L-379.801,-78.1071 L914.662,-78.1071 L914.662,78.1071 L-379.801,78.1071 Z \"  /><path d=\"M-379.801,670.545 L-379.801,514.33 L914.662,514.33 L914.662,670.545 L-379.801,670.545 Z \"  /><path d=\"M-929.642,-469.441 L-929.642,-715.434 L-669.092,-715.434 L-669.092,-469.441 L-929.642,-469.441 Z \"  /><path d=\"M-929.642,127.109 L-929.642,-118.885 L-669.092,-118.885 L-669.092,127.109 L-929.642,127.109 Z \"  /><path d=\"M-929.642,715.434 L-929.642,469.441 L-669.092,469.441 L-669.092,715.434 L-929.642,715.434 Z \"  /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-clean\">\n                <g transform=\"matrix(1,0,0,1,1024.0,1024.0)\">\n                    <path d=\"M75.0013,893.849 L-1030.73,900.993 L-32.1518,-880.838 L1009.54,-880.838 L75.0013,893.849 Z \" fill=\"currentColor\" />\n                    <path d=\"M-30.8571,780.685 L-845.2,787.828 L-508.893,193.749 L305.26,194.963 L-30.8571,780.685 Z \" fill=\"#ffffff\" fill-opacity=\"1.00\" />\n                </g>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-location\"><path d=\"M256 64c-65.9 0-119.3 53.7-119.3 120 0 114.6 119.3 264 119.3 264s119.3-149.4 119.3-264c0-66.3-53.4-120-119.3-120zm0 178.2c-31.2 0-56.4-25.4-56.4-56.7 0-31.3 25.3-56.8 56.4-56.8 31.2 0 56.4 25.4 56.4 56.8 0 31.3-25.2 56.7-56.4 56.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-film-outline\"><path d=\"M0 360h400v-336h-400v336zM72 40v48h-56v-48h56zM72 104v48h-56v-48h56zM72 168v48h-56v-48h56zM72 232v48h-56v-48h56zM72 296v48h-56v-48h56zM312 40v144h-224v-144h224zM312 200v144h-224v-144h224zM384 40v48h-56v-48h56zM384 104v48h-56v-48h56zM384 168v48h-56v-48\n                h56zM384 232v48h-56v-48h56zM384 296v48h-56v-48h56z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-social-youtube-outline\"><path d=\"M265 96c65.3 0 118.7 1.1 168.1 3.3h1.4c23.1 0 42 22 42 49.1v1.1l.1 1.1c2.3 34 3.4 69.3 3.4 104.9.1 35.6-1.1 70.9-3.4 104.9l-.1 1.1v1.1c0 13.8-4.7 26.6-13.4 36.1-7.8 8.6-18 13.4-28.6 13.4h-1.6c-52.9 2.5-108.8 3.8-166.4 3.8h-10.6.1-10.9c-57.8 0-113.7-1.3-166.2-3.7h-1.6c-10.6 0-20.7-4.8-28.5-13.4-8.6-9.5-13.4-22.3-13.4-36.1v-1.1l-.1-1.1c-2.4-34.1-3.5-69.4-3.3-104.7v-.2c-.1-35.3 1-70.5 3.3-104.6l.1-1.1v-1.1c0-27.2 18.8-49.3 41.9-49.3h1.4c49.5-2.3 102.9-3.3 168.2-3.3H265m0-32.2h-18c-57.6 0-114.2.8-169.6 3.3-40.8 0-73.9 36.3-73.9 81.3C1 184.4-.1 220 0 255.7c-.1 35.7.9 71.3 3.4 107 0 45 33.1 81.6 73.9 81.6 54.8 2.6 110.7 3.8 167.8 3.8h21.6c57.1 0 113-1.2 167.9-3.8 40.9 0 74-36.6 74-81.6 2.4-35.7 3.5-71.4 3.4-107.1.1-35.7-1-71.3-3.4-107.1 0-45-33.1-81.1-74-81.1C379.2 64.8 322.7 64 265 64z\"></path><path d=\"M207 353.8V157.4l145 98.2-145 98.2z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-play\"><path d=\"M128 96v320l256-160L128 96z\"></path></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-full\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /><path d=\"M-770.219,-115.563 L-770.219,-271.777 L770.219,-271.777 L770.219,-115.563 L-770.219,-115.563 Z \" /><path d=\"M-770.219,303.503 L-770.219,147.288 L770.219,147.288 L770.219,303.503 L-770.219,303.503 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-center\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-552.286,-107.697 L-552.286,-263.911 L552.286,-263.911 L552.286,-107.697 L-552.286,-107.697 Z \" /><path d=\"M-467.355,319.234 L-467.355,163.02 L466.34,163.02 L466.34,319.234 L-467.355,319.234 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-left\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /><path d=\"M-770.219,-115.563 L-770.219,-271.777 L482.839,-271.777 L482.839,-115.563 L-770.219,-115.563 Z \" /><path d=\"M-770.219,303.503 L-770.219,147.288 L122.787,147.288 L122.787,303.503 L-770.219,303.503 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-align-right\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-770.727,738.299 L-770.727,582.085 L769.712,582.085 L769.712,738.299 L-770.727,738.299 Z \" /><path d=\"M-770.727,-534.628 L-770.727,-690.842 L769.712,-690.842 L769.712,-534.628 L-770.727,-534.628 Z \" /><path d=\"M-483.346,-118.081 L-483.346,-274.295 L769.712,-274.295 L769.712,-118.081 L-483.346,-118.081 Z \" /><path d=\"M-123.871,303.503 L-123.871,147.288 L769.136,147.288 L769.136,303.503 L-123.871,303.503 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-indent\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-829.04,-514.33 L-829.04,-670.545 L808.959,-670.545 L808.959,-514.33 L-829.04,-514.33 Z \" /><path d=\"M-829.04,670.545 L-829.04,514.33 L808.959,514.33 L808.959,670.545 L-829.04,670.545 Z \" /><path d=\"M-254.279,-110.244 L-254.279,-266.458 L808.959,-266.458 L808.959,-110.244 L-254.279,-110.244 Z \" /><path d=\"M-254.279,266.458 L-254.279,110.244 L808.959,110.244 L808.959,266.458 L-254.279,266.458 Z \" /><path d=\"M-829.04,-195.117 L-490.958,-1.03508e-14 L-829.04,195.117 L-829.04,-195.117 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-outdent\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-829.04,-514.33 L-829.04,-670.545 L808.959,-670.545 L808.959,-514.33 L-829.04,-514.33 Z \" /><path d=\"M-829.04,670.545 L-829.04,514.33 L808.959,514.33 L808.959,670.545 L-829.04,670.545 Z \" /><path d=\"M-829.04,-110.244 L-829.04,-266.458 L234.198,-266.458 L234.198,-110.244 L-829.04,-110.244 Z \" /><path d=\"M-829.04,266.458 L-829.04,110.244 L234.198,110.244 L234.198,266.458 L-829.04,266.458 Z \" /><path d=\"M808.959,-195.117 L470.877,-1.03508e-14 L808.959,195.117 L808.959,-195.117 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-table\"><rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" /><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M-660.783,660.783 L660.783,660.783 L660.783,-660.783 L-660.783,-660.783 L-660.783,660.783 Z \" fill=\"none\" stroke-width=\"75.82\" stroke=\"currentColor\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" /><path d=\"M-37.9645,698.933 L37.9645,698.933 L37.9645,-698.569 L-37.9645,-698.569 L-37.9645,698.933 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" stroke-width=\"0.25\" stroke=\"currentColor\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" /><path d=\"M-698.933,-37.7825 L-698.933,38.1465 L698.569,38.1465 L698.569,-37.7825 L-698.933,-37.7825 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" stroke-width=\"0.25\" stroke=\"currentColor\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" /></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-happy\"><path d=\"M256 48C140.563 48 48 141.6 48 256s92.563 208 208 208 208-93.6 208-208S370.401 48 256 48zm0 374.4c-91.518 0-166.404-74.883-166.404-166.4 0-91.518 74.887-166.4 166.404-166.4S422.404 164.482 422.404 256 347.518 422.4 256 422.4zm72.8-187.2c17.683 0 31.201-13.518 31.201-31.2s-13.519-31.2-31.201-31.2c-17.682 0-31.2 13.518-31.2 31.2s13.518 31.2 31.2 31.2zm-145.6 0c17.682 0 31.2-13.518 31.2-31.2s-13.519-31.2-31.2-31.2c-17.683 0-31.201 13.518-31.201 31.2s13.519 31.2 31.201 31.2zM256 370.4c48.883 0 89.436-30.164 106.081-72.801H149.919C166.564 340.236 207.117 370.4 256 370.4z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-create\"><path d=\"M64 368v80h80l235.727-235.729-79.999-79.998L64 368zm377.602-217.602c8.531-8.531 8.531-21.334 0-29.865l-50.135-50.135c-8.531-8.531-21.334-8.531-29.865 0l-39.468 39.469 79.999 79.998 39.469-39.467z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-minus-empty\"><path d=\"M384 265H128v-17h256v17z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-eye\"><path d=\"M256 128c-81.9 0-145.7 48.8-224 128 67.4 67.7 124 128 224 128 99.9 0 173.4-76.4 224-126.6C428.2 198.6 354.8 128 256 128zm0 219.3c-49.4 0-89.6-41-89.6-91.3 0-50.4 40.2-91.3 89.6-91.3s89.6 41 89.6 91.3c0 50.4-40.2 91.3-89.6 91.3z\"></path><path d=\"M256 224c0-7.9 2.9-15.1 7.6-20.7-2.5-.4-5-.6-7.6-.6-28.8 0-52.3 23.9-52.3 53.3s23.5 53.3 52.3 53.3 52.3-23.9 52.3-53.3c0-2.3-.2-4.6-.4-6.9-5.5 4.3-12.3 6.9-19.8 6.9-17.8 0-32.1-14.3-32.1-32z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-reply\"><path d=\"M448 400s-36.8-208-224-208v-80L64 256l160 134.4v-92.3c101.6 0 171 8.9 224 101.9z\"></path></symbol>\n            \n            <symbol viewBox=\"0 0 512 512\" id=\"ion-wrench\"><path d=\"M461.9 114.9l-56.5 56.7-55.1-10-9.9-55.1 56.5-56.7c-12.7-12.7-30.8-18.5-44.2-17.8-13.5.7-42.3 8.3-64.6 32-21.6 22.8-44.3 65.3-24.2 112.5 2.4 5.7 5.1 13.2-2.9 21.2-8.1 8-215 202.8-215 202.8-19.4 16.7-18 47.6-.1 65.6 18.2 17.9 48.9 19 65.6-.3 0 0 193.2-205.8 202.7-215.1 8.5-8.3 16.1-5.5 21.2-2.9 35.6 18.4 86.3 2.4 112.6-23.9 26.3-26.3 31.1-51.7 31.9-64.7.8-12.9-3.7-30-18-44.3zM91.3 443.2c-6.3 6.2-16.5 6.2-22.7 0-6.2-6.3-6.2-16.5 0-22.7 6.3-6.2 16.5-6.2 22.7 0 6.2 6.3 6.2 16.5 0 22.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-more\"><path d=\"M113.7 304C86.2 304 64 282.6 64 256c0-26.5 22.2-48 49.7-48 27.6 0 49.8 21.5 49.8 48 0 26.6-22.2 48-49.8 48zM256 304c-27.5 0-49.8-21.4-49.8-48 0-26.5 22.3-48 49.8-48 27.5 0 49.7 21.5 49.7 48 0 26.6-22.2 48-49.7 48zM398.2 304c-27.5 0-49.8-21.4-49.8-48 0-26.5 22.2-48 49.8-48 27.5 0 49.8 21.5 49.8 48 0 26.6-22.2 48-49.8 48z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-code-working\"><circle cx=\"184.166\" cy=\"256.166\" r=\"24\"></circle><circle cx=\"256.166\" cy=\"256.166\" r=\"24\"></circle><circle cx=\"328.166\" cy=\"256.166\" r=\"24\"></circle><g><path d=\"M168 392a23.929 23.929 0 0 1-16.971-7.029l-112-112c-9.373-9.373-9.373-24.569 0-33.941l112-112c9.373-9.372 24.568-9.372 33.941 0 9.371 9.372 9.371 24.568 0 33.941L89.941 256l95.029 95.029c9.371 9.372 9.371 24.568 0 33.941A23.925 23.925 0 0 1 168 392zM344 392a23.929 23.929 0 0 0 16.971-7.029l112-112c9.373-9.373 9.373-24.569 0-33.941l-112-112c-9.373-9.372-24.568-9.372-33.941 0-9.371 9.372-9.371 24.568 0 33.941L422.059 256l-95.029 95.029c-9.371 9.372-9.371 24.568 0 33.941A23.925 23.925 0 0 0 344 392z\"></path></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-gear\"><path d=\"M416.349 256.046c-.001-21.013 13.143-38.948 31.651-46.062a196.302 196.302 0 0 0-23.664-57.139 49.423 49.423 0 0 1-20.082 4.254c-12.621 0-25.238-4.811-34.871-14.442-14.863-14.863-18.248-36.846-10.18-54.97A196.274 196.274 0 0 0 302.074 64C294.971 82.529 277.027 95.69 256 95.69c-21.025 0-38.969-13.161-46.073-31.69a196.243 196.243 0 0 0-57.128 23.688c8.068 18.122 4.683 40.104-10.181 54.97-9.631 9.631-22.25 14.443-34.871 14.443a49.429 49.429 0 0 1-20.083-4.255A196.273 196.273 0 0 0 64 209.984c18.509 7.112 31.652 25.049 31.652 46.062 0 21.008-13.132 38.936-31.63 46.054a196.318 196.318 0 0 0 23.692 57.128 49.428 49.428 0 0 1 20.032-4.232c12.622 0 25.239 4.812 34.871 14.443 14.841 14.841 18.239 36.781 10.215 54.889a196.257 196.257 0 0 0 57.13 23.673c7.128-18.479 25.046-31.596 46.038-31.596 20.992 0 38.91 13.115 46.037 31.596a196.234 196.234 0 0 0 57.132-23.675c-8.023-18.106-4.626-40.046 10.216-54.887 9.629-9.632 22.248-14.444 34.868-14.444 6.836 0 13.67 1.411 20.033 4.233a196.318 196.318 0 0 0 23.692-57.128c-18.498-7.119-31.629-25.048-31.629-46.054zM256.9 335.9c-44.3 0-80-35.9-80-80 0-44.101 35.7-80 80-80 44.299 0 80 35.899 80 80 0 44.1-35.701 80-80 80z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-arrow-expand\"><path d=\"M274 209.7l63.9-63.8L288 96h128v128l-49.9-49.9-63.8 63.9zM274 302.3l63.9 63.8L288 416h128V288l-49.9 49.9-63.8-63.9zM238 302.3l-63.9 63.8L224 416H96V288l49.9 49.9 63.8-63.9zM238 209.7l-63.9-63.8L224 96H96v128l49.9-49.9 63.8 63.9z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-expand\"><path d=\"M396.795 396.8H320V448h128V320h-51.205zM396.8 115.205V192H448V64H320v51.205zM115.205 115.2H192V64H64v128h51.205zM115.2 396.795V320H64v128h128v-51.205z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-arrow-move\"><path d=\"M480 256l-96-96v76H276V128h76l-96-96-96 96h76v108H128v-76l-96 96 96 96v-76h108v108h-76l96 96 96-96h-76.2l-.4-108.5 108.6.3V352z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-drag\"><path d=\"M0 144h512v32H0zM0 240h512v32H0zM0 336h512v32H0z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-link\"><path d=\"M74.6 256c0-38.3 31.1-69.4 69.4-69.4h88V144h-88c-61.8 0-112 50.2-112 112s50.2 112 112 112h88v-42.6h-88c-38.3 0-69.4-31.1-69.4-69.4zm85.4 22h192v-44H160v44zm208-134h-88v42.6h88c38.3 0 69.4 31.1 69.4 69.4s-31.1 69.4-69.4 69.4h-88V368h88c61.8 0 112-50.2 112-112s-50.2-112-112-112z\"/></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-contrast\"><path d=\"M256 32C132.3 32 32 132.3 32 256s100.3 224 224 224 224-100.3 224-224S379.7 32 256 32zm135.8 359.8C355.5 428 307 448 256 448V64c51 0 99.5 20 135.8 56.2C428 156.5 448 204.7 448 256c0 51.3-20 99.5-56.2 135.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-plus-empty\"><path d=\"M384 265H264v119h-17V265H128v-17h119V128h17v120h120v17z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-up\"><path d=\"M349.7 189.8c-3.1 3.1-8 3-11.3 0L264 123.4V408c0 4.4-3.6 8-8 8s-8-3.6-8-8V123.4l-74.4 66.3c-3.4 2.9-8.1 3.2-11.2.1-3.1-3.1-3.3-8.5-.1-11.4 0 0 87-79.2 88-80s2.8-2.4 5.7-2.4 4.9 1.6 5.7 2.4 88 80 88 80c1.5 1.5 2.3 3.6 2.3 5.7s-.8 4.1-2.3 5.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-down\"><path d=\"M349.7 322.2c-3.1-3.1-8-3-11.3 0L264 388.6V104c0-4.4-3.6-8-8-8s-8 3.6-8 8v284.6l-74.4-66.3c-3.4-2.9-8.1-3.2-11.2-.1-3.1 3.1-3.3 8.5-.1 11.4 0 0 87 79.2 88 80s2.8 2.4 5.7 2.4 4.9-1.6 5.7-2.4 88-80 88-80c1.5-1.5 2.3-3.6 2.3-5.7s-.8-4.1-2.3-5.7z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-left\"><path d=\"M189.8 349.7c3.1-3.1 3-8 0-11.3L123.4 264H408c4.4 0 8-3.6 8-8s-3.6-8-8-8H123.4l66.3-74.4c2.9-3.4 3.2-8.1.1-11.2-3.1-3.1-8.5-3.3-11.4-.1 0 0-79.2 87-80 88S96 253.1 96 256s1.6 4.9 2.4 5.7 80 88 80 88c1.5 1.5 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-arrow-thin-right\"><path d=\"M322.2 349.7c-3.1-3.1-3-8 0-11.3l66.4-74.4H104c-4.4 0-8-3.6-8-8s3.6-8 8-8h284.6l-66.3-74.4c-2.9-3.4-3.2-8.1-.1-11.2 3.1-3.1 8.5-3.3 11.4-.1 0 0 79.2 87 80 88s2.4 2.8 2.4 5.7-1.6 4.9-2.4 5.7-80 88-80 88c-1.5 1.5-3.6 2.3-5.7 2.3s-4.1-.8-5.7-2.3z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-close-empty\"><path d=\"M340.2 160l-84.4 84.3-84-83.9-11.8 11.8 84 83.8-84 83.9 11.8 11.7 84-83.8 84.4 84.2 11.8-11.7-84.4-84.3 84.4-84.2z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-more-vertical\"><path d=\"M296 136c0-22.002-17.998-40-40-40s-40 17.998-40 40 17.998 40 40 40 40-17.998 40-40zm0 240c0-22.002-17.998-40-40-40s-40 17.998-40 40 17.998 40 40 40 40-17.998 40-40zm0-120c0-22.002-17.998-40-40-40s-40 17.998-40 40 17.998 40 40 40 40-17.998 40-40z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-quote\"><path d=\"M192 64c-40.646 0-72.483 11.229-94.627 33.373C75.229 119.517 64 151.354 64 192v256h160V192h-96c0-23.056 4.922-39.666 14.627-49.373C152.334 132.922 168.944 128 192 128M416 64c-40.646 0-72.483 11.229-94.627 33.373C299.229 119.517 288 151.354 288 192v256h160V192h-96c0-23.056 4.922-39.666 14.627-49.373C376.334 132.922 392.944 128 416 128\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-code\"><path d=\"M168 392a23.929 23.929 0 0 1-16.971-7.029l-112-112c-9.373-9.373-9.373-24.569 0-33.941l112-112c9.373-9.372 24.568-9.372 33.941 0 9.371 9.372 9.371 24.568 0 33.941L89.941 256l95.029 95.029c9.371 9.373 9.371 24.568 0 33.941A23.925 23.925 0 0 1 168 392zM344 392a23.929 23.929 0 0 0 16.971-7.029l112-112c9.373-9.373 9.373-24.569 0-33.941l-112-112c-9.373-9.372-24.568-9.372-33.941 0-9.371 9.372-9.371 24.568 0 33.941L422.059 256l-95.029 95.029c-9.371 9.373-9.371 24.568 0 33.941A23.925 23.925 0 0 0 344 392z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-camera\"><path d=\"M430.4 147h-67.5l-40.4-40.8s-.2-.2-.3-.2l-.2-.2c-6-6-14.1-9.8-23.3-9.8h-84c-9.8 0-18.5 4.2-24.6 10.9v.1l-39.5 40h-69C63 147 48 161.6 48 180.2v202.1c0 18.6 15 33.7 33.6 33.7h348.8c18.5 0 33.6-15.1 33.6-33.7V180.2c0-18.6-15.1-33.2-33.6-33.2zM256 365.5c-50.9 0-92.4-41.6-92.4-92.6 0-51.1 41.5-92.6 92.4-92.6 51 0 92.4 41.5 92.4 92.6 0 51-41.4 92.6-92.4 92.6zm168.1-165c-7.7 0-14-6.3-14-14.1s6.3-14.1 14-14.1 14 6.3 14 14.1-6.3 14.1-14 14.1z\"></path><path d=\"M256 202.9c-38.6 0-69.8 31.3-69.8 70 0 38.6 31.2 70 69.8 70 38.5 0 69.8-31.3 69.8-70s-31.3-70-69.8-70z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-move\"><path d=\"M475.9 246.2l-79.4-79.4c-5.4-5.4-14.2-5.4-19.6 0l-.2.2c-5.4 5.4-5.4 14.2 0 19.6l54.9 54.9-161.8.5.5-161.8 54.9 54.9c5.4 5.4 14.2 5.4 19.6 0l.2-.2c5.4-5.4 5.4-14.2 0-19.6l-79.4-79.4c-5.4-5.4-14.2-5.4-19.6 0l-79.4 79.4c-5.4 5.4-5.4 14.2 0 19.6l.2.2c5.4 5.4 14.2 5.4 19.6 0l54.9-54.9.5 161.8-161.8-.5 54.9-54.9c5.4-5.4 5.4-14.2 0-19.6l-.2-.2c-5.4-5.4-14.2-5.4-19.6 0l-79.4 79.4c-5.4 5.4-5.4 14.2 0 19.6l79.4 79.4c5.4 5.4 14.2 5.4 19.6 0l.2-.2c5.4-5.4 5.4-14.2 0-19.6L80 270.5l161.8-.5-.5 161.8-54.9-54.9c-5.4-5.4-14.2-5.4-19.6 0l-.2.2c-5.4 5.4-5.4 14.2 0 19.6l79.4 79.4c5.4 5.4 14.2 5.4 19.6 0l79.4-79.4c5.4-5.4 5.4-14.2 0-19.6l-.2-.2c-5.4-5.4-14.2-5.4-19.6 0l-54.9 54.9-.5-161.8 161.8.5-54.9 54.9c-5.4 5.4-5.4 14.2 0 19.6l.2.2c5.4 5.4 14.2 5.4 19.6 0l79.4-79.4c5.5-5.4 5.5-14.2 0-19.6z\"/></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-ok\">\n                <rect x=\"0\" y=\"0\" width=\"2048.00\" height=\"2048.00\" fill=\"none\" />\n                <g transform=\"matrix(1,0,0,1,1024.0,1024.0)\">\n                <path d=\"M330.323,493.628 L330.323,398.406 L-330.323,398.406 L-330.323,493.628 L330.323,493.628 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                <path d=\"M230.718,468.568 L328.59,468.568 L328.59,-599.718 L230.718,-599.718 L230.718,468.568 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                <path d=\"M-300.714,376.053 L-373.748,449.088 L-68.5805,754.255 L4.45387,681.221 L-300.714,376.053 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                <path d=\"M-9.9476e-14,216.241 L-73.0344,143.207 L-378.202,448.375 L-305.168,521.409 L-9.9476e-14,216.241 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" />\n                </g>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-grid\"><path d=\"M160 153.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM288 153.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM416 153.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5z\"></path><g><path d=\"M160 281.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM288 281.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM416 281.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5z\"></path></g><g><path d=\"M160 409.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM288 409.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5zM416 409.3c0 3.7-3 6.7-6.7 6.7h-50.5c-3.7 0-6.7-3-6.7-6.7v-50.5c0-3.7 3-6.7 6.7-6.7h50.5c3.7 0 6.7 3 6.7 6.7v50.5z\"></path></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-gear-b\"><path d=\"M448 294.4v-76.8h-42.8c-3.4-14.4-8.9-28-16.1-40.5l29.8-29.7-54.3-54.3-29.1 29.1c-12.6-7.7-26.4-13.5-41.1-17.3V64h-76.8v40.9c-14.7 3.8-28.5 9.7-41.1 17.3l-29.1-29.1-54.3 54.3 29.8 29.7c-7.2 12.5-12.6 26.1-16.1 40.5H64v76.8h44.1c3.8 13.7 9.5 26.6 16.7 38.6l-31.7 31.7 54.3 54.3 32.3-32.3c11.7 6.8 24.5 11.9 37.9 15.4v46h76.8v-46c13.5-3.5 26.2-8.6 37.9-15.4l32.3 32.3 54.3-54.3-31.6-31.7c7.2-11.9 12.9-24.8 16.7-38.6h44zm-192 15.4c-29.7 0-53.7-24.1-53.7-53.8s24-53.8 53.7-53.8 53.8 24.1 53.8 53.8-24.1 53.8-53.8 53.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-grid-view-outline\"><path d=\"M448 192v-16H336V64h-16v112H192V64h-16v112H64v16h112v128H64v16h112v112h16V336h128v112h16V336h112v-16H336V192h112zM320 320H192V192h128v128z\"></path></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-increase\"><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M852.574,595.004 L852.574,507.837 L-852.574,507.837 L-852.574,595.004 L852.574,595.004 Z \" /><path d=\"M852.574,224.232 L852.574,137.066 L-852.574,137.066 L-852.574,224.232 L852.574,224.232 Z \" /><path d=\"M852.574,-134.971 L852.574,-222.138 L-852.574,-222.138 L-852.574,-134.971 L852.574,-134.971 Z \" /><path d=\"M852.574,-505.743 L852.574,-592.909 L-852.574,-592.909 L-852.574,-505.743 L852.574,-505.743 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-decrease\"><g transform=\"matrix(1,0,0,1,1024.0,1024.0)\"><path d=\"M509.832,595.004 L509.832,507.837 L-509.832,507.837 L-509.832,595.004 L509.832,595.004 Z \" /><path d=\"M509.832,224.232 L509.832,137.066 L-509.832,137.066 L-509.832,224.232 L509.832,224.232 Z \" /><path d=\"M509.832,-136.947 L509.832,-224.113 L-509.832,-224.113 L-509.832,-136.947 L509.832,-136.947 Z \" /><path d=\"M509.832,-505.743 L509.832,-592.909 L-509.832,-592.909 L-509.832,-505.743 L509.832,-505.743 Z \" /></g></symbol>\n            <symbol viewBox=\"0 0 2048.0 2048.0\" id=\"icon-strike\">\n                <g transform=\"matrix(1,0,0,1,1024.0,1024.0)\">\n                <path d=\"M298.298,-653.766 C292.151,-624.873 284.005,-605.663 273.862,-596.135 C263.719,-586.607 250.656,-581.842 234.673,-581.842 C220.535,-581.842 196.253,-589.526 161.828,-604.895 C87.4454,-637.475 17.0588,-653.766 -49.3321,-653.766 C-155.68,-653.766 -243.28,-621.339 -312.129,-556.485 C-380.979,-491.631 -415.404,-414.328 -415.404,-324.578 C-415.404,-272.94 -403.724,-225.606 -380.364,-182.575 C-357.005,-139.544 -322.733,-100.201 -277.551,-64.5467 C-232.368,-28.8923 -156.295,18.903 -49.3321,78.8392 C57.631,138.775 123.1,177.964 147.074,196.406 C182.729,223.455 209.008,252.654 225.913,284.005 C242.819,315.357 251.271,346.401 251.271,377.137 C251.271,432.463 228.987,480.412 184.419,520.984 C139.851,561.556 79.1465,581.842 2.30524,581.842 C-64.0856,581.842 -125.098,567.089 -180.731,537.582 C-236.364,508.075 -277.704,471.037 -304.753,426.469 C-331.801,381.901 -353.316,314.742 -369.299,224.991 L-403.417,224.991 L-403.417,653.766 L-369.299,653.766 C-364.996,624.873 -358.388,605.817 -349.474,596.596 C-340.561,587.375 -328.42,582.764 -313.051,582.764 C-297.068,582.764 -259.109,592.446 -199.173,611.81 C-139.236,631.174 -99.74,642.393 -80.6834,645.467 C-48.7174,651 -14.5998,653.766 21.6692,653.766 C137.239,653.766 231.753,619.495 305.214,550.952 C378.674,482.41 415.404,400.804 415.404,306.136 C415.404,256.343 403.878,208.701 380.826,163.211 C357.773,117.721 324.885,78.2244 282.161,44.7216 C239.438,11.2188 159.676,-36.8838 42.8774,-99.5863 C-100.355,-176.428 -191.027,-237.901 -229.141,-284.005 C-255.574,-315.357 -268.791,-350.089 -268.791,-388.202 C-268.791,-437.995 -247.89,-482.41 -206.088,-521.445 C-164.287,-560.48 -111.42,-579.998 -47.4879,-579.998 C9.06727,-579.998 63.7783,-565.552 116.645,-536.66 C169.512,-507.767 210.238,-468.732 238.823,-419.554 C267.408,-370.375 287.233,-304.292 298.298,-221.303 L332.415,-221.303 L332.415,-653.766 L298.298,-653.766 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" /><path d=\"M-530.954,-41.4477 L-530.954,41.4477 L530.954,41.4477 L530.954,-41.4477 L-530.954,-41.4477 Z \" fill=\"currentColor\" fill-opacity=\"1.00\" /></g></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-undo\"><path d=\"M447.9 368.2c0-16.8 3.6-83.1-48.7-135.7-35.2-35.4-80.3-53.4-143.3-56.2V96L64 224l192 128v-79.8c40 1.1 62.4 9.1 86.7 20 30.9 13.8 55.3 44 75.8 76.6l19.2 31.2H448c0-10.1-.1-22.9-.1-31.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-redo\"><path d=\"M64 400h10.3l19.2-31.2c20.5-32.7 44.9-62.8 75.8-76.6 24.4-10.9 46.7-18.9 86.7-20V352l192-128L256 96v80.3c-63 2.8-108.1 20.7-143.3 56.2C60.4 285.2 64 351.5 64 368.2c.1 8.9 0 21.7 0 31.8z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-arrow-dropdown\"><path d=\"M128 192l128 128 128-128z\"></path></symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-social-twitter\"><path d=\"M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6-18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6.8 15 2.5 22.1-80.5-4-151.9-42.6-199.6-101.3-8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7-16-.4-31-4.8-44-12.1v1.2c0 47 33.4 86.1 77.7 95-8.1 2.2-16.7 3.4-25.5 3.4-6.2 0-12.3-.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3-33.1 26-74.9 41.5-120.3 41.5-7.8 0-15.5-.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-.1-8.4-.3-12.5C462.6 146 479 129 492 109.5z\"></path></symbol>\n            <symbol viewBox=\"0 0 24 24\" id=\"icon-zoom-in\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <circle cx=\"10\" cy=\"10\" r=\"7\"></circle>\n                <line x1=\"7\" y1=\"10\" x2=\"13\" y2=\"10\"></line>\n                <line x1=\"10\" y1=\"7\" x2=\"10\" y2=\"13\"></line>\n                <line x1=\"21\" y1=\"21\" x2=\"15\" y2=\"15\"></line>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-android-contract\"><path d=\"M64 371.2h76.795V448H192V320H64v51.2zm76.795-230.4H64V192h128V64h-51.205v76.8zM320 448h51.2v-76.8H448V320H320v128zm51.2-307.2V64H320v128h128v-51.2h-76.8z\"></path></symbol>\n            \n            <symbol viewBox=\"0 0 24 24\" id=\"icon-lock-off\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n                <line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" />\n                <path d=\"M19 19a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6a2 2 0 0 1 2 -2h4m4 0h2a2 2 0 0 1 2 2v2\" />\n                <circle cx=\"12\" cy=\"16\" r=\"1\" />\n                <path d=\"M8 11v-3m.712 -3.278a4 4 0 0 1 7.288 2.278v4\" />\n            </symbol>\n            <symbol viewBox=\"0 0 24 24\" id=\"icon-lock\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n                <rect x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\" />\n                <circle cx=\"12\" cy=\"16\" r=\"1\" />\n                <path d=\"M8 11v-4a4 4 0 0 1 8 0v4\" />\n            </symbol>\n            <symbol viewBox=\"0 0 24 24\" id=\"icon-code\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\"/>\n                <polyline points=\"7 8 3 12 7 16\" />\n                <polyline points=\"17 8 21 12 17 16\" />\n                <line x1=\"14\" y1=\"4\" x2=\"10\" y2=\"20\" />\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-ios-cloud-upload-outline\">\n                <path d=\"M193.3 260.4l-11.6-11.6 74.5-74.3 74.5 74.3-11.7 11.6-54.6-54.6v241.8h-16.5V205.8z\"/>\n                <path d=\"M399.3 183.6c0-1.2.2-2.4.2-3.6 0-64.3-52.8-116.4-116.8-116.4-46.1 0-85.8 27.1-104.4 66.3-8.1-4.1-17.1-6.4-26.8-6.4-29.6 0-54.1 23.6-58.9 52C57.4 187.6 32 222.2 32 261.8c0 49.7 40.1 90.2 89.6 90.2H213v-16h-90.6c-40.9 0-74.2-33.5-74.2-74.6 0-31.8 20.2-61.2 50.2-71.6l8.4-2.9 1.5-8.8c3.6-21.6 22.1-39.3 43.9-39.3 6.9 0 13.7 1.6 19.9 4.8l13.5 6.8 6.5-13.7c16.6-34.9 52.1-57.4 90.4-57.4 55.3 0 100.9 43.3 100.9 98.9 0 13.3-.2 20.3-.2 20.3l15.2.1c36.6.5 65.6 33.4 65.6 70.3 0 36.8-29.8 66.9-66.5 67.1H297v16h101c45 0 82-37.3 82-82.8s-35.5-85.5-80.7-85.6z\"/>\n            </symbol>\n            <symbol viewBox=\"0 0 512 512\" id=\"ion-volume-medium\">\n                <path d=\"M270 407.7V104.4L175.3 192H71v128h104.3zm56.3-52.1c20.5-27.8 32.8-62.3 32.8-99.6 0-37.4-12.3-71.8-32.8-99.6l-20.4 15.3c17.4 23.6 27.8 52.7 27.8 84.3 0 31.6-10.4 60.7-27.8 84.3l20.4 15.3zm66.5 46c30-40.7 48-91 48-145.6s-18-104.9-48-145.6l-20.4 15.3c26.9 36.4 43 81.4 43 130.3 0 48.9-16.1 93.8-43 130.3l20.4 15.3z\"/>\n            </symbol>\n            <symbol id=\"icon-folder2\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M11 19h-6a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2.5\"></path>\n                <path d=\"M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0\"></path>\n                <path d=\"M20.2 20.2l1.8 1.8\"></path>\n            </symbol>\n            <symbol id=\"icon-reload\" viewBox=\"0 0 24 24\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"></path>\n                <path d=\"M19.933 13.041a8 8 0 1 1 -9.925 -8.788c3.899 -1.002 7.935 1.007 9.425 4.747\"></path>\n                <path d=\"M20 4v5h-5\"></path>\n            </symbol>\n            </defs>\n        </svg>\n\n\n        <div class=\"is-locked-indicator\">\n            <svg class=\"is-icon-flex\"><use xlink:href=\"#icon-lock\"></use></svg>\n        </div>\n        ");
  builder.contentStuff.insertAdjacentHTML('afterbegin', html);
  var css = "\n\n\n        /* General */\n\n        body {\n            overflow-x: hidden !important;\n        }\n\n        svg {\n            overflow: hidden;\n            vertical-align: middle;\n            pointer-events: none;\n        }\n        [contenteditable] svg {\n            pointer-events: initial;\n        }\n        .is-container > div > div svg {\n            pointer-events: initial;\n        }\n\n        .is-icon-flex {\n            width: 16px;\n            height: 16px;\n        }\n\n        a:focus,\n        button:focus {\n            outline:none; \n        }\n\n        .transition1 { \n            transition: all ease 0.1s; \n        }\n\n        /* Editable Area */\n\n        .is-builder {\n            transition: all ease 0.3s;\n            transform-origin: top;\n        }\n        .is-builder > div > div:focus {\n            outline: none;\n        }\n        .is-builder .is-subblock:focus {\n            outline: none;\n        }\n        .is-builder > div {\n            position: relative;\n            transition: none;\n            margin-left: 0;\n            margin-right: 0;\n            width: auto;\n        }\n        .is-builder[gridoutline] > div > div {\n            outline: 1px solid rgba(132, 132, 132, 0.27);\n            outline-offset: 1px;\n        }\n        .is-builder > div > div.cell-active:not([data-protected]) {\n            outline: 1px solid #00da89;\n        }\n        .is-builder .row-active:not([data-protected]) {\n            outline: 1px solid #00da89;\n            z-index: 1;\n        }\n        .is-builder .row-active:not([data-protected]).row-outline {\n            outline: 1px solid rgba(132, 132, 132, 0.2);\n        }\n        .is-builder .row-active:not([data-protected]):not(.row-outline) > div.cell-active {\n            outline: none;\n        }\n\n        .is-builder table.default td {\n            border: transparent 1px dashed;\n        }\n        .is-builder .cell-active .elm-active:not(button) {\n            background: rgba(200, 200, 201, 0.11);\n        }\n        .is-builder .cell-active table.elm-active {\n            background-color: transparent;\n        }\n        .is-builder .cell-active table.default td {\n            border: #cccccc 1px dashed;\n        }\n        .is-builder .cell-active hr {\n            cursor: pointer;\n        }\n        .is-builder .cell-active[data-html] {\n            background-color: rgba(200, 200, 201, 0.11);\n        }\n        .is-builder .cell-active .icon-active {\n            background-color: rgba(200, 200, 201, 0.4);\n        }\n        .is-builder .elm-inspected {\n            animation-name: elm-inspected-anim;\n            animation-duration: 0.6s;\n            outline: 1px solid #ffb84a !important;\n        }\n        .is-builder .elm-inspected .elm-active {\n            background: none;\n        }\n        @keyframes elm-inspected-anim {\n            0% {\n                transform: scale(1);\n            }\n            50% {\n                transform: scale(0.97);\n            }\n            100% {\n                transform: scale(1);\n            }\n        }\n\n        /*\n        @media (min-width: 640px) {\n            .is-builder > div {\n                display:flex\n            }\n        }*/\n\n        /* sortable */\n        .sortable-drag {\n            background: transparent;\n            outline:none !important;\n        }\n        .sortable-drag * {\n            opacity:0;\n        }\n        \n        .sortable-ghost {\n            background: rgba(0, 0, 0 , 0.03);\n            width: 100%;\n            outline: none !important;\n        }\n        .sortable-ghost * {\n            outline: none !important;\n        }\n        .sortable-ghost .is-row-tool {\n            display:none !important;\n        }\n        \n        .sortable-drag::before {\n            content: ' ';\n            width: 100%;\n            height: 100%;\n            position: absolute;\n            top: 0; left:0;\n            background: rgba(0, 0, 0 , 0.03);\n            transform-origin: top left;\n        }\n\n        /* Canvas Mode */\n        .box-canvas > .sortable-ghost {\n            background: transparent;\n            outline: rgba(140, 140, 140, 0.5) 4px dashed !important;\n            outline-offset: -15px;\n            height:100% !important;\n            transition: none !important;\n            z-index:1;\n        }\n\n        /* Moveable (Image resizer) */\n        .moveable-control {\n            border: none !important; \n            width: 7px !important; \n            height: 7px !important; \n            margin-top: -3px !important; \n            margin-left: -3px !important;  \n            background: #2196f3 !important;\n        }\n        .moveable-control.moveable-origin {\n            display: none !important;\n        }\n        .moveable-direction.moveable-s, .moveable-direction.moveable-n { \n            display:none !important; \n        }\n        .moveable-direction.moveable-e, .moveable-direction.moveable-w { \n            display:none !important; \n        }\n        .moveable-line { \n            display:none !important; \n        }\n\n        /* Tool */\n        .is-tool.is-video-tool,\n        .is-tool.is-audio-tool,\n        .is-tool.is-iframe-tool {\n            background: rgba(0, 0, 0, 0.15);\n            border: transparent 1px solid;\n        }\n        .is-tool.is-video-tool > div,\n        .is-tool.is-audio-tool > div,\n        .is-tool.is-iframe-tool > div,\n        .is-tool.is-video-tool > button,\n        .is-tool.is-audio-tool > button,\n        .is-tool.is-iframe-tool > button {\n            background: transparent;\n        }\n        .is-tool.is-video-tool svg,\n        .is-tool.is-audio-tool svg,\n        .is-tool.is-iframe-tool svg {\n            fill: #fff;\n        }\n\n\n        .is-tool.is-spacer-tool,\n        .is-tool.is-table-tool,\n        .is-tool.is-code-tool,\n        .is-tool.is-module-tool,\n        .is-tool#divLinkTool,\n        .is-tool#divButtonTool,\n        .is-tool.is-svg-tool { \n            border: none;\n            background: none;\n            border-radius: 3px;\n            overflow: hidden;\n        }\n\n        .is-tool.is-spacer-tool > button,\n        .is-tool.is-table-tool > button,\n        .is-tool.is-code-tool > button,\n        .is-tool.is-module-tool > button,\n        .is-tool#divLinkTool > button,\n        .is-tool#divButtonTool > button,\n        .is-tool.is-svg-tool > button { \n            width: 30px;\n            height: 30px;\n            background: rgba(240, 240, 240, 0.9);\n        }\n\n        .is-tool.is-spacer-tool > button svg,\n        .is-tool.is-table-tool > button svg,\n        .is-tool.is-code-tool > button svg,\n        .is-tool.is-module-tool > button svg,\n        .is-tool#divLinkTool > button svg,\n        .is-tool#divButtonTool > button svg,\n        .is-tool.is-svg-tool > button svg {\n            fill: #111;\n        }\n\n        .is-tool.is-table-tool:hover {\n            z-index:10001 !important\n        }\n\n\n        .dot {\n            height: 7px;\n            width: 7px;\n            border-radius: 50%;\n            display: inline-block;\n            margin: 25px 2px 0;\n            animation: jump 1.5s linear infinite;\n        }\n        @keyframes jump {\n            0%, 100% {transform: translateY(0px);}\n            20% {transform: translateY(-10px);}\n            40% {transform: translateY(0px);}\n        }\n        .dot:nth-of-type(2) {\n            animation-delay: 0.2s;\n        }\n        .dot:nth-of-type(3) {\n            animation-delay: 0.4s;\n        }\n\n        /* Lock Indicator */\n\n        .is-locked-indicator {\n            display: none;\n            width: 28px;\n            height: 28px;\n            position: absolute;\n            align-items: center;\n            justify-content: center;\n            background: rgba(243, 243, 243, 0.9);\n            border-radius: 500px;\n            pointer-events: none;\n        }\n\n        /* Tools */\n        .is-tool {\n            position: absolute;\n            top: 0;\n            left: 0;\n            display: none;\n            z-index: 10001;\n            box-sizing: border-box;\n            padding: 0;\n            outline: none;\n           \n        } \n        .is-tool:hover { \n            z-index:10003; \n        }\n        .is-tool.active { \n            display:flex; \n        }\n        .is-tool button {\n            width:100%; height: 25px;\n            background-color:transparent;\n            border: none;\n            cursor: pointer;\n            user-select: none;\n            -moz-user-select: none;\n            -khtml-user-select: none;\n            -webkit-user-select: none;\n            -o-user-select: none; \n    \n           \n            color: #000;\n            display: inline-block;\n            box-sizing:border-box;\n            margin: 0;\n            padding: 0;\n            font-family: sans-serif;\n            letter-spacing: 1px;\n            font-size: 12px;\n            font-weight: 300;\n            text-transform: uppercase;\n            text-align: center;  \n            line-height: unset;\n            position: relative;\n            border-radius: 1px;\n            transition: all ease 0.3s; \n        }\n        .is-tool button:focus {\n            outline: none !important;\n            outline-offset: 0;\n        }\n        .is-tool svg {\n            fill: #000;\n        }\n\n        /* is-element-tool */\n\n        .is-tool.is-element-tool {\n            background: rgba(243, 243, 243, 0.9);\n            border-radius: 3px;\n            overflow: hidden;\n        } \n        .is-tool.is-element-tool button {\n            width: 25px; \n            height: 25px;\n            background: transparent;\n        }\n        .is-tool.is-element-tool svg {\n            width: 14px;\n            height: 14px;\n            fill: #111;\n        }\n        .is-tool.is-element-tool .elm-more svg {\n            width: 11px;\n            height: 11px;\n        }\n        .is-tool.is-element-tool .elm-settings { display: none; }\n\n        /* is-column-tool */\n\n        .is-tool.is-column-tool {\n            flex-direction: row;\n            margin-top: 0px;\n        }\n        .is-tool.is-column-tool button {\n            width: 25px; \n            height: 25px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .is-tool.is-column-tool .cell-add {background: #0fcc52;}\n        .is-tool.is-column-tool .cell-more {background: rgba(216, 200, 6, 0.9);}\n        .is-tool.is-column-tool .cell-remove {background: rgba(255, 85, 4, 0.9);} \n        .is-tool.is-column-tool svg {\n            width: 23px;\n            height:23px;\n            fill: #fff;\n        }\n        .is-tool.is-column-tool .cell-more svg {width:14px;height:14px;}\n\n        /* is-row-tool */\n        \n        .is-tool.is-row-tool {\n            flex-direction: column;\n            width: auto;\n            left: auto;\n            right: -30px;\n            border-radius: 2px;\n            overflow: hidden;\n        }\n\n        .is-tool.is-row-tool button {\n            width: 25px; \n            height: 25px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .is-tool.is-row-tool svg {\n            fill: #fff;\n        }\n        .is-tool.is-row-tool .row-handle {\n            display: flex;\n            height: 25px;\n            justify-content: center;\n            align-items: center;\n            background: #169af7;\n            \n        }\n        .is-tool.is-row-tool .row-handle svg { \n            width: 13px; height: 13px; \n        }\n        .is-tool.is-row-tool .row-grideditor {\n            background: rgba(216, 200, 6, 0.9);\n        }\n        .is-tool.is-row-tool .row-grideditor svg {\n            width: 14px; height: 14px; margin-top: -1px;\n        }\n        .is-tool.is-row-tool .row-more {\n            background: rgba(216, 200, 6, 0.9);\n        }\n        .is-tool.is-row-tool .row-more svg {\n            width: 14px; height: 14px;\n        }\n        .is-tool.is-row-tool .row-remove {\n            background: rgba(255, 85, 4, 0.9);\n        }  \n        .is-tool.is-row-tool .row-remove svg {\n            width: 23px; height: 23px;\n        }\n        .row-outline .is-row-tool, \n        .row-active .is-row-tool {\n            display:flex;\n        }\n\n\n        .row-outline .is-rowadd-tool, \n        .row-active .is-rowadd-tool {\n            display:block;\n        }\n        .is-tool.is-row-tool .row-grideditor {\n            display:none;\n        }\n\n        /* is-rowadd-tool */\n\n        .is-rowadd-tool {\n            display: none;\n            position: absolute;\n            bottom: -1px;\n            left: -20px;\n            width: calc(100% + 40px);\n            height: 1px;\n            border: none;\n            border-bottom: 1px solid rgb(255, 183, 132);\n            z-index: 1;\n            background: transparent;\n            transition:none;\n        }\n        .is-rowadd-tool button {\n            position:absolute;\n            top: -9px;\n            left:calc(50% - 10px);\n            border:  1px solid rgb(255, 142, 62);\n            border-radius: 500px;\n            height:auto;\n        }\n        .row-outline .is-rowadd-tool, \n        .row-active .is-rowadd-tool {\n            display:block;\n        }\n\n        .row-add-initial {\n            width: 100%;\n            height: 120px;\n            font-family: sans-serif;\n            font-size: 12px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n            justify-content: center;\n            align-items: center;\n            color:#333;\n            border: 1px dashed rgba(169, 169, 169, 0.8);\n            background: rgba(255, 255, 255, 0.5);\n            cursor: pointer;\n            transition: all ease 0.3s;\n            outline: none !important;\n        }\n        .row-add-initial:hover {\n            background: rgba(248, 248, 248, 0.35);\n        }\n        .row-add-initial:focus {\n            outline:none;\n        }\n        .row-add-initial span {\n            text-transform: none;\n            display: block;\n            margin-top: 5px;\n            font-size: 13px;\n            opacity: 0.5;\n            color: #333;\n        }\n        .is-builder .row-active.row-add-initial {\n            outline:none;\n        }\n\n        /* is-col-tool */\n\n        .row-active .is-col-tool {\n            display: flex;\n        }\n        .is-builder[rowoutline] .row-active .is-col-tool {\n            display: none;\n        }\n        .is-builder[hidecolumntool] .row-active .is-col-tool {\n            display: none;\n        }\n        \n\n        .is-tool.is-col-tool {\n            flex-direction: row;\n            margin-top: 0px;\n            margin-left: -1px;\n            box-shadow: none;\n            border-radius: 2px;\n            overflow: hidden;\n        }\n        .is-tool.is-col-tool button {\n            width: 25px;\n            height: 25px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .is-tool.is-col-tool .cell-add {\n            background: #0fcc52;\n        }\n        .is-tool.is-col-tool .cell-more {\n            background: rgba(216, 200, 6, 0.9);\n        }\n        .is-tool.is-col-tool .cell-remove {\n            background: rgba(255, 85, 4, 0.9);\n        }\n        .is-tool.is-col-tool svg {\n            width: 23px;\n            height: 23px;\n            fill: #fff !important;\n        }\n        .is-tool.is-col-tool .cell-more svg {\n            width: 14px;\n            height: 14px;\n        }\n\n        \n        .is-builder[gray] .is-tool.is-col-tool {\n            background: rgba(243, 243, 243, 0.9);\n            flex-direction: row;\n            margin-top: -2px;\n        }\n        .is-builder[gray] .is-tool.is-col-tool button {\n            width: 27px;\n            height: 27px;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-add {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-more {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-remove {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-col-tool svg {\n            width: 18px;\n            height: 18px;\n            fill: #000 !important;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-more svg {\n            width: 12px;\n            height: 12px;\n        }\n\n\n        .is-builder[gridoutline] > div > div {\n            outline: 1px solid rgba(132, 132, 132, 0.27);\n            outline-offset: 1px;\n        }\n\n\n        \n\n        /* Preferences */\n\n        #_cbhtml[gray] .is-tool.is-column-tool {\n            background: rgba(243, 243, 243, 0.9);\n            flex-direction: row;\n            margin-top: -2px;\n        }\n        #_cbhtml[gray] .is-tool.is-column-tool button {\n            width: 27px;\n            height: 27px;\n        }\n        #_cbhtml[gray] .is-tool.is-column-tool .cell-add {\n            background: transparent;\n        }\n        #_cbhtml[gray] .is-tool.is-column-tool .cell-more {\n            background: transparent;\n        }\n        #_cbhtml[gray] .is-tool.is-column-tool .cell-remove {\n            background: transparent;\n        }\n        #_cbhtml[gray] .is-tool.is-column-tool svg {\n            width: 18px;\n            height: 18px;\n            fill: #000;\n        }\n        #_cbhtml[gray] .is-tool.is-column-tool .cell-more svg {\n            width: 12px;\n            height: 12px;\n        }\n\n\n\n        .is-builder[gray] .is-tool.is-row-tool {\n            background: rgba(243, 243, 243, 0.9);\n        }\n        .is-builder[gray] .is-tool.is-row-tool button {\n            width: 27px;\n            height: 27px;\n        }\n        .is-builder[gray] .is-tool.is-row-tool svg {\n            fill: #000;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-handle {\n            display: flex;\n            height: 27px;\n            justify-content: center;\n            align-items: center;\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-handle svg {\n            width: 11px;\n            height: 11px;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-grideditor {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-grideditor svg {\n            width: 13px;\n            height: 13px;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-more {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-more svg {\n            width: 12px;\n            height: 12px;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-remove {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-row-tool .row-remove svg {\n            width: 19px;\n            height: 19px;\n        }\n\n\n\n        .is-builder[gray] .is-rowadd-tool {\n            border-bottom: 1px solid rgba(222, 222, 222, 0.32);\n        }\n        .is-builder[gray] .is-rowadd-tool button {\n            border: 1px solid rgba(0, 0, 0, 0.13);\n        }\n\n\n        /* Preferences */\n\n        .is-tool.is-row-tool .row-grideditor {\n            display: none;\n        }\n        \n        .is-builder {\n            /*\n            &[grideditor] {\n                & > div > div.cell-active {\n                    outline: $ui-grideditor-cell-outline-active;\n                } \n                .row-active {\n                    outline: $ui-grideditor-row-outline-active;\n                    z-index: 1;\n                } \n                .row-active.row-outline {\n                    outline: $ui-grideditor-rowoutline-row-outline-active;\n                } \n            }\n            */\n        }\n        .is-builder[minimal] .is-tool.is-row-tool .row-grideditor {\n            display: block;\n        }\n        .is-builder[minimal] .is-tool.is-row-tool .row-more {\n            display: none;\n        }\n        .is-builder[clean] .is-tool.is-row-tool {\n            background: rgba(243, 243, 243, 0.9);\n            outline: none;\n        }\n        .is-builder[clean] .is-tool.is-row-tool .row-grideditor {\n            display: block;\n            background: transparent;\n        }\n        .is-builder[clean] .is-tool.is-row-tool .row-grideditor svg {\n            fill: #000;\n            width: 13px;\n            height: 13px;\n            margin-left: -1px;\n        }\n        .is-builder[clean] .is-tool.is-row-tool .row-more {\n            display: none;\n        }\n        .is-builder[clean] .is-tool.is-row-tool .row-handle {\n            display: none;\n        }\n        .is-builder[clean] .is-tool.is-row-tool .row-remove {\n            display: none;\n        }\n        .is-builder[clean] .row-outline {\n            outline: none;\n        }\n        .is-builder[clean] .cell-active {\n            outline: none;\n        }\n        .is-builder[clean] .row-active:not([data-protected]) {\n            outline: 1px solid rgba(132, 132, 132, 0.2);\n        }\n        .is-builder[leftrowtool] .is-tool.is-row-tool {\n            right: auto;\n            left: -40px;\n        }\n        .is-builder[rowoutline] .row-outline {\n            outline: none;\n        }\n        .is-builder[rowoutline] .cell-active {\n            outline: none !important; /* ADDED IMPORTANT */\n        }\n        .is-builder[rowoutline] .row-active:not([data-protected]) {\n            outline: 1px solid #00da89;\n        }\n        .is-builder[grayoutline] .row-outline {\n            outline: none;\n        }\n        .is-builder[grayoutline] .cell-active:not([data-protected]) {\n            outline: 1px solid rgba(132, 132, 132, 0.1);\n        }\n        .is-builder[grayoutline] .row-active:not([data-protected]) {\n            outline: 1px solid rgba(132, 132, 132, 0.2);\n        }\n        .is-builder[rowoutline][grayoutline] .row-outline {\n            outline: none;\n        }\n        .is-builder[rowoutline][grayoutline] .cell-active {\n            outline: none;\n        }\n        .is-builder[rowoutline][grayoutline] .row-active:not([data-protected]) {\n            outline: 1px solid rgba(132, 132, 132, 0.2);\n        }\n        .is-builder[hideoutline] .row-outline {\n            outline: none !important;\n        }\n        .is-builder[hideoutline] .cell-active {\n            outline: none !important;\n        }\n        .is-builder[hideoutline] .row-active {\n            outline: none !important;\n        }\n        .is-builder[hideoutline] .row-active.row-outline {\n            outline: none !important;\n        }\n        .is-builder[hidesnippetaddtool] .row-outline .is-rowadd-tool,\n        .is-builder[hidesnippetaddtool] .row-active .is-rowadd-tool {\n            display: none;\n        }\n        .is-builder[hideelementhighlight] .elm-active {\n            background-color: transparent !important; /* ADDED IMPORTANT */\n        }\n        \n        #_cbhtml[minimal] .is-tool.is-column-tool .cell-more {\n            display: none;\n        }\n        #_cbhtml[clean] .is-tool.is-column-tool {\n            display: none;\n        }\n        #_cbhtml[hidecolumntool] .is-tool.is-column-tool {\n            display: none;\n        }\n        #_cbhtml[hideelementtool] .is-tool.is-element-tool {\n            display: none !important;\n        }\n        #_cbhtml .is-element-tool .elm-settings {\n            display: none;\n        }\n        #_cbhtml[emailmode] .is-element-tool .elm-add,\n        #_cbhtml[emailmode] .is-element-tool .elm-more,\n        #_cbhtml[emailmode] .is-element-tool .elm-remove {\n            display: none !important;\n        }\n        #_cbhtml[emailmode] .is-element-tool .elm-settings {\n            display: block;\n        }\n\n\n        /* Prevent css framework overide (Materialize) */\n        .is-ui [type=\"checkbox\"]:not(:checked), .is-ui [type=\"checkbox\"]:checked {\n            position: unset !important;\n        }\n        .is-ui input[type=range] {\n            border: none;\n        }\n        .is-ui form {\n            background: unset;\n            margin: unset;\n            padding: unset;\n            border: unset;\n        }\n        .is-ui svg {\n            max-width: unset;\n        }\n        \n        /* Prevent css framework overide (Tailwind) */\n        .is-ui svg {\n            display: initial !important;\n        }\n        .is-section-tool svg,\n        .is-row-tool svg,\n        .is-col-tool svg {\n            display: initial !important;\n        }\n        \n        /* Make slider block resizable */\n        .is-builder > div > div[data-module=slider-builder].cell-active {\n            /*padding: 0 2px 4px !important;*/\n            z-index: 1 !important;\n        }\n                \n        div[data-html] {\n            min-height: 70px;\n        }\n        \n        [data-module=\"slider-builder\"] *,\n        [data-module=\"text-builder\"] * {\n            outline: none !important;\n        }\n\n        /* Make slider block resizable */\n        .padding-0[data-module=\"slider-builder\"],\n        .padding-0[data-module=\"text-builder\"] {\n            padding: 0 2px 4px !important;\n        }\n\n\n        * {\n            scrollbar-width: thin;\n            scrollbar-color: rgba(0, 0, 0, 0.2) auto;\n        }\n        *::-webkit-scrollbar {\n            width: 12px;\n        }\n        *::-webkit-scrollbar-track {\n            background: rgba(200, 200, 200, 0.2);\n        }\n        *::-webkit-scrollbar-thumb {\n            background-color:rgba(0, 0, 0, 0.2); \n        }\n        \n        ".concat(this.builder.simpleEditingBreakpoint ? "\n          \n            @media all and (max-width: ".concat(this.builder.simpleEditingBreakpoint, ") {\n                .is-tool:not(#divSpacerTool) {\n                    display: none !important;\n                }\n                \n                .is-builder .row-active:not([data-protected]).row-outline {\n                    outline: none !important;\n                }\n            }\n            \n        ") : '', "\n\n\n        ");
  builder.contentStuff.insertAdjacentHTML('afterbegin', "\n        <style>\n            ".concat(css, "\n        </style>\n        "));
};
/* harmony default export */ const contentstuff = (ContentStuff);
;// CONCATENATED MODULE: ./src/contentbuilder/mediapicker.js
function mediapicker_typeof(obj) { "@babel/helpers - typeof"; return mediapicker_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, mediapicker_typeof(obj); }
function mediapicker_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function mediapicker_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, mediapicker_toPropertyKey(descriptor.key), descriptor); } }
function mediapicker_createClass(Constructor, protoProps, staticProps) { if (protoProps) mediapicker_defineProperties(Constructor.prototype, protoProps); if (staticProps) mediapicker_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function mediapicker_toPropertyKey(arg) { var key = mediapicker_toPrimitive(arg, "string"); return mediapicker_typeof(key) === "symbol" ? key : String(key); }
function mediapicker_toPrimitive(input, hint) { if (mediapicker_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (mediapicker_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var MediaPicker = /*#__PURE__*/function () {
  function MediaPicker(builder) {
    var _this = this;
    mediapicker_classCallCheck(this, MediaPicker);
    this.builder = builder;
    var util = this.builder.util;
    this.util = util;
    var builderStuff = this.builder.builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
    this.id = this.builder.util.makeId();
    var html = "\n        <div class=\"is-modal mediasource\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"max-width:550px;\">\n\n                <label for=\"inpMediaSource\" style=\"display:block\">".concat(util.out('Source'), ":</label>\n                <div class=\"image-src\">\n                    <input id=\"inpMediaSource\" class=\"input-src\" type=\"text\">\n                    <button title=\"").concat(util.out('Select'), "\" class=\"input-select\" style=\"flex:none;\">\n                        ").concat(this.builder.opts.selectIcon, "\n                    </button>\n                    <div class=\"input-upload\" style=\"position: relative; flex: 0 0 auto;box-shadow: rgba(0, 0, 0, 0.32) 0px 3px 6px -6px;\">\n                        <form class=\"form-upload-larger\" target=\"frameTarget").concat(this.id, "\" method=\"post\" action=\"").concat(this.builder.opts.largerImageHandler, "\" enctype=\"multipart/form-data\" style=\"position:absolute;display:flex;justify-content: center;align-items: center;top:0;left:0;width:100%;height:100%;\">\n                            <input name=\"hidRefId\" class=\"input-ref-id\" type=\"hidden\" value=\"\">\n                            <svg class=\"is-icon-flex\" style=\"width:18px;height:18px;\"><use xlink:href=\"#ion-ios-cloud-upload-outline\"></use></svg>\n                            <input title=\"").concat(util.out('Select'), "\" name=\"fileImage\" class=\"input-file-select\" type=\"file\" accept=\"image/*,video/mp4\" style=\"position:absolute;top:-30px;left:0;width:100%;height:80px;opacity: 0;cursor: pointer;\">\n                        </form>\n                        <iframe tabIndex=\"0\" id=\"frameTarget").concat(this.id, "\" name=\"frameTarget").concat(this.id, "\" src=\"about:blank\" style=\"width:1px;height:1px;position:absolute;top:0;right:-100000px\"></iframe>\n                    </div>\n                </div>\n\n                <div style=\"text-align:right;margin-top:20px;\">\n                    <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                    <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                </div>\n\n            </div>\n        </div>\n        ");
    dom.appendHtml(builderStuff, html);
    var modalMediaSelect = document.querySelector('.mediasource');
    this.modalMediaSelect = modalMediaSelect;
    if (this.builder.opts.largerImageHandler === '' && !this.builder.opts.onLargerImageUpload) {
      modalMediaSelect.querySelector('.input-upload').style.display = 'none';
    }
    if (!this.builder.opts.onImageSelectClick && this.builder.opts.imageselect === '') {
      modalMediaSelect.querySelector('.input-select').style.display = 'none';
    }
    if (this.builder.opts.onImageSelectClick || this.builder.opts.imageselect || this.builder.opts.onFileSelectClick || this.builder.opts.fileselect) {
      var inpSrc = modalMediaSelect.querySelector('.input-src');
      var elm = modalMediaSelect.querySelector('.input-select');
      if (elm) dom.addEventListener(elm, 'click', function () {
        var targetAssetType = _this.builder.targetAssetType;
        var targetInput = inpSrc;
        var theTrigger = elm;

        //--- Same ass openAsset() in contentbuilder.js 2098

        if (targetAssetType === 'media' && (_this.builder.opts.onMediaSelectClick || _this.builder.opts.onImageSelectClick)) {
          if (_this.builder.opts.onMediaSelectClick) {
            _this.builder.opts.onMediaSelectClick({
              targetInput: targetInput,
              theTrigger: theTrigger
            });
          } else {
            _this.builder.opts.onImageSelectClick({
              targetInput: targetInput,
              theTrigger: theTrigger
            });
          }
        } else if (targetAssetType === 'video' && _this.builder.opts.onVideoSelectClick) {
          _this.builder.opts.onVideoSelectClick({
            targetInput: targetInput,
            theTrigger: theTrigger
          });
        } else if (targetAssetType === 'image' && _this.builder.opts.onImageSelectClick) {
          _this.builder.opts.onImageSelectClick({
            targetInput: targetInput,
            theTrigger: theTrigger
          });
        } else if (targetAssetType === 'audio' && _this.builder.opts.onAudioSelectClick) {
          _this.builder.opts.onAudioSelectClick({
            targetInput: targetInput,
            theTrigger: theTrigger
          });
        } else if (targetAssetType === 'all' && _this.builder.opts.onFileSelectClick) {
          _this.builder.opts.onFileSelectClick({
            targetInput: targetInput,
            theTrigger: theTrigger
          });
        } else {
          var iframe;
          var modal;
          if (targetAssetType === 'media') {
            modal = _this.builder.builderStuff.querySelector('.is-modal.mediaselect');
            iframe = modal.querySelector('iframe');
            if (iframe.src === 'about:blank') {
              if (_this.builder.opts.mediaSelect) iframe.src = _this.builder.opts.mediaSelect;else if (_this.builder.opts.imageSelect) iframe.src = _this.builder.opts.imageSelect;
            }
          } else if (targetAssetType === 'video') {
            modal = _this.builder.builderStuff.querySelector('.is-modal.videoselect');
            iframe = modal.querySelector('iframe');
            if (iframe.src === 'about:blank') iframe.src = _this.builder.opts.videoSelect;
          } else if (targetAssetType === 'image') {
            modal = _this.builder.builderStuff.querySelector('.is-modal.imageselect');
            iframe = modal.querySelector('iframe');
            if (iframe.src === 'about:blank') iframe.src = _this.builder.opts.imageSelect;
          } else if (targetAssetType === 'audio') {
            modal = _this.builder.builderStuff.querySelector('.is-modal.audioselect');
            iframe = modal.querySelector('iframe');
            if (iframe.src === 'about:blank') iframe.src = _this.builder.opts.audioSelect;
          } else if (targetAssetType === 'all') {
            modal = _this.builder.builderStuff.querySelector('.is-modal.fileselect');
            iframe = modal.querySelector('iframe');
            if (iframe.src === 'about:blank') iframe.src = _this.builder.opts.fileSelect;
          }

          // this.builder.util.showModal(modal);

          _this.builder.util.showModal(modal, false, function () {
            elm.removeAttribute('data-focus');
            elm.focus();
          }, false, _this.builder.assetPanelFullScreen);
          elm.setAttribute('data-focus', true);
          _this.builder.targetInput = inpSrc; // used by selectAsset() (see contentbuilder.js)
          _this.builder.targetCallback = null;
          // this.targetAssetType = targetAssetType;
        }

        //---

        // if(this.builder.opts.onFileSelectClick) {

        //     this.builder.opts.onFileSelectClick({targetInput: inpSrc, theTrigger: elm});

        // } else if (this.builder.opts.onImageSelectClick) {

        //     this.builder.opts.onImageSelectClick({targetInput: inpSrc, theTrigger: elm});

        // } else if(this.builder.opts.fileselect) {

        //     let modalFileSelect = builderStuff.querySelector('.is-modal.fileselect');
        //     let iframe = modalFileSelect.querySelector('iframe');
        //     if(this.builder.opts.assetRefresh) {
        //         iframe.src = this.builder.opts.fileselect;
        //         this.builder.opts.assetRefresh = false;
        //     }
        //     if(iframe.src === 'about:blank') {
        //         iframe.src = this.builder.opts.fileselect;
        //     }
        //     util.showModal(modalFileSelect, false, ()=>{

        //         elm.removeAttribute('data-focus');
        //         elm.focus();
        //     });

        //     elm.setAttribute('data-focus', true);

        //     this.builder.targetInput = inpSrc;
        //     this.builder.targetCallback = null;
        //     // this.builder.targetAssetType = 'media';

        // } else if(this.builder.opts.imageselect) {

        //     let modalImageSelect = builderStuff.querySelector('.is-modal.imageselect');
        //     let iframe = modalImageSelect.querySelector('iframe');
        //     if(this.builder.opts.assetRefresh) {
        //         iframe.src = this.builder.opts.imageselect;
        //         this.builder.opts.assetRefresh = false;
        //     }
        //     if(iframe.src === 'about:blank'){
        //         iframe.src = this.builder.opts.imageselect;
        //     }
        //     util.showModal(modalImageSelect, false, ()=>{

        //         elm.removeAttribute('data-focus');
        //         elm.focus();
        //     });

        //     elm.setAttribute('data-focus', true);

        //     this.builder.targetInput = inpSrc;
        //     this.builder.targetCallback = null;
        //     // this.builder.targetAssetType = 'media';
        // }
      });
    }

    var inputFileSelect = modalMediaSelect.querySelector('.input-file-select');
    var frm = modalMediaSelect.querySelector('.form-upload-larger');
    dom.addEventListener(inputFileSelect, 'change', function (e) {
      var element = inputFileSelect;
      while (element.nodeName.toLowerCase() !== 'form') {
        element = element.parentNode;
      }
      var frmUpload = element;
      dom.addClass(frmUpload, 'please-wait');
      modalMediaSelect.querySelector('.input-ref-id').value = _this.builder.opts.customval;
      var targetAssetType = _this.builder.targetAssetType;
      if (targetAssetType === 'media' && _this.builder.opts.onMediaUpload) {
        _this.builder.opts.onMediaUpload(e);
      } else if (targetAssetType === 'video' && _this.builder.opts.onVideoUpload) {
        _this.builder.opts.onVideoUpload(e);
      } else if (targetAssetType === 'image' && _this.builder.opts.onLargerImageUpload) {
        _this.builder.opts.onLargerImageUpload(e);
      } else if (targetAssetType === 'audio' && _this.builder.opts.onAudioUpload) {
        _this.builder.opts.onAudioUpload(e);
      } else if (targetAssetType === 'all' && _this.builder.opts.onFileUpload) {
        _this.builder.opts.onFileUpload(e);
      } else if (_this.builder.opts.onLargerImageUpload) {
        // backward

        _this.builder.opts.onLargerImageUpload(e);
      } else {
        if (targetAssetType === 'media') {
          frm.setAttribute('action', _this.builder.opts.mediaHandler);
        } else if (targetAssetType === 'video') {
          frm.setAttribute('action', _this.builder.opts.videoHandler);
        } else if (targetAssetType === 'image') {
          frm.setAttribute('action', _this.builder.opts.largerImageHandler);
        } else if (targetAssetType === 'audio') {
          frm.setAttribute('action', _this.builder.opts.audioHandler);
        } else if (targetAssetType === 'all') {
          frm.setAttribute('action', _this.builder.opts.fileHandler);
          if (!_this.builder.opts.fileHandler) frm.setAttribute('action', _this.builder.opts.mediaHandler); //backward
        }

        frmUpload.submit();
      }

      // if(this.builder.opts.onLargerImageUpload) {

      //     this.builder.opts.onLargerImageUpload(e);

      // } else {

      //     frmUpload.submit();

      // }

      inputFileSelect.value = ''; // Clear Input
    });

    var btnImageOk = modalMediaSelect.querySelector('.input-ok');
    dom.addEventListener(btnImageOk, 'click', function () {
      var inpSrc = modalMediaSelect.querySelector('.input-src');
      var url = inpSrc.value;
      if (_this.builder.mediaSelectedCallback) _this.builder.mediaSelectedCallback(url);
      _this.builder.hideModal(modalMediaSelect);
    });
    var btnImageCancel = modalMediaSelect.querySelector('.input-cancel');
    dom.addEventListener(btnImageCancel, 'click', function () {
      _this.builder.hideModal(modalMediaSelect);
    });
  }
  mediapicker_createClass(MediaPicker, [{
    key: "openMediaPicker",
    value: function openMediaPicker(currentUrl, assetType, callback, btn) {
      this.builder.targetAssetType = assetType;
      var modalMediaSelect = this.modalMediaSelect;
      var inputFileSelect = modalMediaSelect.querySelector('.input-file-select');
      if (assetType === 'all') {
        inputFileSelect.setAttribute('accept', '*');
      } else if (assetType === 'media') {
        inputFileSelect.setAttribute('accept', 'image/*,video/mp4');
      } else if (assetType === 'video') {
        inputFileSelect.setAttribute('accept', 'video/mp4');
      } else if (assetType === 'image') {
        inputFileSelect.setAttribute('accept', 'image/*');
      } else if (assetType === 'audio') {
        inputFileSelect.setAttribute('accept', 'audio/mp3');
      }

      //Current value
      var inpSrc = modalMediaSelect.querySelector('.input-src');
      inpSrc.value = currentUrl;

      //mediaSelectedCallback
      this.builder.mediaSelectedCallback = callback;

      //Show modal
      modalMediaSelect.style.zIndex = '10005';
      this.util.showModal(modalMediaSelect, false, function () {
        if (btn) {
          btn.removeAttribute('data-focus');
          btn.focus();
        }
      }, false, this.builder.assetPanelFullScreen);
      if (btn) btn.setAttribute('data-focus', true);
    }
  }]);
  return MediaPicker;
}();
/* harmony default export */ const mediapicker = (MediaPicker);
;// CONCATENATED MODULE: ./src/contentbuilder/responsive.js
function responsive_typeof(obj) { "@babel/helpers - typeof"; return responsive_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, responsive_typeof(obj); }
function responsive_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function responsive_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, responsive_toPropertyKey(descriptor.key), descriptor); } }
function responsive_createClass(Constructor, protoProps, staticProps) { if (protoProps) responsive_defineProperties(Constructor.prototype, protoProps); if (staticProps) responsive_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function responsive_toPropertyKey(arg) { var key = responsive_toPrimitive(arg, "string"); return responsive_typeof(key) === "symbol" ? key : String(key); }
function responsive_toPrimitive(input, hint) { if (responsive_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (responsive_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Responsive = /*#__PURE__*/function () {
  function Responsive(builder) {
    responsive_classCallCheck(this, Responsive);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
  }
  responsive_createClass(Responsive, [{
    key: "getVisibility",
    value: function getVisibility(elm, target) {
      if (target === 'xs') return !elm.classList.contains('xs-hidden');
      if (target === 'sm') return !elm.classList.contains('sm-hidden');
      if (target === 'md') return !elm.classList.contains('md-hidden');
      if (target === '') return !elm.classList.contains('desktop-hidden');
    }
  }, {
    key: "setVisibility",
    value: function setVisibility(visibility, elm, target) {
      if (target === 'xs') {
        if (visibility) elm.classList.remove('xs-hidden');else elm.classList.add('xs-hidden');
      }
      if (target === 'sm') {
        if (visibility) elm.classList.remove('sm-hidden');else elm.classList.add('sm-hidden');
      }
      if (target === 'md') {
        if (visibility) elm.classList.remove('md-hidden');else elm.classList.add('md-hidden');
      }
      if (target === '') {
        if (visibility) elm.classList.remove('desktop-hidden');else elm.classList.add('desktop-hidden');
      }
    }
  }, {
    key: "readTarget",
    value: function readTarget(area) {
      var inp = area.querySelector('.input-device.on');
      var target = inp.getAttribute('data-value');
      if (target === '') {
        this.builder.livePreview.resizePreview(1920);
      }
      if (target === 'md') {
        this.builder.livePreview.resizePreview(1024);
      }
      if (target === 'sm') {
        this.builder.livePreview.resizePreview(768);
      }
      if (target === 'xs') {
        this.builder.livePreview.resizePreview(375);
      }
      return inp.getAttribute('data-value');
    }
  }, {
    key: "showVisibility",
    value: function showVisibility(area, visibility) {
      if (visibility) {
        area.querySelector('.input-visible').classList.add('on');
        area.querySelector('.input-hidden').classList.remove('on');
      } else {
        area.querySelector('.input-visible').classList.remove('on');
        area.querySelector('.input-hidden').classList.add('on');
      }
    }
  }]);
  return Responsive;
}();
/* harmony default export */ const contentbuilder_responsive = (Responsive);
;// CONCATENATED MODULE: ./src/contentbuilder/livepreview.js
function livepreview_typeof(obj) { "@babel/helpers - typeof"; return livepreview_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, livepreview_typeof(obj); }
function livepreview_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function livepreview_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, livepreview_toPropertyKey(descriptor.key), descriptor); } }
function livepreview_createClass(Constructor, protoProps, staticProps) { if (protoProps) livepreview_defineProperties(Constructor.prototype, protoProps); if (staticProps) livepreview_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function livepreview_toPropertyKey(arg) { var key = livepreview_toPrimitive(arg, "string"); return livepreview_typeof(key) === "symbol" ? key : String(key); }
function livepreview_toPrimitive(input, hint) { if (livepreview_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (livepreview_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var LivePreview = /*#__PURE__*/function () {
  function LivePreview(builder) {
    var _this = this;
    livepreview_classCallCheck(this, LivePreview);
    this.builder = builder;
    var util = this.builder.util;
    var builderStuff = this.builder.builderStuff;
    this.util = util;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
    var modal = builderStuff.querySelector('.content-preview');
    if (!modal) {
      var html = "\n            <style>\n            .is-modal.content-preview {\n                transition: all 0.1s ease;\n            }\n            .is-modal.content-preview > div > div {\n                transition: all 0.1s ease;\n            }\n            .is-modal.content-preview .is-modal-refresh,\n            .is-modal.content-preview .is-modal-device,\n            .is-modal.content-preview .is-modal-close {\n                background:transparent !important;\n                width:32px !important;\n                height:32px !important;\n                position:absolute !important;\n                box-shadow:none !important;\n            }\n            .is-modal.content-preview .is-modal-device {\n                top:2px;\n                left:2px;\n            }\n            .is-modal.content-preview .is-modal-refresh {\n                top:2px;\n                right:34px;\n            }\n            .is-modal.content-preview .is-modal-close {\n                top:2px;\n                right:2px;\n            }\n    \n            .is-screen-1920 { \n                width: 576px !important;\n                height: 332px !important; \n            }\n            .is-screen-1440 { \n                width: 431px !important; \n                height: 258px !important; \n            }\n            .is-screen-768 { \n                width: 245px !important;\n                height: 363px !important;\n            }\n            .is-screen-1024 { \n                width: 328px !important;\n                height: 281px !important;\n            }\n            .is-screen-375 { \n                width: 167px !important; \n                height: 332px !important;\n            }\n    \n            .is-screen-1920 .preview-screen {\n                width: 1920px;height: 992px;transform: scale(0.3);\n            }\n            .is-screen-1440 .preview-screen {\n                width: 1440px;height: 744px;transform: scale(0.3);\n            }\n            .is-screen-768 .preview-screen {\n                width: 768px;height: 1024px;transform: scale(0.32);\n            }\n            .is-screen-1024 .preview-screen {\n                width: 1024px;height: 768px;transform: scale(0.32);\n            }\n            .is-screen-375 .preview-screen {\n                width: 375px;height: 667px;transform: scale(0.446);\n            }\n            .is-screen-375 .is-modal-bar > span {\n                display: none;\n            }\n    \n            .content-preview:focus-within {\n                z-index:100021 !important\n            }\n            </style>\n            <div style=\"z-index:10002;".concat(this.builder.previewStyle, "\" class=\"is-modal is-modal-content content-preview is-screen-1920\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-bar is-draggable\" draggable=\"\"> \n                    <span>").concat(util.out('Live Preview'), "</span>\n                    <button class=\"is-modal-device\" tabindex=\"-1\" style=\"user-select:none;cursor:default\">\n                        \n                    </button>\n                    <button class=\"is-modal-refresh\" tabindex=\"-1\" title=\"").concat(util.out('Reload'), "\">\n                        <svg class=\"is-icon-flex\" style=\"width:16px;height:16px;\"><use xlink:href=\"#icon-reload\"></use></svg>\n                    </button>\n                    <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">\n                        <svg class=\"is-icon-flex\" style=\"width:23px;height:23px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg>\n                    </button>\n                </div>\n                <div style=\"position:relative;position:absolute;top:0;left:0;width:100%;height:100%;border-top:transparent 35px solid;\">\n                    <div class=\"preview-screen\" style=\"padding:0;position: absolute;top: 0;left: 0;box-sizing: border-box;transform-origin: top left;\">\n                        <iframe src=\"about:blank\" style=\"box-sizing:border-box;width: 100%;height: 100%;position:absolute;\"></iframe>\n                    </div>\n                </div>\n                <div style=\"position:absolute;left:3px;bottom:3px;border-radius:3px;display:flex;overflow:hidden;\">\n                    <button class=\"is-modal-size\" tabindex=\"-1\" title=\"").concat(util.out('Screen Sizes'), "\" style=\"width:30px;height:30px;\">\n                        <svg class=\"is-icon-flex\" style=\"width:23px;height:23px;\"><use xlink:href=\"#icon-devices\"></use></svg>\n                    </button>\n                </div>\n            </div>\n            ");
      dom.appendHtml(builderStuff, html);
      var _modal = builderStuff.querySelector('.is-modal.content-preview');
      this.modal = _modal;
      var btnPreviewClose = _modal.querySelector('.is-modal-close');
      btnPreviewClose.addEventListener('click', function () {
        _this.closePreview();
      });
      var btnModalSize = _modal.querySelector('.is-modal-size');
      btnModalSize.addEventListener('click', function () {
        if (_modal.classList.contains('is-screen-1920')) {
          _this.resizePreview(1440);
        } else if (_modal.classList.contains('is-screen-1440')) {
          _this.resizePreview(1024);
        } else if (_modal.classList.contains('is-screen-1024')) {
          _this.resizePreview(768);
        } else if (_modal.classList.contains('is-screen-768')) {
          _this.resizePreview(375);
        } else if (_modal.classList.contains('is-screen-375')) {
          _this.resizePreview(1920);
        }
      });
      var btnModalRefresh = _modal.querySelector('.is-modal-refresh');
      btnModalRefresh.addEventListener('click', function () {
        _this.previewRefresh(false, true);
      });

      //Extend onChange
      var old2 = this.builder.settings.onChange;
      this.builder.settings.onChange = function () {
        old2.call(_this);
        if (!_this.builder.doc.querySelector('.is-wrapper')) {
          // ContentBuilder
          _this.previewRefresh();
        }
        // For ContentBox, this onChange will trigger ContentBox onChange (which has previewRefresh called)
      };
    }
  }
  livepreview_createClass(LivePreview, [{
    key: "resizePreview",
    value: function resizePreview(size) {
      var modal = this.modal;
      var util = this.util;
      modal.classList.remove('is-screen-1920');
      modal.classList.remove('is-screen-1440');
      modal.classList.remove('is-screen-1920');
      modal.classList.remove('is-screen-1024');
      modal.classList.remove('is-screen-768');
      modal.classList.remove('is-screen-375');
      var infoDevice = modal.querySelector('.is-modal-device');
      var previewScreen = modal.querySelector('.preview-screen');
      previewScreen.style.transition = 'none';
      previewScreen.style.opacity = '0';
      if (size === 1440) {
        modal.classList.add('is-screen-1440');
        localStorage.setItem('_livepreviewscreen', 'is-screen-1440');
        infoDevice.setAttribute('title', util.out('Laptop'));
        infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:18px;height:18px"><use xlink:href="#icon-device-laptop"></use></svg>';
      } else if (size === 1024) {
        modal.classList.add('is-screen-1024');
        infoDevice.setAttribute('title', util.out('Tablet (Landscape)'));
        localStorage.setItem('_livepreviewscreen', 'is-screen-1024');
        infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px;transform:rotate(-90deg)"><use xlink:href="#icon-device-tablet"></use></svg>';
      } else if (size === 768) {
        modal.classList.add('is-screen-768');
        localStorage.setItem('_livepreviewscreen', 'is-screen-768');
        infoDevice.setAttribute('title', util.out('Tablet (Portrait)'));
        infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px"><use xlink:href="#icon-device-tablet"></use></svg>';
      } else if (size === 375) {
        modal.classList.add('is-screen-375');
        localStorage.setItem('_livepreviewscreen', 'is-screen-375');
        infoDevice.setAttribute('title', util.out('Mobile'));
        infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px"><use xlink:href="#icon-device-mobile"></use></svg>';
      } else if (size === 1920) {
        modal.classList.add('is-screen-1920');
        localStorage.setItem('_livepreviewscreen', 'is-screen-1920');
        infoDevice.setAttribute('title', util.out('Desktop'));
        infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px"><use xlink:href="#icon-device-desktop"></use></svg>';
      }
      this.previewRefresh(true);
      setTimeout(function () {
        previewScreen.style.opacity = '';
        previewScreen.style.transition = '';
      }, 100);
    }
  }, {
    key: "previewRefresh",
    value: function previewRefresh(disableOnContentLoad, hardReload) {
      var _this2 = this;
      if (this.modal.classList.contains('active')) {
        // let html = this.builder.html();
        // localStorage.setItem('preview-html', html); 
        try {
          if (this.builder.onPreviewOpen) this.builder.onPreviewOpen();
        } catch (e) {
          return;
        }
        var iframe = this.modal.querySelector('iframe');
        if (!this.builder.doc.querySelector('.is-wrapper')) {
          // ContentBuilder

          if (this.builder.previewURL) {
            if (this.builder.livePreviewAlwaysReload || hardReload) {
              iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
            } else {
              var iframeDocument = iframe.contentDocument || iframe.contentWindow.document;
              if (iframeDocument) {
                if (!iframeDocument.body) {
                  iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
                } else {
                  if (iframeDocument.body.innerHTML === '') {
                    iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
                  } else {
                    // sync. html
                    var html = this.builder.html();
                    var container = iframeDocument.querySelector('.container');
                    if (!container) container = iframeDocument.querySelector('.is-container');
                    if (container) {
                      // container.innerHTML = html;
                      var range = this.builder.doc.createRange();
                      container.innerHTML = '';
                      container.appendChild(range.createContextualFragment(html));
                    } else {
                      iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
                    }
                  }
                }
              } else {
                iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
              }
            }
          } else {
            try {
              this.writeHtml(iframe);
            } catch (e) {
              // Do Nothing
            }
          }
        } else {
          // ContentBox

          if (!this.builder.count) this.builder.count = 0;
          this.builder.count++;
          var oriVal = this.builder.livePreviewAlwaysReload;
          if (this.builder.count === this.builder.livePreviewReloadEvery) {
            this.builder.livePreviewAlwaysReload = true;
            this.builder.count = 0;
          }
          if (this.builder.livePreviewAlwaysReload || hardReload) {
            iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
          } else {
            var _iframeDocument = iframe.contentDocument || iframe.contentWindow.document;
            if (_iframeDocument) {
              if (!_iframeDocument.body) {
                iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
              } else {
                if (_iframeDocument.body.innerHTML === '') {
                  iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
                } else {
                  // sync. html
                  var _html = localStorage.getItem('preview-html');
                  var wrapper = _iframeDocument.querySelector('.is-wrapper');
                  // wrapper.innerHTML = html;
                  var _range = this.builder.doc.createRange();
                  wrapper.innerHTML = '';
                  wrapper.appendChild(_range.createContextualFragment(_html));

                  // sync. styles
                  // let mainCss = localStorage.getItem('preview-maincss'); 
                  // let sectionCss = localStorage.getItem('preview-sectioncss');

                  var elms = _iframeDocument.querySelectorAll('link');
                  var links = this.builder.doc.getElementsByTagName('link');
                  Array.from(links).map(function (link) {
                    var href = link.href.toLowerCase();
                    if (href.indexOf('/basetype-') !== -1 || href.indexOf('/type-') !== -1) {
                      // check
                      var exist = false;
                      elms.forEach(function (elm) {
                        var elmHref = elm.href.toLowerCase();
                        if (elmHref) {
                          if (elmHref.indexOf('/basetype-') !== -1 || elmHref.indexOf('/type-') !== -1) {
                            if (href === elmHref) {
                              exist = true;
                            }
                          }
                        }
                      });
                      if (!exist) {
                        // clone is needed, otherwise, parent resource may dissapear when loading on iframe
                        var clone = link.cloneNode(true);
                        _iframeDocument.head.appendChild(clone); // ADD
                      }
                    }
                  });

                  elms.forEach(function (elm) {
                    var href = elm.href.toLowerCase();
                    if (href.indexOf('/basetype-') !== -1 || href.indexOf('/type-') !== -1) {
                      // check
                      var exist = false;
                      Array.from(links).map(function (link) {
                        var elmHref = link.href.toLowerCase();
                        if (elmHref) {
                          if (elmHref.indexOf('/basetype-') !== -1 || elmHref.indexOf('/type-') !== -1) {
                            if (href === elmHref) {
                              exist = true;
                            }
                          }
                        }
                      });
                      if (!exist) {
                        _iframeDocument.head.removeChild(elm); // REMOVE
                      }
                    }
                  });

                  // reload box js
                  elms = _iframeDocument.querySelectorAll('script');
                  elms.forEach(function (elm) {
                    var src = elm.getAttribute('src');
                    if (src) {
                      if (src.indexOf('box-flex.js') !== -1 || src.indexOf('box.js') !== -1) {
                        elm.parentElement.removeChild(elm);
                        var scriptElm = document.createElement('script');
                        scriptElm.setAttribute('src', src);
                        _iframeDocument.body.appendChild(scriptElm);
                      }
                    }
                  });

                  // Play Anim
                  elms = wrapper.querySelectorAll('.is-animated');
                  elms.forEach(function (elm) {
                    elm.style.opacity = '0';
                    elm.style.transition = 'none';
                  });
                  setTimeout(function () {
                    var elms = wrapper.querySelectorAll('.is-animated');
                    elms.forEach(function (elm) {
                      elm.classList.remove('is-inview');
                    });
                    setTimeout(function () {
                      elms = wrapper.querySelectorAll('.is-animated');
                      elms.forEach(function (elm) {
                        elm.style.opacity = '';
                        elm.style.transition = '';
                        elm.classList.add('is-inview');
                      });
                    }, 30);
                  }, 200);
                }
              }
            } else {
              iframe.src = this.builder.previewURL + '?' + Math.floor(Date.now() / 1000);
            }
          }
          this.builder.livePreviewAlwaysReload = oriVal;
        }
        iframe.onload = function () {
          try {
            if (_this2.builder.onPreviewContentLoad && !disableOnContentLoad) _this2.builder.onPreviewContentLoad();
          } catch (e) {
            // Do Nothing
          }
          iframe.contentWindow.document.addEventListener('click', function () {
            iframe.focus();
          });
        };
      }
    }
  }, {
    key: "openPreview",
    value: function openPreview() {
      // if(!this.builder.previewURL) return;

      // if(this.modal.classList.contains('active')) return;

      var util = this.util;
      var modal = this.modal;
      modal.classList.add('active');
      if (localStorage.getItem('_livepreviewscreen') != null) {
        modal.classList.remove('is-screen-1920');
        modal.classList.remove('is-screen-1440');
        modal.classList.remove('is-screen-1024');
        modal.classList.remove('is-screen-768');
        modal.classList.remove('is-screen-375');
        modal.classList.add(localStorage.getItem('_livepreviewscreen'));
        var infoDevice = modal.querySelector('.is-modal-device');
        if (modal.classList.contains('is-screen-1920')) {
          infoDevice.setAttribute('title', util.out('Desktop'));
          infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px"><use xlink:href="#icon-device-desktop"></use></svg>';
        } else if (modal.classList.contains('is-screen-1440')) {
          infoDevice.setAttribute('title', util.out('Laptop'));
          infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:18px;height:18px"><use xlink:href="#icon-device-laptop"></use></svg>';
        } else if (modal.classList.contains('is-screen-1024')) {
          infoDevice.setAttribute('title', util.out('Tablet (Landscape)'));
          infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px;transform:rotate(-90deg)"><use xlink:href="#icon-device-tablet"></use></svg>';
        } else if (modal.classList.contains('is-screen-768')) {
          infoDevice.setAttribute('title', util.out('Tablet (Portrait)'));
          infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px"><use xlink:href="#icon-device-tablet"></use></svg>';
        } else if (modal.classList.contains('is-screen-375')) {
          infoDevice.setAttribute('title', util.out('Mobile'));
          infoDevice.innerHTML = '<svg class="is-icon-flex" style="width:16px;height:16px"><use xlink:href="#icon-device-mobile"></use></svg>';
        }
      }
      this.previewRefresh();
      localStorage.setItem('_livepreview', '1');
    }
  }, {
    key: "closePreview",
    value: function closePreview() {
      var modal = this.modal;
      modal.classList.remove('active');
      if (this.builder.onPreviewClose) this.builder.onPreviewClose();
      localStorage.removeItem('_livepreview');
    }
  }, {
    key: "writeHtml",
    value: function writeHtml(iframe) {
      var doc = this.builder.doc;
      var basehref = '';
      var base = doc.querySelectorAll('base[href]');
      if (base.length > 0) {
        basehref = '<base href="' + base[0].href + '" />';
      }
      var csslinks = '';
      var styles = doc.querySelectorAll('link[href]');
      for (var i = 0; i < styles.length; i++) {
        if (styles[i].href.indexOf('.css') != -1 && styles[i].href.indexOf('contentbox.css') == -1 && styles[i].href.indexOf('contentbuilder.css') == -1) {
          csslinks += '<link href="' + styles[i].href + '" rel="stylesheet">';
        }
      }
      var jsincludes1 = '';
      var scripts = doc.head.querySelectorAll('script[src]');
      for (var _i = 0; _i < scripts.length; _i++) {
        if (scripts[_i].src.indexOf('.js') != -1 && scripts[_i].src.indexOf('_next/') == -1 &&
        //next
        scripts[_i].src.indexOf('static/js/') == -1 &&
        //react
        scripts[_i].src.indexOf('src/') == -1 &&
        //vue
        scripts[_i].src.indexOf('index') == -1 && scripts[_i].src.indexOf('contentbox.js') == -1 && scripts[_i].src.indexOf('contentbox.min.js') == -1 && scripts[_i].src.indexOf('contentbuilder.js') == -1 && scripts[_i].src.indexOf('contentbuilder.min.js') == -1 && scripts[_i].src.indexOf('plugin.js') == -1 && scripts[_i].src.indexOf('config.js') == -1 && scripts[_i].src.indexOf('en.js') == -1 && scripts[_i].src.indexOf('rangy') == -1 && scripts[_i].src.indexOf('monaco-editor') == -1 && scripts[_i].src.indexOf('minimalist-blocks') == -1) {
          jsincludes1 += '<script src="' + scripts[_i].src + '"></script>';
        }
      }
      var jsincludes2 = '';
      scripts = doc.body.querySelectorAll('script[src]');
      for (var _i2 = 0; _i2 < scripts.length; _i2++) {
        if (scripts[_i2].src.indexOf('.js') != -1 && scripts[_i2].src.indexOf('_next/') == -1 &&
        //next
        scripts[_i2].src.indexOf('static/js/') == -1 &&
        //react
        scripts[_i2].src.indexOf('src/') == -1 &&
        //vue
        scripts[_i2].src.indexOf('index') == -1 && scripts[_i2].src.indexOf('contentbox.js') == -1 && scripts[_i2].src.indexOf('contentbox.min.js') == -1 && scripts[_i2].src.indexOf('contentbuilder.js') == -1 && scripts[_i2].src.indexOf('contentbuilder.min.js') == -1 && scripts[_i2].src.indexOf('plugin.js') == -1 && scripts[_i2].src.indexOf('config.js') == -1 && scripts[_i2].src.indexOf('en.js') == -1 && scripts[_i2].src.indexOf('rangy') == -1 && scripts[_i2].src.indexOf('monaco-editor') == -1 && scripts[_i2].src.indexOf('minimalist-blocks') == -1) {
          jsincludes2 += '<script src="' + scripts[_i2].src + '"></script>';
        }
      }
      var maxwidth = '800px';
      var maxw = window.getComputedStyle(doc.querySelector('.is-builder')).getPropertyValue('max-width');
      if (!isNaN(parseInt(maxw))) maxwidth = maxw;
      var content = this.builder.html();
      var html = '<html>' + '<head>' + basehref + '<meta charset="utf-8">' + '<title></title>' + '<style>#_cbhtml > *:not(.is-lightbox) {display:none}</style>' + csslinks + (this.builder.useLightbox ? '<link href="' + this.builder.assetPath + 'scripts/lightbox/lightbox.css" rel="stylesheet">' : '') + '<style>' + '.slider-image { display:block !important; }' + '.container {margin:35px auto 0; max-width: ' + maxwidth + '; width:100%; padding:0 20px; box-sizing: border-box;}' + '</style>' + '<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>' + jsincludes1 + '</head>' + '<body>' + '<div class="container preview">' + content + '</div>' + jsincludes2 + (this.builder.useLightbox ? '<script src="' + this.builder.assetPath + 'scripts/lightbox/lightbox.js"></script><script>window.lightbox.init();</script>' : '') + '</body>' + '</html>';

      // doc = iframe.contentWindow.document;
      // doc.open();
      // doc.write(html);
      // doc.close();

      iframe.srcdoc = html;
    }
  }]);
  return LivePreview;
}();
/* harmony default export */ const livepreview = (LivePreview);
;// CONCATENATED MODULE: ./src/contentbuilder/lib.js
function lib_typeof(obj) { "@babel/helpers - typeof"; return lib_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, lib_typeof(obj); }
function lib_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function lib_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, lib_toPropertyKey(descriptor.key), descriptor); } }
function lib_createClass(Constructor, protoProps, staticProps) { if (protoProps) lib_defineProperties(Constructor.prototype, protoProps); if (staticProps) lib_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function lib_toPropertyKey(arg) { var key = lib_toPrimitive(arg, "string"); return lib_typeof(key) === "symbol" ? key : String(key); }
function lib_toPrimitive(input, hint) { if (lib_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (lib_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
// Collection of common editing functions
var Lib = /*#__PURE__*/function () {
  function Lib(builder) {
    lib_classCallCheck(this, Lib);
    this.builder = builder;
  }
  lib_createClass(Lib, [{
    key: "getFunctions",
    value: function getFunctions() {
      return [{
        name: 'get_intent',
        description: 'analyze user command to modify or create section/content',
        parameters: {
          type: 'object',
          properties: {
            asking_info: {
              type: 'boolean',
              description: 'User request an information.'
            },
            add_info: {
              // Without this, adding info will be considered as asking_info. Tha add_info should be the same as change_text
              type: 'boolean',
              description: 'User request an information to be added to the current content.'
            },
            // Add new Column or Block (in General Mode)
            add_column_or_block: {
              type: 'boolean',
              description: 'User requests to add a column or a block.'
            },
            new_content: {
              type: 'boolean',
              description: 'User requests to add a new content.'
            },
            redesign_layout: {
              type: 'boolean',
              description: 'If redesigning the layout is requested.'
            },
            change_text: {
              type: 'boolean',
              description: 'User explicitely requests to update text of the current content, rewrite, paraphrase, translate or change text.'
            },
            write_based_on_the_current_content: {
              type: 'boolean',
              description: 'User request to create new content based on the current content, such as to summarize, expand, make short, create a tweet or social media post, etc'
            },
            change_style: {
              type: 'boolean',
              description: 'If changing element style is requested.'
            },
            // section_background_color: {
            //     type: 'string',
            //     description: 'User request to add, adjust (lighter or darker) or remove section background color. Possible value: color value (convert to HTML supported), lighter, darker, remove'
            // },

            //-----
            add_headline: {
              type: 'boolean',
              description: 'If requested to add a headline.'
            },
            add_paragraph: {
              type: 'boolean',
              description: 'If requested to add a paragraph.'
            },
            add_space: {
              type: 'boolean',
              description: 'If requested to add a space.'
            },
            add_button: {
              type: 'boolean',
              description: 'If requested to add a button.'
            },
            add_youtube: {
              type: 'boolean',
              description: 'If requested to add a youtube/vimeo video.'
            },
            add_video: {
              type: 'boolean',
              description: 'If requested to add a video.'
            },
            add_audio: {
              type: 'boolean',
              description: 'If requested to add an audio.'
            },
            add_map: {
              type: 'boolean',
              description: 'If requested to add a google map.'
            },
            add_code: {
              type: 'boolean',
              description: 'If requested to add a custom code block.'
            },
            add_article: {
              type: 'boolean',
              description: 'If requested to add an article.'
            },
            add_image: {
              type: 'string',
              description: 'User request to add image or gallery. Possible value: image, gallery'
            },
            add_list: {
              type: 'boolean',
              description: 'If requested to add a list (eg. features, benefits, or list of items to explain).'
            },
            add_list_with_image: {
              type: 'boolean',
              description: 'If requested to add a list with an image for each list item.'
            },
            add_list_with_icon: {
              type: 'boolean',
              description: 'If requested to add a list with an icon.'
            },
            add_list_with_number: {
              type: 'boolean',
              description: 'If requested to add a list with numbering.'
            },
            //-----
            change_color_individual_text: {
              type: 'boolean',
              description: 'User requests to change the color of a headline, paragraph of specific element/text.'
            },
            align_individual_text: {
              type: 'boolean',
              description: 'If requested to align an individual text/element, such as a headline, a paragraph, buttons, etc to left, center or right'
            },
            align_whole_content: {
              type: 'string',
              description: 'User requests to align the whole text/content. Possible value: left, center or right'
            },
            // Block Mode (in General Mode)
            block_task: {
              type: 'string',
              description: 'User requests to move, duplicate, or delete block/row. Possible values: move-up, move-down, duplicate, remove'
            },
            column_task: {
              type: 'string',
              description: 'User requests to duplicate column, or delete column. Possible values: duplicate, remove'
            },
            move_column: {
              type: 'string',
              description: 'User requests to move column. Possible values: move-up, move-down, move-left, move-right'
            },
            increase_decrease_column: {
              type: 'string',
              description: 'User requests to increase/enlarge or decrease/reduce column size/width. Possible values: increase, decrease'
            },
            move_content_left: {
              type: 'boolean',
              description: 'Move content to the left'
            },
            move_content_center: {
              type: 'boolean',
              description: 'Move content to the center'
            },
            move_content_right: {
              type: 'boolean',
              description: 'Move content to the right'
            },
            move_content_top: {
              type: 'boolean',
              description: 'Move content to the top'
            },
            move_content_bottom: {
              type: 'boolean',
              description: 'Move content to the bottom'
            },
            line_height_individual_text: {
              type: 'boolean',
              description: 'User requests to increase/decrease the line height of an individual text/element (eg. headline).'
            },
            font_size_individual_text: {
              type: 'boolean',
              description: 'User requests to increase/decrease the font size of an individual text/element (eg. headline).'
            },
            select_block: {
              type: 'string',
              description: 'User requests to select a block. Value can be: block, headline, title, paragraph, image, next, previous, first, last'
            },
            unselect_block: {
              type: 'boolean',
              description: 'User requests to unselect block'
            }
          },
          required: ['image', 'article']
        }
      }];
    }
  }, {
    key: "getFunctions_block",
    value: function getFunctions_block() {
      return [{
        name: 'get_intent',
        description: 'analyze user command to modify or create section/content',
        parameters: {
          type: 'object',
          properties: {
            enhance_writings: {
              type: 'boolean',
              description: 'User requests to enhance the writings, rewrite, paraphrase or change text.'
            },
            editing: {
              type: 'boolean',
              description: 'If requested to modify the current content or style.'
            },
            add_headline: {
              type: 'boolean',
              description: 'User requests to add a headline.'
            },
            add_space: {
              type: 'boolean',
              description: 'User requests to add a space.'
            },
            adjust_space: {
              type: 'boolean',
              description: 'User requests to increase or decrease a space.'
            },
            add_button: {
              type: 'boolean',
              description: 'User requests to add a button.'
            },
            add_youtube: {
              type: 'boolean',
              description: 'User requests to add a youtube/vimeo video.'
            },
            add_video: {
              type: 'boolean',
              description: 'User requests to add a video.'
            },
            add_audio: {
              type: 'boolean',
              description: 'User requests to add an audio.'
            },
            add_map: {
              type: 'boolean',
              description: 'User requests to add a google map.'
            },
            add_image: {
              type: 'boolean',
              description: 'User requests to add an image'
            },
            align_text: {
              type: 'boolean',
              description: 'User requests to align text'
            },
            line_height: {
              type: 'boolean',
              description: 'User requests to change or adjust line height'
            },
            font_size: {
              type: 'boolean',
              description: 'User requests to change or adjust font size'
            },
            new_block: {
              type: 'boolean',
              description: 'User requests to add a new block.'
            },
            block_task: {
              type: 'string',
              description: 'User requests to move, duplicate, or delete block/row. Possible values: move-up, move-down, duplicate, remove'
            },
            new_column_onright: {
              type: 'boolean',
              description: 'User requests to add a new column.'
            },
            new_column_onleft: {
              type: 'boolean',
              description: 'User requests to add a new column on the left.'
            },
            column_task: {
              type: 'string',
              description: 'User requests to duplicate column, or delete column. Possible values: duplicate, remove'
            },
            move_column: {
              type: 'string',
              description: 'User requests to move column. Possible values: move-up, move-down, move-left, move-right'
            },
            increase_decrease_column: {
              type: 'string',
              description: 'User requests to increase/enlarge or decrease/reduce column size/width. Possible values: increase, decrease'
            }
          }
        }
      }];
    }

    // Get complete/outer HTML of an element;
  }, {
    key: "getHtml",
    value: function getHtml(element) {
      var combineStrings = function combineStrings(outer, inner) {
        // Find the opening tag of the first/parent element
        var openingTagRegex = /<([a-zA-Z]+\b[^>]*)>/;
        var openingTagMatch = outer.match(openingTagRegex);
        var openingTag = openingTagMatch[1];
        var combinedResult = "<".concat(openingTag, ">").concat(inner, "</div>");
        return combinedResult;
      };
      var html = combineStrings(element.outerHTML, this.builder.readHtml(element, false, true));
      return html;
    }

    // Run functions based on short command
  }, {
    key: "processShortCommand",
    value: function processShortCommand(command) {
      var _this = this;
      command = command.toLowerCase();
      var shortCommandList = this.builder.shortCommandList;
      var getMatchingCommand = function getMatchingCommand(command) {
        for (var key in shortCommandList) {
          if (shortCommandList[key].includes(command)) {
            return key;
          }
        }
        return false;
      };
      var intent = getMatchingCommand(command);

      // Undo/Redo
      if (intent === 'undo') {
        this.builder.undo();
        return false;
      }
      if (intent === 'redo') {
        this.builder.redo();
        return false;
      }

      // The process below needs active element
      var elm = this.builder.activeElement;
      if (!elm) return command;

      // Size
      var isTextBlockElement = function isTextBlockElement(element) {
        var textBlockTags = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'PRE'];
        var tagName = element.tagName.toUpperCase();
        return textBlockTags.includes(tagName);
      };
      if (intent === 'increase') {
        if (elm.classList.contains('spacer')) {
          this.builder.saveForUndo();
          this.builder.lib.increaseElementHeight(elm);
          return false;
        } else if (isTextBlockElement(elm)) {
          this.builder.saveForUndo();
          this.builder.lib.increaseFontSize(elm);
          return false;
        }
      }
      if (intent === 'decrease') {
        if (elm.classList.contains('spacer')) {
          this.builder.saveForUndo();
          this.builder.lib.decreaseElementHeight(elm);
          return false;
        } else if (isTextBlockElement(elm)) {
          this.builder.saveForUndo();
          this.builder.lib.decreaseFontSize(elm);
          return false;
        }
      }

      // Text
      var formatText = function formatText(s) {
        _this.builder.saveForUndo();
        _this.builder.util.restoreSelection();
        _this.builder.formatTextNonToggle(s);
        _this.builder.util.saveSelection();
      };
      if (intent === 'bold') {
        formatText('bold');
        return false;
      }
      if (intent === 'italic') {
        formatText('italic');
        return false;
      }
      if (intent === 'underline') {
        formatText('underline');
        return false;
      }
      if (intent === 'strikethrough') {
        formatText('strikethrough');
        return false;
      }
      if (intent === 'superscript') {
        formatText('superscript');
        return false;
      }
      if (intent === 'subscript') {
        formatText('subscript');
        return false;
      }
      if (intent === 'uppercase') {
        formatText('uppercase');
        return false;
      }
      if (intent === 'lowercase') {
        formatText('lowercase');
        return false;
      }
      if (intent === 'capitalize') {
        formatText('capitalize');
        return false;
      }
      if (intent === 'clean') {
        formatText('clean');
        return false;
      }
      return command;
    }
  }, {
    key: "getCurrentBackground",
    value: function getCurrentBackground(activeBox) {
      var currentImage = '';
      var overlayBgs = activeBox.querySelectorAll('.is-overlay-bg');
      overlayBgs.forEach(function (overlayBg) {
        if (overlayBg.style.backgroundImage) {
          if (overlayBg.style.backgroundImage.indexOf('url(') !== -1) {
            var url = overlayBg.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
            // let filename = url.substring(url.lastIndexOf('/') + 1);
            if (currentImage !== '') currentImage = ', ';
            // currentImage+= `${filename}`;
            currentImage += "".concat(url);
          }
        }
      });
      return currentImage;
    }
  }, {
    key: "clearBackgroundColor",
    value: function clearBackgroundColor(activeBox) {
      var overlayBg = activeBox.querySelector('.is-overlay');
      if (overlayBg) {
        overlayBg.style.backgroundColor = '';
      }
    }
  }, {
    key: "clearBackgroundImage",
    value: function clearBackgroundImage(activeBox) {
      var overlayBg = activeBox.querySelector('.is-overlay-bg');
      if (overlayBg) {
        overlayBg.parentNode.removeChild(overlayBg);
      }
    }
  }, {
    key: "updateBackgroundImage",
    value: function updateBackgroundImage(activeBox, url) {
      var overlay = activeBox.querySelector('.is-overlay');
      if (!overlay) {
        activeBox.insertAdjacentHTML('afterbegin', '<div class="is-overlay"></div>');
        overlay = activeBox.querySelector('.is-overlay');
      }
      if (activeBox.classList.contains('is-section')) {
        if (activeBox.classList.contains('min-height-20') || activeBox.classList.contains('min-height-25') || activeBox.classList.contains('min-height-30') || activeBox.classList.contains('min-height-40') || activeBox.classList.contains('min-height-50') || activeBox.classList.contains('min-height-60') || activeBox.classList.contains('min-height-70') || activeBox.classList.contains('min-height-75') || activeBox.classList.contains('min-height-80') || activeBox.classList.contains('min-height-90') || activeBox.classList.contains('min-height-100')) {
          // Do Nothing
        } else {
          activeBox.classList.add('min-height-60');
        }
      }
      var overlayBg = overlay.querySelector('.is-overlay-bg');
      if (!overlayBg) {
        overlay.insertAdjacentHTML('beforeend', '<div class="is-overlay-bg"></div>');
        overlayBg = overlay.querySelector('.is-overlay-bg');
      }
      overlayBg.style.backgroundImage = 'url(\'' + url + '\')';
      overlayBg.style.backgroundPosition = 50 + '%' + ' ' + 60 + '%'; //default

      // Reset position & filter (grayscale)
      overlayBg.style.filter = '';
      overlay.style.filter = '';
    }
  }, {
    key: "moveContent",
    value: function moveContent(activeBox, val) {
      var container = activeBox.querySelector('.is-container');
      if (val === 'left' || val === 'center' || val === 'right') {
        container.classList.remove('is-content-left');
        container.classList.remove('is-content-right');
        container.classList.remove('edge-x--1');
        container.classList.remove('edge-x--0-75');
        container.classList.remove('edge-x--0-5');
        container.classList.remove('edge-x--0-25');
        container.classList.remove('edge-x-0');
        container.classList.remove('edge-x-0-25');
        container.classList.remove('edge-x-0-5');
        container.classList.remove('edge-x-0-75');
        container.classList.remove('edge-x-1');
        container.classList.remove('edge-x-2');
        container.classList.remove('edge-x-3');
        container.classList.remove('edge-x-4');
        container.classList.remove('edge-x-5');
        container.classList.remove('edge-x-6');
      }
      if (val === 'left') {
        container.classList.add('is-content-left');
        if (activeBox.querySelector('.glide')) {
          container.classList.add('edge-x-3'); // to give space for slider arrow
        } else {
          container.classList.add('edge-x-2');
        }
      }
      if (val === 'center') {
        // Do Nothing
      }
      if (val === 'right') {
        container.classList.add('is-content-right');
        if (activeBox.querySelector('.glide')) {
          container.classList.add('edge-x-3'); // to give space for slider arrow
        } else {
          container.classList.add('edge-x-2');
        }
      }
      if (val === 'top' || val === 'middle' || val === 'bottom') {
        activeBox.classList.remove('is-content-top');
        activeBox.classList.remove('is-content-bottom');
        activeBox.classList.remove('edge-y--5');
        activeBox.classList.remove('edge-y--4');
        activeBox.classList.remove('edge-y--3');
        activeBox.classList.remove('edge-y--2');
        activeBox.classList.remove('edge-y--1');
        activeBox.classList.remove('edge-y-0');
        activeBox.classList.remove('edge-y-0-25');
        activeBox.classList.remove('edge-y-0-5');
        activeBox.classList.remove('edge-y-0-75');
        activeBox.classList.remove('edge-y-1');
        activeBox.classList.remove('edge-y-2');
        activeBox.classList.remove('edge-y-3');
        activeBox.classList.remove('edge-y-4');
        activeBox.classList.remove('edge-y-5');
        activeBox.classList.remove('edge-y-6');
        activeBox.classList.remove('edge-y-7');
        activeBox.classList.remove('edge-y-8');
      }
      if (val === 'top') {
        activeBox.classList.add('is-content-top');
        activeBox.classList.add('edge-y-2');
      }
      if (val === 'middle') {
        // Do Nothing
      }
      if (val === 'bottom') {
        activeBox.classList.add('is-content-bottom');
        activeBox.classList.add('edge-y-2');
      }
      this.builder.hideElementTools();
    }
  }, {
    key: "updateContentSize",
    value: function updateContentSize(activeBox, val) {
      var container = activeBox.querySelector('.is-container');
      // const contentSizes = this.builder.contentSizes;
      // const contentSizes = [300,320,360,400,440,480,520,560,600,640,680,720,760,800,840,880,920,960,1000,1040,1080,
      //     1120,1160,1200,1240,1280,1320,1360,1400,1440,1480,1520,1560,1600,1640,1680,1720,1760,1800,1840,1880,
      //     1920,1960,2000,2040,2080,2120,2160,2200,2240,2280,2320,2360,2400,2440,2480,2520,2560,2600,2640,2680,2700];
      var contentSizes = [320, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000];
      if (val === '') {
        container.style.maxWidth = '';
        container.classList.forEach(function (item) {
          if (item.indexOf('is-content-') !== -1 && item !== 'is-content-left' && item !== 'is-content-right') {
            container.classList.remove(item);
          }
        });
        container.classList.add('is-content-none');
        return;
      }
      var targetWidth;
      for (var i = 0; i < contentSizes.length; i++) {
        if (container.classList.contains("is-content-".concat(contentSizes[i]))) {
          if (val === '+') {
            if (i + 1 >= contentSizes.length) {
              targetWidth = contentSizes[i];
            } else {
              targetWidth = contentSizes[i + 1];
            }
            break;
          }
          if (val === '-') {
            if (i - 1 < 0) {
              targetWidth = contentSizes[i];
            } else {
              targetWidth = contentSizes[i - 1];
            }
            break;
          }
        }
      }
      if (!targetWidth) {
        var currentWidth = container.offsetWidth;
        // let targetWidth;

        for (var _i = 0; _i < contentSizes.length; _i++) {
          if (contentSizes[_i] <= currentWidth && currentWidth < contentSizes[_i + 1]) {
            if (val === '+') {
              targetWidth = contentSizes[_i + 1];
              break;
            }
          }
          if (contentSizes[_i] < currentWidth && currentWidth <= contentSizes[_i + 1]) {
            if (val === '-') {
              targetWidth = contentSizes[_i];
              break;
            }
          }
        }
      }
      if (!targetWidth) targetWidth = 800;
      container.style.maxWidth = ''; //remove inline style

      container.classList.forEach(function (item) {
        if (item.indexOf('is-content-') !== -1 && item !== 'is-content-left' && item !== 'is-content-right') {
          container.classList.remove(item);
        }
      });
      container.classList.add('is-content-' + targetWidth);
    }
  }, {
    key: "updateContentColor",
    value: function updateContentColor(activeBox, val) {
      if (val == 'light') {
        activeBox.classList.remove('is-dark-text');
        activeBox.classList.add('is-light-text');
      }
      if (val == 'dark') {
        activeBox.classList.remove('is-light-text');
        activeBox.classList.add('is-dark-text');
      }
      if (val == '') {
        activeBox.classList.remove('is-light-text');
        activeBox.classList.remove('is-dark-text');
      }
    }
  }, {
    key: "chooseHeadline",
    value: function chooseHeadline() {
      var list = this.builder.headlineList;
      var randomIndex = Math.floor(Math.random() * list.length);
      return list[randomIndex];
    }
  }, {
    key: "_addBlock",
    value: function _addBlock(activeBox, html, pos) {
      /*
       let bSnippet = false;
      let attr;
      
      if(activeBox.querySelector('.cell-active')) {
           // This is needed before calling addSnippet()
          const builderStuff = this.builder.builderStuff;
          let quickadd = builderStuff.querySelector('.quickadd');
          quickadd.setAttribute('data-mode','row');
          // ----
           if(html!=='') this.builder.addSnippet(html, bSnippet);
          return;
      } 
      */

      var container = activeBox.querySelector('.is-container');
      if (!container) return;
      if (activeBox.classList.contains('is-container')) container = activeBox;
      var row;
      if (activeBox.querySelector('.row-active')) {
        row = activeBox.querySelector('.row-active');
      } else {
        var rows = this.builder.dom.elementChildren(container);
        row = rows[rows.length - 1]; // last row
      }

      if (!row) return;
      var rowElement, cellElement;
      if (this.builder.opts.row === '') {
        rowElement = this.htmlToElement(this.builder.opts.rowFormat);
        var s = this.builder.opts.cellFormat;
        var _pos = s.indexOf('</');
        html = s.substring(0, _pos) + html + s.substring(_pos);

        // go to last deeper level
        var targetrow = this.builder.dom.elementChildren(rowElement);
        while (targetrow.length > 0) {
          targetrow = targetrow[0];
          if (this.builder.dom.elementChildren(targetrow).length > 0) {
            targetrow = this.builder.dom.elementChildren(targetrow);
          } else {
            break;
          }
        }
        targetrow.innerHTML = html;
        cellElement = targetrow.firstChild;
        // if(attr) {
        //     cellElement.setAttribute(attr,'');
        // }
      } else {
        cellElement = document.createElement('div');
        cellElement.classList.add(this.builder.opts.cols[this.builder.opts.cols.length - 1]);
        cellElement.innerHTML = html;

        // if(attr) {
        //     cellElement.setAttribute(attr,'');
        // }

        rowElement = document.createElement('div');
        rowElement.classList.add(this.builder.opts.row);
        rowElement.appendChild(cellElement);
      }
      row.parentNode.insertBefore(rowElement, row);
      if (pos === 'after') this.builder.dom.moveAfter(rowElement, row);
      this.builder.applyBehaviorOn(container);
      cellElement.click();
    }
  }, {
    key: "addBlock",
    value: function addBlock(activeBox, val, pos) {
      var html = '';
      // let bSnippet = true;

      if (val === 'headline') {
        html = "\n            <h1 class=\"font-normal leading-11 size-54\">".concat(this.chooseHeadline(), "</h1>\n            ");
      }
      if (val === 'paragraph') {
        html = "\n            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.\n        Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n        when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>\n            ";
      }
      if (val === 'image') {
        html = "<img src=\"".concat(this.builder.opts.snippetPath, "example.png\" alt=\"\" />");
        if (this.builder.opts.snippetSampleImage) {
          html = "<img src=\"".concat(this.builder.opts.snippetSampleImage, "\" alt=\"\" />");
        }
      }
      if (val === 'space') {
        html = '<div class="spacer height-40"></div>';
      }
      if (val === 'button') {
        html = "\n            <div>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 text-black leading-14 rounded border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Read More</a>\n            </div>\n            ";
      }
      if (val === 'twobuttons') {
        html = "\n            <div>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 text-black leading-14 rounded border-transparent hover:border-transparent font-normal tracking-wide\" style=\"background-color: rgb(240, 240, 240);\">Read More</a>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 border-current hover:border-current font-normal leading-14 rounded tracking-wide\">Get Started</a>\n            </div>\n            ";
      }
      if (val === 'icon') {
        html = "\n            <div class=\"text-center\">\n                <i class=\"icon ion-android-alarm-clock size-80\"></i>\n            </div>\n            ";
      }
      if (val === 'youtube') {
        html = "\n            <div class=\"embed-responsive embed-responsive-16by9\">\n                <iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/P5yHEKqx86U?rel=0\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\"></iframe>\n            </div>\n            ";
      }
      if (val === 'video') {
        html = "<video style=\"width: 100%;\" loop=\"\" autoplay=\"\">\n                <source src=\"".concat(this.builder.opts.snippetPath, "example.mp4\" type=\"video/mp4\"></video>");
        if (this.builder.opts.snippetSampleVideo) {
          html = "<video style=\"width: 100%;\" loop=\"\" autoplay=\"\">\n                    <source src=\"".concat(this.builder.opts.snippetSampleVideo, "\" type=\"video/mp4\"></video>");
        }
      }
      if (val === 'audio') {
        html = "<div style=\"display:flex;width:100%;position:relative;margin:15px 0;background:transparent;\">\n                    <audio controls=\"\" style=\"width:100%\">\n                        <source src=\"".concat(this.builder.opts.snippetPath, "example.mp3\" type=\"audio/mpeg\">\n                        Your browser does not support the audio element.\n                    </audio>\n                </div>");
        if (this.builder.opts.snippetSampleAudio) {
          html = "<div style=\"display:flex;width:100%;position:relative;margin:15px 0;background:transparent;\">\n                        <audio controls=\"\" style=\"width:100%\">\n                            <source src=\"".concat(this.builder.opts.snippetSampleAudio, "\" type=\"audio/mpeg\">\n                            Your browser does not support the audio element.\n                        </audio>\n                </div>");
        }
      }
      if (val === 'map') {
        html = "<div class=\"embed-responsive embed-responsive-16by9\">\n            <iframe width=\"100%\" height=\"400\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\" class=\"mg1\" src=\"https://maps.google.com/maps?q=Melbourne,+Victoria,+Australia&amp;hl=en&amp;sll=-7.981898,112.626504&amp;sspn=0.009084,0.016512&amp;oq=melbourne&amp;hnear=Melbourne+Victoria,+Australia&amp;t=m&amp;z=10&amp;output=embed\"></iframe>\n            </div>";
      }
      if (val === 'social') {
        html = "<div class=\"is-social\" style=\"text-align: center;\">\n                <a href=\"https://twitter.com/\"><i class=\"icon ion-social-twitter\" style=\"margin-right: 1em\"></i></a>\n                <a href=\"https://www.facebook.com/\"><i class=\"icon ion-social-facebook\" style=\"margin-right: 1em\"></i></a>\n                <a href=\"mailto:you@example.com\"><i class=\"icon ion-android-drafts\"></i></a>\n            </div>";
      }
      if (val === 'table') {
        html = "<table class=\"default\" style=\"border-collapse:collapse;width:100%;\">\n                <thead>\n                <tr>\n                    <td style=\"vertical-align:top;\"><br></td>\n                    <td style=\"vertical-align:top;\"><br></td>\n                </tr>\n                </thead>\n                <tr>\n                    <td style=\"vertical-align:top;\"><br></td>\n                    <td style=\"vertical-align:top;\"><br></td>\n                </tr>\n            </table>";
      }
      this._addBlock(activeBox, html, pos);
    }
  }, {
    key: "alignContent",
    value: function alignContent(activeBox, command) {
      var _this2 = this;
      activeBox.classList.remove('is-align-left');
      activeBox.classList.remove('is-align-center');
      activeBox.classList.remove('is-align-right');
      activeBox.classList.remove('is-align-justify');
      if (command === 'left') activeBox.classList.add('is-align-left');
      if (command === 'center') activeBox.classList.add('is-align-center');
      if (command === 'right') activeBox.classList.add('is-align-right');
      if (command === 'justify') activeBox.classList.add('is-align-justify');
      var elms = activeBox.querySelectorAll('.is-builder > div > div, .is-builder > div > div > *');
      elms.forEach(function (elm) {
        if (elm.closest('.is-section-tool') || elm.closest('.is-box-tool') || elm.closest('.is-tool') || elm.closest('.is-rowadd-tool')) return;
        elm.style.textAlign = '';
        elm.classList.remove('left');
        elm.classList.remove('right');
        elm.classList.remove('center');
        elm.classList.remove(_this2.builder.cssClasses.textAlign.left);
        elm.classList.remove(_this2.builder.cssClasses.textAlign.center);
        elm.classList.remove(_this2.builder.cssClasses.textAlign.right);
        elm.classList.remove(_this2.builder.cssClasses.textAlign.justify);
        _this2.builder.dom.doFunction(elm, function (theEl) {
          if (theEl.closest('.is-section-tool') || theEl.closest('.is-box-tool') || theEl.closest('.is-tool') || theEl.closest('.is-rowadd-tool')) return;
          theEl.style.textAlign = '';
          elm.classList.remove('left');
          elm.classList.remove('right');
          elm.classList.remove('center');
          elm.classList.remove(_this2.builder.cssClasses.textAlign.left);
          elm.classList.remove(_this2.builder.cssClasses.textAlign.center);
          elm.classList.remove(_this2.builder.cssClasses.textAlign.right);
          elm.classList.remove(_this2.builder.cssClasses.textAlign.justify);
        }, true);
      });
    }
  }, {
    key: "alignText",
    value: function alignText(element, command) {
      if (this.builder.useCssClasses) {
        element.style.textAlign = '';
        element.classList.remove(this.builder.cssClasses.textAlign.left);
        element.classList.remove(this.builder.cssClasses.textAlign.center);
        element.classList.remove(this.builder.cssClasses.textAlign.right);
        element.classList.remove(this.builder.cssClasses.textAlign.justify);
        if (command === 'left') element.classList.add(this.builder.cssClasses.textAlign.left);
        if (command === 'center') element.classList.add(this.builder.cssClasses.textAlign.center);
        if (command === 'right') element.classList.add(this.builder.cssClasses.textAlign.right);
        if (command === 'justify') element.classList.add(this.builder.cssClasses.textAlign.justify);
      } else {
        element.style.textAlign = command;
      }
    }
  }, {
    key: "increaseLineHeight",
    value: function increaseLineHeight(element, isContainer) {
      var lineHeightClasses = Object.values(this.builder.cssClasses.leading);
      if (isContainer) {
        var classList = this.builder.cssClasses.leading;
        lineHeightClasses = [classList.leading_10, classList.leading_11, classList.leading_12, classList.leading_13, classList.leading_14, 'leading-15', classList.leading_16, classList.leading_17, classList.leading_18, classList.leading_19, 'leading-20'];
      }
      var currentClass = this.getCurrentLineHeightClass(element, isContainer);
      var currentIndex = lineHeightClasses.indexOf(currentClass);
      if (currentIndex !== -1 && currentIndex < lineHeightClasses.length - 1) {
        var newClass = lineHeightClasses[currentIndex + 1];
        element.classList.remove(currentClass);
        element.classList.add(newClass);
      }
    }
  }, {
    key: "decreaseLineHeight",
    value: function decreaseLineHeight(element, isContainer) {
      var lineHeightClasses = Object.values(this.builder.cssClasses.leading);
      if (isContainer) {
        var classList = this.builder.cssClasses.leading;
        lineHeightClasses = [classList.leading_10, classList.leading_11, classList.leading_12, classList.leading_13, classList.leading_14, 'leading-15', classList.leading_16, classList.leading_17, classList.leading_18, classList.leading_19, 'leading-20'];
      }
      var currentClass = this.getCurrentLineHeightClass(element, isContainer);
      var currentIndex = lineHeightClasses.indexOf(currentClass);
      if (currentIndex !== -1 && currentIndex > 0) {
        var newClass = lineHeightClasses[currentIndex - 1];
        element.classList.remove(currentClass);
        element.classList.add(newClass);
      }
    }
  }, {
    key: "getCurrentLineHeightClass",
    value: function getCurrentLineHeightClass(element, isContainer) {
      var classes = element.classList;
      for (var i = 0; i < classes.length; i++) {
        var classValue = classes[i];
        if (classValue.startsWith('leading-')) {
          return classValue;
        }
      }
      var computedStyle = window.getComputedStyle(element);
      var lineHeight = parseFloat(computedStyle.lineHeight);
      var fontSize = parseFloat(computedStyle.fontSize);
      var currentClassName = '';
      lineHeight = (lineHeight / fontSize).toFixed(1);
      var classList = this.builder.cssClasses.leading;
      if (isContainer) {
        if (lineHeight === '1') {
          currentClassName = classList.leading_10;
        } else if (lineHeight === '1.1') {
          currentClassName = classList.leading_11;
        } else if (lineHeight === '1.2') {
          currentClassName = classList.leading_12;
        } else if (lineHeight === '1.3') {
          currentClassName = classList.leading_13;
        } else if (lineHeight === '1.4') {
          currentClassName = classList.leading_14;
        } else if (lineHeight === '1.5') {
          currentClassName = 'leading-15';
        } else if (lineHeight === '1.6') {
          currentClassName = classList.leading_16;
        } else if (lineHeight === '1.7') {
          currentClassName = classList.leading_17;
        } else if (lineHeight === '1.8') {
          currentClassName = classList.leading_18;
        } else if (lineHeight === '1.9') {
          currentClassName = classList.leading_19;
        } else if (lineHeight === '2') {
          currentClassName = classList.leading_20;
        }
      } else {
        if (lineHeight === '0.5') {
          currentClassName = classList.leading_5;
        } else if (lineHeight === '0.6') {
          currentClassName = classList.leading_6;
        } else if (lineHeight === '0.7') {
          currentClassName = classList.leading_7;
        } else if (lineHeight === '0.8') {
          currentClassName = classList.leading_8;
        } else if (lineHeight === '0.9') {
          currentClassName = classList.leading_9;
        } else if (lineHeight === '1') {
          currentClassName = classList.leading_10;
        } else if (lineHeight === '1.1') {
          currentClassName = classList.leading_11;
        } else if (lineHeight === '1.2') {
          currentClassName = classList.leading_12;
        } else if (lineHeight === '1.3') {
          currentClassName = classList.leading_13;
        } else if (lineHeight === '1.4') {
          currentClassName = classList.leading_14;
        } else if (lineHeight === '1.5') {
          currentClassName = classList.leading_15;
        } else if (lineHeight === '1.6') {
          currentClassName = classList.leading_16;
        } else if (lineHeight === '1.7') {
          currentClassName = classList.leading_17;
        } else if (lineHeight === '1.8') {
          currentClassName = classList.leading_18;
        } else if (lineHeight === '1.9') {
          currentClassName = classList.leading_19;
        } else if (lineHeight === '2') {
          currentClassName = classList.leading_20;
        } else if (lineHeight === '2.1') {
          currentClassName = classList.leading_21;
        } else if (lineHeight === '2.2') {
          currentClassName = classList.leading_22;
        } else if (lineHeight === '2.3') {
          currentClassName = classList.leading_23;
        } else if (lineHeight === '2.4') {
          currentClassName = classList.leading_24;
        } else if (lineHeight === '2.5') {
          currentClassName = classList.leading_25;
        } else if (lineHeight === '2.6') {
          currentClassName = classList.leading_26;
        } else if (lineHeight === '2.7') {
          currentClassName = classList.leading_27;
        } else if (lineHeight === '2.8') {
          currentClassName = classList.leading_28;
        } else if (lineHeight === '2.9') {
          currentClassName = classList.leading_29;
        } else if (lineHeight === '3') {
          currentClassName = classList.leading_30;
        }
      }
      if (currentClassName !== '') return currentClassName;
      return classList.leading_14;
    }

    // Font Size Stuff
  }, {
    key: "increaseFontSize",
    value: function increaseFontSize(activeElement, isDefaultSize) {
      var fontSizeClassValues = this.builder.opts.fontSizeClassValues;
      var currentFontSize = this.getCurrentFontSize(activeElement);
      var currentIndex = fontSizeClassValues.indexOf(currentFontSize);
      if (currentIndex < fontSizeClassValues.length - 1) {
        var nextFontSize = fontSizeClassValues[currentIndex + 1];
        var nextSizeClass = "size-".concat(nextFontSize);
        if (isDefaultSize) if (nextSizeClass === 'size-24') return; // max for is-container font size is size-21

        if (this.hasSizeClass(activeElement)) {
          activeElement.classList.remove(this.getSizeClass(activeElement));
        }
        activeElement.classList.add(nextSizeClass);
      }
    }
  }, {
    key: "decreaseFontSize",
    value: function decreaseFontSize(activeElement, isDefaultSize) {
      var fontSizeClassValues = this.builder.opts.fontSizeClassValues;
      var currentFontSize = this.getCurrentFontSize(activeElement);
      var currentIndex = fontSizeClassValues.indexOf(currentFontSize);
      if (currentIndex > 0) {
        var previousFontSize = fontSizeClassValues[currentIndex - 1];
        var previousSizeClass = "size-".concat(previousFontSize);
        if (isDefaultSize) if (previousFontSize === 'size-16') return; // min for is-container font size is size-15

        if (this.hasSizeClass(activeElement)) {
          activeElement.classList.remove(this.getSizeClass(activeElement));
        }
        activeElement.classList.add(previousSizeClass);
      }
    }
  }, {
    key: "clearFontSize",
    value: function clearFontSize(activeElement) {
      activeElement.classList.remove(this.getSizeClass(activeElement));
    }

    // Function to get the current font size dynamically
  }, {
    key: "getCurrentFontSize",
    value: function getCurrentFontSize(activeElement) {
      var fontSizeClassValues = this.builder.opts.fontSizeClassValues;
      if (this.hasSizeClass(activeElement)) {
        var sizeClass = this.getSizeClass(activeElement);
        var fontSizeString = sizeClass.split('-')[1];
        return Number(fontSizeString);
      } else {
        var computedStyle = window.getComputedStyle(activeElement);
        var _fontSizeString = computedStyle.getPropertyValue('font-size');
        var currentFontSize = Number(_fontSizeString.match(/\d+/)[0]);

        // Check if the font size exists in the array
        if (fontSizeClassValues.includes(currentFontSize)) {
          return currentFontSize;
        } else {
          // Find the closest font size in the array
          var closestFontSize = this.findClosestFontSize(currentFontSize);
          return closestFontSize;
        }
      }
    }

    // Function to check if paragraph has 'size-' class
  }, {
    key: "hasSizeClass",
    value: function hasSizeClass(element) {
      if (Array.from(element.classList).some(function (value) {
        return value.startsWith('size-');
      })) {
        return true;
      }

      // let currentElement = element.parentElement;

      // while (currentElement) {
      //     if (Array.from(currentElement.classList).some((value) => value.startsWith('size-'))) {
      //         return true;
      //     }
      //     currentElement = currentElement.parentElement;
      // }
      return false;
    }

    // Function to get the 'size-' class if present
  }, {
    key: "getSizeClass",
    value: function getSizeClass(activeElement) {
      return Array.from(activeElement.classList).find(function (value) {
        return value.startsWith('size-');
      });
    }
    // getSizeClass(activeElement) {
    //     let sizeClass = Array.from(activeElement.classList).find((value) => value.startsWith('size-'));

    //     if (!sizeClass) {
    //         let parentElement = activeElement.parentElement;

    //         while (parentElement) {
    //             sizeClass = Array.from(parentElement.classList).find((value) => value.startsWith('size-'));
    //             if (sizeClass) {
    //                 break;
    //             }
    //             parentElement = parentElement.parentElement;
    //         }
    //     }

    //     return sizeClass;
    // }

    // Function to find the closest font size in the array
  }, {
    key: "findClosestFontSize",
    value: function findClosestFontSize(currentFontSize) {
      var fontSizeClassValues = this.builder.opts.fontSizeClassValues;
      var closestFontSize = null;

      // Find the closest font size smaller than currentFontSize
      for (var i = fontSizeClassValues.length - 1; i >= 0; i--) {
        if (fontSizeClassValues[i] < currentFontSize) {
          closestFontSize = fontSizeClassValues[i];
          break;
        }
      }

      // If no smaller font size found, find the closest font size larger than currentFontSize
      if (closestFontSize === null) {
        for (var _i2 = 0; _i2 < fontSizeClassValues.length; _i2++) {
          if (fontSizeClassValues[_i2] > currentFontSize) {
            closestFontSize = fontSizeClassValues[_i2];
            break;
          }
        }
      }

      // If no closest font size found, use the first font size in the array
      if (closestFontSize === null) {
        closestFontSize = fontSizeClassValues[0];
      }
      return closestFontSize;
    }

    // Space Stuff

    // Increase the height of an element
  }, {
    key: "increaseElementHeight",
    value: function increaseElementHeight(element) {
      var currentHeightClass = this.getCurrentHeightClass(element);
      var nextHeightClass = this.getNextHeightClass(currentHeightClass, true);
      if (nextHeightClass) {
        element.classList.remove(currentHeightClass);
        element.classList.add(nextHeightClass);
      }
    }

    // Decrease the height of an element
  }, {
    key: "decreaseElementHeight",
    value: function decreaseElementHeight(element) {
      var currentHeightClass = this.getCurrentHeightClass(element);
      var prevHeightClass = this.getNextHeightClass(currentHeightClass, false);
      if (prevHeightClass) {
        element.classList.remove(currentHeightClass);
        element.classList.add(prevHeightClass);
      }
    }

    // Get the current height class of an element
  }, {
    key: "getCurrentHeightClass",
    value: function getCurrentHeightClass(element) {
      var classes = Array.from(element.classList);
      return classes.find(function (className) {
        return className.startsWith('height-');
      });
    }

    // Get the next height class based on the current height class and direction
  }, {
    key: "getNextHeightClass",
    value: function getNextHeightClass(currentHeightClass, increase) {
      var heightClasses = ['height-20', 'height-40', 'height-60', 'height-80', 'height-100', 'height-120', 'height-140', 'height-160', 'height-180', 'height-200', 'height-220', 'height-240', 'height-260', 'height-280', 'height-300'];
      var currentIndex = heightClasses.indexOf(currentHeightClass);
      var nextIndex = increase ? currentIndex + 1 : currentIndex - 1;
      if (nextIndex >= 0 && nextIndex < heightClasses.length) {
        return heightClasses[nextIndex];
      }
      return null;
    }
  }, {
    key: "moveBlockContent",
    value: function moveBlockContent(target) {
      var cell = this.builder.activeCol;
      if (!cell) return false;
      if (!(target === 'top' || target === 'bottom' || target === 'left' || target === 'right' || target === 'topleft' || target === 'topcenter' || target === 'topright' || target === 'bottomleft' || target === 'bottomcenter' || target === 'bottomright' || target === 'center')) return;
      this.builder.saveForUndo();
      var dom = this.builder.dom;
      var classes = this.builder.cssClasses.display;
      dom.addCssClass(cell, classes.flex, classes);
      classes = this.builder.cssClasses.flexDirection;
      dom.addCssClass(cell, classes.column, classes);
      if (target === 'top') {
        var _classes = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes.start, _classes);
        _classes = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes.center, _classes);
      } else if (target === 'bottom') {
        var _classes2 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes2.end, _classes2);
        _classes2 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes2.center, _classes2);
      } else if (target === 'left') {
        var _classes3 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes3.center, _classes3);
        _classes3 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes3.start, _classes3);
      } else if (target === 'right') {
        var _classes4 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes4.center, _classes4);
        _classes4 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes4.end, _classes4);
      } else if (target === 'topleft') {
        var _classes5 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes5.start, _classes5);
        _classes5 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes5.start, _classes5);
      } else if (target === 'topcenter') {
        var _classes6 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes6.start, _classes6);
        _classes6 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes6.center, _classes6);
      } else if (target === 'topright') {
        var _classes7 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes7.start, _classes7);
        _classes7 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes7.end, _classes7);
      } else if (target === 'bottomleft') {
        var _classes8 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes8.end, _classes8);
        _classes8 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes8.start, _classes8);
      } else if (target === 'bottomcenter') {
        var _classes9 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes9.end, _classes9);
        _classes9 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes9.center, _classes9);
      } else if (target === 'bottomright') {
        var _classes10 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes10.end, _classes10);
        _classes10 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes10.end, _classes10);
      } else if (target === 'center') {
        var _classes11 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes11.center, _classes11);
        _classes11 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes11.center, _classes11);
      } else {
        var _classes12 = this.builder.cssClasses.justifyContent;
        dom.addCssClass(cell, _classes12.center, _classes12);
        _classes12 = this.builder.cssClasses.alignItems;
        dom.addCssClass(cell, _classes12.center, _classes12);
      }
      cell.style.justifyContent = '';
      cell.style.alignItems = '';
      this.builder.onChange();
    }
  }, {
    key: "elementContext",
    value: function elementContext(context, args) {
      if (args.add_headline) {
        var info = "- To add a headline or title, use this class: 'font-normal leading-11 size-64':\n<h1 class=\"font-normal leading-11 size-64\">Headline Text Here</h1>\n\n";
        context = context + '\n' + info;
      }
      if (args.add_paragraph) {
        var _info = "- To add a paragraph (long or short), just add:\n<p>Paragraph here</p>\n\n";
        context = context + '\n' + _info;
      }
      if (args.add_space) {
        var _info2 = "- To add a space, you must add 'div.spacer' element:\n\n<div class=\"spacer height-40\"></div\n\n";
        context = context + '\n' + _info2;
      }
      if (args.adjust_space) {
        var _info3 = "- To increase or decrease a space, use one of these classes:\n    - height-40\n    - height-60\n    - height-80\n    - height-100\n    - height-120\n    - height-140\n    - height-160\n    - height-180\n    - height-200\n\n";
        context = context + '\n' + _info3;
      }
      if (args.add_button) {
        var _info4 = "- To add a buttons, use the example below as a template. Wrap the button in a <div> element.\n\nButton Example:\n\n    <div>\n        <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 text-black leading-relaxed rounded-full border-transparent hover:border-transparent font-normal tracking-wide\" title=\"\" style=\"background-color: rgb(240, 240, 240);\">Our Works</a>\n        <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 border-current hover:border-current font-normal leading-relaxed rounded-full tracking-wide\" title=\"\">Get in Touch</a>\n    </div>\n\n";
        context = context + '\n' + _info4;
      }
      if (args.add_youtube) {
        // Choose random youtube
        var videoList = this.builder.media.youtube_videos;
        var videoUrl = this.chooseMedia(videoList);
        var _info5 = "- To embed a YouTube or Vimeo video, wrap the <iframe> element in a <div> element with the classes 'embed-responsive' and 'embed-responsive-16by9' and add add it inside a column (Youtube and Vimeo links are case sensitive):\n<div class=\"embed-responsive embed-responsive-16by9\">\n<iframe width=\"560\" height=\"315\" src=\"".concat(videoUrl, "\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\"></iframe>\n</div>\n");
        context = context + '\n' + _info5;
      }
      if (args.add_video) {
        // Choose random video
        var _videoList = this.builder.media.videos;
        var _videoUrl = this.chooseMedia(_videoList);
        var _info6 = "- To embed a video (MP4), use the <video> element, specify the source using the <source> element and add it inside a column:\n<video style=\"width: 100%;\" loop=\"\" autoplay=\"\">\n<source src=\"".concat(_videoUrl, "\" type=\"video/mp4\">\n</video>\n");
        context = context + '\n' + _info6;
      }
      if (args.add_audio) {
        // Choose random audio
        var audioList = this.builder.media.audios;
        var audioUrl = this.chooseMedia(audioList);
        var _info7 = "- To embed an audio (MP3), wrap the <audio> element in a <div> with the default style and class as shown below and add it inside a column:\n<div style=\"width: 100%; position: relative; margin: 15px 0px; background: transparent;\" class=\"flex\">\n<audio controls=\"\" style=\"width:100%\">\n<source src=\"".concat(audioUrl, "\" type=\"audio/mpeg\">Your browser does not support the audio element.\n</audio>\n</div>\n");
        context = context + '\n' + _info7;
      }
      if (args.add_map) {
        var _info8 = "- To embed a google map, wrap the <iframe> element in a <div> element with the classes 'embed-responsive' and 'embed-responsive-16by9' and add add it inside a column:\n<div class=\"embed-responsive embed-responsive-16by9\">\n<iframe width=\"100%\" height=\"400\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\" class=\"mg1\" src=\"https://maps.google.com/maps?q=Melbourne,+Victoria,+Australia&amp;hl=en&amp;sll=-7.981898,112.626504&amp;sspn=0.009084,0.016512&amp;oq=melbourne&amp;hnear=Melbourne+Victoria,+Australia&amp;t=m&amp;z=10&amp;output=embed\"></iframe>\n</div>\n";
        context = context + '\n' + _info8;
      }
      if (args.add_image) {
        // to differentiate from bg image
        var _info9 = "- To add an image, just add <img> element inside 'div.columns' element:\n            \n<img src=\"{{IMAGEURL}}\">\n\n";
        context = context + '\n' + _info9;
      }
      if (args.align_text) {
        var _info10 = "- To align text or element, use one of these classes: 'text-left', text-center' or 'texr-right'.\n\n";
        context = context + '\n' + _info10;
      }
      if (args.line_height) {
        var _info11 = "- To increase or decrease the line height of an individual text/element, apply this class on the requested element:\n    \n    - leading-08\n    - leading-09\n    - leading-none\n    - leading-11\n    - leading-12\n    - leading-13\n    - leading-14\n    - leading-15\n    - leading-16\n    - leading-17\n    - leading-18\n    - leading-19\n    - leading-20\n\n";
        context = context + '\n' + _info11;
      }
      if (args.font_size) {
        var _info12 = "- To increase or decrease the font size, apply this class on the requested element:\n    \n    - size-12\n    - size-13\n    - size-14\n    - size-15\n    - size-16\n    - size-17\n    - size-18\n    - size-19\n    - size-20\n    - size-21\n    - size-24\n    - size-28\n    - size-32\n    - size-35\n    - size-38\n    - size-42\n    - size-46\n    - size-48\n    - size-50\n    - size-54\n    - size-60\n    - size-64\n    - size-68\n    - size-72\n    - size-76\n    - size-80\n    - size-84\n    - size-88\n    - size-92\n    - size-96\n    - size-100\n    - size-104\n    - size-108\n    - size-112\n    - size-116\n    - size-120\n    - size-124\n    - size-128\n    - size-132\n    - size-136\n    - size-140\n    - size-144\n    - size-148\n    - size-152\n    - size-156\n    - size-160\n\n";
        context = context + '\n' + _info12;
      }
      return context;
    }
  }, {
    key: "addElementContext",
    value: function addElementContext(context, args) {
      /*
      Check for elements: space, button, youtube, video, audio, map, code.
      Then add relevant context.
      
      Prompt Examples:
      - Embed a youtube video after the paragraph in a separate block. Also, add a space.
      - Add a google map showing mount Everest after the paragraph in separate block. Add a space.
      - Embed a video after the paragraph in a separate block. This is the video link: 
          http://media.w3.org/2010/05/sintel/trailer.mp4
          Also, add a space.
      - Embed an audio after the paragraph in a separate block. This is the audio link: 
          https://www.w3schools.com/html/horse.mp3
          Also, add a space.
      - Add a Google Map showing Mount Everest in a very close view. Add it after the paragraph in a separate block. Also, add a space.
      */

      //TODO: review
      // let info = '- Any element must be placed inside a column, and a column should be placed inside a row.';
      // context = context+'\n'+info;

      if (args.add_headline) {
        var info = "- To add a headline:\n(1) Add a new row and columns separately from the other rows.\n(2) Add a space between the headline and the other content.\n(3) Use the example below as a template. \n\nExample:\n\n<div class=\"row\">\n    <div class=\"column\">\n        <h1 class=\"font-normal leading-11 size-64\">Headline Text Here</h1>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n</div>\n";
        context = context + '\n' + info;
      }
      if (args.add_space) {
        var _info13 = "- To add a space, you must add 'div.spacer' element inside a column:\n\n<div class=\"spacer height-60\"></div\n\nIf requested to increase or decrease space, use one of these classes:\n    - height-40\n    - height-60\n    - height-80\n    - height-100\n    - height-120\n    - height-140\n    - height-160\n    - height-180\n    - height-200\n\n";
        context = context + '\n' + _info13;
      }
      if (args.add_button) {
        //             let info = `- To add buttons, you must wrap the buttons in a 'div' element add add it inside a column. Use these buttons as an example and use same style, classes and attributes:
        // <div>
        // <a href="#" role="button" class="transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 text-black leading-relaxed rounded-full border-transparent hover:border-transparent font-normal tracking-wide" title="" style="background-color: rgb(240, 240, 240);">Our Works</a>
        // <a href="#" role="button" class="transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 border-current hover:border-current font-normal leading-relaxed rounded-full tracking-wide" title="">Get in Touch</a>
        // </div>`;
        var _info14 = "- To add a buttons, follow these steps:\n(1) Create the necessary rows and columns.\n(2) Use the example below as a template.\n\nButton Example:\n\n<div class=\"row\">\n    <div class=\"column\">\n        <div>\n            <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 text-black leading-relaxed rounded-full border-transparent hover:border-transparent font-normal tracking-wide\" title=\"\" style=\"background-color: rgb(240, 240, 240);\">Our Works</a>\n            <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-18 px-9 border-current hover:border-current font-normal leading-relaxed rounded-full tracking-wide\" title=\"\">Get in Touch</a>\n        </div>\n    </div>\n</div>\n";
        context = context + '\n' + _info14;
      }
      if (args.add_youtube) {
        // Choose random youtube
        var videoList = this.builder.media.youtube_videos;
        var videoUrl = this.chooseMedia(videoList);
        var _info15 = "- To embed a YouTube or Vimeo video, wrap the <iframe> element in a <div> element with the classes 'embed-responsive' and 'embed-responsive-16by9' and add add it inside a column (Youtube and Vimeo links are case sensitive):\n<div class=\"embed-responsive embed-responsive-16by9\">\n<iframe width=\"560\" height=\"315\" src=\"".concat(videoUrl, "\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\"></iframe>\n</div>\n");
        context = context + '\n' + _info15;
      }
      if (args.add_video) {
        // Choose random video
        var _videoList2 = this.builder.media.videos;
        var _videoUrl2 = this.chooseMedia(_videoList2);
        var _info16 = "- To embed a video (MP4), use the <video> element, specify the source using the <source> element and add it inside a column:\n<video style=\"width: 100%;\" loop=\"\" autoplay=\"\">\n<source src=\"".concat(_videoUrl2, "\" type=\"video/mp4\">\n</video>\n");
        context = context + '\n' + _info16;
      }
      if (args.add_audio) {
        // Choose random audio
        var audioList = this.builder.media.audios;
        var audioUrl = this.chooseMedia(audioList);
        var _info17 = "- To embed an audio (MP3), wrap the <audio> element in a <div> with the default style and class as shown below and add it inside a column:\n<div style=\"width: 100%; position: relative; margin: 15px 0px; background: transparent;\" class=\"flex\">\n<audio controls=\"\" style=\"width:100%\">\n<source src=\"".concat(audioUrl, "\" type=\"audio/mpeg\">Your browser does not support the audio element.\n</audio>\n</div>\n");
        context = context + '\n' + _info17;
      }
      if (args.add_map) {
        var _info18 = "- To embed a google map, wrap the <iframe> element in a <div> element with the classes 'embed-responsive' and 'embed-responsive-16by9' and add add it inside a column:\n<div class=\"embed-responsive embed-responsive-16by9\">\n<iframe width=\"100%\" height=\"400\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\" class=\"mg1\" src=\"https://maps.google.com/maps?q=Melbourne,+Victoria,+Australia&amp;hl=en&amp;sll=-7.981898,112.626504&amp;sspn=0.009084,0.016512&amp;oq=melbourne&amp;hnear=Melbourne+Victoria,+Australia&amp;t=m&amp;z=10&amp;output=embed\"></iframe>\n</div>\n";
        context = context + '\n' + _info18;
      }

      // Replace {{CUSTOMCODE}}
      if (args.add_code) {
        var _info19 = "- To add a custom code, add a row and column with attributes 'data-noedit' and 'data-html', and place the custom code between <!--CODESTART--> and <!--CODEEND--> inside the column:\n<div class=\"row\">\n<div class=\"column\" data-noedit data-html>\n<!--CODESTART-->\nCustom Code here\n<!--CODEEND-->\n</div>\n</div>\n\n- Note that the column must be placed inside a row within 'div.is-container' element.\n\n";
        context = context + '\n' + _info19;
      }
      if (args.add_image === 'image') {
        // to differentiate from bg image
        if (!context.includes('{{IMAGEURL}}')) {
          var _info20 = "- To add an image, follow these steps:\n(1) Create the necessary rows and column, or use the current column.\n(2) Add <img> element inside the column.\n(3) Use the example below as a template.\n(4) Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n\nImage Example:\n\n<div class=\"row\">\n    <div class=\"column\">\n        <img src=\"{{IMAGEURL}}\" alt=\"\">\n    </div>\n</div>\n                \n- Important: for image, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n";

          // Choose random image
          var gallery = this.builder.media.images;
          var imageList = gallery.square;
          var imageUrl = this.chooseMedia(imageList);
          _info20 = _info20.replaceAll('{{_IMAGEURL}}', imageUrl);
          context = context + '\n' + _info20;
        }
      }
      if (args.change_section_height) {
        var _info21 = "- To specify section height, use one of these classes on 'div.is-section' element:\n    - is-section-10\n    - is-section-15\n    - is-section-20\n    - is-section-25\n    - is-section-30\n    - is-section-40\n    - is-section-50\n    - is-section-60\n    - is-section-70\n    - is-section-75\n    - is-section-80\n    - is-section-85\n    - is-section-90\n    - is-section-100 (section height 100%)\n    - is-section-auto (Autofit content)\n\n";
        context = context + '\n' + _info21;
      }
      if (args.content_width) {
        var _info22 = "- To increase or decrease content/container width, use one of these classes on 'div.is-container' element:\n\n    - is-content-600\n    - is-content-700\n    - is-content-800\n    - is-content-900\n    - is-content-1000\n    - is-content-1100\n    - is-content-1200\n    - is-content-1300\n    - is-content-1400\n    - is-content-1500\n    - is-content-1600\n    - is-content-1800\n    - is-content-none (unset/full width)\n\n";
        context = context + '\n' + _info22;
      }
      if (args.section_background && args.section_background === 'image') {
        var _info23 = "- Background image must be added in 'div.is-overlay-bg' element inside 'div.is-overlay' element.\n\nExample:\n\n<div class=\"is-overlay\">\n    <div class=\"is-overlay-bg\" style=\"background-image: url('path/to/image.jpg'); background-position: 50% 60%;\"></div>\n</div>\n           \n";
        context = context + '\n' + _info23;
      }
      if (args.section_background && args.section_background === 'slider') {
        var _info24 = "- Background slider must be added in 'div.is-overlay-content' element inside 'div.is-overlay' element.\n\nExample:\n\n<div class=\"is-overlay\">\n    <div class=\"is-overlay-content\"></div>\n</div>\n\n";
        context = context + '\n' + _info24;
      }
      if (args.section_background && args.section_background === 'video') {
        var _info25 = "- Background video must be added in 'div.is-overlay-content' element inside 'div.is-overlay' element.\n\nExample:\n\n<div class=\"is-overlay\">\n    <div class=\"is-overlay-content\"></div>\n</div>\n\n";
        context = context + '\n' + _info25;
      }
      if (args.align_individual_text) {
        var _info26 = "- To align a certain text (eg. align the headline, align the paragraph, etc), use 'text-left', text-center' or 'texr-right' class on the headline or paragraph as requested.\n\n";
        context = context + '\n' + _info26;
      }
      if (args.align_whole_content && !args.align_individual_text) {
        var _info27 = "- To align the whole content, follow these steps:\n    (1) use 'is-align-left', 'is-align-center' or 'is-align-right' on the 'div.is-container' element.\n    (2) Remove these classes: 'text-left', text-center' or 'texr-right' on every elements.\n\n";
        context = context + '\n' + _info27;
      }

      /* These are related to style change requests */
      /*
      if(args.change_content_dark) {
          let info = `- To change the text/content color to dark/black, add 'is-dark-text' class into the 'div.is-box' element.
      `;
           context = context+'\n'+info;
      }
       if(args.change_content_light) {
          let info = `- To change the text/content color to light/white, add 'is-light-text' class into the 'div.is-box' element.
      `;
           context = context+'\n'+info;
      }
      */

      if (args.line_height_paragraph) {
        var _info28 = "- To increase or decrease the line height of paragraphs, use one of these classes on the 'div.is-container' element:\n\n    - leading-none\n    - leading-11\n    - leading-12\n    - leading-13\n    - leading-14\n    - leading-15\n    - leading-16\n    - leading-17\n    - leading-18\n    - leading-19\n    - leading-20\n\nDo not apply this on any other element except the 'div.is-container' element.\n\n";
        context = context + '\n' + _info28;
      }
      if (args.line_height_individual_text && !args.line_height_paragraph) {
        var _info29 = "- To increase or decrease the line height of an individual text/element, apply this class on the requested element:\n    \n    - leading-08\n    - leading-09\n    - leading-none\n    - leading-11\n    - leading-12\n    - leading-13\n    - leading-14\n    - leading-15\n    - leading-16\n    - leading-17\n    - leading-18\n    - leading-19\n    - leading-20\n\nImportant: Do not change the 'div.is-container' element!\n\n";
        context = context + '\n' + _info29;
      }
      if (args.font_size_paragraph) {
        var _info30 = "- To increase or decrease the font size of the paragraphs, use one of these classes on the 'div.is-container' element:\n    \n    - size-16\n    - size-17\n    - size-18\n    - size-19\n    - size-20\n    - size-21\n\nDo not apply this on any other element except the 'div.is-container' element.\n\n";
        context = context + '\n' + _info30;
      }
      if (args.font_size_individual_text && !args.font_size_paragraph) {
        var _info31 = "- To increase or decrease the font size of an individual text/element, apply this class on the requested element:\n    \n    - size-12\n    - size-13\n    - size-14\n    - size-15\n    - size-16\n    - size-17\n    - size-18\n    - size-19\n    - size-20\n    - size-21\n    - size-24\n    - size-28\n    - size-32\n    - size-35\n    - size-38\n    - size-42\n    - size-46\n    - size-48\n    - size-50\n    - size-54\n    - size-60\n    - size-64\n    - size-68\n    - size-72\n    - size-76\n    - size-80\n    - size-84\n    - size-88\n    - size-92\n    - size-96\n    - size-100\n    - size-104\n    - size-108\n    - size-112\n    - size-116\n    - size-120\n    - size-124\n    - size-128\n    - size-132\n    - size-136\n    - size-140\n    - size-144\n    - size-148\n    - size-152\n    - size-156\n    - size-160\n\nImportant: Do not change the 'div.is-container' element!\n\n";
        context = context + '\n' + _info31;
      }
      return context;
    }
  }, {
    key: "chooseMedia",
    value: function chooseMedia(mediaList) {
      var randomIndex;
      if (this.builder.currentMedia) {
        do {
          randomIndex = Math.floor(Math.random() * mediaList.length);
        } while (mediaList[randomIndex] === this.builder.currentMedia);
      } else {
        randomIndex = Math.floor(Math.random() * mediaList.length);
      }
      var newMedia = mediaList[randomIndex];
      this.builder.currentMedia = newMedia;
      return this.builder.mediaPath + newMedia;
    }
  }]);
  return Lib;
}();
/* harmony default export */ const lib = (Lib);
;// CONCATENATED MODULE: ./src/contentbuilder/dictation.js
function dictation_typeof(obj) { "@babel/helpers - typeof"; return dictation_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, dictation_typeof(obj); }
function dictation_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function dictation_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { dictation_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { dictation_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = dictation_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function dictation_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return dictation_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return dictation_arrayLikeToArray(o, minLen); }
function dictation_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }
function dictation_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function dictation_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, dictation_toPropertyKey(descriptor.key), descriptor); } }
function dictation_createClass(Constructor, protoProps, staticProps) { if (protoProps) dictation_defineProperties(Constructor.prototype, protoProps); if (staticProps) dictation_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function dictation_toPropertyKey(arg) { var key = dictation_toPrimitive(arg, "string"); return dictation_typeof(key) === "symbol" ? key : String(key); }
function dictation_toPrimitive(input, hint) { if (dictation_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (dictation_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

// import RecordRTC  from 'recordrtc';
// import Recorder from 'opus-recorder'; // Using Recorder
var dictation_dom = new Dom();
var Dictation = /*#__PURE__*/function () {
  function Dictation() {
    var _this = this;
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var builder = arguments.length > 1 ? arguments[1] : undefined;
    dictation_classCallCheck(this, Dictation);
    var defaults = {
      send: function send() {},
      abort: function abort() {}
    };
    this.opts = Object.assign(this, defaults, opts);
    this.builder = builder;
    var util = this.builder.util;
    this.util = util;
    var builderStuff = this.builder.builderStuff;
    this.builderStuff = builderStuff;
    if (localStorage.getItem('_mic') === null) {
      localStorage.setItem('_mic', '0'); // make mic disable by default
    }

    this.builder.isInProgress = false;
    var html = "\n        <style>\n            #_cbhtml .is-modal.page-command {\n                width: 25vw;\n                min-width: 500px;\n                max-width: 600px;\n                height: 230px; \n                top: auto; \n                bottom: 30px; \n                left: auto; \n                right: 30px; \n                z-index: 10005;\n                font-size: 12px;\n                border-radius: 6px;\n                box-shadow: 5px 9px 14px 1px rgb(0 0 0 / 8%);\n            }\n            #_cbhtml .is-modal.page-command textarea {\n                border:none;border-top: rgb(133 133 133 / 14%) 1px solid;resize:none;width:100%;\n                height:170px;outline:none;background:transparent;line-height: 1.2;\n                font-family: sans-serif;font-weight: 300;font-size: 17px;padding-top:12px;\n            }\n            .page-command-overlay {\n                position: fixed;\n                background: rgb(148 148 148 / 22%);\n                display: none;\n                z-index: 10004;\n                justify-content: center;\n                align-items:center;\n                top:0;left:0;right:0;bottom:0;\n            }\n            #_cbhtml .div-assistant-mode button {\n                padding: 0 17px;height:26px;border-radius:20px;box-shadow:none;\n            }\n            #_cbhtml .div-assistant-mode button[disabled] {\n                pointer-events: none;\n                opacity: 0.5;\n                background: transparent;\n            }\n            /*\n            .is-modal.commandconfig, \n            #_cbhtml .is-modal.commandconfig label {\n                font-size: 14px;\n            }\n            */\n            .is-modal.commandconfig ul {\n                margin: 0;\n                padding: 0 0 0 16px;\n            }\n            .is-modal.commandconfig ul li {\n                font-size: inherit;\n                line-height: 1.2;\n            }\n            .is-modal.commandlist {\n                z-index: 10005 !important\n            }\n            .is-modal.commandlist .is-modal-content {\n                max-width:calc(100% - 150px);\n                height:calc(100% - 150px);\n                padding:0 !important;\n            }\n            .is-modal.commandlist .is-modal-close {\n                position: absolute !important;\n                top: 5px;\n                right: 15px;\n                box-shadow: none !important;\n            }\n            .is-modal.commandlist .is-modal-close {\n                background: transparent !important;\n            }\n            .is-modal.commandlist .is-modal-close svg {\n                width:50px;height:50px;\n            }\n            .is-modal.commandlist .is-modal-content > div {\n                display: flex;\n                flex-flow: wrap;\n                align-items: flex-start;\n                /*align-items: inherits;*/\n                justify-content: flex-start;\n                padding: 2.2rem;\n                box-sizing: border-box;\n                overflow-y: auto;\n                overflow-x: hidden;\n                width: 100%;\n                height: 100%;\n            }\n            .is-modal.commandlist .is-modal-content > div > h2 {\n                display: block;\n                width: 100%;\n                flex: none;\n                font-family: \"Open Sans\", sans-serif;\n                font-weight: 300;\n                margin-bottom: 10px;\n                font-size: 28px;\n            }\n            .is-modal.commandlist .is-modal-content > div > p {\n                display: block;\n                width: 100%;\n                flex: none;\n                font-family: \"Open Sans\", sans-serif;\n                font-weight: 300;\n                font-size: 17px !important;\n                margin: 0 0 30px;\n            }\n            .is-modal.commandlist .is-modal-content > div > div {\n                margin-right: 2.2rem;\n                margin-bottom: 2.2rem;\n                display: flex;\n                flex: none;\n                width: 350px;\n                height: auto;\n                flex-direction: column;\n                justify-content: space-between;\n                border-radius: 0.25rem;\n                border: 1px solid rgb(156 163 175/.75);\n                padding: 1.5rem 2rem;\n                box-sizing: border-box;\n                letter-spacing: .025em;\n                box-shadow: 5px 5px 0px rgb(0 0 0 / 3%);\n                font-size: 19px;\n                font-weight: 300;\n                font-family: sans-serif;\n                line-height: 1.3;\n                cursor:pointer;\n                transition: all 0.3s ease;\n            }\n            .is-modal.commandlist .is-modal-content > div > div:hover {\n                background: rgba(0, 0, 0, 0.03);\n            }\n            .dark .is-modal.commandlist .is-modal-content > div > div:hover {\n                background: rgba(255, 255, 255, 0.05);\n            }\n\n            .spinner {\n                -webkit-animation: rotator 1.4s linear infinite;\n                        animation: rotator 1.4s linear infinite;\n            }\n            @-webkit-keyframes rotator {\n                0% {\n                    transform: rotate(0deg);\n                }\n                100% {\n                    transform: rotate(270deg);\n                }\n            }\n            @keyframes rotator {\n                0% {\n                    transform: rotate(0deg);\n                }\n                100% {\n                    transform: rotate(270deg);\n                }\n            }\n            .path {\n                stroke: #232323; /* #b7b7b7; */\n                stroke-dasharray: 187;\n                stroke-dashoffset: 0;\n                transform-origin: center;\n                -webkit-animation: dash 1.4s ease-in-out infinite;\n                        animation: dash 1.4s ease-in-out infinite;\n            }\n            @-webkit-keyframes dash {\n                0% {\n                    stroke-dashoffset: 187;\n                }\n                50% {\n                    stroke-dashoffset: 46.75;\n                    transform: rotate(135deg);\n                }\n                100% {\n                    stroke-dashoffset: 187;\n                    transform: rotate(450deg);\n                }\n            }\n            @keyframes dash {\n                0% {\n                    stroke-dashoffset: 187;\n                }\n                50% {\n                    stroke-dashoffset: 46.75;\n                    transform: rotate(135deg);\n                }\n                100% {\n                    stroke-dashoffset: 187;\n                    transform: rotate(450deg);\n                }\n            }\n            .inp-command::placeholder {\n                color: #aaa;\n            }\n\n            .label-chk-autosend-command,\n            .label-input-autosend-command {\n                display: none !important;\n            }\n        </style>\n        <div class=\"is-modal ai-disclaimer\" style=\"z-index:10005\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"max-width:450px;padding:55px 40px 35px;font-size:16px;line-height:1.4;letter-spacing: 1px;\">\n                <div class=\"is-modal-bar is-draggable\">\n                    ".concat(util.out('AI-Powered Features'), "\n                    <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">&#10005;</button>\n                </div>\n                ").concat(util.out('AI-Disclaimer', this.builder.disclaimerAI), "\n                <div style=\"text-align:right;margin-top:20px;\">\n                    <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\" style=\"width:100%;text-transform: uppercase;\n                    font-size: 14px;\">").concat(util.out('Ok'), "</button>\n                </div>\n            </div>\n        </div>\n        <div class=\"is-overlay page-command-overlay\">\n            <svg class=\"spinner\" width=\"40px\" height=\"40px\" viewBox=\"0 0 66 66\" xmlns=\"http://www.w3.org/2000/svg\">\n                <circle class=\"path\" fill=\"none\" stroke-width=\"6\" stroke-linecap=\"round\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n            </svg>\n        </div>\n        <div class=\"is-modal is-modal-content page-command\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\" style=\"").concat(this.builder.AIModalStyle, "\">\n            <div class=\"is-modal-bar is-draggable\" draggable=\"\"> \n                <span style=\"display: flex;\n                justify-content: center;\n                align-items: center;\">\n                    ").concat(util.out('AI Assistant'), "</span>\n    \n                <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">\n                    <svg class=\"is-icon-flex\"style=\"width:22px;height:22px\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg>\n                </button>\n            </div>\n            <div style=\"display:flex;flex-direction:column;justify-content:space-between;position:absolute;box-sizing:border-box;top:0;left:0;width:100%;height:100%;border-top:transparent 35px solid;overflow-y:hidden;overflow-x:auto;\">\n                <div style=\"display:flex;align-items:center;justify-content:center;padding: 2px 13px 10px;\">\n                    <div class=\"div-assistant-mode\" style=\"display:flex;align-items: center;\">\n                        <button class=\"scope-section on\" title=\"").concat(util.out('General'), "\" data-value=\"general\" style=\"margin-right:5px\">").concat(util.out('General'), "</button> \n                        <button class=\"scope-others\" title=\"").concat(util.out('Ask Questions'), "\" data-value=\"others\">").concat(util.out('Ask Questions'), "</button>\n                        <button class=\"scope-block\" title=\"").concat(util.out('Edit Selected Text'), "\" data-value=\"block\" style=\"\">").concat(util.out('Edit Selected Text'), "</button>\n                        <button class=\"scope-image\" title=\"").concat(util.out('Image'), "\" data-value=\"image\" style=\"display:none;margin-right:5px\">").concat(util.out('Image'), "</button> \n                    </div>\n                </div>\n                <textarea class=\"inp-command\" id=\"__inp_command\"></textarea>\n                <div style=\"display:flex;\">\n                    <button title=\"").concat(util.out('Settings'), "\" class=\"cmd-command-config classic-secondary\" style=\"width:40px;height:43px;flex:none;padding:0;outline-offset:-2px;\">\n                        <svg class=\"is-icon-flex\" style=\"width:15px;height:15px;flex:none;\"><use xlink:href=\"#icon-settings\"></use></svg>\n                    </button>\n                    <button title=\"").concat(util.out('Mic'), "\" class=\"cmd-enable-dictation classic-secondary\" style=\"width:40px;height:43px;flex:none;padding:0;outline-offset:-2px;\">\n                        <svg class=\"is-icon-flex\" style=\"width: 18px; height: 18px;\"><use xlink:href=\"#icon-microphone\"></use></svg> \n                    </button>\n                    <button title=\"").concat(util.out('Command Examples'), "\" class=\"cmd-command-list classic-secondary\" style=\"width:40px;height:43px;flex:none;padding:0;outline-offset:-2px;\">\n                        <svg class=\"is-icon-flex\" style=\"width: 18px; height: 18px;\"><use xlink:href=\"#icon-message-search\"></use></svg> \n                    </button>\n                    <button title=\"").concat(util.out('Clear'), "\" class=\"cmd-clear-command classic-secondary\" style=\"width:40px;height:43px;flex:none;padding:0;outline-offset:-2px;\">\n                        <svg class=\"is-icon-flex\" style=\"width: 18px; height: 18px;\"><use xlink:href=\"#icon-eraser\"></use></svg> \n                    </button>\n\n                    <label class=\"label-chk-autosend-command\" for=\"chkAutoSendCommand\" style=\"margin:0;display:flex;padding-left:10px;padding-right:25px;white-space:nowrap;align-items:center;letter-spacing:0\"><input id=\"chkAutoSendCommand\" type=\"checkbox\"> <span style=\"margin-left:3px\">").concat(util.out('Auto Send'), "</span></label>\n                    \n                    <button title=\"").concat(util.out('Send'), "\" class=\"cmd-send-command classic-primary\" style=\"width:100%;padding-left:5px;padding-right:5px;height:43px;outline-offset:-2px;\">Send</button>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"is-modal commandlist\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"false\">\n            <div class=\"is-modal-overlay\"></div>\n\n            <div class=\"is-modal-content scroll-darker\"\">\n                <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">\n                    <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg>\n                </button>\n                <div class=\"div-command-list\">\n\n                </div>\n            </div>\n        </div>\n\n        <div class=\"is-modal commandconfig\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"max-width:380px;padding:55px 40px 35px;\">\n                <div class=\"is-modal-bar is-draggable\">\n                    ").concat(util.out('Settings'), "\n                    <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">&#10005;</button>\n                </div>\n              \n                <div class=\"is-label\"><span>").concat(util.out('Temperature'), "</span>: <span class=\"val-temp\">0.6</span></div>\n                <div style=\"padding-top:4px\">\n                    <input type=\"range\" min=\"0\" max=\"2\" step=\"0.01\" value=\"0.6\" class=\"temperature-slider is-rangeslider\" style=\"margin:0 !important;\">\n                </div>\n                \n                <div class=\"is-label\" style=\"margin-top:15px\"><span>").concat(util.out('Top P'), "</span>: <span class=\"val-top-p\">0.9</span></div>\n                <div style=\"padding-top:4px\">\n                    <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value=\"0.9\" class=\"top-p-slider is-rangeslider\" style=\"margin:0 !important;\">\n                </div>\n\n                <div style=\"text-align:right\">\n                    <button title=\"").concat(util.out('Reset'), "\" class=\"input-reset classic-secondary\" style=\"text-decoration: underline;padding: 0;box-shadow: none;\">").concat(util.out('Reset'), "</button>\n                </div>\n\n                <label for=\"chkAutoEditBlock\" style=\"margin:0;display:flex;align-items:center;letter-spacing:0\">\n                    <input id=\"chkAutoEditBlock\" type=\"checkbox\" style=\"margin:0 5px 0 0;\"> \n                    <span style=\"line-height: 1;\">").concat(util.out('Auto select \'Edit Selected Block\' mode.'), "</span>\n                </label>\n\n                <label class=\"label-input-autosend-command\" style=\"margin:18px 0 0 0;display:flex;align-items:center;letter-spacing:0\">\n                    <span>").concat(util.out('Auto send command delay'), "</soan>:\n                    <input class=\"input-autosend-delay\" id=\"__input_autosend_delay\" style=\"width:60px;text-align:center;padding-left:0;height:33px;margin-right:3px;\" type=\"text\" value=\"4000\"> <span>ms</span>\n                </label>\n\n                <div class=\"command-settings-info\" style=\"display:none\"></div>\n\n                <label class=\"label-input-command-lang\" style=\"display:none;flex-direction:column;letter-spacing:0;margin:18px 0 0 0;\">\n                    <span>").concat(util.out('Language'), ":</span>\n                    <div style=\"display:flex; align-items: baseline;flex-direction: row;\">\n                        <input class=\"input-command-lang\" id=\"__input_command_lang\" style=\"width:70px;text-align:center;padding-left:0;height:33px;margin-top:5px;margin-right:10px\" type=\"text\" value=\"en-us\">\n                        <span>(").concat(util.out('BCP-47 format'), ")</span>\n                    </div>\n                </label>\n\n                <div style=\"text-align:right;margin-top:25px;\">\n                    <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\" style=\"width:100%;\">").concat(util.out('Ok'), "</button>\n                </div>\n            </div>\n        </div>\n        ");
    dictation_dom.appendHtml(builderStuff, html);
    var modalCommand = builderStuff.querySelector('.page-command');
    this.modalCommand = modalCommand;
    var modalCommandList = builderStuff.querySelector('.commandlist');
    this.modalCommandList = modalCommandList;
    var modalConfig = builderStuff.querySelector('.commandconfig');
    this.modalConfig = modalConfig;
    var btnConfig = builderStuff.querySelector('.cmd-command-config');
    var btnDictation = builderStuff.querySelector('.cmd-enable-dictation');
    var btnClear = builderStuff.querySelector('.cmd-clear-command');
    var chkAutoSend = builderStuff.querySelector('#chkAutoSendCommand');
    var btnCommandList = builderStuff.querySelector('.cmd-command-list');
    var divInfo = builderStuff.querySelector('.command-settings-info');
    this.modalDisclaimer = builderStuff.querySelector('.ai-disclaimer');
    var btnOk = this.modalDisclaimer.querySelector('.input-ok');
    btnOk.addEventListener('click', function () {
      _this.builder.util.hideModal(_this.modalDisclaimer);
      _this.openDictation();
    });
    var info = "\n        <div style=\"font-weight:500;margin: 25px 0 7px;\">".concat(util.out('Dictation'), "</div>\n        <div style=\"line-height: 1.4;margin: 0 0 7px;\">").concat(util.out('These words trigger command actions'), ":</div>\n        <ul>");
    var triggerWords = this.builder.triggerWords;
    for (var key in triggerWords) {
      if (key === 'send') {
        var s = '';
        triggerWords[key].forEach(function (word) {
          s += ", ".concat(word);
        });
        s = s.substring(1);
        info += "<li><span>".concat(s, "</span></li>");
      }
      if (key === 'abort') {
        var _s = '';
        triggerWords[key].forEach(function (word) {
          _s += ", ".concat(word);
        });
        _s = _s.substring(1);
        info += "<li><span>".concat(_s, "</span></li>");
      }
      if (key === 'clear') {
        var _s2 = '';
        triggerWords[key].forEach(function (word) {
          _s2 += ", ".concat(word);
        });
        _s2 = _s2.substring(1);
        info += "<li><span>".concat(_s2, "</span></li>");
      }
    }
    info += '</ul>';
    divInfo.innerHTML = info;
    var inpCommand = this.builderStuff.querySelector('.inp-command');
    this.builder.commandText = '';
    this.builder.autoSendCommand = false;
    if (localStorage.getItem('_dictation') !== null) {
      if (localStorage.getItem('_dictation') === '1') {
        this.modalCommand.classList.add('active');
        this.doOpen();
        if (localStorage.getItem('_mic') !== null) {
          if (localStorage.getItem('_mic') === '1') {
            this.startDictation();
          }
        } else {
          this.startDictation();
        }
      }
    }
    if (localStorage.getItem('_mic') !== null) {
      if (localStorage.getItem('_mic') === '0') {
        btnDictation.innerHTML = '<svg class="is-icon-flex" style="width:18px; height:18px;"><use xlink:href="#icon-microphone-off"></use></svg>';
        chkAutoSend.parentNode.style.display = 'none';
      }
    }
    if (localStorage.getItem('_autosendcommand') !== null) {
      if (localStorage.getItem('_autosendcommand') === '1') {
        chkAutoSend.checked = true;
        this.builder.autoSendCommand = true;
        localStorage.setItem('_autosendcommand', '1');
      }
    }
    this.modalCommand.addEventListener('focus', function () {
      util.saveSelection(); // must be called in case used by formatText()
    });

    btnConfig.addEventListener('click', function () {
      _this.config();

      // util.showModal(this.modalConfig, false, ()=>{

      //     btnConfig.removeAttribute('data-focus');
      //     btnConfig.focus();

      // }, false);

      // btnConfig.setAttribute('data-focus',true);
    });

    if (localStorage.getItem('_temp') !== null) {
      var val = localStorage.getItem('_temp');
      this.builder.temperature = val;
    }
    if (localStorage.getItem('_top_p') !== null) {
      var _val = localStorage.getItem('_top_p');
      this.builder.topP = _val;
    }
    if (localStorage.getItem('_autosend_delay') !== null) {
      var _val2 = localStorage.getItem('_autosend_delay');
      this.builder.autoSendDelay = _val2;
    }
    if (localStorage.getItem('_auto_editblock') !== null) {
      var _val3 = localStorage.getItem('_auto_editblock');
      this.builder.autoEditBlock = _val3;
    }
    if (localStorage.getItem('_command_lang') !== null) {
      var _val4 = localStorage.getItem('_command_lang');
      this.builder.speechRecognitionLang = _val4;
    }
    var btnConfigOk = this.modalConfig.querySelector('.input-ok');
    btnConfigOk.addEventListener('click', function () {
      var tempSlider = _this.modalConfig.querySelector('.temperature-slider');
      localStorage.setItem('_temp', tempSlider.value);
      _this.builder.temperature = tempSlider.value;
      var topPSlider = _this.modalConfig.querySelector('.top-p-slider');
      localStorage.setItem('_top_p', topPSlider.value);
      _this.builder.topP = topPSlider.value;
      var chkAutoEditBlock = _this.modalConfig.querySelector('#chkAutoEditBlock');
      if (chkAutoEditBlock.checked) {
        localStorage.setItem('_auto_editblock', 1);
        _this.builder.autoEditBlock = true;
      } else {
        localStorage.setItem('_auto_editblock', 0);
        _this.builder.autoEditBlock = false;
      }
      var inpAutoSendDelay = _this.modalConfig.querySelector('.input-autosend-delay');
      localStorage.setItem('_autosend_delay', inpAutoSendDelay.value);
      _this.builder.autoSendDelay = inpAutoSendDelay.value;
      var inpCommandLang = _this.modalConfig.querySelector('.input-command-lang');
      localStorage.setItem('_command_lang', inpCommandLang.value);
      _this.builder.speechRecognitionLang = inpCommandLang.value;
      _this.builder.hideModal(_this.modalConfig);
    });
    var btnConfigReset = this.modalConfig.querySelector('.input-reset');
    btnConfigReset.addEventListener('click', function () {
      _this.resetConfig();
    });
    var valTemp = this.modalConfig.querySelector('.val-temp');
    var tempSlider = this.modalConfig.querySelector('.temperature-slider');
    tempSlider.oninput = function () {
      valTemp.innerHTML = tempSlider.value;
    };
    var valTopP = this.modalConfig.querySelector('.val-top-p');
    var topPSlider = this.modalConfig.querySelector('.top-p-slider');
    topPSlider.oninput = function () {
      valTopP.innerHTML = topPSlider.value;
    };
    btnCommandList.addEventListener('click', function () {
      var htmlList = '';
      var commandInfo;
      if (_this.builder.isContentBox) {
        if (_this.builder.canvas) {
          commandInfo = _this.builder.commandInfoCanvasMode;
        } else {
          commandInfo = _this.builder.commandInfo;
        }
      } else {
        if (_this.builder.canvas) {
          commandInfo = _this.builder.commandInfoCanvasMode;
        } else {
          commandInfo = _this.builder.commandInfo;
        }
      }
      var bImageGeneration = false;
      if (_this.builder.textToImageUrl) {
        bImageGeneration = true;
      }
      for (var _key in commandInfo) {
        if (Object.prototype.hasOwnProperty.call(commandInfo, _key)) {
          if (_key !== 'image' || _key === 'image' && bImageGeneration) {
            var _commandInfo$_key = commandInfo[_key],
              title = _commandInfo$_key.title,
              description = _commandInfo$_key.description,
              list = _commandInfo$_key.list,
              width = _commandInfo$_key.width;
            if (!_this.builder.enableShortCommands) {
              if (description) {
                htmlList += "<h2>".concat(title, "</h2>");
                htmlList += "<p>".concat(description, "</p>");
              } else {
                htmlList += "<h2 style=\"margin-bottom:30px\">".concat(title, "</h2>");
              }
              var _iterator = _createForOfIteratorHelper(list),
                _step;
              try {
                for (_iterator.s(); !(_step = _iterator.n()).done;) {
                  var item = _step.value;
                  if (width) htmlList += "<div role=\"button\" tabindex=\"0\" class=\"command-item\" style=\"width:".concat(width, "\">").concat(item, "</div>");else htmlList += "<div role=\"button\" tabindex=\"0\" class=\"command-item\">".concat(item, "</div>");
                }
              } catch (err) {
                _iterator.e(err);
              } finally {
                _iterator.f();
              }
            } else {
              htmlList += "<h2>".concat(title, "</h2>");
              var _iterator2 = _createForOfIteratorHelper(list),
                _step2;
              try {
                for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                  var _item = _step2.value;
                  if (width) htmlList += "<div role=\"button\" tabindex=\"0\" class=\"command-item\" style=\"width:".concat(width, "\">").concat(_item, "</div>");else htmlList += "<div role=\"button\" tabindex=\"0\" class=\"command-item\">".concat(_item, "</div>");
                }
              } catch (err) {
                _iterator2.e(err);
              } finally {
                _iterator2.f();
              }
            }
          }
        }
      }
      var divCommandList = _this.modalCommandList.querySelector('.div-command-list');
      divCommandList.innerHTML = htmlList;
      var handleSelect = function handleSelect(s) {
        var inpCommand = _this.builderStuff.querySelector('.inp-command');
        inpCommand.value = s;
        _this.builder.commandText = inpCommand.value;
        util.hideModal(_this.modalCommandList);
      };
      var items = _this.modalCommandList.querySelectorAll('.command-item');
      items.forEach(function (elm) {
        elm.addEventListener('click', function () {
          handleSelect(elm.innerText);
          inpCommand.focus();
        });
        elm.addEventListener('keydown', function (e) {
          if (e.which === 13 && !e.shiftKey) {
            e.preventDefault();
            e.stopImmediatePropagation();
            handleSelect(elm.innerText);
            setTimeout(function () {
              inpCommand.focus();
            }, 300);
          }
        });
      });
      util.showModal(_this.modalCommandList, false, function () {
        btnCommandList.removeAttribute('data-focus');
        btnCommandList.focus();
      }, false);
      btnCommandList.setAttribute('data-focus', true);
    });
    btnDictation.addEventListener('click', function () {
      if (!_this.checkMic()) {
        _this.startDictation();
        btnDictation.innerHTML = '<svg class="is-icon-flex" style="width:18px; height:18px;"><use xlink:href="#icon-microphone"></use></svg>';
        localStorage.setItem('_mic', '1');
        chkAutoSend.parentNode.style.display = 'flex';
      } else {
        _this.stopDictation();
        btnDictation.innerHTML = '<svg class="is-icon-flex" style="width:18px; height:18px;"><use xlink:href="#icon-microphone-off"></use></svg>';
        localStorage.setItem('_mic', '0');
        chkAutoSend.parentNode.style.display = 'none';
      }
    });
    chkAutoSend.addEventListener('change', function () {
      if (chkAutoSend.checked) {
        _this.builder.autoSendCommand = true;
        localStorage.setItem('_autosendcommand', '1');
      } else {
        _this.builder.autoSendCommand = false;
        localStorage.setItem('_autosendcommand', '0');
      }
    });
    btnClear.addEventListener('click', function () {
      var inpCommand = _this.builderStuff.querySelector('.inp-command');
      _this.builder.commandText = '';
      inpCommand.value = '';
      inpCommand.focus();
    });
    var btnSend = builderStuff.querySelector('.cmd-send-command');
    btnSend.addEventListener('click', /*#__PURE__*/dictation_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
      var _inpCommand, inpCommand, question;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              if (!_this.builder.isInProgress) {
                _context.next = 5;
                break;
              }
              // Abort

              _this.opts.abort();
              _inpCommand = _this.builderStuff.querySelector('.inp-command');
              _this.builder.commandText = _inpCommand.value;
              return _context.abrupt("return");
            case 5:
              inpCommand = _this.modalCommand.querySelector('.inp-command');
              question = inpCommand.value;
              question = question.trim();
              if (!(question === '')) {
                _context.next = 10;
                break;
              }
              return _context.abrupt("return");
            case 10:
              // this.startSending();

              // Clear
              _this.builder.commandText = '';
              _this.opts.send(question);
            case 12:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    })));
    inpCommand.addEventListener('keydown', function (e) {
      if (e.keyCode === 13 && !e.shiftKey) {
        e.preventDefault();
        return;
      }
    });
    inpCommand.addEventListener('keyup', function (e) {
      if (e.keyCode === 13 && !e.shiftKey) {
        btnSend.click();
        e.preventDefault();
        return;
      }
      _this.builder.commandText = inpCommand.value;
    });
    var btnClose = this.modalCommand.querySelector('.is-modal-close');
    btnClose.addEventListener('click', function () {
      _this.modalCommand.classList.remove('active');
      _this.stopDictation();
      localStorage.setItem('_dictation', '0');
    });
    var btnScopeSection = this.modalCommand.querySelector('.scope-section');
    var btnScopeBlock = this.modalCommand.querySelector('.scope-block');
    var btnScopeOthers = this.modalCommand.querySelector('.scope-others');
    var btnScopeImage = this.modalCommand.querySelector('.scope-image');
    btnScopeBlock.disabled = true;
    if (this.builder.textToImageUrl && !this.builder.hideImageGeneration) btnScopeImage.style.display = ''; // show generate image button

    var assistModeBtns = modalCommand.querySelectorAll('.div-assistant-mode button');
    assistModeBtns.forEach(function (btn) {
      btn.addEventListener('click', function () {
        assistModeBtns.forEach(function (item) {
          item.classList.remove('on');
        });
        btn.classList.add('on');
        var val = btn.getAttribute('data-value');
        _this.builder.assistantMode = val; // general, block, others, image

        if (_this.builder.hidePlaceholder) {
          inpCommand.setAttribute('placeholder', '');
        } else {
          if (val === 'general') {
            inpCommand.setAttribute('placeholder', _this.builder.commandPlaceholders.general || '');
          } else if (val === 'block') {
            inpCommand.setAttribute('placeholder', _this.builder.commandPlaceholders.edit_block || '');
          } else if (val === 'others') {
            inpCommand.setAttribute('placeholder', _this.builder.commandPlaceholders.ask_questions || '');
          } else if (val === 'image') {
            inpCommand.setAttribute('placeholder', _this.builder.commandPlaceholders.generate_image || '');
          }
        }

        /*
        // ContentBox
        if(val==='general') {
            if(!this.builder.activeCol) return;
            const box = this.builder.activeCol.closest('.is-box');
            const section = this.builder.activeCol.closest('.is-section');
            const wrapper = this.builder.activeCol.closest('.is-wrapper');
             if(!(box && section && wrapper)) return;
            
            box.click();
            
            if(!wrapper.classList.contains('hard-select')) box.click();
        }
        */
      });
    });

    //Extend onSelectionChange 
    var old = this.builder.settings.onSelectionChange;
    this.builder.settings.onSelectionChange = function () {
      if (old) old.call(_this); // call user's defined onRender

      if (_this.builder.activeCol) {
        if (_this.builder.autoEditBlock && _this.builder.autoEditBlock !== '0') {
          // change
          _this.builder.assistantMode = 'block';
          btnScopeBlock.classList.add('on');
          btnScopeSection.classList.remove('on');
          btnScopeOthers.classList.remove('on');
          btnScopeImage.classList.remove('on');
        }
        btnScopeBlock.removeAttribute('disabled');
      } else {
        btnScopeBlock.disabled = true;
        if (btnScopeOthers.classList.contains('on')) return;
        if (btnScopeImage.classList.contains('on')) return;

        // change
        _this.builder.assistantMode = 'general';
        btnScopeSection.classList.add('on');
        btnScopeBlock.classList.remove('on');
        btnScopeOthers.classList.remove('on');
        btnScopeImage.classList.remove('on');
      }
    };
    this.initialStart = false; // for Safari
  }
  dictation_createClass(Dictation, [{
    key: "resetConfig",
    value: function resetConfig() {
      var tempSlider = this.modalConfig.querySelector('.temperature-slider');
      var valTemp = this.modalConfig.querySelector('.val-temp');
      tempSlider.value = this.builder.temperature;
      valTemp.innerHTML = this.builder.temperature;
      var topPSlider = this.modalConfig.querySelector('.top-p-slider');
      var valTopP = this.modalConfig.querySelector('.val-top-p');
      topPSlider.value = this.builder.topP;
      valTopP.innerHTML = this.builder.topP;
    }
  }, {
    key: "config",
    value: function config() {
      this.builder.showModal(this.modalConfig, false);
      var tempSlider = this.modalConfig.querySelector('.temperature-slider');
      var valTemp = this.modalConfig.querySelector('.val-temp');
      if (localStorage.getItem('_temp') !== null) {
        var val = localStorage.getItem('_temp');
        tempSlider.value = val;
        valTemp.innerHTML = val;
      } else {
        tempSlider.value = this.builder.temperature;
        valTemp.innerHTML = this.builder.temperature;
      }
      var topPSlider = this.modalConfig.querySelector('.top-p-slider');
      var valTopP = this.modalConfig.querySelector('.val-top-p');
      if (localStorage.getItem('_top_p') !== null) {
        var _val5 = localStorage.getItem('_top_p');
        topPSlider.value = _val5;
        valTopP.innerHTML = _val5;
      } else {
        topPSlider.value = this.builder.topP;
        valTopP.innerHTML = this.builder.topP;
      }
      var chkAutoEditBlock = this.modalConfig.querySelector('#chkAutoEditBlock');
      if (localStorage.getItem('_auto_editblock') !== null) {
        var _val6 = localStorage.getItem('_auto_editblock');
        if (_val6 === '1') {
          chkAutoEditBlock.checked = true;
        } else {
          chkAutoEditBlock.checked = false;
        }
      } else {
        chkAutoEditBlock.checked = this.builder.autoEditBlock;
      }
      var inpAutoSendDelay = this.modalConfig.querySelector('.input-autosend-delay');
      if (localStorage.getItem('_autosend_delay') !== null) {
        var _val7 = localStorage.getItem('_autosend_delay');
        inpAutoSendDelay.value = _val7;
      } else {
        inpAutoSendDelay.value = this.builder.autoSendDelay;
      }
      var inpCommandLang = this.modalConfig.querySelector('.input-command-lang');
      if (localStorage.getItem('_command_lang') !== null) {
        var _val8 = localStorage.getItem('_command_lang');
        inpCommandLang.value = _val8;
      } else {
        inpCommandLang.value = this.builder.speechRecognitionLang;
      }
    }
  }, {
    key: "checkMic",
    value: function checkMic() {
      if (localStorage.getItem('_mic') !== null) {
        if (localStorage.getItem('_mic') === '0') {
          return false;
        } else {
          return true;
        }
      } else {
        return true;
      }
    }
  }, {
    key: "doOpen",
    value: function doOpen() {
      this.builder.hidePlaceholder = false;
      var numeOfOpenToHidePlaceholderText = 4;
      if (localStorage.getItem('_ai_panel_open') === null) {
        localStorage.setItem('_ai_panel_open', 1);
      } else {
        var count = parseInt(localStorage.getItem('_ai_panel_open'));
        if (count < numeOfOpenToHidePlaceholderText) {
          count++;
          localStorage.setItem('_ai_panel_open', count);
        }
      }
      var inpCommand = this.builderStuff.querySelector('.inp-command');
      if (localStorage.getItem('_ai_panel_open') === "".concat(numeOfOpenToHidePlaceholderText)) {
        this.builder.hidePlaceholder = true;
        inpCommand.setAttribute('placeholder', '');
      } else {
        if (!this.builder.commandPlaceholders) {
          this.builder.commandPlaceholders = {};
          this.builder.commandPlaceholders.general = '';
        }
        inpCommand.setAttribute('placeholder', this.builder.commandPlaceholders.general || '');
      }
    }
  }, {
    key: "openDictation",
    value: function openDictation() {
      var _this2 = this;
      if (this.builder.showDisclaimer) {
        if (localStorage.getItem('_disclaimershown') === null) {
          this.builder.util.showModal(this.modalDisclaimer, true, function () {
            _this2.openDictation_();
          }, true);
          var btnOk = this.modalDisclaimer.querySelector('.input-ok');
          btnOk.focus();
          setTimeout(function () {
            // Needed if opens programmatically on builder start (wait until all loaded)
            var btnOk = _this2.modalDisclaimer.querySelector('.input-ok');
            btnOk.focus();
          }, 600);
          localStorage.setItem('_disclaimershown', true);
        } else {
          this.openDictation_();
        }
      } else {
        this.openDictation_();
      }
    }
  }, {
    key: "openDictation_",
    value: function openDictation_() {
      this.doOpen();
      var inpCommand = this.modalCommand.querySelector('.inp-command');
      if (this.modalCommand.classList.contains('active')) {
        setTimeout(function () {
          // Needed if opens programmatically on builder start (wait until all loaded)
          inpCommand.focus();
        }, 600);
        return;
      }
      this.modalCommand.classList.add('active');
      inpCommand.focus();
      localStorage.setItem('_dictation', '1');
      var chkAutoSend = this.builderStuff.querySelector('#chkAutoSendCommand');
      if (this.checkMic()) {
        // Do Nothing
        chkAutoSend.parentNode.style.display = 'flex';
      } else {
        var btnDictation = this.builderStuff.querySelector('.cmd-enable-dictation');
        btnDictation.innerHTML = '<svg class="is-icon-flex" style="width:18px; height:18px;"><use xlink:href="#icon-microphone-off"></use></svg>';
        chkAutoSend.parentNode.style.display = 'none';
        return;
      }
      this.startDictation();
    }
  }, {
    key: "stopDictation",
    value: function stopDictation() {
      if (this.recognition) this.recognition.abort();
      this.aborted = true;

      // Using RecordRTC
      // if(this.recorder) this.recorder.stopRecording(); 
      // if(this.localStream) this.localStream.getAudioTracks().forEach(track => {
      //     track.stop();
      // });

      if (this.builder.useMediaRecorder) {
        // Using mediaRecorder
        if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {
          this.mediaRecorder.stop();
          this.localStream.getTracks().forEach(function (track) {
            return track.stop();
          }); // Stop the tracks to release the resources
        }
      } /* else {
          // Using Recorder
          if(this.recorder) this.recorder.stop();
          if(this.localStream) this.localStream.getTracks().forEach(track => track.stop()); // Stop the tracks to release the resources
        } */

      if (this.websocket && this.websocket.readyState === WebSocket.OPEN) {
        this.websocket.close();
      }
    }
  }, {
    key: "startDictation",
    value: function () {
      var _startDictation = dictation_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
        var _this3 = this;
        var inpCommand, sampleRate, isSafari, finalTranscripts, speechTimeout, SpeechRecognition, lang, _finalTranscripts;
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                inpCommand = this.modalCommand.querySelector('.inp-command');
                if (!this.builder.onlineDemo) {
                  _context2.next = 5;
                  break;
                }
                setTimeout(function () {
                  var btnDictation = _this3.builderStuff.querySelector('.cmd-enable-dictation');
                  var chkAutoSend = _this3.builderStuff.querySelector('#chkAutoSendCommand');
                  _this3.stopDictation();
                  btnDictation.innerHTML = '<svg class="is-icon-flex" style="width:18px; height:18px;"><use xlink:href="#icon-microphone-off"></use></svg>';
                  localStorage.setItem('_mic', '0');
                  chkAutoSend.parentNode.style.display = 'none';
                }, 1); // to give delay from the btnDictation click

                //Show info
                this.util.showMessage(this.util.out('Speech recognition is disabled in this online demo. You can type your command/prompt in the textbox.'), true, function () {
                  inpCommand.focus();
                });
                return _context2.abrupt("return");
              case 5:
                if (!this.builder.speechTranscribeUrl) {
                  _context2.next = 27;
                  break;
                }
                this.websocket = new WebSocket(this.builder.speechTranscribeUrl);
                _context2.prev = 7;
                _context2.next = 10;
                return navigator.mediaDevices.getUserMedia({
                  audio: true
                });
              case 10:
                this.localStream = _context2.sent;
                _context2.next = 18;
                break;
              case 13:
                _context2.prev = 13;
                _context2.t0 = _context2["catch"](7);
                setTimeout(function () {
                  var btnDictation = _this3.builderStuff.querySelector('.cmd-enable-dictation');
                  var chkAutoSend = _this3.builderStuff.querySelector('#chkAutoSendCommand');
                  _this3.stopDictation();
                  btnDictation.innerHTML = '<svg class="is-icon-flex" style="width:18px; height:18px;"><use xlink:href="#icon-microphone-off"></use></svg>';
                  localStorage.setItem('_mic', '0');
                  chkAutoSend.parentNode.style.display = 'none';
                }, 1); // to give delay from the btnDictation click

                //Show info
                this.util.showMessage(this.util.out('No microphone found. Please activate your microphone and refresh the page.'));
                return _context2.abrupt("return");
              case 18:
                sampleRate = 16000;
                if (this.builder.useMediaRecorder) {
                  // Using mediaRecorder
                  navigator.mediaDevices.getUserMedia({
                    audio: {
                      sampleSize: 16,
                      channelCount: 1,
                      sampleRate: sampleRate
                    }
                  }).then(function (stream) {
                    _this3.localStream = stream;
                    _this3.mediaRecorder = new MediaRecorder(stream);
                    _this3.mediaRecorder.addEventListener('dataavailable', function (event) {
                      if (_this3.aborted) return;
                      _this3.websocket.send(event.data);
                    });

                    // this.mediaRecorder.start(1000);
                  })["catch"](function (error) {
                    console.log(error);
                  });
                } /* else {
                     // Using Recorder
                    this.recorder = new Recorder({
                        encoderPath: this.builder.encoderPath||
                            'https://cdnjs.cloudflare.com/ajax/libs/opus-recorder/8.0.5/encoderWorker.min.js',
                        leaveStreamOpen: true,
                        numberOfChannels: 1,
                                     // OPUS options
                        encoderSampleRate: sampleRate,
                        streamPages: true,
                        maxBuffersPerPage: 1,
                    });
                    this.recorder.ondataavailable = (e) => {
                        if(this.aborted) return;
                        this.websocket.send(e.buffer);
                    };
                  } */

                /*
                // Using RecordRTC
                this.recorder = new RecordRTC(this.localStream, {
                    type: 'audio',
                    // mimeType: 'audio/webm',
                    // bufferSize: 16384,
                    desiredSampRate: sampleRate,
                    numberOfAudioChannels: 1,
                    timeSlice: 1000,
                    ondataavailable: (blob) => {
                        this.websocket.send(blob);
                    }
                });
                */
                isSafari = /constructor/i.test(window.HTMLElement) || function (p) {
                  return p.toString() === '[object SafariRemoteNotification]';
                }(!window['safari'] || typeof safari !== 'undefined' && window['safari'].pushNotification);
                if (isSafari && !this.initialStart) {
                  // for Safari
                  this.stopDictation();
                  this.initialStart = true;
                  setTimeout(function () {
                    _this3.startDictation();
                  }, 2000);
                }
                this.builder.commandText = '';
                finalTranscripts = '';
                this.websocket.onmessage = function (event) {
                  var message = JSON.parse(event.data);
                  if (message.event === 'can-open-mic') {
                    //this.recorder.startRecording(); // Using RecordRTC

                    if (_this3.builder.useMediaRecorder) {
                      _this3.mediaRecorder.start(1000); // Using mediaRecorder
                    } /* else {
                        this.recorder.start(); // Using Recorder
                      } */

                    _this3.aborted = false;
                  }
                  if (message.event === 'transcript-result') {
                    var transcript = message.data.channel.alternatives[0].transcript;

                    // Actions
                    var triggerWords = _this3.builder.triggerWords;
                    var findMatchingTrigger = function findMatchingTrigger(transcript) {
                      transcript = transcript.toLowerCase();
                      transcript = transcript.replace('.', '');
                      var _loop = function _loop(key) {
                        if (triggerWords[key].some(function (word) {
                          return transcript.includes(word);
                        })) {
                          return {
                            v: key
                          };
                        }
                        var result = void 0;
                        triggerWords[key].forEach(function (word) {
                          var similarity = _this3.builder.similarity.checkSimilarity(transcript, word);
                          if (similarity > 0.5) {
                            result = key;
                            return;
                          }
                        });
                        if (result) return {
                          v: result
                        };
                      };
                      for (var key in triggerWords) {
                        var _ret = _loop(key);
                        if (dictation_typeof(_ret) === "object") return _ret.v;
                      }
                      return null; // No match found
                    };

                    if (transcript && message.data.is_final) {
                      var matchingKey = findMatchingTrigger(transcript);
                      if (matchingKey) {
                        if (matchingKey === 'send') {
                          if (inpCommand.value.trim() === '') return;
                          var btnSend = _this3.modalCommand.querySelector('.cmd-send-command');
                          btnSend.click();
                          return;
                        } else if (matchingKey === 'abort') {
                          if (_this3.builder.isInProgress) {
                            // Abort
                            _this3.opts.abort();
                            var _inpCommand2 = _this3.builderStuff.querySelector('.inp-command');
                            _this3.builder.commandText = _inpCommand2.value;
                          }
                          return;
                        } else if (matchingKey === 'clear') {
                          _this3.builder.commandText = '';
                          inpCommand.value = '';
                          return;
                        }
                      }
                    }
                    if (_this3.builder.isInProgress || _this3.aborted) {
                      return;
                    }
                    finalTranscripts = _this3.builder.commandText;
                    if (transcript && message.data.is_final) {
                      finalTranscripts += ' ' + transcript.trim();
                    }

                    // Format
                    finalTranscripts = finalTranscripts.charAt(0).toUpperCase() + finalTranscripts.slice(1);
                    finalTranscripts = finalTranscripts.trim();
                    _this3.builder.commandText = finalTranscripts;
                    if (transcript && message.data.is_final) {
                      _this3.builder.commandText = finalTranscripts;
                      inpCommand.value = finalTranscripts;
                    }
                    clearTimeout(speechTimeout);
                    speechTimeout = setTimeout(function () {
                      if (_this3.builder.autoSendCommand) {
                        if (inpCommand.value.trim() === '') return;
                        var _btnSend = _this3.modalCommand.querySelector('.cmd-send-command');
                        _btnSend.click();
                      }
                    }, _this3.builder.autoSendDelay);
                  }
                };
                _context2.next = 28;
                break;
              case 27:
                if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window || 'mozSpeechRecognition' in window) {
                  SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition;
                  this.recognition = new SpeechRecognition();
                  this.recognition.continuous = true;
                  this.recognition.interimResults = true;
                  lang = this.builder.speechRecognitionLang;
                  this.recognition.lang = lang;
                  this.recognition.start();

                  // this.speechTimeout;

                  this.builder.commandText = '';
                  _finalTranscripts = '';
                  this.recognition.onresult = function (event) {
                    var transcript = '';
                    for (var i = event.resultIndex; i < event.results.length; ++i) {
                      if (event.results[i].isFinal) {
                        transcript = event.results[i][0].transcript;
                      }
                    }
                    if (!transcript) return;

                    // Actions
                    var triggerWords = _this3.builder.triggerWords;
                    var findMatchingTrigger = function findMatchingTrigger(transcript) {
                      transcript = transcript.toLowerCase();
                      var _loop2 = function _loop2(key) {
                        if (triggerWords[key].some(function (word) {
                          return transcript.includes(word);
                        })) {
                          return {
                            v: key
                          };
                        }
                        var result = void 0;
                        triggerWords[key].forEach(function (word) {
                          var similarity = _this3.builder.similarity.checkSimilarity(transcript, word);
                          if (similarity > 0.5) {
                            result = key;
                            return;
                          }
                        });
                        if (result) return {
                          v: result
                        };
                      };
                      for (var key in triggerWords) {
                        var _ret2 = _loop2(key);
                        if (dictation_typeof(_ret2) === "object") return _ret2.v;
                      }
                      return null; // No match found
                    };

                    var matchingKey = findMatchingTrigger(transcript);
                    if (matchingKey) {
                      if (matchingKey === 'send') {
                        if (inpCommand.value.trim() === '') return;
                        var btnSend = _this3.modalCommand.querySelector('.cmd-send-command');
                        btnSend.click();
                        return;
                      } else if (matchingKey === 'abort') {
                        if (_this3.builder.isInProgress) {
                          // Abort
                          _this3.opts.abort();
                          var _inpCommand3 = _this3.builderStuff.querySelector('.inp-command');
                          _this3.builder.commandText = _inpCommand3.value;
                        }
                        return;
                      } else if (matchingKey === 'clear') {
                        _this3.builder.commandText = '';
                        inpCommand.value = '';
                        return;
                      }
                    }
                    if (_this3.builder.isInProgress) {
                      return;
                    }
                    _finalTranscripts = _this3.builder.commandText;
                    _finalTranscripts += ' ' + transcript.trim();

                    // Format
                    _finalTranscripts = _finalTranscripts.trim();
                    _finalTranscripts = _finalTranscripts.charAt(0).toUpperCase() + _finalTranscripts.slice(1);
                    _this3.builder.commandText = _finalTranscripts;
                    inpCommand.value = _finalTranscripts;
                    clearTimeout(_this3.speechTimeout);
                    _this3.speechTimeout = setTimeout(function () {
                      if (_this3.builder.autoSendCommand) {
                        if (inpCommand.value.trim() === '') return;
                        var _btnSend2 = _this3.modalCommand.querySelector('.cmd-send-command');
                        _btnSend2.click();
                      }
                    }, _this3.builder.autoSendDelay);
                  };
                  this.recognition.onend = function () {
                    if (!_this3.aborted) _this3.startDictation();
                  };
                  this.recognition.onstart = function () {
                    _this3.aborted = false;
                  };
                  this.recognition.onerror = function (e) {
                    console.log(e.message);
                  };
                } else {
                  // See btnDictation click
                  setTimeout(function () {
                    var btnDictation = _this3.builderStuff.querySelector('.cmd-enable-dictation');
                    var chkAutoSend = _this3.builderStuff.querySelector('#chkAutoSendCommand');
                    _this3.stopDictation();
                    btnDictation.innerHTML = '<svg class="is-icon-flex" style="width:18px; height:18px;"><use xlink:href="#icon-microphone-off"></use></svg>';
                    localStorage.setItem('_mic', '0');
                    chkAutoSend.parentNode.style.display = 'none';
                  }, 1); // to give delay from the btnDictation click

                  //Show info
                  this.util.showMessage(this.util.out('Speech recognition not supported in this browser.'));
                }
              case 28:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this, [[7, 13]]);
      }));
      function startDictation() {
        return _startDictation.apply(this, arguments);
      }
      return startDictation;
    }()
  }, {
    key: "startSending",
    value: function startSending() {
      var btnSend = this.modalCommand.querySelector('.cmd-send-command');
      btnSend.innerHTML = "\n        <svg class=\"spinner\" width=\"14px\" height=\"14px\" viewBox=\"0 0 66 66\" xmlns=\"http://www.w3.org/2000/svg\">\n            <circle class=\"path\" fill=\"none\" stroke-width=\"6\" stroke-linecap=\"round\" cx=\"33\" cy=\"33\" r=\"30\"></circle>\n        </svg>\n        <span style=\"margin-left:5px\">".concat(this.util.out('Abort'), "</span>\n        ");
      var ovl = this.builderStuff.querySelector('.page-command-overlay');
      if (ovl) ovl.style.display = 'flex';
      this.builder.isInProgress = true;
    }
  }, {
    key: "finish",
    value: function finish() {
      this.builder.isInProgress = false;
      var btnSend = this.modalCommand.querySelector('.cmd-send-command');
      btnSend.innerText = this.util.out('Send');
      var ovl = this.builderStuff.querySelector('.page-command-overlay');
      if (ovl) ovl.style.display = 'none';
    }
  }]);
  return Dictation;
}();
/* harmony default export */ const dictation = (Dictation);
;// CONCATENATED MODULE: ./src/contentbuilder/context.js
var contextBlockList = {
  new_section_with_list: "\nTo create a section with a list:\n- Use the example below as a template.\n- Replace all the text in the example with the requested content.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n    \nExample:\n\n<div class=\"is-container v2 size-18 leading-12 is-content-1200\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h2 class=\"font-medium size-60\">Title here</h2>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <h3 class=\"size-28 font-normal\">Point One</h3>\n            <div class=\"spacer height-20\"></div>\n            <p>Paragraph content here</p>\n        </div>\n        <div class=\"column\">\n            <h3 class=\"size-28 font-normal\">Point Two</h3>\n            <div class=\"spacer height-20\"></div>\n            <p>Paragraph content here</p>\n        </div>\n    </div>\n\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-40\"></div>\n        </div>\n    </div>\n\n    <div class=\"row\">\n        <div class=\"column\">\n            <h3 class=\"size-28 font-normal\">Point Three</h3>\n            <div class=\"spacer height-20\"></div>\n            <p>Paragraph content here</p>\n        </div>\n        <div class=\"column\">\n            <h3 class=\"size-28 font-normal\">Point Four</h3>\n            <div class=\"spacer height-20\"></div>\n            <p>Paragraph content here</p>\n        </div>\n    </div>\n\n</div>\n\n",
  new_section_with_list_numbering: ["\nTo create a section with a list and numbering:\n- Use the example below as a template.\n- Replace all the text in the example with the requested content.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n\nExample:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-1540\">\n    <div class=\"row\">\n        <div class=\"xs-hidden column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 50%; flex: 0 0 auto;\">\n            <h1 class=\"text-center tracking-tight size-50 leading-none\">Title Here</h1>\n        </div>\n        <div class=\"xs-hidden column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-140\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column text-center\">\n            <p class=\"size-32 font-medium\">1.</p>\n            <h3 class=\"tracking-75 text-center size-21 font-normal\">First Highlight</h3>\n            <p class=\"text-center\">Experience the power of innovative designs.</p>\n        </div>\n        <div class=\"column\">\n            <p class=\"size-32 font-medium text-center\">2.</p>\n            <h3 class=\"tracking-75 text-center size-21 font-normal\">Second Highlight</h3>\n            <p class=\"text-center\">Discover the magic of exceptional creativity.</p>\n        </div>\n        <div class=\"column\">\n            <p class=\"text-center size-32 font-medium\">3.</p>\n            <h3 class=\"tracking-75 text-center size-21 font-normal\">Third Highlight</h3>\n            <p class=\"text-center\">Unleash your imagination with outstanding designs.</p>\n        </div>\n    </div>\n</div>\n\n", "\nTo create a section with a list and numbering:\n- Use the example below as a template.\n- Replace all the text in the example with the requested content.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n\nExample:\n\n<div class=\"is-container v2 is-content-1540 size-19 leading-13\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"tracking-tight size-50 text-left\">Title Here</h1>\n        </div>\n        <div class=\"xs-hidden column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-120\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <p class=\"size-76\">01</p>\n            <div class=\"spacer height-20\"></div>\n            <h3 class=\"size-24 leading-12 font-normal\">First Highlight</h3>\n            <p>Experience the power of innovative designs.&nbsp;</p>\n        </div>\n        <div class=\"column\">\n            <p class=\"size-76\">02</p>\n            <div class=\"spacer height-20\"></div>\n            <h3 class=\"size-24 leading-12 font-normal\">Second Highlight</h3>\n            <p>Discover the magic of exceptional creativity.&nbsp;</p>\n        </div>\n        <div class=\"column\">\n            <p class=\"size-76\">03</p>\n            <div class=\"spacer height-20\"></div>\n            <h3 class=\"size-24 leading-12 font-normal\">Third Highlight</h3>\n            <p>Unleash your imagination with outstanding designs.&nbsp;</p>\n        </div>\n\n    </div>\n</div>\n\n"],
  new_section_with_list_icons: "\nTo create a section with list icons:\n- Use the example below as a template.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n- Replace all the text in the example with the requested content.\n        \nExample:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-1540\">\n    <div class=\"row\">\n        <div class=\"xs-hidden column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 50%; flex: 0 0 auto;\">\n            <h1 class=\"text-center tracking-tight size-50 leading-none\">Title Here</h1>\n        </div>\n        <div class=\"xs-hidden column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"text-center\">\n                <i class=\"icon {{ICONCLASS}} size-32\"></i>\n            </div>\n            <h3 class=\"tracking-75 text-center size-21 font-normal\">Point One</h3>\n            <p class=\"text-center\">Paragraph content here</p>\n        </div>\n        <div class=\"column\">\n            <div class=\"text-center\">\n                <i class=\"icon {{ICONCLASS}} size-32\"></i>\n            </div>\n            <h3 class=\"tracking-75 text-center size-21 font-normal\">Point Two</h3>\n            <p class=\"text-center\">Paragraph content here</p>\n        </div>\n        <div class=\"column\">\n            <div class=\"text-center\">\n                <i class=\"icon {{ICONCLASS}} size-32\"></i>\n            </div>\n            <h3 class=\"tracking-75 text-center size-21 font-normal\">Point Three</h3>\n            <p class=\"text-center\">Paragraph content here</p>\n        </div>\n    </div>\n</div>\n\n- Important: for icons, replace {{ICONCLASS}} with 'ion-checkmark'.\n\n",
  new_section_with_list_images: "\nTo create a section with a list of photos or a photo gallery:\n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Replace all the text in the example with the requested content.\n    \nExample:\n    \n<div class=\"is-container v2 size-19 leading-13 content-pt-60 content-pb-60 is-content-1300\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"tracking-tight size-50 text-center\">Title Here</h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row relative sm-items-1\">\n        <div class=\"column flex flex-col justify-center items-start py-2\">\n            <h2 class=\"font-normal leading-none size-32\">Item One</h2>\n\n            <p>At our web studio, we combine our passion for design, technology, and innovation to build stunning and functional websites that make your brand stand out in the digital world.</p>\n        </div>\n        <div class=\"column\" style=\"width: 5%; flex: 0 0 auto;\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 53%; flex: 0 0 auto;\">\n            <img src=\"{{IMAGEURL}}\" alt=\"\">\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-100\"></div>\n        </div>\n    </div>\n    <div class=\"row relative sm-items-1\">\n        <div class=\"column\" style=\"width: 53%; flex: 0 0 auto;\">\n            <img src=\"{{IMAGEURL}}\" alt=\"\">\n        </div>\n        <div class=\"column\" style=\"width: 5%; flex: 0 0 auto;\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column flex flex-col justify-center items-start py-2\" style=\"width: 41.9836%; flex: 0 0 auto;\">\n            <h2 class=\"font-normal leading-none size-32\">Item Two</h2>\n\n            <p>At our web studio, we combine our passion for design, technology, and innovation to build stunning and functional websites that make your brand stand out in the digital world.</p>\n        </div>\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n",
  new_section_with_image: "\nTo create a section: \n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"is-container v2 is-content-1500 size-19 leading-13\">\n    <div class=\"row relative sm-items-1\">\n        <div class=\"column flex flex-col justify-center items-start py-2\">\n            <h1 class=\"font-normal leading-none size-60\">Empowering businesses with AI-integrated web solutions.</h1>\n            <div class=\"spacer height-40\"></div>\n            <p>We are a full-stack web development studio that brings the power of Artificial Intelligence into our web solutions.</p>\n\n            <div class=\"spacer height-20\"></div>\n\n            <div>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mb-1 py-2 size-18 px-9 text-black leading-relaxed rounded-full border-transparent hover:border-transparent font-normal tracking-wide mt-3\" title=\"\" style=\"background-color: rgb(240, 240, 240);\">Our Works</a>\n                <a href=\"#\" role=\"button\" class=\"transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mb-1 py-2 size-18 px-9 border-current hover:border-current font-normal leading-relaxed rounded-full tracking-wide mt-3\" title=\"\">Get in Touch</a>\n            </div>\n        </div>\n        <div class=\"column\" style=\"width: 5%; flex: 0 0 auto;\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 53%; flex: 0 0 auto;\">\n            <img src=\"{{IMAGEURL}}\" alt=\"\">\n        </div>\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n",
  new_section_with_gallery: "\nTo create a section with a list of photos or a photo gallery:\n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"is-container v2 leading-13 is-content-1640 size-16\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"font-light size-54 leading-none\">We deliver extraordinary things.</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-40\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\"><img src=\"{{IMAGEURL}}\" alt=\"\" data-filename=\"img-024.jpg\">\n            <h3 class=\"font-normal leading-11 size-36 size-24\">Image title</h3>\n            <p>Paragraph here</p>\n        </div>\n        <div class=\"column\"><img src=\"{{IMAGEURL}}\" alt=\"\" data-filename=\"img-083.jpg\">\n            <h3 class=\"font-normal leading-11 size-36 size-24\">Image title</h3>\n            <p>Paragraph here</p>\n        </div>\n        <div class=\"column\"><img src=\"{{IMAGEURL}}\" alt=\"\" data-filename=\"img-190.jpg\">\n            <h3 class=\"font-normal leading-11 size-36 size-24\">Image title</h3>\n            <p>Paragraph here</p>\n        </div>\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n",
  new_section: ["\nTo create a section: \n- Use the example below as a template.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-800 is-content-left edge-x-2\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"font-normal leading-11 size-64\">A forward thinking studio delivering digital solutions that help your business.</h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>\n        </div>\n    </div>\n</div>\n\n"],
  short_content: "This is the template:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-800 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <p class=\"size-32\">{{CONTENT}}</p>\n        </div>\n    </div>\n</div>\n    \n",
  new_section_answer: "This is the template:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-800 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"font-normal leading-11 size-64\">{{TITLE}}</h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <h2>{{SUBTITLE}}</h2>\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <h2>{{SUBTITLE}}</h2>\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n</div>\n\n",
  new_section_others: "Use one of these templates that is more suitable:\n\n\nTemplate 1: (Suitable for one short paragraph content, a tweet, quick information.)\n\n    <div class=\"is-container v2 leading-13 size-19 is-content-800 content-pt-60 content-pb-60\">\n        <div class=\"row\">\n            <div class=\"column\">\n                <p class=\"size-32\">{{CONTENT}}</p>\n            </div>\n        </div>\n    </div>\n\nTemplate 2: (Suitable for short content with a title and paragraph content. Ensure that there is a space between the title and the content.)\n\n    <div class=\"is-container v2 leading-13 size-19 is-content-800 content-pt-60 content-pb-60\">\n        <div class=\"row\">\n            <div class=\"column\">\n                <h1 class=\"font-normal leading-11 size-64\">{{TITLE}}</h1>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <div class=\"spacer height-20\"></div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <p>{{CONTENT}}</p>\n            </div>\n        </div>\n    </div>\n\n\nTemplate 3:  (Suitable for long content with multiple subtopics. Ensure that there is a space between subtopics.)\n\n    <div class=\"is-container v2 leading-13 size-19 is-content-800 content-pt-60 content-pb-60\">\n        <div class=\"row\">\n            <div class=\"column\">\n                <h1 class=\"font-normal leading-11 size-64\">{{TITLE}}</h1>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <div class=\"spacer height-20\"></div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <p>{{CONTENT}}</p>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <div class=\"spacer height-20\"></div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <h2>{{SUBTITLE}}</h2>\n                <p>{{CONTENT}}</p>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <div class=\"spacer height-20\"></div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <h2>{{SUBTITLE}}</h2>\n                <p>{{CONTENT}}</p>\n            </div>\n        </div>\n    </div>\n\n",
  // same as new_section_others (Ensure that there is a space between subtopics.)
  new_section_article: ["This is the template:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-800 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"font-normal leading-11 size-64\">{{TITLE}}</h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <h2>{{SUBTITLE}}</h2>\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <h2>{{SUBTITLE}}</h2>\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n</div>\n                \n"],
  new_section_article_with_image: ["To create a section: \n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-800 content-pt-50 content-pb-50\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"font-normal leading-11 size-64\">Title here</h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <img src=\"{{IMAGEURL}}\" alt=\"\">\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n\n    <div class=\"row\">\n        <div class=\"column\">\n            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>\n        </div>\n    </div>\n\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n\n    <div class=\"row\">\n        <div class=\"column\">\n            <h2 class=\"size-28 font-normal\">Sub Topic Title here</h2>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-20\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>\n        </div>\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n", "\nTo create a section: \n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"is-container v2 leading-13 size-19 is-content-1100\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"font-normal leading-none size-60\">A forward thinking studio delivering digital solutions that help your business<br></h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\"><img src=\"{{IMAGEURL}}\" alt=\"\"></div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\">\n            <p>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n                when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-40\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\">\n            <h2 class=\"size-28 font-normal\">Sub Topic 1</h2>\n            <div class=\"spacer height-20\"></div>\n            <p>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n                when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-40\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\">\n            <h2 class=\"size-28 font-normal\">Sub Topic 2</h2>\n            <div class=\"spacer height-20\"></div>\n            <p>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n                when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-80\"></div>\n        </div>\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n"],
  redesign_layout2: ["To redesign the provided section:\n- Decide the best placement of each content element (title, paragraph, images, etc) and change the position based on the template below.\n\nThis is the template:\n\n<div class=\"is-container v2 is-content-1400 size-19 leading-13 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 60%; flex: 0 0 auto;\">\n            <h1 class=\"leading-09 size-116 font-extrabold\">{{TITLE}}</h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\" style=\"width: 65%; flex: 0 0 auto;\">\n            <p>{{CONTENT}}</p>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column\" style=\"width: 65%; flex: 0 0 auto;\">\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n</div>\n\n", "To redesign the provided section:\n- Decide the best placement of each content element (title, paragraph, images, etc) and change the position based on the template below.\n- You must update the title class with 'tracking-tight leading-09 size-120 font-normal'.\n    \nThis is the template:\n    \n<div class=\"is-container v2 leading-14 size-19 content-pt-60 content-pb-60 is-content-1200\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"tracking-tight leading-09 size-120 font-normal\">{{Place title here}}</h1>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <p>{{CONTENT}}</p>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n        <div class=\"column\">\n            <p>{{CONTENT}}</p>\n        </div>\n        <div class=\"column\">\n            <p>{{CONTENT}}</p>\n        </div>\n    </div>\n</div>\n\nImportant: include all images from the original section in the returned result!\n\n"],
  redesign_layout: [/* 1 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 leading-14 is-content-1100 size-18 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-54 font-medium leading-none\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 2 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 is-content-1100 size-18 leading-13 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-116 font-medium leading-09\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 3 (very good) */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 is-content-1100 size-18 leading-13 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-76 font-normal leading-none\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 4 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n    <div class=\"is-container v2 h-full flex flex-col justify-between size-19 leading-none is-content-1000 content-pt-60 content-pb-60\">\n        <div class=\"row\">\n            <div class=\"column\">\n                <h1 class=\"uppercase size-72 font-semibold leading-09\">{{TITLE}}</h1>\n            </div>\n            <div class=\"column\">\n                <div class=\"spacer height-60\"></div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <div class=\"spacer height-60\"></div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                {{CONTENT}}\n            </div>\n            <div class=\"column\">\n                {{CONTENT}}\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                <div class=\"spacer height-60\"></div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"column\">\n                {{CONTENT}}\n            </div>\n            <div class=\"column\">\n                {{CONTENT}}\n            </div>\n            <div class=\"column\">\n                {{CONTENT}}\n            </div>\n        </div>\n    </div>\n\n", /* 5 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 leading-13 size-18 is-content-1000 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-76 font-normal leading-none\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 6 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 size-18 leading-12 is-content-1000 is-content-left edge-x-1\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"text-left size-64 font-medium leading-none tracking-tight\">{{TITLE}}</h1>\n            <p style=\"border-bottom: 2px solid #333; width: 80px;\"></p>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 7 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 is-content-1300 size-18 leading-13 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-88 font-medium leading-09\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 08 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 is-content-1100 leading-12 size-19 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-68 font-normal leading-09 tracking-tighter\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 09 (very good) */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 is-content-1000 size-19 leading-12 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-68 font-normal leading-none tracking-tighter\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 10 (very good) */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 size-17 is-content-1000 leading-12 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"size-76 font-normal leading-09\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n", /* 11 */"Re-arrange the placement of the title, paragraph, spaces, or images based the grid template below.\nFeel free to change the layout to create a visually appealing design and enhance readability. \nImportant: group all image columns together in a single row.\n\nThis is the template:\n\n<div class=\"is-container v2 h-full flex flex-col justify-between size-19 leading-none is-content-1000 content-pt-60 content-pb-60\">\n    <div class=\"row\">\n        <div class=\"column\">\n            <h1 class=\"uppercase size-84 font-normal leading-09\">{{TITLE}}</h1>\n        </div>\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            <div class=\"spacer height-60\"></div>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n</div>\n\n"],
  update_section_with_image: "To add a headline or paragraph and an image, follow these steps:\n- Create the necessary rows and columns.\n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"row relative sm-items-1\">\n    <div class=\"column flex flex-col justify-center items-start py-2\">\n        <h1 class=\"font-normal leading-none size-60\">Empowering businesses with AI-integrated web solutions.</h1>\n        <div class=\"spacer height-40\"></div>\n        <p>We are a full-stack web development studio that brings the power of Artificial Intelligence into our web solutions.</p>\n    </div>\n    <div class=\"column\" style=\"width: 5%; flex: 0 0 auto;\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n    <div class=\"column\" style=\"width: 53%; flex: 0 0 auto;\">\n        <img src=\"{{IMAGEURL}}\" alt=\"\">\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n",
  update_section_with_gallery: "To add a list of photos or a photo gallery, follow these steps:\n- Create the necessary rows and columns.\n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Replace all the text in the example with the requested content.\n\nExample :\n\n<div class=\"row\">\n    <div class=\"column\">\n        <h1 class=\"font-light size-54 leading-none\">We deliver extraordinary things.</h1>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\"><img src=\"{{IMAGEURL}}\" alt=\"\" data-filename=\"img-024.jpg\">\n        <p>Image Caption</p>\n    </div>\n    <div class=\"column\"><img src=\"{{IMAGEURL}}\" alt=\"\" data-filename=\"img-083.jpg\">\n        <p>Image Caption</p>\n    </div>\n    <div class=\"column\"><img src=\"{{IMAGEURL}}\" alt=\"\" data-filename=\"img-190.jpg\">\n        <p>Image Caption</p>\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n",
  update_section_with_list: "To add a list, follow these steps:\n- Create the necessary rows and columns.\n- Use the example below as a template.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n- Each list item has <h3> as item title. Use example below.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"row\">\n    <div class=\"column\">\n        <h2 class=\"font-medium size-60\">List Title</h2>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <h3 class=\"size-28 font-normal\">List Item 1</h3>\n        <div class=\"spacer height-20\"></div>\n        <p>Experience the power and flexibility of our innovative cloud solutions that can transform your business.\n            With our expertise, you can stay one step ahead of your competition in a rapidly changing digital landscape.</p>\n    </div>\n    <div class=\"column\">\n        <h3 class=\"size-28 font-normal\">List Item 2</h3>\n        <div class=\"spacer height-20\"></div>\n        <p>Leave your IT operations to us and focus on what really matters - your core business.\n            Our managed IT services enable you to optimize your technology infrastructure and improve efficiency,\n            ensuring smooth operations and maximum productivity.</p>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-40\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <h3 class=\"size-28 font-normal\">List Item 3</h3>\n        <div class=\"spacer height-20\"></div>\n        <p>No matter the size of your organization, we have the network solutions you need to optimize your connectivity\n            and ensure reliable and secure communication. Our experts will design and implement a tailored network infrastructure,\n            keeping your business connected and functioning seamlessly.</p>\n    </div>\n    <div class=\"column\">\n        <h3 class=\"size-28 font-normal\">List Item 4</h3>\n        <div class=\"spacer height-20\"></div>\n        <p>Our support and consulting services are designed to provide you with the expertise and guidance you need\n            to overcome any technology challenges you may face. From troubleshooting to strategic planning,\n            our team of professionals is here to assist you every step of the way.</p>\n    </div>\n</div>\n\n",
  update_section_with_list_images: "To add a list with images, follow these steps:\n- Create the necessary rows and columns.\n- Use the example below as a template.\n- Images must use this image URL: '{{_IMAGEURL}}'. Replace the {{IMAGEURL}} with this URL.\n- Each list item has <h3> as item title.\n- Replace all the text in the example with the requested content.\n    \nExample result (Use it as the template):\n    \n<div class=\"row\">\n    <div class=\"column\">\n        <h2 class=\"tracking-tight size-50 text-center\">Title Here</h2>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-100\"></div>\n    </div>\n</div>\n<div class=\"row relative sm-items-1\">\n    <div class=\"column flex flex-col justify-center items-start py-2\">\n        <h3 class=\"font-normal leading-none size-32\">Item One</h3>\n\n        <p>At our web studio, we combine our passion for design, technology, and innovation to build stunning and functional websites that make your brand stand out in the digital world.</p>\n    </div>\n    <div class=\"column\" style=\"width: 5%; flex: 0 0 auto;\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n    <div class=\"column\" style=\"width: 53%; flex: 0 0 auto;\">\n        <img src=\"{{IMAGEURL}}\" alt=\"\">\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-100\"></div>\n    </div>\n</div>\n<div class=\"row relative sm-items-1\">\n    <div class=\"column\" style=\"width: 53%; flex: 0 0 auto;\">\n        <img src=\"{{IMAGEURL}}\" alt=\"\">\n    </div>\n    <div class=\"column\" style=\"width: 5%; flex: 0 0 auto;\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n    <div class=\"column flex flex-col justify-center items-start py-2\" style=\"width: 41.9836%; flex: 0 0 auto;\">\n        <h3 class=\"font-normal leading-none size-32\">Item Two</h3>\n\n        <p>At our web studio, we combine our passion for design, technology, and innovation to build stunning and functional websites that make your brand stand out in the digital world.</p>\n    </div>\n</div>\n\n- Important: for images, replace {{IMAGEURL}} with '{{_IMAGEURL}}'.\n\n",
  update_section_with_list_icons: "To add a list with icons, follow these steps:\n- Create the necessary rows and columns.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n- Use the example below as a template.\n- Each list item has <h3> as item title.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"row\">\n    <div class=\"column\">\n        <h1 class=\"text-center tracking-tight size-50 leading-none\">Title Here</h1>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"text-center\">\n            <i class=\"icon {{ICONCLASS}} size-32\"></i>\n        </div>\n        <h3 class=\"tracking-75 text-center size-21 font-normal\">Point One</h3>\n        <p class=\"text-center\">Paragraph content here</p>\n    </div>\n    <div class=\"column\">\n        <div class=\"text-center\">\n            <i class=\"icon {{ICONCLASS}} size-32\"></i>\n        </div>\n        <h3 class=\"tracking-75 text-center size-21 font-normal\">Point Two</h3>\n        <p class=\"text-center\">Paragraph content here</p>\n    </div>\n    <div class=\"column\">\n        <div class=\"text-center\">\n            <i class=\"icon {{ICONCLASS}} size-32\"></i>\n        </div>\n        <h3 class=\"tracking-75 text-center size-21 font-normal\">Point Three</h3>\n        <p class=\"text-center\">Paragraph content here</p>\n    </div>\n</div>\n\n- Important: for icons, replace {{ICONCLASS}} with 'ion-checkmark'.\n\n",
  // INFO: The {{ICONCLASS}} replacement works well. No processing required.

  update_section_with_list_numbering: ["To add a list and numbering:\n- Create the required rows and column and add them inside the current 'div.is-container'.\n- Replace all the text in the example with the requested content.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n\nExample:\n\n<div class=\"row\">\n    <div class=\"xs-hidden column\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n    <div class=\"column\" style=\"width: 50%; flex: 0 0 auto;\">\n        <h1 class=\"text-center tracking-tight size-50 leading-none\">Title Here</h1>\n    </div>\n    <div class=\"xs-hidden column\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-140\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column text-center\">\n        <p class=\"size-32 font-medium\">1.</p>\n        <h3 class=\"tracking-75 text-center size-21 font-normal\">First Highlight</h3>\n        <p class=\"text-center\">Experience the power of innovative designs.</p>\n    </div>\n    <div class=\"column\">\n        <p class=\"size-32 font-medium text-center\">2.</p>\n        <h3 class=\"tracking-75 text-center size-21 font-normal\">Second Highlight</h3>\n        <p class=\"text-center\">Discover the magic of exceptional creativity.</p>\n    </div>\n    <div class=\"column\">\n        <p class=\"text-center size-32 font-medium\">3.</p>\n        <h3 class=\"tracking-75 text-center size-21 font-normal\">Third Highlight</h3>\n        <p class=\"text-center\">Unleash your imagination with outstanding designs.</p>\n    </div>\n</div>\n\n", "To add a list and numbering:\n- Create the required rows and column and add them inside the current 'div.is-container'.\n- Replace all the text in the example with the requested content.\n- For 3 list items, use 3 columns in a row. For 2 or 4 list items, use 2 columns per row.\n\nExample:\n\n<div class=\"row\">\n    <div class=\"column\">\n        <h1 class=\"tracking-tight size-50 text-left\">Title Here</h1>\n    </div>\n    <div class=\"xs-hidden column\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-120\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <p class=\"size-76\">01</p>\n        <div class=\"spacer height-20\"></div>\n        <h3 class=\"size-24 leading-12 font-normal\">First Highlight</h3>\n        <p>Experience the power of innovative designs.&nbsp;</p>\n    </div>\n    <div class=\"column\">\n        <p class=\"size-76\">02</p>\n        <div class=\"spacer height-20\"></div>\n        <h3 class=\"size-24 leading-12 font-normal\">Second Highlight</h3>\n        <p>Discover the magic of exceptional creativity.&nbsp;</p>\n    </div>\n    <div class=\"column\">\n        <p class=\"size-76\">03</p>\n        <div class=\"spacer height-20\"></div>\n        <h3 class=\"size-24 leading-12 font-normal\">Third Highlight</h3>\n        <p>Unleash your imagination with outstanding designs.&nbsp;</p>\n    </div>\n</div>\n\n"],
  update_section_article_with_image: "To add an article: \n- Create the required rows and column and add them inside the current 'div.is-container'.\n- Replace all the text in the example with the requested content.\n\nExample:\n\n<div class=\"row\">\n    <div class=\"column\">\n        <h1 class=\"font-normal leading-none size-60\">A forward thinking studio delivering digital solutions that help your business<br></h1>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n    <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\"><img src=\"{{IMAGEURL}}\" alt=\"\"></div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-60\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\">\n        <p>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n            when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>\n    </div>\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-40\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n    <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\">\n        <h2 class=\"size-28 font-normal\">Sub Topic 1</h2>\n        <div class=\"spacer height-20\"></div>\n        <p>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n            when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\">\n        <div class=\"spacer height-40\"></div>\n    </div>\n</div>\n<div class=\"row\">\n    <div class=\"column\" style=\"width: 75%; flex: 0 0 auto;\">\n        <h2 class=\"size-28 font-normal\">Sub Topic 2</h2>\n        <div class=\"spacer height-20\"></div>\n        <p>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,\n            when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>\n    </div>\n    <div class=\"column\">\n        <div class=\"spacer height-80\"></div>\n    </div>\n</div>\n\n",
  text_size: "- To increase or decrease text/font size, use one of these classes:\n    - size-12\n    - size-13\n    - size-14\n    - size-15\n    - size-16\n    - size-17\n    - size-18\n    - size-19\n    - size-20\n    - size-21\n    - size-24\n    - size-28\n    - size-32\n    - size-35\n    - size-38\n    - size-42\n    - size-46\n    - size-48\n    - size-50\n    - size-54\n    - size-60\n    - size-64\n    - size-68\n    - size-72\n    - size-76\n    - size-80\n    - size-84\n    - size-88\n    - size-92\n    - size-96\n    - size-100\n    - size-104\n    - size-108\n    - size-112\n    - size-116\n    - size-120\n    - size-124\n    - size-128\n    - size-132\n    - size-136\n    - size-140\n    - size-144\n    - size-148\n    - size-152\n    - size-156\n    - size-160\n    - size-164\n    - size-168\n    - size-172\n    - size-176\n    - size-180\n    - size-184\n    - size-188\n    - size-192\n    - size-196\n    - size-200\n"
};
/* harmony default export */ const context = (contextBlockList);
;// CONCATENATED MODULE: ./src/contentbuilder/command.js
function command_typeof(obj) { "@babel/helpers - typeof"; return command_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, command_typeof(obj); }
function command_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = command_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function command_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return command_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return command_arrayLikeToArray(o, minLen); }
function command_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }
function command_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function command_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { command_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { command_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function command_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function command_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, command_toPropertyKey(descriptor.key), descriptor); } }
function command_createClass(Constructor, protoProps, staticProps) { if (protoProps) command_defineProperties(Constructor.prototype, protoProps); if (staticProps) command_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function command_toPropertyKey(arg) { var key = command_toPrimitive(arg, "string"); return command_typeof(key) === "symbol" ? key : String(key); }
function command_toPrimitive(input, hint) { if (command_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (command_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }


var Command = /*#__PURE__*/function () {
  function Command(builder) {
    var _this = this;
    command_classCallCheck(this, Command);
    this.builder = builder;
    var util = this.builder.util;
    this.util = util;
    var builderStuff = this.builder.builderStuff;
    this.builderStuff = builderStuff;
    this.lib = new lib(builder);
    var html = "\n        <div class=\"is-modal ai-disclaimer\" style=\"z-index:10005\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n            <div class=\"is-modal-content\" style=\"max-width:450px;padding:55px 40px 35px;font-size:16px;line-height:1.4;letter-spacing: 1px;\">\n                <div class=\"is-modal-bar is-draggable\">\n                    ".concat(util.out('AI-Powered Features'), "\n                    <button class=\"is-modal-close\" tabindex=\"-1\" title=\"").concat(util.out('Close'), "\">&#10005;</button>\n                </div>\n                ").concat(util.out('AI-Disclaimer', this.builder.disclaimerAI), "\n                <div style=\"text-align:right;margin-top:20px;\">\n                    <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\" style=\"width:100%;text-transform: uppercase;\n                    font-size: 14px;\">").concat(util.out('Ok'), "</button>\n                </div>\n            </div>\n        </div>");
    builderStuff.insertAdjacentHTML('beforeend', html);
    this.modalDisclaimer = builderStuff.querySelector('.ai-disclaimer');
    var cl = context;
    if (this.builder.contextList) cl = this.builder.contextList;
    var localProcess = function localProcess(question) {
      if (_this.builder.enableShortCommands) {
        // Process Short Commands

        question = _this.builder.lib.processShortCommand(question); // Process the shortCommandList
        if (!question) return false;
        question = _this.processPrompt(question); // Process the commandList
        if (!question) return false;
      }
      return question;
    };
    var sendRewriteCommand = /*#__PURE__*/function () {
      var _ref = command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(question) {
        var container, docContainer, currentHtml, systemCmd, context, callback;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                container = _this.getContainer();
                docContainer = _this.builder.doc.querySelector(_this.builder.docContainer);
                if (!(!container && !docContainer)) {
                  _context.next = 6;
                  break;
                }
                _this.util.showMessage(_this.util.out('No text container found.'));
                _this.dictation.finish(); // Must be called after finished
                return _context.abrupt("return");
              case 6:
                currentHtml = '';
                if (container) currentHtml = _this.builder.readHtml(container, false, false);

                // Update prompt
                question = "".concat(question, ".\n\nThis is my current content:\n\n").concat(currentHtml, "\n");
                systemCmd = '';
                context = 'You are a helpful assistant. You will provide direct answers without a prologue.';
                callback = function callback(answer) {
                  if (_this.builder.consoleLog) console.log(answer);
                  systemCmd = 'You will be provided with a text content and your task is to put the content (completely) as it is in the provided template.';
                  var question = "Place my content in the provided template. Ensure that all the content are placed in the result. Feel free to add more rows/columns if needed, but don't change/add/reduce the content.\n\nThis is my content:\n\n".concat(answer, "\n");
                  var containsSingleSentence = function containsSingleSentence(text) {
                    var dotCount = (text.match(/\./g) || []).length;
                    return dotCount === 1;
                  };
                  var countWords = function countWords(str) {
                    var wordsArray = str.trim().split(/\s+/);
                    return wordsArray.length;
                  };
                  var context;
                  if (_this.builder.consoleLog) console.log(containsSingleSentence(answer), countWords(answer));
                  if (containsSingleSentence(answer) || countWords(answer) <= 100) {
                    context = cl.short_content;
                  } else {
                    context = cl.new_section_answer;
                  }
                  var callback = function callback(html) {
                    if (_this.builder.consoleLog) console.log(html);
                    html = _this.fixHtml(html);
                    if (!html) {
                      _this.dictation.finish(true);
                      return false;
                    }

                    // html = this.fixNewSection(html); // for new section only => Not needed (no icons or images here on the template)

                    // Render
                    _this.renderResult(html);
                    _this.dictation.finish();
                  };
                  if (_this.builder.consoleLog) {
                    console.log(systemCmd);
                    console.log(question);
                    console.log(context);
                  }
                  _this.sendCommand('html', question, context, systemCmd, [], callback);
                };
                if (_this.builder.consoleLog) {
                  console.log(systemCmd);
                  console.log(question);
                  console.log(context);
                }
                _this.sendCommand('assistant', question, context, systemCmd, [], callback);
              case 14:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));
      return function sendRewriteCommand(_x) {
        return _ref.apply(this, arguments);
      };
    }();
    var sendGeneralCommand = /*#__PURE__*/function () {
      var _ref2 = command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(question) {
        var container, docContainer;
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                container = _this.getContainer();
                docContainer = _this.builder.doc.querySelector(_this.builder.docContainer);
                if (!(!container && !docContainer)) {
                  _context2.next = 6;
                  break;
                }
                _this.util.showMessage(_this.util.out('No text container found.'));
                _this.dictation.finish(); // Must be called after finished
                return _context2.abrupt("return");
              case 6:
                _this.sendCommand('analyze', "This is the command: \"".concat(question, "\""), '', 'You will analyze the user\'s command and return what the user needs.', _this.lib.getFunctions(), function (response) {
                  var args = JSON.parse(response);
                  if (_this.builder.consoleLog) console.log(args);
                  if (args.asking_info && !args.add_info) {
                    if (_this.builder.consoleLog) console.log('asking_info');
                    sendOtherCommand(question);
                    return;
                  }
                  if (args.write_based_on_the_current_content && !args.new_content) {
                    // summarize, expand, make short, add more info, etc'
                    if (_this.builder.consoleLog) console.log('write_based_on_the_current_content');
                    sendRewriteCommand(question);
                    return;
                  }
                  var numberOfIntents = Object.keys(args).length;

                  // SIMPLE (1 or 2) INTENTS
                  var activeCol = _this.builder.activeCol;
                  if (activeCol) {
                    // && numberOfIntents<=2) {

                    // Update Column or Block (in General Mode)
                    if (args.align_individual_text || args.font_size_individual_text || args.line_height_individual_text) {
                      sendUpdateBlockCommand(question, args);
                      return;
                    }

                    // Add new Column or Block (in General Mode)
                    if (args.add_column_or_block) {
                      sendBlockCommand(question);
                      return;
                    }
                  }

                  // SIMPLE/SINGLE INTENT (like Short Commands)
                  if (numberOfIntents === 1) {
                    // Block Mode (in General Mode)
                    var result = _this.blockAction(args);
                    if (result) {
                      _this.dictation.finish();
                      return;
                    }
                    result = _this.quickAction(args);
                    if (result) {
                      _this.dictation.finish();
                      return;
                    }
                  }

                  // Get relevant context
                  var context = '';
                  var currentContent = '';
                  var container = _this.getContainer();
                  if (container) currentContent = _this.builder.readHtml(container, false, false);
                  if (args.new_content || currentContent.trim() === '') {
                    if (args.new_content) {
                      if (args.add_image === 'gallery') {
                        context = cl.new_section_with_gallery;
                      } else if (args.add_list_with_image) {
                        context = cl.new_section_with_list_images;
                      } else if (args.add_list_with_icon) {
                        context = cl.new_section_with_list_icons;
                      } else if (args.add_list_with_number) {
                        context = _this.chooseContext(cl.new_section_with_list_numbering);
                      } else if (args.add_list && !args.add_article) {
                        context = cl.new_section_with_list;
                      } else if (args.add_article && args.add_image === 'image') {
                        context = _this.chooseContext(cl.new_section_article_with_image);
                      } else if (args.add_article) {
                        context = _this.chooseContext(cl.new_section_article);
                      } else if ((args.add_headline || args.add_paragraph) && args.add_image === 'image') {
                        context = cl.new_section_with_image;
                      } else {
                        context = cl.new_section_others;
                      }

                      /*
                      Handle Unrelated Request
                      */
                      if (args.others) {
                        context = cl.new_section_others;
                        // Update prompt
                        question = "Add a new section containing your response on this user request: ".concat(question);
                      }

                      // Replace {{_IMAGEURL}}
                      if (context.includes('{{_IMAGEURL}}')) {
                        var gallery = _this.builder.media.images;
                        var imageList = gallery.square;
                        var imageUrl = _this.lib.chooseMedia(imageList);
                        context = context.replaceAll('{{_IMAGEURL}}', imageUrl);
                      }
                    } else {
                      context = _this.chooseContext(cl.new_section_article);
                      // Or use: context = cl.new_section_others;
                    }
                  } else {
                    //if(args.redesign_layout || args.change_text || args.change_style || args.add_info) {

                    var currentHtml = '<div class="is-container">' + currentContent + '</div>';
                    var redesign_request = '';
                    if (args.redesign_layout) {
                      // get title tag
                      var titleElm, titleTag;
                      if (container) {
                        titleElm = container.querySelector('h1,h2');
                        if (titleElm) titleTag = titleElm.tagName.toLowerCase();
                      }

                      // Update prompt
                      redesign_request = 'Change the placement of the title, paragraph and all elements in my section based on the layout template. ';

                      // Update context
                      var val;
                      if (localStorage.getItem('_context_num') !== null) {
                        val = localStorage.getItem('_context_num');
                      } else {
                        val = 'random';
                      }
                      if (val === '') {
                        context = '';
                      } else if (val === 'random') {
                        context = _this.chooseContext(cl.redesign_layout);
                      } else {
                        context = _this.chooseContext(cl.redesign_layout, val);
                      }

                      // set title tag
                      if (titleTag === 'h2') {
                        context = context.replaceAll('h1', 'h2');
                      }
                    }

                    // Update prompt
                    question = "".concat(redesign_request).concat(question, ". Modify my section according to this instruction and returns the modified section HTML.\n\nThis is my section:\n            \n").concat(currentHtml, "\n");
                    if (args.change_text) {
                      // Do Nothing
                    } else {
                      if ((args.add_headline || args.add_paragraph) && args.add_image === 'image') {
                        context += '\n' + cl.update_section_with_image;
                      } else if (args.add_image === 'gallery') {
                        context += '\n' + cl.update_section_with_gallery;
                      } else if (args.add_list_with_image) {
                        context += '\n' + cl.update_section_with_list_images;
                      } else if (args.add_list_with_icon) {
                        context += '\n' + cl.update_section_with_list_icons;
                      } else if (args.add_list_with_number) {
                        context += '\n' + _this.chooseContext(cl.update_section_with_list_numbering);
                      } else if (args.add_list) {
                        context += '\n' + cl.update_section_with_list;
                      } else if (args.add_article && args.add_image === 'image') {
                        context += '\n' + cl.update_section_article_with_image;
                      } else if (args.add_article) {
                        context += '\n' + cl.update_section_article_with_image;
                      } else {
                        // Do Nothing
                      }
                    }
                    if (context.includes('{{_IMAGEURL}}')) {
                      //Replace {{_IMAGEURL}}
                      var _gallery = _this.builder.media.images;
                      var _imageList = _gallery.square;
                      var _imageUrl = _this.lib.chooseMedia(_imageList);
                      context = context.replaceAll('{{_IMAGEURL}}', _imageUrl);
                    }
                  }

                  // Check elements and add relevant context
                  context = _this.lib.addElementContext(context, args);

                  // Send

                  var systemCmd = "You will be provided with HTML code to modify, and your task is to return only the modified HTML code, excluding any introductions or explanations\n";
                  if (args.new_content) {
                    systemCmd = 'Your task it to create and return HTML content, excluding any introductions or explanations.';
                  }
                  var callback = function callback(html) {
                    if (_this.builder.consoleLog) console.log(html);
                    html = _this.fixHtml(html);
                    if (!html) {
                      _this.dictation.finish(true);
                      return false;
                    }
                    if (!args.new_content) {
                      // Redesign & Editing (text or style)

                      html = _this.fixButtons(html);
                      html = _this.fixCustomCode(html);
                      html = _this.analyzeTitle(html, context);

                      // Render
                      _this.renderResult(html);
                    } else {
                      // New Section

                      html = _this.fixButtons(html);
                      html = _this.fixNewSection(html); // for new section only

                      // Render
                      _this.renderResult(html);
                    }
                    _this.dictation.finish(); // Must be called after finished
                  };

                  if (_this.builder.consoleLog) {
                    console.log(systemCmd);
                    console.log(question);
                    console.log(context);
                  }
                  _this.sendCommand('html', question, context, systemCmd, [], callback);
                });
              case 7:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));
      return function sendGeneralCommand(_x2) {
        return _ref2.apply(this, arguments);
      };
    }();
    var sendBlockCommand = /*#__PURE__*/function () {
      var _ref3 = command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(question) {
        var block, blockContent, context;
        return regeneratorRuntime.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                block = _this.builder.activeCol;
                if (block) {
                  _context3.next = 5;
                  break;
                }
                _this.util.showMessage(_this.util.out('Please select a block or content.'));
                _this.dictation.finish(); // Must be called after finished
                return _context3.abrupt("return");
              case 5:
                blockContent = block.innerHTML;
                context = '';
                _this.sendCommand('analyze', "This is the command: \"".concat(question, "\""), '', 'You will analyze the user\'s command and return what the user needs.', _this.lib.getFunctions_block(), function (response) {
                  var args = JSON.parse(response);
                  if (_this.builder.consoleLog) console.log(args);
                  var numberOfIntents = Object.keys(args).length;
                  if (numberOfIntents === 1) {
                    var result = _this.blockAction(args);
                    if (result) {
                      _this.dictation.finish();
                      return;
                    }
                  }
                  var systemCmd;
                  if (args.new_block) {
                    systemCmd = 'You will be asked to create content (in HTML) and return the HTML without any additional explanation.';
                    context = "To add a content/block:\n- Create the required rows and column and add them inside the 'div.column' element:\n\n    <div class=\"row\">\n        <div class=\"column\">\n            {{CONTENT}}\n        </div>\n    </div>\n\nExample: To create a block with a headline and a paragraph:\n\n    <div class=\"row\">\n        <div class=\"column\">\n            <h2 class=\"font-normal leading-none size-48\">Heading here</h2>\n            <p>Paragraph here.</p>\n        </div>\n    </div>\n                        \n";
                  } else if (numberOfIntents === 1 && (args.new_column_onright || args.new_column_onleft)) {
                    // single intent => no content details

                    systemCmd = 'You will be asked to create a single HTML block/column and return the HTML without any additional explanation.';
                    context = "To create a column, create single 'div.column' element and add a paragraph inside it.\n\nExample:\n\n    <div class=\"column\">\n        <p>Paragraph here.</p>\n    </div>\n  \n";
                    question = "".concat(question, ".  No talk; just do. You must return only one 'div.column'.");
                  } else if (args.new_column_onright || args.new_column_onleft) {
                    systemCmd = 'You will be asked to create content (in HTML) and return the HTML without any additional explanation.';
                    context = "To add a column that contains a content:\n- Create one 'div.column' element and add the content inside it:\n\n    <div class=\"column\">\n        {{CONTENT}}\n    </div>\n\nExample 1: To create a column with a headline and a paragraph:\n\n    <div class=\"column\">\n        <h2 class=\"font-normal leading-none size-48\">Heading here</h2>\n        <p>Paragraph here.</p>\n    </div>\n\n\nExample 2: To create a column with an image:\n\n    <div class=\"column\">\n        <img src=\"{{IMAGEURL}}\">\n    </div>\n  \n";
                  } else {
                    systemCmd = 'You will be asked to modify content (in HTML) and return only the modified HTML without any additional explanation.';

                    // Update prompt
                    question = "".concat(question, ". Modify my content according to this instruction and returns the modified content HTML.\n\nThis is my content:\n            \n").concat(blockContent, "\n");
                  }
                  context = _this.lib.elementContext(context, args);
                  if (_this.builder.consoleLog) {
                    console.log(systemCmd);
                    console.log(question);
                    console.log(context);
                  }
                  var callback = function callback(answer) {
                    if (_this.builder.consoleLog) console.log(answer);

                    // if(args.new_block||args.new_column_onright||args.new_column_onleft) {
                    //     html = this.fixHtmlBlock(answer, true); // wrap = true
                    // } else {
                    //     html = this.fixHtmlBlock(answer);
                    // }

                    html = _this.fixHtmlBlock(answer);
                    if (!html) {
                      _this.dictation.finish(true);
                      return false;
                    }
                    if (args.new_column_onright || args.new_column_onleft) {
                      html = _this.fixNewBlock(answer);
                    }
                    _this.builder.saveForUndo();
                    if (args.new_block) {
                      if (block) {
                        var row = block.parentNode;
                        if (row) {
                          row.insertAdjacentHTML('afterend', html);
                          setTimeout(function () {
                            row.nextElementSibling.firstElementChild.click();
                          }, 300);
                        }
                      }
                    } else if (args.new_column_onright) {
                      if (block) {
                        var _row = block.parentNode;
                        block.insertAdjacentHTML('afterend', html);
                        _this.builder.util.fixLayout(_row);
                        setTimeout(function () {
                          block.nextElementSibling.click();
                        }, 300);
                      }
                    } else if (args.new_column_onleft) {
                      if (block) {
                        var _row2 = block.parentNode;
                        block.insertAdjacentHTML('beforebegin', html);
                        _this.builder.util.fixLayout(_row2);
                        setTimeout(function () {
                          block.previousElementSibling.click();
                        }, 300);
                      }
                    } else {
                      // if(this.builder.consoleLog) console.log('sendBlockCommand => update cell content');

                      block.innerHTML = html;
                      var elmActive = block.querySelector('.elm-active');
                      if (elmActive) {
                        _this.builder.activeElement = elmActive;
                        elmActive.focus();
                      }
                    }

                    // See addContent() in ContentBuilder's util.js
                    var builderActive = _this.builder.doc.querySelector('.builder-active');
                    if (builderActive) _this.builder.applyBehaviorOn(builderActive);
                    _this.builder.hideElementTools();
                    _this.builder.settings.onChange();
                    _this.builder.settings.onRender();
                    _this.dictation.finish();
                  };
                  _this.sendCommand('assistant', question, context, systemCmd, [], callback);
                });
              case 8:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3);
      }));
      return function sendBlockCommand(_x3) {
        return _ref3.apply(this, arguments);
      };
    }();

    // Update Column or Block (in General Mode)
    var sendUpdateBlockCommand = /*#__PURE__*/function () {
      var _ref4 = command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(question, args) {
        var block, blockContent, systemCmd, context, callback;
        return regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                block = _this.builder.activeCol;
                if (block) {
                  _context4.next = 5;
                  break;
                }
                _this.builder.showMessage(_this.util.out('Please select a block or content.'));
                _this.dictation.finish(); // Must be called after finished
                return _context4.abrupt("return");
              case 5:
                blockContent = block.innerHTML;
                systemCmd = 'You will be asked to modify content (in HTML) and return only the modified HTML without any additional explanation.'; // Update prompt
                question = "".concat(question, ". Modify my content according to this instruction and returns the modified content HTML.\n            \nThis is my content:\n                \n").concat(blockContent, "\n");
                context = _this.lib.addElementContext('', args);
                if (_this.builder.consoleLog) {
                  console.log(systemCmd);
                  console.log(question);
                  console.log(context);
                }
                callback = function callback(answer) {
                  if (_this.builder.consoleLog) console.log(answer);
                  html = _this.fixHtmlBlock(answer); // wrap = false
                  if (!html) {
                    _this.dictation.finish(true);
                    return false;
                  }
                  _this.builder.saveForUndo();

                  // if(this.builder.consoleLog) console.log('sendUpdateBlockCommand => update cell content');

                  block.innerHTML = html;
                  var elmActive = block.querySelector('.elm-active');
                  if (elmActive) {
                    _this.builder.activeElement = elmActive;
                    elmActive.focus();
                  }

                  // See addContent() in ContentBuilder's util.js
                  var builderActive = _this.builder.doc.querySelector('.builder-active');
                  if (builderActive) _this.builder.applyBehaviorOn(builderActive);
                  _this.builder.hideElementTools();
                  _this.builder.settings.onChange();
                  _this.builder.settings.onRender();
                  _this.dictation.finish();
                };
                _this.sendCommand('assistant', question, context, systemCmd, [], callback);
              case 12:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4);
      }));
      return function sendUpdateBlockCommand(_x4, _x5) {
        return _ref4.apply(this, arguments);
      };
    }();
    var sendOtherCommand = /*#__PURE__*/function () {
      var _ref5 = command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(question) {
        var container, docContainer, systemCmd, context, callback;
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                container = _this.getContainer();
                docContainer = _this.builder.doc.querySelector(_this.builder.docContainer);
                if (!(!container && !docContainer)) {
                  _context5.next = 6;
                  break;
                }
                _this.util.showMessage(_this.util.out('No text container found.'));
                _this.dictation.finish(); // Must be called after finished
                return _context5.abrupt("return");
              case 6:
                systemCmd = '';
                context = 'You are a helpful assistant. You don\'t need to answer \'Sure!\' or \'Certainly\'. You will just provide direct answers without a prologue. No talk; just do.';
                callback = function callback(answer) {
                  if (_this.builder.consoleLog) console.log(answer);
                  var systemCmd = 'You will be provided with a text content and your task is to put the content (completely) as it is in the provided template.';
                  var question = "Place my content in the provided template. Ensure that all the content are placed in the result. Feel free to add more rows/columns if needed, but don't change/add/reduce the content.\n\nThis is my content:\n\n".concat(answer, "\n");
                  var containsSingleSentence = function containsSingleSentence(text) {
                    // Count the occurrences of dots (periods)
                    var dotCount = (text.match(/\./g) || []).length;
                    // If there's exactly one dot, it's likely a single sentence
                    return dotCount === 1;
                  };
                  var countWords = function countWords(str) {
                    // Remove extra whitespaces and split the string into words
                    var wordsArray = str.trim().split(/\s+/);
                    // Return the count of words
                    return wordsArray.length;
                  };
                  var context;
                  if (_this.builder.consoleLog) console.log(containsSingleSentence(answer), countWords(answer));
                  if (containsSingleSentence(answer) || countWords(answer) <= 100) {
                    context = cl.short_content;
                  } else {
                    context = cl.new_section_answer;
                  }
                  var callback = function callback(html) {
                    if (_this.builder.consoleLog) console.log(html);
                    html = _this.fixHtml(html);
                    if (!html) {
                      _this.dictation.finish(true);
                      return false;
                    }

                    // html = this.fixNewSection(html); // for new section only => Not needed (no icons or images here on the template)

                    // Render
                    _this.renderResult(html);
                    _this.dictation.finish();
                  };
                  if (_this.builder.consoleLog) {
                    console.log(systemCmd);
                    console.log(question);
                    console.log(context);
                  }
                  _this.sendCommand('html', question, context, systemCmd, [], callback);
                };
                if (_this.builder.consoleLog) {
                  console.log(systemCmd);
                  console.log(question);
                  console.log(context);
                }
                _this.sendCommand('assistant', question, context, systemCmd, [], callback);
              case 11:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5);
      }));
      return function sendOtherCommand(_x6) {
        return _ref5.apply(this, arguments);
      };
    }();
    var sendImageCommand = /*#__PURE__*/function () {
      var _ref6 = command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7(prompt) {
        var displayImage;
        return regeneratorRuntime.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _this.dictation.startSending(); // Shows sending status & Abort button
                displayImage = function displayImage(src) {
                  _this.builder.saveForUndo();
                  var elm = _this.builder.activeElement;
                  if (elm && elm.tagName) {
                    var tagName = elm.tagName.toLowerCase();
                    if (tagName === 'img') {
                      _this.builder.saveForUndo();
                      elm.onload = /*#__PURE__*/command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {
                        var divImageResizer;
                        return regeneratorRuntime.wrap(function _callee6$(_context6) {
                          while (1) {
                            switch (_context6.prev = _context6.next) {
                              case 0:
                                divImageResizer = document.querySelector('#divImageResizer');
                                if (divImageResizer) divImageResizer.click();
                              case 2:
                              case "end":
                                return _context6.stop();
                            }
                          }
                        }, _callee6);
                      }));
                      elm.setAttribute('src', src);
                      _this.builder.onChange();
                    } else {
                      _this.renderImage(src);
                    }
                  } else {
                    _this.renderImage(src);
                  }
                  _this.dictation.finish();
                };
                _this.builder.generateImage(prompt, displayImage);
              case 3:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7);
      }));
      return function sendImageCommand(_x7) {
        return _ref6.apply(this, arguments);
      };
    }();

    // Dictation Panel 
    this.dictation = this.builder.dictation;
    this.dictation.opts.send = function (question) {
      if (_this.builder.assistantMode === 'image') {
        sendImageCommand(question);
        return;
      }

      // Local Process
      question = localProcess(question);
      if (!question) return;

      // Go to OpenAI
      if (_this.builder.assistantMode === 'general') {
        sendGeneralCommand(question);
      } else if (_this.builder.assistantMode === 'others') {
        sendOtherCommand(question);
      } else if (_this.builder.assistantMode === 'block') {
        sendBlockCommand(question);
      }
    };
    this.dictation.opts.abort = function () {
      if (_this.controller) _this.controller.abort();
      if (_this.builder.controller) {
        // Abort for image
        _this.builder.controller.abort();
      }
      _this.dictation.finish(true); // Must be called after finished (true = do not clear command text)
    };
  }
  command_createClass(Command, [{
    key: "getContainer",
    value: function getContainer() {
      var container, builderActive;
      builderActive = this.builder.doc.querySelector('.builder-active');
      if (builderActive) container = builderActive;else {
        if (this.builder.canvas && !this.builder.isContentBox && this.builder.docContainer) {
          // canvas mode
          var activeBlock = this.builder.doc.querySelector('.is-block.cloned');
          if (!activeBlock) activeBlock = this.builder.doc.querySelector('.is-block.active');
          if (activeBlock) {
            container = activeBlock.querySelector(this.builder.container);
            if (!container) container = this.builder.doc.querySelector(this.builder.container);
          } else {
            var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
            var blockContainer = docContainer.querySelector('.box-select');
            if (!blockContainer) {
              blockContainer = docContainer.querySelector(this.builder.blockContainer);
            }
            if (blockContainer) {
              container = blockContainer.querySelector(this.builder.container);
            } else {
              container = this.builder.doc.querySelector(this.builder.container);
            }
          }
        } else {
          // standard mode
          container = this.builder.doc.querySelector(this.builder.container);
        }
      }
      return container;
    }
  }, {
    key: "renderImage",
    value: function renderImage(src) {
      this.builder.saveForUndo();
      if (this.builder.canvas && !this.builder.isContentBox && this.builder.docContainer) {
        var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
        var blockContainer = docContainer.querySelector('.box-select');
        if (!blockContainer) {
          blockContainer = docContainer.querySelector(this.builder.blockContainer);
        }
        if (!blockContainer) {
          this.builder.addPage();
          blockContainer = docContainer.querySelector(this.builder.blockContainer);
        }
        var html = "\n            <div class=\"is-block\" style=\"top:15%;left:30%;width:760px;height:760px;\">\n                <div class=\"is-block-overlay\" style=\"background-image: url(&quot;".concat(src, "&quot;);\"></div>\n            </div>\n            ");
        this.builder.addBlock(html, blockContainer);
        this.builder.settings.onChange();
        this.builder.settings.onRender();
        return;
      }
      var container = this.getContainer();
      if (!container) {
        /*
        if(this.builder.canvas) {
             // Canvas Mode
            const docContainer = this.builder.doc.querySelector(this.builder.docContainer);
            if(docContainer) {
                
                // <div class="is-block block-steady height-auto" style="top: calc(24.4455% - 37.646px);left: calc(50% - 332px);width: 664px;">
                //     <div class="is-container leading-12 size-17">
                //         <div class="row"><div class="column"><img src="${src}"></div></div>
                //     </div>
                // </div>
                let html = `
                <div class="is-block" style="top:15%;left:30%;width:760px;height:760px;">
                    <div class="is-block-overlay" style="background-image: url(&quot;${src}&quot;);"></div>
                </div>
                `;
                 const blockContainer = docContainer.querySelector(this.builder.blockContainer);
                this.builder.addBlock(html, blockContainer);
            }
         } else {
            this.util.showMessage(this.util.out('No text container found.'));
            this.dictation.finish(); // Must be called after finished
            return;
        }
        */
        this.util.showMessage(this.util.out('No text container found.'));
        this.dictation.finish(); // Must be called after finished
        return;
      } else {
        /*
        if(this.builder.canvas) {
             // Canvas Mode
            const docContainer = this.builder.doc.querySelector(this.builder.docContainer);
            if(docContainer) {
                
                let html = `
                <div class="is-block" style="top:15%;left:30%;width:760px;height:760px;">
                    <div class="is-block-overlay" style="background-image: url(&quot;${src}&quot;);"></div>
                </div>
                `;
                 const blockContainer = docContainer.querySelector(this.builder.blockContainer);
                this.builder.addBlock(html, blockContainer);
            }
          } else {
            // Normal
            let html = `
                    <div class="row"><div class="column"><img src="${src}"></div></div>
            `;
            container.insertAdjacentHTML('afterBegin', html);
            setTimeout(()=>{
                container.firstElementChild.click();
            }, 300);
            this.builder.applyBehaviorOn(container);
        }
        */
        // Normal
        var _html = "\n                    <div class=\"row\"><div class=\"column\"><img src=\"".concat(src, "\"></div></div>\n            ");
        container.insertAdjacentHTML('afterBegin', _html);
        setTimeout(function () {
          container.firstElementChild.click();
        }, 300);
        this.builder.applyBehaviorOn(container);
      }
      this.builder.settings.onChange();
      this.builder.settings.onRender();
    }
  }, {
    key: "renderResult",
    value: function renderResult(html) {
      this.builder.saveForUndo();
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');
      var elm = doc.querySelector('.is-container');
      if (elm) {
        html = elm.innerHTML;
      }
      if (this.builder.canvas && !this.builder.isContentBox && this.builder.docContainer) {
        var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
        var blockContainer = docContainer.querySelector('.box-select');
        if (!blockContainer) {
          blockContainer = docContainer.querySelector(this.builder.blockContainer);
        }
        if (!blockContainer) {
          this.builder.addPage();
          blockContainer = docContainer.querySelector(this.builder.blockContainer);
        }
        html = "\n            <div class=\"is-block block-steady height-auto\" style=\"top: calc(24.4455% - 37.646px);left: calc(50% - 332px);width: 664px;\">\n                <div class=\"is-container leading-12 size-17\">\n                    ".concat(html, "\n                </div>\n            </div>\n            ");
        this.builder.addBlock(html, blockContainer);
        this.builder.settings.onChange();
        this.builder.settings.onRender();
        return;
      }
      var container = this.getContainer();
      if (!container) {
        /*
        if(this.builder.canvas) {
             // Canvas Mode
            const docContainer = this.builder.doc.querySelector(this.builder.docContainer);
            if(docContainer) {
                
                html = `
                <div class="is-block block-steady height-auto" style="top: calc(24.4455% - 37.646px);left: calc(50% - 332px);width: 664px;">
                    <div class="is-container leading-12 size-17">
                        ${html}
                    </div>
                </div>
                `;
                 const blockContainer = docContainer.querySelector(this.builder.blockContainer);
                this.builder.addBlock(html, blockContainer);
            }
         } else {
            this.util.showMessage(this.util.out('No text container found.'));
            this.dictation.finish(); // Must be called after finished
            return;
        }
        */
        this.util.showMessage(this.util.out('No text container found.'));
        this.dictation.finish(); // Must be called after finished
        return;
      } else {
        /*
        if(this.builder.canvas) {
             // Canvas Mode
            const docContainer = this.builder.doc.querySelector(this.builder.docContainer);
            if(docContainer) {
                
                html = `
                <div class="is-block block-steady height-auto" style="top: calc(24.4455% - 37.646px);left: calc(50% - 332px);width: 664px;">
                    <div class="is-container leading-12 size-17">
                        ${html}
                    </div>
                </div>
                `;
                 const blockContainer = docContainer.querySelector(this.builder.blockContainer);
                this.builder.addBlock(html, blockContainer);
            }
          } else {
            // Normal
            container.insertAdjacentHTML('afterBegin', html);
            setTimeout(()=>{
                container.firstElementChild.click();
            }, 300);
            this.builder.applyBehaviorOn(container);
        }
        */
        // Normal
        container.insertAdjacentHTML('afterBegin', html);
        setTimeout(function () {
          container.firstElementChild.click();
        }, 300);
        this.builder.applyBehaviorOn(container);
      }
      this.builder.settings.onChange();
      this.builder.settings.onRender();
    }
  }, {
    key: "sendCommand",
    value: function () {
      var _sendCommand = command_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8(mode, question, context, system, functs, callback) {
        var _this2 = this;
        var temperature, topP, num, messages, data, response, _response, _data;
        return regeneratorRuntime.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                this.dictation.startSending(); // Shows sending status & Abort button

                this.controller = new AbortController(); // Create a new AbortController
                this.signal = this.controller.signal; // Get a new signal object
                temperature = localStorage.getItem('_temp') || this.builder.temperature;
                topP = localStorage.getItem('_top_p') || this.builder.topP;
                num = 1;
                messages = {
                  question: question,
                  context: context,
                  system: system,
                  functs: functs,
                  temperature: temperature,
                  topP: topP,
                  num: num
                };
                _context8.prev = 7;
                if (!this.builder.sendCommand) {
                  _context8.next = 14;
                  break;
                }
                _context8.next = 11;
                return this.builder.sendCommand(messages);
              case 11:
                data = _context8.sent;
                _context8.next = 20;
                break;
              case 14:
                _context8.next = 16;
                return fetch(this.builder.sendCommandUrl, {
                  signal: this.signal,
                  // Abort
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(messages)
                });
              case 16:
                response = _context8.sent;
                _context8.next = 19;
                return response.json();
              case 19:
                data = _context8.sent;
              case 20:
                if (!data.error) {
                  _context8.next = 25;
                  break;
                }
                // Error response from OpenAI goes here.
                console.log('Error:\n' + data.error);

                // ex. wrong API Key => Request failed with status code 401
                this.util.showMessage(this.util.out('Request failed.'));
                this.dictation.finish(); // Must be called after finished
                return _context8.abrupt("return");
              case 25:
                if (!(mode === 'html')) {
                  _context8.next = 29;
                  break;
                }
                // console.log(data.answer.usage);

                data.answer.choices.forEach(function (item) {
                  var html = item.message.content;
                  html = _this2.getHtmlResult(html);
                  if (!html) {
                    _this2.util.showMessage(_this2.util.out('Oops! The response received is insufficient. Please try again.'));
                    _this2.dictation.finish(); // Must be called after finished

                    return;
                  }
                  callback(html);
                });
                _context8.next = 37;
                break;
              case 29:
                if (!(mode === 'assistant')) {
                  _context8.next = 33;
                  break;
                }
                data.answer.choices.forEach(function (item) {
                  var answer = item.message.content;
                  callback(answer);
                });
                _context8.next = 37;
                break;
              case 33:
                if (!(data.answer.role && data.answer.content)) {
                  _context8.next = 36;
                  break;
                }
                callback(JSON.stringify({
                  new_section: true,
                  others: true
                })); // Just create a new section
                return _context8.abrupt("return");
              case 36:
                callback(data.answer);
              case 37:
                _context8.next = 56;
                break;
              case 39:
                _context8.prev = 39;
                _context8.t0 = _context8["catch"](7);
                if (!(_context8.t0.name === 'AbortError')) {
                  _context8.next = 44;
                  break;
                }
                _context8.next = 56;
                break;
              case 44:
                // CORS or code errors goes here
                console.error('Error:', _context8.t0);
                // console.log('Error:\n'+error);

                this.dictation.finish(); // Must be called after finished

                // Debug
                if (!this.builder.consoleLog) {
                  _context8.next = 55;
                  break;
                }
                if ((_context8.t0 + '').includes('Failed to fetch')) {
                  _context8.next = 55;
                  break;
                }
                _context8.next = 50;
                return fetch(this.builder.sendCommandUrl, {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(messages)
                });
              case 50:
                _response = _context8.sent;
                _context8.next = 53;
                return _response.text();
              case 53:
                _data = _context8.sent;
                console.log('Response:\n' + _data); // Shows code error
              case 55:
                this.util.showMessage(this.util.out('Service Unavailable.'));
              case 56:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this, [[7, 39]]);
      }));
      function sendCommand(_x8, _x9, _x10, _x11, _x12, _x13) {
        return _sendCommand.apply(this, arguments);
      }
      return sendCommand;
    }() //-------------------
  }, {
    key: "processPrompt",
    value: function processPrompt(question) {
      var intent = this.builder.similarity.check(question);
      // console.log(intent);

      if (!intent) return question;
      if (intent === 'move_row_up') {
        this.builder.saveForUndo();
        this.builder.moveRowUp();
        this.builder.settings.onChange();
      } else if (intent === 'move_row_down') {
        this.builder.saveForUndo();
        this.builder.moveRowDown();
        this.builder.settings.onChange();
      } else if (intent === 'duplicate_row') {
        this.builder.saveForUndo();
        this.builder.duplicateRow();
        this.builder.settings.onChange();
      } else if (intent === 'remove_row') {
        this.builder.saveForUndo();
        this.builder.removeRow();
        this.builder.settings.onChange();
      } else if (intent === 'move_col_left') {
        this.builder.saveForUndo();
        this.builder.moveColumnLeft();
        this.builder.settings.onChange();
      } else if (intent === 'move_col_right') {
        this.builder.saveForUndo();
        this.builder.moveColumnRight();
        this.builder.settings.onChange();
      } else if (intent === 'duplicate_col') {
        this.builder.saveForUndo();
        this.builder.duplicateColumn();
        this.builder.settings.onChange();
      } else if (intent === 'remove_col') {
        this.builder.saveForUndo();
        this.builder.removeColumn();
        this.builder.settings.onChange();
      } else if (intent === 'move_column_up') {
        this.builder.saveForUndo();
        this.builder.moveColumnUp();
        this.builder.settings.onChange();
      } else if (intent === 'move_column_down') {
        this.builder.saveForUndo();
        this.builder.moveColumnDown();
        this.builder.settings.onChange();
      } else if (intent === 'increase_font_size') {
        var elm = this.builder.activeElement;
        if (elm) {
          this.builder.saveForUndo();
          this.builder.lib.increaseFontSize(elm);
          this.builder.settings.onChange();
        }
      } else if (intent === 'decrease_font_size') {
        var _elm = this.builder.activeElement;
        if (_elm) {
          this.builder.saveForUndo();
          this.builder.lib.decreaseFontSize(_elm);
          this.builder.settings.onChange();
        }
      } else if (intent === 'clear_font_size') {
        var _elm2 = this.builder.activeElement;
        if (_elm2) {
          this.builder.saveForUndo();
          this.builder.lib.clearFontSize(_elm2);
          this.builder.settings.onChange();
        }
      } else if (intent === 'align_left') {
        var _elm3 = this.builder.activeElement;
        if (_elm3) {
          this.builder.saveForUndo();
          this.builder.lib.alignText(_elm3, 'left');
          this.builder.settings.onChange();
        }
      } else if (intent === 'align_center') {
        var _elm4 = this.builder.activeElement;
        if (_elm4) {
          this.builder.saveForUndo();
          this.builder.lib.alignText(_elm4, 'center');
          this.builder.settings.onChange();
        }
      } else if (intent === 'align_right') {
        var _elm5 = this.builder.activeElement;
        if (_elm5) {
          this.builder.saveForUndo();
          this.builder.lib.alignText(_elm5, 'right');
          this.builder.settings.onChange();
        }
      } else if (intent === 'align_full') {
        var _elm6 = this.builder.activeElement;
        if (_elm6) {
          this.builder.saveForUndo();
          this.builder.lib.alignText(_elm6, 'justify');
          this.builder.settings.onChange();
        }
      } else if (intent === 'clear_alignment') {
        var _elm7 = this.builder.activeElement;
        if (_elm7) {
          this.builder.saveForUndo();
          this.builder.lib.alignText(_elm7, '');
          this.builder.settings.onChange();
        }
      } else if (intent === 'increase_space') {
        var _elm8 = this.builder.activeElement;
        if (_elm8) {
          this.builder.saveForUndo();
          this.builder.lib.increaseElementHeight(_elm8);
          this.builder.settings.onChange();
        }
      } else if (intent === 'decrease_space') {
        var _elm9 = this.builder.activeElement;
        if (_elm9) {
          this.builder.saveForUndo();
          this.builder.lib.decreaseElementHeight(_elm9);
          this.builder.settings.onChange();
        }
      } else if (intent === 'increase_line_height') {
        var _elm10 = this.builder.activeElement;
        if (_elm10) {
          this.builder.saveForUndo();
          this.builder.lib.increaseLineHeight(_elm10);
          this.builder.settings.onChange();
        }
      } else if (intent === 'decrease_line_height') {
        var _elm11 = this.builder.activeElement;
        if (_elm11) {
          this.builder.saveForUndo();
          this.builder.lib.decreaseLineHeight(_elm11);
          this.builder.settings.onChange();
        }
      } else {
        return question; // Pass to ChatGPT
      }
    }

    //-------------------
  }, {
    key: "openDictation",
    value: function openDictation() {
      this.dictation.openDictation();
    }
  }, {
    key: "getHtmlResult",
    value: function getHtmlResult(html) {
      if (html.indexOf('```') !== -1) {
        var regex = /<div[^>]*>[\s\S]*<\/div>/;
        var matches = html.match(regex);
        var extractedString = matches && matches[0];
        html = extractedString;
      }
      return html;
    }
  }, {
    key: "getHtmlBlock",
    value: function getHtmlBlock(html, wrap) {
      var startIndex = html.indexOf('<');
      var endIndex = html.lastIndexOf('>') + 1;
      if (startIndex !== -1 && endIndex !== -1) {
        var extractedHTML = html.substring(startIndex, endIndex);
        html = extractedHTML;
      }
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');
      html = doc.body.innerHTML;
      if (wrap) {
        if (!html.includes('<div class="row">') && !html.includes('<p>')) {
          html = "<div class=\"row\">\n                    <div class=\"column\">\n                        <p>".concat(html, "</p>\n                    </div>\n                </div>");
        } else if (!html.includes('<div class="row">')) {
          html = "<div class=\"row\">\n                    <div class=\"column\">\n                        ".concat(html, "\n                    </div>\n                </div>");
        }
      }
      return html;
    }
  }, {
    key: "fixNewBlock",
    value: function fixNewBlock(html) {
      // Fix icons
      var replacementClass = 'ion-checkmark';
      var regexPattern = /(<i class="icon )(ion-\S+)/g;
      html = html.replace(regexPattern, "$1".concat(replacementClass));
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');

      // Fix embedded images
      var gallery = this.builder.media.images;
      var imageList = gallery.square;
      var imageUrl = this.lib.chooseMedia(imageList);
      var imgs = doc.querySelectorAll('img');
      imgs.forEach(function (img) {
        img.setAttribute('src', imageUrl);
      });
      var cols = doc.querySelectorAll('.column');
      cols.forEach(function (col) {
        // Add spacer in an empty column
        if (col.innerHTML.trim() === '') {
          var spacer = document.createElement('div');
          spacer.classList.add('spacer');
          spacer.classList.add('height-40');
          col.appendChild(spacer);
        }
      });
      return doc.documentElement.innerHTML;
    }
  }, {
    key: "fixHtmlBlock",
    value: function fixHtmlBlock(html, wrap) {
      html = this.getHtmlBlock(html, wrap);
      if (!html) {
        this.util.showMessage(this.util.out('Oops! The response received is insufficient. Please try again.'));
        return false;
      }
      if (html.includes('{{IMAGEURL}}')) {
        // Fix {{IMAGEURL}} that failed to replace
        var gallery = this.builder.media.images;
        var imageList = gallery.square;
        var imageUrl = this.lib.chooseMedia(imageList);
        html = html.replaceAll('{{IMAGEURL}}', imageUrl);
      }

      // Fix {{ICONCLASS}} that failed to replace
      html = html.replaceAll('{{ICONCLASS}}', 'ion-checkmark');
      html = this.replaceButtonsWithAnchorTags(html);
      html = this.replaceStrongTag(html);
      html = this.replaceEmTag(html);
      html = this.replaceUnderlineTag(html);
      html = this.replaceLineThroughTag(html);
      html = this.fixCommonBlock(html);
      html = this.fixButtons(html);
      if (!html) return false;
      return html;
    }
  }, {
    key: "fixHtml",
    value: function fixHtml(html) {
      if (html.includes('{{_IMAGEURL}}')) {
        // Fix {{IMAGEURL}} that failed to replace
        var gallery = this.builder.media.images;
        var imageList = gallery.square;
        var imageUrl = this.lib.chooseMedia(imageList);
        html = html.replaceAll('{{IMAGEURL}}', imageUrl);
      }

      // Fix {{ICONCLASS}} that failed to replace
      html = html.replaceAll('{{ICONCLASS}}', 'ion-checkmark');
      html = this.replaceButtonsWithAnchorTags(html);
      html = this.replaceStrongTag(html);
      html = this.replaceEmTag(html);
      html = this.replaceUnderlineTag(html);
      html = this.replaceLineThroughTag(html);
      html = this.fixCommon(html);
      if (!html) return false;
      return html;
    }
  }, {
    key: "fixCustomCode",
    value: function fixCustomCode(html) {
      var regex = /<!--CODESTART-->([\s\S]*?)<!--CODEEND-->/gm;
      var matches = html.match(regex);
      var extractedContent = [];
      if (matches) {
        matches.forEach(function (match) {
          var innerContent = match.replace(/<!--CODESTART-->|<!--CODEEND-->/g, '').trim();
          extractedContent.push(innerContent);
        });
      }
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');
      var n = 0;
      var cols = doc.querySelectorAll('[data-html]');
      cols.forEach(function (col) {
        var customCode = encodeURIComponent(extractedContent[n]);
        col.setAttribute('data-html', customCode);
        col.innerHTML = '';
        n++;
      });
      if (extractedContent.length > 0) {
        return doc.documentElement.innerHTML;
      } else {
        return html;
      }
    }
  }, {
    key: "analyzeTitle",
    value: function analyzeTitle(html, context) {
      var fontWeight = ['font-thin', 'font-extralight', 'font-light', 'font-normal', 'font-medium', 'font-semibold', 'font-bold', 'font-extrabold', 'font-black'];
      var contextWeightClass = '';
      for (var _i = 0, _fontWeight = fontWeight; _i < _fontWeight.length; _i++) {
        var weightClass = _fontWeight[_i];
        if (context.includes(weightClass)) {
          contextWeightClass = weightClass;
          break;
        }
      }
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');
      var resultHeadline = doc.querySelector('h1, h2');
      if (resultHeadline && contextWeightClass) {
        var _iterator = command_createForOfIteratorHelper(fontWeight),
          _step;
        try {
          for (_iterator.s(); !(_step = _iterator.n()).done;) {
            var _weightClass = _step.value;
            resultHeadline.classList.remove(_weightClass);
          }
        } catch (err) {
          _iterator.e(err);
        } finally {
          _iterator.f();
        }
        resultHeadline.classList.add(contextWeightClass);
        return doc.body.innerHTML;
      }
      return html;
    }
  }, {
    key: "replaceButtonsWithAnchorTags",
    value: function replaceButtonsWithAnchorTags(html) {
      var buttonRegex = /<button\b[^>]*>(.*?)<\/button>/g;
      var anchorRegex = /<a\b[^>]*class="button[^>]*>(.*?)<\/a>/g;
      html = html.replace(buttonRegex, '<a href="#" role="button" class="transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 text-black leading-14 rounded border-transparent hover:border-transparent font-normal tracking-wide" style="background-color: rgb(240, 240, 240);">$1</a>');
      html = html.replace(anchorRegex, '<a href="#" role="button" class="transition-all inline-block whitespace-nowrap cursor-pointer no-underline border-2 border-solid mr-2 mt-2 mb-1 py-2 size-17 px-6 text-black leading-14 rounded border-transparent hover:border-transparent font-normal tracking-wide" style="background-color: rgb(240, 240, 240);">$1</a>');
      return html;
    }
  }, {
    key: "replaceStrongTag",
    value: function replaceStrongTag(html) {
      var strongRegex = /<strong\b[^>]*>(.*?)<\/strong>/g;
      var replacement = '<span class="font-semibold">$1</span>';
      return html.replace(strongRegex, replacement);
    }
  }, {
    key: "replaceEmTag",
    value: function replaceEmTag(html) {
      var emRegex = /<em\b[^>]*>(.*?)<\/em>/g;
      var replacement = '<span class="italic">$1</span>';
      return html.replace(emRegex, replacement);
    }
  }, {
    key: "replaceUnderlineTag",
    value: function replaceUnderlineTag(html) {
      var regex = /<u>(.*?)<\/u>/gi;
      var replacedHTML = html.replace(regex, '<span class="underline">$1</span>');
      return replacedHTML;
    }
  }, {
    key: "replaceLineThroughTag",
    value: function replaceLineThroughTag(html) {
      var regex = /<(del|strike|s)>(.*?)<\/(del|strike|s)>/gi;
      var replacedHTML = html.replace(regex, '<span class="line-through">$2</span>');
      return replacedHTML;
    }
  }, {
    key: "fixCommonBlock",
    value: function fixCommonBlock(html) {
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');

      // Replace element style with class
      var elements = doc.querySelectorAll('*');
      elements.forEach(function (element) {
        if (element.style.textDecoration === 'line-through') {
          element.classList.add('line-through');
          element.style.textDecoration = '';
        }
        if (element.style.textDecoration === 'underline') {
          element.classList.add('underline');
          element.style.textDecoration = '';
        }
      });
      return doc.documentElement.innerHTML;
    }
  }, {
    key: "fixNewSection",
    value: function fixNewSection(html) {
      // Fix icons
      var replacementClass = 'ion-checkmark';
      var regexPattern = /(<i class="icon )(ion-\S+)/g;
      html = html.replace(regexPattern, "$1".concat(replacementClass));
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');

      // Fix embedded images
      var gallery = this.builder.media.images;
      var imageList = gallery.square;
      var imageUrl = this.lib.chooseMedia(imageList);
      var imgs = doc.querySelectorAll('img');
      imgs.forEach(function (img) {
        img.setAttribute('src', imageUrl);
      });
      return doc.documentElement.innerHTML;
    }
  }, {
    key: "fixButtons",
    value: function fixButtons(html) {
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');
      var btns = doc.querySelectorAll('a.border-transparent');
      btns.forEach(function (btn) {
        if (!btn.style.backgroundColor) {
          btn.style.backgroundColor = 'rgb(240, 240, 240)';
        }
      });
      return doc.documentElement.innerHTML;
    }
  }, {
    key: "fixCommon",
    value: function fixCommon(html) {
      html = html.replaceAll('{{CONTENT}}', '');
      html = html.replaceAll('{{TITLE}}', '');
      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');
      try {
        if (doc.body.innerText.trim() === '') {
          this.builder.showMessage(this.util.out('Oops! The response received is insufficient. Please try again.'));
          return false;
        }
        var container = doc.querySelector('.is-container');
        var cols = container.querySelectorAll('.column');
        cols.forEach(function (col) {
          // Remove column inline width=100%
          if (col.style.width === '100%') {
            col.style.width = '';
            col.style.flex = '';
          }

          /*
          Fix incorrect structure:
              <div class="column">
                  <div class="flex flex-col justify-end items-start" style="width: 43.915%; flex: 0 0 auto;">
                      ...
                  </div>
              </div>
          */
          if (col.firstElementChild) {
            if (col.firstElementChild.style.width && col.firstElementChild.style.flex === '0 0 auto') {
              col.firstElementChild.outerHTML = col.firstElementChild.innerHTML;
            } /*else if(col.firstElementChild.classList.contains('flex')) {
                col.firstElementChild.outerHTML = col.firstElementChild.innerHTML;
              }*/
          }

          // Fix column inside column
          var colsInside = col.querySelectorAll('.column');
          colsInside.forEach(function (item) {
            item.outerHTML = item.innerHTML;
          });

          /*
          Fix:
              <div class="column" style="width: 30%;">
          */
          if (col.style.width && col.style.flex !== '0 0 auto') {
            col.style.width = '';
          }

          // Remove data-filename attr
          var imgs = col.querySelectorAll('[data-filename]');
          imgs.forEach(function (img) {
            img.removeAttribute('data-filename');
          });

          // Default headings' class
          var headings = col.querySelectorAll('h1');
          headings.forEach(function (heading) {
            if (!heading.getAttribute('class')) {
              heading.classList.add('font-normal');
              heading.classList.add('size-35');
            }
          });
          headings = col.querySelectorAll('h2');
          headings.forEach(function (heading) {
            if (!heading.getAttribute('class')) {
              heading.classList.add('font-normal');
              heading.classList.add('size-28');
            }
          });
        });

        // Fix grid (width)
        var rows = container.querySelectorAll('.row');
        rows.forEach(function (row) {
          var totalWidth = 0;
          var hasAutoWidthCol = false;
          var lastCol;
          var cols = row.querySelectorAll('.column');
          cols.forEach(function (col) {
            if (col.style.width && col.style.width.includes('%')) {
              totalWidth += parseFloat(col.style.width);
            } else {
              hasAutoWidthCol = true;
            }
            lastCol = col;
          });
          if (totalWidth > 100) {
            // console.log('FIX: clear width. Total: ' + totalWidth);
            cols.forEach(function (col) {
              col.style.width = '';
              col.style.flex = '';
            });
          } else if (totalWidth < 100 && !hasAutoWidthCol) {
            // console.log('FIX: add col. Total: ' + totalWidth);
            if (lastCol) lastCol.insertAdjacentHTML('afterend', '<div class="column"><div class="spacer height-60"></div></div>');
          }
        });

        // Replace element style with class
        var elements = doc.querySelectorAll('*');
        elements.forEach(function (element) {
          if (element.style.textDecoration === 'line-through') {
            element.classList.add('line-through');
            element.style.textDecoration = '';
          }
          if (element.style.textDecoration === 'underline') {
            element.classList.add('underline');
            element.style.textDecoration = '';
          }
        });
        if (container) {
          var childElements = container.children;
          for (var i = childElements.length - 1; i >= 0; i--) {
            var row = childElements[i];

            // Remove incorrect spacer placement
            if (row.classList.contains('spacer')) {
              row.parentNode.removeChild(row);
            } else {
              var _cols = row.children;
              for (var j = _cols.length - 1; j >= 0; j--) {
                var col = _cols[j];

                // Add spacer in an empty column
                if (col.innerHTML.trim() === '') {
                  var spacer = document.createElement('div');
                  spacer.classList.add('spacer');
                  spacer.classList.add('height-40');
                  col.appendChild(spacer);
                }

                // Fix built-in grid (column inside column)
                if (col.firstElementChild && col.firstElementChild.classList.contains('column')) {
                  col.innerHTML = col.firstElementChild.innerHTML;
                }
              }
            }
          }
        }
      } catch (e) {
        if (this.builder.consoleLog) {
          console.log(doc.documentElement.innerHTML);
          console.log('Unable to proceed. Error: fixCommon.');
        }
        // console.log('Unable to proceed. Error: fixCommon.');

        // return false;
        return html;
      }
      return doc.documentElement.innerHTML;
    }
  }, {
    key: "blockAction",
    value: function blockAction(args) {
      var activeCol = this.builder.activeCol;
      if (!activeCol) return false;
      if (args.block_task) {
        var val = args.block_task;
        if (val === 'move-up' || val === 'move-down' || val === 'duplicate' || val === 'remove') {
          this.builder.saveForUndo();
          var grid = this.builder._rowTool.grid;
          if (val === 'move-up') grid.moveRowUp();
          if (val === 'move-down') grid.moveRowDown();
          if (val === 'duplicate') grid.duplicateRow();
          if (val === 'remove') {
            grid.removeRow();
            this.builder.doc.body.click();
          }
          this.builder.settings.onChange();
          this.dictation.finish(); // Must be called after finished
          return true;
        }
      }
      if (args.move_column) {
        var _val = args.move_column;
        if (_val === 'move-up' || _val === 'move-down' || _val === 'move-left' || _val === 'move-right') {
          this.builder.saveForUndo();
          var _grid = this.builder._rowTool.grid;
          if (_val === 'move-up') _grid.moveColumnUp();
          if (_val === 'move-down') _grid.moveColumnDown();
          if (_val === 'move-left') _grid.moveColumnPrevious();
          if (_val === 'move-right') _grid.moveColumnNext();
          this.builder.settings.onChange();
          this.dictation.finish(); // Must be called after finished
          return true;
        }
      }
      if (args.column_task) {
        var _val2 = args.column_task;
        if (_val2 === 'duplicate' || _val2 === 'remove') {
          this.builder.saveForUndo();
          var _grid2 = this.builder._rowTool.grid;
          if (_val2 === 'duplicate') _grid2.duplicateColumn();
          if (_val2 === 'remove') {
            _grid2.removeColumn();
            this.builder.doc.body.click();
          }
          this.builder.settings.onChange();
          this.dictation.finish(); // Must be called after finished
          return true;
        }
      }
      if (args.increase_decrease_column) {
        var _val3 = args.increase_decrease_column;
        if (_val3 === 'increase' || _val3 === 'decrease') {
          this.builder.saveForUndo();
          var _grid3 = this.builder._rowTool.grid;
          if (_val3 === 'increase') _grid3.increaseColumn();
          if (_val3 === 'decrease') _grid3.decreaseColumn();
          this.builder.settings.onChange();
          this.dictation.finish(); // Must be called after finished
          return true;
        }
      }
      return false;
    }
  }, {
    key: "quickAction",
    value: function quickAction(args) {
      var container = this.builder.doc.querySelector(this.builder.container);
      if (!container) return true;
      if (args.select_block) {
        if (this.builder.canvas) return;
        var selectElement = function selectElement(row) {
          if (!row) return;
          var col, elm;
          if (row) col = row.querySelector(':first-child');
          if (col) col.click(); // select column 

          if (col) elm = col.querySelector(':first-child');
          if (elm) elm.click(); // select element 
        };

        var selectFirst = function selectFirst() {
          var row = container.querySelector(':first-child');
          selectElement(row);
        };
        var selectLast = function selectLast() {
          var lastRow;
          var childElements = container.children;
          for (var i = childElements.length - 1; i >= 0; i--) {
            var childElement = childElements[i];

            // Check if the child element has at least one grandchild element
            if (childElement.querySelector(':first-child')) {
              // Found a child element with a grandchild
              lastRow = childElement;
              break; // Exit the loop after finding the last one
            }
          }

          if (lastRow) {
            selectElement(lastRow);
          }
        };
        if (args.select_block === 'block') {
          var elm = container.querySelector('h1, p, h2, h3');
          if (elm) elm.click();else {
            elm = container.querySelector('.is-container > div > div');
            if (elm) elm.click();
          }
          return true;
        } else if (args.select_block === 'headline' || args.select_block === 'title') {
          var _elm12 = container.querySelector('h1,h2,h3');
          if (_elm12) _elm12.click();
          return true;
        } else if (args.select_block === 'paragraph') {
          var _elm13 = container.querySelector('p');
          if (_elm13) _elm13.click();
          return true;
        } else if (args.select_block === 'image') {
          var _elm14 = container.querySelector('img');
          if (_elm14) _elm14.click();
          return true;
        } else if (args.select_block === 'space') {
          var _elm15 = container.querySelector('div.spacer');
          if (_elm15) _elm15.click();
          return true;
        } else if (args.select_block === 'button') {
          var _elm16 = container.querySelector('a[role="button"]');
          if (_elm16) _elm16.click();
          return true;
        } else if (args.select_block === 'next') {
          var row = container.querySelector('.row-active');
          if (row) row = row.nextElementSibling;
          selectElement(row);
          return true;
        } else if (args.select_block === 'previous') {
          var _row3 = container.querySelector('.row-active');
          if (_row3) _row3 = _row3.previousElementSibling;
          selectElement(_row3);
          return true;
        } else if (args.select_block === 'first') {
          selectFirst();
          return true;
        } else if (args.select_block === 'last') {
          selectLast();
          return true;
        }
      }
      if (args.unselect_block) {
        this.builder.doc.body.click();
        return true;
      }
      return false;
    }
  }, {
    key: "chooseContext",
    value: function chooseContext(list, num) {
      // random, but will be different from two previous results.
      if (typeof num !== 'undefined') {
        return list[num];
      }
      if (!this.previousIndexes) this.previousIndexes = [];
      var randomIndex = Math.floor(Math.random() * list.length);
      if (this.previousIndexes.includes(randomIndex) && this.previousIndexes.length < list.length) {
        return this.chooseContext(list);
      }
      this.previousIndexes.push(randomIndex);
      if (this.previousIndexes.length > 2) {
        this.previousIndexes.shift();
      }
      return list[randomIndex];
    }
  }]);
  return Command;
}();
/* harmony default export */ const command = (Command);
// EXTERNAL MODULE: ./node_modules/string-similarity-js/dist/string-similarity.js
var string_similarity = __webpack_require__(289);
;// CONCATENATED MODULE: ./src/contentbuilder/similarity.js
function similarity_typeof(obj) { "@babel/helpers - typeof"; return similarity_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, similarity_typeof(obj); }
function similarity_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = similarity_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function similarity_slicedToArray(arr, i) { return similarity_arrayWithHoles(arr) || similarity_iterableToArrayLimit(arr, i) || similarity_unsupportedIterableToArray(arr, i) || similarity_nonIterableRest(); }
function similarity_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function similarity_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return similarity_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return similarity_arrayLikeToArray(o, minLen); }
function similarity_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }
function similarity_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0) { ; } } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function similarity_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function similarity_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function similarity_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, similarity_toPropertyKey(descriptor.key), descriptor); } }
function similarity_createClass(Constructor, protoProps, staticProps) { if (protoProps) similarity_defineProperties(Constructor.prototype, protoProps); if (staticProps) similarity_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function similarity_toPropertyKey(arg) { var key = similarity_toPrimitive(arg, "string"); return similarity_typeof(key) === "symbol" ? key : String(key); }
function similarity_toPrimitive(input, hint) { if (similarity_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (similarity_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }

var Similarity = /*#__PURE__*/function () {
  function Similarity(builder) {
    similarity_classCallCheck(this, Similarity);
    this.builder = builder;
  }
  similarity_createClass(Similarity, [{
    key: "checkSimilarity",
    value: function checkSimilarity(word1, word2) {
      word1 = word1.toLowerCase();
      word2 = word2.toLowerCase();
      var similarity = (0,string_similarity/* stringSimilarity */.Ku)(word1, word2);
      return similarity;
    }
  }, {
    key: "check",
    value: function check(command) {
      var commandList = this.builder.settings.commandList;
      var maxSimilarity = 0;
      var maxKey = '';
      for (var _i = 0, _Object$entries = Object.entries(commandList); _i < _Object$entries.length; _i++) {
        var _Object$entries$_i = similarity_slicedToArray(_Object$entries[_i], 2),
          key = _Object$entries$_i[0],
          value = _Object$entries$_i[1];
        var similarity = this.calculate(command, value);
        if (similarity > maxSimilarity) {
          maxSimilarity = similarity;
          maxKey = key;
        }
      }
      var similarityThreshold = this.builder.similarityThreshold; //0.65;
      if (maxSimilarity >= similarityThreshold) {
        return maxKey;
      }
      return false;
    }
  }, {
    key: "calculate",
    value: function calculate(command, list) {
      var normalizedCommand = command.toLowerCase();
      var maxSimilarity = 0;
      var _iterator = similarity_createForOfIteratorHelper(list),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var cmd = _step.value;
          var similarity = (0,string_similarity/* stringSimilarity */.Ku)(normalizedCommand, cmd);
          if (similarity > maxSimilarity) {
            maxSimilarity = similarity;
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return maxSimilarity;
    }
  }]);
  return Similarity;
}();
/* harmony default export */ const similarity = (Similarity);
;// CONCATENATED MODULE: ./src/contentbuilder/editableblocks.js
function editableblocks_typeof(obj) { "@babel/helpers - typeof"; return editableblocks_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, editableblocks_typeof(obj); }
function editableblocks_createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = editableblocks_unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function editableblocks_slicedToArray(arr, i) { return editableblocks_arrayWithHoles(arr) || editableblocks_iterableToArrayLimit(arr, i) || editableblocks_unsupportedIterableToArray(arr, i) || editableblocks_nonIterableRest(); }
function editableblocks_nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function editableblocks_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return editableblocks_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return editableblocks_arrayLikeToArray(o, minLen); }
function editableblocks_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }
function editableblocks_iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0) { ; } } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function editableblocks_arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function editableblocks_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function editableblocks_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, editableblocks_toPropertyKey(descriptor.key), descriptor); } }
function editableblocks_createClass(Constructor, protoProps, staticProps) { if (protoProps) editableblocks_defineProperties(Constructor.prototype, protoProps); if (staticProps) editableblocks_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function editableblocks_toPropertyKey(arg) { var key = editableblocks_toPrimitive(arg, "string"); return editableblocks_typeof(key) === "symbol" ? key : String(key); }
function editableblocks_toPrimitive(input, hint) { if (editableblocks_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (editableblocks_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var Common = /*#__PURE__*/function () {
  function Common(options) {
    editableblocks_classCallCheck(this, Common);
    this.selector = options && options.selector || '.is-block';
    this.doc = options && options.doc || document;
    this.win = options && options.win || window;
    this.onDuplicate = options && options.onDuplicate || null;
  }
  editableblocks_createClass(Common, [{
    key: "transform2d",
    value: function transform2d(block, x1, y1, x2, y2, x3, y3, x4, y4) {
      this.matrix3d = new Matrix3D();
      return this.matrix3d.transform2d(block, x1, y1, x2, y2, x3, y3, x4, y4);
    }
  }, {
    key: "setZoom",
    value: function setZoom(scale) {
      this.zoom = scale;
    }
  }, {
    key: "applyPercentage",
    value: function applyPercentage(block) {
      var zoom = this.zoom;
      var rect = this.getRect(block);
      var container = block.parentNode;
      var isChildBlock = false;
      if (block.parentNode.matches(this.selector)) {
        // child block
        isChildBlock = true;
      }

      // const containerRect = container.getBoundingClientRect(); // if container has top/left
      var containerRect = this.getRect(container); // if container has top/left
      var left = (rect.left - containerRect.left) / container.offsetWidth * 100;
      var top = (rect.top - containerRect.top) / container.offsetHeight * 100;
      var isBlockFixed = block.classList.contains('block-steady');
      if (isBlockFixed) {
        var dividerTop = (container.offsetHeight - block.offsetHeight) / (rect.top - containerRect.top) * zoom;
        if (isNaN(dividerTop)) {
          // there is possibility of 0/0
          dividerTop = 1;
        }
        block.style.top = "calc((100% - ".concat(block.offsetHeight, "px)/").concat(dividerTop, ")");
        if (isChildBlock) {
          block.style.top = top + '%';
        }
        var dividerLeft = (container.offsetWidth - block.offsetWidth) / (rect.left - containerRect.left) * zoom;
        if (isNaN(dividerLeft)) {
          // there is possibility of 0/0
          dividerLeft = 1;
        }
        // if(rect.left-containerRect.left===0) { // dividerLeft = Infinity
        //     dividerLeft=1; 
        // }
        block.style.left = "calc((100% - ".concat(block.offsetWidth, "px)/").concat(dividerLeft, ")");
        if (isChildBlock) {
          block.style.left = left + '%';
        }

        // fix
        if (dividerTop === 0) block.style.top = top + '%';
        if (dividerLeft === 0) block.style.left = left + '%';
      } else {
        var width = block.offsetWidth / container.offsetWidth * 100;
        var height = block.offsetHeight / container.offsetHeight * 100;
        block.style.width = width + '%';
        block.style.height = height + '%';
        block.style.top = top / zoom + '%';
        block.style.left = left / zoom + '%';
        if (block.classList.contains('height-auto')) block.style.height = '';
      }
    }
  }, {
    key: "applyPixels",
    value: function applyPixels(block) {
      var zoom = this.zoom;
      var rect = this.getRect(block);
      var containerRect = this.getRect(block.parentNode); // if container has top/left
      block.style.left = (rect.left - containerRect.left) / zoom + 'px';
      block.style.top = (rect.top - containerRect.top) / zoom + 'px';
      block.style.width = block.offsetWidth + 'px';
    }
  }, {
    key: "updateHeight",
    value: function updateHeight(block) {
      if (!block.parentNode) return;
      var clonedDiv = block.cloneNode(true);
      clonedDiv.style.position = 'absolute';
      clonedDiv.style.top = '-9999px';
      clonedDiv.style.left = '-9999px';
      block.parentNode.appendChild(clonedDiv);
      clonedDiv.style.height = '';
      setTimeout(function () {
        var clonedDivHeight = clonedDiv.offsetHeight;
        if (block.offsetHeight <= clonedDivHeight) {
          block.style.height = clonedDivHeight + 'px';
          setTimeout(function () {
            block.parentNode.removeChild(clonedDiv);
          }, 10);
        } else {
          block.parentNode.removeChild(clonedDiv);
        }
      }, 10);
    }
  }, {
    key: "duplicate",
    value: function duplicate() {
      var block = this.doc.querySelector(this.selector + '.active');
      if (!block) return;
      if (this.onDuplicate) this.onDuplicate(block);
    }
  }, {
    key: "getRect",
    value: function getRect(element) {
      var group = element.parentNode.closest(this.selector);
      if (element.closest(this.selector) && group) {
        var _transform = group.style.transform;
        if (_transform.includes('rotate')) {
          // Create a temporary element with the same dimensions and position
          var tempGroup = this.doc.createElement('div');
          tempGroup.style.position = 'absolute';
          tempGroup.style.width = group.offsetWidth + 'px';
          tempGroup.style.height = group.offsetHeight + 'px';
          tempGroup.style.left = group.style.left;
          tempGroup.style.top = group.style.top;
          // tempGroup.style.border ='red 1px solid';
          group.parentNode.appendChild(tempGroup);
          // const wrapperRect = tempGroup.getBoundingClientRect(); // Get the unrotated position

          // Create a temporary element with the same dimensions and position
          var tempElement = this.doc.createElement('div');
          tempElement.style.position = 'absolute';
          tempElement.style.width = element.offsetWidth + 'px';
          tempElement.style.height = element.offsetHeight + 'px';
          tempElement.style.left = element.style.left;
          tempElement.style.top = element.style.top;
          // tempElement.style.border ='green 1px solid';
          tempGroup.appendChild(tempElement);
          var tempRect = tempElement.getBoundingClientRect(); // Get the unrotated position

          // let top = tempRect.top - wrapperRect.top;
          // let left = tempRect.left - wrapperRect.left;

          setTimeout(function () {
            tempElement.parentNode.removeChild(tempElement);
            tempGroup.parentNode.removeChild(tempGroup);
          }, 0);
          return tempRect;
        }
      }
      var rect = element.getBoundingClientRect();
      var transform = this.win.getComputedStyle(element).getPropertyValue('transform');
      if (transform !== 'none') {
        // Create a temporary element with the same dimensions and position
        var _tempElement = this.doc.createElement('div');
        _tempElement.style.position = 'absolute';
        _tempElement.style.width = element.offsetWidth + 'px';
        _tempElement.style.height = element.offsetHeight + 'px';
        _tempElement.style.left = element.style.left;
        _tempElement.style.top = element.style.top;
        // tempElement.style.border ='green 1px solid';
        element.parentNode.appendChild(_tempElement);

        // Get the unrotated position of the temporary element
        var _tempRect = _tempElement.getBoundingClientRect();
        setTimeout(function () {
          _tempElement.parentNode.removeChild(_tempElement);
        }, 1);
        return _tempRect;
      } else {
        return rect;
      }
    }
  }, {
    key: "getTranslateValues",
    value: function getTranslateValues(transformString) {
      // Regular expression to match the translate values in the transform string
      var regex = /translate\((-?\d+\.?\d*)px, (-?\d+\.?\d*)px\)/;

      // Use the regular expression to extract x and y values
      var match = transformString.match(regex);

      // If there's a match, return an object with x and y values
      if (match) {
        var _match$map = match.map(parseFloat),
          _match$map2 = editableblocks_slicedToArray(_match$map, 3),
          x = _match$map2[1],
          y = _match$map2[2];
        return {
          x: x,
          y: y
        };
      }

      // If no match, return null or handle it as needed
      return null;
    }
  }, {
    key: "group",
    value: function group() {
      var _this = this;
      var className = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'is-block';
      var groupClassName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'is-group';
      var top = Infinity;
      var left = Infinity;
      var bottom = -Infinity;
      var right = -Infinity;

      // Check group
      var blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active');
      });
      if (blocks.length <= 1) return;

      // Check if there is selected block that is part of other group
      var ok = true;
      blocks.forEach(function (block) {
        if (block.parentNode.matches(_this.selector)) {
          // TODO: detach block
          alert('One or more blocks belong to another group.');
          ok = false;
        }
      });
      if (!ok) return;
      blocks.forEach(function (block) {
        var elms = block.querySelectorAll(_this.selector);
        if (elms.length > 0) {
          elms.forEach(function (elm) {
            return elm.classList.add('active');
          });
          _this.unGroup(block);
        }
      });
      blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active');
      });
      blocks.forEach(function (block) {
        if (!block.parentNode.matches(_this.selector)) {
          var rect = _this.getRect(block);
          var blockTop = rect.top;
          var blockLeft = rect.left;
          var blockWidth = block.offsetWidth;
          var blockHeight = block.offsetHeight;
          top = Math.min(top, blockTop);
          left = Math.min(left, blockLeft);
          bottom = Math.max(bottom, blockTop + blockHeight);
          right = Math.max(right, blockLeft + blockWidth);
        }
      });
      var group = this.doc.createElement('div');
      group.classList.add(className);
      group.classList.add(groupClassName);
      group.classList.add('block-steady');
      group.style.top = top + 'px';
      group.style.left = left + 'px';
      group.style.width = right + 1 - left + 'px';
      group.style.height = bottom + 1 - top + 'px';
      var container = blocks[0].parentNode;
      container.appendChild(group);
      blocks.forEach(function (block) {
        if (!block.parentNode.matches(_this.selector)) {
          _this.applyPixels(block);
          var blockTop = parseFloat(block.style.top) || 0;
          var blockLeft = parseFloat(block.style.left) || 0;

          // Adjust position relative to the group div
          block.style.top = blockTop - top + 'px';
          block.style.left = blockLeft - left + 'px';
          group.appendChild(block);
          _this.applyPercentage(block);
        }
      });
      this.applyPercentage(group);
      blocks.forEach(function (block) {
        block.classList.remove('active');
      });
      group.classList.add('active');
      blocks = group.querySelectorAll(this.selector);
      blocks.forEach(function (target) {
        // Remove all breakpoints
        var attributesToRemove = [];
        var attributes = target.attributes;
        for (var i = 0; i < attributes.length; i++) {
          var attributeName = attributes[i].name;
          if (attributeName.includes('data--t-') || attributeName.includes('data--l-') || attributeName.includes('data--b-') || attributeName.includes('data--r-') || attributeName.includes('data--w-') || attributeName.includes('data--h-')) {
            attributesToRemove.push(attributeName);
          }
        }
        attributesToRemove.forEach(function (attr) {
          target.removeAttribute(attr);
        });

        // Make/save current inline style as default
        target.removeAttribute('data-breakpoint');
        target.setAttribute('data--t', target.style.top);
        target.setAttribute('data--l', target.style.left);
        target.setAttribute('data--b', target.style.bottom); // if target.style.bottom not exists, data--b attribute is created without value = ""
        target.setAttribute('data--r', target.style.right);
        target.setAttribute('data--w', target.style.width);
        target.setAttribute('data--h', target.style.height);
      });
      return group;
    }
  }, {
    key: "unGroup",
    value: function unGroup(element) {
      var _this2 = this;
      var group;
      if (element) group = element;else {
        var blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
          return elm.classList.contains('active');
        });
        blocks.forEach(function (block) {
          if (block.querySelector(_this2.selector)) {
            // this block is a group
            _this2.unGroup(block);
          }
        });
        return;
      }
      if (!group) return;
      if (!group.querySelector(this.selector)) return;
      this.applyPixels(group);
      var rect = this.getRect(group);
      var top = rect.top;
      var left = rect.left;
      var container = group.parentNode;
      group.querySelectorAll(this.selector).forEach(function (block) {
        _this2.applyPixels(block);
        var blockTop = parseFloat(block.style.top) || 0;
        var blockLeft = parseFloat(block.style.left) || 0;

        // Adjust position relative to the group div
        block.style.top = blockTop + top + 'px';
        block.style.left = blockLeft + left + 'px';
        container.appendChild(block);

        // Remove all breakpoints
        var attributesToRemove = [];
        var attributes = block.attributes;
        for (var i = 0; i < attributes.length; i++) {
          var attributeName = attributes[i].name;
          if (attributeName.includes('data--t-') || attributeName.includes('data--l-') || attributeName.includes('data--b-') || attributeName.includes('data--r-') || attributeName.includes('data--w-') || attributeName.includes('data--h-')) {
            attributesToRemove.push(attributeName);
          }
        }
        attributesToRemove.forEach(function (attr) {
          block.removeAttribute(attr);
        });
        // Make/save current inline style as default
        block.removeAttribute('data-breakpoint');
        block.setAttribute('data--t', block.style.top);
        block.setAttribute('data--l', block.style.left);
        block.setAttribute('data--b', block.style.bottom);
        block.setAttribute('data--r', block.style.right);
        block.setAttribute('data--w', block.style.width);
        block.setAttribute('data--h', block.style.height);
        _this2.applyPercentage(block);
      });
      group.parentElement.removeChild(group);
    }
  }, {
    key: "addBreakpoint",
    value: function addBreakpoint() {
      var viewportWidth = this.win.innerWidth;
      this.doc.body.setAttribute('data-breakpoint', viewportWidth);
    }
  }, {
    key: "clearBreakpoint",
    value: function clearBreakpoint(target) {
      var attributesToRemove = [];
      var attributes = target.attributes;
      for (var i = 0; i < attributes.length; i++) {
        var attributeName = attributes[i].name;
        if (attributeName.includes('data--t-') || attributeName.includes('data--l-') || attributeName.includes('data--b-') || attributeName.includes('data--r-') || attributeName.includes('data--w-') || attributeName.includes('data--h-') || attributeName.includes('data--transform-') || attributeName.includes('data--matrix-')) {
          attributesToRemove.push(attributeName);
        }
      }
      attributesToRemove.forEach(function (attr) {
        target.removeAttribute(attr);
      });
      target.removeAttribute('data-breakpoint');

      // reset
      var top = target.getAttribute('data--t');
      if (top) target.style.top = top;
      var left = target.getAttribute('data--l');
      if (left) target.style.left = left;
      var bottom = target.getAttribute('data--b');
      if (bottom) target.style.bottom = bottom;
      var right = target.getAttribute('data--r');
      if (right) target.style.right = right;
      var width = target.getAttribute('data--w');
      if (width) target.style.width = width;
      var height = target.getAttribute('data--h');
      if (height) target.style.height = height;
      if (left && !right) target.style.right = '';
      if (right && !left) target.style.left = '';
      if (top && !bottom) target.style.bottom = '';
      if (bottom && !top) target.style.top = '';
    }
  }, {
    key: "clearAllBreakpoints",
    value: function clearAllBreakpoints(container) {
      // REVIEW (Currently not used)
      var elements = container.querySelectorAll(this.selector);
      elements.forEach(function (target) {
        var attributesToRemove = [];
        var attributes = target.attributes;
        for (var i = 0; i < attributes.length; i++) {
          var attributeName = attributes[i].name;
          if (attributeName.includes('data--t-') || attributeName.includes('data--l-') || attributeName.includes('data--b-') || attributeName.includes('data--r-') || attributeName.includes('data--w-') || attributeName.includes('data--h-') || attributeName.includes('data--transform-') || attributeName.includes('data--matrix-')) {
            attributesToRemove.push(attributeName);
          }
        }
        attributesToRemove.forEach(function (attr) {
          target.removeAttribute(attr);
        });
      });
      elements.forEach(function (target) {
        var t = target.getAttribute('data--t');
        var l = target.getAttribute('data--l');
        var b = target.getAttribute('data--b');
        var r = target.getAttribute('data--r');
        var w = target.getAttribute('data--w');
        var h = target.getAttribute('data--h');
        if (t) target.style.top = t;
        if (l) target.style.left = l;
        if (b) target.style.bottom = b;
        if (r) target.style.right = r;
        if (w) target.style.width = w;
        if (h) target.style.height = h;
        if (l && !r) target.style.right = '';
        if (r && !l) target.style.left = '';
        if (t && !b) target.style.bottom = '';
        if (b && !t) target.style.top = '';
      });
    }
  }, {
    key: "getBreakpoints",
    value: function getBreakpoints(target) {
      var breakpoints = [];
      var attributes = target.attributes;
      for (var i = 0; i < attributes.length; i++) {
        var attributeName = attributes[i].name;
        if (attributeName.includes('data--t-') || attributeName.includes('data--l-') || attributeName.includes('data--b-') || attributeName.includes('data--r-') || attributeName.includes('data--w-') || attributeName.includes('data--h-')) {
          var val = attributeName.replace('data--t-', '');
          val = val.replace('data--l-', '');
          val = val.replace('data--b-', '');
          val = val.replace('data--r-', '');
          val = val.replace('data--w-', '');
          val = val.replace('data--h-', '');
          if (!breakpoints.includes(val)) breakpoints.push(val);
        }
      }
      return breakpoints;
    }
  }, {
    key: "getSelectedBlock",
    value: function getSelectedBlock() {
      var blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active') && !elm.classList.contains('cloned');
      });
      if (blocks.length === 1) {
        var block = blocks[0];
        return block;
      }
      return false;
    }
  }, {
    key: "checkOverlap",
    value: function checkOverlap(target) {
      var targetRect = target.getBoundingClientRect();
      var blocks = Array.from(target.parentNode.querySelectorAll(this.selector)).filter(function (elm) {
        return !elm.classList.contains('cloned');
      });
      var overlappedBlocks = [];
      var _iterator = editableblocks_createForOfIteratorHelper(blocks),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var block = _step.value;
          if (block !== target) {
            var blockRect = block.getBoundingClientRect();
            if (targetRect.top < blockRect.bottom && targetRect.bottom > blockRect.top && targetRect.left < blockRect.right && targetRect.right > blockRect.left) {
              overlappedBlocks.push(block);
            }
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return overlappedBlocks;
    }
  }]);
  return Common;
}();
var Matrix3D = /*#__PURE__*/function () {
  function Matrix3D() {
    editableblocks_classCallCheck(this, Matrix3D);
  }
  editableblocks_createClass(Matrix3D, [{
    key: "adj",
    value: function adj(m) {
      return [m[4] * m[8] - m[5] * m[7], m[2] * m[7] - m[1] * m[8], m[1] * m[5] - m[2] * m[4], m[5] * m[6] - m[3] * m[8], m[0] * m[8] - m[2] * m[6], m[2] * m[3] - m[0] * m[5], m[3] * m[7] - m[4] * m[6], m[1] * m[6] - m[0] * m[7], m[0] * m[4] - m[1] * m[3]];
    }
  }, {
    key: "multmm",
    value: function multmm(a, b) {
      var c = Array(9);
      for (var i = 0; i != 3; ++i) {
        for (var j = 0; j != 3; ++j) {
          var cij = 0;
          for (var k = 0; k != 3; ++k) {
            cij += a[3 * i + k] * b[3 * k + j];
          }
          c[3 * i + j] = cij;
        }
      }
      return c;
    }
  }, {
    key: "multmv",
    value: function multmv(m, v) {
      return [m[0] * v[0] + m[1] * v[1] + m[2] * v[2], m[3] * v[0] + m[4] * v[1] + m[5] * v[2], m[6] * v[0] + m[7] * v[1] + m[8] * v[2]];
    }
  }, {
    key: "pdbg",
    value: function pdbg(m, v) {
      var r = this.multmv(m, v);
      return r + ' (' + r[0] / r[2] + ', ' + r[1] / r[2] + ')';
    }
  }, {
    key: "basisToPoints",
    value: function basisToPoints(x1, y1, x2, y2, x3, y3, x4, y4) {
      var m = [x1, x2, x3, y1, y2, y3, 1, 1, 1];
      var v = this.multmv(this.adj(m), [x4, y4, 1]);
      return this.multmm(m, [v[0], 0, 0, 0, v[1], 0, 0, 0, v[2]]);
    }
  }, {
    key: "general2DProjection",
    value: function general2DProjection(x1s, y1s, x1d, y1d, x2s, y2s, x2d, y2d, x3s, y3s, x3d, y3d, x4s, y4s, x4d, y4d) {
      var s = this.basisToPoints(x1s, y1s, x2s, y2s, x3s, y3s, x4s, y4s);
      var d = this.basisToPoints(x1d, y1d, x2d, y2d, x3d, y3d, x4d, y4d);
      return this.multmm(d, this.adj(s));
    }
  }, {
    key: "project",
    value: function project(m, x, y) {
      var v = this.multmv(m, [x, y, 1]);
      return [v[0] / v[2], v[1] / v[2]];
    }
  }, {
    key: "transform2d",
    value: function transform2d(element, x1, y1, x2, y2, x3, y3, x4, y4) {
      var w = element.offsetWidth,
        h = element.offsetHeight;
      var t = this.general2DProjection(0, 0, x1, y1, w, 0, x2, y2, 0, h, x3, y3, w, h, x4, y4);
      for (var i = 0; i != 9; ++i) {
        t[i] = t[i] / t[8];
      }
      t = [t[0], t[3], 0, t[6], t[1], t[4], 0, t[7], 0, 0, 1, 0, t[2], t[5], 0, t[8]];
      t = 'matrix3d(' + t.join(', ') + ')';
      return t;
    }
  }]);
  return Matrix3D;
}();
var Ruler = /*#__PURE__*/function () {
  function Ruler(options) {
    editableblocks_classCallCheck(this, Ruler);
    this.selector = options && options.selector || '.is-block';
    this.doc = options && options.doc || document;
    this.win = options && options.win || window;
    var rulerHTML = "\n            <div class=\"ruler horizontal-ruler\" id=\"horizontal-ruler-top\"></div>\n            <div class=\"ruler horizontal-ruler\" id=\"horizontal-ruler-bottom\"></div>\n            <div class=\"ruler horizontal-ruler\" id=\"horizontal-ruler-middle\"></div>\n            <div class=\"ruler vertical-ruler\" id=\"vertical-ruler-left\"></div>\n            <div class=\"ruler vertical-ruler\" id=\"vertical-ruler-right\"></div>\n            <div class=\"ruler vertical-ruler\" id=\"vertical-ruler-center\"></div>\n        ";
    if (!this.doc.getElementById('horizontal-ruler-top')) this.doc.body.insertAdjacentHTML('beforeend', rulerHTML);
    this.horizontalRulerTop = this.doc.getElementById('horizontal-ruler-top');
    this.horizontalRulerBottom = this.doc.getElementById('horizontal-ruler-bottom');
    this.horizontalRulerMiddle = this.doc.getElementById('horizontal-ruler-middle');
    this.verticalRulerLeft = this.doc.getElementById('vertical-ruler-left');
    this.verticalRulerRight = this.doc.getElementById('vertical-ruler-right');
    this.verticalRulerCenter = this.doc.getElementById('vertical-ruler-center');
    this.setup();
  }
  editableblocks_createClass(Ruler, [{
    key: "setZoom",
    value: function setZoom(scale) {
      this.zoom = scale;
    }
  }, {
    key: "setup",
    value: function setup() {
      this.elements = this.doc.querySelectorAll(this.selector);
    }
  }, {
    key: "refresh",
    value: function refresh() {
      this.elements = this.doc.querySelectorAll(this.selector);
    }
  }, {
    key: "destroy",
    value: function destroy() {
      [this.horizontalRulerTop, this.horizontalRulerBottom, this.verticalRulerLeft, this.verticalRulerRight].forEach(function (elm) {
        if (elm.parentNode) elm.parentNode.removeChild(elm);
      });
    }
  }, {
    key: "hideRulers",
    value: function hideRulers() {
      this.horizontalRulerTop.style.top = '-1000px';
      this.horizontalRulerBottom.style.top = '-1000px';
      this.horizontalRulerMiddle.style.top = '-1000px';
      this.verticalRulerLeft.style.left = '-1000px';
      this.verticalRulerRight.style.left = '-1000px';
      this.verticalRulerCenter.style.left = '-1000px';
      this.rulerTop = null;
      this.rulerLeft = null;
      this.rulerRight = null;
    }
  }, {
    key: "updateRulers",
    value: function updateRulers(block) {
      var _this3 = this;
      // if(block.querySelector(this.selector)) return; // group (because updateRules also calls parent group if child block is dragged)

      var transform = block.style.transform;
      if (transform.includes('rotate') || transform.includes('matrix3d')) return;
      var parentTransform = block.parentNode.style.transform;
      if (parentTransform.includes('rotate')) return;
      if (this.zoom * 1 !== 1) return; // disable rulers on zoomed page

      this.hideRulers();
      var rect = block.getBoundingClientRect();
      var top = rect.top;
      var bottom = top + block.offsetHeight;
      var left = rect.left;
      var right = left + block.offsetWidth;
      var center = left + block.offsetWidth / 2;
      var middle = top + block.offsetHeight / 2;
      this.rulerTop = null;
      this.rulerLeft = null;
      this.rulerRight = null;
      var containerTop = 0;
      var container = block.parentNode;
      if (container) {
        this.elements = container.querySelectorAll(this.selector);
        containerTop = this.win.scrollY;
      }
      this.elements.forEach(function (element) {
        if (!_this3.doc.body.contains(element)) return; // in case element removed (eg. unGroup, block deleted)

        if (block.contains(element)) return; // In case of group moving

        var transform = element.style.transform;
        var parentTransform = element.parentNode.style.transform;
        if (!transform.includes('rotate') && !parentTransform.includes('rotate') && !transform.includes('matrix3d') && !parentTransform.includes('matrix3d') && element !== block && !element.classList.contains('cloned')) {
          var _rect = element.getBoundingClientRect();
          var otherTop = _rect.top;
          var otherBottom = _rect.top + element.offsetHeight;
          var otherLeft = _rect.left;
          var otherRight = _rect.left + element.offsetWidth;
          var otherMiddle = _rect.top + element.offsetHeight / 2;
          var otherCenter = _rect.left + element.offsetWidth / 2;
          if (otherMiddle - 4 <= middle && middle <= otherMiddle + 4) {
            _this3.horizontalRulerMiddle.style.top = containerTop + otherTop + (element.offsetHeight - block.offsetHeight) / 2 + block.offsetHeight / 2 + 'px';
            var val = otherTop + (element.offsetHeight - block.offsetHeight) / 2;
            if (_this3.rulerTop === null) _this3.rulerTop = val;
          }
          if (otherCenter - 4 <= center && center <= otherCenter + 4) {
            _this3.verticalRulerCenter.style.left = otherLeft + (element.offsetWidth - block.offsetWidth) / 2 + block.offsetWidth / 2 + 'px';
            _this3.verticalRulerCenter.style.top = containerTop + 'px'; // adj

            var _val = otherLeft + (element.offsetWidth - block.offsetWidth) / 2;
            if (_this3.rulerLeft === null) _this3.rulerLeft = _val;
          }

          // block top
          if (otherTop - 4 <= top && top <= otherTop + 4) {
            _this3.horizontalRulerTop.style.top = containerTop + otherTop + 'px';
            var _val2 = otherTop;
            if (_this3.rulerTop === null) _this3.rulerTop = _val2;
          }
          if (otherBottom - 4 <= top && top <= otherBottom + 4) {
            _this3.horizontalRulerTop.style.top = containerTop + otherBottom + 'px';
            var _val3 = otherBottom;
            if (_this3.rulerTop === null) _this3.rulerTop = _val3;
          }

          // block bottom
          if (otherTop - 4 <= bottom && bottom <= otherTop + 4) {
            _this3.horizontalRulerBottom.style.top = containerTop + otherTop + 'px';
            var _val4 = otherTop - block.offsetHeight;
            if (_this3.rulerTop === null) _this3.rulerTop = _val4;
          }
          if (otherBottom - 4 <= bottom && bottom <= otherBottom + 4) {
            _this3.horizontalRulerBottom.style.top = containerTop + otherBottom + 'px';
            var _val5 = otherBottom - block.offsetHeight;
            if (_this3.rulerTop === null) _this3.rulerTop = _val5;
          }

          // block left
          if (otherLeft - 4 <= left && left <= otherLeft + 4) {
            _this3.verticalRulerLeft.style.left = otherLeft + 'px';
            _this3.verticalRulerLeft.style.top = containerTop + 'px'; // adj

            var _val6 = otherLeft;
            if (_this3.rulerLeft === null) _this3.rulerLeft = _val6;
          }
          if (otherRight - 4 <= left && left <= otherRight + 4) {
            _this3.verticalRulerLeft.style.left = otherRight + 'px';
            _this3.verticalRulerLeft.style.top = containerTop + 'px'; // adj

            var _val7 = otherRight;
            if (_this3.rulerLeft === null) _this3.rulerLeft = _val7;
          }

          // block right
          if (otherLeft - 4 <= right && right <= otherLeft + 4) {
            _this3.verticalRulerRight.style.left = otherLeft + 'px';
            _this3.verticalRulerRight.style.top = containerTop + 'px'; // adj

            var _val8 = otherLeft;
            if (_this3.rulerRight === null) _this3.rulerRight = _val8;
          }
          if (otherRight - 4 <= right && right <= otherRight + 4) {
            _this3.verticalRulerRight.style.left = otherRight + 'px';
            _this3.verticalRulerRight.style.top = containerTop + 'px'; // adj

            var _val9 = otherRight;
            if (_this3.rulerRight === null) _this3.rulerRight = _val9;
          }
        }
      });

      // Edges
      var conRect = block.parentNode.getBoundingClientRect();
      var conTop = conRect.top;
      var conBottom = conRect.top + block.parentNode.offsetHeight;
      var conLeft = conRect.left;
      var conRight = conRect.left + block.parentNode.offsetWidth;
      var conCenter = conRect.left + block.parentNode.offsetWidth / 2;
      var conMiddle = conRect.top + block.parentNode.offsetHeight / 2;
      if (conMiddle - 4 <= middle && middle <= conMiddle + 4) {
        this.horizontalRulerMiddle.style.top = containerTop + conTop + (block.parentNode.offsetHeight - block.offsetHeight) / 2 + block.offsetHeight / 2 + 'px';
        var val = conTop + (block.parentNode.offsetHeight - block.offsetHeight) / 2;
        if (this.rulerTop === null) this.rulerTop = val;
      }
      if (conCenter - 4 <= center && center <= conCenter + 4) {
        this.verticalRulerCenter.style.left = conLeft + (block.parentNode.offsetWidth - block.offsetWidth) / 2 + block.offsetWidth / 2 + 'px';
        this.verticalRulerCenter.style.top = containerTop + 'px';
        var _val10 = conLeft + (block.parentNode.offsetWidth - block.offsetWidth) / 2;
        if (this.rulerLeft === null) this.rulerLeft = _val10;
      }

      // block top
      if (conTop - 4 <= top && top <= conTop + 4) {
        this.horizontalRulerTop.style.top = containerTop + conTop + 'px';
        var _val11 = conTop;
        if (this.rulerTop === null) this.rulerTop = _val11;
      }
      // block bottom
      if (conBottom - 4 <= bottom && bottom <= conBottom + 4) {
        this.horizontalRulerBottom.style.top = containerTop + conBottom - 3 + 'px'; // -3 is an adjustment to make the line visible

        var _val12 = conBottom - block.offsetHeight;
        if (this.rulerTop === null) this.rulerTop = _val12;
      }
      // block left
      if (conLeft - 4 <= left && left <= conLeft + 4) {
        this.verticalRulerLeft.style.left = conLeft + 2 + 'px'; // +3 is an adjustment
        this.verticalRulerLeft.style.top = containerTop + 'px';
        var _val13 = conLeft;
        if (this.rulerLeft === null) this.rulerLeft = _val13;
      }
      // block right
      if (conRight - 4 <= right && right <= conRight + 4) {
        this.verticalRulerRight.style.left = conRight - 2 + 'px'; // -2 is an adjustment
        this.verticalRulerRight.style.top = containerTop + 'px';
        var _val14 = conRight;
        if (this.rulerRight === null) this.rulerRight = _val14;
      }
    }
  }]);
  return Ruler;
}();
var editableblocks_Rotatable = /*#__PURE__*/function () {
  function Rotatable(options) {
    editableblocks_classCallCheck(this, Rotatable);
    this.selector = options && options.selector || '.is-block';
    this.doc = options && options.doc || document;
    this.win = options && options.win || window;
    this.onBeforeChange = options && options.onBeforeChange || null;
    this.onChange = options && options.onChange || null;
    this.disableOnMobile = options && options.disableOnMobile || 0;
    this.centerX = 0;
    this.centerY = 0;
    this.initialRotation = 0;
    this.handleRotateStart = this.handleRotateStart.bind(this);
    this.handleDblClick = this.handleDblClick.bind(this);
    this.handleRotateMove = this.handleRotateMove.bind(this);
    this.handleRotateEnd = this.handleRotateEnd.bind(this);
    this.setup();
    this.common = new Common({
      selector: this.selector
    });
  }
  editableblocks_createClass(Rotatable, [{
    key: "setup",
    value: function setup() {
      var _this4 = this;
      this.elements = this.doc.querySelectorAll(this.selector);
      this.elements.forEach(function (element) {
        element.querySelectorAll('.rotate-handle').forEach(function (elm) {
          return elm.parentNode.removeChild(elm);
        });
        var handleHTML = '<div class="rotate-handle" contentEditable="false"><div></div></div>';
        element.insertAdjacentHTML('afterbegin', handleHTML);
        var handles = Array.from(element.querySelectorAll('.rotate-handle')).filter(function (handle) {
          return handle.parentElement === element;
        });
        handles.forEach(function (handle) {
          handle.addEventListener('mousedown', _this4.handleRotateStart);
          handle.addEventListener('touchstart', _this4.handleRotateStart, {
            passive: false
          });
          handle.addEventListener('dblclick', _this4.handleDblClick);
        });
      });
    }
  }, {
    key: "refresh",
    value: function refresh() {
      var _this5 = this;
      this.elements = this.doc.querySelectorAll(this.selector);
      this.elements.forEach(function (element) {
        var handles = Array.from(element.querySelectorAll('.rotate-handle')).filter(function (handle) {
          return handle.parentElement === element;
        }); // only one handle
        handles.forEach(function (handle) {
          handle.removeEventListener('mousedown', _this5.handleRotateStart);
          handle.removeEventListener('touchstart', _this5.handleRotateStart);
          handle.removeEventListener('dblclick', _this5.handleDblClick);
          handle.parentNode.removeChild(handle);
        });
        var handleHTML = '<div class="rotate-handle" contentEditable="false"><div></div></div>';
        element.insertAdjacentHTML('afterbegin', handleHTML);
        handles = Array.from(element.querySelectorAll('.rotate-handle')).filter(function (handle) {
          return handle.parentElement === element;
        }); // only one handle
        handles.forEach(function (handle) {
          handle.addEventListener('mousedown', _this5.handleRotateStart);
          handle.addEventListener('touchstart', _this5.handleRotateStart, {
            passive: false
          });
          handle.addEventListener('dblclick', _this5.handleDblClick);
        });
      });
    }
  }, {
    key: "destroy",
    value: function destroy(block) {
      var _this6 = this;
      if (block) {
        this.elements = this.doc.querySelectorAll(this.selector);
        this.elements.forEach(function (element) {
          if (element === block) {
            var handles = Array.from(element.querySelectorAll('.rotate-handle')).filter(function (handle) {
              return handle.parentElement === element;
            });
            handles.forEach(function (handle) {
              handle.removeEventListener('mousedown', _this6.handleRotateStart);
              handle.removeEventListener('touchstart', _this6.handleRotateStart);
              handle.removeEventListener('dblclick', _this6.handleDblClick);
              handle.parentNode.removeChild(handle);
            });
          }
        });
      } else {
        this.elements = this.doc.querySelectorAll(this.selector);
        this.elements.forEach(function (element) {
          var handles = Array.from(element.querySelectorAll('.rotate-handle')).filter(function (handle) {
            return handle.parentElement === element;
          });
          handles.forEach(function (handle) {
            handle.removeEventListener('mousedown', _this6.handleRotateStart);
            handle.removeEventListener('touchstart', _this6.handleRotateStart);
            handle.removeEventListener('dblclick', _this6.handleDblClick);
            handle.parentNode.removeChild(handle);
          });
        });
      }
    }
  }, {
    key: "handleDblClick",
    value: function handleDblClick(event) {
      if (this.onBeforeChange) this.onBeforeChange();
      event.preventDefault();
      event.stopImmediatePropagation();
      var block = event.target.parentNode;
      var transform = block.style.transform;
      if (transform.includes('rotate')) block.style.transform = '';
      this.clonedTarget = this.doc.querySelector(this.selector + '.cloned');
      if (this.clonedTarget) this.clonedTarget.style.transform = '';
      if (this.onChange) this.onChange();
    }
  }, {
    key: "handleRotateStart",
    value: function handleRotateStart(event) {
      var _this7 = this;
      var viewportWidth = this.win.innerWidth;
      if (viewportWidth <= this.disableOnMobile) return;
      if (event.type === 'touchstart' && event.touches.length !== 1) {
        return; // Do nothing if more than one touch point is detected
      }

      if (event.type === 'mousedown' && event.button !== 0) {
        return; // Do nothing if the right mouse button is clicked
      }

      event.preventDefault();
      this.target = event.target.parentNode; // block

      this.clonedTarget = this.doc.querySelector(this.selector + '.cloned');
      this.dragStartTimeout = setTimeout(function () {
        // Set a timeout before starting the drag (to differentiate from click)

        if (event.type === 'mousedown') {
          _this7.startRotation(event.clientX, event.clientY);
        } else if (event.type === 'touchstart') {
          var touch = event.touches[0];
          _this7.startRotation(touch.clientX, touch.clientY);
        }
        _this7.doc.addEventListener('mousemove', _this7.handleRotateMove);
        _this7.doc.addEventListener('touchmove', _this7.handleRotateMove);
      }, 120);
      this.doc.addEventListener('mouseup', this.handleRotateEnd);
      this.doc.addEventListener('touchend', this.handleRotateEnd);
    }
  }, {
    key: "handleRotateMove",
    value: function handleRotateMove() {
      var clientX, clientY;
      if (event.type === 'mousemove') {
        clientX = event.clientX;
        clientY = event.clientY;
      } else if (event.type === 'touchmove') {
        var touch = event.touches[0];
        clientX = touch.clientX;
        clientY = touch.clientY;
      }
      this.updateRotation(clientX, clientY);
    }
  }, {
    key: "handleRotateEnd",
    value: function handleRotateEnd() {
      clearTimeout(this.dragStartTimeout);
      this.doc.removeEventListener('mousemove', this.handleRotateMove);
      this.doc.removeEventListener('touchmove', this.handleRotateMove);
      this.doc.removeEventListener('mouseup', this.handleRotateEnd);
      this.doc.removeEventListener('touchend', this.handleRotateEnd);
      if (this.onChange) this.onChange();
    }
  }, {
    key: "getCurrentRotation",
    value: function getCurrentRotation(transform) {
      var match = transform.match(/rotate\(([-+]?\d*\.?\d*)deg\)/);
      return match ? parseFloat(match[1]) : 0;
    }
  }, {
    key: "startRotation",
    value: function startRotation() {
      if (this.onBeforeChange) this.onBeforeChange();
      var target = this.target;
      var rect = target.getBoundingClientRect();
      this.centerX = rect.left + rect.width / 2;
      this.centerY = rect.top + rect.height / 2;

      // Store the initial rotation
      if (target.parentNode.matches(this.selector)) {
        var currentTransform = target.style.transform;
        var currentRotation = this.getCurrentRotation(currentTransform);
        this.initialRotation = currentRotation;
        var parentTransform = target.parentNode.style.transform;
        var parentRotation = this.getCurrentRotation(parentTransform);
        if (parentRotation) {
          this.initialRotation = parentRotation;
        }
      } else {
        this.initialRotation = 0; // If no child blocks
      }
    }
  }, {
    key: "updateRotation",
    value: function updateRotation(x, y) {
      var target = this.target;
      var angle = Math.atan2(y - this.centerY, x - this.centerX);
      var degrees = angle * (180 / Math.PI);
      var initialRotation = this.initialRotation || 0;
      target.style.transform = "rotate(".concat(degrees - initialRotation, "deg)");
      if (this.clonedTarget) this.clonedTarget.style.transform = "rotate(".concat(degrees - initialRotation, "deg)");
    }
  }]);
  return Rotatable;
}();
var editableblocks_Resizable = /*#__PURE__*/function () {
  function Resizable(options) {
    editableblocks_classCallCheck(this, Resizable);
    this.selector = options && options.selector || '.is-block';
    this.doc = options && options.doc || document;
    this.win = options && options.win || window;
    this.onBeforeChange = options && options.onBeforeChange || null;
    this.onChange = options && options.onChange || null;
    this.disableOnMobile = options && options.disableOnMobile || 0;
    this.isResizing = false;
    this.resizeHandle = null;
    this.startX = 0;
    this.startY = 0;
    this.elements = this.doc.querySelectorAll(this.selector);
    this.startResizing = this.startResizing.bind(this);
    this.handleResizeMove = this.handleResizeMove.bind(this);
    this.handleResizeEnd = this.handleResizeEnd.bind(this);
    this.setup();
    this.ruler = new Ruler({
      selector: this.selector,
      doc: this.doc,
      win: this.win
    });
    this.common = new Common({
      selector: this.selector,
      doc: this.doc,
      win: this.win
    });
  }
  editableblocks_createClass(Resizable, [{
    key: "setZoom",
    value: function setZoom(scale) {
      this.zoom = scale;
      this.common.setZoom(scale);
      this.ruler.setZoom(scale);
    }
  }, {
    key: "setup",
    value: function setup() {
      var _this8 = this;
      this.elements.forEach(function (element) {
        element.querySelectorAll('.handle').forEach(function (elm) {
          return elm.parentNode.removeChild(elm);
        });
        var handleHTML = "\n            <div class=\"handle top-left\"></div>\n            <div class=\"handle top-right\"></div>\n            <div class=\"handle bottom-left\"></div>\n            <div class=\"handle bottom-right\"></div>\n            \n            <div class=\"handle top\"></div>\n            <div class=\"handle bottom\"></div>\n            <div class=\"handle left\"></div>\n            <div class=\"handle right\"></div>";
        element.insertAdjacentHTML('afterbegin', handleHTML);
        var handles = Array.from(element.querySelectorAll('.handle')).filter(function (handle) {
          return handle.parentElement === element;
        });
        handles.forEach(function (handle) {
          handle.addEventListener('mousedown', _this8.startResizing);
          handle.addEventListener('touchstart', _this8.startResizing, {
            passive: false
          });
        });
      });
    }
  }, {
    key: "refresh",
    value: function refresh() {
      var _this9 = this;
      this.elements = this.doc.querySelectorAll(this.selector);
      this.elements.forEach(function (element) {
        var handles = Array.from(element.querySelectorAll('.handle')).filter(function (handle) {
          return handle.parentElement === element;
        });
        handles.forEach(function (handle) {
          handle.removeEventListener('mousedown', _this9.startResizing);
          handle.removeEventListener('touchstart', _this9.startResizing);
          handle.parentNode.removeChild(handle);
        });
        var handleHTML = "\n                <div class=\"handle top-left\"></div>\n                <div class=\"handle top-right\"></div>\n                <div class=\"handle bottom-left\"></div>\n                <div class=\"handle bottom-right\"></div>\n            \n                <div class=\"handle top\"></div>\n                <div class=\"handle bottom\"></div>\n                <div class=\"handle left\"></div>\n                <div class=\"handle right\"></div>";
        element.insertAdjacentHTML('afterbegin', handleHTML);
        handles = Array.from(element.querySelectorAll('.handle')).filter(function (handle) {
          return handle.parentElement === element;
        });
        handles.forEach(function (handle) {
          handle.addEventListener('mousedown', _this9.startResizing);
          handle.addEventListener('touchstart', _this9.startResizing, {
            passive: false
          });
        });
      });
      this.ruler.refresh();
    }
  }, {
    key: "destroy",
    value: function destroy(block) {
      var _this10 = this;
      if (block) {
        var handles = Array.from(block.querySelectorAll('.handle')).filter(function (handle) {
          return handle.parentElement === block;
        });
        handles.forEach(function (handle) {
          handle.removeEventListener('mousedown', _this10.startResizing);
          handle.removeEventListener('touchstart', _this10.startResizing);
          handle.parentNode.removeChild(handle);
        });
      } else {
        var _handles = this.doc.querySelectorAll('.handle');
        _handles.forEach(function (handle) {
          handle.removeEventListener('mousedown', _this10.startResizing);
          handle.removeEventListener('touchstart', _this10.startResizing);
          handle.parentNode.removeChild(handle);
        });
        this.ruler.destroy();
      }
    }
  }, {
    key: "startResizing",
    value: function startResizing(event) {
      var _this11 = this;
      var viewportWidth = this.win.innerWidth;
      if (viewportWidth <= this.disableOnMobile) return;
      if (event.type === 'touchstart' && event.touches.length !== 1) {
        return; // Do nothing if more than one touch point is detected
      }

      if (event.type === 'mousedown' && event.button !== 0) {
        return; // Do nothing if the right mouse button is clicked
      }

      this.target = event.target.parentNode; // block

      this.clonedTarget = this.doc.querySelector(this.selector + '.cloned');
      event.preventDefault();
      event.stopPropagation();
      this.dragStartTimeout = setTimeout(function () {
        // Set a timeout before starting the drag (to differentiate from click)

        if (_this11.onBeforeChange) _this11.onBeforeChange();
        var handle = event.target.closest('.handle');
        _this11.isResizing = true;
        _this11.resizeHandle = handle.classList[1];
        if (event.type === 'mousedown') {
          _this11.startX = event.clientX;
          _this11.startY = event.clientY;
        } else if (event.type === 'touchstart') {
          var touch = event.touches[0];
          _this11.startX = touch.clientX;
          _this11.startY = touch.clientY;
        }

        //Initial
        _this11.initialWidth = parseFloat(getComputedStyle(_this11.target).width);
        _this11.initialHeight = parseFloat(getComputedStyle(_this11.target).height);
        var containerRect = _this11.common.getRect(_this11.target.parentNode);
        var rect = _this11.common.getRect(_this11.target);
        _this11.initialLeft = rect.left - containerRect.left;
        _this11.initialTop = rect.top - containerRect.top;
        _this11.common.applyPixels(_this11.target);
      }, 120);
      this.doc.addEventListener('mousemove', this.handleResizeMove);
      this.doc.addEventListener('mouseup', this.handleResizeEnd);
      this.doc.addEventListener('touchmove', this.handleResizeMove);
      this.doc.addEventListener('touchend', this.handleResizeEnd);
    }
  }, {
    key: "handleResizeMove",
    value: function handleResizeMove(event) {
      if (this.isResizing) {
        var deltaX, deltaY;
        if (event.type === 'mousemove') {
          deltaX = event.clientX - this.startX;
          deltaY = event.clientY - this.startY;
        } else if (event.type === 'touchmove') {
          var touch = event.touches[0];
          deltaX = touch.clientX - this.startX;
          deltaY = touch.clientY - this.startY;
        }
        this.target.style.minWidth = ''; // to ensure no resize limit
        if (this.clonedTarget) this.clonedTarget.style.minWidth = '';
        switch (this.resizeHandle) {
          case 'top-left':
            this.resizeTopLeft(deltaX, deltaY);
            break;
          case 'top-right':
            this.resizeTopRight(deltaX, deltaY);
            break;
          case 'bottom-left':
            this.resizeBottomLeft(deltaX, deltaY);
            break;
          case 'bottom-right':
            this.resizeBottomRight(deltaX, deltaY);
            break;
          case 'top':
            this.resizeTop(deltaY);
            break;
          case 'left':
            this.resizeLeft(deltaX);
            break;
          case 'bottom':
            this.resizeBottom(deltaY);
            break;
          case 'right':
            this.resizeRight(deltaX);
            break;
          default:
            break;
        }
        this.ruler.updateRulers(this.target);
      }
    }
  }, {
    key: "handleResizeEnd",
    value: function handleResizeEnd() {
      clearTimeout(this.dragStartTimeout);
      this.stopResizing();
      this.doc.removeEventListener('mousemove', this.handleResizeMove);
      this.doc.removeEventListener('mouseup', this.handleResizeEnd);
      this.doc.removeEventListener('touchmove', this.handleResizeMove);
      this.doc.removeEventListener('touchend', this.handleResizeEnd);
      this.ruler.hideRulers();
    }
  }, {
    key: "resizeTopLeft",
    value: function resizeTopLeft(deltaX, deltaY) {
      var zoom = this.zoom;
      this.target.style.left = this.initialLeft / zoom + deltaX + 'px';
      this.target.style.top = this.initialTop / zoom + deltaY + 'px';
      this.target.style.width = this.initialWidth - deltaX + 'px';
      this.target.style.height = this.initialHeight - deltaY + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.left = this.initialLeft / zoom + deltaX + 'px';
        this.clonedTarget.style.top = this.initialTop / zoom + deltaY + 'px';
        this.clonedTarget.style.width = this.initialWidth - deltaX + 'px';
        this.clonedTarget.style.height = this.initialHeight - deltaY + 'px';
      }
    }
  }, {
    key: "resizeTopRight",
    value: function resizeTopRight(deltaX, deltaY) {
      var zoom = this.zoom;
      this.target.style.width = this.initialWidth + deltaX + 'px';
      this.target.style.top = this.initialTop / zoom + deltaY + 'px';
      this.target.style.height = this.initialHeight - deltaY + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.width = this.initialWidth + deltaX + 'px';
        this.clonedTarget.style.top = this.initialTop / zoom + deltaY + 'px';
        this.clonedTarget.style.height = this.initialHeight - deltaY + 'px';
      }
    }
  }, {
    key: "resizeBottomLeft",
    value: function resizeBottomLeft(deltaX, deltaY) {
      var zoom = this.zoom;
      this.target.style.width = this.initialWidth - deltaX + 'px';
      this.target.style.height = this.initialHeight + deltaY + 'px';
      this.target.style.left = this.initialLeft / zoom + deltaX + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.width = this.initialWidth - deltaX + 'px';
        this.clonedTarget.style.height = this.initialHeight + deltaY + 'px';
        this.clonedTarget.style.left = this.initialLeft / zoom + deltaX + 'px';
      }
    }
  }, {
    key: "resizeBottomRight",
    value: function resizeBottomRight(deltaX, deltaY) {
      this.target.style.width = this.initialWidth + deltaX + 'px';
      this.target.style.height = this.initialHeight + deltaY + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.width = this.initialWidth + deltaX + 'px';
        this.clonedTarget.style.height = this.initialHeight + deltaY + 'px';
      }
    }
  }, {
    key: "resizeTop",
    value: function resizeTop(deltaY) {
      var zoom = this.zoom;
      this.target.style.top = this.initialTop / zoom + deltaY + 'px';
      this.target.style.height = this.initialHeight - deltaY + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.top = this.initialTop / zoom + deltaY + 'px';
        this.clonedTarget.style.height = this.initialHeight - deltaY + 'px';
      }
    }
  }, {
    key: "resizeBottom",
    value: function resizeBottom(deltaY) {
      this.target.style.height = this.initialHeight + deltaY + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.height = this.initialHeight + deltaY + 'px';
      }
    }
  }, {
    key: "resizeLeft",
    value: function resizeLeft(deltaX) {
      var zoom = this.zoom;
      this.target.style.width = this.initialWidth - deltaX + 'px';
      this.target.style.left = this.initialLeft / zoom + deltaX + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.width = this.initialWidth - deltaX + 'px';
        this.clonedTarget.style.left = this.initialLeft / zoom + deltaX + 'px';
      }
    }
  }, {
    key: "resizeRight",
    value: function resizeRight(deltaX) {
      this.target.style.width = this.initialWidth + deltaX + 'px';
      if (this.clonedTarget) {
        this.clonedTarget.style.width = this.initialWidth + deltaX + 'px';
      }
    }
  }, {
    key: "stopResizing",
    value: function stopResizing() {
      if (this.isResizing) {
        if (this.target) {
          this.updateBlockStyle(this.target);
          if (this.clonedTarget) this.updateBlockStyle(this.clonedTarget);
        }
        this.isResizing = false;
      }
    }
  }, {
    key: "updateBlockStyle",
    value: function updateBlockStyle(target) {
      var _this12 = this;
      if (target.querySelector(this.selector)) {// For group, don't make the height auto
        // Do Nothing
      } else {
        // this.common.updateHeight(target);
        if (target.classList.contains('height-auto')) target.style.height = '';
      }

      // Replace with ruler's alignment
      if (this.ruler.rulerTop !== null) {
        target.style.top = this.ruler.rulerTop + 'px';
        // if container has top/left
        if (target.parentNode.matches(this.selector)) {
          var containerRect = target.parentNode.getBoundingClientRect();
          target.style.top = this.ruler.rulerTop - containerRect.top + 'px';
        }
      }

      // If resizing by dragging the right corners (top or bottom)
      if (this.resizeHandle === 'top-right' || this.resizeHandle === 'bottom-right' || this.resizeHandle === 'right') {
        // Check if vertical right ruler visible (has value)
        if (this.ruler.rulerRight !== null) {
          // If so, keep the left position
          // target.style.left = newLeft + 'px';

          // And update the width to align with vertical right ruler
          var rect = target.getBoundingClientRect();
          target.style.width = this.ruler.rulerRight - rect.left + 'px';
        }
      } else if (this.resizeHandle === 'top-left' || this.resizeHandle === 'bottom-left' || this.resizeHandle === 'left') {
        if (this.ruler.rulerLeft !== null) {
          var currentRight = this.initialLeft + this.initialWidth;

          // if container has top/left
          var _containerRect = target.parentNode.getBoundingClientRect();
          this.ruler.rulerLeft = this.ruler.rulerLeft - _containerRect.left;

          // And update the width to align with vertical left ruler
          target.style.left = this.ruler.rulerLeft + 'px';
          var newWidth = currentRight - this.ruler.rulerLeft;
          target.style.width = newWidth + 'px';
        }
      }

      // Convert px to %
      this.common.applyPercentage(target);
      setTimeout(function () {
        var breakpoint = _this12.doc.body.getAttribute('data-breakpoint');

        // const screenWidth = window.innerWidth;
        // let defaultPoint;
        // if(screenWidth<=1920) {
        //     defaultPoint = 1366;
        // } else {
        //     defaultPoint = 1900;
        // }

        var largeScreenBreakpoint = 1280; //1920
        largeScreenBreakpoint = window.innerWidth - 360; //351
        if (largeScreenBreakpoint < 1280) largeScreenBreakpoint = 1280;
        var isPrint = false;
        var elmBox = target.closest('[data-pagesize]');
        if (elmBox) {
          if (elmBox.getAttribute('data-pagesize').includes('web')) {
            // Do Nothing
          } else {
            isPrint = true;
          }
        }
        if (isPrint) {
          target.setAttribute('data--t', target.style.top);
          target.setAttribute('data--l', target.style.left);
          target.setAttribute('data--b', target.style.bottom);
          target.setAttribute('data--r', target.style.right);
          target.setAttribute('data--w', target.style.width);
          target.setAttribute('data--h', target.style.height);
        } else {
          if (breakpoint && breakpoint < largeScreenBreakpoint) {
            target.setAttribute('data--t-' + breakpoint, target.style.top);
            target.setAttribute('data--l-' + breakpoint, target.style.left);
            target.setAttribute('data--b-' + breakpoint, target.style.bottom);
            target.setAttribute('data--r-' + breakpoint, target.style.right);
            if (!target.classList.contains('fluid')) target.setAttribute('data--w-' + breakpoint, target.style.width);
            target.setAttribute('data--h-' + breakpoint, target.style.height);
          } else {
            target.setAttribute('data--t', target.style.top);
            target.setAttribute('data--l', target.style.left);
            target.setAttribute('data--b', target.style.bottom);
            target.setAttribute('data--r', target.style.right);
            target.setAttribute('data--w', target.style.width);
            target.setAttribute('data--h', target.style.height);
          }
        }
        target.removeAttribute('data-prev'); // reset
        target.removeAttribute('data-fluid');
      }, 30); // delay needed since we use updateHeight() previously that has 20ms process

      if (this.onChange) this.onChange();
    }
  }]);
  return Resizable;
}();
var editableblocks_Draggable = /*#__PURE__*/function () {
  function Draggable(options) {
    editableblocks_classCallCheck(this, Draggable);
    this.selector = options && options.selector || '.is-block';
    this.doc = options && options.doc || document;
    this.win = options && options.win || window;
    this.controlSelector = options && options.controlSelector || null;
    this.onDelete = options && options.onDelete || null;
    this.onBeforeChange = options && options.onBeforeChange || null;
    this.onChange = options && options.onChange || null;
    this.onSelectStart = options && options.onSelectStart || null;
    this.onSelectClear = options && options.onSelectClear || null;
    this.disableOnMobile = options && options.disableOnMobile || 0;
    this.onMultipleSelect = options && options.onMultipleSelect || null;
    this.onSelectBlock = options && options.onSelectBlock || null;
    this.isDragging = false;
    this.startX = 0;
    this.startY = 0;
    this.handleDragStart = this.handleDragStart.bind(this);
    this.handleDragMove = this.handleDragMove.bind(this);
    this.handleDragEnd = this.handleDragEnd.bind(this);
    this.handleSelect = this.handleSelect.bind(this);
    this.handleKeyDown = this.handleKeyDown.bind(this);
    this.setup();
    this.ruler = new Ruler({
      selector: this.selector,
      doc: this.doc,
      win: this.win
    });
    this.common = new Common({
      selector: this.selector,
      doc: this.doc,
      win: this.win
    });
  }
  editableblocks_createClass(Draggable, [{
    key: "setZoom",
    value: function setZoom(scale) {
      this.zoom = scale;
      this.common.setZoom(scale);
      this.ruler.setZoom(scale);
    }
  }, {
    key: "setup",
    value: function setup() {
      var _this13 = this;
      this.elements = this.doc.querySelectorAll(this.selector);
      this.elements.forEach(function (element) {
        element.addEventListener('mousedown', _this13.handleDragStart);
        element.addEventListener('touchstart', _this13.handleDragStart, {
          passive: false
        });
      });
      this.doc.addEventListener('mousedown', this.handleSelect);
      this.doc.addEventListener('touchstart', this.handleSelect, {
        passive: false
      });
      this.doc.addEventListener('keydown', this.handleKeyDown);
    }
  }, {
    key: "refresh",
    value: function refresh() {
      var _this14 = this;
      this.elements = this.doc.querySelectorAll(this.selector);
      this.elements.forEach(function (element) {
        element.removeEventListener('mousedown', _this14.handleDragStart);
        element.removeEventListener('touchstart', _this14.handleDragStart);
      });
      this.elements.forEach(function (element) {
        if (element.classList.contains('locked')) return;
        element.addEventListener('mousedown', _this14.handleDragStart);
        element.addEventListener('touchstart', _this14.handleDragStart, {
          passive: false
        });
      });
      this.ruler.refresh();
    }
  }, {
    key: "destroy",
    value: function destroy() {
      var _this15 = this;
      this.ruler.destroy();
      this.elements.forEach(function (element) {
        element.removeEventListener('mousedown', _this15.handleDragStart);
        element.removeEventListener('touchstart', _this15.handleDragStart);
      });
      this.doc.removeEventListener('mousedown', this.handleSelect);
      this.doc.removeEventListener('touchstart', this.handleSelect);
      this.doc.removeEventListener('keydown', this.handleKeyDown);
      var blocks = this.doc.querySelectorAll(this.selector);
      blocks.forEach(function (elm) {
        return elm.classList.remove('active');
      });
    }
  }, {
    key: "disableDrag",
    value: function disableDrag(block) {
      var _this16 = this;
      this.elements.forEach(function (element) {
        if (block === element) {
          element.removeEventListener('mousedown', _this16.handleDragStart);
          element.removeEventListener('touchstart', _this16.handleDragStart);
        }
      });
    }
  }, {
    key: "enableDrag",
    value: function enableDrag(block) {
      var _this17 = this;
      this.elements.forEach(function (element) {
        if (block === element) {
          element.addEventListener('mousedown', _this17.handleDragStart);
          element.addEventListener('touchstart', _this17.handleDragStart, {
            passive: false
          });
        }
      });
    }
  }, {
    key: "handleDragStart",
    value: function handleDragStart(event) {
      var _this18 = this;
      var viewportWidth = this.win.innerWidth;
      if (viewportWidth <= this.disableOnMobile) return;
      if (event.target.classList.contains('rotate-handle')) return;
      if (event.type === 'touchstart' && event.touches.length !== 1) {
        return; // Do nothing if more than one touch point is detected
      }

      if (event.type === 'mousedown' && event.button !== 0) {
        return; // Do nothing if the right mouse button is clicked
      }

      var currentTarget = event.currentTarget;
      var clickedBlock = event.target.closest(this.selector);
      if (currentTarget !== clickedBlock) {
        // Triggered Group click by child block click
        return; // Return here, so that when block events are working, group events won't
      }

      this.clickedBlock = clickedBlock;
      this.dragStartTimeout = setTimeout(function () {
        // Set a timeout before starting the drag (to differentiate from click)

        if (event.type === 'mousedown') {
          _this18.startDragging(event.clientX, event.clientY, currentTarget);
        } else if (event.type === 'touchstart') {
          var touch = event.touches[0];
          _this18.startDragging(touch.clientX, touch.clientY, currentTarget);
        }
        _this18.doc.addEventListener('mousemove', _this18.handleDragMove);
        _this18.doc.addEventListener('touchmove', _this18.handleDragMove);
      }, 120);
      this.doc.addEventListener('mouseup', this.handleDragEnd);
      this.doc.addEventListener('touchend', this.handleDragEnd);
    }
  }, {
    key: "startDragging",
    value: function startDragging(startX, startY) {
      var _this19 = this;
      if (this.onBeforeChange) this.onBeforeChange();
      this.isDragging = true;
      var blocks = this.doc.querySelectorAll(this.selector + '.active');
      blocks.forEach(function (target) {
        // const containerRect = target.parentNode.getBoundingClientRect(); // if container has top/left
        var containerRect = _this19.common.getRect(target.parentNode); // if container has top/left
        var rect = _this19.common.getRect(target);
        var x = startX - rect.left + containerRect.left;
        var y = startY - rect.top + containerRect.top;
        target.setAttribute('data-startx', x);
        target.setAttribute('data-starty', y);
        _this19.common.applyPixels(target);
      });
      this.clickedBlock = this.common.getSelectedBlock();
    }
  }, {
    key: "handleDragMove",
    value: function handleDragMove(event) {
      var _this20 = this;
      var clientX, clientY;
      if (event.type === 'mousemove') {
        clientX = event.clientX;
        clientY = event.clientY;
      } else if (event.type === 'touchmove') {
        var touch = event.touches[0];
        clientX = touch.clientX;
        clientY = touch.clientY;
      }
      if (this.isDragging) {
        // Allows dragging multiple selected blocks

        var blocks = this.doc.querySelectorAll(this.selector + '.active');
        blocks.forEach(function (target) {
          _this20.updatePosition(clientX, clientY, target);
        });

        // Ruler works for single block selection only
        if (this.clickedBlock) this.ruler.updateRulers(this.clickedBlock);
      }
      event.preventDefault();
      event.stopImmediatePropagation();
    }
  }, {
    key: "updatePosition",
    value: function updatePosition(x, y, target) {
      if (this.isDragging) {
        var startX = target.getAttribute('data-startx');
        var startY = target.getAttribute('data-starty');
        var newX = x - startX;
        var newY = y - startY;
        var zoom = this.zoom;
        target.style.left = newX / zoom + 'px';
        target.style.top = newY / zoom + 'px';
      }
    }
  }, {
    key: "handleDragEnd",
    value: function handleDragEnd() {
      clearTimeout(this.dragStartTimeout);
      if (this.isDragging) {
        this.doc.removeEventListener('mousemove', this.handleDragMove);
        this.doc.removeEventListener('touchmove', this.handleDragMove);
      }
      this.doc.removeEventListener('mouseup', this.handleDragEnd);
      this.doc.removeEventListener('touchend', this.handleDragEnd);
      this.stopDragging();
      this.ruler.hideRulers();
      var blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active') && !elm.classList.contains('multi');
      });
      if (blocks.length === 1) {
        var block = blocks[0];
        if (this.onSelectStart) this.onSelectStart(block); // on first block select (before clone) 
      }
    }
  }, {
    key: "stopDragging",
    value: function stopDragging() {
      var _this21 = this;
      if (this.isDragging) {
        var blocks = this.doc.querySelectorAll(this.selector + '.active');
        blocks.forEach(function (target) {
          _this21.updateBlockStyle(target);
        });
        this.isDragging = false;
      }
    }
  }, {
    key: "updateBlockStyle",
    value: function updateBlockStyle(target) {
      // Replace with ruler's alignment
      var containerRect = this.common.getRect(target.parentNode); // if container has top/left
      var initialWidth = parseFloat(getComputedStyle(target).width);
      if (this.ruler.rulerTop !== null) target.style.top = this.ruler.rulerTop - containerRect.top + 'px';
      if (this.ruler.rulerLeft !== null) target.style.left = this.ruler.rulerLeft - containerRect.left + 'px';else if (this.ruler.rulerRight !== null) target.style.left = this.ruler.rulerRight - initialWidth - containerRect.left + 'px';
      this.doc.querySelectorAll('[data-startx]').forEach(function (elm) {
        return elm.removeAttribute('data-startx');
      });
      this.doc.querySelectorAll('[data-starty]').forEach(function (elm) {
        return elm.removeAttribute('data-starty');
      });
      this.common.applyPercentage(target);
      var breakpoint = this.doc.body.getAttribute('data-breakpoint');

      // const screenWidth = window.innerWidth;
      // let defaultPoint;
      // if(screenWidth<=1920) {
      //     defaultPoint = 1366;
      // } else {
      //     defaultPoint = 1900;
      // }

      var largeScreenBreakpoint = 1280; //1920
      largeScreenBreakpoint = window.innerWidth - 360; //351
      if (largeScreenBreakpoint < 1280) largeScreenBreakpoint = 1280;
      var isPrint = false;
      var elmBox = target.closest('[data-pagesize]');
      if (elmBox) {
        if (elmBox.getAttribute('data-pagesize').includes('web')) {
          // Do Nothing
        } else {
          isPrint = true;
        }
      }
      if (isPrint) {
        target.setAttribute('data--t', target.style.top);
        target.setAttribute('data--l', target.style.left);
        target.setAttribute('data--b', target.style.bottom);
        target.setAttribute('data--r', target.style.right);
        target.setAttribute('data--w', target.style.width);
        target.setAttribute('data--h', target.style.height);
      } else {
        if (breakpoint && breakpoint < largeScreenBreakpoint) {
          target.setAttribute('data--t-' + breakpoint, target.style.top);
          target.setAttribute('data--l-' + breakpoint, target.style.left);
          target.setAttribute('data--b-' + breakpoint, target.style.bottom);
          target.setAttribute('data--r-' + breakpoint, target.style.right);
          if (!target.classList.contains('fluid')) target.setAttribute('data--w-' + breakpoint, target.style.width);
          target.setAttribute('data--h-' + breakpoint, target.style.height);
        } else {
          target.setAttribute('data--t', target.style.top);
          target.setAttribute('data--l', target.style.left);
          target.setAttribute('data--b', target.style.bottom);
          target.setAttribute('data--r', target.style.right);
          target.setAttribute('data--w', target.style.width);
          target.setAttribute('data--h', target.style.height);
        }
      }
      target.removeAttribute('data-prev'); // reset
      target.removeAttribute('data-fluid');
      if (this.onChange) this.onChange();
    }
  }, {
    key: "handleSelect",
    value: function handleSelect(event) {
      var element = event.target;
      if (element.classList.contains('rotate-handle')) return;
      var block = element.closest(this.selector);
      if (block) {
        if (block.classList.contains('active')) {
          var actualBlock = block.classList.contains('clone') ? this.doc.querySelector(this.selector + '.cloned') : null;
          if (!actualBlock) actualBlock = block;
          if (this.onSelectBlock) this.onSelectBlock(actualBlock);
          return; // if clicked block is active
        }
        // if(block.parentNode.classList.contains('active')) return; // if group is active

        if (block.matches(this.selector) && block.querySelector(this.selector)) {
          // if group is clicked, remove active childe's blocks
          block.querySelectorAll(this.selector).forEach(function (elm) {
            return elm.classList.remove('active');
          });
        }
        if (event.shiftKey || this.doc.body.classList.contains('multi-select')) {
          // multi select
          block.classList.add('active');
          if (this.onMultipleSelect) this.onMultipleSelect();
        } else {
          if (this.onSelectClear) this.onSelectClear();
          this.doc.querySelectorAll(this.selector + '.active').forEach(function (elm) {
            return elm.classList.remove('active');
          });
          block.classList.add('active');
          var _actualBlock = block.classList.contains('clone') ? this.doc.querySelector(this.selector + '.cloned') : null;
          if (!_actualBlock) _actualBlock = block;
          if (this.onSelectBlock) this.onSelectBlock(_actualBlock);
        }
        if (!block.parentNode) return; // just in case

        // Higlight parent group if current child block is clicked
        if (block.parentNode.matches(this.selector)) {
          block.parentNode.classList.add('block-active');
        } else {
          this.doc.querySelectorAll('.block-active').forEach(function (elm) {
            return elm.classList.remove('block-active');
          });
        }
      } else {
        if (event.target.closest('.keep-selection') || this.controlSelector && event.target.closest(this.controlSelector)) return;

        // // Make empty height set with value
        // // if(this.clickedBlock) this.common.updateHeight(this.clickedBlock);
        // // Check
        // if(this.clickedBlock && !this.clickedBlock.classList.contains('clone')) {
        //     this.common.updateHeight(this.clickedBlock);
        // }

        this.doc.querySelectorAll(this.selector + '.active').forEach(function (elm) {
          return elm.classList.remove('active');
        });
        this.doc.querySelectorAll('.block-active').forEach(function (elm) {
          return elm.classList.remove('block-active');
        });
        if (this.onSelectClear) this.onSelectClear();
      }

      // Check if multiple selection occurs. If so, add 'multi' class to hide all the handles
      var blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active') && !elm.classList.contains('clone');
      });
      if (blocks.length > 1) {
        blocks.forEach(function (block) {
          block.classList.add('multi');
        });
      } else {
        var elms = this.doc.querySelectorAll('.multi');
        elms.forEach(function (elm) {
          return elm.classList.remove('multi');
        });
      }
    }
  }, {
    key: "delete",
    value: function _delete() {
      var _this22 = this;
      var blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active') && elm.classList.contains('editable');
      });
      if (blocks.length > 0) return;
      if (this.onBeforeChange) this.onBeforeChange();
      blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active');
      });
      blocks.forEach(function (element) {
        element.removeEventListener('mousedown', _this22.handleDragStart);
        element.removeEventListener('touchstart', _this22.handleDragStart);
        if (_this22.onDelete) _this22.onDelete(element);
        element.parentNode.removeChild(element);
      });
      if (this.onChange) this.onChange();
    }
  }, {
    key: "handleKeyDown",
    value: function handleKeyDown(event) {
      if (event.key === 'Delete' || event.key === 'Backspace' || event.keyCode === 46) {
        if (document.activeElement.tagName.toLowerCase() === 'input' || document.activeElement.tagName.toLowerCase() === 'textarea') {
          // Do Nothing
        } else {
          this["delete"]();
        }
      }
    }
  }]);
  return Draggable;
}();
var Editable = /*#__PURE__*/function () {
  function Editable(options) {
    editableblocks_classCallCheck(this, Editable);
    this.selector = options && options.selector || '.is-block';
    this.controlSelector = options && options.controlSelector || null;
    this.onEditStart = options && options.onEditStart || null;
    this.onEditEnd = options && options.onEditEnd || null;
    this.doc = options && options.doc || document;
    this.win = options && options.win || window;
    this.onContentClick = options && options.onContentClick || null;
    this.elements = this.doc.querySelectorAll(this.selector);
    this.handleEditStart = this.handleEditStart.bind(this);
    this.handleMouseClick = this.handleMouseClick.bind(this);
    this.handleTouchStart = this.handleTouchStart.bind(this);
    this.setup();
  }
  editableblocks_createClass(Editable, [{
    key: "setup",
    value: function setup() {
      var _this23 = this;
      this.elements.forEach(function (element) {
        element.addEventListener('dblclick', _this23.handleEditStart);
        element.addEventListener('touchstart', _this23.handleTouchStart, {
          passive: false
        });
      });
    }
  }, {
    key: "refresh",
    value: function refresh() {
      var _this24 = this;
      this.elements = this.doc.querySelectorAll(this.selector);
      this.elements.forEach(function (element) {
        element.removeEventListener('dblclick', _this24.handleEditStart);
        element.removeEventListener('touchstart', _this24.handleTouchStart);
      });
      this.elements.forEach(function (element) {
        element.addEventListener('dblclick', _this24.handleEditStart);
        element.addEventListener('touchstart', _this24.handleTouchStart, {
          passive: false
        });
      });
    }
  }, {
    key: "destroy",
    value: function destroy(element) {
      var _this25 = this;
      if (element) {
        element.removeEventListener('dblclick', this.handleEditStart);
        element.removeEventListener('touchstart', this.handleTouchStart);
      } else {
        this.elements = this.doc.querySelectorAll(this.selector);
        this.elements.forEach(function (element) {
          element.removeEventListener('dblclick', _this25.handleEditStart);
          element.removeEventListener('touchstart', _this25.handleTouchStart);
        });
      }
    }
  }, {
    key: "handleEditStart",
    value: function handleEditStart(event) {
      var _this26 = this;
      var currentTarget = event.currentTarget;
      if (currentTarget.querySelector(this.selector)) {
        // if group, no edit needed
        return;
      }
      var block = event.target.closest(this.selector);
      if (currentTarget !== block) {
        // Triggered Group click by child block click
        return; // Return here, so that when block events are working, group events won't
      }

      if (block.parentNode.matches(this.selector) && block.parentNode.classList.contains('active')) {
        // if group is active, no edit needed
        return;
      }
      this.clickedBlock = currentTarget;

      // currentTarget.classList.add('editable');
      // currentTarget.setAttribute('contentEditable', true);
      // currentTarget.style.cursor = 'auto'; // Change cursor to normal
      // currentTarget.focus();
      // this.placeCursorAtEnd(currentTarget);

      this.elements.forEach(function (element) {
        if (currentTarget === element) {
          element.removeEventListener('dblclick', _this26.handleEditStart);
          element.removeEventListener('touchstart', _this26.handleTouchStart);
          var clonedTarget = _this26.doc.querySelector(_this26.selector + '.cloned');
          if (clonedTarget) {
            clonedTarget.removeEventListener('dblclick', _this26.handleEditStart);
            clonedTarget.removeEventListener('touchstart', _this26.handleTouchStart);
            _this26.clickedBlock = clonedTarget;
          }
        }
      });
      this.doc.addEventListener('mousedown', this.handleMouseClick);
      this.doc.addEventListener('touchstart', this.handleMouseClick, {
        passive: false
      });
      if (this.onEditStart) this.onEditStart(event, currentTarget);
    }
  }, {
    key: "handleTouchStart",
    value: function handleTouchStart(event) {
      // Handle Double Tab
      if (event.touches.length === 1) {
        var now = new Date().getTime();
        var lastTouchTime = this.lastTouchTime || now;
        var timeDiff = now - lastTouchTime;
        if (timeDiff < 300 && timeDiff > 0) {
          // Less than 300ms since the last touch, consider it a double-tap
          this.handleDoubleTap(event);
        }
        this.lastTouchTime = now;
      }
    }
  }, {
    key: "handleDoubleTap",
    value: function handleDoubleTap(event) {
      this.handleEditStart(event);
    }
  }, {
    key: "handleMouseClick",
    value: function handleMouseClick(event) {
      var _this27 = this;
      var element = event.target;
      if (element.closest(this.selector) === this.clickedBlock || this.controlSelector && element.closest(this.controlSelector)) {
        // Do Nothing
        // Continue editing
        if (element.parentNode.matches(this.selector)) {
          if (this.onContentClick) this.onContentClick(event);
          // this.doc.querySelectorAll('.elm-active').forEach(elm=>elm.classList.remove('elm-active'));
          // element.classList.add('elm-active');
        }
      } else {
        var clickedBlock = this.clickedBlock;

        // currentTarget.classList.remove('editable');
        // clickedBlock.removeAttribute('contentEditable');
        // clickedBlock.style.cursor = '';

        if (this.onEditEnd) this.onEditEnd(this.clickedBlock);
        this.elements.forEach(function (element) {
          if (clickedBlock === element) {
            element.addEventListener('dblclick', _this27.handleEditStart);
            element.addEventListener('touchstart', _this27.handleTouchStart, {
              passive: false
            });
          }
        });
        this.doc.removeEventListener('mousedown', this.handleMouseClick);
        this.doc.removeEventListener('touchstart', this.handleMouseClick);

        // this.doc.querySelectorAll('.elm-active').forEach(elm=>elm.classList.remove('elm-active'));
      }
    }
  }, {
    key: "quitEditable",
    value: function quitEditable(block) {
      if (this.onEditEnd) this.onEditEnd(block);
      block.addEventListener('dblclick', this.handleEditStart);
      block.addEventListener('touchstart', this.handleTouchStart, {
        passive: false
      });
      this.doc.removeEventListener('mousedown', this.handleMouseClick);
      this.doc.removeEventListener('touchstart', this.handleMouseClick);
    }
  }, {
    key: "placeCursorAtEnd",
    value: function placeCursorAtEnd(element) {
      var range = this.doc.createRange();
      var sel = this.win.getSelection();
      range.setStart(element, element.childNodes.length);
      range.collapse(true);
      sel.removeAllRanges();
      sel.addRange(range);
    }
  }]);
  return Editable;
}();
var BlockSelector = /*#__PURE__*/function () {
  function BlockSelector(options) {
    editableblocks_classCallCheck(this, BlockSelector);
    this.selector = options && options.selector || '.is-block';
    this.parentSelector = options && options.parentSelector || 'body';
    this.doc = options && options.doc || document;
    this.win = options && options.win || window;
    this.disableOnMobile = options && options.disableOnMobile || 0;
    this.onMultipleSelect = options && options.onMultipleSelect || null;
    this.isDragging = false;
    this.startCoords = {
      x: 0,
      y: 0
    };
    var handleHTML = "\n        <div class=\"selection-rectangle\"></div>";
    this.doc.body.insertAdjacentHTML('afterbegin', handleHTML);
    this.selectionRect = this.doc.querySelector('.selection-rectangle');
    var styleHTML = "\n        <style id=\"styleSelector\">\n            .selection-rectangle {\n                position: absolute;\n                border: 1px solid #c2e2ff;\n                pointer-events: none;\n                display: none;\n                background-color: #a9c4e442;\n                z-index:1\n            }\n        <style>\n        ";
    var elmStyle = this.doc.querySelector('#styleSelector');
    if (!elmStyle) this.doc.head.insertAdjacentHTML('beforeend', styleHTML);
    this.handleDragStart = this.handleDragStart.bind(this);
    this.handleDragMove = this.handleDragMove.bind(this);
    this.handleDragEnd = this.handleDragEnd.bind(this);
    this.doc.addEventListener('mousedown', this.handleDragStart);
    this.doc.addEventListener('touchstart', this.handleDragStart, {
      passive: false
    });
  }
  editableblocks_createClass(BlockSelector, [{
    key: "destroy",
    value: function destroy() {
      var elmStyle = this.doc.querySelector('#styleSelector');
      if (elmStyle) elmStyle.parentNode.removeChild(elmStyle);
      var selectionRect = this.doc.querySelector('.selection-rectangle');
      if (selectionRect) selectionRect.parentNode.removeChild(selectionRect);
      this.doc.removeEventListener('mousedown', this.handleDragStart);
      this.doc.removeEventListener('touchstart', this.handleDragStart);
    }
  }, {
    key: "handleDragStart",
    value: function handleDragStart(event) {
      var _this28 = this;
      var viewportWidth = this.win.innerWidth;
      if (viewportWidth <= this.disableOnMobile) return;
      if (event.type === 'touchstart' && event.touches.length !== 1) {
        return; // Do nothing if more than one touch point is detected
      }

      if (event.type === 'mousedown' && event.button !== 0) {
        return; // Do nothing if the right mouse button is clicked
      }

      if (event.target.closest(this.selector)) return;
      if (!event.target.closest(this.parentSelector)) return;
      if (event.target.closest('.keep-selection')) return;
      this.dragStartTimeout = setTimeout(function () {
        // Set a timeout before starting the drag (to differentiate from click)

        _this28.isDragging = true;
        var clientX, clientY;
        if (event.type === 'mousedown') {
          clientX = event.clientX;
          clientY = event.clientY;
        } else if (event.type === 'touchstart') {
          var touch = event.touches[0];
          clientX = touch.clientX;
          clientY = touch.clientY;
        }
        _this28.startCoords = {
          x: clientX,
          y: clientY
        };
        _this28.updateSelectionRect(_this28.startCoords, _this28.startCoords);
        _this28.doc.addEventListener('mousemove', _this28.handleDragMove);
        _this28.doc.addEventListener('touchmove', _this28.handleDragMove);
        _this28.doc.body.style.userSelect = 'none';
      }, 100);
      this.doc.addEventListener('mouseup', this.handleDragEnd);
      this.doc.addEventListener('touchend', this.handleDragEnd);
    }
  }, {
    key: "handleDragMove",
    value: function handleDragMove(event) {
      if (!this.isDragging) return;
      if (event.target.closest('.keep-selection')) return;
      var clientX, clientY;
      if (event.type === 'mousemove') {
        clientX = event.clientX;
        clientY = event.clientY;
      } else if (event.type === 'touchmove') {
        var touch = event.touches[0];
        clientX = touch.clientX;
        clientY = touch.clientY;
      }
      this.updateSelectionRect(this.startCoords, {
        x: clientX,
        y: clientY
      });
      this.selectBlocksInArea(this.startCoords, {
        x: clientX,
        y: clientY
      });
    }
  }, {
    key: "handleDragEnd",
    value: function handleDragEnd() {
      clearTimeout(this.dragStartTimeout);
      this.isDragging = false;
      this.selectionRect.style.display = 'none';
      this.doc.removeEventListener('mousemove', this.handleDragMove);
      this.doc.removeEventListener('touchmove', this.handleDragMove);
      this.doc.removeEventListener('mouseup', this.handleDragEnd);
      this.doc.removeEventListener('touchend', this.handleDragEnd);
      this.doc.body.style.userSelect = '';
      var elms = this.doc.querySelectorAll(this.selector + '.active');
      if (elms.length > 1) this.onMultipleSelect();
    }
  }, {
    key: "updateSelectionRect",
    value: function updateSelectionRect(start, end) {
      var minX = Math.min(start.x, end.x);
      var minY = Math.min(start.y, end.y) + this.win.scrollY;
      var width = Math.abs(start.x - end.x);
      var height = Math.abs(start.y - end.y);
      this.selectionRect.style.left = "".concat(minX, "px");
      this.selectionRect.style.top = "".concat(minY, "px");
      this.selectionRect.style.width = "".concat(width, "px");
      this.selectionRect.style.height = "".concat(height, "px");
      this.selectionRect.style.display = 'block';
    }
  }, {
    key: "selectBlocksInArea",
    value: function selectBlocksInArea(start, end) {
      var _this29 = this;
      var blocks = this.doc.querySelectorAll(this.selector);
      blocks.forEach(function (block) {
        var rect = block.getBoundingClientRect();
        if (rect.left < Math.max(start.x, end.x) && rect.right > Math.min(start.x, end.x) && rect.top < Math.max(start.y, end.y) && rect.bottom > Math.min(start.y, end.y)) {
          if (block.parentNode.matches(_this29.selector)) {// child blocks
            // Do Nothing
          } else {
            block.classList.add('active');
            var elms = Array.from(_this29.doc.querySelectorAll(_this29.selector)).filter(function (elm) {
              return elm.classList.contains('active') && !elm.classList.contains('clone');
            });
            if (elms.length > 1) block.classList.add('multi');
          }
        } else {
          block.classList.remove('active');
          block.classList.remove('multi');
        }
      });
    }
  }, {
    key: "unSelect",
    value: function unSelect() {
      var blocks = this.doc.querySelectorAll(this.selector);
      blocks.forEach(function (elm) {
        return elm.classList.remove('active');
      });
    }
  }]);
  return BlockSelector;
}();
var EditableBlocks = /*#__PURE__*/function () {
  function EditableBlocks() {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    editableblocks_classCallCheck(this, EditableBlocks);
    var defaults = {
      selector: '.is-block',
      parentSelector: 'body',
      // controlSelector: '.is-tool',
      doc: document,
      win: window,
      // onBeforeChange: () => {},
      // onChange: () => {},
      // onContentClick: () => {},
      // onEditStart: () => {},
      // onEditEnd: () => {},
      // onDuplicate: () => {},
      // onSelectBlock:  (block) => {},
      // onUnSelectBlock: () => {},
      // onMultipleSelect: () => {},
      disableOnMobile: 0,
      rotate: true,
      clone: true,
      zoom: 1
      // onDelete: () = {}
    };

    Object.assign(this, defaults, options);
    this.init();
  }
  editableblocks_createClass(EditableBlocks, [{
    key: "checkOverlap",
    value: function checkOverlap(target) {
      return this.common.checkOverlap(target);
    }
  }, {
    key: "forward",
    value: function forward(target) {
      var newZIndex;
      if (!target.style.zIndex) {
        newZIndex = 1;
      } else {
        newZIndex = parseInt(target.style.zIndex) + 1;
      }
      target.style.zIndex = newZIndex;
    }
  }, {
    key: "backward",
    value: function backward(target) {
      var newZIndex;
      if (!target.style.zIndex) {
        newZIndex = 0;
      } else {
        if (parseInt(target.style.zIndex) - 1 < 0) newZIndex = 0;else newZIndex = parseInt(target.style.zIndex) - 1;
      }
      target.style.zIndex = newZIndex;
    }
  }, {
    key: "selectStart",
    value: function selectStart(block) {
      if (block.classList.contains('is-shape')) return; // do not clone if block is shape

      if (!this.clone) return;
      var viewportWidth = this.win.innerWidth;
      if (block.closest('.autolayout') && viewportWidth <= 760) {
        return;
      }
      if (block.classList.contains('is-group')) return; // do not clone if block is shape

      if (!block.classList.contains('clone')) {
        var clonedDiv = block.cloneNode(true);
        clonedDiv.classList.add('clone');
        block.parentNode.appendChild(clonedDiv);
        block.classList.add('cloned');
        this.refresh();
      }
    }
  }, {
    key: "selectClear",
    value: function selectClear() {
      this.doc.querySelectorAll('.clone').forEach(function (elm) {
        return elm.parentNode.removeChild(elm);
      });
      this.doc.querySelectorAll('.cloned').forEach(function (elm) {
        return elm.classList.remove('cloned');
      });
    }
  }, {
    key: "setMultiSelect",
    value: function setMultiSelect(multiSelect) {
      if (multiSelect) this.doc.body.classList.add('multi-select');else this.doc.body.classList.remove('multi-select');
    }
  }, {
    key: "generateRandom",
    value: function generateRandom() {
      var text = '';
      var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
      for (var i = 0; i < 2; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      }
      var text2 = '';
      var possible2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      for (var _i2 = 0; _i2 < 5; _i2++) {
        text2 += possible2.charAt(Math.floor(Math.random() * possible2.length));
      }
      return text + text2;
    }
  }, {
    key: "getElmClass",
    value: function getElmClass(elm) {
      var elmClassName = '';
      elm.classList.forEach(function (item) {
        if (item.includes('g-')) {
          elmClassName = item;
        }
      });
      if (elmClassName === '') {
        elmClassName = 'g-' + this.generateRandom();
        elm.classList.add(elmClassName);
      }
      return elmClassName;
    }
  }, {
    key: "readCss",
    value: function readCss() {
      var _this30 = this;
      var css = '';
      var elms = this.doc.querySelectorAll(this.selector);
      elms.forEach(function (elm) {
        if (elm.classList.contains('clone')) return;
        var elmClassName = _this30.getElmClass(elm);
        var baseWidth = elm.getAttribute('data--w');
        var baseHeight = elm.getAttribute('data--h');
        var baseTop = elm.getAttribute('data--t');
        var baseLeft = elm.getAttribute('data--l');
        var baseBottom = elm.getAttribute('data--b');
        var baseRight = elm.getAttribute('data--r');
        var mediaQueries = [];
        var breakpoints = _this30.getBreakpoints(elm);
        breakpoints.sort(function (a, b) {
          return b - a;
        });
        for (var i = 0; i < breakpoints.length; i++) {
          var num = breakpoints[i];
          var s = '';
          var width = elm.getAttribute('data--w-' + num);
          if (width) s += "width: ".concat(width, ";");
          var height = elm.getAttribute('data--h-' + num);
          if (height) s += "height: ".concat(height, ";");
          var top = elm.getAttribute('data--t-' + num);
          if (top) s += "top: ".concat(top, ";");
          var left = elm.getAttribute('data--l-' + num);
          if (left) s += "left: ".concat(left, ";");
          var bottom = elm.getAttribute('data--b-' + num);
          if (bottom) s += "bottom: ".concat(bottom, ";");
          var right = elm.getAttribute('data--r-' + num);
          if (right) s += "right: ".concat(right, ";");
          mediaQueries.push("@media (max-width: ".concat(num, "px) {\n                    .").concat(elmClassName, " {\n                        ").concat(s, "\n                    }\n                }"));
        }
        css += "\n                .".concat(elmClassName, " {\n                    ").concat(baseWidth ? "width: ".concat(baseWidth, ";") : '').concat(baseHeight ? "height: ".concat(baseHeight, ";") : '', "\n                    ").concat(baseTop ? "top: ".concat(baseTop, ";") : '').concat(baseBottom ? "bottom: ".concat(baseBottom, ";") : '', "\n                    ").concat(baseLeft ? "left: ".concat(baseLeft, ";") : '').concat(baseRight ? "right: ".concat(baseRight, ";") : '', "\n                }\n                ").concat(mediaQueries.join('\n'), "\n            ");
      });
      return css;
    }
  }, {
    key: "updateCss",
    value: function updateCss() {
      var css = this.readCss();
      localStorage.setItem('_cssblock', css);
      var cssBlock = this.doc.querySelector('#_cssBlock');
      if (!cssBlock) {
        this.doc.head.insertAdjacentHTML('beforeend', '<style id="_cssBlock"></style>');
        cssBlock = this.doc.querySelector('#_cssBlock');
      }
      if (cssBlock) {
        cssBlock.innerHTML = css; // apply css

        // clear inline css
        var elms = this.doc.querySelectorAll(this.selector);
        elms.forEach(function (elm) {
          elm.style.width = '';
          elm.style.height = '';
          elm.style.top = '';
          elm.style.left = '';
          elm.style.bottom = '';
          elm.style.right = '';
        });
      }
    }
  }, {
    key: "init",
    value: function init() {
      var _this31 = this;
      // // load css
      // let css = localStorage.getItem('_cssblock');
      // let cssBlock = this.doc.querySelector('#_cssBlock');
      // if(!cssBlock) {
      //     this.doc.head.insertAdjacentHTML('beforeend','<style id="_cssBlock"></style>');
      //     cssBlock = this.doc.querySelector('#_cssBlock');
      // }
      // if(css) cssBlock.innerHTML = css;

      this.doc.body.classList.add('editableblocks');
      this.draggable = new editableblocks_Draggable({
        selector: this.selector,
        disableOnMobile: this.disableOnMobile,
        doc: this.doc,
        win: this.win,
        controlSelector: this.controlSelector,
        onDelete: function onDelete(element) {
          if (_this31.rotatable) _this31.rotatable.destroy(element);
          _this31.resizable.destroy(element);
          _this31.editable.destroy(element);
          if (_this31.onDelete) _this31.onDelete();
        },
        onBeforeChange: function onBeforeChange() {
          if (_this31.onBeforeChange) _this31.onBeforeChange();
        },
        onChange: function onChange() {
          if (_this31.onChange) _this31.onChange();

          // this.updateCss();
        },

        onMultipleSelect: this.onMultipleSelect,
        onSelectStart: function onSelectStart(block) {
          // for cloning
          _this31.selectStart(block);
        },
        onSelectClear: function onSelectClear() {
          // for removing clones
          _this31.selectClear();
          if (_this31.onUnselectBlock) _this31.onUnselectBlock();
        },
        onSelectBlock: this.onSelectBlock
      });
      this.resizable = new editableblocks_Resizable({
        selector: this.selector,
        disableOnMobile: this.disableOnMobile,
        doc: this.doc,
        win: this.win,
        onBeforeChange: function onBeforeChange() {
          if (_this31.onBeforeChange) _this31.onBeforeChange();
        },
        onChange: function onChange() {
          if (_this31.onChange) _this31.onChange();

          // this.updateCss();
        }
      });

      if (this.rotate) {
        this.rotatable = new editableblocks_Rotatable({
          selector: this.selector,
          disableOnMobile: this.disableOnMobile,
          doc: this.doc,
          win: this.win,
          onBeforeChange: function onBeforeChange() {
            if (_this31.onBeforeChange) _this31.onBeforeChange();
          },
          onChange: function onChange() {
            if (_this31.onChange) _this31.onChange();
          }
        });
      }
      this.editable = new Editable({
        selector: this.selector,
        controlSelector: this.controlSelector,
        doc: this.doc,
        win: this.win,
        onContentClick: this.onContentClick,
        onEditStart: function onEditStart(event, block) {
          if (block.classList.contains('clone')) {
            var clonedTarget = _this31.doc.querySelector(_this31.selector + '.cloned');
            _this31.onEditStart(event, clonedTarget);
            _this31.selectClear();

            // Disable drag during editing
            if (!_this31.draggable) return;
            _this31.draggable.disableDrag(clonedTarget);
            return;
          }
          _this31.onEditStart(event, block);

          // Disable drag during editing
          if (!_this31.draggable) return;
          _this31.draggable.disableDrag(block);
        },
        onEditEnd: function onEditEnd(block) {
          _this31.onEditEnd(block);

          // Enable drag
          if (!_this31.draggable) return;
          _this31.draggable.enableDrag(block);
        }
      });
      this.blockSelector = new BlockSelector({
        selector: this.selector,
        parentSelector: this.parentSelector,
        disableOnMobile: this.disableOnMobile,
        onMultipleSelect: this.onMultipleSelect,
        doc: this.doc,
        win: this.win
      });
      this.common = new Common({
        selector: this.selector,
        doc: this.doc,
        win: this.win,
        onDuplicate: this.onDuplicate
      });
      this.setZoom(this.zoom);
    }
  }, {
    key: "setZoom",
    value: function setZoom(scale) {
      this.common.setZoom(scale);
      this.draggable.setZoom(scale);
      this.resizable.setZoom(scale);
    }
  }, {
    key: "duplicate",
    value: function duplicate() {
      this.common.duplicate();
      this.refresh();
    }
  }, {
    key: "delete",
    value: function _delete() {
      this.draggable["delete"]();
    }
  }, {
    key: "getBreakpoints",
    value: function getBreakpoints(block) {
      return this.common.getBreakpoints(block);
    }
  }, {
    key: "placeCursorAtEnd",
    value: function placeCursorAtEnd(block) {
      this.editable.placeCursorAtEnd(block);
    }
  }, {
    key: "quitEditable",
    value: function quitEditable(block) {
      this.editable.quitEditable(block);
    }
  }, {
    key: "destroy",
    value: function destroy() {
      if (!this.draggable) return;
      this.draggable.destroy();
      this.resizable.destroy();
      if (this.rotatable) this.rotatable.destroy();
      this.editable.destroy();
      this.blockSelector.destroy();
      this.draggable = null;
      this.doc.body.classList.remove('editableblocks');
    }
  }, {
    key: "refresh",
    value: function refresh() {
      // Call refresh() whenever blocks are added 
      this.draggable.refresh();
      this.resizable.refresh();
      if (this.rotatable) this.rotatable.refresh();
      this.editable.refresh();
    }
  }, {
    key: "addBlock",
    value: function addBlock(html, container) {
      this.selectClear(); // clear clones
      this.blockSelector.unSelect(); // clear active

      var parser = new DOMParser();
      var doc = parser.parseFromString(html, 'text/html');
      var block = doc.querySelector('.is-block');
      block.classList.add('block-dummy');
      html = doc.body.innerHTML;
      container.insertAdjacentHTML('beforeend', html);
      var newBlock = container.querySelector('.block-dummy');
      if (newBlock) {
        newBlock.classList.remove('block-dummy');
        if (this.onAddBlock) this.onAddBlock(newBlock);
        newBlock.classList.add('active');
      }
      this.refresh();
    }
  }, {
    key: "group",
    value: function group() {
      var group = this.common.group('is-block', 'is-group');
      this.refresh();
      return group;
    }
  }, {
    key: "unGroup",
    value: function unGroup() {
      this.common.unGroup();
    }
  }, {
    key: "addBreakpoint",
    value: function addBreakpoint() {
      this.common.addBreakpoint();
    }
  }, {
    key: "clearBreakpoint",
    value: function clearBreakpoint(target) {
      this.common.clearBreakpoint(target);
      if (target.classList.contains('cloned')) {
        var cloneTarget = this.doc.querySelector(this.selector + '.clone');
        this.common.clearBreakpoint(cloneTarget);
      }
    }
  }, {
    key: "clearAllBreakpoints",
    value: function clearAllBreakpoints(container) {
      this.common.clearAllBreakpoints(container);
    }
  }, {
    key: "isMultiSelect",
    value: function isMultiSelect() {
      // Check if multiple selection occurs. If so, add 'multi' class to hide all the handles
      var blocks = Array.from(this.doc.querySelectorAll(this.selector)).filter(function (elm) {
        return elm.classList.contains('active') && !elm.classList.contains('clone');
      });
      if (blocks.length > 1) return true;
      return false;
    }
  }]);
  return EditableBlocks;
}();
/* harmony default export */ const editableblocks = (EditableBlocks);
;// CONCATENATED MODULE: ./src/contentbuilder/blockmodal.js
function blockmodal_typeof(obj) { "@babel/helpers - typeof"; return blockmodal_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, blockmodal_typeof(obj); }
function blockmodal_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function blockmodal_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, blockmodal_toPropertyKey(descriptor.key), descriptor); } }
function blockmodal_createClass(Constructor, protoProps, staticProps) { if (protoProps) blockmodal_defineProperties(Constructor.prototype, protoProps); if (staticProps) blockmodal_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function blockmodal_toPropertyKey(arg) { var key = blockmodal_toPrimitive(arg, "string"); return blockmodal_typeof(key) === "symbol" ? key : String(key); }
function blockmodal_toPrimitive(input, hint) { if (blockmodal_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (blockmodal_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var BlockModal = /*#__PURE__*/function () {
  function BlockModal(builder) {
    var _this = this;
    blockmodal_classCallCheck(this, BlockModal);
    this.builder = builder;
    var builderStuff = this.builder.builderStuff;
    this.builderStuff = builderStuff;
    var util = this.builder.util;
    this.util = util;
    var dom = this.builder.dom;
    this.dom = dom;
    var modal = builderStuff.querySelector('.is-modal.editblock');
    if (!modal) {
      var html = "\n            <div class=\"is-modal is-modal-content editblock\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-bar is-draggable\">\n                    <span class=\"modal-title\"></span>\n                    <button class=\"is-modal-close\" tabindex=\"-1\" title=\"".concat(util.out('Close'), "\">&#10005;</button>\n                </div>\n                <div class=\"modal-none\" style=\"display:none;padding-bottom:28px;\">\n                \n                    <div>").concat(util.out('Please select a block or page.'), "</div>\n\n                </div>\n\n                <div class=\"modal-page-content\" style=\"display:none;padding-bottom:28px;\">\n\n                    <div style=\"padding-bottom: 3px;\">").concat(util.out('Background Color'), ":</div>\n                    <div style=\"display:flex;\">\n                        <button title=\"").concat(util.out('Background Color'), "\" class=\"input-page-bgcolor is-btn-color\" style=\"margin-right:15px\"></button>\n                        <button title=\"").concat(util.out('Gradient'), "\" class=\"btn-page-gradient classic\" data-value=\"+\"> ").concat(util.out('Gradient'), " </button>\n                    </div>\n\n                    <div style=\"padding-top:20px;padding-bottom: 3px;\">").concat(util.out('Background Image'), ":</div>\n                    <div>\n                        <div class=\"asset-page-preview\" style=\"display:none\"></div>\n                        <div style=\"display: flex\">\n                            <button title=\"").concat(util.out('Image'), "\" class=\"btn-page-bgimage\">\n                                <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-image\"></use></svg>\n                                <span>").concat(util.out('Image'), "</span>\n                            </button>\n                            <button title=\"").concat(util.out('Select'), "\" class=\"btn-page-asset\">").concat(this.builder.opts.selectIcon, "</button>\n                            <button title=\"").concat(util.out('Remove'), "\" class=\"btn-page-clear\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                            <button title=\"").concat(util.out('Adjust'), "\" class=\"btn-page-adjust\" style=\"width:40px\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-wrench\"></use></svg></button>\n                        </div>\n                    </div>\n\n                </div>\n\n                <div class=\"modal-content\">\n\n                    <div style=\"padding-bottom: 3px;\">").concat(util.out('Background Color'), ":</div>\n                    <div style=\"display:flex;\">\n                        <button title=\"").concat(util.out('Background Color'), "\" class=\"input-block-bgcolor is-btn-color\" style=\"margin-right:15px\"></button>\n                        <button title=\"").concat(util.out('Gradient'), "\" class=\"btn-block-gradient classic\" data-value=\"+\"> ").concat(util.out('Gradient'), " </button>\n                    </div>\n\n                    <div style=\"padding-top:20px;padding-bottom: 3px;\">").concat(util.out('Background Image'), ":</div>\n                    <div>\n                        <div class=\"asset-block-preview\" style=\"display:none\"></div>\n                        <div style=\"display: flex\">\n                            <button title=\"").concat(util.out('Image'), "\" class=\"btn-block-bgimage\">\n                                <svg class=\"is-icon-flex\"><use xlink:href=\"#ion-image\"></use></svg>\n                                <span>").concat(util.out('Image'), "</span>\n                            </button>\n                            <button title=\"").concat(util.out('Select'), "\" class=\"btn-block-asset\">").concat(this.builder.opts.selectIcon, "</button>\n                            <button title=\"").concat(util.out('Remove'), "\" class=\"btn-block-clear\"><svg class=\"is-icon-flex\" style=\"width:11px;height:11px;\"><use xlink:href=\"#icon-clean\"></use></svg></button>\n                            <button title=\"").concat(util.out('Adjust'), "\" class=\"btn-block-adjust\" style=\"width:40px\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-wrench\"></use></svg></button>\n                        </div>\n                    </div>\n\n                    <div class=\"div-content-textcolor flex flex-col\">\n                        <div style=\"padding-top:20px;padding-bottom:3px;\">").concat(util.out('Text Color'), ":</div>\n                        <div class=\"flex flex-row\">\n                            <button title=\"0\" data-textcolor=\"dark\">").concat(util.out('Dark'), "</button>\n                            <button title=\"10\" data-textcolor=\"light\">").concat(util.out('Light'), "</button>\n                            \n                            <button title=\"").concat(util.out('Clear'), "\" data-textcolor=\"\"><svg class=\"is-icon-flex\" style=\"flex:none;width:18px;height:18px;margin-top: 2px;\"><use xlink:href=\"#ion-ios-close-empty\"></use></svg></button>\n                        </div>\n                    </div>\n\n                    <div class=\"label checkbox grayscale\" style=\"padding:30px 0 10px;\">\n                        <label class=\"label-block-grayscale label-checkbox\" for=\"chkBlockGrayscale\"><input id=\"chkBlockGrayscale\" class=\"chk-grayscale\" type=\"checkbox\" /> ").concat(util.out('Grayscale'), "</label>\n                    </div>\n\n                    <button title=\"").concat(util.out('Remove Content/Text'), "\" class=\"btn-clear-text\" style=\"margin-top:20px\">\n                        <svg class=\"is-icon-flex\"><use xlink:href=\"#icon-trash\"></use></svg>\n                        <span>").concat(util.out('Remove Content/Text'), "</span>\n                    </button>\n\n                    <button title=\"").concat(util.out('Clear Breakpoints'), "\" class=\"btn-clear-breakpoint\" style=\"margin-top:20px\">\n                        <svg class=\"is-icon-flex\"><use xlink:href=\"#icon-trash\"></use></svg>\n                        <span>").concat(util.out('Clear Breakpoints'), "</span>\n                    </button>\n\n                    <div style=\"padding-top:23px;padding-bottom:3px;\">").concat(util.out('Lock'), ":</div>\n\n                    <label class=\"switch\"><input id=\"inpLockBlock\" type=\"checkbox\" checked=\"\"><span class=\"slider round\"></span></label>\n\n                    <div id=\"divBlockPos\">\n\n                        <div class=\"flex\" style=\"gap:10px\">\n                            <div>\n                                <label for=\"inpBlockTop\" class=\"flex\" style=\"padding:10px 0 3px;\">").concat(util.out('Top'), ":</label>\n                                <div style=\"display:flex\">\n                                    <input id=\"inpBlockTop\" class=\"inp-block-top\" type=\"text\" style=\"width:74px;height:35px\">\n                                    <select id=\"inpBlockTopUnit\">\n                                        <option></option>\n                                        <option>px</option>\n                                        <option>%</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div>\n                                <label for=\"inpBlockBottom\" class=\"flex\" style=\"padding:10px 0 3px;\">").concat(util.out('Bottom'), ":</label>\n                                <div style=\"display:flex\">\n                                    <input id=\"inpBlockBottom\" class=\"inp-block-top\" type=\"text\" style=\"width:74px;height:35px\">\n                                    <select id=\"inpBlockBottomUnit\">\n                                        <option></option>\n                                        <option>px</option>\n                                        <option>%</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex\" style=\"gap:10px\">\n                            <div>\n                                <label for=\"inpBlockLeft\" class=\"flex\" style=\"padding:10px 0 3px;\">").concat(util.out('Left'), ":</label>\n                                <div style=\"display:flex\">\n                                    <input id=\"inpBlockLeft\" class=\"inp-block-left\" type=\"text\" style=\"width:74px;height:35px\">\n                                    <select id=\"inpBlockLeftUnit\">\n                                        <option></option>\n                                        <option>px</option>\n                                        <option>%</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div>\n                                <label for=\"inpBlockRight\" class=\"flex\" style=\"padding:10px 0 3px;\">").concat(util.out('Right'), ":</label>\n                                <div style=\"display:flex\">\n                                    <input id=\"inpBlockRight\" class=\"inp-block-left\" type=\"text\" style=\"width:74px;height:35px\">\n                                    <select id=\"inpBlockRightUnit\">\n                                        <option></option>\n                                        <option>px</option>\n                                        <option>%</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"flex\" style=\"gap:10px\">\n                            <div>\n                                <label for=\"inpBlockWidth\" class=\"flex\" style=\"padding:10px 0 3px;\">").concat(util.out('Width'), ":</label>\n                                <div style=\"display:flex\">\n                                    <input id=\"inpBlockWidth\" class=\"inp-block-left\" type=\"text\" style=\"width:74px;height:35px\">\n                                    <select id=\"inpBlockWidthUnit\">\n                                        <option></option>\n                                        <option>px</option>\n                                        <option>%</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div>\n                                <label for=\"inpBlockHeight\" class=\"flex\" style=\"padding:10px 0 3px;\">").concat(util.out('Height'), ":</label>\n                                <div style=\"display:flex\">\n                                    <input id=\"inpBlockHeight\" class=\"inp-block-left\" type=\"text\" style=\"width:74px;height:35px\">\n                                    <select id=\"inpBlockHeightUnit\">\n                                        <option></option>\n                                        <option>px</option>\n                                        <option>%</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                    </div>\n\n                </div>\n            </div>");
      dom.appendHtml(builderStuff, html);
      modal = builderStuff.querySelector('.is-modal.editblock');
    }
    this.modal = modal;
    var btnClose = modal.querySelector('.is-modal-close');
    dom.addEventListener(btnClose, 'click', function () {
      _this.hide();
    });

    // Page Background color

    var btnPageGradient = modal.querySelector('.btn-page-gradient');
    var btnPageColorPick = modal.querySelector('.input-page-bgcolor');
    btnPageColorPick.addEventListener('click', function () {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var page = _this.getPage();
      var bgcolor = btnPageColorPick.style.backgroundColor;
      _this.builder.colorPicker.open(function (s) {
        page.style.backgroundColor = s;
        if (page.style.backgroundImage && page.style.backgroundImage.includes('gradient')) {
          page.style.backgroundImage = ''; // remove gradient
          btnPageGradient.style.backgroundImage = ''; // preview
        }

        btnPageColorPick.style.backgroundColor = s; // preview

        _this.builder.onChange();
      }, bgcolor, function () {
        btnPageColorPick.removeAttribute('data-focus');
        btnPageColorPick.focus();
      });
      btnPageColorPick.setAttribute('data-focus', true);
    });
    btnPageGradient.addEventListener('click', function () {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var page = _this.getPage();
      var gradientPicker = _this.builder.gradientpicker();
      gradientPicker.open(page, function () {
        page.style.backgroundColor = '';
        btnPageColorPick.style.backgroundColor = ''; // preview

        _this.updatePanelImage('');
        _this.builder.onChange();
        btnPageGradient.style.backgroundImage = page.style.backgroundImage; // preview
      });
    });

    // Block Background color

    var btnGradient = modal.querySelector('.btn-block-gradient');
    var btnColorPick = modal.querySelector('.input-block-bgcolor');
    btnColorPick.addEventListener('click', function () {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var blockOverlay = _this.blockOverlay();
      var bgcolor = btnColorPick.style.backgroundColor;
      _this.builder.colorPicker.open(function (s) {
        blockOverlay.style.backgroundColor = s;
        if (blockOverlay.style.backgroundImage && blockOverlay.style.backgroundImage.includes('gradient')) {
          blockOverlay.style.backgroundImage = ''; // remove gradient
          btnGradient.style.backgroundImage = ''; // preview
        }

        btnColorPick.style.backgroundColor = s; // preview

        _this.builder.onChange();
      }, bgcolor, function () {
        btnColorPick.removeAttribute('data-focus');
        btnColorPick.focus();
      });
      btnColorPick.setAttribute('data-focus', true);
    });
    btnGradient.addEventListener('click', function () {
      _this.builder.uo.saveForUndo(true); // checkLater = true

      var blockOverlay = _this.blockOverlay();
      var gradientPicker = _this.builder.gradientpicker();
      gradientPicker.open(blockOverlay, function () {
        blockOverlay.style.backgroundColor = '';
        btnColorPick.style.backgroundColor = ''; // preview

        _this.updatePanelImage('');
        _this.builder.onChange();
        btnGradient.style.backgroundImage = blockOverlay.style.backgroundImage; // preview
      });
    });

    // Page Background Image

    this.pageImagePreview = modal.querySelector('.asset-page-preview');
    var btnPageBgImage = modal.querySelector('.btn-page-bgimage');
    if (btnPageBgImage) dom.addEventListener(btnPageBgImage, 'click', function () {
      // Background image
      var page = _this.getPage();
      var src = '';
      if (page) if (page.style.backgroundImage) {
        if (page.style.backgroundImage.indexOf('url(') !== -1) {
          src = page.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
        }
      }
      _this.openImagePicker(src, function (url) {
        var page = _this.getPage();
        _this.builder.uo.saveForUndo();
        page.style.backgroundImage = "url(\"".concat(url, "\")");
        page.style.backgroundSize = 'cover';
        page.style.backgroundRepeat = 'no-repeat';
        var div = _this.pageImagePreview;
        var btnPageAdjust = modal.querySelector('.btn-page-adjust');
        var btnPageClear = modal.querySelector('.btn-page-clear');
        btnPageAdjust.style.display = 'none';
        btnPageClear.style.display = 'none';
        if (url !== '') {
          div.innerHTML = "<img src=\"".concat(url, "\">");
          btnPageAdjust.style.display = 'flex';
          btnPageClear.style.display = 'flex';
        } else {
          div.innerHTML = '';
        }
        _this.builder.onChange();
      }, btnPageBgImage);
    });
    var btnPageOpenAsset = modal.querySelector('.btn-page-asset');
    btnPageOpenAsset.addEventListener('click', function () {
      _this.builder.openAssetSelect('image', function (src) {
        _this.updatePageImage(src);
      }, btnPageOpenAsset);
    });

    // Show/hide button
    if (!(this.builder.onImageSelectClick || this.builder.imageSelect)) btnPageOpenAsset.style.display = 'none';
    var btnPageClear = modal.querySelector('.btn-page-clear');
    btnPageClear.addEventListener('click', function () {
      _this.updatePageImage('');
    });
    var btnPageAdjust = modal.querySelector('.btn-page-adjust');
    btnPageAdjust.addEventListener('click', function () {
      var page = _this.getPage();
      _this.builder.colTool.openImageAdjust(page, btnPageAdjust);
    });

    // Block Background Image

    this.imagePreview = modal.querySelector('.asset-block-preview');
    var btnBgImage = modal.querySelector('.btn-block-bgimage');
    if (btnBgImage) dom.addEventListener(btnBgImage, 'click', function () {
      // Background image
      var blockOverlay = _this.blockOverlay();
      var src = '';
      if (blockOverlay) if (blockOverlay.style.backgroundImage) {
        if (blockOverlay.style.backgroundImage.indexOf('url(') !== -1) {
          src = blockOverlay.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
        }
      }
      _this.openImagePicker(src, function (url) {
        var blockOverlay = _this.blockOverlay();
        _this.builder.uo.saveForUndo();
        blockOverlay.style.backgroundImage = "url(\"".concat(url, "\")");
        blockOverlay.style.backgroundSize = 'cover';
        blockOverlay.style.backgroundRepeat = 'no-repeat';
        var div = _this.imagePreview;
        var btnAdjust = modal.querySelector('.btn-block-adjust');
        var btnClear = modal.querySelector('.btn-block-clear');
        btnAdjust.style.display = 'none';
        btnClear.style.display = 'none';
        if (url !== '') {
          div.innerHTML = "<img src=\"".concat(url, "\">");
          btnAdjust.style.display = 'flex';
          btnClear.style.display = 'flex';
        } else {
          div.innerHTML = '';
        }
        _this.builder.onChange();
      }, btnBgImage);
    });
    var btnOpenAsset = modal.querySelector('.btn-block-asset');
    btnOpenAsset.addEventListener('click', function () {
      _this.builder.openAssetSelect('image', function (src) {
        _this.updateImage(src);
      }, btnOpenAsset);
    });

    // Show/hide button
    if (!(this.builder.onImageSelectClick || this.builder.imageSelect)) btnOpenAsset.style.display = 'none';
    var btnClear = modal.querySelector('.btn-block-clear');
    btnClear.addEventListener('click', function () {
      _this.updateImage('');
    });
    var btnAdjust = modal.querySelector('.btn-block-adjust');
    btnAdjust.addEventListener('click', function () {
      var blockOverlay = _this.blockOverlay();
      _this.builder.colTool.openImageAdjust(blockOverlay, btnAdjust);
    });
    var chkGrayscale = modal.querySelector('.chk-grayscale');
    chkGrayscale.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
      var blockOverlay = _this.blockOverlay();
      var checked = chkGrayscale.checked;
      if (checked) {
        blockOverlay.style.filter = 'grayscale(1)';
      } else {
        if (blockOverlay.style.filter) blockOverlay.style.filter = blockOverlay.style.filter.replace('grayscale(1)', '');
      }
      _this.builder.onChange();
    });

    // Text Color

    var btnTextColor = modal.querySelectorAll('[data-textcolor]');
    btnTextColor.forEach(function (btn) {
      btn.addEventListener('click', function () {
        var s = btn.getAttribute('data-textcolor');
        _this.builder.uo.saveForUndo();
        var block = _this.builder.doc.querySelector('.is-block.active:not(.multi)');
        if (s === 'light') {
          block.classList.remove('is-dark-text');
          block.classList.add('is-light-text');
        }
        if (s === 'dark') {
          block.classList.remove('is-light-text');
          block.classList.add('is-dark-text');
        }
        if (s === '') {
          block.classList.remove('is-light-text');
          block.classList.remove('is-dark-text');
        }
        _this.builder.onChange();
        btnTextColor.forEach(function (btn) {
          return btn.classList.remove('on');
        });
        if (s !== '') btn.classList.add('on');
      });
    });

    // Remove Content/Text

    var btnClearText = modal.querySelector('.btn-clear-text');
    btnClearText.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
      _this.builder.doc.querySelectorAll('.is-block.active').forEach(function (block) {
        block.classList.remove('height-auto');
        block.style.height = block.offsetHeight + 'px';
        var container = block.querySelector('.is-container');
        if (container) container.parentNode.removeChild(container);
      });
      _this.realtime();
      _this.builder.onChange();
    });

    // Breakpoints

    var btnClearBreakpoint = modal.querySelector('.btn-clear-breakpoint');
    btnClearBreakpoint.addEventListener('click', function () {
      _this.builder.uo.saveForUndo();
      var block = _this.blockSelected();
      _this.builder.eb.clearBreakpoint(block);
      _this.realtime();
      _this.builder.onChange();
    });

    //  Lock

    var timer;
    var inpTop = modal.querySelector('#inpBlockTop');
    var inpTopUnit = modal.querySelector('#inpBlockTopUnit');
    var inpLeft = modal.querySelector('#inpBlockLeft');
    var inpLeftUnit = modal.querySelector('#inpBlockLeftUnit');
    var inpWidth = modal.querySelector('#inpBlockWidth');
    var inpWidthUnit = modal.querySelector('#inpBlockWidthUnit');
    var inpHeight = modal.querySelector('#inpBlockHeight');
    var inpHeightUnit = modal.querySelector('#inpBlockHeightUnit');

    // extra
    var inpBottom = modal.querySelector('#inpBlockBottom');
    var inpBottomUnit = modal.querySelector('#inpBlockBottomUnit');
    var inpRight = modal.querySelector('#inpBlockRight');
    var inpRightUnit = modal.querySelector('#inpBlockRightUnit');
    var setBlock = function setBlock(s, val, unit) {
      if (val === '') unit = '';
      var breakpoint = _this.builder.doc.body.getAttribute('data-breakpoint');
      var elms = _this.builder.doc.querySelectorAll('.is-block.active');
      elms.forEach(function (target) {
        target.style[s] = val + unit;
        target.classList.remove('fluid');
        if (breakpoint && breakpoint < 1920) {
          if (s === 'top') target.setAttribute('data--t-' + breakpoint, target.style.top);
          if (s === 'left') target.setAttribute('data--l-' + breakpoint, target.style.left);
          if (s === 'bottom') target.setAttribute('data--b-' + breakpoint, target.style.bottom);
          if (s === 'right') target.setAttribute('data--r-' + breakpoint, target.style.right);
          if (s === 'width') target.setAttribute('data--w-' + breakpoint, target.style.width);
          if (s === 'height') target.setAttribute('data--h-' + breakpoint, target.style.height);
        } else {
          if (s === 'top') target.setAttribute('data--t', target.style.top);
          if (s === 'left') target.setAttribute('data--l', target.style.left);
          if (s === 'bottom') target.setAttribute('data--b', target.style.bottom);
          if (s === 'right') target.setAttribute('data--r', target.style.right);
          if (s === 'width') target.setAttribute('data--w', target.style.width);
          if (s === 'height') target.setAttribute('data--h', target.style.height);
        }
        target.removeAttribute('data-prev'); // reset
        target.removeAttribute('data-fluid');
      });
    };
    var setBlockBreakpoint = function setBlockBreakpoint() {
      _this.builder.saveForUndo();
      setBlock('top', inpTop.value, inpTopUnit.value);
      setBlock('left', inpLeft.value, inpLeftUnit.value);
      setBlock('bottom', inpBottom.value, inpBottomUnit.value);
      setBlock('right', inpRight.value, inpRightUnit.value);
      setBlock('width', inpWidth.value, inpWidthUnit.value);
      setBlock('height', inpHeight.value, inpHeightUnit.value);
      _this.builder.onChange();
    };
    inpTop.addEventListener('input', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpLeft.addEventListener('input', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpBottom.addEventListener('input', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpRight.addEventListener('input', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpWidth.addEventListener('input', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpHeight.addEventListener('input', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpTopUnit.addEventListener('change', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpLeftUnit.addEventListener('change', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpBottomUnit.addEventListener('change', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpRightUnit.addEventListener('change', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpWidthUnit.addEventListener('change', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    inpHeightUnit.addEventListener('change', function () {
      clearTimeout(timer);
      timer = setTimeout(function () {
        setBlockBreakpoint();
      }, 600);
    });
    var chkLockBlock = modal.querySelector('#inpLockBlock');
    chkLockBlock.addEventListener(this.builder.isTouchSupport ? 'touchstart' : 'click', function () {
      var elms = _this.builder.doc.querySelectorAll('.is-block.active');
      if (chkLockBlock.checked) {
        elms.forEach(function (target) {
          target.classList.add('locked');
          _this.builder.eb.draggable.disableDrag(target);
          _this.lock(target);
          _this.realtime();
        });
      } else {
        elms.forEach(function (target) {
          target.classList.remove('locked');
          _this.builder.eb.refresh();
          _this.unLock(target);
        });
      }
    });
    if (this.builder.isTouchSupport) {
      var chkLockBlockLabel = chkLockBlock.parentNode;
      chkLockBlockLabel.addEventListener('touchstart', function () {
        var elms = _this.builder.doc.querySelectorAll('.is-block.active');
        if (chkLockBlock.checked) {
          elms.forEach(function (target) {
            target.classList.add('locked');
            _this.builder.eb.draggable.disableDrag(target);
            _this.lock(target);
          });
        } else {
          elms.forEach(function (target) {
            target.classList.remove('locked');
            _this.builder.eb.refresh();
            _this.unLock(target);
          });
        }
      });
    }
  } // constructor
  blockmodal_createClass(BlockModal, [{
    key: "getPage",
    value: function getPage() {
      var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
      var page = docContainer.querySelector('.box-select');
      return page;
    }
  }, {
    key: "lock",
    value: function lock() {
      // target
      var modal = this.modal;
      var divBlockPos = modal.querySelector('#divBlockPos');
      divBlockPos.style.display = '';

      // if(target.style.left && target.style.left.includes('calc')) {
      //     const rect = target.getBoundingClientRect();
      //     target.style.top = (rect.top + this.builder.win.scrollY) + 'px';
      //     target.style.left = (rect.left + this.builder.win.scrollX) + 'px';
      //     target.style.width = target.offsetWidth + 'px';
      //     target.style.height = target.offsetHeight + 'px';
      // }
    }
  }, {
    key: "unLock",
    value: function unLock() {
      // target
      var modal = this.modal;
      var divBlockPos = modal.querySelector('#divBlockPos');
      divBlockPos.style.display = 'none';

      // this.builder.eb.common.applyPercentage(target);
    }
  }, {
    key: "blockOverlay",
    value: function blockOverlay() {
      var block = this.builder.doc.querySelector('.is-block.active:not(.multi)');
      if (!block) return false;
      var blockOverlay = block.querySelector('.is-block-overlay');
      if (!blockOverlay) {
        block.insertAdjacentHTML('beforeend', '<div class="is-block-overlay"></div>');
        blockOverlay = block.querySelector('.is-block-overlay');
      }
      return blockOverlay;
    }
  }, {
    key: "blockSelected",
    value: function blockSelected() {
      var block = this.builder.doc.querySelector('.is-block.active:not(.multi)');
      return block;
    }
  }, {
    key: "realtime",
    value: function realtime() {
      var modal = this.modal;
      var page = this.getPage();
      var block = this.blockSelected();
      if (block) {
        var btnClearBreakpoints = modal.querySelector('.btn-clear-breakpoint');
        var hasBreakpoints = false;
        var attributes = block.attributes;
        for (var i = 0; i < attributes.length; i++) {
          var item = attributes[i].name;
          if (item.includes('data--t-') || item.includes('data--b-' || 0 || 0 || 0)) {
            // has breakpoints
            hasBreakpoints = true;
          }
        }
        if (hasBreakpoints) {
          btnClearBreakpoints.style.display = '';
        } else {
          btnClearBreakpoints.style.display = 'none';
        }

        // Background image
        var blockOverlay = this.blockOverlay();
        var src = '';
        if (blockOverlay) if (blockOverlay.style.backgroundImage) {
          if (blockOverlay.style.backgroundImage.indexOf('url(') !== -1) {
            src = blockOverlay.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
          }
        }

        // Update preview
        this.updatePanelImage(src);

        // Show/hide grayscale
        var divGrayscale = modal.querySelector('.label.grayscale');
        if (src === '') {
          this.imagePreview.style.display = 'none';
          divGrayscale.style.display = 'none';
        } else {
          this.imagePreview.style.display = '';
          divGrayscale.style.display = '';
        }

        // Grayscale
        var chkGrayscale = modal.querySelector('.chk-grayscale');
        chkGrayscale.checked = false;
        if (blockOverlay) {
          if (blockOverlay.style.filter) {
            if (blockOverlay.style.filter.indexOf('grayscale') !== -1) {
              chkGrayscale.checked = true;
            }
          }
        }

        // Background color
        var btnColorPick = modal.querySelector('.input-block-bgcolor');
        if (blockOverlay) {
          var bgcolor = blockOverlay.style.backgroundColor;
          btnColorPick.style.backgroundColor = bgcolor; //preview
        } else {
          btnColorPick.style.backgroundColor = ''; //preview
        }

        // Gradient
        var btnGradient = modal.querySelector('.btn-block-gradient');
        if (blockOverlay) {
          if (blockOverlay.style.backgroundImage && blockOverlay.style.backgroundImage.includes('gradient')) {
            btnGradient.style.backgroundImage = blockOverlay.style.backgroundImage;
          } else {
            btnGradient.style.backgroundImage = '';
          }
        } else {
          btnGradient.style.backgroundImage = '';
        }
        var btnClearText = modal.querySelector('.btn-clear-text');
        btnClearText.style.display = 'none';
        var divContentColor = modal.querySelector('.div-content-textcolor');
        divContentColor.style.display = 'none';
        if (block.querySelector('.is-container')) {
          btnClearText.style.display = '';
          divContentColor.style.display = '';
        }

        // Lock
        var divBlockPos = modal.querySelector('#divBlockPos');
        var chkLockBlock = modal.querySelector('#inpLockBlock');
        var inpTop = modal.querySelector('#inpBlockTop');
        var inpTopUnit = modal.querySelector('#inpBlockTopUnit');
        var inpLeft = modal.querySelector('#inpBlockLeft');
        var inpLeftUnit = modal.querySelector('#inpBlockLeftUnit');
        var inpBottom = modal.querySelector('#inpBlockBottom');
        var inpBottomUnit = modal.querySelector('#inpBlockBottomUnit');
        var inpRight = modal.querySelector('#inpBlockRight');
        var inpRightUnit = modal.querySelector('#inpBlockRightUnit');
        var inpWidth = modal.querySelector('#inpBlockWidth');
        var inpWidthUnit = modal.querySelector('#inpBlockWidthUnit');
        var inpHeight = modal.querySelector('#inpBlockHeight');
        var inpHeightUnit = modal.querySelector('#inpBlockHeightUnit');
        if (block.classList.contains('locked')) {
          chkLockBlock.checked = true;
          divBlockPos.style.display = '';
          var top = block.style.top;
          var left = block.style.left;
          var bottom = block.style.bottom;
          var right = block.style.right;
          var width = block.style.width;
          var height = block.style.height;
          var topUnit = '';
          var leftUnit = '';
          var bottomUnit = '';
          var rightUnit = '';
          var widthUnit = '';
          var heightUnit = '';
          if (top.includes('calc')) {
            topUnit = '';
          } else if (top.includes('px')) {
            topUnit = 'px';
            top = top.replace('px', '');
          } else if (top.includes('%')) {
            topUnit = '%';
            top = top.replace('%', '');
          }
          if (left.includes('calc')) {
            leftUnit = '';
          } else if (left.includes('px')) {
            leftUnit = 'px';
            left = left.replace('px', '');
          } else if (left.includes('%')) {
            leftUnit = '%';
            left = left.replace('%', '');
          }
          if (bottom.includes('calc')) {
            bottomUnit = '';
          } else if (bottom.includes('px')) {
            bottomUnit = 'px';
            bottom = bottom.replace('px', '');
          } else if (bottom.includes('%')) {
            bottomUnit = '%';
            bottom = bottom.replace('%', '');
          }
          if (right.includes('calc')) {
            rightUnit = '';
          } else if (right.includes('px')) {
            rightUnit = 'px';
            right = right.replace('px', '');
          } else if (right.includes('%')) {
            rightUnit = '%';
            right = right.replace('%', '');
          }
          if (width.includes('calc')) {
            widthUnit = '';
          } else if (width.includes('px')) {
            widthUnit = 'px';
            width = width.replace('px', '');
          } else if (width.includes('%')) {
            widthUnit = '%';
            width = width.replace('%', '');
          }
          if (height.includes('calc')) {
            heightUnit = '';
          } else if (height.includes('px')) {
            heightUnit = 'px';
            height = height.replace('px', '');
          } else if (height.includes('%')) {
            heightUnit = '%';
            height = height.replace('%', '');
          }
          inpTop.value = top;
          inpTopUnit.value = topUnit;
          inpLeft.value = left;
          inpLeftUnit.value = leftUnit;
          inpBottom.value = bottom;
          inpBottomUnit.value = bottomUnit;
          inpRight.value = right;
          inpRightUnit.value = rightUnit;
          inpWidth.value = width;
          inpWidthUnit.value = widthUnit;
          inpHeight.value = height;
          inpHeightUnit.value = heightUnit;
        } else {
          chkLockBlock.checked = false;
          divBlockPos.style.display = 'none';
          inpTop.value = '';
          inpTopUnit.value = '%';
          inpLeft.value = '';
          inpLeftUnit.value = '%';
          inpBottom.value = '';
          inpBottomUnit.value = '%';
          inpRight.value = '';
          inpRightUnit.value = '%';
          inpWidth.value = '';
          inpWidthUnit.value = '%';
          inpHeight.value = '';
          inpHeightUnit.value = '%';
        }
      } else if (page) {
        // Background image
        var _src = '';
        if (page) if (page.style.backgroundImage) {
          if (page.style.backgroundImage.indexOf('url(') !== -1) {
            _src = page.style.backgroundImage.slice(4, -1).replace(/["']/g, '');
          }
        }

        // Update preview
        this.updatePanelPageImage(_src);

        // Show/hide 
        if (_src === '') {
          this.pageImagePreview.style.display = 'none';
        } else {
          this.pageImagePreview.style.display = '';
        }

        // Background color
        var btnPageColorPick = modal.querySelector('.input-page-bgcolor');
        if (page) {
          var _bgcolor = page.style.backgroundColor;
          btnPageColorPick.style.backgroundColor = _bgcolor; //preview
        } else {
          btnPageColorPick.style.backgroundColor = ''; //preview
        }

        // Gradient
        var btnPageGradient = modal.querySelector('.btn-page-gradient');
        if (page) {
          if (page.style.backgroundImage && page.style.backgroundImage.includes('gradient')) {
            btnPageGradient.style.backgroundImage = page.style.backgroundImage;
          } else {
            btnPageGradient.style.backgroundImage = '';
          }
        } else {
          btnPageGradient.style.backgroundImage = '';
        }
      }
    }
  }, {
    key: "openImagePicker",
    value: function openImagePicker(currentUrl, callback, btn) {
      //Current value
      var imageSource = document.querySelector('.is-modal.imagesource');
      var inpSrc = imageSource.querySelector('.input-src');
      inpSrc.value = currentUrl;

      //imageSelectedCallback
      this.builder.imageSelectedCallback = callback;

      //Show modal
      imageSource.style.zIndex = '10005';
      this.util.showModal(imageSource, false, function () {
        if (btn) {
          btn.removeAttribute('data-focus');
          btn.focus();
        }
      }, false, this.builder.assetPanelFullScreen);
      if (btn) btn.setAttribute('data-focus', true);
    }
  }, {
    key: "updatePageImage",
    value: function updatePageImage(src) {
      this.builder.uo.saveForUndo();
      var page = this.getPage();
      page.style.backgroundImage = 'url(\'' + src + '\')';

      // Reset position & filter (grayscale)
      page.style.filter = '';
      page.style.backgroundSize = '';
      page.style.backgroundPosition = '50% 60%';
      page.removeAttribute('data-bg-xs');
      page.removeAttribute('data-bg-sm');
      page.removeAttribute('data-bg-md');
      page.removeAttribute('data-bg-lg');
      this.updatePanelPageImage(src);
      this.builder.onChange();
    }
  }, {
    key: "updatePanelPageImage",
    value: function updatePanelPageImage(src) {
      var modal = this.modal;
      var previewHtml;
      if (!src) previewHtml = '';else previewHtml = "\n        <img src=\"".concat(src, "\">\n        ");
      this.pageImagePreview.innerHTML = previewHtml;

      // Show/hide image-related controls
      var btnPageClear = modal.querySelector('.btn-page-clear');
      var btnPageAdjust = modal.querySelector('.btn-page-adjust');
      if (src === '') {
        btnPageClear.style.display = 'none';
        btnPageAdjust.style.display = 'none';
      } else {
        btnPageClear.style.display = '';
        btnPageAdjust.style.display = '';
      }
      var btnPageGradient = modal.querySelector('.btn-page-gradient');
      btnPageGradient.style.backgroundImage = '';
    }
  }, {
    key: "updateImage",
    value: function updateImage(src) {
      this.builder.uo.saveForUndo();
      var blockOverlay = this.blockOverlay();
      blockOverlay.style.backgroundImage = 'url(\'' + src + '\')';

      // Reset position & filter (grayscale)
      blockOverlay.style.filter = '';
      blockOverlay.style.backgroundSize = '';
      blockOverlay.style.backgroundPosition = '50% 60%';
      blockOverlay.removeAttribute('data-bg-xs');
      blockOverlay.removeAttribute('data-bg-sm');
      blockOverlay.removeAttribute('data-bg-md');
      blockOverlay.removeAttribute('data-bg-lg');
      this.updatePanelImage(src);
      this.builder.onChange();
    }
  }, {
    key: "updatePanelImage",
    value: function updatePanelImage(src) {
      var modal = this.modal;
      var previewHtml;
      if (!src) previewHtml = '';else previewHtml = "\n        <img src=\"".concat(src, "\">\n        ");
      this.imagePreview.innerHTML = previewHtml;

      // Show/hide image-related controls
      var btnClear = modal.querySelector('.btn-block-clear');
      var btnAdjust = modal.querySelector('.btn-block-adjust');
      if (src === '') {
        btnClear.style.display = 'none';
        btnAdjust.style.display = 'none';
      } else {
        btnClear.style.display = '';
        btnAdjust.style.display = '';
      }
      var btnGradient = modal.querySelector('.btn-block-gradient');
      btnGradient.style.backgroundImage = '';
    }
  }, {
    key: "show",
    value: function show() {
      var _this2 = this;
      var modal = this.modal;
      if (document.querySelector('.snippetwindow.left.active')) {
        modal.style.left = 'auto';
        modal.style.right = '40px';
      } else if (document.querySelector('.snippetwindow.active')) {
        modal.style.left = '40px';
        modal.style.right = 'auto';
      } else if (this.builder.sidePanel === 'right' && this.builder.snippetList === '#divSnippetList') {
        modal.style.left = '40px';
        modal.style.right = 'auto';
      } else if (this.builder.sidePanel === 'left' && this.builder.snippetList === '#divSnippetList') {
        modal.style.left = 'auto';
        modal.style.right = '40px';
      }
      this.util.showModal(modal);
      this.realtime();
      this.handleBlockClick = function () {
        _this2.showHideControls();
      };
      var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
      docContainer.addEventListener('click', this.handleBlockClick);
      if (this.builder.iframe) {
        docContainer.addEventListener('click', this.handleBlockClick);
      }
      this.showHideControls();
    }
  }, {
    key: "showHideControls",
    value: function showHideControls() {
      var modal = this.modal;
      var content1 = modal.querySelector('.modal-none');
      var content2 = modal.querySelector('.modal-content');
      var content3 = modal.querySelector('.modal-page-content');
      var activeBlock = this.builder.doc.querySelector('.is-block.active');
      var page = this.getPage();
      var modalTitle = modal.querySelector('.modal-title');
      if (activeBlock) {
        if (!activeBlock.closest('.multi')) {
          content1.style.display = 'none';
          content2.style.display = '';
          content3.style.display = 'none';
          modalTitle.innerHTML = this.util.out('Block');
          this.realtime();
        } else {
          content1.style.display = 'none';
          content2.style.display = 'none';
          content3.style.display = '';
          modalTitle.innerHTML = this.util.out('Page');
          this.realtime();
        }
      } else if (page) {
        content1.style.display = 'none';
        content2.style.display = 'none';
        content3.style.display = '';
        modalTitle.innerHTML = this.util.out('Page');
        this.realtime();
      } else {
        content1.style.display = '';
        content2.style.display = 'none';
        content3.style.display = 'none';
      }
    }
  }, {
    key: "hide",
    value: function hide() {
      var modal = this.modal;
      this.util.hideModal(modal);
      document.removeEventListener('click', this.handleBlockClick);
      if (this.builder.iframe) {
        this.builder.doc.removeEventListener('click', this.handleBlockClick);
      }
    }
  }]);
  return BlockModal;
}();
/* harmony default export */ const blockmodal = (BlockModal);
;// CONCATENATED MODULE: ./src/contentbuilder/pagesize.js
function pagesize_typeof(obj) { "@babel/helpers - typeof"; return pagesize_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, pagesize_typeof(obj); }
function pagesize_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function pagesize_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, pagesize_toPropertyKey(descriptor.key), descriptor); } }
function pagesize_createClass(Constructor, protoProps, staticProps) { if (protoProps) pagesize_defineProperties(Constructor.prototype, protoProps); if (staticProps) pagesize_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function pagesize_toPropertyKey(arg) { var key = pagesize_toPrimitive(arg, "string"); return pagesize_typeof(key) === "symbol" ? key : String(key); }
function pagesize_toPrimitive(input, hint) { if (pagesize_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (pagesize_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
var PageSize = /*#__PURE__*/function () {
  function PageSize(builder) {
    pagesize_classCallCheck(this, PageSize);
    this.builder = builder;
    var util = this.builder.util;
    this.util = util;
    var builderStuff = this.builder.builderStuff;
    this.builderStuff = builderStuff;
    var dom = this.builder.dom;
    this.dom = dom;
  }
  pagesize_createClass(PageSize, [{
    key: "open",
    value: function open() {
      var _this = this;
      var builderStuff = this.builderStuff;
      var util = this.util;
      var dom = this.dom;
      var pageSizes = this.builder.pageSizes;
      var modal = builderStuff.querySelector('.is-modal.pagesize');
      if (!modal) {
        var html = "\n            <div class=\"is-modal pagesize\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\">\n    \n                    <div class=\"div-page-sizes\">\n                        ".concat(pageSizes.map(function (item) {
          return "<button title=\"".concat(item.title, "\" data-pagesize=\"").concat(item.pagesize, "\" style=\"").concat(item.style, "\" class=\"paper-item\">").concat(item.title, "</button>");
        }).join(''), "\n                    </div>\n    \n                    <div class=\"flex\" style=\"gap:10px;justify-content:center;margin-top:15px;\">\n                        <div>\n                            <label for=\"inpPageWidth\" style=\"display:block\">").concat(util.out('Width'), ":</label>\n                            <input id=\"inpPageWidth\" class=\"input-width\" type=\"text\">\n                        </div>\n                        <div>\n                            <label for=\"inpPageWidth\" style=\"display:block\">").concat(util.out('Height'), ":</label>\n                            <input id=\"inpPageHeight\" class=\"input-height\" type=\"text\">\n                        </div>\n                    </div>\n    \n                    <div style=\"text-align:right;margin-top:20px;display:none\">\n                        <button title=\"").concat(util.out('Cancel'), "\" class=\"input-cancel classic-secondary\">").concat(util.out('Cancel'), "</button>\n                        <button title=\"").concat(util.out('Ok'), "\" class=\"input-ok classic-primary\">").concat(util.out('Ok'), "</button>\n                    </div>\n    \n                </div>\n            </div>\n            <div class=\"is-modal viewprint\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"width:100%;height:100vh;padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100vw;height:100vh;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n            ");
        dom.appendHtml(builderStuff, html);
        modal = builderStuff.querySelector('.pagesize');
        this.modal = modal;
        var inpWidth = modal.querySelector('.input-width');
        var inpHeight = modal.querySelector('.input-height');
        var current = localStorage.getItem('_pagesize');
        if (current) {
          var arrCurrent = current.split(',');
          inpWidth.value = arrCurrent[0].trim();
          inpHeight.value = arrCurrent[1].trim();
        }
        var btnPageSize = modal.querySelectorAll('[data-pagesize]');
        btnPageSize.forEach(function (btn) {
          btn.addEventListener('click', function () {
            var elmCss = document.querySelector('#__css_pagesize');
            if (elmCss) elmCss.remove();
            var s = btn.getAttribute('data-pagesize');
            _this.setPageSize(s);
            inpWidth.value = '';
            inpHeight.value = '';
            var arr = s.split(',');
            inpWidth.value = arr[0].trim();
            inpHeight.value = arr[1].trim();
          });
        });
        var timer;
        inpWidth.addEventListener('input', function () {
          clearTimeout(timer);
          timer = setTimeout(function () {
            var current = localStorage.getItem('_pagesize');
            var isWeb = false;
            var arrCurrent = current.split(',');
            if (arrCurrent.length === 3) isWeb = true;
            var s = inpWidth.value + ',' + inpHeight.value + (isWeb ? ',web' : '');
            _this.setPageSize(s);
          }, 600);
        });
        inpHeight.addEventListener('input', function () {
          clearTimeout(timer);
          timer = setTimeout(function () {
            var current = localStorage.getItem('_pagesize');
            var isWeb = false;
            var arrCurrent = current.split(',');
            if (arrCurrent.length === 3) isWeb = true;
            var s = inpWidth.value + ',' + inpHeight.value + (isWeb ? ',web' : '');
            _this.setPageSize(s);
          }, 600);
        });
        var btnImageOk = modal.querySelector('.input-ok');
        dom.addEventListener(btnImageOk, 'click', function () {
          // const inpSrc = modal.querySelector('.input-src');
          // const url = inpSrc.value;

          _this.builder.hideModal(modal);
        });
        var btnImageCancel = modal.querySelector('.input-cancel');
        dom.addEventListener(btnImageCancel, 'click', function () {
          _this.builder.hideModal(modal);
        });
      }
      this.util.showModal(modal, false);
    }
  }, {
    key: "setPageSize",
    value: function setPageSize(s) {
      if (this.builder.canvas && !this.builder.isContentBox && this.builder.docContainer && !this.builder.iframe) {
        localStorage.setItem('_pagesize', s);
        var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
        var elms = docContainer.querySelectorAll('.is-box');
        elms.forEach(function (elm) {
          elm.setAttribute('data-pagesize', s);
        });
        var elmCss = document.querySelector('#__css_pagesize');
        if (elmCss) elmCss.remove();
        var css = this.getPageCss();
        document.head.insertAdjacentHTML('beforeend', css);

        // for the tools position
        var arr = s.split(',');
        // let w = arr[0].trim();
        // let h = arr[1].trim();
        if (arr.length === 3) {
          // web
          var box = docContainer.querySelector('.is-box');
          if (box) {
            var boxWidth = box.offsetWidth;
            var viewportWidth = this.builder.win.innerWidth;
            if (boxWidth < viewportWidth - 50) {
              // web (container)
              docContainer.classList.remove('page-web');
              docContainer.classList.add('page-web-container');
            } else {
              // web (full)
              docContainer.classList.remove('page-web-container');
              docContainer.classList.add('page-web');
            }
          } else {
            // web (full)
            docContainer.classList.remove('page-web-container');
            docContainer.classList.add('page-web');
          }
        } else {
          // print
          docContainer.classList.remove('page-web');
          docContainer.classList.remove('page-web-container');
        }
      } else {
        alert('This function works in Canvas mode only.');
      }
    }
  }, {
    key: "print",
    value: function print() {
      var builderStuff = this.builderStuff;
      var dom = this.dom;
      var modalIframe = builderStuff.querySelector('.viewprint');
      if (!modalIframe) {
        var html = "\n            <div class=\"viewprint\" style=\"display:none\">\n                <iframe tabindex=\"0\" style=\"width:2000px;height:2000px;border: none;display: block;\" src=\"about:blank\"></iframe>\n            </div>";
        dom.appendHtml(builderStuff, html);
        modalIframe = builderStuff.querySelector('.viewprint');
      }
      if (this.builder.canvas && !this.builder.isContentBox && this.builder.docContainer && !this.builder.iframe) {
        var ifr = modalIframe.querySelector('iframe');
        ifr.srcdoc = this.getPrintHtml();
      } else {
        alert('This function works in Canvas mode only.');
      }
    }
  }, {
    key: "getPrintHtml",
    value: function getPrintHtml() {
      var css = this.getPrintCss();
      var html = this.builder.html();
      return "\n        <!DOCTYPE HTML>\n        <html>\n        <head>\n            <meta charset=\"utf-8\">\n            <title></title>\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n            <meta name=\"description\" content=\"\">\n\n            <link href=\"".concat(this.builder.snippetPath, "print.css\" rel=\"stylesheet\">\n            \n            <style>\n\n            /* block.css */\n            /* box-canvas */\n            .is-box {\n                position: relative;\n                flex:none;\n            }\n            .is-block {\n                position: absolute;\n                box-sizing: border-box;\n                padding: 0;\n            }\n            .is-block .is-container {\n                max-width: unset !important;\n                width: 100%;\n                padding: 0;\n                box-sizing: border-box;\n                position: relative;\n                z-index: 1;\n            }\n            .is-box.autolayout .is-block.block-steady.fluid {\n                padding: 0;\n                width: 100% !important;\n                min-width: unset !important;\n                left: auto !important\n            }\n            .is-block-overlay { background-size: cover; background-repeat: no-repeat; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; user-select: none; }\n            \n            \n            body {\n                background: #eee;\n            }\n            .is-page {\n                position: relative;\n                transform-origin: top;\n            }\n            .is-box {\n                position: relative;\n                flex:none;\n                background: #fff;\n                overflow: hidden;\n                box-shadow: none;\n            }\n            ").concat(css, "\n            </style>\n        </head>\n        <body class=\"print\">\n\n            <div class=\"is-page\">").concat(html, "</div>\n\n            <script>\n                window.print();\n            </script>\n        </body>\n        </html>\n        ");
    }
  }, {
    key: "getPageCss",
    value: function getPageCss() {
      var s;
      if (localStorage.getItem('_pagesize') === '' || localStorage.getItem('_pagesize')) {
        s = localStorage.getItem('_pagesize');
      } else {
        s = this.pageSize || '';
      }
      var w, h;
      var css;
      if (s) {
        var arr = s.split(',');
        w = arr[0].trim();
        h = arr[1].trim();
        if (arr.length === 3) {
          // web
          css = "\n                <style id=\"__css_pagesize\">\n                .is-page {\n                    ".concat((w === '100%' || w === '100vw') && (h === '100%' || h === '100vh') ? '' : 'margin-top: 150px;', "\n                }\n                .is-box {\n                    width: 100%;\n                    max-width: ").concat(w, ";\n                    height: ").concat(h, ";\n                    margin: 0 auto;\n                }\n                </style>\n                ");
        } else {
          // print
          css = "\n                <style id=\"__css_pagesize\">\n                .is-page {\n                    margin-top:150px;\n                    gap: 45px;\n                }\n                .is-box {\n                    width: ".concat(w, ";\n                    height: ").concat(h, ";\n                }\n                </style>\n                ");
        }
      }
      return css;
    }
  }, {
    key: "getPrintCss",
    value: function getPrintCss() {
      var s;
      if (localStorage.getItem('_pagesize') === '' || localStorage.getItem('_pagesize')) {
        s = localStorage.getItem('_pagesize');
      } else {
        s = this.pageSize || '';
      }
      var w, h;
      var css;
      if (s) {
        var arr = s.split(',');
        w = arr[0].trim();
        h = arr[1].trim();
        if (arr.length === 3) {
          // web
          var docContainer = this.builder.doc.querySelector(this.builder.docContainer);
          var box = docContainer.querySelector('.is-box');
          if (!box) return '';
          var docWidth = box.offsetWidth + 'px';
          var docHeight = box.offsetHeight + 'px';
          css = "\n                <style id=\"__css_pagesize\">\n                .is-box {\n                    width: 100%;\n                    max-width: ".concat(docWidth, ";\n                    height: ").concat(docHeight, ";\n                    margin: 0 auto;\n                }\n                @media print { \n                    .is-box {\n                        width: ").concat(docWidth, ";\n                        height: ").concat(docHeight, ";\n                    } \n                }\n                @page {\n                    size:").concat(docWidth, " ").concat(docHeight, ";; \n                    margin: 0; \n                }\n                </style>\n                ");
        } else {
          // print
          css = "\n                <style id=\"__css_pagesize\">\n                .is-box {\n                    width: ".concat(w, ";\n                    height: ").concat(h, ";\n                }\n                @media print { \n                    .is-box {\n                        width: ").concat(w, "; \n                        height: ").concat(h, ";\n                    } \n                }\n                @page {\n                    size:").concat(w, " ").concat(h, ";\n                    margin: 0; \n                }\n                </style>\n                ");
        }
      }
      return css;
    }
  }]);
  return PageSize;
}();
/* harmony default export */ const pagesize = (PageSize);
;// CONCATENATED MODULE: ./src/contentbuilder/contentbuilder.js
function contentbuilder_typeof(obj) { "@babel/helpers - typeof"; return contentbuilder_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, contentbuilder_typeof(obj); }
function contentbuilder_asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function contentbuilder_asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { contentbuilder_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { contentbuilder_asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function contentbuilder_toConsumableArray(arr) { return contentbuilder_arrayWithoutHoles(arr) || contentbuilder_iterableToArray(arr) || contentbuilder_unsupportedIterableToArray(arr) || contentbuilder_nonIterableSpread(); }
function contentbuilder_nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function contentbuilder_unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return contentbuilder_arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return contentbuilder_arrayLikeToArray(o, minLen); }
function contentbuilder_iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function contentbuilder_arrayWithoutHoles(arr) { if (Array.isArray(arr)) return contentbuilder_arrayLikeToArray(arr); }
function contentbuilder_arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }
function contentbuilder_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function contentbuilder_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, contentbuilder_toPropertyKey(descriptor.key), descriptor); } }
function contentbuilder_createClass(Constructor, protoProps, staticProps) { if (protoProps) contentbuilder_defineProperties(Constructor.prototype, protoProps); if (staticProps) contentbuilder_defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function contentbuilder_toPropertyKey(arg) { var key = contentbuilder_toPrimitive(arg, "string"); return contentbuilder_typeof(key) === "symbol" ? key : String(key); }
function contentbuilder_toPrimitive(input, hint) { if (contentbuilder_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (contentbuilder_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }































 // freeform
 // freeform
 // freeform
var ContentBuilder = /*#__PURE__*/function () {
  function ContentBuilder() {
    var _this = this,
      _arguments = arguments;
    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    contentbuilder_classCallCheck(this, ContentBuilder);
    var defaults = {
      page: '',
      container: '.is-container',
      row: '',
      cols: [],
      colequal: [],
      colsizes: [],
      imageQuality: 0.92,
      elementSelection: true,
      paste: 'text',
      snippetJSON: {
        'snippets': []
      },
      screenMode: 'desktop',
      // Live Preview
      // previewURL: 'preview.html',
      onPreviewOpen: function onPreviewOpen() {
        var html = _this.html();
        localStorage.setItem('preview-html', html);
      },
      // onPreviewClose: ()=>{},
      previewStyle: 'top:auto;bottom:50px;left:50px;right:auto;',
      livePreviewOpen: false,
      livePreviewAlwaysReload: false,
      livePreviewReloadEvery: 30,
      // always reload every 30 onChange triggered (to clearup iframe resource for faster performance)

      scriptPath: '',
      // Deprecated
      // Old way:
      //      For the location of config.js. Used as pluginPath (if pluginPath empty).
      //      scriptPath = '' means the path will be autoset/autodetected (see currentScriptPath())
      //      This is not reliable and so will be deprecated.

      plugins: [],
      // pluginPath: '', 
      pluginPath: 'contentbuilder/',
      // Old way:
      //      If pluginPath is not empty, pluginPath will be used instead of scriptPath
      //      But scriptPath is still needed for the location of config.js
      // Now the new way is by specifying the plugins and pluginPath parameters. 
      // (If plugins has value [{..}], then config file won't be loaded. No need to use the scriptPath.)
      // For example:
      // plugins: [
      //     { name: 'preview', showInMainToolbar: true, showInElementToolbar: true },
      //     { name: 'wordcount', showInMainToolbar: true, showInElementToolbar: true },
      //     { name: 'symbols', showInMainToolbar: true, showInElementToolbar: false },
      //     { name: 'buttoneditor', showInMainToolbar: false, showInElementToolbar: false },
      // ],
      // pluginPath: 'contentbuilder/', // Location of the plugin scripts
      disableConfig: false,
      // If you don't specify the plugins param and set the disableConfig to true, then no plugins will be loaded.

      modulePath: 'assets/modules/',
      assetPath: 'assets/',
      // Used for the location of ionicons/ (see rte.js 2788) & scripts/ (see plugins/preview/plugin.js 237)
      fontAssetPath: 'assets/fonts/',
      // Option for self-hosted fonts:
      // fontPath: 'assets/cssfonts/', // If set, will be used

      snippetModal: false,
      snippetModalLeft: false,
      snippetData: 'assets/minimalist-blocks/snippetlist.html',
      // Deprecated
      snippetUrl: 'assets/minimalist-blocks/content.js',
      //new
      // snippetUrl: 'https://innovastudio.com/builderdemo/assets/minimalist-blocks/content.js',

      // snippetPath: '',  // Old
      // if snippetPath is specified (not empty), then use the specified. 
      // Otherwise, use the one generated from snippet file (_snippets_path)
      snippetPath: 'assets/minimalist-blocks/',
      // New: now snippetPath is specified
      snippetPathReplace: [],
      // ['',''],

      // Another Example:
      //      snippetPath: 'https://innovastudio.com/builderdemo/assets/minimalist-blocks/',
      //      snippetPathReplace: ['assets/','https://innovastudio.com/builderdemo/assets/'],

      // snippetSampleImage: 'uploads/office2.png', // if enabled, will be used to insert image block
      // snippetSampleVideo: 'uploads/person1.mp4', // if enabled, will be used to insert video block
      // snippetSampleAudio: 'uploads/intro.mp4', // if enabled, will be used to insert audio block

      snippetCategories: [[120, 'Basic'], [118, 'Article'], [101, 'Headline'], [119, 'Buttons'], [102, 'Photos'], [103, 'Profile'], [116, 'Contact'], [104, 'Products, Services'], [105, 'Features'], [108, 'Skills'], [109, 'Achievements'], [106, 'Process'], [107, 'Pricing'], [110, 'Quotes'], [111, 'Partners'], [112, 'As Featured On'], [113, 'Page Not Found'], [114, 'Coming Soon'], [115, 'Help, FAQ']],
      defaultSnippetCategory: 120,
      snippetHandle: true,
      sidePanel: 'right',
      snippetList: '#divSnippetList',
      onRender: function onRender() {},
      // onContentClick: function(){},
      onChange: function onChange() {},
      // onAdd: function(){},
      largerImageHandler: '',
      // onLargerImageUpload: function(){},

      imageHandler: '',
      // NEW: for image
      // onImageUpload: function(){}, // NEW: for image
      fileHandler: '',
      // NEW: for file/document
      // onFileUpload: function(){}, // NEW: for file/document

      mediaHandler: '',
      // onMediaUpload: function(){},
      videoHandler: '',
      // onVideoUpload: function(){},
      audioHandler: '',
      // onAudioUpload: function(){},
      colors: ['#ff8f00', '#ef6c00', '#d84315', '#c62828', '#58362f', '#37474f', '#353535', '#f9a825', '#9e9d24', '#558b2f', '#ad1457', '#6a1b9a', '#4527a0', '#616161', '#00b8c9', '#009666', '#2e7d32', '#0277bd', '#1565c0', '#283593', '#9e9e9e'],
      builderMode: '',
      rowTool: 'right',
      rowcolOutline: true,
      columnTool: true,
      outlineMode: '',
      toolStyle: '',
      outlineStyle: '',
      snippetAddTool: true,
      elementTool: true,
      elementHighlight: true,
      columnHtmlEditor: true,
      rowHtmlEditor: true,
      htmlSyntaxHighlighting: true,
      snippetOpen: false,
      toolbar: 'top',
      toolbarDisplay: 'auto',
      shortenHTML: true,
      imageResizeOnBlock: true,
      simpleEditingBreakpoint: '970px',
      // iframe only

      resizeHeight: false,
      snippetsSidebarDisplay: 'auto',
      // snippetDisplay: 'auto', // values: auto, visible (a new alternative). If used, will set the snippetsSidebarDisplay

      // onImageSelectClick: function () { }, 
      // onFileSelectClick: function () { },
      // onVideoSelectClick: function () { },
      // onAudioSelectClick: function () { },
      // onMediaSelectClick: function () { }, // NEW: for image & video
      // onPluginsLoaded: function () { },
      // onImageBrowseClick: function () { },
      // onImageSettingClick: function () { },

      /* 
      // onImageEditClick: function () { },  // used in elementimage.js
      // Example:
      onImageEditClick: (activeImage)=>{
                   activeImage.setAttribute('crossorigin', 'anonymous');
           const cropperConfig = {
              checkCrossOrigin:false,
              checkOrientation:false,
              crossOrigin:'anonymous',
              zoomable: false,
              viewMode: 1
          };
          builder.setCropperConfig = cropperConfig;
                   return true;
      },
      */
      // setCropperConfig: {}, // used in elementimage.js

      imageEmbed: true,
      imageselect: '',
      fileselect: '',
      videoselect: '',
      imageSelect: '',
      fileSelect: '',
      videoSelect: '',
      audioSelect: '',
      mediaSelect: '',
      // NEW: for image & video

      // selectIcon: '<svg class="is-icon-flex"><use xlink:href="#ion-more"></use></svg>',
      selectIcon: '<svg class="is-icon-flex" style="width:16px;height:16px;"><use xlink:href="#icon-folder"></use></svg>',
      // NEW: for any other file select. Will be visible on hyperlink dialog, image dialog (image link), and Column Settings dialog (on Click tab)
      otherSelect: '',
      otherSelectCaption: 'Select Document',
      // otherSelectIcon: '<svg class="is-icon-flex"><use xlink:href="#ion-ios-folder-outline"></use></svg>',
      otherSelectIcon: '<svg class="is-icon-flex" style="width:16px;height:16px;"><use xlink:href="#icon-list-search"></use></svg>',
      imageSelectWidth: '88vw',
      imageSelectHeight: '88vh',
      fileSelectWidth: '88vw',
      fileSelectHeight: '88vh',
      videoSelectWidth: '88vw',
      videoSelectHeight: '88vh',
      audioSelectWidth: '88vw',
      audioSelectHeight: '88vh',
      mediaSelectWidth: '88vw',
      mediaSelectHeight: '88vh',
      otherSelectWidth: '88vw',
      otherSelectHeight: '88vh',
      imageSelectMaxWidth: '1600px',
      fileSelectMaxWidth: '1600px',
      videoSelectMaxWidth: '1600px',
      audioSelectMaxWidth: '1600px',
      mediaSelectMaxWidth: '1600px',
      otherSelectMaxWidth: '1600px',
      assetPanelFullScreen: false,
      codeEditorWidth: '80vw',
      codeEditorHeight: '80vh',
      codeEditorMaxWidth: '1600px',
      blockCodeEditorWidth: '80vw',
      blockCodeEditorHeight: '45vh',
      blockCodeEditorMaxWidth: '960px',
      assetRefresh: false,
      // asset manager specified in imageSelect, fileSelect & videoSelect will always refreshed on click/open
      customTags: [],
      buttons: ['bold', 'italic', 'underline', 'formatting', 'color', 'align', 'textsettings', 'createLink', 'tags', '|', 'undo', 'redo', 'zoom', 'livepreview', 'aiassistant', 'snippets', 'more'],
      buttonsMore: ['icon', 'svg', 'image', '|', 'list', 'font', 'formatPara', '|', 'html', 'preferences'],
      elementButtons: ['left', 'center', 'right', 'full', 'undo', 'redo', 'zoom', 'livepreview', 'aiassistant', 'snippets', 'more'],
      elementButtonsMore: ['|', 'html', 'preferences'],
      iconButtons: ['icon', 'color', 'textsettings', 'createLink', '|', 'undo', 'redo', 'zoom', 'livepreview', 'aiassistant', 'snippets', 'more'],
      iconButtonsMore: ['html', 'preferences'],
      lang: [],
      checkLang: false,
      clearPreferences: false,
      toolbarAddSnippetButton: false,
      animateModal: true,
      defaultFontSizes: [16, 17, 18, 19, 21, 24, 32, 35, 42, 48, 54, 64 /*, 76, 96, 120, 200, 300*/],
      fontSizeClassValues: [12, 14, 15, 16, 17, 18, 19, 21, 24, 28, 32, 35, 38, 42, 46, 48, 50, 54, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 256, 260, 264, 268, 272, 276, 280, 284, 288, 292, 296, 300, 304, 308, 312, 316, 320, 324, 328, 332, 336, 340, 344, 348, 352, 356, 360, 364, 368, 372, 376, 380, 384, 388, 392, 396, 400],
      /* If not empty, applying font size will apply class: size-12, size-14, and so on. All responsive, defined in content.css */
      gradientcolors: [['linear-gradient(0deg, rgb(255, 57, 25), rgb(249, 168, 37))'], ['linear-gradient(0deg, rgb(255, 57, 25), rgb(255, 104, 15))'], ['linear-gradient(0deg, #FF5722, #FF9800)'], ['linear-gradient(0deg, #613ca2, rgb(110, 123, 217))'], ['linear-gradient(0deg, rgb(65, 70, 206), rgb(236, 78, 130))'], ['linear-gradient(0deg, rgb(0, 150, 102), rgb(90, 103, 197))'], ['linear-gradient(30deg, rgb(249, 119, 148), rgb(98, 58, 162))'], ['linear-gradient(0deg, rgb(223, 70, 137), rgb(90, 103, 197))'], ['linear-gradient(0deg, rgb(40, 53, 147), rgb(90, 103, 197))'], ['linear-gradient(0deg, rgb(21, 101, 192), rgb(52, 169, 239))'], ['linear-gradient(0deg, rgb(32, 149, 219), rgb(139, 109, 230))'], ['linear-gradient(0deg, rgb(90, 103, 197), rgb(0, 184, 201))'], ['linear-gradient(0deg, rgb(0, 184, 201), rgb(253, 187, 45))'], ['linear-gradient(0deg, rgb(255, 208, 100), rgb(239, 98, 159))'], ['linear-gradient(0deg, rgb(0, 214, 223), rgb(130, 162, 253))'], ['linear-gradient(0deg, rgb(50, 234, 251), rgb(248, 247, 126))'], ['linear-gradient(0deg, rgb(141, 221, 255), rgb(255, 227, 255))'], ['linear-gradient(0deg, rgb(255, 170, 170), rgb(255, 255, 200))'], ['linear-gradient(0deg, rgb(239, 239, 239), rgb(252, 252, 252))']],
      elementEditor: true,
      customval: '',
      moduleConfig: [],
      elementAnimate: false,
      cleanAOS: false,
      framework: '',
      cellFormat: '',
      rowFormat: '',
      // Email mode is an alternatif. 
      // ContentBuilder is focusing more on web building.
      emailMode: false,
      absolutePath: false,
      emailSnippetCategories: [[1, 'Logo'], [14, 'Call to Action'], [2, 'Title'], [3, 'Title, Subtitle'], [4, 'Info, Title'], [7, 'Paragraph'], [6, 'Heading'], [8, 'Buttons'], [9, 'Callouts'], [10, 'Images + Caption'], [12, 'Images'], [13, 'List'], [15, 'Pricing'], [16, 'Quotes'], [17, 'Profile'], [18, 'Contact Info'], [19, 'Footer'], [20, 'Separator']],
      defaultEmailSnippetCategory: 14,
      undoRedoStyles: false,
      // specialElementClasses: ['sl-wrapper', 'sl-overlay'] // specify elements that when clicked will not affect the builder interface (active selection). Usefull for external code, ex lightbox, etc. 

      // freeform
      onUndo: function onUndo() {},
      onRedo: function onRedo() {},
      onBlockCanvasAdd: function onBlockCanvasAdd() {},
      // docContainer: '.is-page',
      blockContainer: '.is-box',
      pageSize: '100%,100vh,web',
      //'800px,1000px,web'
      pageSizes: [{
        title: 'Web',
        pagesize: '100%,100vh,web',
        style: 'width:180px;height:112.5px'
      }, {
        title: 'Web (container)',
        pagesize: '1000px,1000px,web',
        style: 'width:180px;height:112.5px'
      }, {
        title: '8.27x5.52',
        pagesize: '8.27in,5.52in',
        style: 'width:124.05px;height:82.8px'
      }, {
        title: '8.3x5.8',
        pagesize: '8.3in,5.8in',
        style: 'width:124.5px;height:87px'
      }, {
        title: '9x7',
        pagesize: '9in,7in',
        style: 'wwidth:135px;height:105px'
      }, {
        title: 'A4',
        pagesize: '11.7in,8.3in',
        style: 'width:175.5px;height:124.5px'
      }, {
        title: 'Letter',
        pagesize: '11in,8.5in',
        style: 'width:165px;height:127.5px'
      }, {
        title: '12.5x10',
        pagesize: '12.5in,10in',
        style: 'width:187.5px;height:150px'
      }, {
        title: '14x11',
        pagesize: '14in,11in',
        style: 'width:210px;height:165px'
      }, {
        title: '8.5x8.5',
        pagesize: '8.5in,8.5in',
        style: 'width:127.5px;height:127.5px'
      }, {
        title: '10x10',
        pagesize: '10in,10in',
        style: 'width:150px;height:150px'
      }, {
        title: '12x12',
        pagesize: '12in,12in',
        style: 'width:180px;height:180px'
      }, {
        title: '5.27x8.27',
        pagesize: '5.27in,8.27in',
        style: 'width:79.05px;height:124.05px'
      }, {
        title: 'A5',
        pagesize: '5.8in,8.3in',
        style: 'width:87px;height:124.5px'
      }, {
        title: '6x9',
        pagesize: '6in,9in',
        style: 'width:90px;height:135px'
      }, {
        title: '6.6x10.25',
        pagesize: '6.6in,10.25in',
        style: 'width:99px;height:153.75px'
      }, {
        title: 'Letter',
        pagesize: '8.5in,11in',
        style: 'width:127.5px;height:165px'
      }, {
        title: 'A4',
        pagesize: '8.3in,11.7in',
        style: 'width:124.5px;height:175.5px'
      }],
      /*
      Deprecated:
      snippetSampleImage: '',
      classReplace: [],
      iconselect: 'assets/ionicons/icons.html',
      rowMoveButtons: true,
      addButtonPlacement: '',
      sourceEditor: true,
      snippetPageSliding
      animatedSorting
      dragWithoutHandle
      */

      maxEmbedImageWidth: 1600,
      //set -1 for no max (use original image width)
      zoom: 1,
      useLightbox: false,
      lightboxArrow: true,
      imageRenameOnEdit: true,
      disableAutoEmbedVideo: false,
      deleteConfirm: false,
      disableBootstrapIcons: false,
      sectionTemplate: "\n            <div class=\"is-section is-box is-section-100 type-opensans\">\n                <div class=\"is-overlay\"></div>\n                <div class=\"is-boxes\">\n                    <div class=\"is-box-centered\">\n                        <div class=\"is-container is-content-1100 v2 size-17 leading-13\">\n                            [%CONTENT%]\n                        </div>\n                    </div>\n                </div>\n            </div>\n            ",
      /*
      onZoomStart: () => {
           },
      onZoom: () => {
          console.log(scale);
      },
      onZoomEnd: (scale) => {
          console.log('end: ' + scale);
      }
       themes: [
          ['#ffffff','',''],
          ['#282828','dark','contentbuilder/themes/dark.css'],
          ['#0093dc','colored','contentbuilder/themes/colored-blue.css'],
          ['#006add','colored','contentbuilder/themes/colored-blue6.css'],
          ['#0a4d92','colored','contentbuilder/themes/colored-darkblue.css'],
          ['#96af16','colored','contentbuilder/themes/colored-green.css'],
          ['#e65800','colored','contentbuilder/themes/colored-orange.css'],
           ['#cc016f','colored','contentbuilder/themes/colored-magenta.css'],
          ['#782ec5','colored','contentbuilder/themes/colored-purple.css'],
          ['#de4ea4','colored','contentbuilder/themes/colored-pink.css'],
          ['#dd3905','colored','contentbuilder/themes/colored-red.css'],
          ['#e8ae00','colored','contentbuilder/themes/colored-yellow.css'],
          ['#13b34b','colored','contentbuilder/themes/colored-green4.css'],
          ['#333333','colored-dark','contentbuilder/themes/colored-dark.css'], 
          
          ['#dbe5f5','light','contentbuilder/themes/light-blue.css'],
          ['#fbe6f2','light','contentbuilder/themes/light-pink.css'],
          ['#dcdaf3','light','contentbuilder/themes/light-purple.css'],
          ['#ffe9e0','light','contentbuilder/themes/light-red.css'],
          ['#fffae5','light','contentbuilder/themes/light-yellow.css'],
          ['#ddf3dc','light','contentbuilder/themes/light-green.css'],
          ['#d7f7f1','light','contentbuilder/themes/light-cyan.css'],
           ['#c7ebfd','light','contentbuilder/themes/light-blue2.css'],
          ['#ffd5f2','light','contentbuilder/themes/light-pink2.css'],
          ['#eadafb','light','contentbuilder/themes/light-purple2.css'],
          ['#c5d4ff','light','contentbuilder/themes/light-blue3.css'],
          ['#ffefb1','light','contentbuilder/themes/light-yellow2.css'],
          ['#e5e5e5','light','contentbuilder/themes/light-gray2.css'],
          ['#dadada','light','contentbuilder/themes/light-gray.css'],
           ['#3f4ec9','colored','contentbuilder/themes/colored-blue2.css'],
          ['#6779d9','colored','contentbuilder/themes/colored-blue4.css'],
          ['#10b9d7','colored','contentbuilder/themes/colored-blue3.css'], 
          ['#006add','colored','contentbuilder/themes/colored-blue5.css'],
          ['#e92f94','colored','contentbuilder/themes/colored-pink3.css'],
          ['#a761d9','colored','contentbuilder/themes/colored-purple2.css'],
          ['#ff9d1e','colored','contentbuilder/themes/colored-yellow2.css'],
           ['#f3522b','colored','contentbuilder/themes/colored-red3.css'],
          ['#36b741','colored','contentbuilder/themes/colored-green2.css'],
          ['#00c17c','colored','contentbuilder/themes/colored-green3.css'],
          ['#fb3279','colored','contentbuilder/themes/colored-pink2.css'],
          ['#ff6d13','colored','contentbuilder/themes/colored-orange2.css'], 
          ['#f13535','colored','contentbuilder/themes/colored-red2.css'],
          ['#646464','colored','contentbuilder/themes/colored-gray.css'],
           ['#3f4ec9','dark','contentbuilder/themes/dark-blue.css'],
          ['#0b4d92','dark','contentbuilder/themes/dark-blue2.css'],
          ['#5f3ebf','dark','contentbuilder/themes/dark-purple.css'],
          ['#e92f69','dark','contentbuilder/themes/dark-pink.css'],
          ['#006add','dark','contentbuilder/themes/dark-blue3.css'],
          ['#4c4c4c','dark','contentbuilder/themes/dark-gray.css'],
          ['#ed2828','dark','contentbuilder/themes/dark-red.css'],
      ],
      */

      colHeight: [300, 350, 400, 450, 500, 550, 600, 650, 700],
      maxColumns: 6,
      // leadingPreset: [0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 2],
      // leadingPreset: [1, 1.1, 1.2, 1.3, 1.4, 1.6, 2],
      leadingPreset: [1, 1.1, 1.2, 1.3, 1.4, 1.6, 1.8],
      cssClasses: {
        fontWeight: {
          thin: 'font-thin',
          extralight: 'font-extralight',
          light: 'font-light',
          normal: 'font-normal',
          medium: 'font-medium',
          semibold: 'font-semibold',
          bold: 'font-bold',
          extrabold: 'font-extrabold',
          black: 'font-black',
          defaultBold: 'font-semibold',
          defaultNormal: 'font-light'
        },
        fontStyle: {
          italic: 'italic',
          normal: 'not-italic'
        },
        textDecoration: {
          underline: 'underline',
          linethrough: 'line-through',
          normal: 'no-underline'
        },
        textTransform: {
          uppercase: 'uppercase',
          lowercase: 'lowercase',
          capitalize: 'capitalize',
          normal: 'normal-case'
        },
        tracking: {
          tracking__100: 'tracking--100',
          tracking__075: 'tracking--75',
          tracking__050: 'tracking-tighter',
          tracking__025: 'tracking-tight',
          tracking_000: 'tracking-normal',
          tracking_025: 'tracking-wide',
          tracking_050: 'tracking-wider',
          tracking_075: 'tracking-75',
          tracking_100: 'tracking-widest',
          tracking_125: 'tracking-125',
          tracking_150: 'tracking-150',
          tracking_175: 'tracking-175',
          tracking_200: 'tracking-200',
          tracking_225: 'tracking-225',
          tracking_250: 'tracking-250',
          tracking_275: 'tracking-275',
          tracking_300: 'tracking-300',
          tracking_325: 'tracking-325',
          tracking_350: 'tracking-350',
          tracking_375: 'tracking-375',
          tracking_400: 'tracking-400',
          tracking_425: 'tracking-425',
          tracking_450: 'tracking-450',
          tracking_475: 'tracking-475',
          tracking_500: 'tracking-500'
        },
        leading: {
          leading_5: 'leading-05',
          leading_6: 'leading-06',
          leading_7: 'leading-07',
          leading_8: 'leading-08',
          leading_9: 'leading-09',
          leading_10: 'leading-none',
          leading_11: 'leading-11',
          leading_12: 'leading-12',
          leading_125: 'leading-tight',
          leading_13: 'leading-13',
          leading_1375: 'leading-snug',
          leading_14: 'leading-14',
          leading_15: 'leading-normal',
          leading_16: 'leading-16',
          leading_1625: 'leading-relaxed',
          leading_17: 'leading-17',
          leading_18: 'leading-18',
          leading_19: 'leading-19',
          leading_20: 'leading-loose',
          leading_21: 'leading-21',
          leading_22: 'leading-22',
          leading_23: 'leading-23',
          leading_24: 'leading-24',
          leading_25: 'leading-25',
          leading_26: 'leading-26',
          leading_27: 'leading-27',
          leading_28: 'leading-28',
          leading_29: 'leading-29',
          leading_30: 'leading-30'
        },
        opacity: {
          opacity_0: 'opacity-0',
          opacity_2: 'opacity-2',
          opacity_4: 'opacity-4',
          opacity_5: 'opacity-5',
          opacity_6: 'opacity-6',
          opacity_8: 'opacity-8',
          opacity_10: 'opacity-10',
          opacity_12: 'opacity-12',
          opacity_15: 'opacity-15',
          opacity_20: 'opacity-20',
          opacity_25: 'opacity-25',
          opacity_30: 'opacity-30',
          opacity_35: 'opacity-35',
          opacity_40: 'opacity-40',
          opacity_45: 'opacity-45',
          opacity_50: 'opacity-50',
          opacity_55: 'opacity-55',
          opacity_60: 'opacity-60',
          opacity_65: 'opacity-65',
          opacity_70: 'opacity-70',
          opacity_75: 'opacity-75',
          opacity_80: 'opacity-80',
          opacity_85: 'opacity-85',
          opacity_90: 'opacity-90',
          opacity_95: 'opacity-95',
          opacity_100: 'opacity-100'
        },
        padding: {
          all: {
            p_0: 'p-0',
            p_1: 'p-1',
            p_2: 'p-2',
            p_3: 'p-3',
            p_4: 'p-4',
            p_5: 'p-5',
            p_6: 'p-6',
            p_7: 'p-7',
            p_8: 'p-8',
            p_9: 'p-9',
            p_10: 'p-10',
            p_11: 'p-11',
            p_12: 'p-12',
            p_14: 'p-14',
            p_16: 'p-16',
            p_20: 'p-20'
          },
          x: {
            px_0: 'px-0',
            px_1: 'px-1',
            px_2: 'px-2',
            px_3: 'px-3',
            px_4: 'px-4',
            px_5: 'px-5',
            px_6: 'px-6',
            px_7: 'px-7',
            px_8: 'px-8',
            px_9: 'px-9',
            px_10: 'px-10',
            px_11: 'px-11',
            px_12: 'px-12',
            px_14: 'px-14',
            px_16: 'px-16',
            px_20: 'px-20'
          },
          y: {
            py_0: 'py-0',
            py_1: 'py-1',
            py_2: 'py-2',
            py_3: 'py-3',
            py_4: 'py-4',
            py_5: 'py-5',
            py_6: 'py-6',
            py_7: 'py-7',
            py_8: 'py-8',
            py_9: 'py-9',
            py_10: 'py-10',
            py_11: 'py-11',
            py_12: 'py-12',
            py_14: 'py-14',
            py_16: 'py-16',
            py_20: 'py-20'
          },
          top: {
            pt_0: 'pt-0',
            pt_1: 'pt-1',
            pt_2: 'pt-2',
            pt_3: 'pt-3',
            pt_4: 'pt-4',
            pt_5: 'pt-5',
            pt_6: 'pt-6',
            pt_7: 'pt-7',
            pt_8: 'pt-8',
            pt_9: 'pt-9',
            pt_10: 'pt-10',
            pt_11: 'pt-11',
            pt_12: 'pt-12',
            pt_14: 'pt-14',
            pt_16: 'pt-16',
            pt_20: 'pt-20'
          },
          right: {
            pr_0: 'pr-0',
            pr_1: 'pr-1',
            pr_2: 'pr-2',
            pr_3: 'pr-3',
            pr_4: 'pr-4',
            pr_5: 'pr-5',
            pr_6: 'pr-6',
            pr_7: 'pr-7',
            pr_8: 'pr-8',
            pr_9: 'pr-9',
            pr_10: 'pr-10',
            pr_11: 'pr-11',
            pr_12: 'pr-12',
            pr_14: 'pr-14',
            pr_16: 'pr-16',
            pr_20: 'pr-20'
          },
          bottom: {
            pb_0: 'pb-0',
            pb_1: 'pb-1',
            pb_2: 'pb-2',
            pb_3: 'pb-3',
            pb_4: 'pb-4',
            pb_5: 'pb-5',
            pb_6: 'pb-6',
            pb_7: 'pb-7',
            pb_8: 'pb-8',
            pb_9: 'pb-9',
            pb_10: 'pb-10',
            pb_11: 'pb-11',
            pb_12: 'pb-12',
            pb_14: 'pb-14',
            pb_16: 'pb-16',
            pb_20: 'pb-20'
          },
          left: {
            pl_0: 'pl-0',
            pl_1: 'pl-1',
            pl_2: 'pl-2',
            pl_3: 'pl-3',
            pl_4: 'pl-4',
            pl_5: 'pl-5',
            pl_6: 'pl-6',
            pl_7: 'pl-7',
            pl_8: 'pl-8',
            pl_9: 'pl-9',
            pl_10: 'pl-10',
            pl_11: 'pl-11',
            pl_12: 'pl-12',
            pl_14: 'pl-14',
            pl_16: 'pl-16',
            pl_20: 'pl-20'
          }
        },
        extend: {
          superscript: 'sup',
          subscript: 'sub'
        },
        textAlign: {
          left: 'text-left',
          center: 'text-center',
          right: 'text-right',
          justify: 'text-justify'
        },
        display: {
          flex: 'flex',
          block: 'block',
          inline: 'inline',
          inline_block: 'inline-block'
        },
        flexDirection: {
          row: 'flex-row',
          column: 'flex-col',
          row_reverse: 'flex-row-reverse',
          column_reverse: 'flex-col-reverse'
        },
        flexWrap: {
          wrap: 'flex-wrap',
          nowrap: 'flex-nowrap',
          wrap_reverse: 'flex-wrap-reverse'
        },
        justifyContent: {
          start: 'justify-start',
          end: 'justify-end',
          center: 'justify-center',
          between: 'justify-between',
          around: 'justify-around',
          evenly: 'justify-evenly'
        },
        alignItems: {
          start: 'items-start',
          end: 'items-end',
          center: 'items-center',
          baseline: 'items-baseline',
          stretch: 'items-stretch'
        }
      },
      useCssClasses: true,
      useButtonPlugin: false,
      enableDragResize: true,
      simpleTextSettings: false,
      enableColumnsPerLine: true,
      /* Prompt/Command Stuff for AI Assistant */
      startAIAssistant: false,
      isContentBox: false,
      sendCommandUrl: '',
      // http://localhost:8081/answer
      // speechTranscribeUrl: 'http://192.168.1.7:8081',
      onlineDemo: false,
      autoSendDelay: 4000,
      autoEditBlock: false,
      disclaimerAI: "The feature you're about to use utilizes AI in some of its processes. \n            It's important to understand that AI systems have limitations.\n            There may be instances where the results are not 100% accurate or may provide unexpected responses or information.\n            As a user, it's your responsibility to independently verify any information or results obtained through this AI-powered feature. \n            Our team is dedicated to continuously improving its performance and accuracy to enhance your experience.",
      showDisclaimer: true,
      AIModalStyle: '',
      enableShortCommands: true,
      speechRecognitionLang: 'en-US',
      assistantMode: 'general',
      triggerWords: {
        send: ['send', 'okay', 'ok', 'execute', 'run'],
        abort: ['abort', 'cancel'],
        clear: ['clear', 'erase']
      },
      temperature: 0.6,
      //0.4,
      topP: 0.9,
      //0.6,
      useMediaRecorder: true,
      // do not change
      encoderPath: '',
      imageAutoUpscale: true,
      headlineList: ['We create simple and effective designs.', 'Ultimate Experiences With Story, Emotion, And Purpose.', 'Build Anything Beautifully', 'With Less Stuff and More Compassion', 'We\'re [CompanyName]. Full stack development with a spark of creativity.', 'Transforming your digital experience with [CompanyName]. Achieve your online goals with our customized solutions.', 'Revolutionizing web development with [CompanyName]. Unleash your digital potential with our high-performance solutions.', 'Creative and Inspiring'],
      mediaPath: 'assets/gallery/',
      media: {
        slider: ['slide-01.jpg', 'slide-02.jpg'],
        blank_video: 'blank.mp4',
        videos: ['beach1.mp4', 'beach2.mp4'],
        youtube_videos: ['https://www.youtube-nocookie.com/embed/P5yHEKqx86U?rel=0&autoplay=1&color=white'],
        maps: ['https://www.youtube-nocookie.com/embed/P5yHEKqx86U?rel=0&autoplay=1&color=white'],
        audios: ['example.mp3'],
        images: {
          square: ['desk.jpg', 'chair.jpg', 'coffee.jpg', 'product.jpg', 'table.jpg', 'person-01.jpg', 'person-02.jpg', 'person-03.jpg', 'person-04.jpg', 'person-05.jpg', 'person-06.jpg', 'person-08.jpg']
        },
        bg_images: {
          box: ['person-01.jpg', 'person-02.jpg', 'person-03.jpg', 'person-04.jpg', 'person-05.jpg', 'person-06.jpg', 'person-07.jpg', 'person-08.jpg', 'person-09.jpg', 'person-10.jpg', 'building.jpg', 'desk.jpg', 'chair.jpg', 'coffee.jpg', 'product.jpg', 'table.jpg'],
          small_box: ['person-01.jpg', 'person-03.jpg', 'person-04.jpg', 'person-05.jpg', 'person-10.jpg', 'chair.jpg', 'coffee.jpg', 'product.jpg', 'table.jpg'],
          // section: [
          //     'header-01.jpg',
          //     'header-02.jpg',
          //     'header-03.jpg',
          //     'header-04.jpg',
          //     'header-05.jpg',
          //     'header-06.jpg',
          //     'header-07.jpg',
          //     'header-08.jpg',
          //     'header-09.jpg',
          //     'header-10.jpg',
          //     'header-11.jpg',
          //     'header-12.jpg',
          //     'header-13.jpg',
          //     'header-14.jpg',
          //     'header-15.jpg',
          // ],
          section_text_left: ['header-01.jpg', 'header-02.jpg', 'header-03.jpg', 'header-05.jpg', 'header-08.jpg', 'header-10b.jpg',
          // 'header-13.jpg',
          'header-14.jpg'
          // 'header-15b.jpg',
          ],

          section_text_center: ['header-07.jpg', 'header-11.jpg', 'header-12.jpg', 'header-13.jpg'],
          section_text_right: ['header-04.jpg', 'header-05b.jpg', 'header-06.jpg', 'header-08b.jpg', 'header-09.jpg', 'header-10.jpg', 'header-14b.jpg', 'header-15.jpg']
        }
      },
      shortCommandList: {
        undo: ['undo'],
        redo: ['undo'],
        increase: ['increase', 'bigger', 'larger', 'enlarge'],
        decrease: ['decrease', 'smaller'],
        bold: ['bold'],
        italic: ['italic'],
        underline: ['underline'],
        strikethrough: ['strikethrough'],
        superscript: ['superscript'],
        subscript: ['subscript'],
        uppercase: ['uppercase'],
        lowercase: ['lowercase'],
        capitalize: ['capitalize'],
        clean: ['clean']
      },
      similarityThreshold: 0.65,
      commandList: {
        select: ['select', 'select first', 'select first block'],
        select_next: ['select next', 'select after', 'select next block', 'select next row'],
        select_previous: ['select previous', 'select before', 'select previous block', 'select previous row'],
        select_last: ['select last', 'select last block'],
        select_block: ['select block'],
        unselect_block: ['unselect', 'unselect block'],
        select_headline: ['select headline'],
        select_paragraph: ['select paragraph'],
        select_button: ['select button'],
        select_space: ['select space'],
        select_image: ['select image'],
        change_font: ['change font', 'change typography', 'change style'],
        suggest_headline: ['suggest headline', 'suggest header', 'suggest title', 'write headline', 'write header', 'write title'],
        suggest_text: ['suggest text', 'write text'],
        add_headline: ['add headline', 'add header', 'add title'],
        add_paragraph: ['add paragraph'],
        add_image: ['add image'],
        add_youtube: ['add youtube'],
        add_video: ['add video'],
        remove_video: ['remove video', 'clear video'],
        add_bg_video: ['add background video'],
        remove_bg_video: ['remove background video', 'clear background video'],
        add_slider: ['add slider'],
        remove_slider: ['remove slider', 'clear slider'],
        add_audio: ['add audio', 'add music', 'add mp3'],
        add_map: ['add map', 'add google map'],
        add_table: ['add table'],
        add_social: ['add social'],
        add_icon: ['add icon'],
        add_button: ['add button'],
        add_2buttons: ['add 2 button', 'add 2 buttons'],
        add_space: ['add space'],
        position_before: ['above', 'before'],
        increase_line_height: ['increase line height', 'increase line spacing', 'increase text spacing', 'enlarge line height', 'enlarge line spacing', 'enlarge text spacing', 'bigger line height', 'bigger line spacing', 'bigger text spacing', 'make line height bigger', 'make line spacing bigger', 'make text spacing bigger'],
        decrease_line_height: ['decrease line height', 'decrease line spacing', 'decrease text spacing', 'reduce line height', 'reduce line spacing', 'reduce text spacing', 'smaller line height', 'smaller line spacing', 'smaller text spacing', 'make line height smaller', 'make line spacing smaller', 'make text spacing smaller'],
        increase_font_size: ['increase font', 'increase size', 'increase font size', 'increase text', 'increase size', 'increase text size', 'enlarge font', 'enlarge size', 'enlarge font size', 'enlarge text', 'enlarge size', 'enlarge text size', 'text bigger', 'font bigger', 'size bigger'],
        decrease_font_size: ['decrease font', 'decrease size', 'decrease font size', 'decrease text', 'decrease size', 'decrease text size', 'reduce font', 'reduce size', 'reduce font size', 'reduce text', 'reduce size', 'reduce text size', 'text smaller', 'font smaller', 'size smaller'],
        clear_font_size: ['clear font size', 'remove font size', 'clear text size', 'remove text size', 'use default font size'],
        align_left: ['align left', 'align text left', 'left aligned'],
        align_center: ['align center', 'align text center', 'center aligned'],
        align_right: ['align right', 'align text right', 'right aligned'],
        align_full: ['align full', 'align justify', 'justify', 'justify text', 'justify full'],
        clear_alignment: ['clear alignment', 'remove alignment', 'clear text alignment', 'remove text alignment'],
        increase_space: ['more space', 'increase space', 'enlarge space'],
        decrease_space: ['less space', 'decrease space', 'reduce space'],
        move_up: ['move up'],
        move_down: ['move down'],
        move_row_up: ['move row up'],
        move_row_down: ['move row down'],
        duplicate_row: ['duplicate row', 'copy row'],
        remove_row: ['remove row', 'delete row'],
        move_col_left: ['move left', 'move column left'],
        move_col_right: ['move right', 'move column right'],
        duplicate_col: ['duplicate column', 'copy column'],
        remove_col: ['remove column', 'delete column'],
        move_column_up: ['move column up'],
        move_column_down: ['move column down']
      },
      commandInfo: {
        general: {
          title: 'General',
          description: 'Commands for designing or editing.',
          list: [
          // 'Create a section containing a short article with ideas for outdoor activities. Divide into subtopics.',
          'Add a content that highlights our AI-powered web solutions. Include a compelling headline, a paragraph, and two buttons named \'Our Works\' and \'Get in Touch\'. ', 'Create an article on ideas for outdoor activities. Include a minimum of 300 words.', 'Can you suggest a captivating headline for us and replace the current one?', 'Add a content showcasing our AI-powered innovations. Craft an attention-grabbing headline, provide explanations, incorporate an image, and add an enticing call-to-action.', // 'Add a new header content for our development studio, which uniquely integrates AI into its solutions. Include a compelling headline, a paragraph, and two buttons named \'Our Works\' and \'Get Started\'. Also, add a background image.',
          // `Add a new header content for our web studio. Include a compelling headline, a paragraph, and two buttons named 'Our Works' and 'Get in Touch'.<br> 
          // Also, add a background image.`,
          "Create a feature list of our wood cabin for rent:<br>\n- Scenic forest view<br>\n- Modern comforts<br>\n- Outdoor escape<br>\nAdd an icon for each list item.", // `Add a content highlighting the features of our creative arts courses:<br>
          // - Hands-on projects and assignments<br>
          // - Feedback and guidance from experts<br>
          // Include an image for each feature.
          // Provide an engaging headline.`,
          // 'Create a new content showcasing a photo gallery of our latest photography workshop. Includes up to 3 photo placeholders. Additionally, please add a title.',
          "Add a content highlighting the features of our creative arts courses:<br>\n- Hands-on projects<br>\n- Guidance from experts<br>\nAdd an image for each feature.", 'Revise the headline, paragraph, and all the text using alternative ideas.',
          // 'Let\'s redesign the layout. Surprise me with a new idea!',

          'Create a new content showcasing a photo gallery of our latest photography workshop. Includes up to 3 photo placeholders.',
          // Create a new content that highlights our web studio. It should include an attention-grabbing headline, an engaging paragraph, an image, and a compelling call-to-action button.
          // Add a new content consisting of two boxes. The first box should feature a captivating headline about our Arts courses, an informative paragraph, and a button labeled 'Browse Courses'. The second box should remain empty but have a background image.
          'Create a content highlighting what sets our web development studio apart. Include a maximum of 3 list items, each with an item title and a short paragraph with less than 20 words. Also, add a numbering.',
          // Rewrite all the text to improve the overall copywriting quality.
          // Can you come up with another rendition of the content or offer an alternative wording?
          'My name is Emilie, and I\'m a product designer with 5 years of experience. Please create a new \'About Me\' content with a headline, description, and two buttons named \'My Works\' and \'Get in Touch\'. Additionally, please include an image.',
          // Change the button text with an alternative wording'
          // Can you suggest a captivating headline for us?'
          'Do you see the button with a gray background? Please change the background color to light green.',
          // 'Underline the phrase \'every monday\' and change the color to dark blue.',

          'Summarize this content in 100 words.'
          // 'Undo',
          // 'Redo'
          ]
          // width: '400px'
        },

        others: {
          title: 'Ask Questions or Request Information',
          description: 'Commands that are <u>not related to designing and editing of the current content</u>.',
          list: ['Provide well-researched information about bookstores in the Melbourne city area that offer collections of classic titles. Include specific details such as locations, website links, the range of classic titles they offer, and any unique features they have.', 'Explain our galaxy in a beginner-friendly and interesting way.', 'Can you explain the process of baking a classic chocolate cake from scratch?',
          // 'Give me a list of effective home workouts for beginners without any equipment.',
          // 'Give me ideas for designing a cozy and functional home office space.',
          'Provide me with a 10-hour plan for learning practical data science.'
          // 'Can you explain how to set up a new React project?'
          ]
        },

        block: {
          title: 'Edit Selected Text',
          description: 'Specifically target the selected block for editing, providing more precise results.',
          list: ['Enhance the content by including introductory paragraphs after the title.', 'Add a space between the title and the button.', 'Increase the space between the title and the paragraph.', 'Apply a gradient text color from red to orange horizontally to the title.',
          // 'Paraphrase the title.',
          'Rewrite the headline with alternative ideas', 'Reduce the title font size.',
          // 'Align the text to the center.',
          'Add a link on the text \'Download\' that directs to: https://example.com/download', 'Add a new block containing a Google map showing local cafes in the Perth city area.']
        },
        image: {
          title: 'Image',
          description: 'Generate image for the selected image or background',
          list: ['A small office building in a distant view, surrounded by a warm blend of brown and orange hues against a serene blue sky. Embrace a muted color palette with pastel tones, emphasizing natural and clean aesthetics. Craft a simple yet impactful composition with generous negative space, channeling a minimalist look that exudes brightness and sophistication. Infuse the scene with a style reminiscent of architecture magazines, ensuring a full focus background that complements the building\'s design. Utilize high-quality equipment such as an 8K UHD camera and DSLR for impeccable detail, and employ soft lighting to enhance the overall visual appeal.', 'A minimalist wood cabin is captured from a distance, surrounded by a sea of grass, bathed in the soft, breathtaking sunlight of 17:00, under an expansive blue sky. The image is crafted in a true minimalist photographic style, emphasizing the bright open sky and featuring lots of white space.', 'A simple wooden table adorned with a petite vase and a vibrant yellow flower. Opt for a clean background with ample white space, prioritizing minimalism. Cultivate a muted color palette and pastel tones to create a serene atmosphere. Employ soft lighting to enhance the gentle ambiance. Aim for a style reminiscent of interior magazines, capturing the essence of sophistication and simplicity in every detail.']
        }
        /*
        selection: {
            title: 'Selection & Layout',
            list: [
                'Select the headline',
                // 'Select the paragraph',
                // 'Select the button',
                // 'Select the space',
                // 'Select the image',
                'Select the next block',
                // 'Select the previous block',
                // 'Select the first block',
                // 'Select the last block',
                'Move up',
                'Move down',
                'Duplicate row',
                'Remove row',
                'Move column left',
                'Move column right',
                'Duplicate column',
                'Remove column',
                // 'Move column up',
                // 'Move column down',
                'Move section up',
                'Move section down',
                // 'Move section top',
                // 'Move section bottom',
                // 'Duplicate section',
                // 'Remove section',
            ]
        },
        element: {
            title: 'Element',
            list: [
                'Add a headline',
                'Add a paragraph',
                'Add an image',
                'Add a Youtube video',
                // 'Add a table',
                // 'Add audio',
                // 'Add map',
                // 'Add an icon',
                // 'Add social links',
                'Add a button',
                'Add two buttons',
                'Add a space',
                'Increase the space',
                // 'Reduce the space',
            ]
        },
        text: {
            title: 'Text Formatting',
            list: [
                // 'Increase', 'Bigger','Larger','Enlarge', 
                // 'Decrease', 'Smaller',
                'Increase font size',
                // 'Decrease font size',
                'Clear font size',
                // 'Align left',
                'Align center',
                'Align right',
                'Align justify',
                'Clear alignment',
                     'Bold',
                'Italic',
                'Underline',
                'Strikethrough',
                // 'Superscript',
                // 'Subscript',
                'Uppercase',
                // 'Lowercase',
                // 'Capitalize',
                'Clean',
            ]
        },
        */
      },

      commandInfoCanvasMode: {
        general: {
          title: 'General',
          description: 'Commands for designing or editing.',
          list: [
          // 'Create a section containing a short article with ideas for outdoor activities. Divide into subtopics.',
          'Add a content that highlights our AI-powered web solutions. Include a compelling headline, a paragraph, and two buttons named \'Our Works\' and \'Get in Touch\'. ', 'Create an article on ideas for outdoor activities. Include a minimum of 300 words.', 'Add a content showcasing our AI-powered innovations. Craft an attention-grabbing headline, provide explanations, incorporate an image, and add an enticing call-to-action.', // 'Add a new header content for our development studio, which uniquely integrates AI into its solutions. Include a compelling headline, a paragraph, and two buttons named \'Our Works\' and \'Get Started\'. Also, add a background image.',
          // `Add a new header content for our web studio. Include a compelling headline, a paragraph, and two buttons named 'Our Works' and 'Get in Touch'.<br> 
          // Also, add a background image.`,
          "Create a feature list of our wood cabin for rent:<br>\n- Scenic forest view<br>\n- Modern comforts<br>\n- Outdoor escape<br>\nAdd an icon for each list item.", // `Add a content highlighting the features of our creative arts courses:<br>
          // - Hands-on projects and assignments<br>
          // - Feedback and guidance from experts<br>
          // Include an image for each feature.
          // Provide an engaging headline.`,
          // 'Create a new content showcasing a photo gallery of our latest photography workshop. Includes up to 3 photo placeholders. Additionally, please add a title.',
          "Add a content highlighting the features of our creative arts courses:<br>\n- Hands-on projects<br>\n- Guidance from experts<br>\nAdd an image for each feature.", 'Create a new content showcasing a photo gallery of our latest photography workshop. Includes up to 3 photo placeholders.',
          // Create a new content that highlights our web studio. It should include an attention-grabbing headline, an engaging paragraph, an image, and a compelling call-to-action button.
          // Add a new content consisting of two boxes. The first box should feature a captivating headline about our Arts courses, an informative paragraph, and a button labeled 'Browse Courses'. The second box should remain empty but have a background image.
          'Create a content highlighting what sets our web development studio apart. Include a maximum of 3 list items, each with an item title and a short paragraph with less than 20 words. Also, add a numbering.',
          // Rewrite all the text to improve the overall copywriting quality.
          // Can you come up with another rendition of the content or offer an alternative wording?
          'My name is Emilie, and I\'m a product designer with 5 years of experience. Please create a new \'About Me\' content with a headline, description, and two buttons named \'My Works\' and \'Get in Touch\'. Additionally, please include an image.'

          // 'Undo',
          // 'Redo'
          ]
          // width: '400px'
        },

        general2: {
          title: 'General (with block selection)',
          description: 'Commands for designing or editing.',
          list: ['Rewrite the headline to captivate readers and maximize impact',
          // Rewrite all the text to improve the overall copywriting quality.
          // Can you come up with another rendition of the content or offer an alternative wording?
          'Change the button text with an alternative wording', 'Do you see the button with a gray background? Please change the background color to light green.', 'Summarize this content in 100 words.']
          // width: '400px'
        },

        others: {
          title: 'Ask Questions or Request Information',
          description: 'Commands that are <u>not related to designing and editing of the current content</u>.',
          list: ['Provide well-researched information about bookstores in the Melbourne city area that offer collections of classic titles. Include specific details such as locations, website links, the range of classic titles they offer, and any unique features they have.', 'Explain our galaxy in a beginner-friendly and interesting way.', 'Can you explain the process of baking a classic chocolate cake from scratch?',
          // 'Give me a list of effective home workouts for beginners without any equipment.',
          // 'Give me ideas for designing a cozy and functional home office space.',
          'Provide me with a 10-hour plan for learning practical data science.'
          // 'Can you explain how to set up a new React project?'
          ]
        },

        block: {
          title: 'Edit Selected Text',
          description: 'Specifically target the selected block for editing, providing more precise results.',
          list: ['Enhance the content by including introductory paragraphs after the title.', 'Add a space between the title and the button.', 'Increase the space between the title and the paragraph.', 'Apply a gradient text color from red to orange horizontally to the title.',
          // 'Paraphrase the title.',
          'Rewrite the headline with alternative ideas', 'Reduce the title font size.',
          // 'Align the text to the center.',
          'Add a link on the text \'Download\' that directs to: https://example.com/download', 'Add a new block containing a Google map showing local cafes in the Perth city area.']
        },
        image: {
          title: 'Image',
          description: 'Generate image for the selected image or background',
          list: ['A small office building in a distant view, surrounded by a warm blend of brown and orange hues against a serene blue sky. Embrace a muted color palette with pastel tones, emphasizing natural and clean aesthetics. Craft a simple yet impactful composition with generous negative space, channeling a minimalist look that exudes brightness and sophistication. Infuse the scene with a style reminiscent of architecture magazines, ensuring a full focus background that complements the building\'s design. Utilize high-quality equipment such as an 8K UHD camera and DSLR for impeccable detail, and employ soft lighting to enhance the overall visual appeal.', 'A minimalist wood cabin is captured from a distance, surrounded by a sea of grass, bathed in the soft, breathtaking sunlight of 17:00, under an expansive blue sky. The image is crafted in a true minimalist photographic style, emphasizing the bright open sky and featuring lots of white space.', 'A simple wooden table adorned with a petite vase and a vibrant yellow flower. Opt for a clean background with ample white space, prioritizing minimalism. Cultivate a muted color palette and pastel tones to create a serene atmosphere. Employ soft lighting to enhance the gentle ambiance. Aim for a style reminiscent of interior magazines, capturing the essence of sophistication and simplicity in every detail.']
        }
      }
    };

    // obj.preserveSelection = true; (can be set programmatically) to prevent click that clears selection on external custom modal.

    this.opts = Object.assign(this, defaults, opts);
    if (window.data_basic) {
      // if snippet file included
      this.opts.snippetJSON = window.data_basic;
      // if snippetPath is specified (not empty), then use the specified. Otherwise, use the one generated from snippet file (_snippets_path)
      if (this.opts.snippetPath === '') {
        this.opts.snippetPath = window._snippets_path;
      }
    }
    if (this.opts.snippetDisplay) {
      if (this.opts.snippetDisplay === 'auto') {
        this.opts.snippetsSidebarDisplay = 'auto';
      } else {
        // can be any: 'stay', 'visible'
        this.opts.snippetsSidebarDisplay = 'always';
      }
    }

    // if scriptPath is specified (not empty), then use the specified. Otherwise, use generated.
    if (this.opts.scriptPath === '') {
      this.opts.scriptPath = this.currentScriptPath();
    }
    if (window._txt) {
      // if language file is included
      this.opts.lang = window._txt;
    }
    this.settings = this.opts; // Backward compatible

    // freeform
    if (this.canvas && !this.isContentBox) {
      /*
      blockContainer: '.is-box',
      imageResizeOnBlock: false,
      toolbarDisplay: 'always',
      buttons: ['bold', 'italic', 'underline', 'formatting', 'color', 'align', 'textsettings', 'createLink', 'tags', '|', 'undo', 'redo', 'aiassistant', 'snippets', 'zoom', 'pageoptions', 'print', 'html', 'more'],  
      buttonsMore: ['icon', 'image', '|', 'list', 'font', 'formatPara'], 
      elementButtons: ['front', 'backward', 'moveup', 'movedown',  'group', 'ungroup', 'duplicate', 'delete','left', 'center', 'right', 'full' , 'undo', 'redo', 'aiassistant', 'snippets', 'blocksettings', 'zoom', 'pageoptions', 'print', 'html'],  
      elementButtonsMore: [], 
      iconButtons: ['icon', 'color','textsettings', 'createLink','|', 'undo', 'redo', 'aiassistant', 'snippets', 'zoom', 'pageoptions', 'print', 'html'],  
      iconButtonsMore: [], 
      */
      this.blockContainer = '.is-box';
      this.imageResizeOnBlock = false;
      this.toolbarDisplay = 'always';
      // this.buttons = ['bold', 'italic', 'underline', 'formatting', 'color', 'align', 'textsettings', 'createLink', 'tags', '|', 'undo', 'redo', 'aiassistant', 'snippets','pageoptions', 'print', 'html',  'zoom', 'more'];  
      // this.buttonsMore = ['icon', 'image', '|', 'list', 'font', 'formatPara'];
      // this.elementButtons = ['front', 'backward', 'moveup', 'movedown',  'group', 'ungroup', 'duplicate', 'delete','left', 'center', 'right', 'full' , 'undo', 'redo', 'aiassistant', 'snippets', 'blocksettings', 'pageoptions', 'print', 'zoom', 'html'];
      // this.elementButtonsMore = [];
      // this.iconButtons = ['icon', 'color','textsettings', 'createLink','|', 'undo', 'redo', 'aiassistant', 'snippets', 'pageoptions', 'print', 'zoom', 'html'];
      // this.iconButtonsMore = [];

      this.buttons = ['bold', 'italic', 'underline', 'formatting', 'color', 'align', 'textsettings', 'createLink', 'tags', '|', 'undo', 'redo', 'html', 'zoom', 'more'];
      this.buttonsMore = ['icon', 'image', '|', 'list', 'font', 'formatPara', '|', 'aiassistant', 'snippets', 'pageoptions', 'print', 'preferences'];
      this.elementButtons = ['front', 'backward', 'moveup', 'movedown', 'group', 'ungroup', 'duplicate', 'delete', 'left', 'center', 'right', 'full', 'undo', 'redo', 'blocksettings', 'html', 'zoom', 'more'];
      this.elementButtonsMore = ['aiassistant', 'snippets', 'pageoptions', 'print', 'preferences'];
      this.iconButtons = ['icon', 'color', 'textsettings', 'createLink', '|', 'undo', 'redo', 'html', 'zoom', 'more'];
      this.iconButtonsMore = ['aiassistant', 'snippets', 'pageoptions', 'print', 'preferences'];
      if (!this.docContainer && this.container !== '.is-container') {
        this.docContainer = this.container;
        this.container = '.is-container';
        this.opts.container = '.is-container';
      }
    }
    if (this.opts.imageSelect !== '') {
      this.opts.imageselect = this.opts.imageSelect;
    } else if (this.opts.imageselect !== '') {
      this.opts.imageSelect = this.opts.imageselect;
    }
    if (this.opts.fileSelect !== '') {
      this.opts.fileselect = this.opts.fileSelect;
    } else if (this.opts.fileselect !== '') {
      this.opts.fileSelect = this.opts.fileselect;
    }
    if (this.opts.videoSelect !== '') {
      this.opts.videoselect = this.opts.videoSelect;
    } else if (this.opts.videoselect !== '') {
      this.opts.videoSelect = this.opts.videoselect;
    }
    if (this.assetPanelFullScreen) {
      this.imageSelectWidth = '100vw';
      this.imageSelectHeight = '100vh';
      this.fileSelectWidth = '100vw';
      this.fileSelectHeight = '100vh';
      this.videoSelectWidth = '100vw';
      this.videoSelectHeight = '100vh';
      this.audioSelectWidth = '100vw';
      this.audioSelectHeight = '100vh';
      this.mediaSelectWidth = '100vw';
      this.mediaSelectHeight = '100vh';
      this.otherSelectWidth = '100vw';
      this.otherSelectHeight = '100vh';
      this.imageSelectMaxWidth = '100vw';
      this.fileSelectMaxWidth = '100vw';
      this.videoSelectMaxWidth = '100vw';
      this.audioSelectMaxWidth = '100vw';
      this.mediaSelectMaxWidth = '100vw';
      this.otherSelectMaxWidth = '100vw';
    }

    // if(this.opts.largerImageHandler!=='') {
    //     this.opts.mediaHandler = this.opts.largerImageHandler;
    // } else if(this.opts.mediaHandler!=='') {
    //     this.opts.largerImageHandler = this.opts.mediaHandler;
    // }
    // if(this.opts.onLargerImageUpload) {
    //     this.opts.onMediaUpload = this.opts.onLargerImageUpload;
    // } else if(this.opts.onMediaUpload) {
    //     this.opts.onLargerImageUpload = this.opts.onMediaUpload;
    // }

    // Just in case
    if (!this.opts.onImageUpload && !this.opts.onLargerImageUpload) {
      this.opts.onImageUpload = this.opts.onMediaUpload;
    }
    if (!this.opts.imageHandler && !this.opts.largerImageHandler) {
      this.opts.imageHandler = this.opts.mediaHandler;
    }

    // Currently used: largerImageHandler & onLargerImageUpload (as in elementimage.js)
    if (this.opts.imageHandler !== '') {
      this.opts.largerImageHandler = this.opts.imageHandler;
    }
    if (this.opts.onImageUpload) {
      this.opts.onLargerImageUpload = this.opts.onImageUpload;
    }

    // useButtonPlugin
    if (this.opts.emailMode) {
      this.useButtonPlugin = true;
    }
    if (!this.useButtonPlugin) {
      var _arr = this.plugins.filter(function (item) {
        return item.name !== 'buttoneditor';
      });
      this.plugins = contentbuilder_toConsumableArray(_arr);
    }

    // Alternative settions to define css grid frameworks
    if (this.opts.framework === 'bootstrap') {
      this.opts.row = 'row';
      this.opts.cols = ['col-md-1', 'col-md-2', 'col-md-3', 'col-md-4', 'col-md-5', 'col-md-6', 'col-md-7', 'col-md-8', 'col-md-9', 'col-md-10', 'col-md-11', 'col-md-12'];
      this.opts.colequal = [];
      this.opts.colsizes = [];
    } else if (this.opts.framework === 'tailwind') {
      this.opts.row = 'flex flex-col md:flex-row';
      this.opts.cols = ['w-full md:w-1/12 px-4', 'w-full md:w-2/12 px-4', 'w-full md:w-3/12 px-4', 'w-full md:w-4/12 px-4', 'w-full md:w-5/12 px-4', 'w-full md:w-6/12 px-4', 'w-full md:w-7/12 px-4', 'w-full md:w-8/12 px-4', 'w-full md:w-9/12 px-4', 'w-full md:w-10/12 px-4', 'w-full md:w-11/12 px-4', 'w-full px-4'];
      this.opts.colequal = [];
      this.opts.colsizes = [];
    } else if (this.opts.framework === 'foundation') {
      this.opts.row = 'row';
      this.opts.cols = ['large-1 columns', 'large-2 columns', 'large-3 columns', 'large-4 columns', 'large-5 columns', 'large-6 columns', 'large-7 columns', 'large-8 columns', 'large-9 columns', 'large-10 columns', 'large-11 columns', 'large-12 columns'];
      this.opts.colequal = [];
      this.opts.colsizes = [];
    } else if (this.opts.framework === 'material') {
      this.opts.row = 'mdl-grid';
      this.opts.cols = ['mdl-cell mdl-cell--1-col', 'mdl-cell mdl-cell--2-col', 'mdl-cell mdl-cell--3-col', 'mdl-cell mdl-cell--4-col', 'mdl-cell mdl-cell--5-col', 'mdl-cell mdl-cell--6-col', 'mdl-cell mdl-cell--7-col', 'mdl-cell mdl-cell--8-col', 'mdl-cell mdl-cell--9-col', 'mdl-cell mdl-cell--10-col', 'mdl-cell mdl-cell--11-col', 'mdl-cell mdl-cell--12-col'];
      this.opts.colequal = [];
      this.opts.colsizes = [];
    } else if (this.opts.framework === 'uikit') {
      this.opts.row = '';
      this.opts.cols = [];
      this.opts.colequal = [];
      this.opts.colsizes = [];
      this.opts.cellFormat = '<div class="uk-width-1-1"></div>';
      this.opts.rowFormat = '<div class="uk-grid"></div>';
    } else {
      // If framework param is not used
      if (this.opts.row !== '' && this.opts.cols.length > 0) {

        // Normal settings to define css grid frameworks => Use specified row & cols,
        // and optionally (if not 12 colus grid): colequel & colsizes.
      } else {
        if (this.opts.cellFormat === '' && this.opts.rowFormat === '') {
          this.useDefaultGrid = true; // used in columntool.js, grid.js & util.js

          // DEFAULT: Built-in simple css grid
          this.opts.row = 'row'; //row clrfx
          this.opts.cols = ['column twelfth', 'column eleventh', 'column tenth', 'column ninth', 'column eighth', 'column seventh', 'column sixth', 'column fifth', 'column fourth', 'column third', 'column half', 'column two-third', 'column two-fourth', 'column two-fifth', 'column two-sixth', 'column'];
          this.opts.colequal = [['column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth', 'column twelfth'], ['column eleventh', 'column eleventh', 'column eleventh', 'column eleventh', 'column eleventh', 'column eleventh', 'column eleventh', 'column eleventh', 'column eleventh', 'column eleventh', 'column eleventh'], ['column tenth', 'column tenth', 'column tenth', 'column tenth', 'column tenth', 'column tenth', 'column tenth', 'column tenth', 'column tenth', 'column tenth'], ['column ninth', 'column ninth', 'column ninth', 'column ninth', 'column ninth', 'column ninth', 'column ninth', 'column ninth', 'column ninth'], ['column eighth', 'column eighth', 'column eighth', 'column eighth', 'column eighth', 'column eighth', 'column eighth', 'column eighth'], ['column seventh', 'column seventh', 'column seventh', 'column seventh', 'column seventh', 'column seventh', 'column seventh'], ['column sixth', 'column sixth', 'column sixth', 'column sixth', 'column sixth', 'column sixth'], ['column fifth', 'column fifth', 'column fifth', 'column fifth', 'column fifth'], ['column fourth', 'column fourth', 'column fourth', 'column fourth'], ['column third', 'column third', 'column third'], ['column half', 'column half']];
          this.opts.colsizes = [
          //needed for columns in which the size increment is not constant.
          [
          //increment for 3 columns
          ['column third', 'column third', 'column third'], ['column half', 'column fourth', 'column fourth']], [
          //increment for 2 columns
          ['column sixth', 'column two-sixth'], ['column fifth', 'column two-fifth'], ['column fourth', 'column two-fourth'], ['column third', 'column two-third'], ['column half', 'column half'], ['column two-third', 'column third'], ['column two-fourth', 'column fourth'], ['column two-fifth', 'column fifth'], ['column two-sixth', 'column sixth']]];
        } else {

          // OTHERS: use cellFormat & rowFormat. ex. Foundation Email.
          // this.opts.cellFormat;
          // this.opts.rowFormat;
        }
      }
    }
    this.sortableObjects = [];

    // Experimental for iframe
    var win, doc;
    if (this.iframe) {
      win = this.iframe.contentWindow;
      var iframeDocument = this.iframe.contentDocument || this.iframe.contentWindow.document;
      doc = iframeDocument;
      this.iframeDocument = iframeDocument;
    } else {
      win = window;
      doc = document;
    }
    this.win = win;
    this.doc = doc;
    this.doc.body.classList.add('data-editor');
    if (this.canvas && !this.isContentBox && this.docContainer && !this.iframe) {
      var docContainer = document.querySelector(this.docContainer);
      docContainer.classList.add('is-page');
    }

    // Disable on mobile
    var viewportWidth = this.doc.body.clientWidth;
    if (viewportWidth <= 768) {
      this.hideImageResizer = true;
    }
    var dom = new Dom(this);
    this.dom = dom;
    var util = new Util(this); // General utilities
    this.util = util;
    if (!this.pageTemplate) {
      this.pageTemplate = util.getPageTemplate(this.framework);
    }
    var responsive = new contentbuilder_responsive(this); // General utilities
    this.responsive = responsive;

    // Content stuff
    if (this.iframe) {
      var contentStuff = doc.querySelector('.content-stuff');
      if (!contentStuff) {
        contentStuff = document.createElement('div');
        contentStuff.className = 'content-stuff is-ui';
        contentStuff.id = '_cbhtml';
        doc.body.appendChild(contentStuff);
      }
      this.contentStuff = contentStuff;
      this.stuff = new contentstuff(this);
    }
    this.isTouchSupport = util.isTouchSupport();
    this.isIE = util.detectIE();
    if (this.opts.clearPreferences) {
      util.clearPreferences();
    }
    this.uoTm = null;
    this.uo = new undoredo(this);
    this.cbDom = dom;
    this.autoclean = false;
    this.filesAdded = '';
    if (this.opts.emailMode) {
      this.applyStyle('emailmode', '.is-builder > div {display: block}');
    }
    var builderStuff = document.querySelector('#_cbhtml'); // All editing controls will be placed within <div id="_cbhtml">...</div>
    if (!builderStuff) {
      builderStuff = this.dom.createElement('div');
      builderStuff.id = '_cbhtml';
      builderStuff.className = 'is-ui';
      this.dom.appendChild(document.body, builderStuff);
    }
    this.builderStuff = builderStuff;
    this.htmlutil = new contentbuilder_html(this);
    this.initStyle();
    svgicons(this); // Prepare icons (embed svg definitions for icons) 

    if (!this.controlPanel) this.preferences = new preferences(this); // this will also call setUIColor() and getUIStyles() for theme
    else {
      if (localStorage.getItem('_theme') != null) {
        var n = localStorage.getItem('_theme');
        this.themeIndex = n;
        if (this.themes) {
          if (this.themes.length > 0) {
            var item = this.themes[n];
            if (item) {
              this.setUIColor(item[1], item[2]);
              this.renderIframeLater = true;
            }
          }
        }
      } else {
        this.setUIColor('', '');
        this.renderIframeLater = true;
      }
      if (!this.renderIframeLater) {
        // means setUIColor() not called, so we need to call getUIStyles() manually
        util.getUIStyles();
      }
    }
    grideditor(this); // Render Grid Editor

    // Get all builder areas
    this.preview = false;
    var builders = this.doc.querySelectorAll(this.opts.container);
    Array.prototype.forEach.call(builders, function (builder) {
      builder.classList.add('is-container');

      // Check if preview
      if (_this.dom.hasClass(builder, 'preview')) _this.preview = true;
    });
    if (!this.preview) {
      if (this.opts.snippetJSON) if (this.opts.snippetJSON.snippets.length > 0) {
        snippetpanel(this); // Render Snippet Panel
      }
    }

    this.colTool = new columntool(this); // Render Column Tool

    this._rowTool = new rowtool(this);
    this.livePreview = new livepreview(this);
    this.mediaPicker = new mediapicker(this);

    // Extend the onChange function
    var oldget = this.opts.onChange;
    this.opts.onChange = function () {
      var ret = oldget.apply(_this, _arguments);
      if (_this.activeCol) {
        // Quick reposition column tool
        _this.util.repositionColumnTool();
      }
      _this.elmTool.repositionElementTool(true);
      if (_this.element.image.imageTool) _this.element.image.imageTool.style.display = '';
      if (_this.element.module.moduleTool) _this.element.module.moduleTool.style.display = '';
      if (_this.element.hyperlink.linkTool) _this.element.hyperlink.linkTool.style.display = '';
      _this.colTool.lockIndicator.style.display = '';
      return ret;
    };

    // freeform
    var oldOnBlockCanvasAdd = this.opts.onBlockCanvasAdd;
    this.opts.onBlockCanvasAdd = function () {
      var ret = oldOnBlockCanvasAdd.apply(_this, _arguments);
      if (_this.eb) _this.eb.refresh();
      return ret;
    };
    var oldOnUndo = this.opts.onUndo;
    this.opts.onUndo = function () {
      var ret = oldOnUndo.apply(_this, _arguments);
      if (_this.eb) {
        _this.eb.refresh();
        _this.rte.hideBlockButtons();
        _this.rte.positionToolbar();
      }
      return ret;
    };
    var oldOnRedo = this.opts.onRedo;
    this.opts.onRedo = function () {
      var ret = oldOnRedo.apply(_this, _arguments);
      if (_this.eb) {
        _this.eb.refresh();
        _this.rte.hideBlockButtons();
        _this.rte.positionToolbar();
      }
      return ret;
    };
    var htmlCommons = "\n            <div class=\"is-modal fileselect\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"width:".concat(this.fileSelectWidth, ";max-width:").concat(this.fileSelectMaxWidth, ";height:").concat(this.fileSelectHeight, ";padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100%;height:100%;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n            <div class=\"is-modal otherselect\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"width:").concat(this.otherSelectWidth, ";max-width:").concat(this.otherSelectMaxWidth, ";height:").concat(this.otherSelectHeight, ";padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100%;height:100%;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n            <div class=\"is-modal videoselect\" style=\"z-index:10005\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div style=\"width:").concat(this.videoSelectWidth, ";max-width:").concat(this.videoSelectMaxWidth, ";height:").concat(this.videoSelectHeight, ";padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100%;height:100%;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n            <div class=\"is-modal imageselect\" style=\"z-index:10005\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div style=\"width:").concat(this.imageSelectWidth, ";max-width:").concat(this.imageSelectMaxWidth, ";height:").concat(this.imageSelectHeight, ";padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100%;height:100%;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n            <div class=\"is-modal mediaselect\" style=\"z-index:10005\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div style=\"width:").concat(this.mediaSelectWidth, ";max-width:").concat(this.mediaSelectMaxWidth, ";height:").concat(this.mediaSelectHeight, ";padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100%;height:100%;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n            <div class=\"is-modal audioselect\" style=\"z-index:10005\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div style=\"width:").concat(this.audioSelectWidth, ";max-width:").concat(this.audioSelectMaxWidth, ";height:").concat(this.audioSelectHeight, ";padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100%;height:100%;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n            <div class=\"is-modal snippets\" tabindex=\"-1\" role=\"dialog\" aria-modal=\"true\" aria-hidden=\"true\">\n                <div class=\"is-modal-content\" style=\"max-width:1500px;width:80vw;height:80vh;padding:0;\">\n                    <iframe tabindex=\"0\" style=\"width:100%;height:100%;border: none;display: block;\" src=\"about:blank\"></iframe>\n                </div>\n            </div>\n        ");
    dom.appendHtml(builderStuff, htmlCommons);
    this.elmTool = new elementtool(this); // Render Element Tool

    // Render controls or behavior for handling element editing
    this.element = new contentbuilder_elements(this);
    this.rte = new rte(this);
    this.tooltip = new tooltip(this);
    this.lightbox = new lightbox(this);
    if (!this.preview) this.applyBehavior(); // Apply editing behavior on content (builder areas)

    // Load plugins
    if (!this.preview) {
      if (this.opts.plugins.length > 0) {
        // Option to load plugins without config.js => just use plugins param (and specify the pluginPath).

        this.loadPlugins();
      } else {
        if (typeof this.opts.scriptPath === 'undefined' && this.opts.pluginPath === '') {

          //Do Nothing
        } else {
          // Backward compatibility

          if (!this.opts.disableConfig) {
            var scriptUrl = this.opts.scriptPath + 'config.js';
            if (this.opts.pluginPath !== '') scriptUrl = this.opts.pluginPath + 'config.js'; // overide plugin location if pluginPath is specified
            this.loadScript(scriptUrl).then(function () {
              if (_this.opts.plugins.length > 0) {
                _this.loadPlugins();
              }
            }, function () {
              console.log('Fail to load config');
            });
          }
        }
      }
    }

    // Tooltip (move to after plugins loaded)
    // new Tooltip();

    // Run Tabs
    this.tabs = new tabs();

    // Color Picker
    this.colorPicker = new contentbuilder_colorpicker({
      lang: this.opts.lang,
      colors: this.opts.colors
    });

    // Shortcut Info
    this.ShortcutInfo = new shortcutinfo(this);

    // Prompt Stuff
    if (!this.opts.isContentBox) {
      if (localStorage.getItem('_dictation') !== null) {
        localStorage.removeItem('_dictation');
      }
    }
    this.dictation = new dictation({}, this); // Dictation Panel 
    this.lib = new lib(this); // Libraries of common editing functions
    this.similarity = new similarity(this);
    if (!this.opts.isContentBox) {
      this.command = new command(this);
      if (this.startAIAssistant) {
        this.openAIAssistant();
      }
    }

    // freeform
    if (this.canvas && !this.isContentBox) this.blockmodal = new blockmodal(this);
    if (this.canvas) this.pageoption = new pagesize(this);

    // freeform
    if (this.canvas) this.eb = new editableblocks({
      doc: this.doc,
      win: this.win,
      selector: '.is-block',
      controlSelector: '.is-tool,.is-pop,.is-modal,#divImageResizer,.is-rte-tool,.is-elementrte-tool,.is-rte-pop,.is-side,.keep-selection',
      parentSelector: '.box-canvas',
      rotate: true,
      // disableOnMobile: 760,
      zoom: this.opts.zoom,
      onBeforeChange: function onBeforeChange() {
        _this.uo.saveForUndo();
      },
      onChange: function onChange() {
        _this.opts.onChange();
      },
      onEditStart: function onEditStart(event, block) {
        var activeBlock = _this.doc.querySelector('.is-block.cloned');
        if (!activeBlock) return;
        var container = activeBlock.querySelector('.is-container');
        if (!container) return;
        block.classList.add('editable');

        // get element to activate
        var x = event.clientX;
        var y = event.clientY;
        var cols = _this.getAllColumns(container);
        var clickedElm;
        var clickedCol;
        cols.forEach(function (col) {
          var elms = col.children;
          for (var i = 0; i < elms.length; i++) {
            var _rect = elms[i].getBoundingClientRect();
            if (x >= _rect.left && x <= _rect.right && y >= _rect.top && y <= _rect.bottom) {
              clickedElm = elms[i];
            }
          }
          var rect = col.getBoundingClientRect();
          if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
            clickedCol = col;
          }
        });
        if (clickedElm) {
          var tagName = clickedElm.tagName.toLowerCase();
          if (tagName !== 'img') _this.eb.placeCursorAtEnd(clickedElm);
          setTimeout(function () {
            clickedElm.click();
          }, 1); // give time for the placeCursorAtEnd
        } else if (clickedCol) {
          clickedCol.click();
        }
      },
      onEditEnd: function onEditEnd(block) {
        block.classList.remove('editable');
        _this.util.clearActiveCell();
        _this.util.clearPops();
        _this.hideElementTools();
      },
      onDuplicate: function onDuplicate(block) {
        var builder = block.querySelector(_this.container);
        var html = '';
        if (builder) {
          html = _this.readHtml(builder);
        }
        var clonedDiv = block.cloneNode(true);
        clonedDiv.style.top = '20%';
        clonedDiv.style.left = '20%';
        if (builder) {
          var cloneBuilder = clonedDiv.querySelector(_this.container);
          cloneBuilder.innerHTML = '';
          block.parentNode.appendChild(clonedDiv);
          var range = document.createRange();
          cloneBuilder.appendChild(range.createContextualFragment(html));
          _this.applyBehaviorOn(cloneBuilder);
          cloneBuilder.click();
        } else {
          block.parentNode.appendChild(clonedDiv);
        }
        block.classList.remove('active');
        _this.doc.querySelectorAll('.clone').forEach(function (elm) {
          return elm.parentNode.removeChild(elm);
        });
        _this.doc.querySelectorAll('.cloned').forEach(function (elm) {
          return elm.classList.remove('cloned');
        });
      },
      onAddBlock: function onAddBlock(block) {
        var builder = block.querySelector(_this.container);
        if (builder) _this.applyBehaviorOn(builder);
      },
      onMultipleSelect: function onMultipleSelect() {
        if (_this.onMultipleSelect) _this.onMultipleSelect();
        if (!_this.controlPanel) {
          setTimeout(function () {
            _this.rte.rteTool.style.display = 'none';
            _this.rte.elementRteTool.style.display = 'flex';
            _this.rte.hideAlignButtons();
            _this.rte.hideBlockButtons();

            // group/ungroup
            var elms = _this.rte.elementRteTool.querySelectorAll('.rte-group');
            Array.prototype.forEach.call(elms, function (elm) {
              elm.style.display = '';
            });
            elms = _this.rte.elementRteTool.querySelectorAll('.rte-delete');
            Array.prototype.forEach.call(elms, function (elm) {
              elm.style.display = '';
            });
            _this.rte.positionToolbar();
          }, 10);
        }
      },
      onDelete: function onDelete() {
        if (_this.onDelete) _this.onDelete();
        if (!_this.controlPanel) {
          _this.rte.hideBlockButtons();
          _this.rte.positionToolbar();
        }
      },
      onSelectBlock: function onSelectBlock(block) {
        if (_this.onSelectBlock) _this.onSelectBlock(block);
        if (block.classList.contains('editable')) return;
        if (_this.controlPanel) return;
        _this.rte.rteTool.style.display = 'none';
        _this.rte.elementRteTool.style.display = 'flex';
        _this.rte.hideAlignButtons();
        var elms = _this.rte.elementRteTool.querySelectorAll('.rte-duplicate');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.style.display = '';
        });
        elms = _this.rte.elementRteTool.querySelectorAll('.rte-moveup');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.style.display = '';
        });
        elms = _this.rte.elementRteTool.querySelectorAll('.rte-movedown');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.style.display = '';
        });
        elms = _this.rte.elementRteTool.querySelectorAll('.rte-delete');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.style.display = '';
        });
        // elms = this.rte.elementRteTool.querySelectorAll('.rte-blocksettings'); 
        // Array.prototype.forEach.call(elms, (elm) => {
        //     elm.style.display = '';
        // });

        var viewportWidth = _this.doc.body.clientWidth;
        if (viewportWidth <= 768) {
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-moveup');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = '';
          });
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-movedown');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = '';
          });
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-front');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = 'none';
          });
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-backward');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = 'none';
          });
        } else {
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-moveup');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = 'none';
          });
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-movedown');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = 'none';
          });
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-front');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = '';
          });
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-backward');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = '';
          });
        }

        // group/ungroup
        elms = _this.rte.elementRteTool.querySelectorAll('.rte-group');
        Array.prototype.forEach.call(elms, function (elm) {
          elm.style.display = 'none';
        });
        if (block.classList.contains('is-group')) {
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-ungroup');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = '';
          });
        } else {
          elms = _this.rte.elementRteTool.querySelectorAll('.rte-ungroup');
          Array.prototype.forEach.call(elms, function (elm) {
            elm.style.display = 'none';
          });
        }
        _this.rte.positionToolbar();
      },
      onUnselectBlock: function onUnselectBlock() {
        if (_this.onUnselectBlock) _this.onUnselectBlock();
      }
    });

    // SHIFT + Right Clidk to Zoom In
    if (this.canvas && !this.isContentBox && this.docContainer && !this.iframe) {
      //--- see loadHtml ---
      var _docContainer = document.querySelector(this.docContainer);

      // set page size 
      var s;
      var elm = _docContainer.querySelector('[data-pagesize]');
      if (elm) {
        s = elm.getAttribute('data-pagesize');
      } else {
        if (localStorage.getItem('_pagesize') === '' || localStorage.getItem('_pagesize')) {
          s = localStorage.getItem('_pagesize');
        } else {
          s = this.pageSize || '';
        }
      }
      this.setPageSize(s);
      this.applyBehaviorCanvas();
      var _builders = _docContainer.querySelectorAll(this.container);
      _builders.forEach(function (builder) {
        _this.applyBehaviorOn(builder);
      });
      this.refresh();
      if (this.win.Block) {
        this.win.Block.render();
      }
      _docContainer.style.opacity = '';
      //--- /see loadHtml ---

      // docContainer.style.transform = '';
      // this.opts.zoom = 1;
      // this.eb.setZoom(1);

      document.addEventListener('contextmenu', this.toggleEnlargePage = function (e) {
        if (e.shiftKey && e.button === 2) {
          e.preventDefault();
          if (_docContainer.style.transform.includes('scale(1)')) {
            _docContainer.style.transform = '';
          }
          if (_docContainer.classList.contains('expand')) {
            // back (zoom-out)
            _docContainer.classList.remove('expand');
            _docContainer.style.transform = '';
            _this.opts.zoom = 1;
            localStorage.setItem('_zoom', 1);
            _this.eb.setZoom(1);
            _this.setZoomOnControl(_docContainer);
          } else {
            // expand (zoom-in)
            _docContainer.classList.add('expand');
            var _viewportWidth = document.body.clientWidth;
            var targetWidth = _viewportWidth * 0.8;
            var box = _docContainer.querySelector(_this.blockContainer);
            if (box) {
              var scale = targetWidth / box.offsetWidth;
              if (scale > 1.4) scale = 1.4;
              _docContainer.style.transform = "scale(".concat(scale, ")");
              _this.opts.zoom = scale;
              localStorage.setItem('_zoom', scale);
              _this.eb.setZoom(scale);
              _this.setZoomOnControl(_docContainer);
            }
          }
        }
      });
    }
    var previousWidth = this.win.innerWidth;
    var timer;
    var debounce = function debounce(func, delay) {
      return function () {
        clearTimeout(timer);
        timer = setTimeout(function () {
          func.apply(_this, _arguments);
        }, delay);
      };
    };
    if (this.iframe) {
      // this.win.addEventListener('scroll', this.doWindowScroll = ()=>{
      //     this.util.hidePops();
      // });

      var previousScroll = this.win.pageYOffset;
      this.win.addEventListener('scroll', this.doWindowScroll = function () {
        // this.util.hidePops();
        var threshold = 5; // Hide pops if page is scrolled more than 5px
        var debouncedResizeHandler = debounce(function () {
          if (Math.abs(previousScroll - _this.win.pageYOffset) > threshold) {
            _this.util.hidePops();
            // let clearPops = true;
            // let screenMode = this.screenMode;
            // if(screenMode==='fullview') {
            //     if(window.innerWidth<1366) {
            //         clearPops=false;
            //     }
            // }
            // if(clearPops) {
            //     this.util.hidePops();
            // }
          }

          previousScroll = _this.win.pageYOffset;
        }, 10);
        debouncedResizeHandler();
      });
      this.win.addEventListener('resize', this.doWindowResize = function () {
        var threshold = 100;
        var debouncedResizeHandler = debounce(function () {
          if (Math.abs(previousWidth - _this.win.innerWidth) > threshold) {
            // console.log('clear');
            _this.util.clearPops();
            // let clearPops = true;
            // let screenMode = this.screenMode;
            // if(screenMode==='fullview') {
            //     if(window.innerWidth<1366) {
            //         clearPops=false;
            //     }
            // }
            // if(clearPops) {
            //     this.util.clearPops();
            // }
          }

          previousWidth = _this.win.innerWidth;

          // Disable on mobile
          var viewportWidth = _this.doc.body.clientWidth;
          if (viewportWidth <= 768) {
            _this.hideImageResizer = true;
          }

          // console.log('resize');
          setTimeout(function () {
            // if(this.blockmodal) this.blockmodal.realtime(); // freeform
            if (_this.onPageResizeDebounce) _this.onPageResizeDebounce();
          }, 300); // give time for block transition
        }, 200);
        debouncedResizeHandler();
        if (_this.canvas) {
          _this.eb.addBreakpoint(); // freeform
          if (_this.onPageResize) _this.onPageResize();
        }
      });
    } else {
      if (this.canvas) this.win.addEventListener('resize', this.doWindowResize = function () {
        // freeform

        var debouncedResizeHandler = debounce(function () {
          // console.log('resize');
          setTimeout(function () {
            // if(this.blockmodal) this.blockmodal.realtime();
            if (_this.onPageResizeDebounce) _this.onPageResizeDebounce();
          }, 300); // give time for block transition
        }, 200);
        debouncedResizeHandler();
        _this.eb.addBreakpoint();
        if (_this.onPageResize) _this.onPageResize();
      });
    }
    if (this.canvas) this.eb.addBreakpoint(); // freeform

    var rteClick = function rteClick(e) {
      var target = e.target;
      if (!target) return;
      var inputFocused = document.activeElement.tagName.toLowerCase() === 'input';
      if (!inputFocused && (_this.rte.rteMoreOptions.style.display === 'flex' || _this.rte.elementRteMoreOptions.style.display === 'flex')) {
        if (_this.rte.rteMoreOptions.style.display === 'flex') {
          var rte = target.closest('.rte-more, .rte-more-options, .is-rte-pop, .is-modal');
          if (!rte) {
            _this.rte.rteMoreOptions.style.display = '';
            dom.removeClass(_this.rte.rteMoreOptions, 'active');
            dom.addClass(_this.rte.rteMoreOptions, 'deactive');
          }
        }
        if (_this.rte.elementRteMoreOptions.style.display === 'flex') {
          var _rte = target.closest('.rte-more, .elementrte-more-options, .is-rte-pop, .is-modal');
          if (!_rte) {
            _this.rte.elementRteMoreOptions.style.display = '';
            dom.removeClass(_this.rte.elementRteMoreOptions, 'active');
            dom.addClass(_this.rte.elementRteMoreOptions, 'deactive');
          }
        }
      }
    };

    // Add document Click event
    document.addEventListener('click', this.doDocumentClick = function (e) {
      var target = e.target;
      if (!target) return;
      rteClick(e);
      var rowClicked;
      if (target.parentNode && target.parentNode.classList) rowClicked = target.parentNode.classList.contains('is-builder');
      var containerClicked = target.classList.contains('is-builder');
      var a = target.closest('.is-builder') || target.closest('.is-block'); // freeform
      var p = target.closest('.is-subblock');
      var b = target.closest('.is-modal') || target.closest('.keep-selection');
      var c = target.closest('.is-side') || target.closest('.is-sidebar');
      var d = target.closest('.is-pop');
      var f = target.closest('.is-tool');
      var g = target.closest('.is-rte-tool') || target.closest('.is-elementrte-tool');
      var h = target.closest('.is-rte-pop');
      var i = target.closest('.row-add-initial');
      var j = target.closest('.sl-wrapper') || target.closest('.sl-overlay') || target.closest('.sl-close');
      var k = target.closest('.is-selectbox') || target.closest('.is-selectbox-options');
      var isSpecialElement = false;
      if (_this.opts.specialElementClasses) {
        for (var _i = 0; _i < _this.opts.specialElementClasses.length; _i++) {
          isSpecialElement = target.closest('.' + _this.opts.specialElementClasses[_i]);
        }
      }
      var o;
      if (_this.preserveSelection) o = true;

      // dropdown
      if (!k) {
        var dropdowns = document.querySelectorAll('.is-selectbox-options');
        Array.prototype.forEach.call(dropdowns, function (dropdown) {
          dropdown.style.display = 'none';
        });
      }
      var clrPicker = document.querySelector('.clr-picker.clr-open');
      // if(clrPicker) return;

      // Image Resizer
      var n = target.closest('#divImageResizer');
      if (n) return;

      /*
      let m = target.closest('#divImageTool');
      
      let resizeProcess = false;
      let imageResizer = document.querySelector('#divImageResizer');
      if(imageResizer) if(imageResizer.getAttribute('data-resized')==='1') resizeProcess = true;
      if(resizeProcess) return; // to prevent unwanted click/clearActiveCell during image resize end.
       if(!(b||j||m||n||target.tagName.toLowerCase() === 'img')) {
                  let imageTool = document.querySelector('#divImageTool');
          if(imageTool) imageTool.style.display = '';
          // this.activeImage =  null; // Commented => Additional (to prevent lost focus)
               let imageResizer = document.querySelector('#divImageResizer');
          imageResizer.style.display = 'none';
          
          // moveable
          imageResizer.style.top = '-10px';
          imageResizer.style.left = '-10px';
          imageResizer.style.width = '1px';
          imageResizer.style.height = '1px';
          if(this.moveable) {
              this.moveable.updateRect();
              document.querySelector('.moveable-control-box').style.display = 'none'; 
          }
      }
      */

      if (!(a || p || b || c || d || f || g || h || i || j || o || isSpecialElement || clrPicker) || rowClicked && !i || containerClicked) {
        // Click anywhere but is not inside builder area, modal, popup, tool or rte, then clear row/column (cell) selection

        if (!_this.dom.getSelected()) {
          var inputFocused = document.activeElement.tagName.toLowerCase() === 'input';

          // if(!document.querySelector('.is-modal.active')) { // Additional (to prevent lost focus)
          var openedModal = document.querySelector('.is-modal.active:not(.is-modal-content)');
          if (!openedModal && !inputFocused) {
            // Additional (to prevent lost focus)

            util.clearActiveCell();
            util.clearControls();
            if (!target.closest('.is-block')) _this.rte.hideBlockButtons(); // freeform

            if (!_this.controlPanel) if (_this.toolbarDisplay !== 'auto') {
              _this.rte.showDefaultToolbar();
            }
            if (_this.settings.onSelectionChange) _this.settings.onSelectionChange(e);
            _this.activeIcon = null;
            _this.activeSvg = null;
            _this.inspectedElement = null;
            _this.activeElement = null;
            _this.activeImage = null;
            _this.activeAudio = null;
            _this.activeButton = null;
            _this.activeLink = null;
            _this.activeCodeBlock = null;
            _this.activeIframe = null;
            _this.activeModule = null;
            _this.activeSpacer = null;
            _this.activeTable = null;
            _this.activeTd = null;
            _this.activeVideo = null;

            // if(this.settings.onPageContentClick) this.settings.onPageContentClick(e);
          }
        }

        /*
        this.element.hyperlink.buttonEditor.hide();
        */
      }

      /*
      // Button Modal
      if(!this.activeLinkButton && !this.activeButton && 
          !target.closest('.buttoneditor') && !target.closest('.link-button-edit') && 
          !target.closest('.is-modal')) {
           this.element.hyperlink.buttonEditor.hide();
      }
      */

      /*
      // Backward compatibility (for examples)
      if(!d && !this.dom.parentsHasId(target, '_cbhtml')) {
          const pops = document.querySelectorAll('.is-pop');
          Array.prototype.forEach.call(pops, (pop) => {
              if(!this.dom.parentsHasId(pop, '_cbhtml')) pop.style.display = '';
          });
      }
      */
    });

    if (this.iframe) {
      this.doc.addEventListener('click', this.doDocumentClick);
    }

    // Drag row will hide content tools
    this.doc.addEventListener('mousedown', this.doDocumentMousedown = function (e) {
      e = e || window.event;
      var target = e.target || e.srcElement;
      var a = _this.dom.parentsHasClass(target, 'row-handle');
      if (a) {
        util.clearControls();
      }
    });

    // Undo Redo
    document.addEventListener('keydown', this.doDocumentKeydown = function (e) {
      if (e.which === 90 && (e.ctrlKey || e.metaKey)) {
        //CTRL-Z
        if (e.shiftKey) _this.uo.doRedo();else {
          if (!e.altKey) {
            //if(!document.queryCommandEnabled('undo')){
            _this.uo.doUndo();
            //}
          }
        }
      }

      if (e.which === 89 && e.ctrlKey) {
        //CTRL-Y
        if (!e.altKey) _this.uo.doRedo();
      }
      var isCmd = e.ctrlKey || e.metaKey;
      if (isCmd && e.which === 191) {
        // CMD+/
        _this.ShortcutInfo.open();
      }
      var isAPressed = e.key === 'a' || e.key === 'A';
      if (isCmd && isAPressed) {
        // CMD-A or CTRL-A
        if (_this.canvas && _this.docContainer) {
          if (document.activeElement.tagName.toLowerCase() === 'body' || _this.doc.activeElement.tagName.toLowerCase() === 'body' || document.activeElement.classList.contains('is-design-list')) {
            var blocks = _this.doc.querySelectorAll('.is-block');
            blocks.forEach(function (block) {
              block.classList.add('active');
              if (blocks.length > 1) {
                block.classList.add('multi');
              }
            });
            e.preventDefault();
            if (blocks.length > 0 && _this.eb.onMultipleSelect) _this.eb.onMultipleSelect();
          }
        }
      }
    });

    // this.uo.saveForUndo(); //First time

    if (this.iframe) {
      this.doc.addEventListener('keydown', this.doDocumentKeydown);
    }

    // https://stackoverflow.com/questions/4860936/how-to-remove-the-resizig-handlers-around-an-image-in-ie-with-javascript
    document.body.addEventListener('mscontrolselect', function (e) {
      e.preventDefault();
    });

    // Convenience variable for outside access, for example, from snippet dialog (assets/minimalist-blocks/snippets.html))
    window._cb = this;
    window.applyLargerImage = this.applyLargerImage.bind(this);
    window.returnUrl = this.returnUrl.bind(this); // same as applyLargerImage (NEW)
    window.selectFile = this.selectFile.bind(this);
    window.selectImage = this.selectImage.bind(this);
    window.selectVideo = this.selectVideo.bind(this);
    window.selectAsset = this.selectAsset.bind(this);
    window.assetType = this.assetType.bind(this);
    window.hideModal = this.hideModal.bind(this);
    window.generateImage = this.generateImage.bind(this);
    setTimeout(function () {
      // Remember UI
      if (localStorage.getItem('_livepreview') != null) {
        _this.openPreview();
      } else {
        if (_this.opts.livePreviewOpen) {
          _this.openPreview();
        }
      }
    }, 300);

    // info
    var largeScreenBreakpoint = 1280; //1920
    largeScreenBreakpoint = window.innerWidth - 360; //351
    if (largeScreenBreakpoint < 1280) largeScreenBreakpoint = 1280;
    if (this.consoleLog) {
      console.log('vw: ' + window.innerWidth);
      console.log('lg: ' + largeScreenBreakpoint);
    }
  } // constructor

  // Convenience constructor, so that the plugin can be called directly using: ContentBuilder.run({ ... });
  contentbuilder_createClass(ContentBuilder, [{
    key: "initStyle",
    value: function initStyle() {
      // Add special css (remove on destroy)
      // This is also for backward compatible if using npm but still using old local assets/css
      this.dom.appendHtml(this.doc.head, "<style id=\"_contentbuilder_css\">\n\n        /* box-canvas */\n        :root {\n            --is-outline: 1px solid rgb(96 108 255 / 65%);\n            --is-handle: 1px solid  rgb(121 131 255);\n        \n            --is-outline2: 1px solid  rgba(255, 1, 107, 0.65);\n            --is-handle2: 1px solid rgb(253 83 154); \n        }\n        \n        .editableblocks .is-block {\n            cursor: pointer;\n            user-select: none;\n            touch-action: none;\n            outline: none;\n        }\n        .editableblocks .is-block:not(.is-group):not(.editable):after {\n            position: absolute;\n            content: \"\";\n            display: block;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            opacity: 0;\n            z-index: 1;\n        }\n        .is-block.active {\n            outline: var(--is-outline);\n        }\n        .is-block.active.editable {\n            outline: none;\n            cursor: auto;\n            z-index: 10;\n        }\n        .is-block.active.multi {\n            outline: var(--is-outline);\n        }\n        .is-block.is-shape.active.multi {\n            outline: var(--is-outline2);\n        }\n        .is-block.is-shape.active:not(.multi) {\n            outline: none;\n        }\n        .is-block.is-shape {\n            transform-origin: 0 0 !important;\n            -webkit-transform-origin: 0 0;\n            -moz-transform-origin: 0 0;\n            -o-transform-origin: 0 0;\n        }\n        .block-active {\n            background-color: #f5f6f7c7;\n        }\n        \n        /* Ruler */\n        .ruler {\n            position: absolute;\n            background-color:  rgba(157, 155, 255, 0.4);\n            z-index: 1;\n        }\n        .horizontal-ruler {\n            width: 100%;\n            height: 2px;\n            top: -1000px;\n            left: 0;\n        }\n        .vertical-ruler {\n            width: 2px;\n            height: 100%;\n            top: 0;\n            left: -1000px;\n        }\n        \n        /* Resize Handles */\n        .handle {\n            width: 8px;\n            height: 8px;\n            position: absolute;\n            cursor: pointer;\n            display: none;\n        \n            background-color: #fff;\n            outline: var(--is-handle);\n        }\n        .is-block.active > .handle {\n            display: block;\n            z-index: 2;\n        }\n        .is-block.active.editable > .handle {\n            display: none;\n        }\n        .is-block.active.multi .handle {\n            display: none;\n        }\n        .top-left,\n        .top-right,\n        .bottom-left,\n        .bottom-right,\n        .top, .bottom, .left, .right {\n            z-index: 1;\n        }\n        .top-left {\n            top: -4px;\n            left: -4px;\n            cursor: nwse-resize;\n        }\n        .top-right {\n            top: -4px;\n            right: -4px;\n            cursor: nesw-resize;\n        }\n        .bottom-left {\n            bottom: -4px;\n            left: -4px;\n            cursor: nesw-resize;\n        }\n        .bottom-right {\n            bottom: -4px;\n            right: -4px;\n            cursor: nwse-resize;\n        }\n        .top {\n            top: -4px;\n            left: calc(50% - 4px);\n            cursor: ns-resize;\n        }\n        .bottom {\n            bottom: -4px;\n            left: calc(50% - 4px);\n            cursor: ns-resize;\n        }\n        .left {\n            top: calc(50% - 4px);\n            left: -4px;\n            cursor: ew-resize;\n        }\n        .right {\n            top: calc(50% - 4px);\n            right: -4px;\n            cursor: ew-resize;\n        }\n        \n        /* Rotate handle */\n        .rotate-handle {\n            width: 8px;\n            height: 8px;\n            position: absolute;\n            top: calc(50% - 4px);\n            right: -33px;\n            cursor: ew-resize;\n            display: none;\n            cursor: grab;\n            z-index: 2;\n        \n            background-color: #fff;\n            outline: var(--is-handle);\n        }\n        .rotate-handle div {\n            width: 25px;\n            height: 1px;\n            border-top: var(--is-outline);\n            right: 8px;\n            top: calc(50% - 0px);\n            position: absolute;\n            pointer-events: none;\n        }\n        .is-block.active > .rotate-handle {\n            display: block;\n        }\n        .is-block.active.editable .rotate-handle  {\n            display: none;\n        }\n        .is-block.is-group.active > .rotate-handle {\n            display: none;\n        }\n        .is-block.active.multi .rotate-handle {\n            display: none;\n        }\n        \n        /* Shape handles */\n        .shape-handle {\n            width: 8px;\n            height: 8px;\n            position: absolute;\n            display: none;\n            transform: none;\n            z-index: 1;\n            /*backface-visibility: hidden;  Improve rendering during transformation */\n        \n            background-color: #fff;\n            outline: var(--is-handle2);\n        }\n        .shape-handle.top-left {\n            transform: translate(-4px, -4px);\n        }\n        .shape-handle.top-right {\n            transform: translate(-4px, -4px);\n        }\n        .shape-handle.bottom-left {\n            transform: translate(-4px, -4px);\n        }\n        .shape-handle.bottom-right {\n            transform: translate(-4px, -4px);\n        }\n        .shape-handle.rotate {\n            transform: translate(-4px, -4px);\n            cursor: grab;\n        }\n        .shape-line {\n            width: 0px;\n            height: 1px;\n            position: absolute;\n            transform-origin: 0 0;\n            border-top: var(--is-outline2);\n            display: none;\n            z-index: 1;\n            pointer-events: none;\n            backface-visibility: hidden; /* Improve rendering during transformation */\n        }\n        \n        .is-shape > .rotate-handle,\n        .is-shape > .handle,\n        .is-shape > .handle.left, .is-shape  >.handle.top, .is-shape > .handle.right, .is-shape > .handle.bottom {\n            display: none !important;\n        }\n        \n        .is-block.clone {\n            z-index:10000;\n            background-color: transparent !important;\n            background: none !important;\n        }\n        .is-block.clone .is-container,\n        .is-block.clone .is-block-overlay {\n            opacity:0;\n        }\n        .is-block.cloned {\n            outline:none;\n        }\n        .is-block.cloned .handle, \n        .is-block.cloned .rotate-handle {\n            display:none;\n        }\n        \n        @media (max-width: 760px) {\n            .is-box.autolayout .is-block > .rotate-handle,\n            .is-box.autolayout .is-block > .handle {\n            display: none;\n            }\n        \n            /* NEW */\n            .is-block.clone {\n                display:none;\n            }\n            .is-block.cloned {\n                outline: var(--is-outline);\n            }\n        }\n        \n        .is-block.locked .handle,\n        .is-block.locked .rotate-handle {\n            display: none !important;\n        }\n          \n          \n        \n        /* Canvas Mode */\n        .box-canvas > .sortable-ghost {\n            background: transparent;\n            outline: rgba(140, 140, 140, 0.5) 4px dashed !important;\n            outline-offset: -15px;\n            height:100% !important;\n            transition: none !important;\n            z-index:100;\n            position:absolute;\n        }\n        </div>\n        ");
    }
  }, {
    key: "getAllColumns",
    value: function getAllColumns(container) {
      var arrCells = [];
      var rows = container.children;
      for (var i = 0; i < rows.length; i++) {
        var cols = rows[i].children;
        for (var j = 0; j < cols.length; j++) {
          var col = cols[j];
          if (col.classList.contains('is-row-tool') || col.classList.contains('is-col-tool') || col.classList.contains('is-rowadd-tool') || col.classList.contains('is-row-overlay')) {
            // Do Nothing
          } else {
            arrCells.push(col);
          }
        }
      }
      return arrCells;
    }
  }, {
    key: "setZoom",
    value: function setZoom() {
      var _this2 = this;
      // Complete (On Area + On Control)

      if (this.opts.page !== '') {
        var wrapper = this.doc.querySelector(this.opts.page);
        wrapper.style.transform = "scale(".concat(this.opts.zoom, ")");
        this.setZoomOnControl(wrapper);
      } else {
        var builders = this.doc.querySelectorAll(this.opts.container);
        builders.forEach(function (builder) {
          var fade = false; // to prevent initial load animation
          if (!builder.style.transform) fade = true;
          if (fade) {
            builder.style.transition = 'none';
          }
          builder.style.transform = "scale(".concat(_this2.opts.zoom, ")");
          if (fade) {
            setTimeout(function () {
              builder.style.transition = '';
            }, 300);
          }
          _this2.setZoomOnControl(builder);
        });
      }

      /*
      if(this.opts.zoom<1) {
          let ss = document.styleSheets;
          for (let i=0; i<ss.length; i++) {
              let ss = document.styleSheets;
              let rules = ss[i].cssRules || ss[i].rules;
              for (let j=0; j<rules.length; j++) {
                  if (rules[j].selectorText === '.sortable-drag') {
                      rules[j].style.background = `transparent`;
                  }
              }
          }
      }
      */
    }

    /*
    If latest npm is used, while local contentbuilder.css is still using the old version,
    then add the newest css here, so the newest script from npm will  work fine.
    backwardCompatible() is called by rowtool.js
    */
  }, {
    key: "backwardCompatible",
    value: function backwardCompatible() {
      var css = "\n        .row-active .is-col-tool {\n            display: flex;\n        }\n        .is-builder[rowoutline] .row-active .is-col-tool {\n            display: none;\n        }\n        .is-builder[hidecolumntool] .row-active .is-col-tool {\n            display: none;\n        }\n\n        .is-tool.is-col-tool {\n            flex-direction: row;\n            margin-top: 0px;\n            margin-left: -1px;\n        }\n        .is-tool.is-col-tool button {\n            width: 25px;\n            height: 25px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .is-tool.is-col-tool .cell-add {\n            background: #0fcc52;\n        }\n        .is-tool.is-col-tool .cell-more {\n            background: rgba(216, 200, 6, 0.9);\n        }\n        .is-tool.is-col-tool .cell-remove {\n            background: rgba(255, 85, 4, 0.9);\n        }\n        .is-tool.is-col-tool svg {\n            width: 23px;\n            height: 23px;\n            fill: #fff  !important;\n        }\n        .is-tool.is-col-tool .cell-more svg {\n            width: 14px;\n            height: 14px;\n        }\n\n\n        .is-builder[gray] .is-tool.is-col-tool {\n            background: rgba(243, 243, 243, 0.9);\n            flex-direction: row;\n            top:-3px;\n            margin-top: 0px;\n            margin-left: -1px;\n        }\n        .is-builder[gray] .is-tool.is-col-tool button {\n            width: 27px;\n            height: 27px;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-add {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-more {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-remove {\n            background: transparent;\n        }\n        .is-builder[gray] .is-tool.is-col-tool svg {\n            width: 18px;\n            height: 18px;\n            fill: #000 !important;\n        }\n        .is-builder[gray] .is-tool.is-col-tool .cell-more svg {\n            width: 12px;\n            height: 12px;\n        }\n\n\n        .is-col-tool svg {\n            display: initial !important;\n        }\n        \n        ";
      if (!this.builderStuff.querySelector('style[data-rel="css-new"]')) {
        this.builderStuff.insertAdjacentHTML('afterbegin', "\n            <style data-rel=\"css-new\">\n                ".concat(css, "\n            </style>\n            "));
      }
    }
  }, {
    key: "setZoomOnControl",
    value: function setZoomOnControl(area) {
      var _this3 = this;
      var rowtools = area.querySelectorAll('.is-row-tool');
      rowtools.forEach(function (rowtool) {
        rowtool.style.transform = "scale(".concat(1 / _this3.opts.zoom, ")");
        rowtool.style.transformOrigin = 'top';
      });
      var coltools = area.querySelectorAll('.is-col-tool');
      coltools.forEach(function (coltool) {
        coltool.style.transform = "scale(".concat(1 / _this3.opts.zoom, ")");
        coltool.style.transformOrigin = 'top left';
        coltool.style.marginTop = "".concat(-(27 / _this3.opts.zoom), "px");
      });
      var rowaddtools = area.querySelectorAll('.is-rowadd-tool button');
      rowaddtools.forEach(function (rowaddtool) {
        rowaddtool.style.transform = "scale(".concat(1 / _this3.opts.zoom, ")");
        // rowtool.style.transformOrigin = 'top';
      });

      // freeform
      var tools = area.querySelectorAll('.is-canvas-tool');
      tools.forEach(function (tool) {
        tool.style.transform = "scale(".concat(1 / _this3.opts.zoom, ")");
        tool.style.transformOrigin = 'top';
      });
      tools = area.querySelectorAll('.is-canvasadd-tool');
      tools.forEach(function (tool) {
        tool.style.transform = "scale(".concat(1 / _this3.opts.zoom, ")");
        tool.style.transformOrigin = 'top';
      });
    }
  }, {
    key: "setZoomOnArea",
    value: function setZoomOnArea() {
      var _this4 = this;
      if (this.canvas && !this.isContentBox && this.docContainer) {
        // freeform
        var docContainer = this.doc.querySelector(this.docContainer);
        docContainer.style.transform = "scale(".concat(this.opts.zoom, ")");
        if (this.eb) this.eb.setZoom(this.opts.zoom);
        return;
      }
      if (this.opts.page !== '') {
        var wrapper = this.doc.querySelector(this.opts.page);
        wrapper.style.transform = "scale(".concat(this.opts.zoom, ")");
      } else {
        var builders = this.doc.querySelectorAll(this.opts.container);
        builders.forEach(function (builder) {
          var fade = false; // to prevent initial load animation
          if (!builder.style.transform) fade = true;
          if (fade) {
            builder.style.transition = 'none';
          }
          builder.style.transform = "scale(".concat(_this4.opts.zoom, ")");
          if (fade) {
            setTimeout(function () {
              builder.style.transition = '';
            }, 300);
          }
        });
      }
    }
  }, {
    key: "applyBehavior",
    value: function applyBehavior() {
      var _this5 = this;
      // Zoom (required by the next process, eg. setZoomOnControl)
      if (localStorage.getItem('_zoom') !== null) {
        this.opts.zoom = localStorage.getItem('_zoom'); // Get from saved localStorage
      }

      this.rte.rteZoomSlider.value = this.opts.zoom * 100; // Set slider value

      // Get all builder areas
      var builders = this.doc.querySelectorAll(this.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        _this5.applyBehaviorOn(builder); // includes setZoomOnControl

        _this5.contentReformatOn(builder);
      });

      // Call onRender to indicate content is ready for editing (applyBehavior has been applied)
      this.opts.onRender();
      this.setZoomOnArea(); // Set zoom
    } // applyBehavior
  }, {
    key: "contentReformatOn",
    value: function contentReformatOn(builder) {
      if (this.opts.useCssClasses) this.dom.contentReformat(builder, this.opts.cssClasses);
    }
  }, {
    key: "applyBehaviorOn",
    value: function applyBehaviorOn(builder) {
      var _this6 = this;
      var util = this.util;

      //Make absolute
      if (this.opts.absolutePath) {
        var links = builder.querySelectorAll('a');
        Array.prototype.forEach.call(links, function (link) {
          var href = link.href;
          link.setAttribute('href', href);
        });
        var imgs = builder.querySelectorAll('img');
        Array.prototype.forEach.call(imgs, function (img) {
          var src = img.src;
          img.setAttribute('src', src);
        });
      }

      // Add .is-builder class on each builder area (container)
      this.dom.addClass(builder, 'is-builder');

      // Additional setting needed for dynamically added .is-builder. Without this, current toolStyle won't be applied to newly created section (eg. in ContentBox))
      // if (localStorage.getItem('_toolstyle') !== null) {
      //     let toolStyle = localStorage.getItem('_toolstyle');
      //     this.preferences.setToolStyle(toolStyle);
      // } 
      // if (localStorage.getItem('_outlinestyle') !== null) {
      //     let outlineStyle = localStorage.getItem('_outlinestyle');
      //     this.preferences.setOutlineStyle(outlineStyle);
      // } 
      if (this.preferences) this.preferences.initBuilder(builder);

      // Apply behavior on each row
      var rows = this.dom.elementChildren(builder);
      rows.forEach(function (row) {
        // The saveForUndo also saves sortable class when start dragging. If Undo is performed, the classes are returned. Cleanup the classes here.
        row.classList.remove('sortable-ghost');
        row.classList.remove('sortable-chosen');
        if (_this6.dom.hasClass(row, 'row-add-initial')) return;

        // Hack. If a row has margin left/right specified, don't need to set hidden border (that is used to make smooth sortable)
        if (row.style.marginLeft || row.style.marginRight) {
          row.style.border = 'none';
        }

        // On each row, add 2 tools: Row tool (div.is-row-tool) & Row Add tool (div.is-rowadd-tool)

        // Render Row tool
        _this6._rowTool.render(row);

        // Render Row Add tool
        var rowaddtool = new contentbuilder_rowaddtool(_this6);
        rowaddtool.render(row);

        // Apply behavior on each column
        var cols = _this6.dom.elementChildren(row);
        cols.forEach(function (col) {
          if (_this6.dom.hasClass(col, 'is-row-tool') || _this6.dom.hasClass(col, 'is-col-tool') || _this6.dom.hasClass(col, 'is-rowadd-tool')) return; // Return if not a column

          // For backward compatibility, replace:
          // - data-mode="readonly" with data-noedit
          // - data-mode="readonly-protected" with data-protected
          if (col.getAttribute('data-mode') === 'readonly') {
            col.setAttribute('data-noedit', '');
            col.removeAttribute('data-mode');
          }
          if (col.getAttribute('data-mode') === 'readonly-protected') {
            col.setAttribute('data-protected', '');
            col.removeAttribute('data-mode');
          }

          // Set ContentEditable

          var noedit = false;
          if (col.hasAttribute('data-noedit')) {
            // Column is not (text) editable.
            noedit = true;
          }
          var _protected = false;
          if (col.hasAttribute('data-protected')) {
            // Column is not (text) editable and also: cannot be deleted, moved or duplicated.
            _protected = true;
          }
          var customcode = false;
          if (col.hasAttribute('data-html')) {
            // Column contains custom code.
            customcode = true;
          }

          // let custommodule = false;
          // if (col.hasAttribute('data-module')) { // Column contains custom module.
          //     custommodule = true;
          // }

          if (!customcode && !noedit && !_protected) {
            // Check if column contains editable text
            var _text = col.innerText.trim();
            var elms = col.querySelectorAll('p,h1,h2,h3,h4,h5,h6,table,ul,ol,pre,blockquote,code,figcaption,label,legend,button,a,span');
            if (elms.length > 0 || _text !== '') {
              col.contentEditable = true; // Column is (text) editable
            }
          }

          // Apply behavior on several elements for editing purpose
          _this6.element.applyBehavior(col);

          // Add events on column
          if (!col.getAttribute('data-click')) {
            // ON CLICK
            // Use bind() => https://www.w3schools.com/react/react_events.asp
            col.addEventListener('click', _this6.handleCellClick.bind(_this6, col));

            // ON KEYPRESS
            col.addEventListener('keydown', _this6.handleCellKeypress.bind(_this6));

            // ON KEYDOWN
            col.addEventListener('keydown', _this6.handleCellKeydown.bind(_this6, col));

            // ON KEYUP
            col.addEventListener('keyup', _this6.handleCellKeyup.bind(_this6, col));

            // ON DOUBLE CLICK TO SELECT
            var isDoubleClick = false; // Double click flag

            col.addEventListener('dblclick', function () {
              isDoubleClick = true;
            });
            col.addEventListener('mouseup', function () {
              if (isDoubleClick) {
                var selection = _this6.win.getSelection();
                var selectedText = selection.toString().trim();
                if (selectedText.length > 0) {
                  var elm = _this6.dom.getElm();
                  if (_this6.dom.getStyle(elm, 'display') === 'inline') {
                    elm = elm.closest('li,p,h1,h2,h3,h4,h5,h6,div,pre,td,th,li');
                    if (elm) {
                      if (!_this6.dom.hasClass(elm.parentNode.parentNode, 'is-builder')) {
                        _this6.dom.selectElementContents(elm);
                      }
                    }
                  } else {
                    // block
                    _this6.dom.selectElementContents(elm);
                  }
                }
                // Reset the flag after handling the double-click
                isDoubleClick = false;
              }
            });

            // ON FOCUS
            // col.addEventListener('focus', this.handleCellFocus.bind(this, col));

            // ON PASTE
            // col.addEventListener('paste', this.handleCellPaste.bind(this));
            col.addEventListener('paste', function (e) {
              e.preventDefault();
              var clipboardDataText = (e.clipboardData || window.clipboardData).getData('text');
              var clipboardDataHtml = (e.clipboardData || window.clipboardData).getData('text/html');
              if (clipboardDataHtml.trim() === '') clipboardDataHtml = clipboardDataText;
              _this6.handleCellPaste(clipboardDataText, clipboardDataHtml);
            });
            col.setAttribute('data-click', true);
          }
        });
      });

      // Sortable on each builder (container)
      if (!builder.getAttribute('data-sort') && !builder.hasAttribute('nogrid')) {
        // Check first if sortable has been added.

        /*
        let userAgentString = navigator.userAgent; 
        let safariAgent = userAgentString.indexOf('Safari') > -1; 
        let chromeAgent = userAgentString.indexOf('Chrome') > -1; 
        if ((chromeAgent) && (safariAgent)) safariAgent = false;
        */
        // let safariAgent = false;

        var sortableObject = new sortable_esm(builder, {
          // forceFallback: safariAgent,
          // forceFallback: true,
          scroll: true,
          // invertSwap: true, /* https://github.com/SortableJS/Sortable/wiki/Swap-Thresholds-and-Direction#swap-threshold */
          group: 'shared',
          // direction: 'dummy', // works well with border-right hack & empty-info
          animation: 300,
          handle: '.row-handle',
          // swapThreshold: 0.1, // this cause drag drop snippet sometimes difficult
          // invertedSwapThreshold: 0.1,
          sort: true,
          //new
          // swapThreshold: 0.5,

          onChoose: function onChoose() {
            // Get zoom (scale) value
            var scale;
            if (_this6.opts.page !== '') {
              var wrapper = _this6.doc.querySelector(_this6.opts.page);
              scale = _this6.dom.getScale(wrapper);
            } else {
              var area = _this6.doc.querySelector('.is-builder'); // get one of the builder area
              scale = _this6.dom.getScale(area);
              if (!scale) scale = 1;
            }

            // Make moving draggable item scaled & positioned correctly (due to zoom value)
            var newCss = "\n                    <style id=\"css-scale\">\n                        .sortable-drag::before {\n                            transform: scale(".concat(scale, ");\n                        }\n                    </style>\n                    ");
            if (_this6.iframe) {
              var oldCss = _this6.contentStuff.querySelector('#css-scale');
              if (oldCss) oldCss.parentNode.removeChild(oldCss);
              _this6.contentStuff.insertAdjacentHTML('afterbegin', newCss);
            } else {
              var _oldCss = _this6.builderStuff.querySelector('#css-scale');
              if (_oldCss) _oldCss.parentNode.removeChild(_oldCss);
              _this6.builderStuff.insertAdjacentHTML('afterbegin', newCss);
            }

            // this.sectionDropSetup(); // enable drop as section (ContentBox)
          },

          onStart: function onStart() {
            _this6.uo.saveForUndo(); // Even if cancelled, saveForUndo will make sure not to save if there is no change 

            _this6.elmTool.hide();
          },
          onEnd: function onEnd() {
            _this6.util.checkEmpty(); // for multiple instances check

            // if(this.sortableOnPage) this.sortableOnPage.destroy(); // enable drop as section (ContentBox)

            if (_this6.controlPanel) {
              // && document.body.classList.contains('controlpanel') (already opens)
              _this6.controlpanel.getActive();
              _this6.controlpanel.select('column');
              setTimeout(function () {
                // Hide element tool
                _this6.elmTool.hide();
              }, 600);
            }

            //Trigger Change event
            _this6.opts.onChange();

            //Trigger Render event
            _this6.opts.onRender();
          },
          onAdd: function onAdd(evt) {
            var itemEl = evt.item;
            if (itemEl.getAttribute('data-id')) {
              // If has data-id attribute, the dropped item is from snippet panel (snippetpanel.js)

              var snippetid = itemEl.getAttribute('data-id');

              // snippetJSON is snippet's JSON (from assets/minimalist-blocks/content.js) that store all snippets' html
              var result = _this6.opts.snippetJSON.snippets.filter(function (item) {
                if (item.id + '' === snippetid) return item;else return false;
              });
              var html = result[0].html;
              var noedit = result[0].noedit;
              var bSnippet;
              if (html.indexOf('"row') === -1) {
                bSnippet = true; // Just snippet (without row/column grid)
              } else {
                bSnippet = false; // Snippet is wrapped in row/colum
              }

              if (_this6.opts.emailMode) bSnippet = false;

              // Convert snippet into your defined 12 columns grid   
              var rowClass = _this6.opts.row; //row
              var colClass = _this6.opts.cols; //['col s1', 'col s2', 'col s3', 'col s4', 'col s5', 'col s6', 'col s7', 'col s8', 'col s9', 'col s10', 'col s11', 'col s12']
              if (rowClass !== '' && colClass.length === 12) {
                // html = html.replace(new RegExp('row clearfix', 'g'), rowClass);
                html = html.replace(new RegExp('row clearfix', 'g'), 'row'); // backward
                html = html.replace(new RegExp('"row', 'g'), '"' + rowClass);
                html = html.replace(new RegExp('column full', 'g'), colClass[11]);
                html = html.replace(new RegExp('column half', 'g'), colClass[5]);
                html = html.replace(new RegExp('column third', 'g'), colClass[3]);
                html = html.replace(new RegExp('column fourth', 'g'), colClass[2]);
                html = html.replace(new RegExp('column fifth', 'g'), colClass[1]);
                html = html.replace(new RegExp('column sixth', 'g'), colClass[1]);
                html = html.replace(new RegExp('column two-third', 'g'), colClass[7]);
                html = html.replace(new RegExp('column two-fourth', 'g'), colClass[8]);
                html = html.replace(new RegExp('column two-fifth', 'g'), colClass[9]);
                html = html.replace(new RegExp('column two-sixth', 'g'), colClass[9]);
              }
              html = html.replace(/{id}/g, util.makeId());
              if (_this6.opts.onAdd) {
                html = _this6.opts.onAdd(html);
              }
              if (_this6.opts.snippetPathReplace.length > 0) {
                // try {
                if (_this6.opts.snippetPathReplace[0] !== '') {
                  var regex = new RegExp(_this6.opts.snippetPathReplace[0], 'g');
                  html = html.replace(regex, _this6.opts.snippetPathReplace[1]);
                  var string1 = _this6.opts.snippetPathReplace[0].replace(/\//g, '%2F');
                  var string2 = _this6.opts.snippetPathReplace[1].replace(/\//g, '%2F');
                  var regex2 = new RegExp(string1, 'g');
                  html = html.replace(regex2, string2);
                }
                // } catch (e) { 1; }
              }

              if (bSnippet) {
                // Just snippet (without row/column grid), ex. buttons, line, social, video, map.
                // Can be inserted after current row, column (cell), element, or last row.

                html = "<div class=\"".concat(_this6.opts.row, "\"><div class=\"").concat(_this6.opts.cols[_this6.opts.cols.length - 1], "\"").concat(noedit ? ' data-noedit' : '', ">").concat(html, "</div></div>");

                // Clean snippet from sortable related code
                itemEl.removeAttribute('draggable');
                _this6.dom.removeClass(itemEl, 'snippet-item');
                itemEl.outerHTML = html;
              } else {
                // Snippet is wrapped in row/colum (may contain custom code or has [data-html] attribute)
                // Can only be inserted after current row or last row (not on column or element).

                var snippet = _this6.dom.createElement('div');
                snippet.innerHTML = html;
                var blocks = snippet.querySelectorAll('[data-html]');
                Array.prototype.forEach.call(blocks, function (block) {
                  // Render custom code block
                  html = decodeURIComponent(block.getAttribute('data-html'));
                  html = html.replace(/{id}/g, util.makeId());
                  html = html.replace(/<script>/g, "".concat(_this6.nonce ? "<script nonce=\"".concat(_this6.nonce, "\">") : '<script>'));
                  for (var i = 1; i <= 20; i++) {
                    html = html.replace('[%HTML' + i + '%]', block.getAttribute('data-html-' + i) === undefined ? '' : decodeURIComponent(block.getAttribute('data-html-' + i))); //render editable area
                  }

                  block.innerHTML = html;
                });
                html = snippet.innerHTML;

                // Clean snippet from sortable related code
                itemEl.removeAttribute('draggable');
                _this6.dom.removeClass(itemEl, 'snippet-item');
                itemEl.innerHTML = '';

                // Use createContextualFragment() to make embedded script executable
                // https://ghinda.net/article/script-tags/
                var range = document.createRange();
                range.setStart(itemEl, 0);
                itemEl.appendChild(range.createContextualFragment(html));
                itemEl.outerHTML = itemEl.innerHTML;
              }

              // After snippet has been added, re-apply behavior on builder areas
              _this6.applyBehaviorOn(builder);

              //Trigger Change event
              _this6.opts.onChange();

              //Trigger Render event
              _this6.opts.onRender();

              // Hide element tool
              _this6.elmTool.hide();

              // // destroy
              // if(this.sortableOnCanvas) {
              //     this.sortableOnCanvas.forEach(obj=>{
              //         if(obj) {
              //             obj.destroy();
              //         }
              //     });
              //     let dummies = this.doc.querySelectorAll('.block-dummy');
              //     dummies.forEach(elm=>elm.parentNode.removeChild(elm));
              // }

              // if(this.sortableOnPage) this.sortableOnPage.destroy();
            }
          }
        });

        this.sortableObjects.push(sortableObject);
        builder.setAttribute('data-sort', true);
      }
      // /Sortable

      // Fix buttons not wrapped in  <div style="white-space: nowrap;">
      var linkButtons = builder.querySelectorAll('a[role="button"]');
      Array.prototype.forEach.call(linkButtons, function (btn) {
        if (btn.parentNode) {
          if (btn.parentNode.parentNode) {
            if (btn.parentNode.parentNode.parentNode === builder) {
              btn.outerHTML = "\n                        <div style=\"white-space: nowrap;\">\n                            ".concat(btn.outerHTML, "\n                        </div>\n                        ");
            }
          }
        }
      });

      // Additional contentEditable for subblock
      var subblocks = builder.querySelectorAll('.is-subblock');
      Array.prototype.forEach.call(subblocks, function (subblock) {
        subblock.contentEditable = true;
      });

      // Check if there is empty builder area (still has no content)
      this.util.checkEmptyOn(builder);

      // Zoom
      this.setZoomOnControl(builder);
    }
  }, {
    key: "html",
    value: function html(area) {
      if (this.docContainer) {
        // freeform

        var docContainer = this.doc.querySelector(this.docContainer);
        var html = this.readHtml(docContainer, false, true);
        return html;
      }
      var util = this.util;
      if (area) {
        //return area
      } else {
        var builders = this.doc.querySelectorAll(this.opts.container);
        if (builders.length > 1) {
          var cell = util.cellSelected();
          if (!cell) {
            // Return first instance
            area = builders[0];
          } else {
            // Return active instance
            area = cell.parentNode.parentNode;
          }
        } else {
          // Single instance
          area = builders[0];
        }
        if (this.opts.page !== '') {
          var wrapper = this.doc.querySelector(this.opts.page);
          if (wrapper) {
            //return wrapper
            area = wrapper;
          }
        }
      }
      this.cleanHtmlFormatting = true;
      var outputHtml = this.htmlutil.readHtml(area); //for view=false
      this.cleanHtmlFormatting = false;
      return outputHtml;
    }

    // ContentBox
  }, {
    key: "viewHtmlNormal",
    value: function viewHtmlNormal() {
      this.htmlutil.viewHtmlExternal();
    }
  }, {
    key: "readHtml",
    value: function readHtml(content, view, multiple, excludeCustomBlock) {
      return this.htmlutil.readHtml(content, view, multiple, excludeCustomBlock);
    }
  }, {
    key: "fromViewToActual",
    value: function fromViewToActual(html) {
      return this.htmlutil.fromViewToActual(html);
    }
  }, {
    key: "colorpicker",
    value: function colorpicker(onPick, defaultcolor) {
      return new contentbuilder_colorpicker({
        onPick: onPick,
        color: defaultcolor,
        colors: this.opts.colors,
        animateModal: this.opts.animateModal,
        elementToAnimate: this.opts.container,
        lang: this.opts.lang
      });
    }
  }, {
    key: "gradientpicker",
    value: function gradientpicker() {
      return new contentbuilder_gradientpicker({
        gradientcolors: this.opts.gradientcolors,
        colors: this.opts.colors,
        animateModal: this.opts.animateModal,
        elementToAnimate: this.opts.container,
        lang: this.opts.lang
      });
    }

    // simpleColorPicker(onPick,mode) {
    //     return this.colorClassPicker.open(onPick,mode);
    // }
  }, {
    key: "openAIAssistant",
    value: function openAIAssistant() {
      this.dictation.openDictation();
    }
  }, {
    key: "closeAIAssistant",
    value: function closeAIAssistant() {
      var modal = document.querySelector('.is-modal.page-command');
      modal.classList.remove('active');
      this.dictation.stopDictation();
      localStorage.setItem('_dictation', '0');
    }
  }, {
    key: "toggleAIAssistant",
    value: function toggleAIAssistant() {
      var modal = document.querySelector('.is-modal.page-command');
      if (modal.classList.contains('active')) {
        this.closeAIAssistant();
      } else {
        this.openAIAssistant();
      }
    }

    // freeform
  }, {
    key: "toggleSnippetModal",
    value: function toggleSnippetModal() {
      var snippetModal = this.builderStuff.querySelector('.is-modal.snippetwindow');
      if (snippetModal.classList.contains('active')) {
        snippetModal.classList.remove('active');
      } else {
        snippetModal.classList.add('active');
      }
    }
  }, {
    key: "openSnippetModal",
    value: function openSnippetModal() {
      var snippetModal = this.builderStuff.querySelector('.is-modal.snippetwindow');
      snippetModal.classList.add('active');
    }
  }, {
    key: "closeSnippetModal",
    value: function closeSnippetModal() {
      var snippetModal = this.builderStuff.querySelector('.is-modal.snippetwindow');
      snippetModal.classList.remove('active');
    }
  }, {
    key: "refresh",
    value: function refresh() {
      if (this.eb) this.eb.refresh();
    }
  }, {
    key: "group",
    value: function group() {
      if (!this.eb) return;
      this.uo.saveForUndo();
      var group = this.eb.group();
      this.opts.onChange();
      return group;
    }
  }, {
    key: "unGroup",
    value: function unGroup() {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.unGroup();
      this.opts.onChange();
    }
  }, {
    key: "delete",
    value: function _delete() {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb["delete"]();
      this.opts.onChange();
    }
  }, {
    key: "forward",
    value: function forward(target) {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.forward(target);
      this.opts.onChange();
    }
  }, {
    key: "backward",
    value: function backward(target) {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.backward(target);
      this.opts.onChange();
    }
  }, {
    key: "moveUp",
    value: function moveUp(target) {
      var arrBlocks = [];
      var container = target.parentNode;
      var elms = container.querySelectorAll('.is-block');
      elms.forEach(function (elm) {
        arrBlocks.push(elm);
      });
      var previousBlock; //, nextBlock;
      for (var i = 0; i < arrBlocks.length; i++) {
        if (arrBlocks[i] === target) {
          if (i - 1 >= 0) previousBlock = arrBlocks[i - 1];
          // if(i+1<arrBlocks.length) nextBlock = arrBlocks[i+1];
        }
      }

      if (previousBlock) {
        this.uo.saveForUndo();
        container.insertBefore(target, previousBlock);
        this.opts.onChange();
      }
    }
  }, {
    key: "moveDown",
    value: function moveDown(target) {
      var arrBlocks = [];
      var container = target.parentNode;
      var elms = container.querySelectorAll('.is-block');
      elms.forEach(function (elm) {
        arrBlocks.push(elm);
      });
      var nextBlock; //, previousBlock;
      for (var i = 0; i < arrBlocks.length; i++) {
        if (arrBlocks[i] === target) {
          // if(i-1>=0) previousBlock = arrBlocks[i-1];
          if (i + 1 < arrBlocks.length) nextBlock = arrBlocks[i + 1];
        }
      }
      if (nextBlock) {
        this.uo.saveForUndo();
        container.insertBefore(nextBlock, target);
        this.opts.onChange();
      }
    }
  }, {
    key: "enableShape",
    value: function enableShape() {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.enableShape();
      this.opts.onChange();
    }
  }, {
    key: "removeShape",
    value: function removeShape() {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.removeShape();
      this.opts.onChange();
    }
  }, {
    key: "addBlock",
    value: function addBlock(html, blockContainer) {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.addBlock(html, blockContainer);
      this.opts.onChange();
      this.opts.onRender();
    }
  }, {
    key: "duplicate",
    value: function duplicate() {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.duplicate();
      this.opts.onChange();
      this.opts.onRender();
    }
  }, {
    key: "addBreakpoint",
    value: function addBreakpoint() {
      if (!this.eb) return;
      this.eb.addBreakpoint();
    }
  }, {
    key: "getBreakpoints",
    value: function getBreakpoints(target) {
      if (!this.eb) return;
      return this.eb.getBreakpoints(target);
    }
  }, {
    key: "clearBreakpoint",
    value: function clearBreakpoint(target) {
      if (!this.eb) return;
      this.uo.saveForUndo();
      this.eb.clearBreakpoint(target);
      this.opts.onChange();
    }
  }, {
    key: "quitEditable",
    value: function quitEditable(target) {
      if (!this.eb) return;
      this.eb.quitEditable(target);
    }
  }, {
    key: "addPage",
    value: function addPage(box) {
      this.uo.saveForUndo();
      var s;
      if (localStorage.getItem('_pagesize') === '' || localStorage.getItem('_pagesize')) {
        s = localStorage.getItem('_pagesize');
      } else {
        s = this.pageSize || '';
      }
      var html = "\n        <div class=\"is-box box-canvas autolayout new-canvas\" data-pagesize=\"".concat(s, "\">\n        ");
      var docContainer = this.doc.querySelector(this.docContainer);
      if (box) {
        box.insertAdjacentHTML('afterend', html);
      } else {
        docContainer.insertAdjacentHTML('beforeend', html);
      }
      var newBox = docContainer.querySelector('.new-canvas');
      newBox.scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
      newBox.classList.remove('new-canvas');
      this.applyBehaviorCanvas();
      this.opts.onChange();
    }
  }, {
    key: "setPageSize",
    value: function setPageSize(s) {
      this.pageoption.setPageSize(s);
    }
  }, {
    key: "applyBehaviorCanvas",
    value: function applyBehaviorCanvas() {
      var _this7 = this;
      if (this.canvas && !this.isContentBox && this.docContainer && !this.iframe) {
        var htmlTool = "\n            <div class=\"is-tool is-canvas-tool\" style=\"transform: scale(1); transform-origin: center top;\">\n                <button type=\"button\" tabindex=\"-1\" class=\"box-up\" title=\"".concat(this.util.out('Move Up'), "\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-arrow-up\"></use></svg></button>\n                <button type=\"button\" tabindex=\"-1\" class=\"box-down\" title=\"").concat(this.util.out('Move Down'), "\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-arrow-down\"></use></svg></button>\n                <!--\n                <button type=\"button\" tabindex=\"-1\" class=\"box-settings\" title=\"").concat(this.util.out('Settings'), "\"><svg class=\"is-icon-flex\"><use xlink:href=\"#ion-more\"></use></svg></button>\n                -->\n                <button type=\"button\" tabindex=\"-1\" class=\"box-remove\" title=\"").concat(this.util.out('Remove'), "\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-trash\"></use></svg></button>\n            </div>\n            <div class=\"is-tool is-canvasadd-tool\" style=\"transform: scale(1); transform-origin: center top;\">\n                <button type=\"button\" tabindex=\"-1\" class=\"box-add\" title=\"").concat(this.util.out('Add'), "\"><svg class=\"is-icon-flex\"><use xlink:href=\"#icon-plus2\"></use></svg></button>\n            </div>\n            ");
        var docContainer = this.doc.querySelector(this.docContainer);
        var boxes = this.dom.elementChildren(docContainer);
        boxes.forEach(function (box) {
          var tool1 = box.querySelector('.is-canvas-tool');
          var tool2 = box.querySelector('.is-canvasadd-tool');
          if (tool1) tool1.remove();
          if (tool2) tool2.remove();
          if (!box.querySelector('.is-canvas-tool')) {
            box.addEventListener('click', function () {
              boxes.forEach(function (elm) {
                return elm.classList.remove('box-select');
              });
              box.classList.add('box-select');

              // onSelectPage (see onSelectBlock)

              var elms = _this7.rte.elementRteTool.querySelectorAll('.rte-blocksettings');
              Array.prototype.forEach.call(elms, function (elm) {
                elm.style.display = '';
              });
            });
            box.insertAdjacentHTML('afterbegin', htmlTool);
            var btnUp = box.querySelector('.is-canvas-tool .box-up');
            btnUp.addEventListener('click', function (e) {
              var box = e.target.closest('.is-box');
              _this7.uo.saveForUndo();
              var boxPrev = box.previousElementSibling;
              if (boxPrev) box.parentNode.insertBefore(box, boxPrev);
              box.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
              });
              _this7.opts.onChange();
            });
            var btnDown = box.querySelector('.is-canvas-tool .box-down');
            btnDown.addEventListener('click', function (e) {
              var box = e.target.closest('.is-box');
              _this7.uo.saveForUndo();
              var boxNext = box.nextElementSibling;
              if (boxNext) box.parentNode.insertBefore(boxNext, box);
              box.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
              });
              _this7.opts.onChange();
            });
            var btnRemove = box.querySelector('.is-canvas-tool .box-remove');
            btnRemove.addEventListener('click', function (e) {
              var box = e.target.closest('.is-box');
              _this7.uo.saveForUndo();
              box.remove();
              _this7.blockmodal.showHideControls();
              if (!docContainer.querySelector('.is-box')) _this7.addPage();
              _this7.opts.onChange();
            });
            var btnAdd = box.querySelector('.is-canvasadd-tool .box-add');
            btnAdd.addEventListener('click', function (e) {
              var box = e.target.closest('.is-box');
              _this7.addPage(box);
            });
          }
        });
        if (localStorage.getItem('_zoom') !== null) {
          this.opts.zoom = localStorage.getItem('_zoom'); // Get from saved localStorage
        }

        this.eb.setZoom(this.opts.zoom);
        this.setZoomOnControl(docContainer);
      }
    }
  }, {
    key: "openPageOptions",
    value: function openPageOptions() {
      this.pageoption.open();
    }
  }, {
    key: "print",
    value: function print() {
      this.pageoption.print();
    }
  }, {
    key: "destroy",
    value: function destroy() {
      var _this8 = this;
      if (this.eb) this.eb.destroy();
      this.doc.body.classList.remove('data-editor');
      document.removeEventListener('click', this.doDocumentClick, false);
      document.removeEventListener('keydown', this.doDocumentKeydown, false);
      document.removeEventListener('mousedown', this.doDocumentMousedown, false);
      document.removeEventListener('click', this.doRteClick, false);
      this.doc.removeEventListener('click', this.doHideSnippetHandler, false);
      if (this.iframe) {
        this.doc.removeEventListener('click', this.doDocumentClick, false);
        this.doc.removeEventListener('keydown', this.doDocumentKeydown, false);
        this.doc.removeEventListener('mousedown', this.doDocumentMousedown, false);
        this.doc.removeEventListener('click', this.doRteClick, false);
        this.win.removeEventListener('scroll', this.doWindowScroll, false);
        this.win.removeEventListener('resize', this.doWindowResize, false);
      }
      this.util.clearControls();
      var builderStuff = this.util.builderStuff();
      if (!builderStuff) return; // in case the builder is destroyed

      // Reset Zoom
      if (this.opts.page !== '') {
        var wrapper = this.doc.querySelector(this.opts.page);
        if (wrapper) wrapper.style.transform = '';
      } else {
        var _builders2 = this.doc.querySelectorAll(this.opts.container);
        _builders2.forEach(function (builder) {
          builder.style.transform = '';
        });
      }
      var builders = this.doc.querySelectorAll(this.opts.container);
      Array.prototype.forEach.call(builders, function (builder) {
        // builder.innerHTML = htmlutil.readHtml(builder, true);

        var html = _this8.htmlutil.readHtml(builder, false);
        var range = _this8.doc.createRange();
        builder.innerHTML = '';
        builder.appendChild(range.createContextualFragment(html)); // Use createContextualFragment so that embedded javascript code (code block) will be executed
      });

      if (this.canvas && !this.isContentBox) {
        var html = this.html();
        var range = this.doc.createRange();
        var docContainer = this.doc.querySelector(this.docContainer);
        docContainer.innerHTML = '';
        docContainer.appendChild(range.createContextualFragment(html));
      }
      Array.prototype.forEach.call(builders, function (builder) {
        builder.removeAttribute('data-sort');
        _this8.dom.removeClass(builder, 'is-builder');
      });
      Array.prototype.forEach.call(this.sortableObjects, function (sortableObject) {
        try {
          sortableObject.destroy();
        } catch (e) {
          // Do Nothing
        }
      });
      if (this.moveable) this.moveable.destroy();

      // Remove special css
      var cbContentStyle = this.doc.querySelector('#_contentbuilder_css');
      if (cbContentStyle) cbContentStyle.parentNode.removeChild(cbContentStyle);
      this.builderStuff.parentNode.removeChild(this.builderStuff);
      this.builderStuff = null;
      if (this.iframe) {
        this.contentStuff.parentNode.removeChild(this.contentStuff);
        this.contentStuff = null;
      }
    }
  }, {
    key: "saveImages",
    value: function saveImages(handler, onComplete, onBase64Upload) {
      var si = new saveimages({
        page: this.opts.page,
        container: this.opts.container,
        customval: this.opts.customval,
        handler: handler,
        onComplete: onComplete,
        onBase64Upload: onBase64Upload ? onBase64Upload : null
      }, this);
      si.save();
    }
    // /ContentBox

    // External (eg. from IFRAME)
  }, {
    key: "clearFont",
    value: function clearFont() {
      this.rte.clearFont();
    }
  }, {
    key: "applyFont",
    value: function applyFont(fontfamily, fontstyle, provider) {
      // called from iframe: parent._cb.applyFont
      this.rte.applyFont(fontfamily, fontstyle, provider);
    }
  }, {
    key: "setFont",
    value: function setFont(fontfamily, fontstyle, fontdisplay, provider) {
      // called from iframe: parent._cb.applyFont
      this.rte.setFont(fontfamily, fontstyle, fontdisplay, provider);
    }
  }, {
    key: "addIcon",
    value: function addIcon(classname) {
      this.rte.addIcon(classname);
    }
  }, {
    key: "applyLargerImage",
    value: function applyLargerImage(s) {
      var _this9 = this;
      // called from iframe: parent.applyLargerImage() see line 345

      var forms = document.querySelectorAll('.form-upload-larger'); // elementimage.js
      Array.prototype.forEach.call(forms, function (formUpload) {
        if (_this9.dom.hasClass(formUpload, 'please-wait')) {
          _this9.dom.removeClass(formUpload, 'please-wait');
          formUpload.parentNode.parentNode.querySelector('input[type="text"]').value = s;
          formUpload.parentNode.parentNode.querySelector('input[type="file"]').value = '';
        }
      });
    }
  }, {
    key: "returnUrl",
    value: function returnUrl(s) {
      var _this10 = this;
      // Same as applyLargerImage (NEW)

      var forms = document.querySelectorAll('.form-upload-larger'); // elementimage.js
      Array.prototype.forEach.call(forms, function (formUpload) {
        if (_this10.dom.hasClass(formUpload, 'please-wait')) {
          _this10.dom.removeClass(formUpload, 'please-wait');
          if (s) formUpload.parentNode.parentNode.querySelector('input[type="text"]').value = s;
          formUpload.parentNode.parentNode.querySelector('input[type="file"]').value = '';
        }
      });
      this.opts.assetRefresh = true; // After file upload, make open asset refreshed

      if (this.onAssetUpload) {
        this.onAssetUpload(s);
        this.onAssetUpload = null; // clear
      }
    }
  }, {
    key: "openMediaPicker",
    value: function openMediaPicker(currentUrl) {
      var assetType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'media';
      var callback = arguments.length > 2 ? arguments[2] : undefined;
      var btn = arguments.length > 3 ? arguments[3] : undefined;
      this.mediaPicker.openMediaPicker(currentUrl, assetType, callback, btn);
    }
  }, {
    key: "openImagePicker",
    value: function openImagePicker(currentUrl, callback, btn) {
      this.colTool.openImagePicker(currentUrl, callback, btn);
    }
  }, {
    key: "openImageAdjust",
    value: function openImageAdjust(elm, btn, useTarget) {
      if (this.opts.imageAdjust === 2) {
        this.colTool.openImageAdjust2(elm, btn);
      } else {
        this.colTool.openImageAdjust(elm, btn, useTarget);
      }
    }
  }, {
    key: "selectFile",
    value: function selectFile(s) {
      // Backward compatible

      this.selectAsset(s);
    }
  }, {
    key: "selectImage",
    value: function selectImage(s) {
      // Backward compatible

      this.selectAsset(s);
    }
  }, {
    key: "selectVideo",
    value: function selectVideo(s) {
      // Backward compatible

      this.selectAsset(s);
    }
  }, {
    key: "selectAsset",
    value: function selectAsset(s, f) {
      var extension = s.split('.').pop().split('?')[0].split('#')[0]; //
      extension = extension.toLowerCase();
      var ok = false;
      if (this.targetAssetType === 'all') {
        ok = true;
      } else if (this.targetAssetType === 'media') {
        if (s.includes('base64') || extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp' || extension === 'mp4') {
          ok = true;
        } else {
          alert(this.util.out('Please select an image or video file.'));
        }
      } else if (this.targetAssetType === 'image') {
        if (s.includes('base64') || extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp') {
          ok = true;
        } else {
          alert(this.util.out('Please select an image file.'));
        }
      } else if (this.targetAssetType === 'video') {
        if (extension === 'mp4') {
          ok = true;
        } else {
          alert(this.util.out('Please select an mp4 file.'));
        }
      } else if (this.targetAssetType === 'audio') {
        if (extension === 'mp3') {
          ok = true;
        } else {
          alert(this.util.out('Please select an mp3 file.'));
        }
      }
      if (ok) {
        if (f) this.targetInput.setAttribute('data-filename', f);else this.targetInput.removeAttribute('data-filename');
        this.targetInput.value = s;

        // if(this.targetCallback) this.targetCallback();
        if (this.targetInput.id === 'inpCellLinkSource') {
          // Special case (need to run a process on asset select). See columntool.js on targetCallback.
          this.targetCallback();
        }
        var modal = document.querySelector('.is-modal.videoselect.active');
        if (modal) this.hideModal(modal);
        modal = document.querySelector('.is-modal.imageselect.active');
        if (modal) this.hideModal(modal);
        modal = document.querySelector('.is-modal.fileselect.active');
        if (modal) this.hideModal(modal);
        modal = document.querySelector('.is-modal.audioselect.active');
        if (modal) this.hideModal(modal);
        modal = document.querySelector('.is-modal.mediaselect.active');
        if (modal) this.hideModal(modal);
        modal = document.querySelector('.is-modal.otherselect.active');
        if (modal) this.hideModal(modal);
      }
    }
  }, {
    key: "assetType",
    value: function assetType() {
      // not used yet
      return this.targetAssetType; // not used yet
    }
  }, {
    key: "openImageSelect",
    value: function openImageSelect(callback, defaultValue) {
      var _this11 = this;
      var inpUrl = document.createElement('input');

      // dummy button (for the openAsset() method, for the old Asset Manager. Not needed for the new.)
      var btn = document.createElement('button');
      this.openAsset(inpUrl, 'image', btn, defaultValue);
      var out = function out(s) {
        return _this11.util.out(s);
      };
      var desc = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
      Object.defineProperty(inpUrl, 'value', {
        get: desc.get,
        set: function set(s) {
          // Additional protection if normal selectAsset() is not used in asset dialog.
          // This is used if onImageSelectClick or onFileSelectClick are used.
          var filename = s.substring(s.lastIndexOf('/') + 1);
          var extension = filename.split('.').pop();
          extension = extension.toLowerCase();
          var ok = false;
          if (s.includes('base64') || extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp') {
            ok = true;
          } else {
            alert(out('Please select an image file.'));
          }
          if (ok) {
            // if(callback) callback(s);
            if (callback) {
              // if s is base64 and there is data-filename attribute set
              var f;
              if (inpUrl.hasAttribute('data-filename')) f = inpUrl.getAttribute('data-filename');
              callback(s, f);
            }
          }
          desc.set.call(this, s);
        }
      });
    }
  }, {
    key: "openAssetSelect",
    value: function openAssetSelect(targetAssetType, callback, defaultValue) {
      var _this12 = this;
      var inpUrl = document.createElement('input');

      // dummy button (for the openAsset() method, for the old Asset Manager. Not needed for the new.)
      var btn = document.createElement('button');
      this.openAsset(inpUrl, targetAssetType, btn, defaultValue);
      var out = function out(s) {
        return _this12.util.out(s);
      };
      var desc = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
      Object.defineProperty(inpUrl, 'value', {
        get: desc.get,
        set: function set(s) {
          // Additional protection if normal selectAsset() is not used in asset dialog.
          // This is used if onImageSelectClick or onFileSelectClick are used.
          var filename = s.substring(s.lastIndexOf('/') + 1);
          var ext = filename.split('.').pop();
          ext = ext.toLowerCase();
          var ok = false;
          if (targetAssetType === 'image' && (s.includes('base64') || ext === 'jpg' || ext === 'jpeg' || ext === 'png' || ext === 'gif' || ext === 'webm' || ext === 'webp')) {
            ok = true;
          } else if (targetAssetType === 'video' && ext === 'mp4') {
            ok = true;
          } else if (targetAssetType === 'audio' && ext === 'mp3') {
            ok = true;
          } else if (targetAssetType === 'media' && (s.includes('base64') || ext === 'mp4' || ext === 'jpg' || ext === 'jpeg' || ext === 'png' || ext === 'gif' || ext === 'webm' || ext === 'webp')) {
            ok = true;
          } else if (targetAssetType === 'all') {
            ok = true;
          } else {
            if (targetAssetType === 'image') alert(out('Please select an image file.'));
            if (targetAssetType === 'video') alert(out('Please select an mp4 file.'));
            if (targetAssetType === 'audio') alert(out('Please select an mp3 file.'));
            if (targetAssetType === 'media') alert(out('Please select an image or video file.'));
          }
          if (ok) {
            // if(callback) callback(s);
            if (callback) {
              // if s is base64 and there is data-filename attribute set
              var f;
              if (inpUrl.hasAttribute('data-filename')) f = inpUrl.getAttribute('data-filename');
              callback(s, f);
            }
          }
          desc.set.call(this, s);
        }
      });
    }
  }, {
    key: "renderSelectAsset",
    value: function renderSelectAsset(btn, targetAssetType, callback) {
      var _this13 = this;
      var _id = 'inp_' + this.util.makeId();
      btn.insertAdjacentHTML('afterend', "<input type=\"hidden\" id=\"".concat(_id, "\">"));
      var inpUrl = btn.parentNode.querySelector("#".concat(_id));
      btn.addEventListener('click', function () {
        _this13.openAsset(inpUrl, targetAssetType, btn);
      });
      var out = function out(s) {
        return _this13.util.out(s);
      };
      var desc = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
      Object.defineProperty(inpUrl, 'value', {
        get: desc.get,
        set: function set(s) {
          // Additional protection if normal selectAsset() is not used in asset dialog.
          // This is used if onImageSelectClick or onFileSelectClick are used.
          var filename = s.substring(s.lastIndexOf('/') + 1);
          var extension = filename.split('.').pop();
          extension = extension.toLowerCase();
          var ok = false;
          if (targetAssetType === 'all') {
            ok = true;
          } else if (targetAssetType === 'media') {
            if (s.includes('base64') || extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp' || extension === 'mp4') {
              ok = true;
            } else {
              alert(out('Please select an image or video file.'));
            }
          } else if (targetAssetType === 'video') {
            if (extension === 'mp4') {
              ok = true;
            } else {
              alert(out('Please select an mp4 file.'));
            }
          } else if (targetAssetType === 'image') {
            if (s.includes('base64') || extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp') {
              ok = true;
            } else {
              alert(out('Please select an image file.'));
            }
          } else if (targetAssetType === 'audio') {
            if (extension === 'mp3') {
              ok = true;
            } else {
              alert(out('Please select an mp3 file.'));
            }
          }
          if (ok) {
            // if(callback) callback(s);
            if (callback) {
              // if s is base64 and there is data-filename attribute set
              var f;
              if (inpUrl.hasAttribute('data-filename')) f = inpUrl.getAttribute('data-filename');
              callback(s, f);
            }
          }
          desc.set.call(this, s);
        }
      });
    }
  }, {
    key: "openOther",
    value: function openOther(targetInput, targetAssetType, theTrigger) {
      if (this.opts.onOtherSelectClick) {
        this.opts.onOtherSelectClick({
          targetInput: targetInput,
          theTrigger: theTrigger
        });
      } else {
        var iframe;
        var modal = this.builderStuff.querySelector('.is-modal.otherselect');
        iframe = modal.querySelector('iframe');
        if (iframe.src === 'about:blank') iframe.src = this.opts.otherSelect;
        this.util.showModal(modal, false, function () {
          theTrigger.removeAttribute('data-focus');
          theTrigger.focus();
        }, false, this.assetPanelFullScreen);
        this.targetInput = targetInput; // used by selectAsset() (see contentbuilder.js)
        this.targetCallback = null;
        this.targetAssetType = targetAssetType;
      }
    }
  }, {
    key: "openAsset",
    value: function openAsset(targetInput, targetAssetType, theTrigger, defaultValue) {
      var _this14 = this;
      var iframe;
      var modal;
      if (targetAssetType === 'media' && (this.opts.onMediaSelectClick || this.opts.onImageSelectClick)) {
        if (this.opts.onMediaSelectClick) {
          this.opts.onMediaSelectClick({
            targetInput: targetInput,
            theTrigger: theTrigger
          });
        } else {
          this.opts.onImageSelectClick({
            targetInput: targetInput,
            theTrigger: theTrigger
          });
        }
      } else if (targetAssetType === 'video' && this.opts.onVideoSelectClick) {
        this.opts.onVideoSelectClick({
          targetInput: targetInput,
          theTrigger: theTrigger
        });
      } else if (targetAssetType === 'image' && this.opts.onImageSelectClick) {
        this.opts.onImageSelectClick({
          targetInput: targetInput,
          theTrigger: theTrigger
        });
      } else if (targetAssetType === 'audio' && this.opts.onAudioSelectClick) {
        this.opts.onAudioSelectClick({
          targetInput: targetInput,
          theTrigger: theTrigger
        });
      } else if (targetAssetType === 'all' && this.opts.onFileSelectClick) {
        this.opts.onFileSelectClick({
          targetInput: targetInput,
          theTrigger: theTrigger
        });
      } else {
        if (targetAssetType === 'media') {
          modal = this.builderStuff.querySelector('.is-modal.mediaselect');
          iframe = modal.querySelector('iframe');
          if (iframe.src === 'about:blank') {
            if (this.opts.mediaSelect) iframe.src = this.opts.mediaSelect;else if (this.opts.imageSelect) iframe.src = this.opts.imageSelect;
          }
        } else if (targetAssetType === 'video') {
          modal = this.builderStuff.querySelector('.is-modal.videoselect');
          iframe = modal.querySelector('iframe');
          if (iframe.src === 'about:blank') iframe.src = this.opts.videoSelect;
        } else if (targetAssetType === 'image') {
          modal = this.builderStuff.querySelector('.is-modal.imageselect');
          iframe = modal.querySelector('iframe');
          if (iframe.src === 'about:blank') iframe.src = this.opts.imageSelect;
        } else if (targetAssetType === 'audio') {
          modal = this.builderStuff.querySelector('.is-modal.audioselect');
          iframe = modal.querySelector('iframe');
          if (iframe.src === 'about:blank') iframe.src = this.opts.audioSelect;
        } else if (targetAssetType === 'all') {
          modal = this.builderStuff.querySelector('.is-modal.fileselect');
          iframe = modal.querySelector('iframe');
          if (iframe.src === 'about:blank') iframe.src = this.opts.fileSelect;
        }
        this.util.showModal(modal, false, function () {
          theTrigger.removeAttribute('data-focus');
          theTrigger.focus();
        }, false, this.assetPanelFullScreen);
        this.targetInput = targetInput; // used by selectAsset() (see contentbuilder.js)
        this.targetCallback = null;
        this.targetAssetType = targetAssetType;
      }
      if (!defaultValue) defaultValue = '';
      if (targetInput && targetInput.value) {
        defaultValue = targetInput.value;
      }
      if (this.onAssetOpen) {
        if (iframe) {
          if (iframe.contentWindow.document.body.innerHTML !== '') {
            this.onAssetOpen(defaultValue, iframe.contentWindow);
          } else {
            iframe.addEventListener('load', function () {
              _this14.onAssetOpen(defaultValue, iframe.contentWindow);
            });
          }
        } else {
          this.onAssetOpen(defaultValue, iframe);
        }
      }
    }

    // Grid
  }, {
    key: "moveRowUp",
    value: function moveRowUp() {
      this._rowTool.moveRowUp();
    }
  }, {
    key: "moveRowDown",
    value: function moveRowDown() {
      this._rowTool.moveRowDown();
    }
  }, {
    key: "duplicateRow",
    value: function duplicateRow() {
      this._rowTool.duplicateRow();
    }
  }, {
    key: "removeRow",
    value: function removeRow() {
      this._rowTool.removeRow();
    }
  }, {
    key: "moveColumnLeft",
    value: function moveColumnLeft() {
      this.colTool.moveColumnLeft();
    }
  }, {
    key: "moveColumnRight",
    value: function moveColumnRight() {
      this.colTool.moveColumnRight();
    }
  }, {
    key: "duplicateColumn",
    value: function duplicateColumn() {
      this.colTool.duplicateColumn();
    }
  }, {
    key: "removeColumn",
    value: function removeColumn() {
      this.colTool.removeColumn();
    }
  }, {
    key: "moveColumnUp",
    value: function moveColumnUp() {
      this.colTool.moveColumnUp();
    }
  }, {
    key: "moveColumnDown",
    value: function moveColumnDown() {
      this.colTool.moveColumnDown();
    }

    // Text
  }, {
    key: "formatText",
    value: function formatText(command) {
      this.rte.formatText(command);
    }
  }, {
    key: "formatTextNonToggle",
    value: function formatTextNonToggle(command) {
      this.rte.formatTextNonToggle(command);
    }
  }, {
    key: "LightenDarkenColor",
    value: function LightenDarkenColor(col, amt) {
      // Backward compatibility (used by: Button Editor plugin)
      return this.util.LightenDarkenColor(col, amt);
    }
  }, {
    key: "pickColor",
    value: function pickColor(onPick, defaultcolor) {
      // Backward compatibility (used by: Button Editor plugin)
      var colorPicker = new contentbuilder_colorpicker({
        colors: this.opts.colors,
        animateModal: false,
        lang: this.opts.lang
      });
      colorPicker.open(onPick, defaultcolor);
    }
  }, {
    key: "addSnippet",
    value: function addSnippet(html, bSnippet, noedit) {
      //called by snippetlist.html
      this.util.addSnippet(html, bSnippet, noedit);
    }
  }, {
    key: "viewSnippets",
    value: function viewSnippets() {
      this.rte.viewSnippets();
    }
  }, {
    key: "saveForUndo",
    value: function saveForUndo(checkLater) {
      this.uo.saveForUndo(checkLater);
    }
  }, {
    key: "download",
    value: function download() {
      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      this["export"](options, true);
    }
  }, {
    key: "export",
    value: function _export() {
      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var shortenOutput = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      var pageTemplate = this.pageTemplate;
      var output = '';

      // [%CONTENT%]
      this.makeAbsolute = true; //To make absolute (for Export/Download)
      this.shortenOutput = shortenOutput;
      var html = this.html();
      this.makeAbsolute = false;
      this.shortenOutput = false;
      output = pageTemplate.replace('[%CONTENT%]', html);

      // Custom
      if (options.replace) {
        options.replace.forEach(function (rule) {
          output = output.replaceAll("".concat(rule[0]), rule[1]);
        });
      }

      // [%PATH%]
      if (options.path) {
        output = output.replaceAll('[%PATH%]', options.path);
      } else {
        var urlBase;
        urlBase = window.location.href.substring(0, window.location.href.lastIndexOf('/'));
        output = output.replaceAll('[%PATH%]', urlBase);
      }

      // Beautify
      output = this.beautify(output);
      var a = document.createElement('a');
      a.href = window.URL.createObjectURL(new Blob([output], {
        type: 'text/plain'
      }));
      a.download = 'page.html';
      a.click();
    }
  }, {
    key: "beautify",
    value: function beautify(html) {
      return this.htmlutil.beautify(html);
    }
  }, {
    key: "openPreview",
    value: function openPreview() {
      this.livePreview.openPreview();
    }
  }, {
    key: "closePreview",
    value: function closePreview() {
      this.livePreview.closePreview();
    }

    // Module related
  }, {
    key: "getActiveModule",
    value: function getActiveModule() {
      return this.doc.querySelector('[data-module-active]');
    }
  }, {
    key: "getModuleSettings",
    value: function getModuleSettings() {
      var activeModule = this.doc.querySelector('[data-module-active]'); //get active module 
      return decodeURIComponent(activeModule.getAttribute('data-settings'));
    }
  }, {
    key: "setModuleHtml",
    value: function setModuleHtml(html) {
      document.querySelector('#hidContentModuleCode').value = html; // See elementmodule.js
    }
  }, {
    key: "setModuleSettings",
    value: function setModuleSettings(settings) {
      document.querySelector('#hidContentModuleSettings').value = settings; // See elementmodule.js
    }
  }, {
    key: "makeId",
    value: function makeId() {
      return this.util.makeId();
    }
  }, {
    key: "setTooltip",
    value: function setTooltip(area) {
      this.tooltip.setAll(area);
    }

    // Plugins related
  }, {
    key: "loadPlugins",
    value: function loadPlugins() {
      var _this15 = this;
      if (!this.builderStuff) return; // in case of builder destroyed while plugins still loading

      if (typeof this.opts.scriptPath === 'undefined' && this.opts.pluginPath === '') return;
      this.numOfPlugins = 0;
      if (typeof this.opts.plugins[0] === 'string') {
        // backward compatible
        this.loadPluginsOldWay();
        return;
      }
      var rteTool = this.builderStuff.querySelector('.is-rte-tool');
      var rteMoreOptions = this.builderStuff.querySelector('.rte-more-options');
      var elementRteTool = this.builderStuff.querySelector('.is-elementrte-tool');
      var elementRteMoreOptions = this.builderStuff.querySelector('.elementrte-more-options');
      var i;
      var _loop = function _loop() {
        var pluginName = _this15.opts.plugins[i].name;
        var showInMainToolbar = _this15.opts.plugins[i].showInMainToolbar;
        var showInElementToolbar = _this15.opts.plugins[i].showInElementToolbar;

        // -- Check if button exists
        var buttonExistOnMainToolbar = false;
        if (rteTool.querySelector('[data-plugin="' + pluginName + '"]') || rteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]')) {
          buttonExistOnMainToolbar = true;
        }
        var buttonExistOnElementToolbar = false;
        if (elementRteTool.querySelector('[data-plugin="' + pluginName + '"]') || elementRteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]')) {
          buttonExistOnElementToolbar = true;
        }
        // -- 

        if (showInMainToolbar && !buttonExistOnMainToolbar) {
          var divs = rteMoreOptions.querySelectorAll('div:not(.rte-separator)');
          divs.forEach(function (div) {
            div.insertAdjacentHTML('afterbegin', '<button style="width:46px;" title="button not found" data-plugin="' + pluginName + '"></button>');
          });
        }
        if (showInElementToolbar && !buttonExistOnElementToolbar) {
          elementRteMoreOptions.querySelector('div').insertAdjacentHTML('afterbegin', '<button style="width:46px;" title="button not found" data-plugin="' + pluginName + '"></button>');
        }
      };
      for (i = this.opts.plugins.length - 1; i >= 0; i--) {
        _loop();
      }
      for (i = 0; i < this.opts.plugins.length; i++) {
        var pluginName = this.opts.plugins[i].name;
        var pluginFile = this.opts.scriptPath + 'plugins/' + pluginName + '/plugin.js';
        if (this.opts.pluginPath !== '') pluginFile = this.opts.pluginPath + 'plugins/' + pluginName + '/plugin.js';
        this.loadScript(pluginFile).then(function () {
          _this15.numOfPlugins++;
          if (_this15.numOfPlugins === _this15.opts.plugins.length) {
            if (_this15.opts.onPluginsLoaded) {
              _this15.opts.onPluginsLoaded();
            }
            _this15.tooltip.setAll();
            new contentbuilder_draggable({
              selector: '.is-draggable'
            }); //draggable for plugins

            // setTimeout(()=>{
            //     this.rte.positionRteMore();
            //     this.rte.positionElementRteMore();
            // }, 10);
          }
        });
      }
    }
  }, {
    key: "loadPluginsOldWay",
    value: function loadPluginsOldWay() {
      var _this16 = this;
      var rteTool = this.builderStuff.querySelector('.is-rte-tool');
      var rteMoreOptions = this.builderStuff.querySelector('.rte-more-options');
      var elementRteTool = this.builderStuff.querySelector('.is-elementrte-tool');
      var elementRteMoreOptions = this.builderStuff.querySelector('.elementrte-more-options');
      var i;
      for (i = this.opts.plugins.length - 1; i >= 0; i--) {
        var pluginName = this.opts.plugins[i];

        // -- Check if button exists
        var buttonExistOnMainToolbar = false;
        if (rteTool.querySelector('[data-plugin="' + pluginName + '"]') || rteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]')) {
          buttonExistOnMainToolbar = true;
        }
        var buttonExistOnElementToolbar = false;
        if (elementRteTool.querySelector('[data-plugin="' + pluginName + '"]') || elementRteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]')) {
          buttonExistOnElementToolbar = true;
        }
        // -- 

        if (!buttonExistOnMainToolbar) {
          rteMoreOptions.querySelector('div').insertAdjacentHTML('afterbegin', '<button style="width:46px;" title="button not found" data-plugin="' + this.opts.plugins[i] + '"></button>');
        }
        if (!buttonExistOnElementToolbar) {
          elementRteMoreOptions.querySelector('div').insertAdjacentHTML('afterbegin', '<button style="width:46px;" title="button not found" data-plugin="' + this.opts.plugins[i] + '"></button>');
        }
      }
      for (i = 0; i < this.opts.plugins.length; i++) {
        var pluginFile = this.opts.scriptPath + 'plugins/' + this.opts.plugins[i] + '/plugin.js';
        if (this.opts.pluginPath !== '') pluginFile = this.opts.pluginPath + 'plugins/' + this.opts.plugins[i] + '/plugin.js';
        this.loadScript(pluginFile).then(function () {
          _this16.numOfPlugins++;
          if (_this16.numOfPlugins === _this16.opts.plugins.length) {
            // All plugin scripts loaded
            var pluginbuttons = rteMoreOptions.querySelectorAll('[data-plugin]');
            Array.prototype.forEach.call(pluginbuttons, function (pluginbutton) {
              pluginbutton.outerHTML = ''; //Remove unused buttons (if loaded plugins don't use button)
            });

            pluginbuttons = elementRteMoreOptions.querySelectorAll('[data-plugin]');
            Array.prototype.forEach.call(pluginbuttons, function (pluginbutton) {
              pluginbutton.outerHTML = ''; //Remove unused buttons (if loaded plugins don't use button)
            });

            if (_this16.opts.onPluginsLoaded) {
              _this16.opts.onPluginsLoaded();
            }
            _this16.tooltip.setAll();
            new contentbuilder_draggable({
              selector: '.is-draggable'
            }); //draggable for plugins

            // setTimeout(()=>{
            //     this.rte.positionRteMore();
            //     this.rte.positionElementRteMore();
            // }, 10);
          }
        });
      }
    }
  }, {
    key: "addHtml",
    value: function addHtml(html) {
      this.dom.appendHtml(this.builderStuff, html);
    }
  }, {
    key: "addCss",
    value: function addCss(css) {
      this.dom.appendHtml(document.head, css);
    }
  }, {
    key: "addButton_OLD",
    value: function addButton_OLD(pluginName, html, selector, exec) {
      var _this17 = this;
      if (!this.builderStuff) return;
      var rteTool = this.builderStuff.querySelector('.is-rte-tool');
      var rteMoreOptions = this.builderStuff.querySelector('.rte-more-options');
      var bUseMore = false;
      if (rteTool.querySelector('[data-plugin="' + pluginName + '"]')) {
        //if plugin button exists on the toolbar
        rteTool.querySelector('[data-plugin="' + pluginName + '"]').outerHTML = html;
      } else if (rteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]')) {
        //if plugin button exists on the more popup
        rteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]').outerHTML = html;
        bUseMore = true;
      } /*else {
          rteMoreOptions.querySelector('div').insertAdjacentHTML('afterbegin', html);
          bUseMore = true;
        }*/

      // Add More button if needed
      if (!rteTool.querySelector('.rte-more') && bUseMore) {
        rteTool.insertAdjacentHTML('beforeend', "<button title=\"".concat(this.util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>"));
        var btnRteMore = this.rteTool.querySelector('button.rte-more');
        if (btnRteMore) this.dom.addEventListener(btnRteMore, 'click', function () {
          _this17.rte.showRteMore();
        });
      }

      // Add event to the button
      var btnPlugin = rteTool.querySelector(selector);
      btnPlugin = btnPlugin ? btnPlugin : rteMoreOptions.querySelector(selector);
      if (btnPlugin) {
        // Prepare for tooltip
        btnPlugin.setAttribute('data-title', btnPlugin.getAttribute('title'));
        this.dom.addEventListener(btnPlugin, 'click', function (e) {
          exec(e);
        });
      }
    }
  }, {
    key: "addButton",
    value: function addButton(pluginName, html, selector, exec) {
      var _this18 = this;
      if (!this.builderStuff) return;
      if (this.controlPanel && this.controlpanel.controlPanel) {
        var popMore = this.controlpanel.controlPanel.querySelector('.panel-pop.more');
        var pluginArea = popMore.querySelector('div.plugins');
        pluginArea.insertAdjacentHTML('beforeend', html);
        var btn = popMore.querySelector(selector);
        btn.addEventListener('click', function (e) {
          exec(e);
        });
        var label = popMore.querySelector('.label-plugins');
        label.style.display = ''; //show label
      }

      var rteTool = this.builderStuff.querySelector('.is-rte-tool');
      var rteMoreOptions = this.builderStuff.querySelector('.rte-more-options');
      var bUseMore = false;
      if (rteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]')) {
        //if plugin button exists on the more popup
        bUseMore = true;
      }

      // Replace buttons
      var btnPlugins = this.builderStuff.querySelectorAll('[data-plugin="' + pluginName + '"]');
      btnPlugins.forEach(function (btn) {
        btn.outerHTML = html;
      });

      // Add More button if needed
      if (!rteTool.querySelector('.rte-more') && bUseMore) {
        rteTool.insertAdjacentHTML('beforeend', "<button title=\"".concat(this.util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>"));
        var btnRteMore = this.rteTool.querySelector('button.rte-more');
        if (btnRteMore) this.dom.addEventListener(btnRteMore, 'click', function () {
          _this18.rte.showRteMore();
        });
      }
      var btnPlugin = rteTool.querySelectorAll(selector);
      btnPlugin.forEach(function (btn) {
        // Prepare for tooltip
        btn.setAttribute('data-title', btn.getAttribute('title'));
        _this18.dom.addEventListener(btn, 'click', function (e) {
          exec(e);
        });
      });
      btnPlugin = rteMoreOptions.querySelectorAll(selector);
      btnPlugin.forEach(function (btn) {
        // Prepare for tooltip
        btn.setAttribute('data-title', btn.getAttribute('title'));
        _this18.dom.addEventListener(btn, 'click', function (e) {
          exec(e);
        });
      });
    }

    // Element Toolbar
  }, {
    key: "addButton2",
    value: function addButton2(pluginName, html, selector, exec) {
      var _this19 = this;
      if (!this.builderStuff) return;
      var elementRteTool = this.builderStuff.querySelector('.is-elementrte-tool');
      var elementRteMoreOptions = this.builderStuff.querySelector('.elementrte-more-options');
      var bUseMore = false;
      if (elementRteTool.querySelector('[data-plugin="' + pluginName + '"]')) {
        //if plugin button exists on the toolbar
        elementRteTool.querySelector('[data-plugin="' + pluginName + '"]').outerHTML = html;
      } else if (elementRteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]')) {
        //if plugin button exists on the more popup
        elementRteMoreOptions.querySelector('[data-plugin="' + pluginName + '"]').outerHTML = html;
        bUseMore = true;
      } /*else {
          elementRteMoreOptions.querySelector('div').insertAdjacentHTML('afterbegin', html);
          bUseMore = true;
        }*/

      // Add More button if needed
      if (!elementRteTool.querySelector('.rte-more') && bUseMore) {
        elementRteTool.insertAdjacentHTML('beforeend', "<button title=\"".concat(this.util.out('More'), "\" class=\"rte-more\"><svg class=\"is-icon-flex\" style=\"width:13px;height:13px;\"><use xlink:href=\"#ion-more\"></use></svg></button>"));
        var btnRteMore = this.elementRteTool.querySelector('button.rte-more');
        if (btnRteMore) this.dom.addEventListener(btnRteMore, 'click', function () {
          _this19.rte.showElementRteMore();
        });
      }

      // Add event to the button
      var btnPlugin = elementRteTool.querySelector(selector);
      btnPlugin = btnPlugin ? btnPlugin : elementRteMoreOptions.querySelector(selector);
      if (btnPlugin) {
        // Prepare for tooltip
        btnPlugin.setAttribute('data-title', btnPlugin.getAttribute('title'));
        this.dom.addEventListener(btnPlugin, 'click', function (e) {
          exec(e);
        });
      }
    }
  }, {
    key: "showModal",
    value: function showModal(modal, overlayStay, cancelCallback, animated, overflowHidden) {
      this.util.showModal(modal, overlayStay, cancelCallback, animated, overflowHidden);
    }
  }, {
    key: "hideModal",
    value: function hideModal(modal) {
      this.util._hideModal(modal); // this _hideModal will also trigger cancelCallback defined by showModal. This is done by programmatically click the overlay.
    }
  }, {
    key: "draggable",
    value: function draggable(selector) {
      new contentbuilder_draggable({
        selector: selector
      });
    }
  }, {
    key: "createModal",
    value: function createModal(modal, selector, overlayStay, cancelCallback, animated, overflowHidden) {
      var embeddedModal = this.builderStuff.querySelector(selector);
      if (!embeddedModal) {
        this.builderStuff.appendChild(modal);
        embeddedModal = this.builderStuff.querySelector(selector);
      }
      this.showModal(embeddedModal, overlayStay, cancelCallback, animated, overflowHidden);
      new contentbuilder_draggable({
        selector: '.is-draggable'
      });
      return embeddedModal;
    }
  }, {
    key: "getIcons",
    value: function getIcons() {
      return this.rte.getIcons();
    }
  }, {
    key: "showSidePanel",
    value: function showSidePanel(panel) {
      var _this20 = this;
      var panels = this.builderStuff.querySelectorAll('.is-side');
      Array.prototype.forEach.call(panels, function (panel) {
        _this20.dom.removeClass(panel, 'active');
      });
      this.dom.addClass(panel, 'active');
    }
  }, {
    key: "hideSidePanel",
    value: function hideSidePanel(panel) {
      this.dom.removeClass(panel, 'active');
    }
  }, {
    key: "getScriptPath",
    value: function getScriptPath() {
      return this.opts.scriptPath;
    }
  }, {
    key: "getSnippetPath",
    value: function getSnippetPath() {
      // return this.opts.snippetData.substring(0, this.opts.snippetData.lastIndexOf('/') + 1);
      return this.opts.snippetPath;
    }
  }, {
    key: "out",
    value: function out(text) {
      return this.util.out(text);
    }
  }, {
    key: "undo",
    value: function undo() {
      this.uo.doUndo();
    }
  }, {
    key: "redo",
    value: function redo() {
      this.uo.doRedo();
    }
  }, {
    key: "getScope",
    value: function getScope() {
      var area;
      var builders = this.doc.querySelectorAll(this.opts.container);
      if (builders.length > 1) {
        var cell = this.util.cellSelected();
        if (!cell) {
          // Return first instance
          area = builders[0];
        } else {
          // Return active instance
          area = cell.parentNode.parentNode;
        }
      } else {
        // Single instance
        area = builders[0];
      }
      if (this.opts.page !== '') {
        var wrapper = this.doc.querySelector(this.opts.page);
        if (wrapper) {
          //return wrapper
          area = wrapper;
        }
      }
      return area;
    }
  }, {
    key: "saveSelection",
    value: function saveSelection() {
      this.util.saveSelection();
    }
  }, {
    key: "restoreSelection",
    value: function restoreSelection() {
      this.util.restoreSelection();
    }
  }, {
    key: "pasteHtmlAtCaret",
    value: function pasteHtmlAtCaret(html, selectPastedContent) {
      this.util.pasteHtmlAtCaret(html, selectPastedContent);
    }
  }, {
    key: "getScript",
    value: function getScript(scriptUrl, callback) {
      this.loadScript(scriptUrl).then(function () {
        if (callback) callback();
      }, function () {
        console.log('Fail to load config');
      });
    }
  }, {
    key: "getScripts",
    value: function getScripts(scriptUrls, callback) {
      var _this21 = this;
      var count = 0;

      //console.log(count)
      var a = this.loadScript(scriptUrls[count]);
      a.then(function () {
        count = _this21._helper1(count, scriptUrls, callback);
      });
    }
  }, {
    key: "_helper1",
    value: function _helper1(count, scriptUrls, callback) {
      var _this22 = this;
      count++;
      if (count < scriptUrls.length) {
        //console.log(count)
        var a = this.loadScript(scriptUrls[count]);
        a.then(function () {
          count = _this22._helper1(count, scriptUrls, callback);
        });
        return count;
      } else {
        if (callback) callback();
      }
    }
  }, {
    key: "includeJs",
    value: function includeJs(filename, callback) {
      if (this.filesAdded.indexOf('[' + filename + ']') === -1) {
        this.getScript(filename, callback);
        this.filesAdded += '[' + filename + ']';
      } else {
        //alert('already added');
        if (callback) callback();
      }
    }
  }, {
    key: "includeCss",
    value: function includeCss(filename) {
      if (this.filesAdded.indexOf('[' + filename + ']') === -1) {
        var inc = document.createElement('link');
        inc.setAttribute('rel', 'stylesheet');
        inc.setAttribute('href', filename);
        document.getElementsByTagName('head')[0].appendChild(inc);
        this.filesAdded += '[' + filename + ']';
      } else {
        //alert('already added');
      }
    }
  }, {
    key: "applyStyle",
    value: function applyStyle(id, s) {
      if (this.filesAdded.indexOf('[' + id + ']') === -1) {
        var inc = document.createElement('style');
        inc.innerHTML = s;
        document.getElementsByTagName('head')[0].appendChild(inc);
        this.filesAdded += '[' + id + ']';
      } else {
        //alert('already added');
      }
    }
    // /Plugins related
  }, {
    key: "viewHtml",
    value: function viewHtml(area) {
      if (this.docContainer) {
        // freeform
        area = this.doc.querySelector(this.docContainer);
      }
      this.htmlutil.view('full', area);
    }
  }, {
    key: "viewPreferences",
    value: function viewPreferences() {
      if (this.preferences) this.preferences.view();
    }
  }, {
    key: "viewConfig",
    value: function viewConfig() {
      //backward
      if (this.preferences) this.preferences.view();
    }
  }, {
    key: "viewZoom",
    value: function viewZoom() {
      this.rte.viewZoom();
    }
  }, {
    key: "loadSnippets",
    value: function loadSnippets(snippetFile, snippetOpen) {
      var _this23 = this;
      if (this.preview) return;
      if (this.opts.snippetList === '#divSnippetList') {
        var snippetPanel = document.querySelector(this.opts.snippetList);
        if (snippetPanel) {
          if (snippetOpen) openSnippets(this);
          return; // do not render if already rendered (just protection)
        }
      }

      if (this.isScriptAlreadyIncluded(snippetFile)) return;
      var script = document.createElement('script');
      script.src = snippetFile;
      script.async = true;
      script.onload = function () {
        _this23.opts.snippetJSON = window.data_basic;
        // if snippetPath is specified (not empty), then use the specified. Otherwise, use the one generated from snippet file (_snippets_path)
        if (_this23.opts.snippetPath === '') {
          _this23.opts.snippetPath = window._snippets_path;
        }
        if (_this23.opts.snippetJSON.snippets.length > 0) {
          snippetpanel(_this23, snippetOpen); // Render Snippet Panel
        }
      };

      document.body.appendChild(script);
    }
  }, {
    key: "isScriptAlreadyIncluded",
    value: function isScriptAlreadyIncluded(src) {
      var scripts = document.getElementsByTagName('script');
      for (var i = 0; i < scripts.length; i++) {
        if (scripts[i].getAttribute('src') === src) return true;
      }
      return false;
    }
  }, {
    key: "loadHtml",
    value: function loadHtml(html, area) {
      var _this24 = this;
      if (this.canvas && !this.isContentBox && this.docContainer) {
        // freeform
        var docContainer = this.doc.querySelector(this.docContainer);
        var _range = this.doc.createRange();
        docContainer.innerHTML = '';
        if (!html.includes('is-box')) {
          html = "\n                <div class=\"is-box box-canvas autolayout\">\n                    <div class=\"is-block block-steady height-auto\" style=\"top: calc(50% - 357px); left: calc(50% - 348px); width: 696px;\" data--t=\"calc(50% - 357px)\" data--l=\"calc(50% - 348px)\" data--b=\"\" data--r=\"\" data--w=\"696px\" data--h=\"\">\n                        <div class=\"is-container\">\n                            ".concat(html, "\n                        </div>\n                        <div class=\"is-block-overlay\"></div>\n                    </div>\n                </div>\n                ");
        }
        docContainer.appendChild(_range.createContextualFragment(html)); // We use createContextualFragment so that embedded javascript code (code block) will be executed

        // set page size 
        var s;
        var elm = docContainer.querySelector('[data-pagesize]');
        if (elm) {
          s = elm.getAttribute('data-pagesize');
        } else {
          if (localStorage.getItem('_pagesize') === '' || localStorage.getItem('_pagesize')) {
            s = localStorage.getItem('_pagesize');
          } else {
            s = this.pageSize || '';
          }
        }
        this.setPageSize(s);
        this.applyBehaviorCanvas();
        var builders = docContainer.querySelectorAll(this.container);
        builders.forEach(function (builder) {
          _this24.applyBehaviorOn(builder);
        });
        this.refresh();
        if (this.win.Block) {
          this.win.Block.render();
        }
        return;
      }
      var util = this.util;
      if (area) {
        //return area
      } else {
        var _builders3 = this.doc.querySelectorAll(this.opts.container);
        if (_builders3.length > 1) {
          var cell = util.cellSelected();
          if (!cell) {
            // Return first instance
            area = _builders3[0];
          } else {
            // Return active instance
            area = cell.parentNode.parentNode;
          }
        } else {
          // Single instance
          area = _builders3[0];
        }
        if (this.opts.page !== '') {
          var wrapper = this.doc.querySelector(this.opts.page);
          if (wrapper) {
            //return wrapper
            area = wrapper;
          }
        }
      }

      // area.innerHTML = html;
      var range = this.doc.createRange();
      area.innerHTML = '';
      area.appendChild(range.createContextualFragment(html)); // We use createContextualFragment so that embedded javascript code (code block) will be executed

      this.applyBehavior();

      // this.uo.saveForUndo(); //First time

      //Trigger Change event
      this.opts.onChange();

      //Trigger Render event
      this.opts.onRender();
      if (localStorage.getItem('_livepreview') != null) {
        this.livePreview.openPreview();
      }
    }
    // loadHtml(html) {

    //     let area = this.getScope();
    //     area.innerHTML = html;

    //     this.builder.applyBehavior();

    //     //Trigger Change event
    //     this.builder.opts.onChange();

    //     //Trigger Render event
    //     this.builder.opts.onRender();
    // }
  }, {
    key: "loadHTML",
    value: function loadHTML(html) {
      //backward

      this.loadHtml(html);
    }
  }, {
    key: "setUIColor",
    value: function () {
      var _setUIColor = contentbuilder_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(mode, csslink) {
        var _this25 = this;
        var cssLink, link, util;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                // Get previous css
                cssLink = document.querySelector('[data-cb-color]');
                if (cssLink) cssLink.setAttribute('data-cb-del', '');
                // if(cssLink) cssLink.parentNode.removeChild(cssLink);

                // Add new css
                if (!csslink) {
                  _context.next = 11;
                  break;
                }
                link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = csslink;
                link.setAttribute('data-cb-color', '');
                link.addEventListener('load', function () {
                  // Remove previous css
                  cssLink = document.querySelector('[data-cb-del]');
                  if (cssLink) cssLink.parentNode.removeChild(cssLink);
                  if (mode === 'dark') {
                    _this25.dom.removeClass(document.body, 'colored');
                    _this25.dom.removeClass(document.body, 'colored-dark');
                    _this25.dom.removeClass(document.body, 'light');
                    _this25.dom.addClass(document.body, 'dark');
                  }
                  if (mode === 'colored') {
                    _this25.dom.removeClass(document.body, 'dark');
                    _this25.dom.removeClass(document.body, 'colored-dark');
                    _this25.dom.removeClass(document.body, 'light');
                    _this25.dom.addClass(document.body, 'colored');
                  }
                  if (mode === 'colored-dark') {
                    _this25.dom.removeClass(document.body, 'dark');
                    _this25.dom.removeClass(document.body, 'colored');
                    _this25.dom.removeClass(document.body, 'light');
                    _this25.dom.addClass(document.body, 'colored-dark');
                  }
                  if (mode === '') {
                    _this25.dom.removeClass(document.body, 'dark');
                    _this25.dom.removeClass(document.body, 'colored-dark');
                    _this25.dom.removeClass(document.body, 'colored');
                    _this25.dom.removeClass(document.body, 'light');
                  }
                  if (mode === 'light') {
                    _this25.dom.removeClass(document.body, 'dark');
                    _this25.dom.removeClass(document.body, 'colored-dark');
                    _this25.dom.removeClass(document.body, 'colored');
                    _this25.dom.addClass(document.body, 'light');
                  }

                  // Css loaded. Now we can get UI styles.
                  var util = _this25.util;

                  // util.getUIStyles();

                  // this.setUIColorRefresh();

                  // if(this.opts.onThemeChange) this.opts.onThemeChange();

                  setTimeout(function () {
                    util.getUIStyles();
                    _this25.setUIColorRefresh();
                    if (_this25.opts.onThemeChange) _this25.opts.onThemeChange();
                  }, 300);
                });
                document.head.appendChild(link);
                _context.next = 20;
                break;
              case 11:
                // Remove previous css
                cssLink = document.querySelector('[data-cb-del]');
                if (cssLink) cssLink.parentNode.removeChild(cssLink);
                if (mode === '') {
                  this.dom.removeClass(document.body, 'dark');
                  this.dom.removeClass(document.body, 'colored-dark');
                  this.dom.removeClass(document.body, 'colored');
                  this.dom.removeClass(document.body, 'light');
                }

                // Css loaded. Now we can get UI styles.
                util = this.util; // util.getUIStyles();
                // this.setUIColorRefresh();
                // if(this.opts.onThemeChange) this.opts.onThemeChange();
                _context.next = 17;
                return this.delay(1000);
              case 17:
                // setTimeout(()=>{
                util.getUIStyles();
                this.setUIColorRefresh();
                if (this.opts.onThemeChange) this.opts.onThemeChange();
                // }, 1000);
              case 20:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));
      function setUIColor(_x, _x2) {
        return _setUIColor.apply(this, arguments);
      }
      return setUIColor;
    }()
  }, {
    key: "delay",
    value: function () {
      var _delay = contentbuilder_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(ms) {
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                return _context2.abrupt("return", new Promise(function (resolve) {
                  return setTimeout(resolve, ms);
                }));
              case 1:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));
      function delay(_x3) {
        return _delay.apply(this, arguments);
      }
      return delay;
    }()
  }, {
    key: "setUIColorRefresh",
    value: function setUIColorRefresh() {
      var _this26 = this;
      // All related with iframe style

      if (!this.rte || !this.element) {
        // || this.element
        setTimeout(function () {
          // console.log('Not ready, delay 1!');
          _this26.setUIColorRefresh();
        }, 600);
        return;
      }

      // Snippets (Modal)
      var modalSnippets = this.builderStuff.querySelector('.snippets');
      modalSnippets.querySelector('iframe').src = 'about:blank';
      var modal1 = document.querySelector('.is-modal.videoselect');
      var modal2 = document.querySelector('.is-modal.imageselect');
      var modal3 = document.querySelector('.is-modal.fileselect');
      var modal4 = document.querySelector('.is-modal.otherselect');
      var modal5 = document.querySelector('.is-modal.audioselect');
      var modal6 = document.querySelector('.is-modal.mediaselect');
      var modalIframe1 = modal1.querySelector('iframe');
      var modalIframe2 = modal2.querySelector('iframe');
      var modalIframe3 = modal3.querySelector('iframe');
      var modalIframe4 = modal4.querySelector('iframe');
      var modalIframe5 = modal5.querySelector('iframe');
      var modalIframe6 = modal6.querySelector('iframe');
      if (modalIframe1.contentWindow.applyParentStyles) modalIframe1.contentWindow.applyParentStyles();
      if (modalIframe2.contentWindow.applyParentStyles) modalIframe2.contentWindow.applyParentStyles();
      if (modalIframe3.contentWindow.applyParentStyles) modalIframe3.contentWindow.applyParentStyles();
      if (modalIframe4.contentWindow.applyParentStyles) modalIframe4.contentWindow.applyParentStyles();
      if (modalIframe5.contentWindow.applyParentStyles) modalIframe5.contentWindow.applyParentStyles();
      if (modalIframe6.contentWindow.applyParentStyles) modalIframe6.contentWindow.applyParentStyles();
    }
  }, {
    key: "openMedia",
    value: function openMedia(elm) {
      var url = '';
      var theme = elm.getAttribute('data-modal-theme');
      if (!theme) theme = 'light';
      var color = elm.getAttribute('data-modal-color');
      if (elm.getAttribute('data-modal-url')) {
        url = elm.getAttribute('data-modal-url');
        var extension = url.split('.').pop().split('?')[0].split('#')[0]; //

        if (url.includes('base64') || extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp') {
          this.lightbox.openImage(url, theme, color);
        } else if (extension === 'mp4') {
          this.lightbox.openVideo(url, 'dark', color);
        } else if (url.toLowerCase().indexOf('youtube.com') !== -1 || url.toLowerCase().indexOf('youtube-nocookie.com') !== -1 || url.toLowerCase().indexOf('vimeo.com') !== -1) {
          this.lightbox.openExternalVideo(url, 'dark', color);
        } else {
          if (url.indexOf('#') === 0) {
            // Do Nothing
          } else {
            // Will go to the link
            var answer = window.confirm(this.util.out('Do you really want to leave?'));
            // cancel the navigation and stay on the same page
            if (!answer) {
              return false;
            }
          }
          window.location.href = url;
        }
      } else {
        // Other options
        if (elm.getAttribute('data-modal-image')) {
          url = elm.getAttribute('data-modal-image');
          this.lightbox.openImage(url, theme, color);
        }
        if (elm.getAttribute('data-modal-video')) {
          url = elm.getAttribute('data-modal-video');
          this.lightbox.openVideo(url, 'dark', color);
        }
        if (elm.getAttribute('data-modal-externalvideo')) {
          url = elm.getAttribute('data-modal-externalvideo');
          this.lightbox.openExternalVideo(url, 'dark', color);
        }
      }
    }
  }, {
    key: "upscaleImage",
    value: function () {
      var _upscaleImage = contentbuilder_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(src, callback) {
        var _this27 = this;
        var width, height, img;
        return regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                if (this.viewImageUrl) {
                  src = this.viewImageUrl + '?url=' + src;
                }
                if (src.includes('http') && this.viewFileUrl) {
                  /*
                  Can be from:
                  External site, 
                  ex:
                      http://bucket-name.s3-website-us-east-1.amazonaws.com/readme.txt
                  */
                  src = this.viewFileUrl + '?url=' + src;
                }
                width = 512;
                height = 512;
                img = new Image();
                img.src = src;
                img.crossOrigin = 'anonymous';
                img.onload = /*#__PURE__*/contentbuilder_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
                  var canvas, ctx, resizedBase64, image, messages, response, result;
                  return regeneratorRuntime.wrap(function _callee3$(_context3) {
                    while (1) {
                      switch (_context3.prev = _context3.next) {
                        case 0:
                          canvas = document.createElement('canvas');
                          canvas.width = width;
                          canvas.height = height;
                          ctx = canvas.getContext('2d');
                          ctx.drawImage(img, 0, 0, width, height);
                          resizedBase64 = canvas.toDataURL('image/jpeg');
                          image = resizedBase64;
                          image = image.replace(/^data:image\/(png|jpeg);base64,/, '');
                          messages = {
                            image: image,
                            folder_path: ''
                          };
                          _context3.next = 11;
                          return fetch(_this27.upscaleImageUrl, {
                            signal: _this27.signal,
                            // Abort
                            method: 'POST',
                            headers: {
                              'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(messages)
                          });
                        case 11:
                          response = _context3.sent;
                          _context3.next = 14;
                          return response.json();
                        case 14:
                          result = _context3.sent;
                          callback(result.url);
                        case 16:
                        case "end":
                          return _context3.stop();
                      }
                    }
                  }, _callee3);
                }));
              case 8:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));
      function upscaleImage(_x4, _x5) {
        return _upscaleImage.apply(this, arguments);
      }
      return upscaleImage;
    }()
  }, {
    key: "generateImage",
    value: function () {
      var _generateImage = contentbuilder_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(prompt, callback) {
        var model, negative_prompt, steps, guidance, scheduler, messages, url, response, result, imageUrl;
        return regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                this.controller = new AbortController(); // Create a new AbortController
                this.signal = this.controller.signal; // Get a new signal object
                model = this.imageModel || 'realistic-vision-v3';
                negative_prompt = this.imageNegativePrompt || 'duplicate, (deformed iris, deformed pupils, semi-realistic, cgi, 3d, render, sketch, cartoon, drawing, anime:1.4), text, close up, cropped, out of frame, worst quality, low quality, jpeg artifacts, ugly, duplicate, morbid, mutilated, extra fingers, mutated hands, poorly drawn hands, poorly drawn face, mutation, deformed, blurry, dehydrated, bad anatomy, bad proportions, extra limbs, cloned face, disfigured, gross proportions, malformed limbs, missing arms, missing legs, extra arms, extra legs, fused fingers, too many fingers, long neck, bad_prompt_version2, bad-hands-5, badhandv4, bad anatomy, deformed, mutated, amputated, missing finger, extra finger, fused fingers, missing leg, extra leg, fused legs, missing digit, extra digit, fused digits, missing hand, extra hand, fused hands, missing arm, extra arm, fused arms, missing limb, extra limb, fused limbs, fused bodies, merged bodies, extra bodies, dual bodies, extra navel, elongated body, missing joint, extra joint, fused joints, deformed hip, twisted limbs, twisted legs, twisted arms, missing head, extra head, double head, twins, missing ear, extra ear, deformed ear, black and white, monochrome, multiple views, blurry, text, signature, head out of frame, paintings, sketches, (worst quality:2), (low quality:2), (normal quality:2), lowres, grayscale, glans, bad hands, error, extra digit, fewer digits, cropped, jpeg artifacts, watermark, username, bad feet, poorly drawn hands, poorly drawn face, mutation, too many fingers, long neck, long body, long arms, cross-eyed, mutated hands, polar lowres, bad body, bad proportions, gross proportions, cropped head , bad eyes, extra breast, missing breast, fused breasts, unnatural proportions, necklace';
                steps = this.imageSteps || 25;
                guidance = this.imageGuidance || 7.5;
                scheduler = this.imageScheduler || 'dpmsolver++';
                messages = {
                  model: model,
                  prompt: prompt,
                  negative_prompt: negative_prompt,
                  width: 512,
                  height: 512,
                  steps: steps,
                  guidance: guidance,
                  scheduler: scheduler,
                  output_format: 'jpeg',
                  folder_path: ''
                };
                _context5.prev = 8;
                url = this.textToImageUrl;
                _context5.next = 12;
                return fetch(url, {
                  signal: this.signal,
                  // Abort
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(messages)
                });
              case 12:
                response = _context5.sent;
                _context5.next = 15;
                return response.json();
              case 15:
                result = _context5.sent;
                if (!result.error) {
                  _context5.next = 19;
                  break;
                }
                console.log('Error:\n' + result.error);
                return _context5.abrupt("return");
              case 19:
                imageUrl = result.url;
                if (this.imageAutoUpscale) {
                  this.upscaleImage(imageUrl, callback);
                } else {
                  callback(imageUrl);
                }
                _context5.next = 26;
                break;
              case 23:
                _context5.prev = 23;
                _context5.t0 = _context5["catch"](8);
                if (_context5.t0.name === 'AbortError') {
                  // Do Nothing
                  // console.log('Request aborted by user.');
                } else {
                  // CORS or code errors goes here
                  console.error('Error:', _context5.t0);
                  // console.log('Error:\n'+error);

                  this.dictation.finish(); // Must be called after finished
                }
              case 26:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this, [[8, 23]]);
      }));
      function generateImage(_x6, _x7) {
        return _generateImage.apply(this, arguments);
      }
      return generateImage;
    }()
    /* OpenAI
    // Requires:
    // generateImageUrl: '/generateimage',
    // uploadBase64Url:'/uploadbase64',
     async generateImage(prompt, num, callback) {
         if(!(this.generateImageUrl && this.uploadBase64Url)) return;
         this.controller = new AbortController(); // Create a new AbortController
        this.signal = this.controller.signal; // Get a new signal object
         const messages = { prompt, num };
         try {
             const response = await fetch(this.generateImageUrl, {
                signal: this.signal, // Abort
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(messages),
            });
    
            const result = await response.json();
    
            if(result.error) {
                console.log('Error:\n'+result.error);
                return;
            }
    
            const filename = result.filename;
    
            let images = [];
    
            const numOfImages = result.data.data.length;
    
            const imageList = result.data.data;
            imageList.forEach(item=>{
                const base64 = item.b64_json;
                const src = `data:image/jpeg;base64,${base64}`;
    
                var newWidth = 1024;
                var newHeight = 1024;
                var img = new Image();
                img.src = src;
                img.onload = () => {
    
                    var canvas = document.createElement('canvas');
                    canvas.width = newWidth;
                    canvas.height = newHeight;
    
                    var ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                    var resizedBase64 = canvas.toDataURL('image/jpeg');
    
                    let image = resizedBase64;
                    image = image.replace(/^data:image\/(png|jpeg);base64,/, '');
    
                    const reqBody = { image: image, filename: filename };
                    fetch(this.uploadBase64Url, {
                        method:'POST',
                        body: JSON.stringify(reqBody),
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    })
                        .then(response=>response.json())
                        .then(response=>{
                            if(!response.error) { 
                                const uploadedImageUrl = response.url;
                                images.push(uploadedImageUrl);
                                if(images.length===numOfImages) {
                                    callback(images);
                                }
                            }
                        });
                };
    
            });
         } catch (error) {
            if (error.name === 'AbortError') {
                // Do Nothing
                // console.log('Request aborted by user.');
            } else {
                // CORS or code errors goes here
                console.error('Error:', error);
                // console.log('Error:\n'+error);
                 this.dictation.finish(); // Must be called after finished
            }
        }
    }
    */
  }, {
    key: "lightboxOpen",
    value: function lightboxOpen(col) {
      // Open Lightbox
      if (this.useLightbox) {
        if ((col.hasAttribute('data-noedit') || col.hasAttribute('data-protected')) && this.dom.hasClass(col, 'block-click') /*  && this.dom.hasClass(col,'cell-active') */) {
          this.openMedia(col);
        }
      }
    }
  }, {
    key: "handleCellClick",
    value: function handleCellClick(col, e) {
      if (this.cleanEditing) {
        col.parentNode.querySelector('.is-row-tool').style.display = '';
        col.parentNode.querySelector('.is-col-tool').style.display = '';
      }
      this.lightboxOpen(col);
      var util = this.util;
      util.clearActiveCell();
      this.activeCol = col;
      var elm = e.target;
      col.classList.add('cell-active');
      var row = col.parentNode;
      row.classList.add('row-active');
      var builders = this.doc.querySelectorAll(this.opts.container);
      builders.forEach(function (builder) {
        builder.classList.remove('builder-active');
      });
      row.parentNode.classList.add('builder-active');
      this.doc.body.classList.add('content-edit');
      if (row.childElementCount - 2 === 1) {// If there is only 1 column, do not add row-outline class
      } else {
        row.classList.add('row-outline');
      }

      // Call onContentClick to indicate click on editable content (eg. for plugin usage)
      if (this.opts.onContentClick) this.opts.onContentClick(e);
      this.element.click(col, e);
      this.colTool.click(col);
      this.elmTool.click(col, e);
      if (!this.controlPanel) this.rte.click(col, e);else this.util.saveSelection(); // important (eg. for create/edit link)

      /*
      // TODO: move to grideditor.js
      // Grid Editor Status
      // On/off lock button
      const grideditor = document.querySelector('.grideditor.active');
      if(grideditor) {
          const btnCellLocking = grideditor.querySelector('.cell-locking');
          if(col.hasAttribute('data-noedit')) {
              btnCellLocking.classList.add('on');
          } else {
              btnCellLocking.classList.remove('on');
          }
      }
      */

      // If column only has spacer, locked or unlocked, 
      // the text should not be able to edit (cursor should not be able to be placed)
      // So, make the column uneditable (text) if only has a spacer.
      if (col.childElementCount === 1) {
        var _elm = col.children[0];
        if (_elm) if (this.dom.hasClass(_elm, 'spacer')) {
          col.contentEditable = false;
        }
      }

      // Show Lock Indicator
      this.colTool.showHideLockIndicator(col);
      if (this.opts.enableDragResize) {
        if (this.resize) {
          // console.log(this.resize);
          this.resize.destroy(); // destroy previous instance
        }

        // Enable resizable on click
        if (!col.classList.contains('noresize')) {
          // Disable on mobile
          var viewportWidth = this.doc.body.clientWidth;
          if (viewportWidth > 768) {
            this.resize = new resize(col, this);
            this.resize.enable();
          }
        }
      }
      if (this.settings.onSelectionChange) this.settings.onSelectionChange(e);

      // if(this.settings.onPageContentClick) this.settings.onPageContentClick(e);

      // Lightbox
      var link = elm.closest('a');
      if (link) {
        if (col.hasAttribute('data-noedit') || col.hasAttribute('data-protected')) {
          // Link & Lightbox click allowed only on locked column

          // Disable link open on builder area
          if (col.getAttribute('contenteditable') === 'true') {
            e.preventDefault();
            return false;
          } else {
            if (elm.tagName.toLowerCase() === 'a') link = elm;

            // Open Lightbox
            if (this.useLightbox && this.dom.hasClass(link, 'is-lightbox')) {
              var url = link.getAttribute('href');
              if (!url) {
                e.preventDefault();
                return false;
              }
              var extension = url.split('.').pop().split('?')[0].split('#')[0]; //

              var theme = link.getAttribute('data-modal-theme');
              if (!theme) theme = 'light';
              var color = elm.getAttribute('data-modal-color');
              if (url.includes('base64') || extension === 'jpg' || extension === 'jpeg' || extension === 'png' || extension === 'gif' || extension === 'webm' || extension === 'webp') {
                this.lightbox.openImage(url, theme, color);
                e.preventDefault();
                return false;
              } else if (extension === 'mp4') {
                this.lightbox.openVideo(url, 'dark', color);
                e.preventDefault();
                return false;
              } else if (url.toLowerCase().indexOf('youtube.com') !== -1 || url.toLowerCase().indexOf('youtube-nocookie.com') !== -1 || url.toLowerCase().indexOf('vimeo.com') !== -1) {
                this.lightbox.openExternalVideo(url, 'dark', color);
                e.preventDefault();
                return false;
              } else {
                // Will go to the link
                if (url.indexOf('#') === 0) {
                  // Do Nothing
                } else {
                  var answer = window.confirm(this.util.out('Do you really want to leave?'));
                  // cancel the navigation and stay on the same page
                  if (!answer) {
                    e.preventDefault();
                    return false;
                  }
                }
              }
            } else {
              var _url = link.getAttribute('href');
              if (!_url) {
                e.preventDefault();
                return false;
              }
              if (_url.indexOf('#') === 0) {
                // Do Nothing
              } else {
                var _answer = window.confirm(this.util.out('Do you really want to leave?'));
                // cancel the navigation and stay on the same page
                if (!_answer) {
                  e.preventDefault();
                  return false;
                }
              }
            }
          }
        }

        // e.preventDefault();
        // return false;
      }

      // Extra: Check if last row, make sure the Row Add Tool visible
      var tool = row.querySelector('.is-rowadd-tool');
      var tollAddButton = tool.querySelector('button');
      tollAddButton.style.marginTop = '';
      var children = Array.from(row.parentNode.children).filter(function (element) {
        return element.nodeName.toLowerCase() === 'div';
      });
      if (children && children.length > 0) {
        var lastChild = children[children.length - 1];
        if (row === lastChild) {
          var section = row.closest('.is-section');
          if (section) {
            var sectionOffset = this.dom.getElementOffset(section);
            var h1 = sectionOffset.top + sectionOffset.height;
            var rowOffset = this.dom.getElementOffset(row);
            var h2 = rowOffset.top + rowOffset.height;
            if (h1 - h2 < 19) {
              tollAddButton.style.marginTop = '-14px';
            }
          }
        }
      }
    }
  }, {
    key: "handleCellKeypress",
    value: function handleCellKeypress(e) {
      var _this28 = this;
      if (e.ctrlKey || e.metaKey) {
        //CTRL
        return;
      }
      if (this.uoTm === null) {
        this.uo.saveForUndo();
        this.uoTm = setTimeout(function () {
          _this28.uoTm = null;
        }, 1000);
      } else {
        clearTimeout(this.uoTm);
        this.uoTm = setTimeout(function () {
          _this28.uoTm = null;
        }, 1000);
      }
    }
  }, {
    key: "handleCellKeydown",
    value: function handleCellKeydown(col, e) {
      if (e.which === 46 || e.which === 8) {
        //delete or backspace
        if (this.activeIcon) {
          // Delete icon
          if (this.activeIcon.parentNode.tagName.toLowerCase() === 'a' && this.activeIcon.parentNode.innerText.trim() === '') {
            var link = this.activeIcon.parentNode;
            var parentElm = link.parentNode;
            link.parentNode.removeChild(link);
            // direct
            var linkTool = this.builderStuff.querySelector('#divLinkTool');
            if (linkTool) linkTool.style.display = '';
            var elmTool = this.builderStuff.querySelector('.is-element-tool');
            elmTool.style.display = '';
            if (parentElm) {
              if (parentElm.innerHTML.trim() === '') parentElm.parentNode.removeChild(parentElm);
            }
          } else {
            this.activeIcon.parentNode.removeChild(this.activeIcon);
          }
          e.preventDefault();
          return;
        }
        if (this.activeImage) {
          this.util.hideControls(); //deleting an image should also clear the visible image tool (and resizer).
        }

        col.querySelectorAll('.is-social').forEach(function (elm) {
          elm.removeAttribute('contentEditable'); // Return back the div.is-social (See: Prevent div.is-social gets deleted)
        });
      }

      this.oriLen = col.textContent.length; // get character length

      // Cleanup unwanted span
      var spans = col.querySelectorAll('span');
      Array.prototype.forEach.call(spans, function (span) {
        span.setAttribute('data-keep', '');
      });

      // Cleanup all elements with unwanted style
      var elms = col.querySelectorAll('[style]');
      elms.forEach(function (elm) {
        var attr = elm.getAttribute('style');
        if (attr.includes('font-size')) {
          elm.setAttribute('data-keep-font-size', '');
        }
        if (attr.includes('background-color')) {
          elm.setAttribute('data-keep-background-color', '');
        }
        if (attr.includes('background')) {
          elm.setAttribute('data-keep-background', '');
        }
        if (attr.includes('line-height')) {
          elm.setAttribute('data-keep-line-height', '');
        }
      });
      this.autoclean = true;
      if ((e.ctrlKey || e.metaKey) && e.which === 86) {//CTRL-V
        // this.handleCellPaste();
      }
      if (this.opts.elementSelection && !this.emailMode) {
        if ((e.ctrlKey || e.metaKey) && e.which === 65) {
          //CTRL-A

          var el;
          try {
            if (this.win.getSelection) {
              el = this.win.getSelection().getRangeAt(0).commonAncestorContainer.parentNode;
            } else if (this.doc.selection) {
              el = this.doc.selection.createRange().parentElement();
            }
            if (!this.dom.hasClass(el.parentNode.parentNode, 'is-builder')) {
              this.dom.selectElementContents(el);
            }
            e.preventDefault();
          } catch (e) {
            // Do Nothing
          }
        }
      }
      if (e.keyCode === 46) {
        // console.log("delete");
        var curr;
        try {
          if (window.getSelection) {
            curr = window.getSelection().getRangeAt(0).commonAncestorContainer;
          } else if (document.selection) {
            curr = document.selection.createRange();
          }
          if (curr.innerHTML === '<br>') {
            var next = curr.nextElementSibling;
            if (next) {
              curr.parentNode.removeChild(curr); //without this, empty P, H1, H2 (contains only <br />) cannot be deleted (when there is another P below)
              // Of course, we can backspace from the P below, but the formatting will change.
              e.preventDefault();
            }
          }
        } catch (e) {
          // Do Nothing
        }
      }
      if (e.keyCode === 8) {
        // delete on Mac
        var _curr;
        try {
          if (window.getSelection) {
            _curr = window.getSelection().getRangeAt(0).commonAncestorContainer;
          } else if (document.selection) {
            _curr = document.selection.createRange();
          }
          if (_curr.textContent === '') {
            var prev = _curr.previousElementSibling;
            if (!prev) {
              e.preventDefault(); //Without this, empty P, H1, H2 (that doesn't have prev element) will be lost => can make empty column.
            }
          }
        } catch (e) {
          // Do Nothing
        }
      }
      if (e.which === 9 && !e.shiftKey) {
        // tab key pressed
        var activeCol = this.activeCol;
        if (activeCol) {
          if (activeCol.nextElementSibling && activeCol.nextElementSibling.hasAttribute('data-click')) {
            // Do Nothing
            var target = activeCol.nextElementSibling;
            if (target) target.click();
            // if(target.firstElementChild) target.firstElementChild.click();

            var selection = window.getSelection();
            var range = this.createRange(target, {
              count: 0
            });
            if (range) {
              range.collapse(false);
              selection.removeAllRanges();
              selection.addRange(range);
            }
            if (target.firstElementChild) {
              setTimeout(function () {
                target.firstElementChild.click();
              }, 200);
            }
            e.preventDefault();
          } else {
            if (activeCol.parentNode.nextElementSibling) {
              // Next row
              var row = activeCol.parentNode.nextElementSibling;
              if (row) {
                var firstCol = row.firstElementChild;
                if (firstCol) firstCol.click();
                // if(firstCol.firstElementChild) firstCol.firstElementChild.click();

                var _selection = window.getSelection();
                var _range2 = this.createRange(firstCol, {
                  count: 0
                });
                if (_range2) {
                  _range2.collapse(false);
                  _selection.removeAllRanges();
                  _selection.addRange(_range2);
                }
                if (firstCol.firstElementChild) {
                  setTimeout(function () {
                    firstCol.firstElementChild.click();
                  }, 200);
                }
                e.preventDefault();
              }
            }
          }
        }
      }
      if (e.which === 9 && e.shiftKey) {
        // tab + shift key pressed
        var _activeCol = this.activeCol;
        if (_activeCol) {
          if (_activeCol.previousElementSibling && _activeCol.previousElementSibling.hasAttribute('data-click')) {
            // Do Nothing
            var _target = _activeCol.previousElementSibling;
            if (_target) _target.click();
            if (_target.firstElementChild) _target.firstElementChild.click();
            var _selection2 = window.getSelection();
            var _range3 = this.createRange(_target, {
              count: 0
            });
            if (_range3) {
              _range3.collapse(false);
              _selection2.removeAllRanges();
              _selection2.addRange(_range3);
            }
            if (_target.firstElementChild) {
              setTimeout(function () {
                _target.firstElementChild.click();
              }, 200);
            }
            e.preventDefault();
          } else {
            if (_activeCol.parentNode.previousElementSibling) {
              // Prev row
              var divs = _activeCol.parentNode.previousElementSibling.querySelectorAll('[data-click]');
              if (divs.length > 0) {
                var _target2 = divs[divs.length - 1];
                if (_target2) _target2.click();
                if (_target2.firstElementChild) _target2.firstElementChild.click();
                var _selection3 = window.getSelection();
                var _range4 = this.createRange(_target2, {
                  count: 0
                });
                if (_range4) {
                  _range4.collapse(false);
                  _selection3.removeAllRanges();
                  _selection3.addRange(_range4);
                }
                if (_target2.firstElementChild) {
                  setTimeout(function () {
                    _target2.firstElementChild.click();
                  }, 200);
                }
                e.preventDefault();
              }
            }
          }
        }
      }

      // Formatting
      var markSpan = function markSpan() {
        var spans = col.querySelectorAll('span');
        Array.prototype.forEach.call(spans, function (span) {
          span.setAttribute('data-keep', '');
        });
      };
      var isCmd = e.ctrlKey || e.metaKey;
      if (isCmd && e.which === 66) {
        // CMD-B

        if (this.opts.useCssClasses) {
          this.uo.saveForUndo();
          this.dom.execCommandToggle('fontWeight', '', this.opts.cssClasses);
          this.opts.onChange();
          e.preventDefault();
          markSpan();
        }
      }
      if (isCmd && e.which === 73) {
        // CMD-I

        if (this.opts.useCssClasses) {
          this.uo.saveForUndo();
          this.dom.execCommandToggle('fontStyle', '', this.opts.cssClasses);
          this.opts.onChange();
          e.preventDefault();
          markSpan();
        }
      }
      if (isCmd && e.which === 85) {
        // CMD-U

        if (this.opts.useCssClasses) {
          this.uo.saveForUndo();
          this.dom.execCommandToggle('textUnderline', '', this.opts.cssClasses);
          this.opts.onChange();
          e.preventDefault();
          markSpan();
        }
      }
      if (isCmd && e.which === 83) {
        // CMD-S

        if (this.opts.useCssClasses) {
          this.uo.saveForUndo();
          this.dom.execCommandToggle('textLinethrough', '', this.opts.cssClasses);
          this.opts.onChange();
          e.preventDefault();
          markSpan();
        }
      }
      if (isCmd && e.which === 221) {
        this.uo.saveForUndo();

        // CMD-]
        e.preventDefault();
        document.execCommand('indent', false, null);
        this.opts.onChange();
        e.preventDefault();
        markSpan();
      }
      if (isCmd && e.which === 219) {
        this.uo.saveForUndo();

        // CMD-]
        e.preventDefault();
        document.execCommand('outdent', false, null);
        this.opts.onChange();
        e.preventDefault();
        markSpan();
      }
      if (isCmd && e.which === 75) {
        // CMD-K

        this.element.hyperlink.createLink();
        e.preventDefault();
      }
      if (isCmd && e.which === 80) {
        // CMD-P
        e.preventDefault();
        this.rte.insertImage();
      }
      if (this.cleanEditing) {
        this.colTool.columnTool.classList.remove('active');
        col.parentNode.querySelector('.is-row-tool').style.display = 'none';
        col.parentNode.querySelector('.is-col-tool').style.display = 'none';
      }
    }
  }, {
    key: "createRange",
    value: function createRange(node, chars, range) {
      if (!range) {
        range = document.createRange();
        range.selectNode(node);
        range.setStart(node, 0);
      }
      if (chars.count === 0) {
        range.setEnd(node, chars.count);
      } else if (node && chars.count > 0) {
        if (node.nodeType === Node.TEXT_NODE) {
          if (node.textContent.length < chars.count) {
            chars.count -= node.textContent.length;
          } else {
            range.setEnd(node, chars.count);
            chars.count = 0;
          }
        } else {
          for (var lp = 0; lp < node.childNodes.length; lp++) {
            range = this.createRange(node.childNodes[lp], chars, range);
            if (chars.count === 0) {
              break;
            }
          }
        }
      }
      return range;
    }
  }, {
    key: "handleCellFocus",
    value: function handleCellFocus(col) {
      var activeCol = this.activeCol;
      if (!activeCol) {
        if (col.firstElementChild) col.firstElementChild.click();else col.click();
      } else {
        if (col !== activeCol) {
          if (col.firstElementChild) col.firstElementChild.click();else col.click();
        }
      }
    }
  }, {
    key: "handleCellKeyup",
    value: function handleCellKeyup(col, e) {
      if (e.which === 46 || e.which === 8) {
        col.querySelectorAll('.is-social').forEach(function (elm) {
          elm.contentEditable = false; // Prevent div.is-social gets deleted while deleting its next element
        });
      }

      if (this.dom.textSelection()) {
        if (e.keyCode === '38') {
          // Up arrow
          this.util.saveSelection();
        } else if (e.keyCode === '40') {
          // Down arrow
          this.util.saveSelection();
        } else if (e.keyCode === '37') {
          // Left arrow
          this.util.saveSelection();
        } else if (e.keyCode === '39') {
          // Right arrow
          this.util.saveSelection();
        }
      }

      // See: handleCellKeydown
      // Cleanup unwanted span
      var spans = col.querySelectorAll('span');
      Array.prototype.forEach.call(spans, function (span) {
        var attr = span.hasAttribute('data-keep');
        if (!attr) {
          // Remove unwanted span
          span.outerHTML = span.innerHTML;
        }
      });

      // Cleanup all elements with unwanted style
      if (this.autoclean) {
        var elms = col.querySelectorAll('[style]');
        elms.forEach(function (elm) {
          var attr = elm.getAttribute('style');
          if (attr.includes('font-size')) {
            var attrkeep = elm.hasAttribute('data-keep-font-size');
            if (!attrkeep) {
              elm.style.fontSize = '';
            }
          }
          if (attr.includes('background-color')) {
            var _attrkeep = elm.hasAttribute('data-keep-background-color');
            if (!_attrkeep) {
              elm.style.backgroundColor = '';
            }
          }
          if (attr.includes('background')) {
            var _attrkeep2 = elm.hasAttribute('data-keep-background');
            if (!_attrkeep2) {
              elm.style.background = '';
            }
          }
          if (attr.includes('line-height')) {
            var _attrkeep3 = elm.hasAttribute('data-keep-line-height');
            if (!_attrkeep3) {
              elm.style.lineHeight = '';
            }
          }
        });
        col.querySelectorAll('[data-keep-font-size]').forEach(function (elm) {
          return elm.removeAttribute('data-keep-font-size');
        });
        col.querySelectorAll('[data-keep-background-color]').forEach(function (elm) {
          return elm.removeAttribute('data-keep-background-color');
        });
        col.querySelectorAll('[data-keep-background]').forEach(function (elm) {
          return elm.removeAttribute('data-keep-background');
        });
        col.querySelectorAll('[data-keep-line-height]').forEach(function (elm) {
          return elm.removeAttribute('data-keep-line-height');
        });
      }
      this.autoclean = false;
      var el;
      // var curr;
      try {
        if (this.win.getSelection) {
          // curr = window.getSelection().getRangeAt(0).commonAncestorContainer;
          el = this.win.getSelection().getRangeAt(0).commonAncestorContainer.parentNode;
        } else if (this.doc.selection) {
          // curr = this.doc.selection.createRange();
          el = this.doc.selection.createRange().parentElement();
        }
      } catch (e) {
        return;
      } //Use try to prevent lost selection after undo

      if (e.keyCode === 13 && !e.shiftKey) {
        //So that enter at the end of list returns <p>
        /*
        var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        var isOpera = window.opera;
        if(isChrome || isOpera) { 
            //Without this, pressing ENTER at the end of list will returns <p> on Chrome but then it become <div> (On Opera it returns <div>)
            //With this, we change it into <p>
            if(el.tagName.toLowerCase() === 'p' || el.tagName.toLowerCase() === 'div') {
                this.doc.execCommand('formatBlock', false, '<p>');
            }
        }*/
        if (el.tagName.toLowerCase() === 'p' || el.tagName.toLowerCase() === 'div') {
          this.doc.execCommand('formatBlock', false, '<p>');
        }

        /*
        if(isFirefox) {
            //On FF (when enter at the end of list) jQuery(curr).html() returns undefined
            if(curr) this.doc.execCommand('formatBlock', false, '<p>');
        }*/

        var _elms = col.querySelectorAll('[data-keep]');
        Array.prototype.forEach.call(_elms, function (elm) {
          elm.removeAttribute('data-keep');
        });
      }

      // LATER
      // jQuery('.cell-active').find('.elm-active').removeClass('elm-active');
      // jQuery("#divElementTool").css("display", "none"); //force hide ellement tool

      // Call onChange to indicate content change
      // this.opts.onChange();

      // console.log(this.oriLen,col.textContent.length);
      if (this.oriLen !== col.textContent.length) {
        // check if typing produce/reduce a character
        this.typing();
      }

      // Hide element highlight & tool during typing
      this.elmTool.hide();
    }
  }, {
    key: "typing",
    value: function typing() {
      var _this29 = this;
      // console.log('typing');
      if (this.timeoutId) clearTimeout(this.timeoutId);
      this.timeoutId = setTimeout(function () {
        _this29.opts.onChange();
      }, 2000);
    }
  }, {
    key: "handleCellPaste",
    value: function handleCellPaste(clipboardData, clipboardDataHtml) {
      if (localStorage.getItem('_pasteresult') !== null) {
        this.opts.paste = localStorage.getItem('_pasteresult');
      }
      this.uo.saveForUndo();
      var util = this.util;
      util.saveSelection(); //required. Without this, CTRL-A (select element) & CTRL-V won't replace the element, but will paste at the end of the element.

      // Create a temporary div to hold the pasted HTML
      var contentword = document.createElement('div');
      contentword.innerHTML = clipboardDataHtml;
      try {
        var sPastedText = '';

        //Check video embed
        var bPasteObject = false;
        var src = contentword.innerText;
        if (!this.opts.disableAutoEmbedVideo) {
          //var youRegex = /^http[s]?:\/\/(((www.youtube.com\/watch\?(feature=player_detailpage&)?)v=)|(youtu.be\/))([^#\&\?]*)/;
          var youRegex = /^http[s]?:\/\/(((www.youtube.com\/watch\?(feature=player_detailpage&)?)v=)|(youtu.be\/))([^#&?]*)/;
          var vimeoRegex = /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/)|(video\/))?([0-9]+)\/?/;
          var youRegexMatches = youRegex.exec(src);
          var vimeoRegexMatches = vimeoRegex.exec(src);
          if (youRegexMatches !== null || vimeoRegexMatches !== null) {
            if (youRegexMatches !== null && youRegexMatches.length >= 7) {
              var youMatch = youRegexMatches[6];
              src = 'https://www.youtube.com/embed/' + youMatch + '?rel=0';
            }
            if (vimeoRegexMatches !== null && vimeoRegexMatches.length >= 7) {
              var vimeoMatch = vimeoRegexMatches[6];
              src = 'https://player.vimeo.com/video/' + vimeoMatch;
            }
            sPastedText = '<div class="embed-responsive embed-responsive-16by9"><iframe tabindex="0" width="560" height="315" src="' + src + '" frameborder="0" allowfullscreen=""></iframe></div>';
            bPasteObject = true;
          }
        }
        if (!bPasteObject) {
          if (this.opts.paste === 'text') {
            /*
            let elms = contentword.querySelectorAll('p,h1,h2,h3,h4,h5,h6');
            Array.prototype.forEach.call(elms, (elm) => {
                elm.innerHTML = elm.innerHTML + ' '; //add space (&nbsp;)
            });
             // sPastedText = contentword.innerText;
            sPastedText = contentword.innerHTML;
            sPastedText = sPastedText.replace(/(<([^>]+)>)/ig,'<br>');
            sPastedText = sPastedText.replace(/(<br\s*\/?>){3,}/gi, '<br>');
            if(sPastedText.indexOf('<br>')===0) {
                sPastedText = sPastedText.substring(4);
            }
            if(sPastedText.substring(sPastedText.length-4)==='<br>'){
                sPastedText = sPastedText.substring(0, sPastedText.length-4);
            }
            sPastedText = sPastedText.trim();
            */

            sPastedText = clipboardData;
            // sPastedText = sPastedText.replace(/(?:\r\n|\r|\n)/g, '<br>');
          } else {
            sPastedText = contentword.innerHTML;
            if (this.opts.paste === 'html') {
              //with styles
              sPastedText = util.cleanHTML(sPastedText, false);
            } else {
              //html-without-styles (default)
              sPastedText = util.cleanHTML(sPastedText, true);
            }
            contentword.innerHTML = sPastedText;

            /*
            // remove attributes
            if(this.opts.paste === 'html'){//with styles
                 let elms = contentword.querySelectorAll('*');
                Array.prototype.forEach.call(elms, (elm) => {
                    for(let n = 0;n<elm.attributes.length;n++) {
                        if(elm.attributes[n].name!=='style') elm.removeAttribute(elm.attributes[n].name);
                    }
                });
             } else { //html-without-styles (default)
                
                const removeAttributes = (element) => {
                    while (element.attributes.length > 0) {
                        element.removeAttribute(element.attributes[0].name);
                    }
                };
                let elms = contentword.querySelectorAll('*');
                Array.prototype.forEach.call(elms, (elm) => {
                    removeAttributes(elm);
                });
            }
            */

            /*
            Additional Cleanup:
                - Remove p inside li
                - Remove li with white-space: pre
            */
            var elms = contentword.querySelectorAll('li');
            Array.prototype.forEach.call(elms, function (elm) {
              elm.style.whiteSpace = '';
              var childNodes = elm.childNodes;
              var i = childNodes.length;
              while (i--) {
                if (childNodes[i].tagName === 'P') {
                  childNodes[i].outerHTML = childNodes[i].innerHTML;
                }
              }
            });

            // NOTE: paste <h1><p> jadi nempel

            // // Source: https://gist.github.com/sbrin/6801034 
            // jQuery('p', $editor).each(function(){
            //     var str = jQuery(this).attr('style');
            //     var matches = /mso-list:\w+ \w+([0-9]+)/.exec(str);
            //     if (matches) {
            //         jQuery(this).data('_listLevel',  parseInt(matches[1], 10));
            //     }
            // });
            // var last_level=0;
            // var pnt = null;
            // jQuery('p', $editor).each(function(){
            //     var cur_level = jQuery(this).data('_listLevel');
            //     if(cur_level !== undefined){
            //         var txt = jQuery(this).text();
            //         var list_tag = '<ul></ul>';
            //         if (/^\s*\w+\./.test(txt)) {
            //             var matches = /([0-9])\./.exec(txt);
            //             if (matches) {
            //                 var start = parseInt(matches[1], 10);
            //                 list_tag = start>1 ? '<ol start="' + start + '"></ol>' : '<ol></ol>';
            //             }else{
            //                 list_tag = '<ol></ol>';
            //             }
            //         }

            //         if(cur_level>last_level){
            //             if(last_level===0){
            //                 jQuery(this).before(list_tag);
            //                 pnt = jQuery(this).prev();
            //             }else{
            //                 pnt = jQuery(list_tag).appendTo(pnt);
            //             }
            //         }
            //         if(cur_level<last_level){
            //             for(var i=0; i<last_level-cur_level; i++){
            //                 pnt = pnt.parent();
            //             }
            //         }
            //         jQuery('span:first', this).remove();
            //         pnt.append('<li>' + jQuery(this).html() + '</li>');
            //         jQuery(this).remove();
            //         last_level = cur_level;
            //     }else{
            //         last_level = 0;
            //     }
            // });
            // //jQuery('[style]', $editor).removeAttr('style'); //done (see cleanHTML)
            // jQuery('[align]', $editor).removeAttr('align');
            // //jQuery('span', $editor).replaceWith(function() {return jQuery(this).contents();}); //done (see cleanHTML)
            // jQuery('span:empty', $editor).remove();
            // //jQuery("[class^='Mso']", $editor).removeAttr('class'); //done (see cleanHTML)
            // jQuery('p:empty', $editor).remove();

            sPastedText = contentword.innerHTML;
          }
        }
        contentword = this.doc.querySelector('#idContentWord');
        if (contentword) contentword.parentNode.removeChild(contentword);
        util.restoreSelection();

        /*
        var oSel = this.win.getSelection();
        var range = oSel.getRangeAt(0);
        range.extractContents();
        range.collapse(true);
        var docFrag = range.createContextualFragment(sPastedText);
        var lastNode = docFrag.lastChild;
         range.insertNode(docFrag);
        */

        /*
        When selection is made by double clicking text (to select the entire block),
        the actual selection goes to the next block as well (default behavior, tested using a simple contentEditable div).
        To fix this, re-select the contents inside.
        */

        var blocks = this.dom.getSelectedBlocks();
        var selection = this.win.getSelection();

        /* 
        Check same selection for the block first (this is more accurate than the sameSelection checking below).
        In case of double click (to select the entire block), for example, on this element:
             <h2 class="font-light size-54"><span class="size-24">Heading</span> 2 here</h2>
         The sameSelection checking below is failed, since the container = this.getElm() will return not the entire h2, but only
             <span class="size-24">Heading</span>
         So, blocks checking below is made to fix it.
        */
        try {
          var blockSelection = false;
          if (selection.toString().trim() !== '') {
            if (blocks.length === 1) {
              if (blocks[0].innerText.trim() === selection.toString().trim()) {
                var range = document.createRange();
                range.selectNodeContents(blocks[0]);
                selection.removeAllRanges();
                selection.addRange(range);
                blockSelection = true;
              }
            }
            if (!blockSelection) {
              var container = this.dom.getElm();
              var sameSelection = container && container.innerText === selection.toString().trim();
              if (sameSelection || selection.toString().trim() === '') {
                var _range5 = document.createRange();
                _range5.selectNodeContents(container);
                selection.removeAllRanges();
                selection.addRange(_range5);
              }
            }
          }
        } catch (e) {
          // Do Nothing
        }
        this.doc.execCommand('insertHTML', false, sPastedText);
        if (this.activeCol) {
          /*
          Additional Cleanup:
              - Remove empty elements (empty p, etc)
          */
          // this.activeCol.find('h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,p:empty').remove();
          // this.activeCol.querySelectorAll('*:empty').forEach((x)=>{x.remove();}); // Makes <img> removed
          this.activeCol.querySelectorAll('h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,p:empty').forEach(function (x) {
            x.remove();
          });

          /*
          Additional Cleanup:
              Fix HTML structure. The problem:
              <p class="elm-active">
                  ...Sometimes h1, h2, p can be pasted here..
              </p>
          */
          var elmActive = this.activeCol.querySelector('p.elm-active,h1.elm-active,h2.elm-active,h3.elm-active,h4.elm-active,h5.elm-active,h6.elm-active');
          if (elmActive) {
            var _elms2 = elmActive.querySelectorAll('p,h1,h2,h3,h4,h5,h6');
            if (_elms2.length > 0) {
              var elmClosestElement = elmActive.nextElementSibling;

              //Fix text that doesn't have paragraph
              var textNodes = Array.from(elmActive.childNodes).filter(function (node) {
                return node.nodeType === 3 && node.textContent.trim().length > 1;
              });
              textNodes.forEach(function (node) {
                var span = document.createElement('p');
                node.after(span);
                span.appendChild(node);
              });
              if (elmActive.firstElementChild && elmActive.childNodes.length === 1) {
                if (elmActive.firstElementChild.tagName === 'SPAN') {
                  // Paste HTML with styles 

                  elmActive.outerHTML = elmActive.firstElementChild.innerHTML; //fix

                  // Re-clean empty elements
                  this.activeCol.querySelectorAll('*:empty').forEach(function (x) {
                    x.remove();
                  });

                  //place cursor
                  if (elmClosestElement) this.dom.moveCursorToElement(elmClosestElement.previousElementSibling);else this.dom.moveCursorToElement(this.activeCol);
                  var _builderActive2 = this.doc.querySelector('.builder-active');
                  if (_builderActive2) this.applyBehaviorOn(_builderActive2);

                  //Trigger Change event
                  this.opts.onChange();

                  //Trigger Render event
                  this.opts.onRender();
                  return;
                }
              }

              // Paste HTML without styles 
              elmActive.outerHTML = elmActive.innerHTML; //fix

              // Re-clean empty elements
              // this.activeCol.querySelectorAll('*:empty').forEach((x)=>{x.remove();}); // Makes <img> removed
              this.activeCol.find('h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,p:empty').remove();

              //place cursor
              if (elmClosestElement) this.dom.moveCursorToElement(elmClosestElement.previousElementSibling);else this.dom.moveCursorToElement(this.activeCol);
              var _builderActive = this.doc.querySelector('.builder-active');
              if (_builderActive) this.applyBehaviorOn(_builderActive);

              //Trigger Change event
              this.opts.onChange();

              //Trigger Render event
              this.opts.onRender();
              return;
            }
          }
        }

        /*
        range.setStartAfter(lastNode);
        range.setEndAfter(lastNode);
        range.collapse(false);
        var comCon = range.commonAncestorContainer;
        if (comCon && comCon.parentNode) {
            try { comCon.parentNode.normalize(); } catch (e) {
                // Do Nothing
            }
        }
        oSel.removeAllRanges();
        oSel.addRange(range);
        */

        var builderActive = this.doc.querySelector('.builder-active');
        if (builderActive) this.applyBehaviorOn(builderActive);

        //Trigger Change event
        this.opts.onChange();

        //Trigger Render event
        this.opts.onRender();
      } catch (e) {

        // Do Nothing
      }
    }
  }, {
    key: "cellSelected",
    value: function cellSelected() {
      var util = this.util;
      return util.cellSelected();
    }

    // https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
  }, {
    key: "loadScript",
    value: function loadScript(source, beforeEl) {
      var async = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      var defer = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
      return new Promise(function (resolve, reject) {
        var script = document.createElement('script');
        var prior = beforeEl || document.getElementsByTagName('script')[0];
        script.async = async;
        script.defer = defer;
        function onloadHander(_, isAbort) {
          if (isAbort || !script.readyState || /loaded|complete/.test(script.readyState)) {
            script.onload = null;
            script.onreadystatechange = null;
            script = undefined;
            if (isAbort) {
              reject();
            } else {
              resolve();
            }
          }
        }
        script.onload = onloadHander;
        script.onreadystatechange = onloadHander;
        script.src = source;
        prior.parentNode.insertBefore(script, prior);
      });
    }

    // If scriptPath is not set, this will be used.
  }, {
    key: "currentScriptPath",
    value: function currentScriptPath() {
      var filename, location;
      var scriptElements = document.getElementsByTagName('script');
      for (var i = 0; i < scriptElements.length; i++) {
        var source = scriptElements[i].src;
        filename = 'contentbuilder.js';
        if (source.indexOf(filename) > -1) {
          location = source.substring(0, source.indexOf(filename));
        }
        filename = 'contentbuilder.min.js';
        if (source.indexOf(filename) > -1) {
          location = source.substring(0, source.indexOf(filename));
        }
      }
      return location;
      // var scripts = document.querySelectorAll('script[src]');
      // var currentScript = scripts[scripts.length - 1].src;
      // var currentScriptChunks = currentScript.split('/');
      // var currentScriptFile = currentScriptChunks[currentScriptChunks.length - 1];
      // return currentScript.replace(currentScriptFile, '');
    }
  }, {
    key: "sectionDropSetup",
    value: function sectionDropSetup() {
      var _this30 = this;
      if (this.blockContainer) {
        this.sortableOnCanvas = [];
        var wrapper;
        var boxes;
        if (this.page && this.page === '.is-wrapper') {
          wrapper = this.doc.querySelector(this.page);
          boxes = wrapper.querySelectorAll('.is-box.box-canvas');
        } else {
          boxes = this.doc.querySelectorAll(this.blockContainer);
        }
        boxes.forEach(function (box) {
          box.insertAdjacentHTML('afterbegin', "\n                <div class=\"is-block block-dummy\" style=\"top: 0%; left: 0%; width: 100%; height: 20%;background:#eee;opacity:0\"></div>\n                <div class=\"is-block block-dummy\" style=\"top: 20%; left: 0%; width: 100%; height: 20%;background:#eee;opacity:0\"></div>\n                <div class=\"is-block block-dummy\" style=\"top: 40%; left: 0%; width: 100%; height: 20%;background:#eee;opacity:0\"></div>\n                <div class=\"is-block block-dummy\" style=\"top: 60%; left: 0%; width: 100%; height: 20%;background:#eee;opacity:0\"></div>\n                <div class=\"is-block block-dummy\" style=\"top: 80%; left: 0%; width: 100%; height: 20%;background:#eee;opacity:0\"></div>\n                ");
          var obj = new sortable_esm(box, {
            scroll: true,
            group: 'shared',
            direction: 'horizontal',
            animation: 150,
            // sort: true, 
            onAdd: function onAdd(evt) {
              var itemEl = evt.item;
              if (itemEl.getAttribute('data-id')) {
                // If has data-id attribute, the dropped item is from snippet panel (snippetpanel.js)

                var snippetid = itemEl.getAttribute('data-id');
                var lastBlock;
                var elements = Array.from(box.querySelectorAll('.is-block')).filter(function (elm) {
                  return !elm.parentNode.closest('.is-block');
                }); // exclude child blocks
                if (elements.length > 0) {
                  lastBlock = elements[elements.length - 1];
                }

                // snippetJSON is snippet's JSON (from assets/minimalist-blocks/content.js) that store all snippets' html
                var result = _this30.opts.snippetJSON.snippets.filter(function (item) {
                  if (item.id + '' === snippetid) return item;else return false;
                });
                var html = result[0].html;
                var noedit = result[0].noedit;
                var occurrences = _this30.dom.countOccurrences(html, 'column');
                var bSnippet;
                if (html.indexOf('"row') === -1) {
                  bSnippet = true; // Just snippet (without row/column grid)
                } else {
                  bSnippet = false; // Snippet is wrapped in row/colum
                }

                if (_this30.opts.emailMode) bSnippet = false;

                // Convert snippet into your defined 12 columns grid   
                var rowClass = _this30.opts.row; //row
                var colClass = _this30.opts.cols; //['col s1', 'col s2', 'col s3', 'col s4', 'col s5', 'col s6', 'col s7', 'col s8', 'col s9', 'col s10', 'col s11', 'col s12']
                if (rowClass !== '' && colClass.length === 12) {
                  // html = html.replace(new RegExp('row clearfix', 'g'), rowClass);
                  html = html.replace(new RegExp('row clearfix', 'g'), 'row'); // backward
                  html = html.replace(new RegExp('"row', 'g'), '"' + rowClass);
                  html = html.replace(new RegExp('column full', 'g'), colClass[11]);
                  html = html.replace(new RegExp('column half', 'g'), colClass[5]);
                  html = html.replace(new RegExp('column third', 'g'), colClass[3]);
                  html = html.replace(new RegExp('column fourth', 'g'), colClass[2]);
                  html = html.replace(new RegExp('column fifth', 'g'), colClass[1]);
                  html = html.replace(new RegExp('column sixth', 'g'), colClass[1]);
                  html = html.replace(new RegExp('column two-third', 'g'), colClass[7]);
                  html = html.replace(new RegExp('column two-fourth', 'g'), colClass[8]);
                  html = html.replace(new RegExp('column two-fifth', 'g'), colClass[9]);
                  html = html.replace(new RegExp('column two-sixth', 'g'), colClass[9]);
                }
                html = html.replace(/{id}/g, _this30.util.makeId());
                if (_this30.opts.onAdd) {
                  html = _this30.opts.onAdd(html);
                }
                if (_this30.opts.snippetPathReplace.length > 0) {
                  // try {
                  if (_this30.opts.snippetPathReplace[0] !== '') {
                    var regex = new RegExp(_this30.opts.snippetPathReplace[0], 'g');
                    html = html.replace(regex, _this30.opts.snippetPathReplace[1]);
                    var string1 = _this30.opts.snippetPathReplace[0].replace(/\//g, '%2F');
                    var string2 = _this30.opts.snippetPathReplace[1].replace(/\//g, '%2F');
                    var regex2 = new RegExp(string1, 'g');
                    html = html.replace(regex2, string2);
                  }
                  // } catch (e) { 1; }
                }

                if (bSnippet) {
                  // Just snippet (without row/column grid), ex. buttons, line, social, video, map.
                  // Can be inserted after current row, column (cell), element, or last row.

                  html = "<div class=\"".concat(_this30.opts.row, "\"><div class=\"").concat(_this30.opts.cols[_this30.opts.cols.length - 1], "\"").concat(noedit ? ' data-noedit' : '', ">").concat(html, "</div></div>");

                  // Clean snippet from sortable related code
                  itemEl.removeAttribute('draggable');
                  _this30.dom.removeClass(itemEl, 'snippet-item');
                  var bw = '';
                  if (_this30.page && _this30.page === '.is-wrapper') {
                    bw = '760px';
                  } else {
                    if (occurrences === 2) {
                      bw = '760px';
                    } else if (occurrences >= 3) {
                      bw = '760px';
                    } else {
                      bw = '540px';
                    }
                  }
                  var blockTemplate = "\n                                <div class=\"is-block block-steady height-auto\" data-new-dummy=\"1\" style=\"top: 20%; left: 20%; width: ".concat(bw, ";\">\n                                    <div class=\"is-container container-new\">\n                                    [%CONTENT%]\n                                    </div>\n                                </div>\n                                "); // data-new-dummy will be used by onSort to apply top/left position (snippetpanel.js)
                  itemEl.outerHTML = blockTemplate.replace('[%CONTENT%]', html);
                } else {
                  // Snippet is wrapped in row/colum (may contain custom code or has [data-html] attribute)
                  // Can only be inserted after current row or last row (not on column or element).

                  var snippet = _this30.dom.createElement('div');
                  snippet.innerHTML = html;
                  var blocks = snippet.querySelectorAll('[data-html]');
                  Array.prototype.forEach.call(blocks, function (block) {
                    // Render custom code block
                    html = decodeURIComponent(block.getAttribute('data-html'));
                    html = html.replace(/{id}/g, _this30.util.makeId());
                    html = html.replace(/<script>/g, "".concat(_this30.nonce ? "<script nonce=\"".concat(_this30.nonce, "\">") : '<script>'));
                    for (var i = 1; i <= 20; i++) {
                      html = html.replace('[%HTML' + i + '%]', block.getAttribute('data-html-' + i) === undefined ? '' : decodeURIComponent(block.getAttribute('data-html-' + i))); //render editable area
                    }

                    block.innerHTML = html;
                  });
                  html = snippet.innerHTML;

                  // Clean snippet from sortable related code
                  itemEl.removeAttribute('draggable');
                  _this30.dom.removeClass(itemEl, 'snippet-item');
                  itemEl.innerHTML = '';

                  // Use createContextualFragment() to make embedded script executable
                  // https://ghinda.net/article/script-tags/
                  var range = document.createRange();
                  range.setStart(itemEl, 0);
                  itemEl.appendChild(range.createContextualFragment(html));
                  var _bw = '';
                  if (_this30.page && _this30.page === '.is-wrapper') {
                    _bw = '760px';
                  } else {
                    if (occurrences === 2) {
                      _bw = '760px';
                    } else if (occurrences >= 3) {
                      _bw = '760px';
                    } else {
                      _bw = '540px';
                    }
                  }
                  var _blockTemplate = "\n                                <div class=\"is-block block-steady height-auto\" data-new-dummy=\"1\" style=\"top: 20%; left: 20%; width: ".concat(_bw, ";\">\n                                    <div class=\"is-container container-new\">\n                                    [%CONTENT%]\n                                    </div>\n                                </div>\n                                ");
                  itemEl.outerHTML = _blockTemplate.replace('[%CONTENT%]', itemEl.innerHTML);
                }
                _this30.activeCol = null;
                var builders = box.querySelectorAll('.is-container.container-new');
                builders.forEach(function (builder) {
                  var block = builder.parentNode;
                  if (lastBlock) {
                    lastBlock.insertAdjacentElement('afterend', block);
                  } else {
                    var ovarlay = box.querySelector('.is-overlay');
                    if (ovarlay) ovarlay.insertAdjacentElement('afterend', block);else box.insertAdjacentElement('afterbegin', block);
                  }

                  // After snippet has been added, re-apply behavior on builder areas
                  _this30.applyBehaviorOn(builder);
                  builder.classList.remove('container-new');
                });
                if (_this30.opts.onBlockCanvasAdd) _this30.opts.onBlockCanvasAdd();
                _this30.opts.onChange();
                _this30.opts.onRender();
              }

              // destroy
              if (_this30.sortableOnCanvas) {
                _this30.sortableOnCanvas.forEach(function (obj) {
                  if (obj) {
                    obj.destroy();
                  }
                });
                var dummies = _this30.doc.querySelectorAll('.block-dummy');
                dummies.forEach(function (elm) {
                  return elm.parentNode.removeChild(elm);
                });
              }
              if (_this30.sortableOnPage) _this30.sortableOnPage.destroy();
            }
          });
          _this30.sortableOnCanvas.push(obj);
        });
      }
      if (this.page) {
        if (this.page !== '.is-wrapper') return; // only for ContentBox
        var _wrapper = this.doc.querySelector(this.page);
        this.sortableOnPage = new sortable_esm(_wrapper, {
          scroll: true,
          group: 'shared',
          direction: 'vertical',
          animation: 150,
          sort: true,
          // draggable: '.dummy',
          // swapThreshold: 0.1,
          // invertSwap: true,
          onAdd: function onAdd(evt) {
            var itemEl = evt.item;
            if (itemEl.querySelector('.is-col-tool')) {
              var rowTool = itemEl.querySelector('.is-row-tool');
              var colTool = itemEl.querySelector('.is-col-tool');
              var rowAddTool = itemEl.querySelector('.is-rowadd-tool');
              itemEl.removeChild(rowTool);
              itemEl.removeChild(colTool);
              itemEl.removeChild(rowAddTool);
              var elms = itemEl.querySelectorAll('[data-click]');
              elms.forEach(function (elm) {
                elm.removeAttribute('data-click');
              });
              itemEl.removeAttribute('draggable');
              itemEl.classList.remove('row-active');
              itemEl.classList.remove('row-outline');
              elms = itemEl.querySelectorAll('.cell-active');
              elms.forEach(function (elm) {
                elm.classList.remove('cell-active');
              });
              elms = itemEl.querySelectorAll('*');
              elms.forEach(function (elm) {
                elm.style.cursor = '';
              });

              // itemEl.outerHTML = `
              // <div class="is-section is-box is-section-100 type-poppins">
              //     <div class="is-overlay"></div>
              //     <div class="is-boxes">
              //         <div class="is-box-centered">
              //             <div class="is-container is-content-900 v2 size-18 leading-14">
              //                 ${itemEl.outerHTML}
              //             </div>
              //         </div>
              //     </div>
              // </div>
              // `;
              itemEl.outerHTML = _this30.settings.sectionTemplate.replace('[%CONTENT%]', itemEl.outerHTML);
              _this30.activeCol = null;
              if (_this30.opts.onBlockSectionAdd) _this30.opts.onBlockSectionAdd();

              // //Trigger Change event
              // this.opts.onChange();

              // //Trigger Render event
              // this.opts.onRender();

              return;
            }
            if (itemEl.getAttribute('data-id')) {
              // If has data-id attribute, the dropped item is from snippet panel (snippetpanel.js)

              var snippetid = itemEl.getAttribute('data-id');

              // snippetJSON is snippet's JSON (from assets/minimalist-blocks/content.js) that store all snippets' html
              var result = _this30.opts.snippetJSON.snippets.filter(function (item) {
                if (item.id + '' === snippetid) return item;else return false;
              });
              var html = result[0].html;
              var noedit = result[0].noedit;
              var bSnippet;
              if (html.indexOf('"row') === -1) {
                bSnippet = true; // Just snippet (without row/column grid)
              } else {
                bSnippet = false; // Snippet is wrapped in row/colum
              }

              if (_this30.opts.emailMode) bSnippet = false;

              // Convert snippet into your defined 12 columns grid   
              var rowClass = _this30.opts.row; //row
              var colClass = _this30.opts.cols; //['col s1', 'col s2', 'col s3', 'col s4', 'col s5', 'col s6', 'col s7', 'col s8', 'col s9', 'col s10', 'col s11', 'col s12']
              if (rowClass !== '' && colClass.length === 12) {
                // html = html.replace(new RegExp('row clearfix', 'g'), rowClass);
                html = html.replace(new RegExp('row clearfix', 'g'), 'row'); // backward
                html = html.replace(new RegExp('"row', 'g'), '"' + rowClass);
                html = html.replace(new RegExp('column full', 'g'), colClass[11]);
                html = html.replace(new RegExp('column half', 'g'), colClass[5]);
                html = html.replace(new RegExp('column third', 'g'), colClass[3]);
                html = html.replace(new RegExp('column fourth', 'g'), colClass[2]);
                html = html.replace(new RegExp('column fifth', 'g'), colClass[1]);
                html = html.replace(new RegExp('column sixth', 'g'), colClass[1]);
                html = html.replace(new RegExp('column two-third', 'g'), colClass[7]);
                html = html.replace(new RegExp('column two-fourth', 'g'), colClass[8]);
                html = html.replace(new RegExp('column two-fifth', 'g'), colClass[9]);
                html = html.replace(new RegExp('column two-sixth', 'g'), colClass[9]);
              }
              html = html.replace(/{id}/g, _this30.util.makeId());
              if (_this30.opts.onAdd) {
                html = _this30.opts.onAdd(html);
              }
              if (_this30.opts.snippetPathReplace.length > 0) {
                // try {
                if (_this30.opts.snippetPathReplace[0] !== '') {
                  var regex = new RegExp(_this30.opts.snippetPathReplace[0], 'g');
                  html = html.replace(regex, _this30.opts.snippetPathReplace[1]);
                  var string1 = _this30.opts.snippetPathReplace[0].replace(/\//g, '%2F');
                  var string2 = _this30.opts.snippetPathReplace[1].replace(/\//g, '%2F');
                  var regex2 = new RegExp(string1, 'g');
                  html = html.replace(regex2, string2);
                }
                // } catch (e) { 1; }
              }

              if (bSnippet) {
                // Just snippet (without row/column grid), ex. buttons, line, social, video, map.
                // Can be inserted after current row, column (cell), element, or last row.

                html = "<div class=\"".concat(_this30.opts.row, "\"><div class=\"").concat(_this30.opts.cols[_this30.opts.cols.length - 1], "\"").concat(noedit ? ' data-noedit' : '', ">").concat(html, "</div></div>");

                // Clean snippet from sortable related code
                itemEl.removeAttribute('draggable');
                _this30.dom.removeClass(itemEl, 'snippet-item');

                // itemEl.outerHTML = html;
                // itemEl.outerHTML = `
                // <div class="is-section is-box is-section-100 type-poppins">
                //     <div class="is-overlay"></div>
                //     <div class="is-boxes">
                //         <div class="is-box-centered">
                //             <div class="is-container is-content-900 v2 size-18 leading-14">${html}</div>
                //         </div>
                //     </div>
                // </div>
                // `;
                itemEl.outerHTML = _this30.settings.sectionTemplate.replace('[%CONTENT%]', html);
              } else {
                // Snippet is wrapped in row/colum (may contain custom code or has [data-html] attribute)
                // Can only be inserted after current row or last row (not on column or element).

                var snippet = _this30.dom.createElement('div');
                snippet.innerHTML = html;
                var blocks = snippet.querySelectorAll('[data-html]');
                Array.prototype.forEach.call(blocks, function (block) {
                  // Render custom code block
                  html = decodeURIComponent(block.getAttribute('data-html'));
                  html = html.replace(/{id}/g, _this30.util.makeId());
                  html = html.replace(/<script>/g, "".concat(_this30.nonce ? "<script nonce=\"".concat(_this30.nonce, "\">") : '<script>'));
                  for (var i = 1; i <= 20; i++) {
                    html = html.replace('[%HTML' + i + '%]', block.getAttribute('data-html-' + i) === undefined ? '' : decodeURIComponent(block.getAttribute('data-html-' + i))); //render editable area
                  }

                  block.innerHTML = html;
                });
                html = snippet.innerHTML;

                // Clean snippet from sortable related code
                itemEl.removeAttribute('draggable');
                _this30.dom.removeClass(itemEl, 'snippet-item');
                itemEl.innerHTML = '';

                // Use createContextualFragment() to make embedded script executable
                // https://ghinda.net/article/script-tags/
                var range = document.createRange();
                range.setStart(itemEl, 0);
                itemEl.appendChild(range.createContextualFragment(html));

                // itemEl.outerHTML = itemEl.innerHTML;

                // itemEl.outerHTML = `
                // <div class="is-section is-box is-section-100 type-poppins">
                //     <div class="is-overlay"></div>
                //     <div class="is-boxes">
                //         <div class="is-box-centered">
                //             <div class="is-container is-content-900 v2 size-18 leading-14">${itemEl.innerHTML}</div>
                //         </div>
                //     </div>
                // </div>
                // `;
                itemEl.outerHTML = _this30.settings.sectionTemplate.replace('[%CONTENT%]', itemEl.innerHTML);
              }
              // // After snippet has been added, re-apply behavior on builder areas
              // this.applyBehaviorOn(builder);

              _this30.activeCol = null;
              if (_this30.opts.onBlockSectionAdd) _this30.opts.onBlockSectionAdd();

              //Trigger Change event
              _this30.opts.onChange();

              //Trigger Render event
              _this30.opts.onRender();

              // // Hide element tool
              // this.elmTool.hide();
            }

            // this.sortableOnPage.option('draggable', '.dummy');

            // destroy
            if (_this30.sortableOnCanvas) {
              _this30.sortableOnCanvas.forEach(function (obj) {
                if (obj) {
                  obj.destroy();
                }
              });
              var dummies = _this30.doc.querySelectorAll('.block-dummy');
              dummies.forEach(function (elm) {
                return elm.parentNode.removeChild(elm);
              });
            }
            if (_this30.sortableOnPage) _this30.sortableOnPage.destroy();
          }
        });
      }
    }
  }, {
    key: "hideElementTools",
    value: function hideElementTools() {
      var elmTool = this.doc.querySelector('.is-element-tool');
      if (elmTool) elmTool.style.display = '';
      var linkTool = this.doc.querySelector('#divLinkTool');
      if (linkTool) linkTool.style.display = '';
      var spacerTool = this.builderStuff.querySelector('.is-spacer-tool');
      if (spacerTool) spacerTool.style.display = '';
      this.element.image.hideImageTool();
      this.doc.querySelectorAll('.icon-active').forEach(function (elm) {
        return elm.classList.remove('icon-active');
      });
      this.doc.querySelectorAll('.elm-inspected').forEach(function (elm) {
        return elm.classList.remove('elm-inspected');
      });
      this.doc.querySelectorAll('.elm-active').forEach(function (elm) {
        return elm.classList.remove('elm-active');
      });
      this.activeImage = null;
      this.activeIcon = null;
      this.inspectedElement = null;
      this.activeElement = null;
    }
  }], [{
    key: "run",
    value: function run() {
      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      return new ContentBuilder(opts);
    }
  }]);
  return ContentBuilder;
}();
/* harmony default export */ const contentbuilder = (ContentBuilder);
})();

__webpack_exports__ = __webpack_exports__["default"];
/******/ 	return __webpack_exports__;
/******/ })()
;
});